package dk.dbc.dataio.sink.ims.connector;

import com.github.tomakehurst.wiremock.core.WireMockConfiguration;
import com.github.tomakehurst.wiremock.junit.WireMockRule;
import dk.dbc.dataio.commons.types.ChunkItem;
import dk.dbc.dataio.sink.ims.MarcXchangeRecordUnmarshaller;
import dk.dbc.oss.ns.updatemarcxchange.MarcXchangeRecord;
import dk.dbc.oss.ns.updatemarcxchange.UpdateMarcXchangeResult;
import net.jodah.failsafe.RetryPolicy;
import org.junit.Rule;
import org.junit.Test;

import javax.xml.bind.JAXBException;
import javax.xml.ws.WebServiceException;
import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;

import static com.github.tomakehurst.wiremock.client.WireMock.aResponse;
import static com.github.tomakehurst.wiremock.client.WireMock.equalToXml;
import static com.github.tomakehurst.wiremock.client.WireMock.post;
import static com.github.tomakehurst.wiremock.client.WireMock.stubFor;
import static com.github.tomakehurst.wiremock.client.WireMock.urlPathMatching;
import static org.hamcrest.CoreMatchers.is;
import static org.hamcrest.MatcherAssert.assertThat;

public class ImsServiceConnectorTest {
    @Rule
    public WireMockRule wireMockRule = new WireMockRule(
        new WireMockConfiguration().dynamicPort(), false);

    @Test(expected = NullPointerException.class)
    public void constructor_endpointArgIsNull_throws() {
        new ImsServiceConnector(null);
    }

    @Test(expected = IllegalArgumentException.class)
    public void constructor_endpointArgIsEmpty_throws() {
        new ImsServiceConnector(" ");
    }

    @Test
    public void updateMarcXchange_returnsServiceResults() {
        final MarcXchangeRecordsTwoOkOneFail requestResponse = new MarcXchangeRecordsTwoOkOneFail();
        requestResponse.stub();

        final ImsServiceConnector imsServiceConnector = new ImsServiceConnector(getWireMockEndpoint());
        final List<UpdateMarcXchangeResult> results = imsServiceConnector.updateMarcXchange(requestResponse.getTrackingId(), requestResponse.getMarcXchangeRecordsForRequest());
        assertThat("Number of results returned", results.size(), is(3));
        int id = 0;
        for (UpdateMarcXchangeResult result : results) {
            assertThat("marcXchangeRecordId", result.getMarcXchangeRecordId(), is(Integer.toString(id++)));
        }
    }

    // why do we test that running without a stub returns a 404 error?
    // the WireMockRule needs to be instantiated with false for its
    // ```failOnUnmatchedRequests``` parameter, otherwise we get a
    // VerificationException.
    @Test(expected = WebServiceException.class)
    public void updateMarcXchange_wsFrameWorkThrows_throws() {
        final MarcXchangeRecordsTwoOkOneFail requestResponse = new MarcXchangeRecordsTwoOkOneFail();
        // No stubbing provokes WebServiceException

        final ImsServiceConnector imsServiceConnector = new ImsServiceConnector(getWireMockEndpoint())
                .withRetryPolicy(new RetryPolicy().withMaxRetries(0));
        imsServiceConnector.updateMarcXchange(requestResponse.getTrackingId(),
            requestResponse.getMarcXchangeRecordsForRequest());
    }

    public static abstract class ImsServiceRequestResponse {
        public static String MARCXCHANGE_710100_OK = "<marcx:collection xmlns:marcx=\"info:lc/xmlns/marcxchange-v1\"><marcx:record xmlns:marcx=\"info:lc/xmlns/marcxchange-v1\" format=\"danMARC2\" type=\"Bibliographic\"><marcx:leader>00000n    2200000   4500</marcx:leader><marcx:datafield tag=\"001\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">710100_test_1</marcx:subfield><marcx:subfield code=\"b\">710100</marcx:subfield><marcx:subfield code=\"c\">20151015102339</marcx:subfield><marcx:subfield code=\"d\">20150923</marcx:subfield><marcx:subfield code=\"f\">a</marcx:subfield></marcx:datafield><marcx:datafield tag=\"004\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"r\">n</marcx:subfield><marcx:subfield code=\"a\">e</marcx:subfield></marcx:datafield><marcx:datafield tag=\"008\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"t\">m</marcx:subfield><marcx:subfield code=\"u\">f</marcx:subfield><marcx:subfield code=\"a\">2015</marcx:subfield><marcx:subfield code=\"b\">dk</marcx:subfield><marcx:subfield code=\"d\">m</marcx:subfield><marcx:subfield code=\"d\">y</marcx:subfield><marcx:subfield code=\"l\">dan</marcx:subfield><marcx:subfield code=\"x\">05</marcx:subfield><marcx:subfield code=\"v\">0</marcx:subfield></marcx:datafield><marcx:datafield tag=\"009\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">a</marcx:subfield><marcx:subfield code=\"g\">xx</marcx:subfield></marcx:datafield><marcx:datafield tag=\"021\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"c\">Hf.</marcx:subfield></marcx:datafield><marcx:datafield tag=\"032\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"x\">ACC201539</marcx:subfield><marcx:subfield code=\"a\">DBF201544</marcx:subfield></marcx:datafield><marcx:datafield tag=\"041\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">dan</marcx:subfield><marcx:subfield code=\"d\">eng</marcx:subfield></marcx:datafield><marcx:datafield tag=\"100\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"0\"/><marcx:subfield code=\"a\">Søbjerg Nielsen</marcx:subfield><marcx:subfield code=\"h\">Susanne</marcx:subfield><marcx:subfield code=\"4\">aut</marcx:subfield></marcx:datafield><marcx:datafield tag=\"245\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">Et ¤skib er ude af drift</marcx:subfield><marcx:subfield code=\"c\">forsikring og erstatning af ren økonomisk skade</marcx:subfield><marcx:subfield code=\"c\">et bidrag til \"first party insurance\" som kompensationssystem (et retligt perspektiv)</marcx:subfield></marcx:datafield><marcx:datafield tag=\"260\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">Kbh.</marcx:subfield><marcx:subfield code=\"b\">Det Juridiske Fakultet, Københavns Universitet</marcx:subfield><marcx:subfield code=\"c\">[2015]</marcx:subfield></marcx:datafield><marcx:datafield tag=\"300\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">212 blade</marcx:subfield><marcx:subfield code=\"c\">30 cm</marcx:subfield></marcx:datafield><marcx:datafield tag=\"506\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">Ph.d.-afhandling</marcx:subfield></marcx:datafield><marcx:datafield tag=\"508\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">Med resumé på engelsk</marcx:subfield></marcx:datafield><marcx:datafield tag=\"521\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"&amp;\">REX</marcx:subfield><marcx:subfield code=\"b\">1. oplag</marcx:subfield><marcx:subfield code=\"c\">[2015]</marcx:subfield></marcx:datafield><marcx:datafield tag=\"532\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"&amp;\">1</marcx:subfield><marcx:subfield code=\"a\">Med litteraturhenvisninger</marcx:subfield></marcx:datafield><marcx:datafield tag=\"652\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"m\">34.535</marcx:subfield></marcx:datafield><marcx:datafield tag=\"900\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"0\"/><marcx:subfield code=\"a\">Nielsen</marcx:subfield><marcx:subfield code=\"h\">Camilla Søbjerg</marcx:subfield><marcx:subfield code=\"z\">100</marcx:subfield></marcx:datafield><marcx:datafield tag=\"d08\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"o\">hni</marcx:subfield><marcx:subfield code=\"o\">hlt</marcx:subfield><marcx:subfield code=\"k\">jaw</marcx:subfield></marcx:datafield><marcx:datafield tag=\"d09\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"z\">REX201544</marcx:subfield></marcx:datafield><marcx:datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">20150923</marcx:subfield></marcx:datafield><marcx:datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">20150923</marcx:subfield></marcx:datafield><marcx:datafield tag=\"s10\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">DBC</marcx:subfield></marcx:datafield><marcx:datafield tag=\"s12\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"t\">TeamMUS201542</marcx:subfield></marcx:datafield><marcx:datafield tag=\"z98\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">Minus korrekturprint</marcx:subfield></marcx:datafield><marcx:datafield tag=\"z99\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">hlt</marcx:subfield></marcx:datafield></marcx:record></marcx:collection>";
        public static String MARCXCHANGE_710100_FAIL = "<marcx:collection xmlns:marcx=\"info:lc/xmlns/marcxchange-v1\"><marcx:record xmlns:marcx=\"info:lc/xmlns/marcxchange-v1\" format=\"danMARC2\" type=\"Bibliographic\"><marcx:datafield tag=\"001\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">710100_test_2</marcx:subfield><marcx:subfield code=\"b\">710100</marcx:subfield><marcx:subfield code=\"c\">20151015102339</marcx:subfield><marcx:subfield code=\"d\">20150923</marcx:subfield><marcx:subfield code=\"f\">a</marcx:subfield></marcx:datafield><marcx:datafield tag=\"004\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"r\">n</marcx:subfield><marcx:subfield code=\"a\">e</marcx:subfield></marcx:datafield><marcx:datafield tag=\"008\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"t\">m</marcx:subfield><marcx:subfield code=\"u\">f</marcx:subfield><marcx:subfield code=\"a\">2015</marcx:subfield><marcx:subfield code=\"b\">dk</marcx:subfield><marcx:subfield code=\"d\">m</marcx:subfield><marcx:subfield code=\"d\">y</marcx:subfield><marcx:subfield code=\"l\">dan</marcx:subfield><marcx:subfield code=\"x\">05</marcx:subfield><marcx:subfield code=\"v\">0</marcx:subfield></marcx:datafield><marcx:datafield tag=\"009\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">a</marcx:subfield><marcx:subfield code=\"g\">xx</marcx:subfield></marcx:datafield><marcx:datafield tag=\"021\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"c\">Hf.</marcx:subfield></marcx:datafield><marcx:datafield tag=\"032\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"x\">ACC201539</marcx:subfield><marcx:subfield code=\"a\">DBF201544</marcx:subfield></marcx:datafield><marcx:datafield tag=\"041\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">dan</marcx:subfield><marcx:subfield code=\"d\">eng</marcx:subfield></marcx:datafield><marcx:datafield tag=\"100\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"0\"/><marcx:subfield code=\"a\">Søbjerg Nielsen</marcx:subfield><marcx:subfield code=\"h\">Susanne</marcx:subfield><marcx:subfield code=\"4\">aut</marcx:subfield></marcx:datafield><marcx:datafield tag=\"245\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">Et ¤skib er ude af drift</marcx:subfield><marcx:subfield code=\"c\">forsikring og erstatning af ren økonomisk skade</marcx:subfield><marcx:subfield code=\"c\">et bidrag til \"first party insurance\" som kompensationssystem (et retligt perspektiv)</marcx:subfield></marcx:datafield><marcx:datafield tag=\"260\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">Kbh.</marcx:subfield><marcx:subfield code=\"b\">Det Juridiske Fakultet, Københavns Universitet</marcx:subfield><marcx:subfield code=\"c\">[2015]</marcx:subfield></marcx:datafield><marcx:datafield tag=\"300\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">212 blade</marcx:subfield><marcx:subfield code=\"c\">30 cm</marcx:subfield></marcx:datafield><marcx:datafield tag=\"506\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">Ph.d.-afhandling</marcx:subfield></marcx:datafield><marcx:datafield tag=\"508\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">Med resumé på engelsk</marcx:subfield></marcx:datafield><marcx:datafield tag=\"521\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"&amp;\">REX</marcx:subfield><marcx:subfield code=\"b\">1. oplag</marcx:subfield><marcx:subfield code=\"c\">[2015]</marcx:subfield></marcx:datafield><marcx:datafield tag=\"532\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"&amp;\">1</marcx:subfield><marcx:subfield code=\"a\">Med litteraturhenvisninger</marcx:subfield></marcx:datafield><marcx:datafield tag=\"652\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"m\">34.535</marcx:subfield></marcx:datafield><marcx:datafield tag=\"900\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"0\"/><marcx:subfield code=\"a\">Nielsen</marcx:subfield><marcx:subfield code=\"h\">Camilla Søbjerg</marcx:subfield><marcx:subfield code=\"z\">100</marcx:subfield></marcx:datafield><marcx:datafield tag=\"d08\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"o\">hni</marcx:subfield><marcx:subfield code=\"o\">hlt</marcx:subfield><marcx:subfield code=\"k\">jaw</marcx:subfield></marcx:datafield><marcx:datafield tag=\"d09\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"z\">REX201544</marcx:subfield></marcx:datafield><marcx:datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">20150923</marcx:subfield></marcx:datafield><marcx:datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">20150923</marcx:subfield></marcx:datafield><marcx:datafield tag=\"s10\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">DBC</marcx:subfield></marcx:datafield><marcx:datafield tag=\"s12\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"t\">TeamMUS201542</marcx:subfield></marcx:datafield><marcx:datafield tag=\"z98\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">Minus korrekturprint</marcx:subfield></marcx:datafield><marcx:datafield tag=\"z99\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">hlt</marcx:subfield></marcx:datafield></marcx:record></marcx:collection>";
        public static String MARCXCHANGE_737000_OK = "<marcx:collection xmlns:marcx=\"info:lc/xmlns/marcxchange-v1\"><marcx:record xmlns:marcx=\"info:lc/xmlns/marcxchange-v1\" format=\"danMARC2\" type=\"Bibliographic\"><marcx:leader>00000n    2200000   4500</marcx:leader><marcx:datafield tag=\"001\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">737000_test_1</marcx:subfield><marcx:subfield code=\"b\">737000</marcx:subfield><marcx:subfield code=\"c\">20151015102339</marcx:subfield><marcx:subfield code=\"d\">20150923</marcx:subfield><marcx:subfield code=\"f\">a</marcx:subfield></marcx:datafield><marcx:datafield tag=\"004\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"r\">n</marcx:subfield><marcx:subfield code=\"a\">e</marcx:subfield></marcx:datafield><marcx:datafield tag=\"008\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"t\">m</marcx:subfield><marcx:subfield code=\"u\">f</marcx:subfield><marcx:subfield code=\"a\">2015</marcx:subfield><marcx:subfield code=\"b\">dk</marcx:subfield><marcx:subfield code=\"d\">m</marcx:subfield><marcx:subfield code=\"d\">y</marcx:subfield><marcx:subfield code=\"l\">dan</marcx:subfield><marcx:subfield code=\"x\">05</marcx:subfield><marcx:subfield code=\"v\">0</marcx:subfield></marcx:datafield><marcx:datafield tag=\"009\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">a</marcx:subfield><marcx:subfield code=\"g\">xx</marcx:subfield></marcx:datafield><marcx:datafield tag=\"021\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"c\">Hf.</marcx:subfield></marcx:datafield><marcx:datafield tag=\"032\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"x\">ACC201539</marcx:subfield><marcx:subfield code=\"a\">DBF201544</marcx:subfield></marcx:datafield><marcx:datafield tag=\"041\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">dan</marcx:subfield><marcx:subfield code=\"d\">eng</marcx:subfield></marcx:datafield><marcx:datafield tag=\"100\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"0\"/><marcx:subfield code=\"a\">Søbjerg Nielsen</marcx:subfield><marcx:subfield code=\"h\">Susanne</marcx:subfield><marcx:subfield code=\"4\">aut</marcx:subfield></marcx:datafield><marcx:datafield tag=\"245\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">Et ¤skib er ude af drift</marcx:subfield><marcx:subfield code=\"c\">forsikring og erstatning af ren økonomisk skade</marcx:subfield><marcx:subfield code=\"c\">et bidrag til \"first party insurance\" som kompensationssystem (et retligt perspektiv)</marcx:subfield></marcx:datafield><marcx:datafield tag=\"260\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">Kbh.</marcx:subfield><marcx:subfield code=\"b\">Det Juridiske Fakultet, Københavns Universitet</marcx:subfield><marcx:subfield code=\"c\">[2015]</marcx:subfield></marcx:datafield><marcx:datafield tag=\"300\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">212 blade</marcx:subfield><marcx:subfield code=\"c\">30 cm</marcx:subfield></marcx:datafield><marcx:datafield tag=\"506\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">Ph.d.-afhandling</marcx:subfield></marcx:datafield><marcx:datafield tag=\"508\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">Med resumé på engelsk</marcx:subfield></marcx:datafield><marcx:datafield tag=\"521\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"&amp;\">REX</marcx:subfield><marcx:subfield code=\"b\">1. oplag</marcx:subfield><marcx:subfield code=\"c\">[2015]</marcx:subfield></marcx:datafield><marcx:datafield tag=\"532\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"&amp;\">1</marcx:subfield><marcx:subfield code=\"a\">Med litteraturhenvisninger</marcx:subfield></marcx:datafield><marcx:datafield tag=\"652\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"m\">34.535</marcx:subfield></marcx:datafield><marcx:datafield tag=\"900\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"0\"/><marcx:subfield code=\"a\">Nielsen</marcx:subfield><marcx:subfield code=\"h\">Camilla Søbjerg</marcx:subfield><marcx:subfield code=\"z\">100</marcx:subfield></marcx:datafield><marcx:datafield tag=\"d08\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"o\">hni</marcx:subfield><marcx:subfield code=\"o\">hlt</marcx:subfield><marcx:subfield code=\"k\">jaw</marcx:subfield></marcx:datafield><marcx:datafield tag=\"d09\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"z\">REX201544</marcx:subfield></marcx:datafield><marcx:datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">20150923</marcx:subfield></marcx:datafield><marcx:datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">20150923</marcx:subfield></marcx:datafield><marcx:datafield tag=\"s10\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">DBC</marcx:subfield></marcx:datafield><marcx:datafield tag=\"s12\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"t\">TeamMUS201542</marcx:subfield></marcx:datafield><marcx:datafield tag=\"z98\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">Minus korrekturprint</marcx:subfield></marcx:datafield><marcx:datafield tag=\"z99\" ind1=\"0\" ind2=\"0\"><marcx:subfield code=\"a\">hlt</marcx:subfield></marcx:datafield></marcx:record></marcx:collection>";
        public static String TRACKING_ID = "42-0";

        protected final MarcXchangeRecordUnmarshaller marcXchangeRecordUnmarshaller = new MarcXchangeRecordUnmarshaller();
        protected String requestBody;
        protected String responseBody;

        public abstract List<ChunkItem> getChunkItemsForRequest();

        public String getTrackingId() {
            return TRACKING_ID;
        }

        public List<MarcXchangeRecord> getMarcXchangeRecordsForRequest() {
            return getChunkItemsForRequest().stream()
                    .map(this::toMarcXchangeRecord)
                    .collect(Collectors.toList());
        }

        public void stub() {
            stubFor(post(urlPathMatching("/"))
                .withRequestBody(equalToXml(requestBody))
                .willReturn(aResponse()
                        .withStatus(200)
                        .withBody(responseBody)));
        }

        private MarcXchangeRecord toMarcXchangeRecord(ChunkItem chunkItem) {
            try {
                return marcXchangeRecordUnmarshaller.toMarcXchangeRecord(chunkItem);
            } catch (JAXBException e) {
                throw new IllegalStateException(e);
            }
        }
    }

    public static class MarcXchangeRecordsTwoOkOneFail extends ImsServiceRequestResponse {
        public MarcXchangeRecordsTwoOkOneFail() {
            requestBody = "<?xml version=\"1.0\" ?><S:Envelope xmlns:S=\"http://schemas.xmlsoap.org/soap/envelope/\"><S:Body><ns2:updateMarcXchange xmlns:ns2=\"http://oss.dbc.dk/ns/updateMarcXchange\" xmlns=\"info:lc/xmlns/marcxchange-v1\">" +
                    "<ns2:updateMarcXchangeRequest>" +
                    "    <ns2:marcXchangeRecord><collection><record format=\"danMARC2\" type=\"Bibliographic\"><leader>00000n    2200000   4500</leader><datafield tag=\"001\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">710100_test_1</subfield><subfield code=\"b\">710100</subfield><subfield code=\"c\">20151015102339</subfield><subfield code=\"d\">20150923</subfield><subfield code=\"f\">a</subfield></datafield><datafield tag=\"004\" ind1=\"0\" ind2=\"0\"><subfield code=\"r\">n</subfield><subfield code=\"a\">e</subfield></datafield><datafield tag=\"008\" ind1=\"0\" ind2=\"0\"><subfield code=\"t\">m</subfield><subfield code=\"u\">f</subfield><subfield code=\"a\">2015</subfield><subfield code=\"b\">dk</subfield><subfield code=\"d\">m</subfield><subfield code=\"d\">y</subfield><subfield code=\"l\">dan</subfield><subfield code=\"x\">05</subfield><subfield code=\"v\">0</subfield></datafield><datafield tag=\"009\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">a</subfield><subfield code=\"g\">xx</subfield></datafield><datafield tag=\"021\" ind1=\"0\" ind2=\"0\"><subfield code=\"c\">Hf.</subfield></datafield><datafield tag=\"032\" ind1=\"0\" ind2=\"0\"><subfield code=\"x\">ACC201539</subfield><subfield code=\"a\">DBF201544</subfield></datafield><datafield tag=\"041\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">dan</subfield><subfield code=\"d\">eng</subfield></datafield><datafield tag=\"100\" ind1=\"0\" ind2=\"0\"><subfield code=\"0\"></subfield><subfield code=\"a\">Søbjerg Nielsen</subfield><subfield code=\"h\">Susanne</subfield><subfield code=\"4\">aut</subfield></datafield><datafield tag=\"245\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Et ¤skib er ude af drift</subfield><subfield code=\"c\">forsikring og erstatning af ren økonomisk skade</subfield><subfield code=\"c\">et bidrag til \"first party insurance\" som kompensationssystem (et retligt perspektiv)</subfield></datafield><datafield tag=\"260\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Kbh.</subfield><subfield code=\"b\">Det Juridiske Fakultet, Københavns Universitet</subfield><subfield code=\"c\">[2015]</subfield></datafield><datafield tag=\"300\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">212 blade</subfield><subfield code=\"c\">30 cm</subfield></datafield><datafield tag=\"506\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Ph.d.-afhandling</subfield></datafield><datafield tag=\"508\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Med resumé på engelsk</subfield></datafield><datafield tag=\"521\" ind1=\"0\" ind2=\"0\"><subfield code=\"&amp;\">REX</subfield><subfield code=\"b\">1. oplag</subfield><subfield code=\"c\">[2015]</subfield></datafield><datafield tag=\"532\" ind1=\"0\" ind2=\"0\"><subfield code=\"&amp;\">1</subfield><subfield code=\"a\">Med litteraturhenvisninger</subfield></datafield><datafield tag=\"652\" ind1=\"0\" ind2=\"0\"><subfield code=\"m\">34.535</subfield></datafield><datafield tag=\"900\" ind1=\"0\" ind2=\"0\"><subfield code=\"0\"></subfield><subfield code=\"a\">Nielsen</subfield><subfield code=\"h\">Camilla Søbjerg</subfield><subfield code=\"z\">100</subfield></datafield><datafield tag=\"d08\" ind1=\"0\" ind2=\"0\"><subfield code=\"o\">hni</subfield><subfield code=\"o\">hlt</subfield><subfield code=\"k\">jaw</subfield></datafield><datafield tag=\"d09\" ind1=\"0\" ind2=\"0\"><subfield code=\"z\">REX201544</subfield></datafield><datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">20150923</subfield></datafield><datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">20150923</subfield></datafield><datafield tag=\"s10\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">DBC</subfield></datafield><datafield tag=\"s12\" ind1=\"0\" ind2=\"0\"><subfield code=\"t\">TeamMUS201542</subfield></datafield><datafield tag=\"z98\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Minus korrekturprint</subfield></datafield><datafield tag=\"z99\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">hlt</subfield></datafield></record></collection><ns2:MarcXchangeRecordId>0</ns2:MarcXchangeRecordId></ns2:marcXchangeRecord>" +
                    "    <ns2:marcXchangeRecord><collection><record format=\"danMARC2\" type=\"Bibliographic\"><datafield tag=\"001\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">710100_test_2</subfield><subfield code=\"b\">710100</subfield><subfield code=\"c\">20151015102339</subfield><subfield code=\"d\">20150923</subfield><subfield code=\"f\">a</subfield></datafield><datafield tag=\"004\" ind1=\"0\" ind2=\"0\"><subfield code=\"r\">n</subfield><subfield code=\"a\">e</subfield></datafield><datafield tag=\"008\" ind1=\"0\" ind2=\"0\"><subfield code=\"t\">m</subfield><subfield code=\"u\">f</subfield><subfield code=\"a\">2015</subfield><subfield code=\"b\">dk</subfield><subfield code=\"d\">m</subfield><subfield code=\"d\">y</subfield><subfield code=\"l\">dan</subfield><subfield code=\"x\">05</subfield><subfield code=\"v\">0</subfield></datafield><datafield tag=\"009\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">a</subfield><subfield code=\"g\">xx</subfield></datafield><datafield tag=\"021\" ind1=\"0\" ind2=\"0\"><subfield code=\"c\">Hf.</subfield></datafield><datafield tag=\"032\" ind1=\"0\" ind2=\"0\"><subfield code=\"x\">ACC201539</subfield><subfield code=\"a\">DBF201544</subfield></datafield><datafield tag=\"041\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">dan</subfield><subfield code=\"d\">eng</subfield></datafield><datafield tag=\"100\" ind1=\"0\" ind2=\"0\"><subfield code=\"0\"></subfield><subfield code=\"a\">Søbjerg Nielsen</subfield><subfield code=\"h\">Susanne</subfield><subfield code=\"4\">aut</subfield></datafield><datafield tag=\"245\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Et ¤skib er ude af drift</subfield><subfield code=\"c\">forsikring og erstatning af ren økonomisk skade</subfield><subfield code=\"c\">et bidrag til \"first party insurance\" som kompensationssystem (et retligt perspektiv)</subfield></datafield><datafield tag=\"260\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Kbh.</subfield><subfield code=\"b\">Det Juridiske Fakultet, Københavns Universitet</subfield><subfield code=\"c\">[2015]</subfield></datafield><datafield tag=\"300\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">212 blade</subfield><subfield code=\"c\">30 cm</subfield></datafield><datafield tag=\"506\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Ph.d.-afhandling</subfield></datafield><datafield tag=\"508\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Med resumé på engelsk</subfield></datafield><datafield tag=\"521\" ind1=\"0\" ind2=\"0\"><subfield code=\"&amp;\">REX</subfield><subfield code=\"b\">1. oplag</subfield><subfield code=\"c\">[2015]</subfield></datafield><datafield tag=\"532\" ind1=\"0\" ind2=\"0\"><subfield code=\"&amp;\">1</subfield><subfield code=\"a\">Med litteraturhenvisninger</subfield></datafield><datafield tag=\"652\" ind1=\"0\" ind2=\"0\"><subfield code=\"m\">34.535</subfield></datafield><datafield tag=\"900\" ind1=\"0\" ind2=\"0\"><subfield code=\"0\"></subfield><subfield code=\"a\">Nielsen</subfield><subfield code=\"h\">Camilla Søbjerg</subfield><subfield code=\"z\">100</subfield></datafield><datafield tag=\"d08\" ind1=\"0\" ind2=\"0\"><subfield code=\"o\">hni</subfield><subfield code=\"o\">hlt</subfield><subfield code=\"k\">jaw</subfield></datafield><datafield tag=\"d09\" ind1=\"0\" ind2=\"0\"><subfield code=\"z\">REX201544</subfield></datafield><datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">20150923</subfield></datafield><datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">20150923</subfield></datafield><datafield tag=\"s10\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">DBC</subfield></datafield><datafield tag=\"s12\" ind1=\"0\" ind2=\"0\"><subfield code=\"t\">TeamMUS201542</subfield></datafield><datafield tag=\"z98\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Minus korrekturprint</subfield></datafield><datafield tag=\"z99\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">hlt</subfield></datafield></record></collection><ns2:MarcXchangeRecordId>1</ns2:MarcXchangeRecordId></ns2:marcXchangeRecord>" +
                    "    <ns2:marcXchangeRecord><collection><record format=\"danMARC2\" type=\"Bibliographic\"><leader>00000n    2200000   4500</leader><datafield tag=\"001\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">737000_test_1</subfield><subfield code=\"b\">737000</subfield><subfield code=\"c\">20151015102339</subfield><subfield code=\"d\">20150923</subfield><subfield code=\"f\">a</subfield></datafield><datafield tag=\"004\" ind1=\"0\" ind2=\"0\"><subfield code=\"r\">n</subfield><subfield code=\"a\">e</subfield></datafield><datafield tag=\"008\" ind1=\"0\" ind2=\"0\"><subfield code=\"t\">m</subfield><subfield code=\"u\">f</subfield><subfield code=\"a\">2015</subfield><subfield code=\"b\">dk</subfield><subfield code=\"d\">m</subfield><subfield code=\"d\">y</subfield><subfield code=\"l\">dan</subfield><subfield code=\"x\">05</subfield><subfield code=\"v\">0</subfield></datafield><datafield tag=\"009\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">a</subfield><subfield code=\"g\">xx</subfield></datafield><datafield tag=\"021\" ind1=\"0\" ind2=\"0\"><subfield code=\"c\">Hf.</subfield></datafield><datafield tag=\"032\" ind1=\"0\" ind2=\"0\"><subfield code=\"x\">ACC201539</subfield><subfield code=\"a\">DBF201544</subfield></datafield><datafield tag=\"041\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">dan</subfield><subfield code=\"d\">eng</subfield></datafield><datafield tag=\"100\" ind1=\"0\" ind2=\"0\"><subfield code=\"0\"></subfield><subfield code=\"a\">Søbjerg Nielsen</subfield><subfield code=\"h\">Susanne</subfield><subfield code=\"4\">aut</subfield></datafield><datafield tag=\"245\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Et ¤skib er ude af drift</subfield><subfield code=\"c\">forsikring og erstatning af ren økonomisk skade</subfield><subfield code=\"c\">et bidrag til \"first party insurance\" som kompensationssystem (et retligt perspektiv)</subfield></datafield><datafield tag=\"260\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Kbh.</subfield><subfield code=\"b\">Det Juridiske Fakultet, Københavns Universitet</subfield><subfield code=\"c\">[2015]</subfield></datafield><datafield tag=\"300\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">212 blade</subfield><subfield code=\"c\">30 cm</subfield></datafield><datafield tag=\"506\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Ph.d.-afhandling</subfield></datafield><datafield tag=\"508\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Med resumé på engelsk</subfield></datafield><datafield tag=\"521\" ind1=\"0\" ind2=\"0\"><subfield code=\"&amp;\">REX</subfield><subfield code=\"b\">1. oplag</subfield><subfield code=\"c\">[2015]</subfield></datafield><datafield tag=\"532\" ind1=\"0\" ind2=\"0\"><subfield code=\"&amp;\">1</subfield><subfield code=\"a\">Med litteraturhenvisninger</subfield></datafield><datafield tag=\"652\" ind1=\"0\" ind2=\"0\"><subfield code=\"m\">34.535</subfield></datafield><datafield tag=\"900\" ind1=\"0\" ind2=\"0\"><subfield code=\"0\"></subfield><subfield code=\"a\">Nielsen</subfield><subfield code=\"h\">Camilla Søbjerg</subfield><subfield code=\"z\">100</subfield></datafield><datafield tag=\"d08\" ind1=\"0\" ind2=\"0\"><subfield code=\"o\">hni</subfield><subfield code=\"o\">hlt</subfield><subfield code=\"k\">jaw</subfield></datafield><datafield tag=\"d09\" ind1=\"0\" ind2=\"0\"><subfield code=\"z\">REX201544</subfield></datafield><datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">20150923</subfield></datafield><datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">20150923</subfield></datafield><datafield tag=\"s10\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">DBC</subfield></datafield><datafield tag=\"s12\" ind1=\"0\" ind2=\"0\"><subfield code=\"t\">TeamMUS201542</subfield></datafield><datafield tag=\"z98\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Minus korrekturprint</subfield></datafield><datafield tag=\"z99\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">hlt</subfield></datafield></record></collection><ns2:MarcXchangeRecordId>2</ns2:MarcXchangeRecordId></ns2:marcXchangeRecord>" +
                    "    <ns2:trackingId>42-0</ns2:trackingId>" +
                    "</ns2:updateMarcXchangeRequest></ns2:updateMarcXchange></S:Body></S:Envelope>";
            responseBody = "<soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"><SOAP-ENV:Header xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\"><X-RequestId xmlns=\"com.dantek.dl.soap\">d22f7a26-7df4-481a-94e7-5bfe0279d94c</X-RequestId></SOAP-ENV:Header><soap:Body>" +
                    "<updateMarcXchangeResponse xmlns=\"http://oss.dbc.dk/ns/updateMarcXchange\">\n" +
                    "    <updateMarcXchangeResult>\n" +
                    "        <updateMarcXchangeStatus>ok</updateMarcXchangeStatus>\n" +
                    "        <updateMarcXchangeMessage>Request received!</updateMarcXchangeMessage>\n" +
                    "        <MarcXchangeRecordId>0</MarcXchangeRecordId>\n" +
                    "    </updateMarcXchangeResult>\n" +
                    "    <updateMarcXchangeResult>\n" +
                    "        <updateMarcXchangeStatus>update_failed_invalid_record</updateMarcXchangeStatus>\n" +
                    "        <updateMarcXchangeMessage>Missing leader</updateMarcXchangeMessage>\n" +
                    "        <MarcXchangeRecordId>1</MarcXchangeRecordId>\n" +
                    "    </updateMarcXchangeResult>\n" +
                    "    <updateMarcXchangeResult>\n" +
                    "        <updateMarcXchangeStatus>ok</updateMarcXchangeStatus>\n" +
                    "        <updateMarcXchangeMessage>Request received!</updateMarcXchangeMessage>\n" +
                    "        <MarcXchangeRecordId>2</MarcXchangeRecordId>\n" +
                    "    </updateMarcXchangeResult>\n" +
                    "</updateMarcXchangeResponse></soap:Body></soap:Envelope>";
        }

        public List<ChunkItem> getChunkItemsForRequest() {
            final List<ChunkItem> chunkItems = new ArrayList<>(3);
            chunkItems.add(new ChunkItem()
                    .withId(0)
                    .withData(MARCXCHANGE_710100_OK)
                    .withStatus(ChunkItem.Status.SUCCESS));
            chunkItems.add(new ChunkItem()
                    .withId(1)
                    .withData(MARCXCHANGE_710100_FAIL)
                    .withStatus(ChunkItem.Status.SUCCESS));
            chunkItems.add(new ChunkItem()
                    .withId(2)
                    .withData(MARCXCHANGE_737000_OK)
                    .withStatus(ChunkItem.Status.SUCCESS));
            return chunkItems;
        }
    }

    public static class MarcXchangeRecordsTwoOkOneInvalid extends ImsServiceRequestResponse {
        public MarcXchangeRecordsTwoOkOneInvalid() {
            requestBody = "<?xml version=\"1.0\" ?><S:Envelope xmlns:S=\"http://schemas.xmlsoap.org/soap/envelope/\"><S:Body><ns2:updateMarcXchange xmlns:ns2=\"http://oss.dbc.dk/ns/updateMarcXchange\" xmlns=\"info:lc/xmlns/marcxchange-v1\">" +
                    "<ns2:updateMarcXchangeRequest>" +
                    "    <ns2:marcXchangeRecord><collection><record format=\"danMARC2\" type=\"Bibliographic\"><leader>00000n    2200000   4500</leader><datafield tag=\"001\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">710100_test_1</subfield><subfield code=\"b\">710100</subfield><subfield code=\"c\">20151015102339</subfield><subfield code=\"d\">20150923</subfield><subfield code=\"f\">a</subfield></datafield><datafield tag=\"004\" ind1=\"0\" ind2=\"0\"><subfield code=\"r\">n</subfield><subfield code=\"a\">e</subfield></datafield><datafield tag=\"008\" ind1=\"0\" ind2=\"0\"><subfield code=\"t\">m</subfield><subfield code=\"u\">f</subfield><subfield code=\"a\">2015</subfield><subfield code=\"b\">dk</subfield><subfield code=\"d\">m</subfield><subfield code=\"d\">y</subfield><subfield code=\"l\">dan</subfield><subfield code=\"x\">05</subfield><subfield code=\"v\">0</subfield></datafield><datafield tag=\"009\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">a</subfield><subfield code=\"g\">xx</subfield></datafield><datafield tag=\"021\" ind1=\"0\" ind2=\"0\"><subfield code=\"c\">Hf.</subfield></datafield><datafield tag=\"032\" ind1=\"0\" ind2=\"0\"><subfield code=\"x\">ACC201539</subfield><subfield code=\"a\">DBF201544</subfield></datafield><datafield tag=\"041\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">dan</subfield><subfield code=\"d\">eng</subfield></datafield><datafield tag=\"100\" ind1=\"0\" ind2=\"0\"><subfield code=\"0\"></subfield><subfield code=\"a\">Søbjerg Nielsen</subfield><subfield code=\"h\">Susanne</subfield><subfield code=\"4\">aut</subfield></datafield><datafield tag=\"245\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Et ¤skib er ude af drift</subfield><subfield code=\"c\">forsikring og erstatning af ren økonomisk skade</subfield><subfield code=\"c\">et bidrag til \"first party insurance\" som kompensationssystem (et retligt perspektiv)</subfield></datafield><datafield tag=\"260\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Kbh.</subfield><subfield code=\"b\">Det Juridiske Fakultet, Københavns Universitet</subfield><subfield code=\"c\">[2015]</subfield></datafield><datafield tag=\"300\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">212 blade</subfield><subfield code=\"c\">30 cm</subfield></datafield><datafield tag=\"506\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Ph.d.-afhandling</subfield></datafield><datafield tag=\"508\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Med resumé på engelsk</subfield></datafield><datafield tag=\"521\" ind1=\"0\" ind2=\"0\"><subfield code=\"&amp;\">REX</subfield><subfield code=\"b\">1. oplag</subfield><subfield code=\"c\">[2015]</subfield></datafield><datafield tag=\"532\" ind1=\"0\" ind2=\"0\"><subfield code=\"&amp;\">1</subfield><subfield code=\"a\">Med litteraturhenvisninger</subfield></datafield><datafield tag=\"652\" ind1=\"0\" ind2=\"0\"><subfield code=\"m\">34.535</subfield></datafield><datafield tag=\"900\" ind1=\"0\" ind2=\"0\"><subfield code=\"0\"></subfield><subfield code=\"a\">Nielsen</subfield><subfield code=\"h\">Camilla Søbjerg</subfield><subfield code=\"z\">100</subfield></datafield><datafield tag=\"d08\" ind1=\"0\" ind2=\"0\"><subfield code=\"o\">hni</subfield><subfield code=\"o\">hlt</subfield><subfield code=\"k\">jaw</subfield></datafield><datafield tag=\"d09\" ind1=\"0\" ind2=\"0\"><subfield code=\"z\">REX201544</subfield></datafield><datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">20150923</subfield></datafield><datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">20150923</subfield></datafield><datafield tag=\"s10\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">DBC</subfield></datafield><datafield tag=\"s12\" ind1=\"0\" ind2=\"0\"><subfield code=\"t\">TeamMUS201542</subfield></datafield><datafield tag=\"z98\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Minus korrekturprint</subfield></datafield><datafield tag=\"z99\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">hlt</subfield></datafield></record></collection><ns2:MarcXchangeRecordId>0</ns2:MarcXchangeRecordId></ns2:marcXchangeRecord>" +
                    "    <ns2:marcXchangeRecord><collection><record format=\"danMARC2\" type=\"Bibliographic\"><datafield tag=\"001\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">710100_test_2</subfield><subfield code=\"b\">710100</subfield><subfield code=\"c\">20151015102339</subfield><subfield code=\"d\">20150923</subfield><subfield code=\"f\">a</subfield></datafield><datafield tag=\"004\" ind1=\"0\" ind2=\"0\"><subfield code=\"r\">n</subfield><subfield code=\"a\">e</subfield></datafield><datafield tag=\"008\" ind1=\"0\" ind2=\"0\"><subfield code=\"t\">m</subfield><subfield code=\"u\">f</subfield><subfield code=\"a\">2015</subfield><subfield code=\"b\">dk</subfield><subfield code=\"d\">m</subfield><subfield code=\"d\">y</subfield><subfield code=\"l\">dan</subfield><subfield code=\"x\">05</subfield><subfield code=\"v\">0</subfield></datafield><datafield tag=\"009\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">a</subfield><subfield code=\"g\">xx</subfield></datafield><datafield tag=\"021\" ind1=\"0\" ind2=\"0\"><subfield code=\"c\">Hf.</subfield></datafield><datafield tag=\"032\" ind1=\"0\" ind2=\"0\"><subfield code=\"x\">ACC201539</subfield><subfield code=\"a\">DBF201544</subfield></datafield><datafield tag=\"041\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">dan</subfield><subfield code=\"d\">eng</subfield></datafield><datafield tag=\"100\" ind1=\"0\" ind2=\"0\"><subfield code=\"0\"></subfield><subfield code=\"a\">Søbjerg Nielsen</subfield><subfield code=\"h\">Susanne</subfield><subfield code=\"4\">aut</subfield></datafield><datafield tag=\"245\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Et ¤skib er ude af drift</subfield><subfield code=\"c\">forsikring og erstatning af ren økonomisk skade</subfield><subfield code=\"c\">et bidrag til \"first party insurance\" som kompensationssystem (et retligt perspektiv)</subfield></datafield><datafield tag=\"260\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Kbh.</subfield><subfield code=\"b\">Det Juridiske Fakultet, Københavns Universitet</subfield><subfield code=\"c\">[2015]</subfield></datafield><datafield tag=\"300\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">212 blade</subfield><subfield code=\"c\">30 cm</subfield></datafield><datafield tag=\"506\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Ph.d.-afhandling</subfield></datafield><datafield tag=\"508\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Med resumé på engelsk</subfield></datafield><datafield tag=\"521\" ind1=\"0\" ind2=\"0\"><subfield code=\"&amp;\">REX</subfield><subfield code=\"b\">1. oplag</subfield><subfield code=\"c\">[2015]</subfield></datafield><datafield tag=\"532\" ind1=\"0\" ind2=\"0\"><subfield code=\"&amp;\">1</subfield><subfield code=\"a\">Med litteraturhenvisninger</subfield></datafield><datafield tag=\"652\" ind1=\"0\" ind2=\"0\"><subfield code=\"m\">34.535</subfield></datafield><datafield tag=\"900\" ind1=\"0\" ind2=\"0\"><subfield code=\"0\"></subfield><subfield code=\"a\">Nielsen</subfield><subfield code=\"h\">Camilla Søbjerg</subfield><subfield code=\"z\">100</subfield></datafield><datafield tag=\"d08\" ind1=\"0\" ind2=\"0\"><subfield code=\"o\">hni</subfield><subfield code=\"o\">hlt</subfield><subfield code=\"k\">jaw</subfield></datafield><datafield tag=\"d09\" ind1=\"0\" ind2=\"0\"><subfield code=\"z\">REX201544</subfield></datafield><datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">20150923</subfield></datafield><datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">20150923</subfield></datafield><datafield tag=\"s10\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">DBC</subfield></datafield><datafield tag=\"s12\" ind1=\"0\" ind2=\"0\"><subfield code=\"t\">TeamMUS201542</subfield></datafield><datafield tag=\"z98\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Minus korrekturprint</subfield></datafield><datafield tag=\"z99\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">hlt</subfield></datafield></record></collection><ns2:MarcXchangeRecordId>1</ns2:MarcXchangeRecordId></ns2:marcXchangeRecord>" +
                    "    <ns2:marcXchangeRecord><collection><record format=\"danMARC2\" type=\"Bibliographic\"><leader>00000n    2200000   4500</leader><datafield tag=\"001\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">737000_test_1</subfield><subfield code=\"b\">737000</subfield><subfield code=\"c\">20151015102339</subfield><subfield code=\"d\">20150923</subfield><subfield code=\"f\">a</subfield></datafield><datafield tag=\"004\" ind1=\"0\" ind2=\"0\"><subfield code=\"r\">n</subfield><subfield code=\"a\">e</subfield></datafield><datafield tag=\"008\" ind1=\"0\" ind2=\"0\"><subfield code=\"t\">m</subfield><subfield code=\"u\">f</subfield><subfield code=\"a\">2015</subfield><subfield code=\"b\">dk</subfield><subfield code=\"d\">m</subfield><subfield code=\"d\">y</subfield><subfield code=\"l\">dan</subfield><subfield code=\"x\">05</subfield><subfield code=\"v\">0</subfield></datafield><datafield tag=\"009\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">a</subfield><subfield code=\"g\">xx</subfield></datafield><datafield tag=\"021\" ind1=\"0\" ind2=\"0\"><subfield code=\"c\">Hf.</subfield></datafield><datafield tag=\"032\" ind1=\"0\" ind2=\"0\"><subfield code=\"x\">ACC201539</subfield><subfield code=\"a\">DBF201544</subfield></datafield><datafield tag=\"041\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">dan</subfield><subfield code=\"d\">eng</subfield></datafield><datafield tag=\"100\" ind1=\"0\" ind2=\"0\"><subfield code=\"0\"></subfield><subfield code=\"a\">Søbjerg Nielsen</subfield><subfield code=\"h\">Susanne</subfield><subfield code=\"4\">aut</subfield></datafield><datafield tag=\"245\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Et ¤skib er ude af drift</subfield><subfield code=\"c\">forsikring og erstatning af ren økonomisk skade</subfield><subfield code=\"c\">et bidrag til \"first party insurance\" som kompensationssystem (et retligt perspektiv)</subfield></datafield><datafield tag=\"260\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Kbh.</subfield><subfield code=\"b\">Det Juridiske Fakultet, Københavns Universitet</subfield><subfield code=\"c\">[2015]</subfield></datafield><datafield tag=\"300\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">212 blade</subfield><subfield code=\"c\">30 cm</subfield></datafield><datafield tag=\"506\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Ph.d.-afhandling</subfield></datafield><datafield tag=\"508\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Med resumé på engelsk</subfield></datafield><datafield tag=\"521\" ind1=\"0\" ind2=\"0\"><subfield code=\"&amp;\">REX</subfield><subfield code=\"b\">1. oplag</subfield><subfield code=\"c\">[2015]</subfield></datafield><datafield tag=\"532\" ind1=\"0\" ind2=\"0\"><subfield code=\"&amp;\">1</subfield><subfield code=\"a\">Med litteraturhenvisninger</subfield></datafield><datafield tag=\"652\" ind1=\"0\" ind2=\"0\"><subfield code=\"m\">34.535</subfield></datafield><datafield tag=\"900\" ind1=\"0\" ind2=\"0\"><subfield code=\"0\"></subfield><subfield code=\"a\">Nielsen</subfield><subfield code=\"h\">Camilla Søbjerg</subfield><subfield code=\"z\">100</subfield></datafield><datafield tag=\"d08\" ind1=\"0\" ind2=\"0\"><subfield code=\"o\">hni</subfield><subfield code=\"o\">hlt</subfield><subfield code=\"k\">jaw</subfield></datafield><datafield tag=\"d09\" ind1=\"0\" ind2=\"0\"><subfield code=\"z\">REX201544</subfield></datafield><datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">20150923</subfield></datafield><datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">20150923</subfield></datafield><datafield tag=\"s10\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">DBC</subfield></datafield><datafield tag=\"s12\" ind1=\"0\" ind2=\"0\"><subfield code=\"t\">TeamMUS201542</subfield></datafield><datafield tag=\"z98\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Minus korrekturprint</subfield></datafield><datafield tag=\"z99\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">hlt</subfield></datafield></record></collection><ns2:MarcXchangeRecordId>2</ns2:MarcXchangeRecordId></ns2:marcXchangeRecord>" +
                    "    <ns2:trackingId>42-0</ns2:trackingId>" +
                    "</ns2:updateMarcXchangeRequest></ns2:updateMarcXchange></S:Body></S:Envelope>";
            responseBody = "<soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"><SOAP-ENV:Header xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\"><X-RequestId xmlns=\"com.dantek.dl.soap\">7fe90f7a-34c9-4cb2-b134-8beed9171195</X-RequestId></SOAP-ENV:Header><soap:Body><updateMarcXchangeResponse xmlns=\"http://oss.dbc.dk/ns/updateMarcXchange\">\n" +
                    "    <updateMarcXchangeResult>\n" +
                    "        <updateMarcXchangeStatus>update_failed_invalid_record</updateMarcXchangeStatus>\n" +
                    "        <updateMarcXchangeMessage>cvc-complex-type.2.4.a: Invalid content was found starting with element 'datafield'. One of '{\"info:lc/xmlns/marcxchange-v1\":leader}' is expected.</updateMarcXchangeMessage>\n" +
                    "    </updateMarcXchangeResult>\n" +
                    "</updateMarcXchangeResponse></soap:Body></soap:Envelope>";
        }

        public List<ChunkItem> getChunkItemsForRequest() {
            final List<ChunkItem> chunkItems = new ArrayList<>(3);
            chunkItems.add(new ChunkItem()
                    .withId(0)
                    .withData(MARCXCHANGE_710100_OK)
                    .withStatus(ChunkItem.Status.SUCCESS));
            chunkItems.add(new ChunkItem()
                    .withId(1)
                    .withData(MARCXCHANGE_710100_FAIL)
                    .withStatus(ChunkItem.Status.SUCCESS));
            chunkItems.add(new ChunkItem()
                    .withId(2)
                    .withData(MARCXCHANGE_737000_OK)
                    .withStatus(ChunkItem.Status.SUCCESS));
            return chunkItems;
        }
    }

    public static class UpdateMarcXchangeResponsHasInsufficientRecords extends ImsServiceRequestResponse {
        public UpdateMarcXchangeResponsHasInsufficientRecords() {
            requestBody = "<?xml version=\"1.0\" ?><S:Envelope xmlns:S=\"http://schemas.xmlsoap.org/soap/envelope/\"><S:Body><ns2:updateMarcXchange xmlns:ns2=\"http://oss.dbc.dk/ns/updateMarcXchange\" xmlns=\"info:lc/xmlns/marcxchange-v1\">" +
                    "<ns2:updateMarcXchangeRequest>" +
                    "    <ns2:marcXchangeRecord><collection><record format=\"danMARC2\" type=\"Bibliographic\"><leader>00000n    2200000   4500</leader><datafield tag=\"001\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">710100_test_1</subfield><subfield code=\"b\">710100</subfield><subfield code=\"c\">20151015102339</subfield><subfield code=\"d\">20150923</subfield><subfield code=\"f\">a</subfield></datafield><datafield tag=\"004\" ind1=\"0\" ind2=\"0\"><subfield code=\"r\">n</subfield><subfield code=\"a\">e</subfield></datafield><datafield tag=\"008\" ind1=\"0\" ind2=\"0\"><subfield code=\"t\">m</subfield><subfield code=\"u\">f</subfield><subfield code=\"a\">2015</subfield><subfield code=\"b\">dk</subfield><subfield code=\"d\">m</subfield><subfield code=\"d\">y</subfield><subfield code=\"l\">dan</subfield><subfield code=\"x\">05</subfield><subfield code=\"v\">0</subfield></datafield><datafield tag=\"009\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">a</subfield><subfield code=\"g\">xx</subfield></datafield><datafield tag=\"021\" ind1=\"0\" ind2=\"0\"><subfield code=\"c\">Hf.</subfield></datafield><datafield tag=\"032\" ind1=\"0\" ind2=\"0\"><subfield code=\"x\">ACC201539</subfield><subfield code=\"a\">DBF201544</subfield></datafield><datafield tag=\"041\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">dan</subfield><subfield code=\"d\">eng</subfield></datafield><datafield tag=\"100\" ind1=\"0\" ind2=\"0\"><subfield code=\"0\"></subfield><subfield code=\"a\">Søbjerg Nielsen</subfield><subfield code=\"h\">Susanne</subfield><subfield code=\"4\">aut</subfield></datafield><datafield tag=\"245\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Et ¤skib er ude af drift</subfield><subfield code=\"c\">forsikring og erstatning af ren økonomisk skade</subfield><subfield code=\"c\">et bidrag til \"first party insurance\" som kompensationssystem (et retligt perspektiv)</subfield></datafield><datafield tag=\"260\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Kbh.</subfield><subfield code=\"b\">Det Juridiske Fakultet, Københavns Universitet</subfield><subfield code=\"c\">[2015]</subfield></datafield><datafield tag=\"300\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">212 blade</subfield><subfield code=\"c\">30 cm</subfield></datafield><datafield tag=\"506\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Ph.d.-afhandling</subfield></datafield><datafield tag=\"508\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Med resumé på engelsk</subfield></datafield><datafield tag=\"521\" ind1=\"0\" ind2=\"0\"><subfield code=\"&amp;\">REX</subfield><subfield code=\"b\">1. oplag</subfield><subfield code=\"c\">[2015]</subfield></datafield><datafield tag=\"532\" ind1=\"0\" ind2=\"0\"><subfield code=\"&amp;\">1</subfield><subfield code=\"a\">Med litteraturhenvisninger</subfield></datafield><datafield tag=\"652\" ind1=\"0\" ind2=\"0\"><subfield code=\"m\">34.535</subfield></datafield><datafield tag=\"900\" ind1=\"0\" ind2=\"0\"><subfield code=\"0\"></subfield><subfield code=\"a\">Nielsen</subfield><subfield code=\"h\">Camilla Søbjerg</subfield><subfield code=\"z\">100</subfield></datafield><datafield tag=\"d08\" ind1=\"0\" ind2=\"0\"><subfield code=\"o\">hni</subfield><subfield code=\"o\">hlt</subfield><subfield code=\"k\">jaw</subfield></datafield><datafield tag=\"d09\" ind1=\"0\" ind2=\"0\"><subfield code=\"z\">REX201544</subfield></datafield><datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">20150923</subfield></datafield><datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">20150923</subfield></datafield><datafield tag=\"s10\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">DBC</subfield></datafield><datafield tag=\"s12\" ind1=\"0\" ind2=\"0\"><subfield code=\"t\">TeamMUS201542</subfield></datafield><datafield tag=\"z98\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Minus korrekturprint</subfield></datafield><datafield tag=\"z99\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">hlt</subfield></datafield></record></collection><ns2:MarcXchangeRecordId>0</ns2:MarcXchangeRecordId></ns2:marcXchangeRecord>" +
                    "    <ns2:marcXchangeRecord><collection><record format=\"danMARC2\" type=\"Bibliographic\"><leader>00000n    2200000   4500</leader><datafield tag=\"001\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">737000_test_1</subfield><subfield code=\"b\">737000</subfield><subfield code=\"c\">20151015102339</subfield><subfield code=\"d\">20150923</subfield><subfield code=\"f\">a</subfield></datafield><datafield tag=\"004\" ind1=\"0\" ind2=\"0\"><subfield code=\"r\">n</subfield><subfield code=\"a\">e</subfield></datafield><datafield tag=\"008\" ind1=\"0\" ind2=\"0\"><subfield code=\"t\">m</subfield><subfield code=\"u\">f</subfield><subfield code=\"a\">2015</subfield><subfield code=\"b\">dk</subfield><subfield code=\"d\">m</subfield><subfield code=\"d\">y</subfield><subfield code=\"l\">dan</subfield><subfield code=\"x\">05</subfield><subfield code=\"v\">0</subfield></datafield><datafield tag=\"009\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">a</subfield><subfield code=\"g\">xx</subfield></datafield><datafield tag=\"021\" ind1=\"0\" ind2=\"0\"><subfield code=\"c\">Hf.</subfield></datafield><datafield tag=\"032\" ind1=\"0\" ind2=\"0\"><subfield code=\"x\">ACC201539</subfield><subfield code=\"a\">DBF201544</subfield></datafield><datafield tag=\"041\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">dan</subfield><subfield code=\"d\">eng</subfield></datafield><datafield tag=\"100\" ind1=\"0\" ind2=\"0\"><subfield code=\"0\"></subfield><subfield code=\"a\">Søbjerg Nielsen</subfield><subfield code=\"h\">Susanne</subfield><subfield code=\"4\">aut</subfield></datafield><datafield tag=\"245\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Et ¤skib er ude af drift</subfield><subfield code=\"c\">forsikring og erstatning af ren økonomisk skade</subfield><subfield code=\"c\">et bidrag til \"first party insurance\" som kompensationssystem (et retligt perspektiv)</subfield></datafield><datafield tag=\"260\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Kbh.</subfield><subfield code=\"b\">Det Juridiske Fakultet, Københavns Universitet</subfield><subfield code=\"c\">[2015]</subfield></datafield><datafield tag=\"300\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">212 blade</subfield><subfield code=\"c\">30 cm</subfield></datafield><datafield tag=\"506\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Ph.d.-afhandling</subfield></datafield><datafield tag=\"508\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Med resumé på engelsk</subfield></datafield><datafield tag=\"521\" ind1=\"0\" ind2=\"0\"><subfield code=\"&amp;\">REX</subfield><subfield code=\"b\">1. oplag</subfield><subfield code=\"c\">[2015]</subfield></datafield><datafield tag=\"532\" ind1=\"0\" ind2=\"0\"><subfield code=\"&amp;\">1</subfield><subfield code=\"a\">Med litteraturhenvisninger</subfield></datafield><datafield tag=\"652\" ind1=\"0\" ind2=\"0\"><subfield code=\"m\">34.535</subfield></datafield><datafield tag=\"900\" ind1=\"0\" ind2=\"0\"><subfield code=\"0\"></subfield><subfield code=\"a\">Nielsen</subfield><subfield code=\"h\">Camilla Søbjerg</subfield><subfield code=\"z\">100</subfield></datafield><datafield tag=\"d08\" ind1=\"0\" ind2=\"0\"><subfield code=\"o\">hni</subfield><subfield code=\"o\">hlt</subfield><subfield code=\"k\">jaw</subfield></datafield><datafield tag=\"d09\" ind1=\"0\" ind2=\"0\"><subfield code=\"z\">REX201544</subfield></datafield><datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">20150923</subfield></datafield><datafield tag=\"n55\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">20150923</subfield></datafield><datafield tag=\"s10\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">DBC</subfield></datafield><datafield tag=\"s12\" ind1=\"0\" ind2=\"0\"><subfield code=\"t\">TeamMUS201542</subfield></datafield><datafield tag=\"z98\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">Minus korrekturprint</subfield></datafield><datafield tag=\"z99\" ind1=\"0\" ind2=\"0\"><subfield code=\"a\">hlt</subfield></datafield></record></collection><ns2:MarcXchangeRecordId>2</ns2:MarcXchangeRecordId></ns2:marcXchangeRecord>" +
                    "    <ns2:trackingId>42-0</ns2:trackingId>" +
                    "</ns2:updateMarcXchangeRequest></ns2:updateMarcXchange></S:Body></S:Envelope>";
            responseBody = "<soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"><SOAP-ENV:Header xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\"><X-RequestId xmlns=\"com.dantek.dl.soap\">d22f7a26-7df4-481a-94e7-5bfe0279d94c</X-RequestId></SOAP-ENV:Header><soap:Body>" +
                    "<updateMarcXchangeResponse xmlns=\"http://oss.dbc.dk/ns/updateMarcXchange\">\n" +
                    "    <updateMarcXchangeResult>\n" +
                    "        <updateMarcXchangeStatus>ok</updateMarcXchangeStatus>\n" +
                    "        <updateMarcXchangeMessage>Request received!</updateMarcXchangeMessage>\n" +
                    "        <MarcXchangeRecordId>0</MarcXchangeRecordId>\n" +
                    "    </updateMarcXchangeResult>\n" +
                    "</updateMarcXchangeResponse></soap:Body></soap:Envelope>";
        }

        public List<ChunkItem> getChunkItemsForRequest() {
            final List<ChunkItem> chunkItems = new ArrayList<>(3);
            chunkItems.add(new ChunkItem()
                    .withId(0)
                    .withData(MARCXCHANGE_710100_OK)
                    .withStatus(ChunkItem.Status.SUCCESS));
            chunkItems.add(new ChunkItem()
                    .withId(2)
                    .withData(MARCXCHANGE_737000_OK)
                    .withStatus(ChunkItem.Status.SUCCESS));
            return chunkItems;
        }
    }

    private String getWireMockEndpoint() {
        return String.format("http://localhost:%d/", wireMockRule.port());
    }
}
