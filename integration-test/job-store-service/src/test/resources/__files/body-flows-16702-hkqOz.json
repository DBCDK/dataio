{"id":16702,"version":1,"content":{"name": "RR2Dst", "components": [{"id": 16701, "next": {"name": "RR2Dst", "description": "Flow for poster fra RR til Danmarks Statistik (dst)- poster udleveres i csv-format (string)", "javascripts": [{"javascript": "dXNlKCAiTG9nIiApOw0KdXNlKCAiQWRtaW5EYXRhIiApOw0KdXNlKCAiWG1sVXRpbCIgKTsNCnVzZSggIk1hcmNYY2hhbmdlVXRpbCIgKTsNCnVzZSggIk1hcmNYY2hhbmdlIiApOw0KdXNlKCAiRG0yVG9Ec3QiICk7DQp1c2UoICJEYW5NYXJjMlV0aWwiICk7DQoNCi8qKg0KICogRW50cnkgcG9pbnQgZm9yIGNvbnZlcnRpbmcgYSBtYXJjIHJlY29yZCBjb2xsZWN0aW9uIGluIG1hcmNYY2hhbmdlIGZyb20gUmF3UmVjb3JkUmVwbyB0byBjc3YgZ29pbmcgdG8gRFNUDQogKg0KICogQHR5cGUge2Z1bmN0aW9ufQ0KICogQHN5bnRheCBjb252ZXJ0UmF3UmVjb3JkVG9Ec3QoIHhtbENvbGxlY3Rpb24sIHN1cHBEYXRhICkNCiAqIEBwYXJhbSB7U3RyaW5nfSB4bWxDb2xsZWN0aW9uIEEgY29sbGVjdGlvbiB3aXRoIG9uZSBvciBtb3JlIG1hcmMgcmVjb3JkcyBpbiBNYXJjWGNoYW5nZSBmb3JtYXQgZnJvbSBSUiBhcyBhIHN0cmluZw0KICogQHBhcmFtIHtPYmplY3R9IHN1cHBEYXRhIEEgSlNPTiBvYmplY3Qgd2l0aCBpbmZvcm1hdGlvbiBhYm91dCBzdWJtaXR0ZXIgYW5kIGZvcm1hdCBhbmQgY3JlYXRpb24gZGF0ZQ0KICogQHJldHVybiB7U3RyaW5nfSBUaGUgcmVjb3JkIGNvbnZlcnRlZCB0byBjc3YtZm9ybWF0IGZvciBEU1QNCiAqIEBleGFtcGxlDQogY29udmVydFJhd1JlY29yZFRvRHN0KA0KICI8bWFyY3g6Y29sbGVjdGlvbiB4bWxuczptYXJjeD0iaW5mbzpsYy94bWxucy9tYXJjeGNoYW5nZS12MSI+DQogPG1hcmN4OnJlY29yZCBmb3JtYXQ9ImRhbk1BUkMyIiB0eXBlPSJCaWJsaW9ncmFwaGljIj4NCiA8bWFyY3g6bGVhZGVyPjAwMDAwbiAgICAyMjAwMDAwICAgNDUwMDwvbWFyY3g6bGVhZGVyPg0KIDxtYXJjeDpkYXRhZmllbGQgaW5kMT0iMCIgaW5kMj0iMCIgdGFnPSIwMDEiPg0KIDxtYXJjeDpzdWJmaWVsZCBjb2RlPSJhIj40MTczMTkwNzwvbWFyY3g6c3ViZmllbGQ+DQogPC9tYXJjeDpkYXRhZmllbGQ+DQogPC9tYXJjeDpyZWNvcmQ+DQogPC9tYXJjeDpjb2xsZWN0aW9uPiIsDQogeyAic3VibWl0dGVyIiA6ICI4NzA5NzAiLCAiZm9ybWF0IiA6ICJkc3QiICwgY3JlYXRpb25EYXRlOiAiMjAwNTAzMDEifQ0KICkNCg0KICogQG5hbWUgY29udmVydFJhd1JlY29yZFRvRHN0DQogKiovDQoNCg0KZnVuY3Rpb24gY29udmVydFJhd1JlY29yZFRvRHN0KCB4bWxDb2xsZWN0aW9uLCBzdXBwRGF0YSApIHsNCg0KICAgIExvZy5pbmZvKCAiRW50ZXJpbmc6IGNvbnZlcnRSYXdSZWNvcmRUb0RzdCBmdW5jdGlvbiIgKTsNCg0KICAgIHZhciBjc3YgPSBEbTJUb0RzdC5jcmVhdGVDc3ZGb3JEc3QoIHhtbENvbGxlY3Rpb24gKTsNCg0KICAgIExvZy5pbmZvKCAiTGVhdmluZzogY29udmVydFJhd1JlY29yZFRvRHN0IGZ1bmN0aW9uIiApOw0KDQogICAgcmV0dXJuIGNzdjsNCg0KfQ0KDQovLyBBZGRpdGlvbmFsIHRlc3QgZW50cnkgZnVuY3Rpb24NCmZ1bmN0aW9uIHRlc3RDb252ZXJ0UmVjb3JkcyggKSB7DQogICAgdXNlKCJUZXN0Q29udmVydFJlY29yZHNIZWxwZXJzIik7DQogICAgLy8gcGFzcyAgd29ya2VyIGZ1bmN0aW9uIHRvIHRlc3RDb252ZXJ0SnNvbmNzdlJlY29yZA0KICAgIFRlc3RDb252ZXJ0UmVjb3Jkc0hlbHBlcnMudGVzdENvbnZlcnRKc29uQWRkaVJlY29yZCggY29udmVydFJhd1JlY29yZFRvRHN0ICk7DQp9DQoNCmZ1bmN0aW9uIGxvY2FsQWNjdGVzdFJ1bm5lciggYWRkaVJlY29yZCApIHsNCiAgICAvLyBjcmVhdGUgYWRkaVJlYWRlciBhbmQgcGFzcyBpdCB0byByZWFkQWRkaSB0aGF0IHdpbGwgcHJvY2VzcyBpdCB3aXRoIHRoZSBtYWluIHdvcmtlciBmdW5jdGlvbg0KICAgIHVzZSggIkFkZGkiICk7DQogICAgdXNlKCJUZXN0Q29udmVydFJlY29yZHNIZWxwZXJzIik7DQoNCiAgICB2YXIgYWRkaUZpbGVSZWFkZXIgPSBBZGRpLmNyZWF0ZUFkZGlTdHJpbmdSZWFkZXIoIGFkZGlSZWNvcmQgKTsNCg0KICAgIHJldHVybiBUZXN0Q29udmVydFJlY29yZHNIZWxwZXJzLnJlYWRBZGRpKCBhZGRpRmlsZVJlYWRlciwgY29udmVydFJhd1JlY29yZFRvRHN0ICk7DQp9IA0K", "moduleName": ""}, {"javascript": "LyoqIEBmaWxlIE1vZHVsZXNJbmZvIG1vZHVsZS4gR2V0IGluZm9ybWF0aW9uIGFib3V0IGxvYWRlZCBtb2R1bGVzICovCgovLyBXQVJOSU5HOiBJZiB5b3UgYnJlYWsgdGhpcyBmaWxlLCB0aGUgbW9kdWxlIHN5c3RlbSB3aWxsIHN0b3Agd29ya2luZyEgCgovLyBqc2xpYiBkZXBlbmRzIG9uIGFuZCBsb2FkcyB0aGlzIG1vZHVsZS4KLy8gVGhlIGJpbmFyeSB1c2VzIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb25zOgovLyAKLy8gX19Nb2R1bGVzSW5mby5jaGVja0RlcEFscmVhZHlMb2FkZWQKLy8gX19Nb2R1bGVzSW5mby5hZGRQdXNoTW9kdWxlCi8vIF9fTW9kdWxlc0luZm8ucG9wTW9kdWxlTG9hZFN0YWNrCi8vIF9fTW9kdWxlc0luZm8ucmVtb3ZlTW9kdWxlCi8vCi8vIEl0IGlzIGFsc28gdXNlZCBpbmRpcmVjdGx5IGJ5IFVzZS51c2UuanMKLy8gCgovLyBWYXJpb3VzIGZpbGVzIGluIHNjcmlwdHMvKi51c2UuanMgZGVwZW5kcyBvbiB0aGUgaW50ZXJmYWNlIGluIHRoaXMgZmlsZS4KCi8vIE5vdGUsIGZvciB2YXJpb3VzIG1vcmUgb3IgbGVzcyBvYnZpb3VzIHJlYXNvbnMsIHlvdSBjYW4gKm5vdCogdXNlIGFueSBvdGhlciBtb2R1bGVzCi8vIGZyb20gdGhpcyBmaWxlLiBNa2F5PwoKLy8gVGhpcyBpcyBub3QgbWVhbnQgdG8gYmUgZXh0ZXJuYWxseSBleHBvc2VkLgp2YXIgX19Nb2R1bGVzSW5mbyA9IGZ1bmN0aW9uKCApIHsKICAgIHZhciB0aGF0ID0ge307CgogICAgLy8gSGFzaCBmcm9tIG1vZHVsZU5hbWUgdG8gbW9kdWxlSW5mbzogbmFtZSwgdXJsLCBzeW1ib2xzLCBwb3NzaWJseSBvdGhlcnMgYXQgYSBsYXRlciB0aW1lLgogICAgdmFyIF9fbW9kdWxlcyA9IHt9OwoKICAgIC8vIFN0YWNrIG9mIG1vZHVsZXMgdGhhdCBhcmUgY3VycmVudGx5IGJlZWluZyBsb2FkZWQKICAgIHZhciBfX21vZHVsZUxvYWRTdGFjayA9IFsgXTsKCiAgICAvLyBDb3B5IG9mIHNlYXJjaFBhdGhzIGFzIHRoZXkgbG9va2VkLCB3aGVuIHRoZSBNb2R1bGVzSW5mbyBtb2R1bGUgd2FzIGxvYWRlZCwgYnkgdGhlIHVzZSBzeXN0ZW0uCiAgICB2YXIgX19zZWFyY2hQYXRocyA9IFsgXTsKICAgIAogICAgdGhhdC5hZGRTZWFyY2hQYXRoID0gZnVuY3Rpb24oIHBhdGggKSB7CiAgICAgICAgX19zZWFyY2hQYXRocy5wdXNoKCBwYXRoICk7CiAgICB9OwogICAgCiAgICAvLyBSZXR1cm4gcmVmZXJlbmNlIHRvIHRoZSBzZWFyY2hwYXRocyBpbiB1c2Ugd2hlbiB0aGUgbW9kdWxlc0luZm8gbW9kdWxlIHdhcyBsb2FkZWQuCiAgICAvLyBBIGNvcHkgaXMgcmV0dXJuZWQuCiAgICB0aGF0LmdldFNlYXJjaFBhdGhzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIF9fc2VhcmNoUGF0aHMuc2xpY2UoMCk7CiAgICB9CiAgICAKICAgIC8qIERlYnVnIGZ1bmN0aW9uCiAgICB0aGF0LnByaW50X2J1ZmZlciA9ICIiOwogICAgdmFyIG15cHJpbnQgPSBmdW5jdGlvbigpIHsKICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyArK2kgKSB7CiAgICAgICAgICAgIHRoYXQucHJpbnRfYnVmZmVyICs9IGFyZ3VtZW50c1tpXTsKICAgICAgICB9CiAgICB9CiovCiAgICAvLyBUaGlzIGZ1bmN0aW9uIGRvZXMgdHdvIHRoaW5ncy4gRmlyc3QgaXQgY2hlY2tzIGlmIHdlIGFyZSBjdXJyZW50bHkgbG9hZGluZyBhIG1vZHVsZS4KICAgIC8vIElmIHRoYXQgaXMgdGhlIGNhc2UsIHRoZW4gaXQgYXNzdW1lcyB0aGF0IHRoZSBtb2R1bGUgbmVlZCB0byB1c2UgdGhlIG1vZHVsZU5hbWUsIGFuZCBhZGRzIGl0CiAgICAvLyB0byB0aGUgbGlzdCBvZiB1c2VzIGZvciB0aGUgY3VycmVudGx5IGxvYWRpbmcgbW9kdWxlLgogICAgLy8gU2Vjb25kbHksIGl0IGNoZWNrcyBpZiB0aGUgbW9kdWxlIGhhcyBhbHJlYWR5IGJlZW4gbG9hZGVkIGFuZCByZXR1cm5zIHRydWUgb2YgZmFsc2UKICAgIC8vISBcdG9kbyBUaGlzIGlzIGFsbW9zdCBhbHdheXMgY2FsbGVkIG9uY2Ugd2l0aCB0aGUgbW9kdWxlIGl0IHNlbGYsIHdoaWxlIHdlIGFyZSBsb2FkaW5nIGl0LiBJIGFtIG5vdCBzdXJlIHdoeT8KICAgIHRoYXQuY2hlY2tEZXBBbHJlYWR5TG9hZGVkID0gZnVuY3Rpb24oIG1vZHVsZU5hbWUgKSB7CiAgICAgICAgLy8gICAgICAgIG15cHJpbnQoICJjaGVja0RlcEFscmVhZHlMb2FkZWQoICIgKyBtb2R1bGVOYW1lICsgIik7XG4iICk7CiAgICAgICAgaWYgKCB0aGlzLmlzTG9hZGluZ01vZHVsZSggKSApIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnRfbW9kdWxlID0gdGhpcy5jdXJyZW50TG9hZGluZ01vZHVsZSggKTsKICAgICAgICAgICAgaWYgKCBjdXJyZW50X21vZHVsZSAhPT0gbW9kdWxlTmFtZSApIHsgLy8gTm90IHN1cmUgd2h5IHRoaXMgaGFwcGVucy4KICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgIG15cHJpbnQoICIgIGlzTG9hZGluZ01vZHVsZTogIiArIHRoaXMuY3VycmVudExvYWRpbmdNb2R1bGUoKSArICIgaGFzIHVzZXM6ICIgKyBfX21vZHVsZXNbIHRoaXMuY3VycmVudExvYWRpbmdNb2R1bGUoKSBdLnVzZXMgKyAiXG4iICk7CiAgICAgICAgICAgICAgICBpZiAoIC0xID09IF9fbW9kdWxlc1sgdGhpcy5jdXJyZW50TG9hZGluZ01vZHVsZSggKSBdLnVzZXMuaW5kZXhPZiggbW9kdWxlTmFtZSApICkgewogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICBteXByaW50KCAiICAgIHB1c2hpbmcgIiArIHRoaXMuY3VycmVudExvYWRpbmdNb2R1bGUoKSArICIgPT0+ICIgKyBtb2R1bGVOYW1lICsgIlxuIiApOwogICAgICAgICAgICAgICAgICAgIF9fbW9kdWxlc1sgdGhpcy5jdXJyZW50TG9hZGluZ01vZHVsZSggKSBdLnVzZXMucHVzaCggbW9kdWxlTmFtZSApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmhhc01vZHVsZSggbW9kdWxlTmFtZSApOwogICAgfTsKCiAgICB0aGF0Lmhhc01vZHVsZSA9IGZ1bmN0aW9uKCBtb2R1bGVOYW1lICkgewogICAgICAgIHJldHVybiBtb2R1bGVOYW1lIGluIF9fbW9kdWxlczsKICAgIH0KCiAgICB0aGF0LmdldE1vZHVsZSA9IGZ1bmN0aW9uKCBtb2R1bGVOYW1lICkgewogICAgICAgIGlmICggIXRoaXMuaGFzTW9kdWxlKCBtb2R1bGVOYW1lICkgKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvciggImdldE1vZHVsZTogTW9kdWxlICciICsgbW9kdWxlTmFtZSArICInIGlzIG5vdCByZWdpc3RlcmVkIiApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX19tb2R1bGVzWyBtb2R1bGVOYW1lIF07CiAgICB9OwoKICAgIHRoYXQuYWRkUHVzaE1vZHVsZSA9IGZ1bmN0aW9uKCBtb2R1bGVOYW1lLCB1cmwgKSB7CiAgICAgICAgaWYgKCB0aGlzLmhhc01vZHVsZSggbW9kdWxlTmFtZSApICkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoICJhZGRQdXNoTW9kdWxlOiBNb2R1bGUgJyIgKyBtb2R1bGVOYW1lICsgIicgaXMgYWxyZWFkeSByZWdpc3RlcmVkIHdpdGggdXJsOiAnIiArIHRoaXMuZ2V0TW9kdWxlKCBtb2R1bGVOYW1lICkudXJsICsgIiciICk7CiAgICAgICAgfQogICAgICAgIF9fbW9kdWxlc1sgbW9kdWxlTmFtZSBdID0gewogICAgICAgICAgICBuYW1lOiBtb2R1bGVOYW1lLAogICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgc3ltYm9sczogWyBdLAogICAgICAgICAgICB1c2VzOiBbIF0KICAgICAgICB9OwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9fbW9kdWxlTG9hZFN0YWNrLnB1c2goIG1vZHVsZU5hbWUgKTsKICAgICAgICB9IGNhdGNoICggZSApIHsKICAgICAgICAgICAgZGVsZXRlIF9fbW9kdWxlc1sgbW9kdWxlTmFtZSBdOwogICAgICAgICAgICB0aHJvdyBlOwogICAgICAgIH0KICAgIH07CgogICAgLy8gU2V0IHRoZSB1cmwgb24gYSBtb2R1bGUuIFRoaXMgaXMgdXNlZCB0byBzZXQgdGhlIFVSTCBmb3IgYSBtb2R1bGUsIGFmdGVyIGxvYWRpbmcuLi4KICAgIC8vIFVzZSBjYXNlIGlzIHRoZSBNb2R1bGVzSW5mbyB1cmwuLi4KICAgIHRoYXQuc2V0TW9kdWxlVXJsID0gZnVuY3Rpb24oIG1vZHVsZU5hbWUsIHVybCApIHsKICAgICAgICBpZiAoICF0aGlzLmhhc01vZHVsZSggbW9kdWxlTmFtZSApICkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoICJzZXRNb2R1bGVVcmw6IE1vZHVsZSAnIiArIG1vZHVsZU5hbWUgKyAiJyBpcyBub3QgcmVnaXN0ZXJlZCIgKTsKICAgICAgICB9CiAgICAgICAgX19tb2R1bGVzWyBtb2R1bGVOYW1lIF0udXJsID0gdXJsOwogICAgfQoKICAgIHRoYXQucmVtb3ZlTW9kdWxlID0gZnVuY3Rpb24oIG1vZHVsZU5hbWUgKSB7CiAgICAgICAgaWYgKCAhdGhpcy5oYXNNb2R1bGUoIG1vZHVsZU5hbWUgKSApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCAicmVtb3ZlTW9kdWxlOiBNb2R1bGUgJyIgKyBtb2R1bGVOYW1lICsgIicgaXMgbm90IHJlZ2lzdGVyZWQiICk7CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSBfX21vZHVsZXNbIG1vZHVsZU5hbWUgXTsKICAgIH07CgogICAgdGhhdC5wb3BNb2R1bGVMb2FkU3RhY2sgPSBmdW5jdGlvbiggKSB7CiAgICAgICAgcmV0dXJuIF9fbW9kdWxlTG9hZFN0YWNrLnBvcCggKTsKICAgIH07CgogICAgdGhhdC5pc0xvYWRpbmdNb2R1bGUgPSBmdW5jdGlvbiggKSB7CiAgICAgICAgcmV0dXJuIF9fbW9kdWxlTG9hZFN0YWNrLmxlbmd0aCAhPT0gMDsKICAgIH07CgogICAgdGhhdC5jdXJyZW50TG9hZGluZ01vZHVsZSA9IGZ1bmN0aW9uKCApIHsKICAgICAgICBpZiAoICF0aGlzLmlzTG9hZGluZ01vZHVsZSggKSApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCAiY3VycmVudExvYWRNb2R1bGU6IE5vdCBjdXJyZW50bHkgbG9hZGluZyBhIG1vZHVsZSIgKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9fbW9kdWxlTG9hZFN0YWNrWyBfX21vZHVsZUxvYWRTdGFjay5sZW5ndGggLSAxIF07CiAgICB9OwoKICAgIC8vIFRoZSBzeW1ib2xzIGFycmF5IHBhc3NlZCwgaXMgY29waWVkCiAgICB0aGF0LmFkZFN5bWJvbHMgPSBmdW5jdGlvbiggbW9kdWxlTmFtZSwgc3ltYm9scyApIHsKICAgICAgICBpZiAoICF0aGlzLmhhc01vZHVsZSggbW9kdWxlTmFtZSApICkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoICJhZGRTeW1ib2xzOiBNb2R1bGUgJyIgKyBtb2R1bGVOYW1lICsgIicgaXMgbm90IHJlZ2lzdGVyZWQiICk7CiAgICAgICAgfQogICAgICAgIHRoaXMuZ2V0TW9kdWxlKCBtb2R1bGVOYW1lICkuc3ltYm9scyA9IHN5bWJvbHMubWFwKCBmdW5jdGlvbiggeCApIHsKICAgICAgICAgICAgICAgIHJldHVybiB4OwogICAgICAgICAgICB9ICk7CiAgICB9OwoKICAgIHRoYXQubW9kdWxlTmFtZXMgPSBmdW5jdGlvbiggKSB7CiAgICAgICAgdmFyIHJlcyA9IFsgXTsKICAgICAgICBmb3IgKCB2YXIgbSBpbiBfX21vZHVsZXMgKSB7CiAgICAgICAgICAgIGlmICggX19tb2R1bGVzLmhhc093blByb3BlcnR5KCBtICkgKSB7CiAgICAgICAgICAgICAgICByZXMucHVzaCggX19tb2R1bGVzWyBtIF0ubmFtZSApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXM7CiAgICB9OwoKICAgIHRoYXQuc2V0VmVyc2lvbiA9IGZ1bmN0aW9uKCBtb2R1bGVOYW1lLCB2ZXJzaW9uICkgewogICAgICAgIHRoaXMuZ2V0TW9kdWxlKCBtb2R1bGVOYW1lICkudmVyc2lvbiA9IHZlcnNpb247CiAgICB9OwoKICAgIHRoYXQuZ2V0VmVyc2lvbiA9IGZ1bmN0aW9uKCBtb2R1bGVOYW1lICkgewogICAgICAgIHJldHVybiB0aGlzLmdldE1vZHVsZSggbW9kdWxlTmFtZSApLnZlcnNpb247CiAgICB9OwoKICAgIC8vIFRoaXMgaXMgYSBiaXQgc2lsbHksIGl0IGluc2VydHMgaXRzZWxmLCB0aGVuIHJlbHkgb24gdGhlIAogICAgLy8gbW9kdWxlIHN5c3RlbSB0byBjb3JyZWN0IHRoZSB1cmwsIGlmIG5lZWRlZC4gCiAgICAvLyBUaGVyZSBhcmUgaGlzdG9yaWNhbCByZWFzb25zIHdoeSBpdCBlbmRlZCB1cCBsaWtlIHRoaXMKICAgIC8vIFJpZ2h0IG5vdywgaXQgaXMgaGFyZCB0byBjaGFuZ2UsIGJlY2F1c2UgaXQgd2lsbCBicmVhawogICAgLy8gaWYgbm90IGNvb3JkaW5hdGVkLCBzbyBsZWF2ZSBpdCBsaWtlIHRoaXMuCiAgICB0aGF0LmFkZFB1c2hNb2R1bGUoICJNb2R1bGVzSW5mbyIsICJ0aGUgaW5mbyBtb2R1bGUgaXRzZWxmIiApOwogICAgdGhhdC5wb3BNb2R1bGVMb2FkU3RhY2soICk7CgogICAgcmV0dXJuIHRoYXQ7Cn0oICk7CgovLyBBbiBpbnRlcmZhY2UgdGhhdCBjYW4gYmUgcHVibGljYWxseSB1c2VkCi8qKiAKICogTW9kdWxlIHRvIGdldCBpbmZvcm1hdGlvbiBhYm91dCBtb2R1bGVzLgogKgogKiBUaGlzIG5hbWVzcGFjZSBjdXJyZW50bHkgb25seSBzdXBwb3J0cyBhIGNvdXBsZSBvZiBtZXRob2RzLCB0aGF0CiAqIHJldHVybnMgaW5mb3JtYXRpb24gZGVzY3JpYmluZyB3aGVyZSBtb2R1bGVzIHdlcmUgbG9hZGVkIGZyb20uCiAqCiAqIEBuYW1lc3BhY2UgCiAqIEBuYW1lIE1vZHVsZXNJbmZvICovCnZhciBNb2R1bGVzSW5mbyA9IGZ1bmN0aW9uKCApIHsKICAgIHZhciB0aGF0ID0ge307CiAgICB2YXIgbW9kdWxlc19pbmZvID0gX19Nb2R1bGVzSW5mbzsKCiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgd2l0aCBhbiB1cmwgZm9yIGFsbCBsb2FkZWQgbW9kdWxlcy4KICAgICAqIAogICAgICogVGhpcyBtZXRob2QgaXMgbWVhbnQgYXMgYW4gYWlkIGZvciBlLmcuIHNlcnZlciBwcm9ncmFtcywgdGhhdCBjYW4KICAgICAqIHJlcG9ydCwgdXNpbmcgdGhlaXIgbG9nIG9yIHNpbWlsYXIsIHdoZXJlIG1vZHVsZXMgd2hlcmUgbG9hZGVkIGZyb20uCiAgICAgKiAKICAgICAqIEBzeW50YXggTW9kdWxlc0luZm8uZ2V0TW9kdWxlVXJscygpOwogICAgICogQHJldHVybiB7U3RyaW5nfSBBIHN0cmluZyBvZiBtb2R1bGUgbmFtZXMgYW5kIHRoZWlyIGFzc29jaWF0ZWQgdXJscwogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgTW9kdWxlc0luZm8uZ2V0TW9kdWxlVXJscyAqLwogICAgdGhhdC5nZXRNb2R1bGVVcmxzID0gZnVuY3Rpb24oICkgewogICAgICAgIHZhciBrZXlzID0gbW9kdWxlc19pbmZvLm1vZHVsZU5hbWVzKCApLnNvcnQoICk7CiAgICAgICAgdmFyIHJlcyA9ICIiOwogICAgICAgIHZhciBwcmUgPSAiIjsKICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgKytpICkgewogICAgICAgICAgICByZXMgKz0gcHJlICsga2V5c1sgaSBdICsgIiA9PiAiICsgbW9kdWxlc19pbmZvLmdldE1vZHVsZSgga2V5c1sgaSBdICkudXJsOwogICAgICAgICAgICBwcmUgPSAiXG4iOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzOwogICAgfTsKICAgIAogICAgLyoqIFJldHVybnMgYSBzdHJpbmcgd2l0aCB0aGUgdXJsIGZvciBhIHNpbmdsZSwgbmFtZWQgbW9kdWxlLgogICAgICoKICAgICAqIFRoaXMgbWV0aG9kIHJldHVybnMgdGhlIHVybCBvZiBhIHNpbmdsZSBuYW1lIG1vZHVsZSwgb3IgYW4KICAgICAqIGV4Y2VwdGlvbiwgaWYgdGhlIG1vZHVsZSBpcyBub3QgZm91bmQuCiAgICAgKgogICAgICogQHN5bnRheCBNb2R1bGVzSW5mby5nZXRNb2R1bGVVcmwoIG1vZHVsZSApCiAgICAgKiBAcmV0dXJuIFRoZSBVUkwgZm9yIHRoZSBtb2R1bGUKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBUaGUgbmFtZSBvZiB0aGUgbW9kdWxlCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBNb2R1bGVzSW5mby5nZXRNb2R1bGVVcmwgKi8KICAgIHRoYXQuZ2V0TW9kdWxlVXJsID0gZnVuY3Rpb24oIG1vZHVsZSApIHsKICAgICAgICByZXR1cm4gbW9kdWxlc19pbmZvLmdldE1vZHVsZSggbW9kdWxlICkudXJsOwogICAgfQoKICAgIHJldHVybiB0aGF0Owp9KCApOwo=", "moduleName": "ModulesInfo"}, {"javascript": "LyoqIEBmaWxlIENvcmUgdXNlIGZ1bmN0aW9uYWxpdHkgKi8KLy8gV0FSTklORzogSWYgeW91IGJyZWFrIHRoaXMgZmlsZSwgdGhlIG1vZHVsZSBzeXN0ZW0gd2lsbCBzdG9wIHdvcmtpbmchCgovLyBUaGlzIGZpbGUgZGVmaW5lcyB0aGUgZnVuY3Rpb24gYHVzZShtb2R1bGUtbmFtZSwgdmVyc2lvbi1udW1iZXIpYCwKLy8gd2hpY2ggaXMgdXNlZCBmb3IgbG9hZGluZyBtb2R1bGVzLgovLyBUaGUgbW9kdWxlLW5hbWUgaXMgcmVzb2x2ZWQsIGFuZCB0aGUgbW9kdWxlIGlzIGxvYWRlZCwKLy8gaWYgbm90IGFscmVhZHkgYXZhaWxhYmxlLgovLyBUaGUgdmVyc2lvbi1udW1iZXIgaXMgb3B0aW9uYWwgYW5kIGluZGljYXRlcyB3aGljaCB2ZXJzaW9uIG9mCi8vIHRoZSBtb2R1bGUgdGhhdCBpcyByZXF1aXJlZCwgYW5kIHVzZWQgdG8gY2hlY2sgaWYgdGhlIG1vZHVsZQovLyBpcyBjb21wYXRpYmxlIHdpdGggdGhlIGNvZGUuCi8vCi8vIEEgbW9kdWxlIG11c3QgZGVmaW5lIGEgZ2xvYmFsIHZhcmlhYmxlIGBFWFBPUlRFRF9TWU1CT0xTYAovLyB3aGljaCBsaXN0cyB0aGUgZ2xvYmFsIHZhcmlhYmxlIGl0IGV4cG9ydHMuCi8vIFRoZSBvcHRpb25hbCBnbG9iYWwgdmFyaWFibGUgYElHTk9SRURfU1lNQk9MU2AgY2FuIGJlIGFkZGVkLAovLyB3aGljaCBzdXBwcmVzc2VzIHdhcm5pbmdzIGlmIHRob3NlIHN5bWJvbHMgYXJlIHdyaXR0ZW4gdG8uCi8vIEl0IGFsc28gaGFzIHRoZSBvcHRpb24gb2YgYWRkaW5nIGEgdGhyZWUtcGFydCBzdHJpbmcgdmVyc2lvbiBudW1iZXIKLy8gYSBsYTogIjEuNC41NyIgaW4gYSBgVkVSU0lPTmAgdmFyaWFibGUgd2hpY2ggY2FuIGJlIGNoZWNrZWQgZm9yLgovLwovLyBJdCBhbHNvIGVuc3VyZXMgdGhhdCBhIGdpdmVuIG1vZHVsZSBpcyBvbmx5IGxvYWRlZCBvbmNlLAovLyBhbmQgbWFrZXMgc29tZSBjaGVja3Mgb24gdmVyc2lvbiBudW1iZXJzIGFuZCB3aGV0aGVyCi8vIGdsb2JhbCB2YXJpYWJsZXMgYXJlIHdyaXR0ZW4KLy8KLy8gUmVzb2x1dGlvbiBvZiBtb2R1bGUgbmFtZSBpcyBjdXJyZW50bHkgZG9uZSBpbgovLyB0aGUgbmF0aXZlIGVtYmVkZGluZyBjb2RlLgovLwovLyBqc2xpYiBkZXBlbmRzIG9uLCBhbmQgbG9hZHMgdGhpcyBtb2R1bGUuCgp1c2UgPSAoIGZ1bmN0aW9uKCApIHsKCiAgICAgICAgLy8gdGhpcyBvYmplY3QgY29udGFpbnMgYWxsIHZhcmlhYmxlcyBleHBvcnRlZCBmcm9tIG1vZHVsZXMKICAgICAgICAvLyBhbmQgaXMgc3RhdGljLCB2aWEgY2xvc3VyZQogICAgICAgIHZhciBleHBvcnRzID0ge307CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCBuYW1lLCB2ZXJzaW9uICkgewogICAgICAgICAgICB2YXIgZWxlbSwgaTsKCiAgICAgICAgICAgIC8vIHN5bWJvbHMgdGhhdCBhcmUgaWdub3JlZCB3aGVuIGNoZWNraW5nIGZvcgogICAgICAgICAgICAvLyBtb2R1bGUtd3JpdGVzIHRvIHRoZSBnbG9iYWwgc2NvcGUKICAgICAgICAgICAgdmFyIGlnbm9yZSA9IHsKICAgICAgICAgICAgICAgICdFWFBPUlRFRF9TWU1CT0xTJzogdHJ1ZSwKICAgICAgICAgICAgICAgICdJR05PUkVEX1NZTUJPTFMnOiB0cnVlLAogICAgICAgICAgICAgICAgJ1ZFUlNJT04nOiB0cnVlCiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBnbG9iYWwgc2NvcGUKICAgICAgICAgICAgdmFyIGdsb2JhbHMgPSAoIGZ1bmN0aW9uKCApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICAgIH0gKSggKTsKCiAgICAgICAgICAgIC8vIHF1aXQgaWYgbW9kdWxlIGlzIGFscmVhZHkgbG9hZGVkCiAgICAgICAgICAgIGlmICggZ2xvYmFscy5oYXNPd25Qcm9wZXJ0eSggJ19fTW9kdWxlc0luZm8nICkgJiYgX19Nb2R1bGVzSW5mby5jaGVja0RlcEFscmVhZHlMb2FkZWQoIG5hbWUgKSApIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gc2hhbGxvdyBjb3B5IG9mIGdsb2JhbCBzY29wZSwgdXNlZCB0byBjaGVjayBmb3Igd3JpdGVzCiAgICAgICAgICAgIHZhciBvbGRHbG9iYWxzID0ge307CiAgICAgICAgICAgIGZvciAoIGVsZW0gaW4gZ2xvYmFscyApIHsKICAgICAgICAgICAgICAgIGlmICggZ2xvYmFscy5oYXNPd25Qcm9wZXJ0eSggZWxlbSApICkgewogICAgICAgICAgICAgICAgICAgIG9sZEdsb2JhbHNbIGVsZW0gXSA9IGdsb2JhbHNbIGVsZW0gXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbmFtZSByZXNvbHV0aW9uIGlzIGRvbmUgaW4gdGhlIG5hdGl2ZSBmdW5jdGlvbiBgX19idWlsdGluX3VzZWAKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gRm9yIHRoZSBTcGlkZXJNb25rZXkgaW1wbGVtZW50YXRpb24sIHdlIHdhbnQgdG8gcmV0aHJvdyBwb3NzaWJsZSBleGNlcHRpb24KICAgICAgICAgICAgLy8gdG8gZ2V0IGZpbGUgbmFtZSBldGMuIHdpdGggZXJyb3IgYXMgdGhlIG5hdGl2ZSBlcnJvciBkb2Vzbid0IGluY2x1ZGUgdGhhdC4KICAgICAgICAgICAgLy8gV2UgZG8gbm90IGhhdmUgYSBnb29kIHdheSB0byBkZXRlcm1pbmUgb25lIG9yIHRoZSBvdGhlciwgdGhpcyBpcyBraW5kIG9mCiAgICAgICAgICAgIC8vIGhhY2tpc2g6IHJlbHkgb24gUGFja2FnZXMuamF2YSAtIGlmIHByZXNlbnQgYW5kIG9iamVjdCwgdGhpcyBpcyBSaGluby9KYXZhIGJhY2tlbmQKICAgICAgICAgICAgLy8gSWYgbm90LCB0aGlzIGlzIHNwaWRlcm1vbmtleQogICAgICAgICAgICAvLyBOb3RlOiBUaGlzIG1vZHVsZSBjYW4gbm90IHJlbHkgb24gYW55IG90aGVyIG1vZHVsZXMsIGFzIGl0IGlzCiAgICAgICAgICAgIC8vIHRoZSBsb2FkZXIgbW9kdWxlLi4uLiBjYXBpc2g/CiAgICAgICAgICAgIGlmKCB0eXBlb2YoIF9fZW52aXJvbm1lbnQgKSA9PT0gIm9iamVjdCIgKSB7CiAgICAgICAgICAgICAgICAvLyBKU0xpYiB3aXRoIE5hc2hvcm4KICAgICAgICAgICAgICAgIF9fZW52aXJvbm1lbnQudXNlKCBuYW1lICk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoICggdHlwZW9mIFBhY2thZ2VzID09PSAib2JqZWN0IiApICYmICggdHlwZW9mIFBhY2thZ2VzLmphdmEgPT09ICJvYmplY3QiICkgKSB7CiAgICAgICAgICAgICAgICAvLyBSaGluby9KYXZhIHBhdGgKICAgICAgICAgICAgICAgIF9fYnVpbHRpbl91c2UoIG5hbWUgKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIFNwaWRlck1vbmtleS9DL0MrKyBwYXRoCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIF9fYnVpbHRpbl91c2UoIG5hbWUgKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKCBlICkgewogICAgICAgICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gbW9kdWxlcyBtdXN0IGluaXRpYWxpc2UgYW4gRVhQT1JURURfU1lNQk9MUyB2YXJpYWJsZS4KICAgICAgICAgICAgLy8gVGhpcyBpcyBpbnNwaXJlZGUgYnkgbW96aWxsYSdzIG1vZHVsZSBzeXN0ZW0sIHNlZSBhbHNvCiAgICAgICAgICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL0phdmFTY3JpcHRfY29kZV9tb2R1bGVzL1VzaW5nCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIHRoaXMgY29kZSB0aHJvd3MgaWYgdGhlIHZhcmlhYmxlIGlzIG5vdCBkZWZpbmVkCiAgICAgICAgICAgIC8vIG9yIGlmIGl0IGlzIG5vdCBvZiB0aGUgcHJvcGVyIHR5cGUuCiAgICAgICAgICAgIGlmICggIWdsb2JhbHMuaGFzT3duUHJvcGVydHkoICdFWFBPUlRFRF9TWU1CT0xTJyApIHx8IHR5cGVvZiBFWFBPUlRFRF9TWU1CT0xTICE9PSAnb2JqZWN0JyB8fCBFWFBPUlRFRF9TWU1CT0xTLmNvbnN0cnVjdG9yICE9PSBBcnJheSApIHsKICAgICAgICAgICAgICAgIHRocm93ICdVc2UgZXJyb3I6IG1vZHVsZSAiJyArIG5hbWUgKyAnIiBkb2VzIG5vdCBpbml0aWFsaXNlIGFycmF5IEVYUE9SVEVEX1NZTUJPTFMuJzsKICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIC8vIHZlcnNpb24gb2YgdGhlIG1vZHVsZQogICAgICAgICAgICBnbG9iYWxzLlZFUlNJT04gPSBnbG9iYWxzLlZFUlNJT04gfHwgIjAuMC4wIgoKCiAgICAgICAgICAgIC8vIGlmIGB1c2UoLi4uKWAgcmVxdWlyZXMgYSBjZXJ0YWluIHZlcnNpb24sCiAgICAgICAgICAgIC8vIHRlc3QgaWYgdGhlIG1vZHVsZSBzdXBwbGllcyB0aGF0CiAgICAgICAgICAgIC8vIG9yIG90aGVyd2lzZSB0aHJvdyBhbiBlcnJvcgogICAgICAgICAgICBpZiAoIHZlcnNpb24gKSB7CiAgICAgICAgICAgICAgICB2YXIgdmVyc2lvbmVycm9yID0gIlJlcXVlc3RpbmcgdmVyc2lvbiAiICsgdW5ldmFsKCB2ZXJzaW9uICkgKyAiIG9mIG1vZHVsZSAiICsgbmFtZSArICIgd2hpY2ggaXMgdmVyc2lvbiAiICsgdW5ldmFsKCBWRVJTSU9OICk7CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gc3BsaXR2ZXJzaW9uKCB2ICkgewogICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSAoIHR5cGVvZiggdiApID09PSAic3RyaW5nIiApICYmIHYuc3BsaXQoICIuIiApLm1hcCggZnVuY3Rpb24oIHMgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQoIHMsIDEwICkKICAgICAgICAgICAgICAgICAgICAgICAgfSApOwogICAgICAgICAgICAgICAgICAgIGlmICggcmVzdWx0LmNvbnN0cnVjdG9yICE9PSBBcnJheSB8fCByZXN1bHQubGVuZ3RoICE9PSAzIHx8IHJlc3VsdC5qb2luKCAiLiIgKSAhPT0gdiApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgdmVyc2lvbmVycm9yOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIG1vZHVsZXZlcnNpb24gPSBzcGxpdHZlcnNpb24oIFZFUlNJT04gKTsKICAgICAgICAgICAgICAgIHZlcnNpb24gPSBzcGxpdHZlcnNpb24oIHZlcnNpb24gKTsKICAgICAgICAgICAgICAgIGlmICggISggbW9kdWxldmVyc2lvblsgMCBdID09IHZlcnNpb25bIDAgXSAmJiAoIG1vZHVsZXZlcnNpb25bIDEgXSA+IHZlcnNpb25bIDEgXSB8fCAoIG1vZHVsZXZlcnNpb25bIDEgXSA9PT0gdmVyc2lvblsgMSBdICYmIG1vZHVsZXZlcnNpb25bIDIgXSA+PSB2ZXJzaW9uWyAyIF0gKSApICkgKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgdmVyc2lvbmVycm9yOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8qIFRPRE86IHNlZW1zIGxpa2Ugd2UgZG9udCBjaGVjayB2ZXJzaW9uIG51bWJlcgogICAgICAgICAgIGlmIG1vZHVsZSBpcyBhbHJlYWR5IGxvYWRlZC4uLiAqLwogICAgICAgICAgICBfX01vZHVsZXNJbmZvLnNldFZlcnNpb24oIG5hbWUsIFZFUlNJT04gKTsKCiAgICAgICAgICAgIC8vIG1iZDogQWRkIHN5bWJvbHMgdG8gTW9kdWxlc0luZm8KICAgICAgICAgICAgX19Nb2R1bGVzSW5mby5hZGRTeW1ib2xzKCBuYW1lLCBFWFBPUlRFRF9TWU1CT0xTICk7CgogICAgICAgICAgICAvLyBtYmQ6IEkgd29uZGVyIHdoeSB0aGlzIGlzIG5lZWRlZD8KICAgICAgICAgICAgLy8gcmplOiBXaGVuIGxvYWRpbmcgYSBtb2R1bGUsIHdlIGNyZWF0ZSAob3IgY2hhbmdlKSB0aGUgZ2xvYmFsIHZhcmlhYmxlIF9fTW9kdWxlc0luZm8KICAgICAgICAgICAgLy8gcmplOiBhbmQgdGh1cyBpdCBuZWVkcyB0byBleHBvcnRlZCwgb3Igd2Ugd291bGQgZ2V0IGEgd2FybmluZyBmcm9tIHRoZSBtb2R1bGUgc3lzdGVtLgogICAgICAgICAgICAvLyByamU6IENvdWxkIGJlIGhhbmRsZWQgYXMgYSBzcGVjaWFsIGNhc2UgaW4gdGhlIGNvZGUgaW5zdGVhZCwgYnV0IEkgZmluZCBpdCBzaW1wbGVyCiAgICAgICAgICAgIC8vIHJqZToganVzdCB0byBhZGQgaXQgdG8gdGhlIGV4cG9ydGVkIHN5bWJvbHMuCiAgICAgICAgICAgIEVYUE9SVEVEX1NZTUJPTFMucHVzaCggJ19fTW9kdWxlc0luZm8nICk7CgogICAgICAgICAgICAvLyBhcHBlbmQgYElHTk9SRURfU1lNQk9MU2AgdG8gYGlnbm9yZWAgbGlzdAogICAgICAgICAgICBpZiAoIGdsb2JhbHMuaGFzT3duUHJvcGVydHkoICdJR05PUkVEX1NZTUJPTFMnICkgKSB7CiAgICAgICAgICAgICAgICBmb3IgKCBpID0gMDsgaSA8IElHTk9SRURfU1lNQk9MUy5sZW5ndGg7ICsraSApIHsKICAgICAgICAgICAgICAgICAgICBlbGVtID0gSUdOT1JFRF9TWU1CT0xTWyBpIF07CiAgICAgICAgICAgICAgICAgICAgaWdub3JlWyBlbGVtIF0gPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB3YXJuIGlmIGBFWFBPUlRFRF9TWU1CT0xTYCBpcyBub3QgZXhwb3J0ZWQKICAgICAgICAgICAgZm9yICggaSA9IDA7IGkgPCBFWFBPUlRFRF9TWU1CT0xTLmxlbmd0aDsgKytpICkgewogICAgICAgICAgICAgICAgZWxlbSA9IEVYUE9SVEVEX1NZTUJPTFNbIGkgXTsKICAgICAgICAgICAgICAgIGlmICggZ2xvYmFscy5oYXNPd25Qcm9wZXJ0eSggJ3ByaW50JyApICYmICFnbG9iYWxzLmhhc093blByb3BlcnR5KCBlbGVtICkgKSB7CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoICdXYXJuaW5nOiBtb2R1bGUgIicgKyBuYW1lICsgJyIgc2F5cyBpdCBleHBvcnRzIGdsb2JhbCAiJyArIGVsZW0gKyAnIiB3aGljaCBkb2VzIG5vdCBleGlzdFxuJyApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZXhwb3J0c1sgZWxlbSBdID0gZ2xvYmFsc1sgZWxlbSBdOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB3YXJuIGlmIG1vZHVsZSBjcmVhdGVzIG9yIGNoYW5nZXMgZ2xvYmFsIHN5bWJvbAogICAgICAgICAgICAvLyB3aGljaCBpcyBub3QgaW4gYElHTk9SRURfU1lNQk9MU2Agb3IgYEVYUE9SVEVEX1NZTUJPTFNgCiAgICAgICAgICAgIC8vIGFuZCBkZWxldGUgdGhlbSBpZiBjcmVhdGVkCiAgICAgICAgICAgIGZvciAoIGVsZW0gaW4gZ2xvYmFscyApIHsKICAgICAgICAgICAgICAgIGlmICggZ2xvYmFscy5oYXNPd25Qcm9wZXJ0eSggZWxlbSApICkgewoKICAgICAgICAgICAgICAgICAgICBpZiAoIG9sZEdsb2JhbHMuaGFzT3duUHJvcGVydHkoIGVsZW0gKSAmJiBvbGRHbG9iYWxzWyBlbGVtIF0gIT09IGdsb2JhbHNbIGVsZW0gXSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBnbG9iYWxzLmhhc093blByb3BlcnR5KCAncHJpbnQnICkgJiYgIWlnbm9yZVsgZWxlbSBdICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoICdXYXJuaW5nOiBtb2R1bGUgIicgKyBuYW1lICsgJyIgb3ZlcndyaXRlcyBnbG9iYWwgdmFyaWFibGUgJyArIGVsZW0gKyAnXG4nICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICggIWV4cG9ydHMuaGFzT3duUHJvcGVydHkoIGVsZW0gKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBvbGRHbG9iYWxzLmhhc093blByb3BlcnR5KCBlbGVtICkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWxzWyBlbGVtIF0gPSBvbGRHbG9iYWxzWyBlbGVtIF07CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIGdsb2JhbHMuaGFzT3duUHJvcGVydHkoICdwcmludCcgKSAmJiAhaWdub3JlWyBlbGVtIF0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCggJ1dhcm5pbmc6IG1vZHVsZSAiJyArIG5hbWUgKyAnIiBjcmVhdGVzIG5vbi1leHBvcnRlZCBnbG9iYWwgdmFyaWFibGUgJyArIGVsZW0gKyAnXG4nICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICFkZWxldGUgZ2xvYmFsc1sgZWxlbSBdICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbHNbIGVsZW0gXSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gKSggKTsKCi8vIE1vZHVsZXMgdG8gYmUgbG9hZGVkIGp1c3QgYWZ0ZXIgaW5pdGlhbGl6YXRpb24gb2YgbW9kdWxlIHN5c3RlbQp1c2UoICJVc2UuUmVxdWlyZWRNb2R1bGVzIiApOwo=", "moduleName": "Use"}, {"javascript": "LyoqIEBmaWxlIFJlcXVpcmVkIG1vZHVsZXMgKi8KCi8qKiAgCiAqIFRoaXMgaXMgZXhlY3V0ZWQganVzdCBhZnRlciB0aGUgbW9kdWxlIHN5c3RlbSAoVXNlLnVzZS5qcykgaGFzIGJlZW4gaW5pdGlhbGl6ZWQsCiAqIGhlbmNlIG1vZHVsZXMgd2hpY2ggYWx3YXlzIG5lZWQgdG8gYmUgbG9hZGVkIG1heSBiZSBhZGRlZCBoZXJlLgogKi8KdXNlKCAiRVM1IiApOwo=", "moduleName": "Use.RequiredModules"}, {"javascript": "Ly8gRHVtbXkgbW9kdWxlLCBUaGUgSmF2YSBpbXBsZW1lbnRhdGlvbiBzdXBwb3J0cyBtb3N0IG9mIEVTNS4KLy8gVGhpcyBpcyB0byBoYW5kbGUgdGhvc2UgbW9kdWxlcyB0aGF0IGluY2x1ZGVzIEVTNQpFWFBPUlRFRF9TWU1CT0xTPVtdOwo=", "moduleName": "ES5"}, {"javascript": "LyoqIEBmaWxlIEltcGxlbWVudGF0aW9uIG9mIGEgTG9nIG1vZHVsZS4gKi8KLy8gVGhpcyBtb2R1bGUgZGVwZW5kcyBvbiBhIHByb3ZpZGVkIExvZ0NvcmUgbW9kdWxlLCB3aGljaCBtdXN0Ci8vIHByb3ZpZGUgYSBmdW5jdGlvbiBfX0xvZ0NvcmVfbG9nIHRoYXQgdGFrZXMgdHdvIHN0cmluZyBhcmd1bWVudHMKLy8gYSBsZXZlbCwgYW5kIGFuIGFscmVhZHkgZm9ybWF0dGVkIG1lc3NhZy4gCi8vIEEgc2ltcGxlIExvZ0NvcmUgbW9kdWxlIHRoYXQgZG9lcyBsb2dnaW5nIHVzaW5nIFByaW50IHdpbGwgc3VmZmljZSwgb3IKLy8gaW4gbW9zdCBjYXNlcyBhIExvZ0NvcmUgbW9kdWxlIHByb3ZpZGVkIGJ5IHRoZSBlbnZpcm9ubWVudC4KdXNlKCAiTG9nQ29yZSIgKTsKdXNlKCAiTG9kYXNoIiApOyAvLyBGb3IgdGhlICdtYWdpYycgZXhwZXJpbWVudGFsIGZ1bmN0aW9uLgp1c2UoICJHbG9iYWwiICk7CgpFWFBPUlRFRF9TWU1CT0xTID0gWyAnTG9nJyBdOwoKLyoqCiAqIE5hbWVzcGFjZSB0aGF0IGNvbnRhaW5zIGZ1bmN0aW9ucyB0byBMb2cgd2l0aC4KICogCiAqIFRoaXMgbmFtZXNwYWNlIGNvbnRhaW5zIGZ1bmN0aW9ucyB1c2VkIGZvciBsb2dnaW5nLiBFYWNoIGZ1bmN0aW9uCiAqIHJlZmxlY3RzIGEgY2VydGFpbiBsZXZlbCBvZiB1cmdlbmN5IG9mIHRoZSBtZXNzYWdlIHRvIGJlIGxvZ2dlZC4KICogQWxsIGxvZ2dpbmcgbWV0aG9kcyBzdXBwb3J0cyBwYXNzaW5nIGEgdmFyaWFibGUgbnVtYmVyIG9mIGFyZ3VtZW50cy4gSWYgdGhlIGxvZyBzdGF0ZW1lbnQgbGV2ZWwgaXMgZW5hYmxlZAogKiBlYWNoIHBhcmFtZXRlciB3aWxsIGJlIGNvbnZlcnRlZCB0byBhIFN0cmluZyAoYnkgY2FsbGluZyBpdHMgdG9TdHJpbmcgbWV0aG9kKSwgYW5kIHRoZSBzdHJpbmdzIHdpbGwgYmUgY29uY2F0ZW5hdGVkLgogKgogKiAqKkEgbm90ZSBvbiB0aGUgbGV2ZWxzKiogIAogKiAKICogVGhlIGxvZyBsZXZlbHMgYXJlLCBmcm9tIGxvdy91bmltcG9ydGFudCB0byBoaWdoL2ltcG9ydGFudDogYHRyYWNlYCwKICogYGRlYnVnYCwgYGluZm9gLCBgd2FybmAsIGBlcnJvcmAsIGFuZCBgZmF0YWxgLiBUaGV5IGFyZSB1c2VkIHJvdWdobHkgYXMgc3VjaDoKICogCiAqICogYHRyYWNlYDogVmVyeSBkZXRhaWxlZCwgZnVuY3Rpb24gZW50ZXIvZXhpdCwgcGFyYW1ldGVyIGR1bXBzLCB1c3VhbGx5IG9ubHkgdXNlZCBmb3IgdHJhY2luZyBmdW5jdGlvbnMsIGFuZCBzcGVjaWZpYyBidWcgc29sdmluZy4KICogCiAqICogYGRlYnVnYDogRm9yIG9yZGluYXJ5IGRldmVsb3BtZW50LCBwcm9ncmFtIGZsb3csIGR1bXBpbmcgaW1wb3J0YW50IHZhbHVlcywgZXRjLgogKiAKICogKiBgaW5mb2A6IEluZm9ybWF0aW9uIGFib3V0IHRoZSBydW5uaW5nIHByb2dyYW0vc3lzdGVtIG9mIGEgbW9yZSBzdGF0dXMtbGlrZSBjaGFyYWN0ZXIsIGUuZy4gaG93IGZhciB0aGUgcHJvZ3JhbSBpcyBpbiBhIGdpdmVuIHByb2Nlc3MsIHRoYXQgc29tZXRoaW5nIHN0YXJ0ZWQgb3Igc3RvcHBlZCwgb3Igc2ltaWxhci4KICogCiAqICogYHdhcm5gOiBFeHBlY3RhdGlvbnMgdGhlIHByb2dyYW0gaGFkIGFib3V0IGZsb3cgb3IgZGF0YSBoYXMgbm90IGJlZW4gbWV0LCBidXQgdGhlIHByb2dyYW0gaXMgY2FwYWJsZSBvZiBjb250aW51aW5nLiBJdCBtaWdodCBpbmRpY2F0ZSB0aGF0IHRoZSB1c2VyL29wZXJhdG9yIGhhcyB0byBsb29rIGludG8gYW4gaXNzdWUgYW5kIHNvbHZlIGEgcHJvYmxlbS4KICogCiAqICogYGVycm9yYDogQW4gdW5leHBlY3RlZCBzaXR1YXRpb24gdGhhdCB0aGUgcHJvZ3JhbSBpcyB1bmFibGUgdG8gY29ycmVjdGx5IGhhbmRsZSwgaGFzIG9jY3VycmVkLiBUaGUgY3VycmVudCBwcm9jZXNzIGNhbiBub3QgcnVuIHVudGlsIGNvbXBsZXRpb24uIFRoaXMgbWlnaHQgYmUgbWlzc2luZyBkYXRhLCBvciBzaW1pbGFyLiBUaGUgdXNlci9vcGVyYXRvciBtdXN0IGxvb2sgaW50byB0aGUgaXNzdWUsIGFuZCBzb2x2ZSBpdC4KICogCiAqICogYGZhdGFsYDogQXMgZXJyb3IsIGJ1dCB0aGUgcHJvZ3JhbSBpcyB1bmFibGUgdG8gY29udGludWUgYXQgYWxsLCBhbmQgd2lsbCBzaHV0IGRvd24uIChOb3QgdXNlZCBtdWNoIGluIEphdmFTY3JpcHQsIGFuZCBub3Qgc3VwcG9ydGVkIGluIGFsbCBmcmFtZXdvcmtzKS4KICogCiAqICoqQSBub3RlIG9uIHBlcmZvcm1hbmNlKioKICogCiAqIFlvdSBhcmUgZW5jb3VyYWdlZCB0byBwYXNzIG11bHRpcGxlIHZhbHVlcywgaW5zdGVhZCBvZiAKICogdXNpbmcgc3RyaW5nIGNvbmNhdGVuYXRpb24gaW4gdGhlIGNhbGwgdG8gdGhlIGxvZ2dpbmcgbWV0aG9kLAogKiAgYXMgdGhlIGxvZyBtb2R1bGUgd2lsbCBza2lwIHRoZSB0b1N0cmluZyBjb252ZXJzaW9uIHByb2Nlc3MgYW5kIGNvbmNhdGVuYXRpb24sIHVudGlsIGl0IGRldGVybWluZXMgdGhhdCBpdCBuZWVkcwogKiB0byBwZXJmb3JtIHRoZSBhY3R1YWwgbG9nZ2luZy4gU2VlIHRoZSBleGFtcGxlLgogKiAKICogV2hlbiBsb2dnaW5nIHhtbCB2YXJpYWJsZXMgZm9yIGxldmVscyB0aGF0IG1pZ2h0IGJlIG9mdGVuIGJlIG9mZiAodHJhY2UsIGRlYnVnLCBpbmZvKSB5b3Ugc2hvdWxkIGNvbnNpZGVyIHVzaW5nCiAqICB7QGxpbmsgWG1sVXRpbC5sb2dYbWxTdHJpbmd9LCBpbnN0ZWFkIG9mIGNhbGxpbmcgdGhlIHhtbCBpbnN0YW5jZXMgdG9YbWxTdHJpbmcgbWV0aG9kLiBUaGlzIGVuc3VyZXMgdGhlIGJlc3QgcGVyZm9ybWFuY2UuCiAqIAogKiBAZXhhbXBsZQovLyBXaGVuIGxvZ2dpbmcsIHVzZSBtdWx0aXBsZSBwYXJhbWV0ZXJzIHRoYXQgc3VwcG9ydHMgdG9TdHJpbmcsIGluc3RlYWQgb2Ygc3RyaW5nIGNvbmNhdGVuYXRpb24uCi8vIEUuZy4gZG8gdGhpczoKTG9nLmRlYnVnKCAiVmFsdWUgb2YgZm9vLmJhcjogIiwgZm9vLmJhciwgIiwgdmFsdWUgb2YgZm9vLmZvbzogIiwgZm9vLmZvbyApOwovLyBJbnN0ZWFkIG9mIHRoaXM6CkxvZy5kZWJ1ZyggIlZhbHVlIG9mIGZvby5iYXI6ICIgKyBmb28uYmFyICsgIiwgdmFsdWUgb2YgZm9vLmZvbzogIiArIGZvby5mb28gKTsKICogCiAqIEBuYW1lc3BhY2UKICogQG5hbWUgTG9nCiAqLwp2YXIgTG9nID0gZnVuY3Rpb24oICkgewoKICAgIC8vIFN0b3JlIGEgY29weSB0byB0aGUgZnVuY3Rpb24gZnJvbSBMb2dDb3JlIC0gdGhlbiByZW1vdmUgaXQgZnJvbSB0aGUgZ2xvYmFsIHNjb3BlLgogICAgdmFyIExvZ0NvcmVfbG9nID0gX19Mb2dDb3JlX2xvZzsKICAgIGRlbGV0ZSB0aGlzLl9fTG9nQ29yZV9sb2c7CgogICAgLy8gUG9pbnRlciB0byBmdW5jdGlvbiB0aGF0IGNoZWNrcyBpZiBhIGdpdmVuIGxvZyBsZXZlbCBpcyBlbmFibGVkLiBPcHRpb25hbGx5IHN1cHBsaWVkIGJ5IExvZ0NvcmUuCiAgICB2YXIgTG9nQ29yZV9pc0xldmVsRW5hYmxlZCA9IHVuZGVmaW5lZDsKCiAgICAvLyBUaGUgb2JqZWN0IHRvIHJldHVybi4KICAgIHZhciB0aGF0ID0ge307ICAgIAogICAgCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gSGVscGVyIGZ1bmN0aW9uLgogICAgLy8gQ29sbGVjdCBhbiBhcmd1bWVudHMgb2JqZWN0IHRvIGEgc3RyaW5nLiBOb3RlLCBhcmdzIGlzICpub3QqIGFuIGFycmF5LCBidXQgYW4gaW5zdGFuY2Ugb2YgYW4gYXJndW1lbnRzIG9iamVjdC4KICAgIHZhciBjb2xsZWN0ID0gZnVuY3Rpb24oIGFyZ3MgKSB7CiAgICAgICAgc3dpdGNoKCBhcmdzLmxlbmd0aCApIHsKICAgICAgICBjYXNlIDA6IHJldHVybiAiIjsKICAgICAgICBjYXNlIDE6IHJldHVybiBhcmdzWzBdLnRvU3RyaW5nKCk7CiAgICAgICAgY2FzZSAyOiByZXR1cm4gYXJnc1swXS50b1N0cmluZygpICsgYXJnc1sxXS50b1N0cmluZygpOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHZhciBteXJlcyA9IGFyZ3NbMF07CiAgICAgICAgICAgIGZvciAoIHZhciBpID0gMTsgaSA8IGFyZ3MubGVuZ3RoOyArK2kgKSB7CiAgICAgICAgICAgICAgICBteXJlcyArPSBhcmdzWyBpIF0udG9TdHJpbmcoICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG15cmVzOwogICAgICAgIH07CiAgICB9OwoKICAgIC8vdGhpcyBpcyB0byBiZSBhYmxlIHRvIHRlc3QgdGhlIGludGVybmFsIGZ1bmN0aW9uIGNvbGxlY3QKICAgIHRoYXQuX19jb2xsZWN0ID0gY29sbGVjdDsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gSGVscGVyIGZ1bmN0aW9uLgogICAgLy8gQ29sbGVjdCBhbiBhcmd1bWVudHMgb2JqZWN0IHRvIGEgc3RyaW5nLiBOb3RlLCBhcmdzIGlzICpub3QqIGFuIGFycmF5LgogICAgLy8gVGhpcyB2ZXJzaW9uIGRvZXMgbm90IHRocm93LCBidXQgdHJpZXMgdG8gY29sbGVjdCBhcyBtdWNoIGFzIHBvc3NpYmx5CiAgICB2YXIgc2FmZUNvbGxlY3QgPSBmdW5jdGlvbiggYXJncyApIHsKICAgICAgICB2YXIgbXlyZXMgPSAiIjsKICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgKytpICkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgbXlyZXMgKz0gYXJnc1sgaSBdLnRvU3RyaW5nKCApOwogICAgICAgICAgICB9IGNhdGNoICggZSApIHsKICAgICAgICAgICAgICAgIG15cmVzICs9ICJbaWxsZWdhbC9udWxsL3VuZGVmaW5lZCB2YWx1ZSBhdCBwb3NpdGlvbiAiICsgaSArICJdIjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbXlyZXM7CiAgICB9OwoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBBY3R1YWwgbWV0aG9kcwoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBBY3R1YWwgbWV0aG9kcwogICAgLy8gQ29sbGVjdCB0aGUgYXJncywgdGhlbiBsb2cgdGhlbSB1c2luZyB0aGUgbGV2ZWwuCiAgICAvLyBOb3RlLCBhcmdzIGlzIG5vdCBhbiBhcnJheSwgYnV0IGFuIGluc3RhbmNlIG9mIGFuIGFyZ3VtZW50cyBvYmplY3QuCiAgICB2YXIgbG9nID0gZnVuY3Rpb24oIGxldmVsLCBhcmdzICkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIExvZ0NvcmVfbG9nKCBsZXZlbCwgY29sbGVjdCggYXJncyApICk7CiAgICAgICAgfSBjYXRjaCAoIGVycm9yICkgewogICAgICAgICAgICB2YXIgbXNnID0gIkVycm9yIHdoaWxlIGNhbGxpbmcgZm9ybWF0dGluZyBsb2cuIE9uZSBvciBtb3JlIHZhbHVlcyBwYXNzZWQgdG8gbG9nIHdhcyBwcm9iYWJseSBudWxsIG9yIHVuZGVmaW5lZC4gU3Vic3RpdHV0ZWQgbGluZSBmb2xsb3dzOlxuIjsKICAgICAgICAgICAgbXNnICs9IHNhZmVDb2xsZWN0KCBhcmdzICkgKyAiXG4iOwogICAgICAgICAgICBpZiAoIGVycm9yLnN0YWNrICYmICIiICE9IGVycm9yLnN0YWNrICkgewogICAgICAgICAgICAgICAgbXNnICs9ICJEaXNwbGF5aW5nIHN0YWNrOiAiICsgZXJyb3Iuc3RhY2sucmVwbGFjZSggLyhAW146XFtdKjopL2csICJcbiQxIiApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIExvZ0NvcmVfbG9nKCAid2FybiIsIG1zZyApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfTsKCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBBY3R1YWwgdXNlciBleHBvc2VkIGZ1bmN0aW9ucy9zdHVmZgogICAgCiAgICAvLyBTZXR0aW5nIHVwIGxldmVsIHByb3BlcnRpZXMKICAgIC8qKiAKICAgICAqIEVudW0gZm9yIGxvZyBsZXZlbHMuCiAgICAgKiAKICAgICAqIFVzZSB0aGlzIGVudW0gd2hlbiBjYWxsaW5nIGlzTGV2ZWxFbmFibGVkLgogICAgICogCiAgICAgKiBUaGlzIGVudW0gaGFzIHByb3BlcnRpZXMgYHRyYWNlYCwgYGRlYnVnYCwgYGluZm9gLCBgd2FybmAgYW5kIGBlcnJvcmAuIFVzZSB0aGVtIHdoZW4gY2FsbGluZyBpc0xldmVsRW5hYmxlZC4KICAgICAqIAogICAgICogQHNlZSB7QGxpbmsgTG9nLmlzTGV2ZWxFbmFibGVkfQogICAgICogQGV4YW1wbGUKLy8gQ2hlY2sgaWYgaW5mbyBsZXZlbCBpcyBlbmFibGVkLCB0aGVuIGxvZy4KaWYgKCBMb2cuaXNMZXZlbEVuYWJsZWQoIExvZy5MZXZlbC5pbmZvICkgKSB7CiAgICBMb2cuaW5mbyggIlRoZSByZXN1bHQgb2YgY2FsbGluZyBzbG93X2Z1bmN0aW9uIGlzIDogIiwgc2xvd19mdW5jdGlvbigpICk7Cn0KICAgICAqIAogICAgICogQHJlYWRvbmx5CiAgICAgKiBAZW51bSB7U3RyaW5nfQogICAgICogQG5hbWUgTG9nLkxldmVsCiAgICAgKi8KICAgIHRoYXQuTGV2ZWwgPSB7IAogICAgICAgICAgICAvKiogVGhlIHRyYWNlIGxldmVsICovCiAgICAgICAgICAgIHRyYWNlIDogInRyYWNlIiwgCiAgICAgICAgICAgIC8qKiBUaGUgZGVidWcgbGV2ZWwgKi8KICAgICAgICAgICAgZGVidWcgOiAiZGVidWciLAogICAgICAgICAgICAvKiogVGhlIGluZm8gbGV2ZWwgKi8KICAgICAgICAgICAgaW5mbyAgOiAiaW5mbyIsIAogICAgICAgICAgICAvKiogVGhlIHdhcm4gbGV2ZWwgKi8KICAgICAgICAgICAgd2FybiAgOiAid2FybiIsCiAgICAgICAgICAgIC8qKiBUaGUgZXJyb3IgbGV2ZWwgKi8KICAgICAgICAgICAgZXJyb3IgOiAiZXJyb3IiCiAgICB9OwogICAgCiAgIC8qKgogICAgKiAgQ2hlY2sgaWYgYSBsb2cgbGV2ZWwgaXMgZW5hYmxlZC4KICAgICogIAogICAgKiAgUmV0dXJuIHRydWUgaWYgYSBsb2cgbGV2ZWwgaXMgZW5hYmxlZCwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgKiAgCiAgICAqICBUaGlzIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIHdoZW4gbG9nZ2luZyBvYmplY3RzIHRoYXQgYXJlIGV4cGVuc2l2ZSB0byBldmFsdWF0ZSB3aGVuIHBhc3NpbmcgdG8gdGhlIGxvZyBzeXN0ZW0uCiAgICAqICBCeSBvbmx5IGNvbmRpdGlvbmFsbHkgZXZhbHVhdGluZywgeW91IGNhbiBtYWtlIHRoZSBwcm9ncmFtIGdvIGZhc3Rlciwgd2hpY2ggY2FuIGJlIGhhbmR5IGluIHNvbWUgc2l0dWF0aW9ucy4KICAgICogIAogICAgKiAgKipOb3RlOioqIFlvdSBkbyBub3QgbmVlZCB0aGlzIGluIG1vc3Qgc2l0dWF0aW9ucywgb25seSB3aGVuIHlvdSBuZWVkIHRvIGNhbGwgc2xvdyBmdW5jdGlvbnMsIG9yIHNpbWlsYXIsIGluIGNhc2Ugb2YgbG9nZ2luZy4gVGhlIExvZyBvYmplY3Qgb25seSBjYWxscyB0aGUgdW5kZXJseWluZyBMb2cgZnJhbWV3b3JrLCBpZiBpdCBuZWVkcyB0by4KICAgICogIAogICAgKiAgKipOb3RlOioqIFRoaXMgZnVuY3Rpb25hbGl0eSByZXF1aXJlcyB0aGUgdW5kZXJseWluZyBMb2cgZnJhbWV3b3JrIHRvIHN1cHBvcnQgcmV0cmVpdmluZyB0aGlzIGtpbmQgb2YgaW5mb3JtYXRpb24uCiAgICAqICAKICAgICAqIEBzZWUge0BsaW5rIExvZy5MZXZlbH0KICAgICogIEBleGFtcGxlCi8vIE9ubHkgcGVyZm9ybSBldmFsdWF0aW9uLCBpZiBsb2cgbGV2ZWwgaXMgZW5hYmxlZAppZiAoIExvZy5pc0xldmVsRW5hYmxlZCggTG9nLkxldmVsLmRlYnVnICkgKSB7CiAgICBMb2cuZGVidWcoICJUaGUgcmVzdWx0IG9mIGNhbGxpbmcgc2xvd19mdW5jdGlvbiBpcyA6ICIsIHNsb3dfZnVuY3Rpb24oKSApOwp9CiAgICAqICAKICAgICogIEBleGFtcGxlCi8vIE5vIHJlYXNvbiB0byB1c2UgaW4gb3JkaW5hcnkgY2FzZQovLyBEb24ndCBkbyB0aGlzIG5vcm1hbGx5CmlmICggTG9nLmlzTGV2ZWxFbmFibGVkKCBMb2cuTGV2ZWwuZGVidWcgKSApIHsKICAgIExvZy5kZWJ1ZyggIkkgbmVlZCB0byBsb2cgdGhlIHZhbHVlIG9mIHNvbWV0aGluZyA6Iiwgc29tZV92YWx1ZSApOwp9Ci8vIEluc3RlYWQsIGRvIHRoaXMKTG9nLmRlYnVnKCAiSSBuZWVkIHRvIGxvZyB0aGUgdmFsdWUgb2Ygc29tZXRoaW5nIDoiLCBzb21lX3ZhbHVlICk7CiAgICAqCiAgICAqICBAc3ludGF4IExvZy5pc0xldmVsRW5hYmxlZCggbGV2ZWwgKQogICAgKiAgQHBhcmFtIGxldmVsIFRoZSBsZXZlbCB0byBldmFsdWF0ZS4gVXNlIHRoZSBMZXZlbCBwcm9wZXJ0eSBjb25zdGFudHMuCiAgICAqICBAcmV0dXJuIHtCb29sZWFufSBUcnVlIGlmIHRoZSBsb2cgbGV2ZWwgaXMgZW5hYmxlZCwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgKiAgCiAgICAqICBAbmFtZSBMb2cuaXNMZXZlbEVuYWJsZWQKICAgICogIEBtZXRob2QKICAgICovICAgICAKICAgIHRoYXQuaXNMZXZlbEVuYWJsZWQgPSBmdW5jdGlvbiggbGV2ZWwgKSB7CiAgICAgICAgcmV0dXJuIExvZ0NvcmVfaXNMZXZlbEVuYWJsZWQoIGxldmVsICk7CiAgICB9CiAgICAKICAgIAogICAvKioKICAgKiBMb2cgYSBtZXNzYWdlIGF0IGB0cmFjZWAgbGV2ZWwuCiAgICogCiAgICogVXNlIHRoZSB0cmFjZSBmdW5jdGlvbiB0byBsb2cgdmVyeSBkZXRhaWxlZCBpbmZvcm1hdGlvbiwgc3VjaCBhcwogICAqIGVudGVyaW5nL2xlYXZpbmcgZnVuY3Rpb25zLCB2YWx1ZXMgb2YgcGFyYW1ldGVycywgZXRjLiBNb3N0IG9mdGVuIHVzZWQKICAgKiBhcyBhIGRldGFpbGVkIGRlYnVnIGZhY2lsaXR5IGZvciBhIHNwZWNpZmljIHByb2JsZW0gCiAgICogCiAgICogQHN5bnRheCBMb2cudHJhY2UoIGFyZywgLi4uICkKICAgKiBAcGFyYW0gey4uLk9iamVjdH0gYXJnIFRoZSBhcmd1bWVudChzKSB0byBsb2cuIE11c3QgYmUgY29udmVydGFibGUgdG8gU3RyaW5nCiAgICogQG5hbWUgTG9nLnRyYWNlCiAgICogQG1ldGhvZAogICAqIEBleGFtcGxlCkxvZy50cmFjZSggIkVudGVyaW5nIGZ1bmN0aW9uIGZvbywgd2l0aCBwYXJhbXRlciBiYXI9IiwgYmFyICk7CiAgICovCiAgICB0aGF0LnRyYWNlID0gZnVuY3Rpb24oICkgewoJaWYgKCBMb2dDb3JlX2lzTGV2ZWxFbmFibGVkKCAidHJhY2UiICkgKSB7CiAgICAgICAgICAgIGxvZyggInRyYWNlIiwgYXJndW1lbnRzICk7Cgl9OwogICAgfTsKICAgIC8qKgogICAqIExvZyBhIG1lc3NhZ2UgYXQgYGRlYnVnYCBsZXZlbC4KICAgKiAKICAgKiBVc2UgdGhlIGRlYnVnIGZ1bmN0aW9uIHRvIGxvZyBkZWJ1ZyBpbmZvcm1hdGlvbiwgc3VjaCBhcyB0b3BsZXZlbAogICAqIHByb2dyYW0gZmxvdywgaW1wb3J0YW50IHZhbHVlcyB0aGF0IGluZmx1ZW5jZXMgdGhlIHByb2dyYW0sIGV0Yy4gCiAgICogCiAgICogQHN5bnRheCBMb2cuZGVidWcoIGFyZywgLi4uICkKICAgKiBAcGFyYW0gey4uLk9iamVjdH0gYXJnIFRoZSBhcmd1bWVudChzKSB0byBsb2cuIE11c3QgYmUgY29udmVydGFibGUgdG8gU3RyaW5nCiAgICogQG5hbWUgTG9nLmRlYnVnCiAgICogQG1ldGhvZAogICAqIEBleGFtcGxlCkxvZy5kZWJ1ZyggIlNlcnZpY2UgcmV0dXJuZWQgdGhlIGZvbGxvd2luZyBhbnN3ZXI6ICIsIHNlcnZpY2VBbnN3ZXIgKTsKICAgKi8KICAgIHRoYXQuZGVidWcgPSBmdW5jdGlvbiggKSB7CglpZiAoIExvZ0NvcmVfaXNMZXZlbEVuYWJsZWQoICJkZWJ1ZyIgKSApIHsKICAgICAgICAgICAgbG9nKCAiZGVidWciLCBhcmd1bWVudHMgKTsKCX07CiAgICB9OwogICAgLyoqCiAgICogTG9nIGEgbWVzc2FnZSBhdCBgaW5mb2AgbGV2ZWwuCiAgICogCiAgICogVXNlIHRoZSBpbmZvIGZ1bmN0aW9uIHRvIGxvZyBpbmZvcm1hdGlvbiBvZiBhICdzdGF0dXMnIGxpa2UgdHlwZSwgc3VjaAogICAqIGFzIHN0YXRlIGNoYW5nZXMsIGhvdyBmYXIgYSBnaXZlbiBwcm9jZXNzIGhhcyBwcm9ncmVzc2VkLCBldGMuIAogICAqIAogICAqIEBzeW50YXggTG9nLmluZm8oIGFyZywgLi4uICkKICAgKiBAcGFyYW0gey4uLk9iamVjdH0gYXJnIFRoZSBhcmd1bWVudChzKSB0byBsb2cuIE11c3QgYmUgY29udmVydGFibGUgdG8gU3RyaW5nCiAgICogQG5hbWUgTG9nLmluZm8KICAgKiBAbWV0aG9kCiAgICogQGV4YW1wbGUKTG9nLmluZm8oICJUYXNrIHdpdGggdGFza0lkICIsIHRhc2tJZCwgIiBub3cgZG9uZSBhbmQgdW5sb2FkZWQiICk7CiAgICovCiAgICB0aGF0LmluZm8gPSBmdW5jdGlvbiggKSB7CglpZiAoIExvZ0NvcmVfaXNMZXZlbEVuYWJsZWQoICJpbmZvIiApICkgewogICAgICAgICAgICBsb2coICJpbmZvIiwgYXJndW1lbnRzICk7Cgl9OwogICAgfTsKICAgIC8qKgogICAqIExvZyBhIG1lc3NhZ2UgYXQgYHdhcm5gIGxldmVsLgogICAqIAogICAqIFVzZSB0aGUgd2FybiBmdW5jdGlvbiB0byBsb2cgd2FybmluZ3MgYWJvdXQgZXhwZWN0YXRpb25zIHRoYXQgaGF2ZSBub3QKICAgKiBiZWVuIG1ldCwgYnV0IHRoYXQgdGhlIHByb2dyYW0gaXMgc3RpbGwgYWJsZSB0byB3b3JrIGFyb3VuZC4gVGhlCiAgICogcHJvYmxlbSBzaG91bGQgbm90IGhhdmUgYSBiaWcgaW1wYWN0IG9uIHRoZSBwcm9jZXNzLCBidXQgYSB3YXJuaW5nCiAgICogc2hvdWxkIGluZGljYXRlIHRoYXQgdGhlIHVzZXIgbWF5IHdhbnQgdG8gaW52ZXN0aWdhdGUgaWYgdGhlIHdhcm5pbmcgaXMKICAgKiBhIHN5bXB0b20gb2Ygc29tZXRoaW5nIHRoYXQgc2hvdWxkIGJlIGNvcnJlY3RlZC4gCiAgICogCiAgICogQHN5bnRheCBMb2cud2FybiggYXJnLCAuLi4gKQogICAqIEBwYXJhbSB7Li4uT2JqZWN0fSBhcmcgVGhlIGFyZ3VtZW50KHMpIHRvIGxvZy4gTXVzdCBiZSBjb252ZXJ0YWJsZSB0byBTdHJpbmcKICAgKiBAbmFtZSBMb2cud2FybgogICAqIEBtZXRob2QKICAgKiBAZXhhbXBsZQpMb2cud2FybiggIk5vIHJlc3BvbnNlIGZyb20gc2VydmljZSAtIHdpbGwgcmV0cnkgaW4gNSBtaW51dGVzIiApOwogICAqLwogICAgdGhhdC53YXJuID0gZnVuY3Rpb24oICkgewoJaWYgKCBMb2dDb3JlX2lzTGV2ZWxFbmFibGVkKCAid2FybiIgKSApIHsKICAgICAgICAgICAgbG9nKCAid2FybiIsIGFyZ3VtZW50cyApOwoJfTsKICAgIH07CiAgICAvKioKICAgKiBMb2cgYSBtZXNzYWdlIGF0IGBlcnJvcmAgbGV2ZWwuCiAgICogCiAgICogVXNlIHRoZSBlcnJvciBmdW5jdGlvbiB0byBsb2cgZXJyb3JzIGZvciBhIGdpdmVuIHByb2Nlc3MgdGhhdCB0aGUKICAgKiBwcm9ncmFtIGNhbiBub3QgY29ycmVjdC4gQW4gZXJyb3IgaW5kaWNhdGVzIHRoYXQgdGhlIGdpdmVuIHRhc2sgYXQgaGFuZAogICAqIGNhbiBub3QgYmUgY29tcGxldGVkLiBIb3dldmVyLCBvdGhlciB0YXNrcyBtYXkgdmVyeSB3ZWxsIGJlIGFibGUgdG8gYmUKICAgKiBwcm9jZXNzZWQuIFRoZSB1c2VyIHNob3VsZCBkZWZpbml0aXZlbHkgaW52ZXN0aWdhdGUgdGhlIHJlYXNvbiBmb3IgdGhlCiAgICogZXJyb3IgYW5kIGlmIHBvc3NpYmx5IGNvcnJlY3QgaXQuIAogICAqIAogICAqIEBzeW50YXggTG9nLmVycm9yKCBhcmcsIC4uLiApCiAgICogQHBhcmFtIHsuLi5PYmplY3R9IGFyZyBUaGUgYXJndW1lbnQocykgdG8gbG9nLiBNdXN0IGJlIGNvbnZlcnRhYmxlIHRvIFN0cmluZwogICAqIEBuYW1lIExvZy5lcnJvcgogICAqIEBtZXRob2QKICAgKiBAZXhhbXBsZQpMb2cuZXJyb3IoICJFcnJvciB3aGVuIGhhbmRsaW5nIHRhc2s6IHRhc2t0eXBlIHdhcyBlbXB0eS4gVGFzayBjYW4gbm90IGJlIGhhbmRsZWQiICk7CiAgICovCiAgICB0aGF0LmVycm9yID0gZnVuY3Rpb24oICkgewoJaWYgKCBMb2dDb3JlX2lzTGV2ZWxFbmFibGVkKCAiZXJyb3IiICkgKSB7CiAgICAgICAgICAgIGxvZyggImVycm9yIiwgYXJndW1lbnRzICk7Cgl9OwogICAgfTsKCiAgLyoqCiAgICogTG9nIGEgbWVzc2FnZSBhdCBgZmF0YWxgIGxldmVsLgogICAqIAogICAqIFVzZSB0aGUgZmF0YWwgZnVuY3Rpb24gdG8gbG9nIGEgZmF0YWwgcHJvYmxlbSwgdGhhdCBzdG9wcyB0aGUgcHJvZ3JhbQogICAqIGZyb20gYmVpbmcgYWJsZSB0byBwcm9jZWVkIGF0IGFsbCwgb3Igd2l0aG91dCByaXNrIG9mIHNldmVyZQogICAqIHByb2JsZW1zL2NvcnJ1cHRpb24gb2YgZGF0YS4gSXQgaXMgcHJvYmFibHkgbm90IGEgZnVuY3Rpb24gbXVjaCB1c2VkCiAgICogZnJvbSBKYXZhU2NyaXB0LiAKICAgKiAKICAgKiAqKk5vdGU6KiogTm90IGFsbCBsb2cgZnJhbWV3b3JrcyBzdXBwb3J0cyB0aGUgZmF0YWwgbGV2ZWwuIEluIHRoYXQgY2FzZSwgaXQgd2lsbCBiZSBjb252ZXJ0ZWQgdG8gYW4gZXJyb3IgbGV2ZWwuCiAgICogCiAgICogQHN5bnRheCBMb2cuZmF0YWwoIGFyZywgLi4uICkKICAgKiBAcGFyYW0gey4uLk9iamVjdH0gYXJnIFRoZSBhcmd1bWVudChzKSB0byBsb2cuIE11c3QgYmUgY29udmVydGFibGUgdG8gU3RyaW5nCiAgICogQG5hbWUgTG9nLmZhdGFsCiAgICogQG1ldGhvZAogICAqIEBleGFtcGxlCkxvZy5mYXRhbCggIkNvbmZpZ3VyYXRpb24gZXJyb3IgaW4gc29tZW9iamVjdC5zb21ldmFsdWUuIFRoaXMgb3B0aW9uIHdhcyBpbmNvcnJlY3RseSBzZXQuIEFib3J0aW5nIiApOwogICAqLwogICAgdGhhdC5mYXRhbCA9IGZ1bmN0aW9uKCApIHsKCWlmICggTG9nQ29yZV9pc0xldmVsRW5hYmxlZCggImZhdGFsIiApICkgewogICAgICAgICAgICBsb2coICJmYXRhbCIsIGFyZ3VtZW50cyApOwoJfTsKICAgIH07CgogICAgLyoqCiAgICAgKiBMb2cgYSBtZXNzYWdlIGF0IGBtYWdpY2AgbGV2ZWwuCiAgICAgKiAKICAgICAqIFRoZSBtYWdpYyBmdW5jdGlvbiBpcyBhIHNwZWNpYWwgbG9nIGZ1bmN0aW9uLiBJdCBpcyB1c2VkIHRvIGxvZyBhCiAgICAgKiBmdW5jdGlvbiBjYWxsIHdpdGggdGhlIHBhcmFtZXRlcnMsIHdoZXJlIHRoZSBwYXJhbWV0ZXJzIHdpbGwgYmUKICAgICAqICdtYWdpY2FsbHknIGV2YWx1YXRlZCBiZWZvcmUgcHJpbnRlZC4gVGhlIGxldmVsIGlzICdtYWdpYycsIGFuZCB0aGUKICAgICAqIGZlYXR1cmUgaXMgZXhwZXJpbWVudGFsLCBhbmQgbWF5IG5vdCBtYWtlIGl0IHRvIHByb2R1Y3Rpb24uIAogICAgICogCiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgZXhwZXJpbWVudGFsLgogICAgICoKICAgICAqIEBwYXJhbSB7WE1MfSBhcmcgVGhlIGFyZ3VtZW50IHRvIGxvZy4gTXVzdCBiZSBYTUwKICAgICAqIEBuYW1lIExvZy5tYWdpYwogICAgICogQG1ldGhvZAogICAgICovCiAgICB0aGF0Lm1hZ2ljID0gZnVuY3Rpb24oIHhtbCApIHsKICAgICAgICAvLyBUaGlzIGZ1bmN0aW9uIGNoZWNrcyB0aGUgY29udGVzdCAKICAgICAgICBpZiAoIHR5cGVvZiB4bWwgIT09ICJ4bWwiICkgewogICAgICAgICAgICBsb2coICJ3YXJuIiwgIm1hZ2ljIGNhbGxlZCB3aXRoIG5vbiB4bWwgYXJndW1lbnQ6ICIsIHhtbCApOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcGFyYW1Ub1N0cmluZyggKSB7CiAgICAgICAgICAgIHJlcyA9IFsgXTsKICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgKytpICkgewogICAgICAgICAgICAgICAgLy8gU3BlY2lhbGNhc2UgdW5kZWZpbmVkIC0gaWYgc29tZXRoaW5nIHJldHVybnMgdW5kZWZpbmVkCiAgICAgICAgICAgICAgICBpZiAoIGFyZ3VtZW50c1sgaSBdID09PSB1bmRlZmluZWQgKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzLnB1c2goICJ1bmRlZmluZWQiICk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBTcGVjaWFsY2FzZSBhcnJheXMsIGFzIHRoZWlyIHRvU3RyaW5nIG1ldGhvZCBpcyBhIGJpdCB3YWNreQogICAgICAgICAgICAgICAgaWYgKCBfLmlzQXJyYXkoIGFyZ3VtZW50c1sgaSBdICkgKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzLnB1c2goICJbICIgKyBhcmd1bWVudHNbIGkgXS50b1N0cmluZyggKSArICIgXSIgKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICggdHlwZW9mIGFyZ3VtZW50c1sgaSBdID09PSAic3RyaW5nIiApIHsKICAgICAgICAgICAgICAgICAgICByZXMucHVzaCggJyInICsgYXJndW1lbnRzWyBpIF0udG9TdHJpbmcoICkgKyAnIicgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmVzLnB1c2goIGFyZ3VtZW50c1sgaSBdLnRvU3RyaW5nKCApICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlcy5qb2luKCAiLCAiICk7CiAgICAgICAgfQoKICAgICAgICBjb250ZW50ID0geG1sLnRvU3RyaW5nKCApOwogICAgICAgIC8vIFJlcGxhY2UgdXB0byB0aGUgZmlyc3QgKCB3aXRoIHBhcmFtVG9TdHJpbmcsIGV2YWwgaXQsIGFuZCBwcmludCBpdAogICAgICAgIC8vIGNibzogZmVlbCBmcmVlIHRvIHJlcGxhY2UgdGhpcyB3aXRoIHNvbWV0aGluZyBjbGV2ZXIgdXNpbmcgcmVnZXhwcy4uLgogICAgICAgIGFsbCA9IGNvbnRlbnQuc3BsaXQoICIoIiApOwogICAgICAgIGZ1bmMgPSBhbGwuc2hpZnQoICk7CiAgICAgICAgcmVwbGFjZSA9ICJwYXJhbVRvU3RyaW5nKCIgKyBhbGwuam9pbiggIigiICk7CiAgICAgICAgbmV3YXJncyA9IGV2YWwoIHJlcGxhY2UgKTsKICAgICAgICBjb21wbGV0ZSA9IGZ1bmMgKyAiKCAiICsgbmV3YXJncyArICIgKSI7CiAgICAgICAgbG9nKCAibWFnaWMiLCBbICJGdW5jdGlvbiB3YXMgY2FsbGVkIGxpa2UgdGhpczpcbiIsIGNvbnRlbnQsICJcbkFmdGVyIHBhcmFtZXRlciBldmFsdWF0aW5nOlxuIiwgY29tcGxldGUgXSApOwogICAgfTsKCgogIC8qKgogICAqIFdyYXAgYW4gb2JqZWN0IHNvIGl0IGRvZXMgbm90IHByb2R1Y2UgYSB3YXJuaW5nIGluIHRoZSBsb2cgaWYgdGhlIHZhbHVlIGlzIG51bGwgb3IgdW5kZWZpbmVkLgogICAqCiAgICogTm9ybWFsbHkgbG9nZ2luZyBhbiB1bmRlZmluZWQgb3IgbnVsbCB2YWx1ZSBwcm9kdWNlcyBhIHdhcm5pbmcgaW4gdGhlIGxvZyBmaWxlIGluY2x1ZGluZyBhIHN0YWNrIHRyYWNlCiAgICogZm9yIHRoZSBsb2dnaW5nIHBvc2l0aW9uLiBJZiBhIHZhbHVlIGlzIGFsbG93ZWQgdG8gYmUgdW5kZWZpbmVkLCB0aGlzIHdhcm5pbmcgY2FuIGJlIGF2b2lkZWQgYnkgd3JhcHBpbmcKICAgKiB0aGUgdmFsdWUgaW4gc2FmZVZhbHVlLgogICAqCiAgICogSXQgZG9lcyB0aGlzIGJ5IHdyYXBwaW5nIHRoZSBvYmplY3QgaW4gYSB0ZW1wb3Jhcnkgb2JqZWN0IGltcGxlbWVudGluZyB0b1N0cmluZyB3aXRoIGNoZWNrcyBmb3IgbnVsbC91bmRlZmluZWQKICAgKgogICAqIEBzeW50YXggTG9nLnNhZmVWYWx1ZSh2YWx1ZSkKICAgKiBAcGFyYW0ge09iamVjdHxVbmRlZmluZWR9IHZhbHVlIFRoZSB2YWx1ZSB0byB3cmFwLiBNdXN0IGJlIGNvbnZlcnRhYmxlIHRvIFN0cmluZyBvciBudWxsL3VuZGVmaW5lZAogICAqIEBuYW1lIExvZy5zYWZlVmFsdWUKICAgKiBAbWV0aG9kCiAgICogQGV4YW1wbGUKTG9nLmRlYnVnKCAiVmFsdWUgaXMgIiwgTG9nLnNhZmVWYWx1ZSggdmFsdWUgKSApOwogICAqLwoKICAgIHRoYXQuc2FmZVZhbHVlID0gZnVuY3Rpb24oIHZhbHVlICkgewogICAgICAgIHZhciByZXMgPSB7fTsKICAgICAgICByZXMudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICggdmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgcmV0dXJuICI8dW5kZWZpbmVkPiI7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICBpZiAoIHZhbHVlID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIjxudWxsPiI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUudG9TdHJpbmcoKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgcmV0dXJuIHJlczsKICAgIH07CgogICAgLy8gU2V0dXAgdGhlIHR3byAiYWR2YW5jZWQiIGZ1bmN0aW9ucyBmcm9tIGFib3ZlCiAgICBpZiAoIHRoaXMuX19Mb2dDb3JlX2lzTGV2ZWxFbmFibGVkICkgewoJTG9nQ29yZV9pc0xldmVsRW5hYmxlZCA9IF9fTG9nQ29yZV9pc0xldmVsRW5hYmxlZDsKCWRlbGV0ZSB0aGlzLl9fTG9nQ29yZV9pc0xldmVsRW5hYmxlZDsKICAgIH0gZWxzZSB7CgkvLyBEdW1teSBmdW5jdGlvbiAtIGFsbCBpcyB0cnVlCglMb2dDb3JlX2lzTGV2ZWxFbmFibGVkID0gZnVuY3Rpb24oIGxldmVsICkgeyByZXR1cm4gdHJ1ZTsgfQogICAgICAgIC8vIG1iZDogMjAxMy0xMC0zMQogICAgICAgIC8vIFRoZSBDKysgbG9nZ2luZyBmcmFtZXdvcmsgZG9lcyBub3QsIGFuZCBwcm9iYWJseSB3aWxsIG5vdCwgc3VwcG9ydCBzb21ldGhpbmcKICAgICAgICAvLyBsaWtlIGlzTGV2ZWxFbmFibGVkLCBhbmQgaXQgaXMgYWxzbyBzcGVlZHkgZW5vdWdoIHRvIG5vdCBtYXR0ZXIuCiAgICAgICAgLy8gVGhlIGNoZWNrIHRoZW4gZW5kcyB1cCBhZGRpbmcgYSBsb3Qgb2Ygbm9pc2UgaW50byBzb21lIGFwcGxpY2F0aW9ucywgc3VjaCBhcyAKICAgICAgICAvLyBlc2dhcm90aCwgd2hlcmUgYSB3YXJuaW5nIGlzIGxvZ2dlZCBmb3IgZWFjaCBKYXZhU2NyaXB0IGVudmlyb25tZW50IGNyZWF0ZWQuCiAgICAgICAgLy8gU28sIGl0IGlzIGJlc3Qgbm90IHRvIGRvIHRoaXMgY2hlY2sgdW5kZXIgQysrLgogICAgICAgIC8vIEJ1dCwgaWYgdGhpcyBpcyBKYXZhLCBjaGVjayBpZiB0aGUgcGVyZm9ybWFuY2UgY291bGQgYmUgaW1wcm92ZWQgYnkgCiAgICAgICAgLy8gYWRkaW5nIGEgIm5hdGl2ZSIgX19Mb2dDb3JlX2lzTGV2ZWxFbmFibGVkIGZ1bmN0aW9uLgogICAgICAgIC8vIFRoaXMgY2hlY2sgaXMgYW4gZXhjZXB0aW9uIHRvIHRoZSBydWxlIHRoYXQgd2UgZG8gbm90IGNoZWNrIGZvciBwbGF0Zm9ybXMgaW4gbm9uICpDb3JlIG1vZHVsZXMuCiAgICAgICAgLy8gWW91IGFyZSBub3QgZW50aXRsZWQgdG8gZG8gdGhpcyBvdGhlciBwbGFjZXMuIEZlZWwgZnJlZSB0byBjb21wbGFpbiBhYm91dCB0aGlzIHVuZmFpcm5lc3Mgb2YgbGlmZQogICAgICAgIC8vIG9uIHlvdXIgZmF2b3JpdGUgc29jaWFsIG5ldHdvcmssIG9yIHNvbWV0aGluZywgYXMgbG9uZyBhcyB5b3UgZG9uJ3QgZXhwZWN0IGFueW9uZSB0byBjYXJlLi4uIDstKQogICAgICAgIGlmICggR2xvYmFsLlBhY2thZ2VzICYmIEdsb2JhbC5QYWNrYWdlcy5qYXZhICkgewogICAgICAgICAgICB0aGF0Lndhcm4oICJKYXZhIGludGVycHJlbnRlciBkZXRlY3RlZCwgYW5kIExvZ0NvcmUgbW9kdWxlIGRvZXMgbm90IGV4cG9ydCBfX0xvZ0NvcmVfaXNMZXZlbEVuYWJsZWQgLSBtYXkgaW1wYWN0IGxvZ2dpbmcgcGVyZm9ybWFuY2UiICk7CiAgICAgICAgfSAKICAgIH0KCgogICAgLy8gUmV0dXJuIHRoZSBMb2cgb2JqZWN0CiAgICByZXR1cm4gdGhhdDsKfSggKTsKCg==", "moduleName": "Log"}, {"javascript": "Ly8gTG9nQ29yZSBtb2R1bGUgLSBpbXBsZW1lbnRzIGEgX19Mb2dDb3JlX2xvZyggbGV2ZWwsIGFyZ3MgKSBmdW5jdGlvbgoKLyogSmF2YSBNYXZlbiBkZXBzIG5lZWRlZDoKCiAgICAgICAgICAgICAgICA8IS0tIExPR0dJTkcgLS0+CiAgICAgICAgICAgICAgICA8IS0tIEluIG9yZGVyIHRvIHN1cHBvcnQgZGlmZmVyZW50IGxvZyBmcmFtZXdvcmtzLCB3ZSB1c2UgYSBmYWNhZGUgcGF0dGVybiAKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGxvZ2dpbmcgVGhlIGFjdHVhbCBmYWNhZGUgcGF0dGVybiBpcyBzbGY0aiwgd2hpY2ggaXMgd2hhdCBkYmMtY29tbW9ucyAKICAgICAgICAgICAgICAgICAgICAgICAgaXMgZ29pbmcgdG8gdXNlIHRvby4gRm9yIGFjdHVhbCBsb2dnaW5nIGluIHRoZSBkZXBsb3ltZW50LCB3ZSB1c2UgbG9nNGouIC0tPgogICAgICAgICAgICAgICAgPGRlcGVuZGVuY3k+CiAgICAgICAgICAgICAgICAgICAgICAgIDxncm91cElkPm9yZy5zbGY0ajwvZ3JvdXBJZD4KICAgICAgICAgICAgICAgICAgICAgICAgPGFydGlmYWN0SWQ+c2xmNGotYXBpPC9hcnRpZmFjdElkPgogICAgICAgICAgICAgICAgICAgICAgICA8dmVyc2lvbj4xLjYuMTwvdmVyc2lvbj4KICAgICAgICAgICAgICAgIDwvZGVwZW5kZW5jeT4KICAgICAgICAgICAgICAgIDxkZXBlbmRlbmN5PgogICAgICAgICAgICAgICAgICAgICAgICA8Z3JvdXBJZD5vcmcuc2xmNGo8L2dyb3VwSWQ+CiAgICAgICAgICAgICAgICAgICAgICAgIDxhcnRpZmFjdElkPnNsZjRqLWV4dDwvYXJ0aWZhY3RJZD4KICAgICAgICAgICAgICAgICAgICAgICAgPHZlcnNpb24+MS42LjE8L3ZlcnNpb24+CiAgICAgICAgICAgICAgICA8L2RlcGVuZGVuY3k+IAoqLwoKLyogWW91IG1heSBhbHNvIHdhbnQgdG8gYWN0dWFsbHkgYmluZCB0byBlLmcuIGxvZzRqOgoKICAgICAgICAgICAgICAgIDwhLS0gVGhpcyBvbmUgYmluZHMgdG8gbG9nNGogaW4gdGhlIGRlcGxveW1lbnQuIC0tPgogICAgICAgICAgICAgICAgPGRlcGVuZGVuY3k+CiAgICAgICAgICAgICAgICAgICAgICAgIDxncm91cElkPm9yZy5zbGY0ajwvZ3JvdXBJZD4KICAgICAgICAgICAgICAgICAgICAgICAgPGFydGlmYWN0SWQ+c2xmNGotbG9nNGoxMjwvYXJ0aWZhY3RJZD4KICAgICAgICAgICAgICAgICAgICAgICAgPHZlcnNpb24+MS42LjE8L3ZlcnNpb24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzY29wZT5ydW50aW1lPC9zY29wZT4KICAgICAgICAgICAgICAgIDwvZGVwZW5kZW5jeT4KICAgICAgICAgICAgICAgIDwhLS0gSW4gbG9nIHdlIHRydXN0IDogaHR0cDovL2xvZ2dpbmcuYXBhY2hlLm9yZy9sb2c0ai8gLS0+CiAgICAgICAgICAgICAgICA8ZGVwZW5kZW5jeT4KICAgICAgICAgICAgICAgICAgICAgICAgPGdyb3VwSWQ+bG9nNGo8L2dyb3VwSWQ+CiAgICAgICAgICAgICAgICAgICAgICAgIDxhcnRpZmFjdElkPmxvZzRqPC9hcnRpZmFjdElkPgogICAgICAgICAgICAgICAgICAgICAgICA8dmVyc2lvbj4xLjIuMTY8L3ZlcnNpb24+CiAgICAgICAgICAgICAgICA8L2RlcGVuZGVuY3k+CiAgICAgICAgICAgICAgICA8IS0tIEVORCBMT0dHSU5HIC0tPgoqLwoKCi8vIFdlIGV4cG9ydCB0aGlzIHN5bWJvbCwgd2hpY2ggd2UgZXhwZWN0IHRvIGJlIHVzZWQgZnJvbSBhIExvZyBtb2R1bGUuCkVYUE9SVEVEX1NZTUJPTFMgPSBbICdfX0xvZ0NvcmVfbG9nJywgJ19fTG9nQ29yZV9pc0xldmVsRW5hYmxlZCcgXTsKCi8vIEFjdHVhbCBsb2cgZnVuY3Rpb24KdmFyIF9fTG9nQ29yZV9sb2cgPSBmdW5jdGlvbiggbGV2ZWwsIG1zZyApIHsKICAgIG1zZyA9ICJKUzogIiArIG1zZzsKICAgIC8vIFJoaW5vIHNwZWNpZmljIGJpbmRpbmdzIHV0aWxpemVkLgogICAgc3dpdGNoKCBsZXZlbCApIHsKICAgIGNhc2UgInRyYWNlIiA6IF9fTG9nQ29yZV9sb2cubG9nZ2VyLnRyYWNlKCBtc2cgKTsgYnJlYWs7CiAgICBjYXNlICJkZWJ1ZyIgOiBfX0xvZ0NvcmVfbG9nLmxvZ2dlci5kZWJ1ZyggbXNnICk7IGJyZWFrOwogICAgY2FzZSAiaW5mbyIgIDogX19Mb2dDb3JlX2xvZy5sb2dnZXIuaW5mbyggbXNnICk7IGJyZWFrOwogICAgY2FzZSAid2FybiIgIDogX19Mb2dDb3JlX2xvZy5sb2dnZXIud2FybiggbXNnICk7IGJyZWFrOwogICAgY2FzZSAiZXJyb3IiIDogX19Mb2dDb3JlX2xvZy5sb2dnZXIuZXJyb3IoIG1zZyApOyBicmVhazsKICAgIGNhc2UgImZhdGFsIiA6IF9fTG9nQ29yZV9sb2cubG9nZ2VyLmVycm9yKCAiRkFUQUw6ICIgKyBtc2cgKTsgYnJlYWs7CiAgICBkZWZhdWx0ICAgICAgOiBfX0xvZ0NvcmVfbG9nLmxvZ2dlci5lcnJvciggIlVOS05PV04gTE9HTEVWRUw6ICIgKyBsZXZlbCArICIgOiAiICsgbXNnICk7IGJyZWFrOwogICAgfQp9OwoKLy8gQ2hlY2sgbGV2ZWwgZXhwb3J0Cl9fTG9nQ29yZV9pc0xldmVsRW5hYmxlZCA9IGZ1bmN0aW9uICggbGV2ZWwgKSB7CiAgICBzd2l0Y2ggKCBsZXZlbCApIHsKICAgIGNhc2UgInRyYWNlIiA6IHJldHVybiBfX0xvZ0NvcmVfbG9nLmxvZ2dlci5pc1RyYWNlRW5hYmxlZCgpOwogICAgY2FzZSAiZGVidWciIDogcmV0dXJuIF9fTG9nQ29yZV9sb2cubG9nZ2VyLmlzRGVidWdFbmFibGVkKCk7CiAgICBjYXNlICJpbmZvIiAgOiByZXR1cm4gX19Mb2dDb3JlX2xvZy5sb2dnZXIuaXNJbmZvRW5hYmxlZCgpOwogICAgY2FzZSAid2FybiIgIDogcmV0dXJuIF9fTG9nQ29yZV9sb2cubG9nZ2VyLmlzV2FybkVuYWJsZWQoKTsKICAgIGNhc2UgImVycm9yIiA6IHJldHVybiBfX0xvZ0NvcmVfbG9nLmxvZ2dlci5pc0Vycm9yRW5hYmxlZCgpOwogICAgZGVmYXVsdDogcmV0dXJuIHRydWU7CiAgICB9Owp9CgoKLy8gQXR0YWNoIHRoZSBsb2dnZXIgdmFyaWFibGUgdG8gdGhlIGdsb2JhbCBsb2dnZXIgb25seSBvbmNlLCBub3QgZm9yIGVhY2gKLy8gZnVuY3Rpb24gY2FsbC4KLy8gU29ydCBvZiB0aGUgc3RhdGljIHdheSB0byBkbyBpdC4KCi8vIFRoZSBuZXh0IGxpbmUgY2FuIGJpbmQgKmRpcmVjdGx5KiB0byBsb2c0ai4gSXQgaXMgb25seSBpbmNsdWRlZCBmb3IKLy8gcmVmZXJlbmNlLCBhcwovLyB0aGUgZmFjYWRlIGJlbG93IGlzIHRoZSByZWNvbW1lbmRlZCB3YXkgdG8gZG8gaXQuCi8vIF9fTG9nQ29yZV9sb2cubG9nZ2VyID0gUGFja2FnZXMub3JnLmFwYWNoZS5sb2c0ai5Mb2dnZXIuZ2V0TG9nZ2VyKAovLyAiSmF2YVNjcmlwdC5Mb2dnZXIiICk7CgovLyBCaW5kaW5nIHRvIHRoZSBzbGY0aiBmYWNhZGUuCl9fTG9nQ29yZV9sb2cubG9nZ2VyID0gUGFja2FnZXMub3JnLnNsZjRqLkxvZ2dlckZhY3RvcnkKICAgIC5nZXRMb2dnZXIoICJKYXZhU2NyaXB0LkxvZ2dlciIgKTsK", "moduleName": "LogCore"}, {"javascript": "LyoqIEBmaWxlIFVuZGVyc2NvcmUgbW9kdWxlLCBleHRlcm5hbCBmaWxlICovCkVYUE9SVEVEX1NZTUJPTFMgPSBbIl8iXTsKCnVzZSgiRVM1Iik7CgovKioKICogQGxpY2Vuc2UKICogTG9kYXNoIChDdXN0b20gQnVpbGQpIDxodHRwczovL2xvZGFzaC5jb20vPgogKiBCdWlsZDogYGxvZGFzaCBjYXRlZ29yeT0iYXJyYXksbGFuZyJgCiAqIENvcHlyaWdodCBKUyBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMgPGh0dHBzOi8vanMuZm91bmRhdGlvbi8+CiAqIFJlbGVhc2VkIHVuZGVyIE1JVCBsaWNlbnNlIDxodHRwczovL2xvZGFzaC5jb20vbGljZW5zZT4KICogQmFzZWQgb24gVW5kZXJzY29yZS5qcyAxLjguMyA8aHR0cDovL3VuZGVyc2NvcmVqcy5vcmcvTElDRU5TRT4KICogQ29weXJpZ2h0IEplcmVteSBBc2hrZW5hcywgRG9jdW1lbnRDbG91ZCBhbmQgSW52ZXN0aWdhdGl2ZSBSZXBvcnRlcnMgJiBFZGl0b3JzCiAqLwo7KGZ1bmN0aW9uKCkgewoKICAvKiogVXNlZCBhcyBhIHNhZmUgcmVmZXJlbmNlIGZvciBgdW5kZWZpbmVkYCBpbiBwcmUtRVM1IGVudmlyb25tZW50cy4gKi8KICB2YXIgdW5kZWZpbmVkOwoKICAvKiogVXNlZCBhcyB0aGUgc2VtYW50aWMgdmVyc2lvbiBudW1iZXIuICovCiAgdmFyIFZFUlNJT04gPSAnNC4xNy40JzsKCiAgLyoqIFVzZWQgYXMgdGhlIHNpemUgdG8gZW5hYmxlIGxhcmdlIGFycmF5IG9wdGltaXphdGlvbnMuICovCiAgdmFyIExBUkdFX0FSUkFZX1NJWkUgPSAyMDA7CgogIC8qKiBFcnJvciBtZXNzYWdlIGNvbnN0YW50cy4gKi8KICB2YXIgQ09SRV9FUlJPUl9URVhUID0gJ1Vuc3VwcG9ydGVkIGNvcmUtanMgdXNlLiBUcnkgaHR0cHM6Ly9ucG1zLmlvL3NlYXJjaD9xPXBvbnlmaWxsLicsCiAgICAgIEZVTkNfRVJST1JfVEVYVCA9ICdFeHBlY3RlZCBhIGZ1bmN0aW9uJzsKCiAgLyoqIFVzZWQgdG8gc3RhbmQtaW4gZm9yIGB1bmRlZmluZWRgIGhhc2ggdmFsdWVzLiAqLwogIHZhciBIQVNIX1VOREVGSU5FRCA9ICdfX2xvZGFzaF9oYXNoX3VuZGVmaW5lZF9fJzsKCiAgLyoqIFVzZWQgYXMgdGhlIG1heGltdW0gbWVtb2l6ZSBjYWNoZSBzaXplLiAqLwogIHZhciBNQVhfTUVNT0laRV9TSVpFID0gNTAwOwoKICAvKiogVXNlZCB0byBjb21wb3NlIGJpdG1hc2tzIGZvciBjbG9uaW5nLiAqLwogIHZhciBDTE9ORV9ERUVQX0ZMQUcgPSAxLAogICAgICBDTE9ORV9GTEFUX0ZMQUcgPSAyLAogICAgICBDTE9ORV9TWU1CT0xTX0ZMQUcgPSA0OwoKICAvKiogVXNlZCB0byBjb21wb3NlIGJpdG1hc2tzIGZvciB2YWx1ZSBjb21wYXJpc29ucy4gKi8KICB2YXIgQ09NUEFSRV9QQVJUSUFMX0ZMQUcgPSAxLAogICAgICBDT01QQVJFX1VOT1JERVJFRF9GTEFHID0gMjsKCiAgLyoqIFVzZWQgdG8gZGV0ZWN0IGhvdCBmdW5jdGlvbnMgYnkgbnVtYmVyIG9mIGNhbGxzIHdpdGhpbiBhIHNwYW4gb2YgbWlsbGlzZWNvbmRzLiAqLwogIHZhciBIT1RfQ09VTlQgPSA4MDAsCiAgICAgIEhPVF9TUEFOID0gMTY7CgogIC8qKiBVc2VkIGFzIHJlZmVyZW5jZXMgZm9yIHZhcmlvdXMgYE51bWJlcmAgY29uc3RhbnRzLiAqLwogIHZhciBJTkZJTklUWSA9IDEgLyAwLAogICAgICBNQVhfU0FGRV9JTlRFR0VSID0gOTAwNzE5OTI1NDc0MDk5MSwKICAgICAgTUFYX0lOVEVHRVIgPSAxLjc5NzY5MzEzNDg2MjMxNTdlKzMwOCwKICAgICAgTkFOID0gMCAvIDA7CgogIC8qKiBVc2VkIGFzIHJlZmVyZW5jZXMgZm9yIHRoZSBtYXhpbXVtIGxlbmd0aCBhbmQgaW5kZXggb2YgYW4gYXJyYXkuICovCiAgdmFyIE1BWF9BUlJBWV9MRU5HVEggPSA0Mjk0OTY3Mjk1LAogICAgICBNQVhfQVJSQVlfSU5ERVggPSBNQVhfQVJSQVlfTEVOR1RIIC0gMSwKICAgICAgSEFMRl9NQVhfQVJSQVlfTEVOR1RIID0gTUFYX0FSUkFZX0xFTkdUSCA+Pj4gMTsKCiAgLyoqIGBPYmplY3QjdG9TdHJpbmdgIHJlc3VsdCByZWZlcmVuY2VzLiAqLwogIHZhciBhcmdzVGFnID0gJ1tvYmplY3QgQXJndW1lbnRzXScsCiAgICAgIGFycmF5VGFnID0gJ1tvYmplY3QgQXJyYXldJywKICAgICAgYXN5bmNUYWcgPSAnW29iamVjdCBBc3luY0Z1bmN0aW9uXScsCiAgICAgIGJvb2xUYWcgPSAnW29iamVjdCBCb29sZWFuXScsCiAgICAgIGRhdGVUYWcgPSAnW29iamVjdCBEYXRlXScsCiAgICAgIGRvbUV4Y1RhZyA9ICdbb2JqZWN0IERPTUV4Y2VwdGlvbl0nLAogICAgICBlcnJvclRhZyA9ICdbb2JqZWN0IEVycm9yXScsCiAgICAgIGZ1bmNUYWcgPSAnW29iamVjdCBGdW5jdGlvbl0nLAogICAgICBnZW5UYWcgPSAnW29iamVjdCBHZW5lcmF0b3JGdW5jdGlvbl0nLAogICAgICBtYXBUYWcgPSAnW29iamVjdCBNYXBdJywKICAgICAgbnVtYmVyVGFnID0gJ1tvYmplY3QgTnVtYmVyXScsCiAgICAgIG51bGxUYWcgPSAnW29iamVjdCBOdWxsXScsCiAgICAgIG9iamVjdFRhZyA9ICdbb2JqZWN0IE9iamVjdF0nLAogICAgICBwcm9taXNlVGFnID0gJ1tvYmplY3QgUHJvbWlzZV0nLAogICAgICBwcm94eVRhZyA9ICdbb2JqZWN0IFByb3h5XScsCiAgICAgIHJlZ2V4cFRhZyA9ICdbb2JqZWN0IFJlZ0V4cF0nLAogICAgICBzZXRUYWcgPSAnW29iamVjdCBTZXRdJywKICAgICAgc3RyaW5nVGFnID0gJ1tvYmplY3QgU3RyaW5nXScsCiAgICAgIHN5bWJvbFRhZyA9ICdbb2JqZWN0IFN5bWJvbF0nLAogICAgICB1bmRlZmluZWRUYWcgPSAnW29iamVjdCBVbmRlZmluZWRdJywKICAgICAgd2Vha01hcFRhZyA9ICdbb2JqZWN0IFdlYWtNYXBdJywKICAgICAgd2Vha1NldFRhZyA9ICdbb2JqZWN0IFdlYWtTZXRdJzsKCiAgdmFyIGFycmF5QnVmZmVyVGFnID0gJ1tvYmplY3QgQXJyYXlCdWZmZXJdJywKICAgICAgZGF0YVZpZXdUYWcgPSAnW29iamVjdCBEYXRhVmlld10nLAogICAgICBmbG9hdDMyVGFnID0gJ1tvYmplY3QgRmxvYXQzMkFycmF5XScsCiAgICAgIGZsb2F0NjRUYWcgPSAnW29iamVjdCBGbG9hdDY0QXJyYXldJywKICAgICAgaW50OFRhZyA9ICdbb2JqZWN0IEludDhBcnJheV0nLAogICAgICBpbnQxNlRhZyA9ICdbb2JqZWN0IEludDE2QXJyYXldJywKICAgICAgaW50MzJUYWcgPSAnW29iamVjdCBJbnQzMkFycmF5XScsCiAgICAgIHVpbnQ4VGFnID0gJ1tvYmplY3QgVWludDhBcnJheV0nLAogICAgICB1aW50OENsYW1wZWRUYWcgPSAnW29iamVjdCBVaW50OENsYW1wZWRBcnJheV0nLAogICAgICB1aW50MTZUYWcgPSAnW29iamVjdCBVaW50MTZBcnJheV0nLAogICAgICB1aW50MzJUYWcgPSAnW29iamVjdCBVaW50MzJBcnJheV0nOwoKICAvKiogVXNlZCB0byBtYXRjaCBwcm9wZXJ0eSBuYW1lcyB3aXRoaW4gcHJvcGVydHkgcGF0aHMuICovCiAgdmFyIHJlSXNEZWVwUHJvcCA9IC9cLnxcWyg/OlteW1xdXSp8KFsiJ10pKD86KD8hXDEpW15cXF18XFwuKSo/XDEpXF0vLAogICAgICByZUlzUGxhaW5Qcm9wID0gL15cdyokLywKICAgICAgcmVMZWFkaW5nRG90ID0gL15cLi8sCiAgICAgIHJlUHJvcE5hbWUgPSAvW14uW1xdXSt8XFsoPzooLT9cZCsoPzpcLlxkKyk/KXwoWyInXSkoKD86KD8hXDIpW15cXF18XFwuKSo/KVwyKVxdfCg/PSg/OlwufFxbXF0pKD86XC58XFtcXXwkKSkvZzsKCiAgLyoqCiAgICogVXNlZCB0byBtYXRjaCBgUmVnRXhwYAogICAqIFtzeW50YXggY2hhcmFjdGVyc10oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtcGF0dGVybnMpLgogICAqLwogIHZhciByZVJlZ0V4cENoYXIgPSAvW1xcXiQuKis/KClbXF17fXxdL2c7CgogIC8qKiBVc2VkIHRvIG1hdGNoIGxlYWRpbmcgYW5kIHRyYWlsaW5nIHdoaXRlc3BhY2UuICovCiAgdmFyIHJlVHJpbSA9IC9eXHMrfFxzKyQvZzsKCiAgLyoqIFVzZWQgdG8gbWF0Y2ggYmFja3NsYXNoZXMgaW4gcHJvcGVydHkgcGF0aHMuICovCiAgdmFyIHJlRXNjYXBlQ2hhciA9IC9cXChcXCk/L2c7CgogIC8qKiBVc2VkIHRvIG1hdGNoIGBSZWdFeHBgIGZsYWdzIGZyb20gdGhlaXIgY29lcmNlZCBzdHJpbmcgdmFsdWVzLiAqLwogIHZhciByZUZsYWdzID0gL1x3KiQvOwoKICAvKiogVXNlZCB0byBkZXRlY3QgYmFkIHNpZ25lZCBoZXhhZGVjaW1hbCBzdHJpbmcgdmFsdWVzLiAqLwogIHZhciByZUlzQmFkSGV4ID0gL15bLStdMHhbMC05YS1mXSskL2k7CgogIC8qKiBVc2VkIHRvIGRldGVjdCBiaW5hcnkgc3RyaW5nIHZhbHVlcy4gKi8KICB2YXIgcmVJc0JpbmFyeSA9IC9eMGJbMDFdKyQvaTsKCiAgLyoqIFVzZWQgdG8gZGV0ZWN0IGhvc3QgY29uc3RydWN0b3JzIChTYWZhcmkpLiAqLwogIHZhciByZUlzSG9zdEN0b3IgPSAvXlxbb2JqZWN0IC4rP0NvbnN0cnVjdG9yXF0kLzsKCiAgLyoqIFVzZWQgdG8gZGV0ZWN0IG9jdGFsIHN0cmluZyB2YWx1ZXMuICovCiAgdmFyIHJlSXNPY3RhbCA9IC9eMG9bMC03XSskL2k7CgogIC8qKiBVc2VkIHRvIGRldGVjdCB1bnNpZ25lZCBpbnRlZ2VyIHZhbHVlcy4gKi8KICB2YXIgcmVJc1VpbnQgPSAvXig/OjB8WzEtOV1cZCopJC87CgogIC8qKiBVc2VkIHRvIGNvbXBvc2UgdW5pY29kZSBjaGFyYWN0ZXIgY2xhc3Nlcy4gKi8KICB2YXIgcnNBc3RyYWxSYW5nZSA9ICdcXHVkODAwLVxcdWRmZmYnLAogICAgICByc0NvbWJvTWFya3NSYW5nZSA9ICdcXHUwMzAwLVxcdTAzNmYnLAogICAgICByZUNvbWJvSGFsZk1hcmtzUmFuZ2UgPSAnXFx1ZmUyMC1cXHVmZTJmJywKICAgICAgcnNDb21ib1N5bWJvbHNSYW5nZSA9ICdcXHUyMGQwLVxcdTIwZmYnLAogICAgICByc0NvbWJvUmFuZ2UgPSByc0NvbWJvTWFya3NSYW5nZSArIHJlQ29tYm9IYWxmTWFya3NSYW5nZSArIHJzQ29tYm9TeW1ib2xzUmFuZ2UsCiAgICAgIHJzVmFyUmFuZ2UgPSAnXFx1ZmUwZVxcdWZlMGYnOwoKICAvKiogVXNlZCB0byBjb21wb3NlIHVuaWNvZGUgY2FwdHVyZSBncm91cHMuICovCiAgdmFyIHJzQXN0cmFsID0gJ1snICsgcnNBc3RyYWxSYW5nZSArICddJywKICAgICAgcnNDb21ibyA9ICdbJyArIHJzQ29tYm9SYW5nZSArICddJywKICAgICAgcnNGaXR6ID0gJ1xcdWQ4M2NbXFx1ZGZmYi1cXHVkZmZmXScsCiAgICAgIHJzTW9kaWZpZXIgPSAnKD86JyArIHJzQ29tYm8gKyAnfCcgKyByc0ZpdHogKyAnKScsCiAgICAgIHJzTm9uQXN0cmFsID0gJ1teJyArIHJzQXN0cmFsUmFuZ2UgKyAnXScsCiAgICAgIHJzUmVnaW9uYWwgPSAnKD86XFx1ZDgzY1tcXHVkZGU2LVxcdWRkZmZdKXsyfScsCiAgICAgIHJzU3VyclBhaXIgPSAnW1xcdWQ4MDAtXFx1ZGJmZl1bXFx1ZGMwMC1cXHVkZmZmXScsCiAgICAgIHJzWldKID0gJ1xcdTIwMGQnOwoKICAvKiogVXNlZCB0byBjb21wb3NlIHVuaWNvZGUgcmVnZXhlcy4gKi8KICB2YXIgcmVPcHRNb2QgPSByc01vZGlmaWVyICsgJz8nLAogICAgICByc09wdFZhciA9ICdbJyArIHJzVmFyUmFuZ2UgKyAnXT8nLAogICAgICByc09wdEpvaW4gPSAnKD86JyArIHJzWldKICsgJyg/OicgKyBbcnNOb25Bc3RyYWwsIHJzUmVnaW9uYWwsIHJzU3VyclBhaXJdLmpvaW4oJ3wnKSArICcpJyArIHJzT3B0VmFyICsgcmVPcHRNb2QgKyAnKSonLAogICAgICByc1NlcSA9IHJzT3B0VmFyICsgcmVPcHRNb2QgKyByc09wdEpvaW4sCiAgICAgIHJzU3ltYm9sID0gJyg/OicgKyBbcnNOb25Bc3RyYWwgKyByc0NvbWJvICsgJz8nLCByc0NvbWJvLCByc1JlZ2lvbmFsLCByc1N1cnJQYWlyLCByc0FzdHJhbF0uam9pbignfCcpICsgJyknOwoKICAvKiogVXNlZCB0byBtYXRjaCBbc3RyaW5nIHN5bWJvbHNdKGh0dHBzOi8vbWF0aGlhc2J5bmVucy5iZS9ub3Rlcy9qYXZhc2NyaXB0LXVuaWNvZGUpLiAqLwogIHZhciByZVVuaWNvZGUgPSBSZWdFeHAocnNGaXR6ICsgJyg/PScgKyByc0ZpdHogKyAnKXwnICsgcnNTeW1ib2wgKyByc1NlcSwgJ2cnKTsKCiAgLyoqIFVzZWQgdG8gZGV0ZWN0IHN0cmluZ3Mgd2l0aCBbemVyby13aWR0aCBqb2luZXJzIG9yIGNvZGUgcG9pbnRzIGZyb20gdGhlIGFzdHJhbCBwbGFuZXNdKGh0dHA6Ly9lZXYuZWUvYmxvZy8yMDE1LzA5LzEyL2RhcmstY29ybmVycy1vZi11bmljb2RlLykuICovCiAgdmFyIHJlSGFzVW5pY29kZSA9IFJlZ0V4cCgnWycgKyByc1pXSiArIHJzQXN0cmFsUmFuZ2UgICsgcnNDb21ib1JhbmdlICsgcnNWYXJSYW5nZSArICddJyk7CgogIC8qKiBVc2VkIHRvIGlkZW50aWZ5IGB0b1N0cmluZ1RhZ2AgdmFsdWVzIG9mIHR5cGVkIGFycmF5cy4gKi8KICB2YXIgdHlwZWRBcnJheVRhZ3MgPSB7fTsKICB0eXBlZEFycmF5VGFnc1tmbG9hdDMyVGFnXSA9IHR5cGVkQXJyYXlUYWdzW2Zsb2F0NjRUYWddID0KICB0eXBlZEFycmF5VGFnc1tpbnQ4VGFnXSA9IHR5cGVkQXJyYXlUYWdzW2ludDE2VGFnXSA9CiAgdHlwZWRBcnJheVRhZ3NbaW50MzJUYWddID0gdHlwZWRBcnJheVRhZ3NbdWludDhUYWddID0KICB0eXBlZEFycmF5VGFnc1t1aW50OENsYW1wZWRUYWddID0gdHlwZWRBcnJheVRhZ3NbdWludDE2VGFnXSA9CiAgdHlwZWRBcnJheVRhZ3NbdWludDMyVGFnXSA9IHRydWU7CiAgdHlwZWRBcnJheVRhZ3NbYXJnc1RhZ10gPSB0eXBlZEFycmF5VGFnc1thcnJheVRhZ10gPQogIHR5cGVkQXJyYXlUYWdzW2FycmF5QnVmZmVyVGFnXSA9IHR5cGVkQXJyYXlUYWdzW2Jvb2xUYWddID0KICB0eXBlZEFycmF5VGFnc1tkYXRhVmlld1RhZ10gPSB0eXBlZEFycmF5VGFnc1tkYXRlVGFnXSA9CiAgdHlwZWRBcnJheVRhZ3NbZXJyb3JUYWddID0gdHlwZWRBcnJheVRhZ3NbZnVuY1RhZ10gPQogIHR5cGVkQXJyYXlUYWdzW21hcFRhZ10gPSB0eXBlZEFycmF5VGFnc1tudW1iZXJUYWddID0KICB0eXBlZEFycmF5VGFnc1tvYmplY3RUYWddID0gdHlwZWRBcnJheVRhZ3NbcmVnZXhwVGFnXSA9CiAgdHlwZWRBcnJheVRhZ3Nbc2V0VGFnXSA9IHR5cGVkQXJyYXlUYWdzW3N0cmluZ1RhZ10gPQogIHR5cGVkQXJyYXlUYWdzW3dlYWtNYXBUYWddID0gZmFsc2U7CgogIC8qKiBVc2VkIHRvIGlkZW50aWZ5IGB0b1N0cmluZ1RhZ2AgdmFsdWVzIHN1cHBvcnRlZCBieSBgXy5jbG9uZWAuICovCiAgdmFyIGNsb25lYWJsZVRhZ3MgPSB7fTsKICBjbG9uZWFibGVUYWdzW2FyZ3NUYWddID0gY2xvbmVhYmxlVGFnc1thcnJheVRhZ10gPQogIGNsb25lYWJsZVRhZ3NbYXJyYXlCdWZmZXJUYWddID0gY2xvbmVhYmxlVGFnc1tkYXRhVmlld1RhZ10gPQogIGNsb25lYWJsZVRhZ3NbYm9vbFRhZ10gPSBjbG9uZWFibGVUYWdzW2RhdGVUYWddID0KICBjbG9uZWFibGVUYWdzW2Zsb2F0MzJUYWddID0gY2xvbmVhYmxlVGFnc1tmbG9hdDY0VGFnXSA9CiAgY2xvbmVhYmxlVGFnc1tpbnQ4VGFnXSA9IGNsb25lYWJsZVRhZ3NbaW50MTZUYWddID0KICBjbG9uZWFibGVUYWdzW2ludDMyVGFnXSA9IGNsb25lYWJsZVRhZ3NbbWFwVGFnXSA9CiAgY2xvbmVhYmxlVGFnc1tudW1iZXJUYWddID0gY2xvbmVhYmxlVGFnc1tvYmplY3RUYWddID0KICBjbG9uZWFibGVUYWdzW3JlZ2V4cFRhZ10gPSBjbG9uZWFibGVUYWdzW3NldFRhZ10gPQogIGNsb25lYWJsZVRhZ3Nbc3RyaW5nVGFnXSA9IGNsb25lYWJsZVRhZ3Nbc3ltYm9sVGFnXSA9CiAgY2xvbmVhYmxlVGFnc1t1aW50OFRhZ10gPSBjbG9uZWFibGVUYWdzW3VpbnQ4Q2xhbXBlZFRhZ10gPQogIGNsb25lYWJsZVRhZ3NbdWludDE2VGFnXSA9IGNsb25lYWJsZVRhZ3NbdWludDMyVGFnXSA9IHRydWU7CiAgY2xvbmVhYmxlVGFnc1tlcnJvclRhZ10gPSBjbG9uZWFibGVUYWdzW2Z1bmNUYWddID0KICBjbG9uZWFibGVUYWdzW3dlYWtNYXBUYWddID0gZmFsc2U7CgogIC8qKiBCdWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcyB3aXRob3V0IGEgZGVwZW5kZW5jeSBvbiBgcm9vdGAuICovCiAgdmFyIGZyZWVQYXJzZUludCA9IHBhcnNlSW50OwoKICAvKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYGdsb2JhbGAgZnJvbSBOb2RlLmpzLiAqLwogIHZhciBmcmVlR2xvYmFsID0gdHlwZW9mIGdsb2JhbCA9PSAnb2JqZWN0JyAmJiBnbG9iYWwgJiYgZ2xvYmFsLk9iamVjdCA9PT0gT2JqZWN0ICYmIGdsb2JhbDsKCiAgLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBzZWxmYC4gKi8KICB2YXIgZnJlZVNlbGYgPSB0eXBlb2Ygc2VsZiA9PSAnb2JqZWN0JyAmJiBzZWxmICYmIHNlbGYuT2JqZWN0ID09PSBPYmplY3QgJiYgc2VsZjsKCiAgLyoqIFVzZWQgYXMgYSByZWZlcmVuY2UgdG8gdGhlIGdsb2JhbCBvYmplY3QuICovCiAgdmFyIHJvb3QgPSBmcmVlR2xvYmFsIHx8IGZyZWVTZWxmIHx8IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7CgogIC8qKiBEZXRlY3QgZnJlZSB2YXJpYWJsZSBgZXhwb3J0c2AuICovCiAgdmFyIGZyZWVFeHBvcnRzID0gdHlwZW9mIGV4cG9ydHMgPT0gJ29iamVjdCcgJiYgZXhwb3J0cyAmJiAhZXhwb3J0cy5ub2RlVHlwZSAmJiBleHBvcnRzOwoKICAvKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYG1vZHVsZWAuICovCiAgdmFyIGZyZWVNb2R1bGUgPSBmcmVlRXhwb3J0cyAmJiB0eXBlb2YgbW9kdWxlID09ICdvYmplY3QnICYmIG1vZHVsZSAmJiAhbW9kdWxlLm5vZGVUeXBlICYmIG1vZHVsZTsKCiAgLyoqIERldGVjdCB0aGUgcG9wdWxhciBDb21tb25KUyBleHRlbnNpb24gYG1vZHVsZS5leHBvcnRzYC4gKi8KICB2YXIgbW9kdWxlRXhwb3J0cyA9IGZyZWVNb2R1bGUgJiYgZnJlZU1vZHVsZS5leHBvcnRzID09PSBmcmVlRXhwb3J0czsKCiAgLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBwcm9jZXNzYCBmcm9tIE5vZGUuanMuICovCiAgdmFyIGZyZWVQcm9jZXNzID0gbW9kdWxlRXhwb3J0cyAmJiBmcmVlR2xvYmFsLnByb2Nlc3M7CgogIC8qKiBVc2VkIHRvIGFjY2VzcyBmYXN0ZXIgTm9kZS5qcyBoZWxwZXJzLiAqLwogIHZhciBub2RlVXRpbCA9IChmdW5jdGlvbigpIHsKICAgIHRyeSB7CiAgICAgIHJldHVybiBmcmVlUHJvY2VzcyAmJiBmcmVlUHJvY2Vzcy5iaW5kaW5nICYmIGZyZWVQcm9jZXNzLmJpbmRpbmcoJ3V0aWwnKTsKICAgIH0gY2F0Y2ggKGUpIHt9CiAgfSgpKTsKCiAgLyogTm9kZS5qcyBoZWxwZXIgcmVmZXJlbmNlcy4gKi8KICB2YXIgbm9kZUlzQXJyYXlCdWZmZXIgPSBub2RlVXRpbCAmJiBub2RlVXRpbC5pc0FycmF5QnVmZmVyLAogICAgICBub2RlSXNEYXRlID0gbm9kZVV0aWwgJiYgbm9kZVV0aWwuaXNEYXRlLAogICAgICBub2RlSXNNYXAgPSBub2RlVXRpbCAmJiBub2RlVXRpbC5pc01hcCwKICAgICAgbm9kZUlzUmVnRXhwID0gbm9kZVV0aWwgJiYgbm9kZVV0aWwuaXNSZWdFeHAsCiAgICAgIG5vZGVJc1NldCA9IG5vZGVVdGlsICYmIG5vZGVVdGlsLmlzU2V0LAogICAgICBub2RlSXNUeXBlZEFycmF5ID0gbm9kZVV0aWwgJiYgbm9kZVV0aWwuaXNUeXBlZEFycmF5OwoKICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCiAgLyoqCiAgICogQWRkcyB0aGUga2V5LXZhbHVlIGBwYWlyYCB0byBgbWFwYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG1hcCBUaGUgbWFwIHRvIG1vZGlmeS4KICAgKiBAcGFyYW0ge0FycmF5fSBwYWlyIFRoZSBrZXktdmFsdWUgcGFpciB0byBhZGQuCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgbWFwYC4KICAgKi8KICBmdW5jdGlvbiBhZGRNYXBFbnRyeShtYXAsIHBhaXIpIHsKICAgIC8vIERvbid0IHJldHVybiBgbWFwLnNldGAgYmVjYXVzZSBpdCdzIG5vdCBjaGFpbmFibGUgaW4gSUUgMTEuCiAgICBtYXAuc2V0KHBhaXJbMF0sIHBhaXJbMV0pOwogICAgcmV0dXJuIG1hcDsKICB9CgogIC8qKgogICAqIEFkZHMgYHZhbHVlYCB0byBgc2V0YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IHNldCBUaGUgc2V0IHRvIG1vZGlmeS4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBhZGQuCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgc2V0YC4KICAgKi8KICBmdW5jdGlvbiBhZGRTZXRFbnRyeShzZXQsIHZhbHVlKSB7CiAgICAvLyBEb24ndCByZXR1cm4gYHNldC5hZGRgIGJlY2F1c2UgaXQncyBub3QgY2hhaW5hYmxlIGluIElFIDExLgogICAgc2V0LmFkZCh2YWx1ZSk7CiAgICByZXR1cm4gc2V0OwogIH0KCiAgLyoqCiAgICogQSBmYXN0ZXIgYWx0ZXJuYXRpdmUgdG8gYEZ1bmN0aW9uI2FwcGx5YCwgdGhpcyBmdW5jdGlvbiBpbnZva2VzIGBmdW5jYAogICAqIHdpdGggdGhlIGB0aGlzYCBiaW5kaW5nIG9mIGB0aGlzQXJnYCBhbmQgdGhlIGFyZ3VtZW50cyBvZiBgYXJnc2AuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGludm9rZS4KICAgKiBAcGFyYW0geyp9IHRoaXNBcmcgVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBmdW5jYC4KICAgKiBAcGFyYW0ge0FycmF5fSBhcmdzIFRoZSBhcmd1bWVudHMgdG8gaW52b2tlIGBmdW5jYCB3aXRoLgogICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSByZXN1bHQgb2YgYGZ1bmNgLgogICAqLwogIGZ1bmN0aW9uIGFwcGx5KGZ1bmMsIHRoaXNBcmcsIGFyZ3MpIHsKICAgIHN3aXRjaCAoYXJncy5sZW5ndGgpIHsKICAgICAgY2FzZSAwOiByZXR1cm4gZnVuYy5jYWxsKHRoaXNBcmcpOwogICAgICBjYXNlIDE6IHJldHVybiBmdW5jLmNhbGwodGhpc0FyZywgYXJnc1swXSk7CiAgICAgIGNhc2UgMjogcmV0dXJuIGZ1bmMuY2FsbCh0aGlzQXJnLCBhcmdzWzBdLCBhcmdzWzFdKTsKICAgICAgY2FzZSAzOiByZXR1cm4gZnVuYy5jYWxsKHRoaXNBcmcsIGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0pOwogICAgfQogICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpc0FyZywgYXJncyk7CiAgfQoKICAvKioKICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8uZm9yRWFjaGAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yCiAgICogaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5XSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGBhcnJheWAuCiAgICovCiAgZnVuY3Rpb24gYXJyYXlFYWNoKGFycmF5LCBpdGVyYXRlZSkgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7CgogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgaWYgKGl0ZXJhdGVlKGFycmF5W2luZGV4XSwgaW5kZXgsIGFycmF5KSA9PT0gZmFsc2UpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGFycmF5OwogIH0KCiAgLyoqCiAgICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBfLmZpbHRlcmAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yCiAgICogaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5XSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWRpY2F0ZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGZpbHRlcmVkIGFycmF5LgogICAqLwogIGZ1bmN0aW9uIGFycmF5RmlsdGVyKGFycmF5LCBwcmVkaWNhdGUpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoLAogICAgICAgIHJlc0luZGV4ID0gMCwKICAgICAgICByZXN1bHQgPSBbXTsKCiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICB2YXIgdmFsdWUgPSBhcnJheVtpbmRleF07CiAgICAgIGlmIChwcmVkaWNhdGUodmFsdWUsIGluZGV4LCBhcnJheSkpIHsKICAgICAgICByZXN1bHRbcmVzSW5kZXgrK10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5pbmNsdWRlc2AgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yCiAgICogc3BlY2lmeWluZyBhbiBpbmRleCB0byBzZWFyY2ggZnJvbS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5XSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0geyp9IHRhcmdldCBUaGUgdmFsdWUgdG8gc2VhcmNoIGZvci4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHRhcmdldGAgaXMgZm91bmQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBhcnJheUluY2x1ZGVzKGFycmF5LCB2YWx1ZSkgewogICAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoOwogICAgcmV0dXJuICEhbGVuZ3RoICYmIGJhc2VJbmRleE9mKGFycmF5LCB2YWx1ZSwgMCkgPiAtMTsKICB9CgogIC8qKgogICAqIFRoaXMgZnVuY3Rpb24gaXMgbGlrZSBgYXJyYXlJbmNsdWRlc2AgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBhIGNvbXBhcmF0b3IuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IFthcnJheV0gVGhlIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHsqfSB0YXJnZXQgVGhlIHZhbHVlIHRvIHNlYXJjaCBmb3IuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY29tcGFyYXRvciBUaGUgY29tcGFyYXRvciBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdGFyZ2V0YCBpcyBmb3VuZCwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGFycmF5SW5jbHVkZXNXaXRoKGFycmF5LCB2YWx1ZSwgY29tcGFyYXRvcikgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7CgogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgaWYgKGNvbXBhcmF0b3IodmFsdWUsIGFycmF5W2luZGV4XSkpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgLyoqCiAgICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBfLm1hcGAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yIGl0ZXJhdGVlCiAgICogc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5XSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgbWFwcGVkIGFycmF5LgogICAqLwogIGZ1bmN0aW9uIGFycmF5TWFwKGFycmF5LCBpdGVyYXRlZSkgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGgsCiAgICAgICAgcmVzdWx0ID0gQXJyYXkobGVuZ3RoKTsKCiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICByZXN1bHRbaW5kZXhdID0gaXRlcmF0ZWUoYXJyYXlbaW5kZXhdLCBpbmRleCwgYXJyYXkpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIEFwcGVuZHMgdGhlIGVsZW1lbnRzIG9mIGB2YWx1ZXNgIHRvIGBhcnJheWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBtb2RpZnkuCiAgICogQHBhcmFtIHtBcnJheX0gdmFsdWVzIFRoZSB2YWx1ZXMgdG8gYXBwZW5kLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBgYXJyYXlgLgogICAqLwogIGZ1bmN0aW9uIGFycmF5UHVzaChhcnJheSwgdmFsdWVzKSB7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICBsZW5ndGggPSB2YWx1ZXMubGVuZ3RoLAogICAgICAgIG9mZnNldCA9IGFycmF5Lmxlbmd0aDsKCiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICBhcnJheVtvZmZzZXQgKyBpbmRleF0gPSB2YWx1ZXNbaW5kZXhdOwogICAgfQogICAgcmV0dXJuIGFycmF5OwogIH0KCiAgLyoqCiAgICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBfLnJlZHVjZWAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yCiAgICogaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5XSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uCiAgICogQHBhcmFtIHsqfSBbYWNjdW11bGF0b3JdIFRoZSBpbml0aWFsIHZhbHVlLgogICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2luaXRBY2N1bV0gU3BlY2lmeSB1c2luZyB0aGUgZmlyc3QgZWxlbWVudCBvZiBgYXJyYXlgIGFzCiAgICogIHRoZSBpbml0aWFsIHZhbHVlLgogICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBhY2N1bXVsYXRlZCB2YWx1ZS4KICAgKi8KICBmdW5jdGlvbiBhcnJheVJlZHVjZShhcnJheSwgaXRlcmF0ZWUsIGFjY3VtdWxhdG9yLCBpbml0QWNjdW0pIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoOwoKICAgIGlmIChpbml0QWNjdW0gJiYgbGVuZ3RoKSB7CiAgICAgIGFjY3VtdWxhdG9yID0gYXJyYXlbKytpbmRleF07CiAgICB9CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICBhY2N1bXVsYXRvciA9IGl0ZXJhdGVlKGFjY3VtdWxhdG9yLCBhcnJheVtpbmRleF0sIGluZGV4LCBhcnJheSk7CiAgICB9CiAgICByZXR1cm4gYWNjdW11bGF0b3I7CiAgfQoKICAvKioKICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8uc29tZWAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yIGl0ZXJhdGVlCiAgICogc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5XSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWRpY2F0ZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBhbnkgZWxlbWVudCBwYXNzZXMgdGhlIHByZWRpY2F0ZSBjaGVjaywKICAgKiAgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGFycmF5U29tZShhcnJheSwgcHJlZGljYXRlKSB7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDsKCiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICBpZiAocHJlZGljYXRlKGFycmF5W2luZGV4XSwgaW5kZXgsIGFycmF5KSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvKioKICAgKiBDb252ZXJ0cyBhbiBBU0NJSSBgc3RyaW5nYCB0byBhbiBhcnJheS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtzdHJpbmd9IHN0cmluZyBUaGUgc3RyaW5nIHRvIGNvbnZlcnQuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBjb252ZXJ0ZWQgYXJyYXkuCiAgICovCiAgZnVuY3Rpb24gYXNjaWlUb0FycmF5KHN0cmluZykgewogICAgcmV0dXJuIHN0cmluZy5zcGxpdCgnJyk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5maW5kSW5kZXhgIGFuZCBgXy5maW5kTGFzdEluZGV4YCB3aXRob3V0CiAgICogc3VwcG9ydCBmb3IgaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uCiAgICogQHBhcmFtIHtudW1iZXJ9IGZyb21JbmRleCBUaGUgaW5kZXggdG8gc2VhcmNoIGZyb20uCiAgICogQHBhcmFtIHtib29sZWFufSBbZnJvbVJpZ2h0XSBTcGVjaWZ5IGl0ZXJhdGluZyBmcm9tIHJpZ2h0IHRvIGxlZnQuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIG1hdGNoZWQgdmFsdWUsIGVsc2UgYC0xYC4KICAgKi8KICBmdW5jdGlvbiBiYXNlRmluZEluZGV4KGFycmF5LCBwcmVkaWNhdGUsIGZyb21JbmRleCwgZnJvbVJpZ2h0KSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoLAogICAgICAgIGluZGV4ID0gZnJvbUluZGV4ICsgKGZyb21SaWdodCA/IDEgOiAtMSk7CgogICAgd2hpbGUgKChmcm9tUmlnaHQgPyBpbmRleC0tIDogKytpbmRleCA8IGxlbmd0aCkpIHsKICAgICAgaWYgKHByZWRpY2F0ZShhcnJheVtpbmRleF0sIGluZGV4LCBhcnJheSkpIHsKICAgICAgICByZXR1cm4gaW5kZXg7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAtMTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmluZGV4T2ZgIHdpdGhvdXQgYGZyb21JbmRleGAgYm91bmRzIGNoZWNrcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2VhcmNoIGZvci4KICAgKiBAcGFyYW0ge251bWJlcn0gZnJvbUluZGV4IFRoZSBpbmRleCB0byBzZWFyY2ggZnJvbS4KICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgbWF0Y2hlZCB2YWx1ZSwgZWxzZSBgLTFgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VJbmRleE9mKGFycmF5LCB2YWx1ZSwgZnJvbUluZGV4KSB7CiAgICByZXR1cm4gdmFsdWUgPT09IHZhbHVlCiAgICAgID8gc3RyaWN0SW5kZXhPZihhcnJheSwgdmFsdWUsIGZyb21JbmRleCkKICAgICAgOiBiYXNlRmluZEluZGV4KGFycmF5LCBiYXNlSXNOYU4sIGZyb21JbmRleCk7CiAgfQoKICAvKioKICAgKiBUaGlzIGZ1bmN0aW9uIGlzIGxpa2UgYGJhc2VJbmRleE9mYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGEgY29tcGFyYXRvci4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2VhcmNoIGZvci4KICAgKiBAcGFyYW0ge251bWJlcn0gZnJvbUluZGV4IFRoZSBpbmRleCB0byBzZWFyY2ggZnJvbS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjb21wYXJhdG9yIFRoZSBjb21wYXJhdG9yIGludm9rZWQgcGVyIGVsZW1lbnQuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIG1hdGNoZWQgdmFsdWUsIGVsc2UgYC0xYC4KICAgKi8KICBmdW5jdGlvbiBiYXNlSW5kZXhPZldpdGgoYXJyYXksIHZhbHVlLCBmcm9tSW5kZXgsIGNvbXBhcmF0b3IpIHsKICAgIHZhciBpbmRleCA9IGZyb21JbmRleCAtIDEsCiAgICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwoKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIGlmIChjb21wYXJhdG9yKGFycmF5W2luZGV4XSwgdmFsdWUpKSB7CiAgICAgICAgcmV0dXJuIGluZGV4OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gLTE7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5pc05hTmAgd2l0aG91dCBzdXBwb3J0IGZvciBudW1iZXIgb2JqZWN0cy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYE5hTmAsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBiYXNlSXNOYU4odmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZSAhPT0gdmFsdWU7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5wcm9wZXJ0eWAgd2l0aG91dCBzdXBwb3J0IGZvciBkZWVwIHBhdGhzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHByb3BlcnR5IHRvIGdldC4KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBhY2Nlc3NvciBmdW5jdGlvbi4KICAgKi8KICBmdW5jdGlvbiBiYXNlUHJvcGVydHkoa2V5KSB7CiAgICByZXR1cm4gZnVuY3Rpb24ob2JqZWN0KSB7CiAgICAgIHJldHVybiBvYmplY3QgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IG9iamVjdFtrZXldOwogICAgfTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnRpbWVzYCB3aXRob3V0IHN1cHBvcnQgZm9yIGl0ZXJhdGVlIHNob3J0aGFuZHMKICAgKiBvciBtYXggYXJyYXkgbGVuZ3RoIGNoZWNrcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtudW1iZXJ9IG4gVGhlIG51bWJlciBvZiB0aW1lcyB0byBpbnZva2UgYGl0ZXJhdGVlYC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcmVzdWx0cy4KICAgKi8KICBmdW5jdGlvbiBiYXNlVGltZXMobiwgaXRlcmF0ZWUpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIHJlc3VsdCA9IEFycmF5KG4pOwoKICAgIHdoaWxlICgrK2luZGV4IDwgbikgewogICAgICByZXN1bHRbaW5kZXhdID0gaXRlcmF0ZWUoaW5kZXgpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnVuYXJ5YCB3aXRob3V0IHN1cHBvcnQgZm9yIHN0b3JpbmcgbWV0YWRhdGEuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGNhcCBhcmd1bWVudHMgZm9yLgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGNhcHBlZCBmdW5jdGlvbi4KICAgKi8KICBmdW5jdGlvbiBiYXNlVW5hcnkoZnVuYykgewogICAgcmV0dXJuIGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiBmdW5jKHZhbHVlKTsKICAgIH07CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy52YWx1ZXNgIGFuZCBgXy52YWx1ZXNJbmAgd2hpY2ggY3JlYXRlcyBhbgogICAqIGFycmF5IG9mIGBvYmplY3RgIHByb3BlcnR5IHZhbHVlcyBjb3JyZXNwb25kaW5nIHRvIHRoZSBwcm9wZXJ0eSBuYW1lcwogICAqIG9mIGBwcm9wc2AuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcGFyYW0ge0FycmF5fSBwcm9wcyBUaGUgcHJvcGVydHkgbmFtZXMgdG8gZ2V0IHZhbHVlcyBmb3IuCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcHJvcGVydHkgdmFsdWVzLgogICAqLwogIGZ1bmN0aW9uIGJhc2VWYWx1ZXMob2JqZWN0LCBwcm9wcykgewogICAgcmV0dXJuIGFycmF5TWFwKHByb3BzLCBmdW5jdGlvbihrZXkpIHsKICAgICAgcmV0dXJuIG9iamVjdFtrZXldOwogICAgfSk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYSBgY2FjaGVgIHZhbHVlIGZvciBga2V5YCBleGlzdHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBjYWNoZSBUaGUgY2FjaGUgdG8gcXVlcnkuCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSBlbnRyeSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYW4gZW50cnkgZm9yIGBrZXlgIGV4aXN0cywgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGNhY2hlSGFzKGNhY2hlLCBrZXkpIHsKICAgIHJldHVybiBjYWNoZS5oYXMoa2V5KTsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIHZhbHVlIGF0IGBrZXlgIG9mIGBvYmplY3RgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gW29iamVjdF0gVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHByb3BlcnR5IHRvIGdldC4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgcHJvcGVydHkgdmFsdWUuCiAgICovCiAgZnVuY3Rpb24gZ2V0VmFsdWUob2JqZWN0LCBrZXkpIHsKICAgIHJldHVybiBvYmplY3QgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IG9iamVjdFtrZXldOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGBzdHJpbmdgIGNvbnRhaW5zIFVuaWNvZGUgc3ltYm9scy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtzdHJpbmd9IHN0cmluZyBUaGUgc3RyaW5nIHRvIGluc3BlY3QuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGEgc3ltYm9sIGlzIGZvdW5kLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gaGFzVW5pY29kZShzdHJpbmcpIHsKICAgIHJldHVybiByZUhhc1VuaWNvZGUudGVzdChzdHJpbmcpOwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYGl0ZXJhdG9yYCB0byBhbiBhcnJheS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IGl0ZXJhdG9yIFRoZSBpdGVyYXRvciB0byBjb252ZXJ0LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgY29udmVydGVkIGFycmF5LgogICAqLwogIGZ1bmN0aW9uIGl0ZXJhdG9yVG9BcnJheShpdGVyYXRvcikgewogICAgdmFyIGRhdGEsCiAgICAgICAgcmVzdWx0ID0gW107CgogICAgd2hpbGUgKCEoZGF0YSA9IGl0ZXJhdG9yLm5leHQoKSkuZG9uZSkgewogICAgICByZXN1bHQucHVzaChkYXRhLnZhbHVlKTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBDb252ZXJ0cyBgbWFwYCB0byBpdHMga2V5LXZhbHVlIHBhaXJzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gbWFwIFRoZSBtYXAgdG8gY29udmVydC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGtleS12YWx1ZSBwYWlycy4KICAgKi8KICBmdW5jdGlvbiBtYXBUb0FycmF5KG1hcCkgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgcmVzdWx0ID0gQXJyYXkobWFwLnNpemUpOwoKICAgIG1hcC5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHsKICAgICAgcmVzdWx0WysraW5kZXhdID0gW2tleSwgdmFsdWVdOwogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhIHVuYXJ5IGZ1bmN0aW9uIHRoYXQgaW52b2tlcyBgZnVuY2Agd2l0aCBpdHMgYXJndW1lbnQgdHJhbnNmb3JtZWQuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIHdyYXAuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gdHJhbnNmb3JtIFRoZSBhcmd1bWVudCB0cmFuc2Zvcm0uCiAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gb3ZlckFyZyhmdW5jLCB0cmFuc2Zvcm0pIHsKICAgIHJldHVybiBmdW5jdGlvbihhcmcpIHsKICAgICAgcmV0dXJuIGZ1bmModHJhbnNmb3JtKGFyZykpOwogICAgfTsKICB9CgogIC8qKgogICAqIENvbnZlcnRzIGBzZXRgIHRvIGFuIGFycmF5IG9mIGl0cyB2YWx1ZXMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBzZXQgVGhlIHNldCB0byBjb252ZXJ0LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgdmFsdWVzLgogICAqLwogIGZ1bmN0aW9uIHNldFRvQXJyYXkoc2V0KSB7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICByZXN1bHQgPSBBcnJheShzZXQuc2l6ZSk7CgogICAgc2V0LmZvckVhY2goZnVuY3Rpb24odmFsdWUpIHsKICAgICAgcmVzdWx0WysraW5kZXhdID0gdmFsdWU7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8uaW5kZXhPZmAgd2hpY2ggcGVyZm9ybXMgc3RyaWN0IGVxdWFsaXR5CiAgICogY29tcGFyaXNvbnMgb2YgdmFsdWVzLCBpLmUuIGA9PT1gLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZWFyY2ggZm9yLgogICAqIEBwYXJhbSB7bnVtYmVyfSBmcm9tSW5kZXggVGhlIGluZGV4IHRvIHNlYXJjaCBmcm9tLgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBtYXRjaGVkIHZhbHVlLCBlbHNlIGAtMWAuCiAgICovCiAgZnVuY3Rpb24gc3RyaWN0SW5kZXhPZihhcnJheSwgdmFsdWUsIGZyb21JbmRleCkgewogICAgdmFyIGluZGV4ID0gZnJvbUluZGV4IC0gMSwKICAgICAgICBsZW5ndGggPSBhcnJheS5sZW5ndGg7CgogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgaWYgKGFycmF5W2luZGV4XSA9PT0gdmFsdWUpIHsKICAgICAgICByZXR1cm4gaW5kZXg7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAtMTsKICB9CgogIC8qKgogICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5sYXN0SW5kZXhPZmAgd2hpY2ggcGVyZm9ybXMgc3RyaWN0IGVxdWFsaXR5CiAgICogY29tcGFyaXNvbnMgb2YgdmFsdWVzLCBpLmUuIGA9PT1gLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZWFyY2ggZm9yLgogICAqIEBwYXJhbSB7bnVtYmVyfSBmcm9tSW5kZXggVGhlIGluZGV4IHRvIHNlYXJjaCBmcm9tLgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBtYXRjaGVkIHZhbHVlLCBlbHNlIGAtMWAuCiAgICovCiAgZnVuY3Rpb24gc3RyaWN0TGFzdEluZGV4T2YoYXJyYXksIHZhbHVlLCBmcm9tSW5kZXgpIHsKICAgIHZhciBpbmRleCA9IGZyb21JbmRleCArIDE7CiAgICB3aGlsZSAoaW5kZXgtLSkgewogICAgICBpZiAoYXJyYXlbaW5kZXhdID09PSB2YWx1ZSkgewogICAgICAgIHJldHVybiBpbmRleDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGluZGV4OwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYHN0cmluZ2AgdG8gYW4gYXJyYXkuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7c3RyaW5nfSBzdHJpbmcgVGhlIHN0cmluZyB0byBjb252ZXJ0LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgY29udmVydGVkIGFycmF5LgogICAqLwogIGZ1bmN0aW9uIHN0cmluZ1RvQXJyYXkoc3RyaW5nKSB7CiAgICByZXR1cm4gaGFzVW5pY29kZShzdHJpbmcpCiAgICAgID8gdW5pY29kZVRvQXJyYXkoc3RyaW5nKQogICAgICA6IGFzY2lpVG9BcnJheShzdHJpbmcpOwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYSBVbmljb2RlIGBzdHJpbmdgIHRvIGFuIGFycmF5LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyaW5nIFRoZSBzdHJpbmcgdG8gY29udmVydC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBhcnJheS4KICAgKi8KICBmdW5jdGlvbiB1bmljb2RlVG9BcnJheShzdHJpbmcpIHsKICAgIHJldHVybiBzdHJpbmcubWF0Y2gocmVVbmljb2RlKSB8fCBbXTsKICB9CgogIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKICAvKiogVXNlZCBmb3IgYnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMuICovCiAgdmFyIGFycmF5UHJvdG8gPSBBcnJheS5wcm90b3R5cGUsCiAgICAgIGZ1bmNQcm90byA9IEZ1bmN0aW9uLnByb3RvdHlwZSwKICAgICAgb2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlOwoKICAvKiogVXNlZCB0byBkZXRlY3Qgb3ZlcnJlYWNoaW5nIGNvcmUtanMgc2hpbXMuICovCiAgdmFyIGNvcmVKc0RhdGEgPSByb290WydfX2NvcmUtanNfc2hhcmVkX18nXTsKCiAgLyoqIFVzZWQgdG8gcmVzb2x2ZSB0aGUgZGVjb21waWxlZCBzb3VyY2Ugb2YgZnVuY3Rpb25zLiAqLwogIHZhciBmdW5jVG9TdHJpbmcgPSBmdW5jUHJvdG8udG9TdHJpbmc7CgogIC8qKiBVc2VkIHRvIGNoZWNrIG9iamVjdHMgZm9yIG93biBwcm9wZXJ0aWVzLiAqLwogIHZhciBoYXNPd25Qcm9wZXJ0eSA9IG9iamVjdFByb3RvLmhhc093blByb3BlcnR5OwoKICAvKiogVXNlZCB0byBkZXRlY3QgbWV0aG9kcyBtYXNxdWVyYWRpbmcgYXMgbmF0aXZlLiAqLwogIHZhciBtYXNrU3JjS2V5ID0gKGZ1bmN0aW9uKCkgewogICAgdmFyIHVpZCA9IC9bXi5dKyQvLmV4ZWMoY29yZUpzRGF0YSAmJiBjb3JlSnNEYXRhLmtleXMgJiYgY29yZUpzRGF0YS5rZXlzLklFX1BST1RPIHx8ICcnKTsKICAgIHJldHVybiB1aWQgPyAoJ1N5bWJvbChzcmMpXzEuJyArIHVpZCkgOiAnJzsKICB9KCkpOwoKICAvKioKICAgKiBVc2VkIHRvIHJlc29sdmUgdGhlCiAgICogW2B0b1N0cmluZ1RhZ2BdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLW9iamVjdC5wcm90b3R5cGUudG9zdHJpbmcpCiAgICogb2YgdmFsdWVzLgogICAqLwogIHZhciBuYXRpdmVPYmplY3RUb1N0cmluZyA9IG9iamVjdFByb3RvLnRvU3RyaW5nOwoKICAvKiogVXNlZCB0byBpbmZlciB0aGUgYE9iamVjdGAgY29uc3RydWN0b3IuICovCiAgdmFyIG9iamVjdEN0b3JTdHJpbmcgPSBmdW5jVG9TdHJpbmcuY2FsbChPYmplY3QpOwoKICAvKiogVXNlZCB0byBkZXRlY3QgaWYgYSBtZXRob2QgaXMgbmF0aXZlLiAqLwogIHZhciByZUlzTmF0aXZlID0gUmVnRXhwKCdeJyArCiAgICBmdW5jVG9TdHJpbmcuY2FsbChoYXNPd25Qcm9wZXJ0eSkucmVwbGFjZShyZVJlZ0V4cENoYXIsICdcXCQmJykKICAgIC5yZXBsYWNlKC9oYXNPd25Qcm9wZXJ0eXwoZnVuY3Rpb24pLio/KD89XFxcKCl8IGZvciAuKz8oPz1cXFxdKS9nLCAnJDEuKj8nKSArICckJwogICk7CgogIC8qKiBCdWlsdC1pbiB2YWx1ZSByZWZlcmVuY2VzLiAqLwogIHZhciBCdWZmZXIgPSBtb2R1bGVFeHBvcnRzID8gcm9vdC5CdWZmZXIgOiB1bmRlZmluZWQsCiAgICAgIFN5bWJvbCA9IHJvb3QuU3ltYm9sLAogICAgICBVaW50OEFycmF5ID0gcm9vdC5VaW50OEFycmF5LAogICAgICBhbGxvY1Vuc2FmZSA9IEJ1ZmZlciA/IEJ1ZmZlci5hbGxvY1Vuc2FmZSA6IHVuZGVmaW5lZCwKICAgICAgZ2V0UHJvdG90eXBlID0gb3ZlckFyZyhPYmplY3QuZ2V0UHJvdG90eXBlT2YsIE9iamVjdCksCiAgICAgIG9iamVjdENyZWF0ZSA9IE9iamVjdC5jcmVhdGUsCiAgICAgIHByb3BlcnR5SXNFbnVtZXJhYmxlID0gb2JqZWN0UHJvdG8ucHJvcGVydHlJc0VudW1lcmFibGUsCiAgICAgIHNwbGljZSA9IGFycmF5UHJvdG8uc3BsaWNlLAogICAgICBzcHJlYWRhYmxlU3ltYm9sID0gU3ltYm9sID8gU3ltYm9sLmlzQ29uY2F0U3ByZWFkYWJsZSA6IHVuZGVmaW5lZCwKICAgICAgc3ltSXRlcmF0b3IgPSBTeW1ib2wgPyBTeW1ib2wuaXRlcmF0b3IgOiB1bmRlZmluZWQsCiAgICAgIHN5bVRvU3RyaW5nVGFnID0gU3ltYm9sID8gU3ltYm9sLnRvU3RyaW5nVGFnIDogdW5kZWZpbmVkOwoKICB2YXIgZGVmaW5lUHJvcGVydHkgPSAoZnVuY3Rpb24oKSB7CiAgICB0cnkgewogICAgICB2YXIgZnVuYyA9IGdldE5hdGl2ZShPYmplY3QsICdkZWZpbmVQcm9wZXJ0eScpOwogICAgICBmdW5jKHt9LCAnJywge30pOwogICAgICByZXR1cm4gZnVuYzsKICAgIH0gY2F0Y2ggKGUpIHt9CiAgfSgpKTsKCiAgLyogQnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMgZm9yIHRob3NlIHdpdGggdGhlIHNhbWUgbmFtZSBhcyBvdGhlciBgbG9kYXNoYCBtZXRob2RzLiAqLwogIHZhciBuYXRpdmVDZWlsID0gTWF0aC5jZWlsLAogICAgICBuYXRpdmVGbG9vciA9IE1hdGguZmxvb3IsCiAgICAgIG5hdGl2ZUdldFN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzLAogICAgICBuYXRpdmVJc0J1ZmZlciA9IEJ1ZmZlciA/IEJ1ZmZlci5pc0J1ZmZlciA6IHVuZGVmaW5lZCwKICAgICAgbmF0aXZlSXNGaW5pdGUgPSByb290LmlzRmluaXRlLAogICAgICBuYXRpdmVKb2luID0gYXJyYXlQcm90by5qb2luLAogICAgICBuYXRpdmVLZXlzID0gb3ZlckFyZyhPYmplY3Qua2V5cywgT2JqZWN0KSwKICAgICAgbmF0aXZlTWF4ID0gTWF0aC5tYXgsCiAgICAgIG5hdGl2ZU1pbiA9IE1hdGgubWluLAogICAgICBuYXRpdmVOb3cgPSBEYXRlLm5vdywKICAgICAgbmF0aXZlUmV2ZXJzZSA9IGFycmF5UHJvdG8ucmV2ZXJzZTsKCiAgLyogQnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMgdGhhdCBhcmUgdmVyaWZpZWQgdG8gYmUgbmF0aXZlLiAqLwogIHZhciBEYXRhVmlldyA9IGdldE5hdGl2ZShyb290LCAnRGF0YVZpZXcnKSwKICAgICAgTWFwID0gZ2V0TmF0aXZlKHJvb3QsICdNYXAnKSwKICAgICAgUHJvbWlzZSA9IGdldE5hdGl2ZShyb290LCAnUHJvbWlzZScpLAogICAgICBTZXQgPSBnZXROYXRpdmUocm9vdCwgJ1NldCcpLAogICAgICBXZWFrTWFwID0gZ2V0TmF0aXZlKHJvb3QsICdXZWFrTWFwJyksCiAgICAgIG5hdGl2ZUNyZWF0ZSA9IGdldE5hdGl2ZShPYmplY3QsICdjcmVhdGUnKTsKCiAgLyoqIFVzZWQgdG8gbG9va3VwIHVubWluaWZpZWQgZnVuY3Rpb24gbmFtZXMuICovCiAgdmFyIHJlYWxOYW1lcyA9IHt9OwoKICAvKiogVXNlZCB0byBkZXRlY3QgbWFwcywgc2V0cywgYW5kIHdlYWttYXBzLiAqLwogIHZhciBkYXRhVmlld0N0b3JTdHJpbmcgPSB0b1NvdXJjZShEYXRhVmlldyksCiAgICAgIG1hcEN0b3JTdHJpbmcgPSB0b1NvdXJjZShNYXApLAogICAgICBwcm9taXNlQ3RvclN0cmluZyA9IHRvU291cmNlKFByb21pc2UpLAogICAgICBzZXRDdG9yU3RyaW5nID0gdG9Tb3VyY2UoU2V0KSwKICAgICAgd2Vha01hcEN0b3JTdHJpbmcgPSB0b1NvdXJjZShXZWFrTWFwKTsKCiAgLyoqIFVzZWQgdG8gY29udmVydCBzeW1ib2xzIHRvIHByaW1pdGl2ZXMgYW5kIHN0cmluZ3MuICovCiAgdmFyIHN5bWJvbFByb3RvID0gU3ltYm9sID8gU3ltYm9sLnByb3RvdHlwZSA6IHVuZGVmaW5lZCwKICAgICAgc3ltYm9sVmFsdWVPZiA9IHN5bWJvbFByb3RvID8gc3ltYm9sUHJvdG8udmFsdWVPZiA6IHVuZGVmaW5lZCwKICAgICAgc3ltYm9sVG9TdHJpbmcgPSBzeW1ib2xQcm90byA/IHN5bWJvbFByb3RvLnRvU3RyaW5nIDogdW5kZWZpbmVkOwoKICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgogIC8qKgogICAqIENyZWF0ZXMgYSBgbG9kYXNoYCBvYmplY3Qgd2hpY2ggd3JhcHMgYHZhbHVlYCB0byBlbmFibGUgaW1wbGljaXQgbWV0aG9kCiAgICogY2hhaW4gc2VxdWVuY2VzLiBNZXRob2RzIHRoYXQgb3BlcmF0ZSBvbiBhbmQgcmV0dXJuIGFycmF5cywgY29sbGVjdGlvbnMsCiAgICogYW5kIGZ1bmN0aW9ucyBjYW4gYmUgY2hhaW5lZCB0b2dldGhlci4gTWV0aG9kcyB0aGF0IHJldHJpZXZlIGEgc2luZ2xlIHZhbHVlCiAgICogb3IgbWF5IHJldHVybiBhIHByaW1pdGl2ZSB2YWx1ZSB3aWxsIGF1dG9tYXRpY2FsbHkgZW5kIHRoZSBjaGFpbiBzZXF1ZW5jZQogICAqIGFuZCByZXR1cm4gdGhlIHVud3JhcHBlZCB2YWx1ZS4gT3RoZXJ3aXNlLCB0aGUgdmFsdWUgbXVzdCBiZSB1bndyYXBwZWQKICAgKiB3aXRoIGBfI3ZhbHVlYC4KICAgKgogICAqIEV4cGxpY2l0IGNoYWluIHNlcXVlbmNlcywgd2hpY2ggbXVzdCBiZSB1bndyYXBwZWQgd2l0aCBgXyN2YWx1ZWAsIG1heSBiZQogICAqIGVuYWJsZWQgdXNpbmcgYF8uY2hhaW5gLgogICAqCiAgICogVGhlIGV4ZWN1dGlvbiBvZiBjaGFpbmVkIG1ldGhvZHMgaXMgbGF6eSwgdGhhdCBpcywgaXQncyBkZWZlcnJlZCB1bnRpbAogICAqIGBfI3ZhbHVlYCBpcyBpbXBsaWNpdGx5IG9yIGV4cGxpY2l0bHkgY2FsbGVkLgogICAqCiAgICogTGF6eSBldmFsdWF0aW9uIGFsbG93cyBzZXZlcmFsIG1ldGhvZHMgdG8gc3VwcG9ydCBzaG9ydGN1dCBmdXNpb24uCiAgICogU2hvcnRjdXQgZnVzaW9uIGlzIGFuIG9wdGltaXphdGlvbiB0byBtZXJnZSBpdGVyYXRlZSBjYWxsczsgdGhpcyBhdm9pZHMKICAgKiB0aGUgY3JlYXRpb24gb2YgaW50ZXJtZWRpYXRlIGFycmF5cyBhbmQgY2FuIGdyZWF0bHkgcmVkdWNlIHRoZSBudW1iZXIgb2YKICAgKiBpdGVyYXRlZSBleGVjdXRpb25zLiBTZWN0aW9ucyBvZiBhIGNoYWluIHNlcXVlbmNlIHF1YWxpZnkgZm9yIHNob3J0Y3V0CiAgICogZnVzaW9uIGlmIHRoZSBzZWN0aW9uIGlzIGFwcGxpZWQgdG8gYW4gYXJyYXkgYW5kIGl0ZXJhdGVlcyBhY2NlcHQgb25seQogICAqIG9uZSBhcmd1bWVudC4gVGhlIGhldXJpc3RpYyBmb3Igd2hldGhlciBhIHNlY3Rpb24gcXVhbGlmaWVzIGZvciBzaG9ydGN1dAogICAqIGZ1c2lvbiBpcyBzdWJqZWN0IHRvIGNoYW5nZS4KICAgKgogICAqIENoYWluaW5nIGlzIHN1cHBvcnRlZCBpbiBjdXN0b20gYnVpbGRzIGFzIGxvbmcgYXMgdGhlIGBfI3ZhbHVlYCBtZXRob2QgaXMKICAgKiBkaXJlY3RseSBvciBpbmRpcmVjdGx5IGluY2x1ZGVkIGluIHRoZSBidWlsZC4KICAgKgogICAqIEluIGFkZGl0aW9uIHRvIGxvZGFzaCBtZXRob2RzLCB3cmFwcGVycyBoYXZlIGBBcnJheWAgYW5kIGBTdHJpbmdgIG1ldGhvZHMuCiAgICoKICAgKiBUaGUgd3JhcHBlciBgQXJyYXlgIG1ldGhvZHMgYXJlOgogICAqIGBjb25jYXRgLCBgam9pbmAsIGBwb3BgLCBgcHVzaGAsIGBzaGlmdGAsIGBzb3J0YCwgYHNwbGljZWAsIGFuZCBgdW5zaGlmdGAKICAgKgogICAqIFRoZSB3cmFwcGVyIGBTdHJpbmdgIG1ldGhvZHMgYXJlOgogICAqIGByZXBsYWNlYCBhbmQgYHNwbGl0YAogICAqCiAgICogVGhlIHdyYXBwZXIgbWV0aG9kcyB0aGF0IHN1cHBvcnQgc2hvcnRjdXQgZnVzaW9uIGFyZToKICAgKiBgYXRgLCBgY29tcGFjdGAsIGBkcm9wYCwgYGRyb3BSaWdodGAsIGBkcm9wV2hpbGVgLCBgZmlsdGVyYCwgYGZpbmRgLAogICAqIGBmaW5kTGFzdGAsIGBoZWFkYCwgYGluaXRpYWxgLCBgbGFzdGAsIGBtYXBgLCBgcmVqZWN0YCwgYHJldmVyc2VgLCBgc2xpY2VgLAogICAqIGB0YWlsYCwgYHRha2VgLCBgdGFrZVJpZ2h0YCwgYHRha2VSaWdodFdoaWxlYCwgYHRha2VXaGlsZWAsIGFuZCBgdG9BcnJheWAKICAgKgogICAqIFRoZSBjaGFpbmFibGUgd3JhcHBlciBtZXRob2RzIGFyZToKICAgKiBgYWZ0ZXJgLCBgYXJ5YCwgYGFzc2lnbmAsIGBhc3NpZ25JbmAsIGBhc3NpZ25JbldpdGhgLCBgYXNzaWduV2l0aGAsIGBhdGAsCiAgICogYGJlZm9yZWAsIGBiaW5kYCwgYGJpbmRBbGxgLCBgYmluZEtleWAsIGBjYXN0QXJyYXlgLCBgY2hhaW5gLCBgY2h1bmtgLAogICAqIGBjb21taXRgLCBgY29tcGFjdGAsIGBjb25jYXRgLCBgY29uZm9ybXNgLCBgY29uc3RhbnRgLCBgY291bnRCeWAsIGBjcmVhdGVgLAogICAqIGBjdXJyeWAsIGBkZWJvdW5jZWAsIGBkZWZhdWx0c2AsIGBkZWZhdWx0c0RlZXBgLCBgZGVmZXJgLCBgZGVsYXlgLAogICAqIGBkaWZmZXJlbmNlYCwgYGRpZmZlcmVuY2VCeWAsIGBkaWZmZXJlbmNlV2l0aGAsIGBkcm9wYCwgYGRyb3BSaWdodGAsCiAgICogYGRyb3BSaWdodFdoaWxlYCwgYGRyb3BXaGlsZWAsIGBleHRlbmRgLCBgZXh0ZW5kV2l0aGAsIGBmaWxsYCwgYGZpbHRlcmAsCiAgICogYGZsYXRNYXBgLCBgZmxhdE1hcERlZXBgLCBgZmxhdE1hcERlcHRoYCwgYGZsYXR0ZW5gLCBgZmxhdHRlbkRlZXBgLAogICAqIGBmbGF0dGVuRGVwdGhgLCBgZmxpcGAsIGBmbG93YCwgYGZsb3dSaWdodGAsIGBmcm9tUGFpcnNgLCBgZnVuY3Rpb25zYCwKICAgKiBgZnVuY3Rpb25zSW5gLCBgZ3JvdXBCeWAsIGBpbml0aWFsYCwgYGludGVyc2VjdGlvbmAsIGBpbnRlcnNlY3Rpb25CeWAsCiAgICogYGludGVyc2VjdGlvbldpdGhgLCBgaW52ZXJ0YCwgYGludmVydEJ5YCwgYGludm9rZU1hcGAsIGBpdGVyYXRlZWAsIGBrZXlCeWAsCiAgICogYGtleXNgLCBga2V5c0luYCwgYG1hcGAsIGBtYXBLZXlzYCwgYG1hcFZhbHVlc2AsIGBtYXRjaGVzYCwgYG1hdGNoZXNQcm9wZXJ0eWAsCiAgICogYG1lbW9pemVgLCBgbWVyZ2VgLCBgbWVyZ2VXaXRoYCwgYG1ldGhvZGAsIGBtZXRob2RPZmAsIGBtaXhpbmAsIGBuZWdhdGVgLAogICAqIGBudGhBcmdgLCBgb21pdGAsIGBvbWl0QnlgLCBgb25jZWAsIGBvcmRlckJ5YCwgYG92ZXJgLCBgb3ZlckFyZ3NgLAogICAqIGBvdmVyRXZlcnlgLCBgb3ZlclNvbWVgLCBgcGFydGlhbGAsIGBwYXJ0aWFsUmlnaHRgLCBgcGFydGl0aW9uYCwgYHBpY2tgLAogICAqIGBwaWNrQnlgLCBgcGxhbnRgLCBgcHJvcGVydHlgLCBgcHJvcGVydHlPZmAsIGBwdWxsYCwgYHB1bGxBbGxgLCBgcHVsbEFsbEJ5YCwKICAgKiBgcHVsbEFsbFdpdGhgLCBgcHVsbEF0YCwgYHB1c2hgLCBgcmFuZ2VgLCBgcmFuZ2VSaWdodGAsIGByZWFyZ2AsIGByZWplY3RgLAogICAqIGByZW1vdmVgLCBgcmVzdGAsIGByZXZlcnNlYCwgYHNhbXBsZVNpemVgLCBgc2V0YCwgYHNldFdpdGhgLCBgc2h1ZmZsZWAsCiAgICogYHNsaWNlYCwgYHNvcnRgLCBgc29ydEJ5YCwgYHNwbGljZWAsIGBzcHJlYWRgLCBgdGFpbGAsIGB0YWtlYCwgYHRha2VSaWdodGAsCiAgICogYHRha2VSaWdodFdoaWxlYCwgYHRha2VXaGlsZWAsIGB0YXBgLCBgdGhyb3R0bGVgLCBgdGhydWAsIGB0b0FycmF5YCwKICAgKiBgdG9QYWlyc2AsIGB0b1BhaXJzSW5gLCBgdG9QYXRoYCwgYHRvUGxhaW5PYmplY3RgLCBgdHJhbnNmb3JtYCwgYHVuYXJ5YCwKICAgKiBgdW5pb25gLCBgdW5pb25CeWAsIGB1bmlvbldpdGhgLCBgdW5pcWAsIGB1bmlxQnlgLCBgdW5pcVdpdGhgLCBgdW5zZXRgLAogICAqIGB1bnNoaWZ0YCwgYHVuemlwYCwgYHVuemlwV2l0aGAsIGB1cGRhdGVgLCBgdXBkYXRlV2l0aGAsIGB2YWx1ZXNgLAogICAqIGB2YWx1ZXNJbmAsIGB3aXRob3V0YCwgYHdyYXBgLCBgeG9yYCwgYHhvckJ5YCwgYHhvcldpdGhgLCBgemlwYCwKICAgKiBgemlwT2JqZWN0YCwgYHppcE9iamVjdERlZXBgLCBhbmQgYHppcFdpdGhgCiAgICoKICAgKiBUaGUgd3JhcHBlciBtZXRob2RzIHRoYXQgYXJlICoqbm90KiogY2hhaW5hYmxlIGJ5IGRlZmF1bHQgYXJlOgogICAqIGBhZGRgLCBgYXR0ZW1wdGAsIGBjYW1lbENhc2VgLCBgY2FwaXRhbGl6ZWAsIGBjZWlsYCwgYGNsYW1wYCwgYGNsb25lYCwKICAgKiBgY2xvbmVEZWVwYCwgYGNsb25lRGVlcFdpdGhgLCBgY2xvbmVXaXRoYCwgYGNvbmZvcm1zVG9gLCBgZGVidXJyYCwKICAgKiBgZGVmYXVsdFRvYCwgYGRpdmlkZWAsIGBlYWNoYCwgYGVhY2hSaWdodGAsIGBlbmRzV2l0aGAsIGBlcWAsIGBlc2NhcGVgLAogICAqIGBlc2NhcGVSZWdFeHBgLCBgZXZlcnlgLCBgZmluZGAsIGBmaW5kSW5kZXhgLCBgZmluZEtleWAsIGBmaW5kTGFzdGAsCiAgICogYGZpbmRMYXN0SW5kZXhgLCBgZmluZExhc3RLZXlgLCBgZmlyc3RgLCBgZmxvb3JgLCBgZm9yRWFjaGAsIGBmb3JFYWNoUmlnaHRgLAogICAqIGBmb3JJbmAsIGBmb3JJblJpZ2h0YCwgYGZvck93bmAsIGBmb3JPd25SaWdodGAsIGBnZXRgLCBgZ3RgLCBgZ3RlYCwgYGhhc2AsCiAgICogYGhhc0luYCwgYGhlYWRgLCBgaWRlbnRpdHlgLCBgaW5jbHVkZXNgLCBgaW5kZXhPZmAsIGBpblJhbmdlYCwgYGludm9rZWAsCiAgICogYGlzQXJndW1lbnRzYCwgYGlzQXJyYXlgLCBgaXNBcnJheUJ1ZmZlcmAsIGBpc0FycmF5TGlrZWAsIGBpc0FycmF5TGlrZU9iamVjdGAsCiAgICogYGlzQm9vbGVhbmAsIGBpc0J1ZmZlcmAsIGBpc0RhdGVgLCBgaXNFbGVtZW50YCwgYGlzRW1wdHlgLCBgaXNFcXVhbGAsCiAgICogYGlzRXF1YWxXaXRoYCwgYGlzRXJyb3JgLCBgaXNGaW5pdGVgLCBgaXNGdW5jdGlvbmAsIGBpc0ludGVnZXJgLCBgaXNMZW5ndGhgLAogICAqIGBpc01hcGAsIGBpc01hdGNoYCwgYGlzTWF0Y2hXaXRoYCwgYGlzTmFOYCwgYGlzTmF0aXZlYCwgYGlzTmlsYCwgYGlzTnVsbGAsCiAgICogYGlzTnVtYmVyYCwgYGlzT2JqZWN0YCwgYGlzT2JqZWN0TGlrZWAsIGBpc1BsYWluT2JqZWN0YCwgYGlzUmVnRXhwYCwKICAgKiBgaXNTYWZlSW50ZWdlcmAsIGBpc1NldGAsIGBpc1N0cmluZ2AsIGBpc1VuZGVmaW5lZGAsIGBpc1R5cGVkQXJyYXlgLAogICAqIGBpc1dlYWtNYXBgLCBgaXNXZWFrU2V0YCwgYGpvaW5gLCBga2ViYWJDYXNlYCwgYGxhc3RgLCBgbGFzdEluZGV4T2ZgLAogICAqIGBsb3dlckNhc2VgLCBgbG93ZXJGaXJzdGAsIGBsdGAsIGBsdGVgLCBgbWF4YCwgYG1heEJ5YCwgYG1lYW5gLCBgbWVhbkJ5YCwKICAgKiBgbWluYCwgYG1pbkJ5YCwgYG11bHRpcGx5YCwgYG5vQ29uZmxpY3RgLCBgbm9vcGAsIGBub3dgLCBgbnRoYCwgYHBhZGAsCiAgICogYHBhZEVuZGAsIGBwYWRTdGFydGAsIGBwYXJzZUludGAsIGBwb3BgLCBgcmFuZG9tYCwgYHJlZHVjZWAsIGByZWR1Y2VSaWdodGAsCiAgICogYHJlcGVhdGAsIGByZXN1bHRgLCBgcm91bmRgLCBgcnVuSW5Db250ZXh0YCwgYHNhbXBsZWAsIGBzaGlmdGAsIGBzaXplYCwKICAgKiBgc25ha2VDYXNlYCwgYHNvbWVgLCBgc29ydGVkSW5kZXhgLCBgc29ydGVkSW5kZXhCeWAsIGBzb3J0ZWRMYXN0SW5kZXhgLAogICAqIGBzb3J0ZWRMYXN0SW5kZXhCeWAsIGBzdGFydENhc2VgLCBgc3RhcnRzV2l0aGAsIGBzdHViQXJyYXlgLCBgc3R1YkZhbHNlYCwKICAgKiBgc3R1Yk9iamVjdGAsIGBzdHViU3RyaW5nYCwgYHN0dWJUcnVlYCwgYHN1YnRyYWN0YCwgYHN1bWAsIGBzdW1CeWAsCiAgICogYHRlbXBsYXRlYCwgYHRpbWVzYCwgYHRvRmluaXRlYCwgYHRvSW50ZWdlcmAsIGB0b0pTT05gLCBgdG9MZW5ndGhgLAogICAqIGB0b0xvd2VyYCwgYHRvTnVtYmVyYCwgYHRvU2FmZUludGVnZXJgLCBgdG9TdHJpbmdgLCBgdG9VcHBlcmAsIGB0cmltYCwKICAgKiBgdHJpbUVuZGAsIGB0cmltU3RhcnRgLCBgdHJ1bmNhdGVgLCBgdW5lc2NhcGVgLCBgdW5pcXVlSWRgLCBgdXBwZXJDYXNlYCwKICAgKiBgdXBwZXJGaXJzdGAsIGB2YWx1ZWAsIGFuZCBgd29yZHNgCiAgICoKICAgKiBAbmFtZSBfCiAgICogQGNvbnN0cnVjdG9yCiAgICogQGNhdGVnb3J5IFNlcQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHdyYXAgaW4gYSBgbG9kYXNoYCBpbnN0YW5jZS4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBuZXcgYGxvZGFzaGAgd3JhcHBlciBpbnN0YW5jZS4KICAgKiBAZXhhbXBsZQogICAqCiAgICogZnVuY3Rpb24gc3F1YXJlKG4pIHsKICAgKiAgIHJldHVybiBuICogbjsKICAgKiB9CiAgICoKICAgKiB2YXIgd3JhcHBlZCA9IF8oWzEsIDIsIDNdKTsKICAgKgogICAqIC8vIFJldHVybnMgYW4gdW53cmFwcGVkIHZhbHVlLgogICAqIHdyYXBwZWQucmVkdWNlKF8uYWRkKTsKICAgKiAvLyA9PiA2CiAgICoKICAgKiAvLyBSZXR1cm5zIGEgd3JhcHBlZCB2YWx1ZS4KICAgKiB2YXIgc3F1YXJlcyA9IHdyYXBwZWQubWFwKHNxdWFyZSk7CiAgICoKICAgKiBfLmlzQXJyYXkoc3F1YXJlcyk7CiAgICogLy8gPT4gZmFsc2UKICAgKgogICAqIF8uaXNBcnJheShzcXVhcmVzLnZhbHVlKCkpOwogICAqIC8vID0+IHRydWUKICAgKi8KICBmdW5jdGlvbiBsb2Rhc2goKSB7CiAgICAvLyBObyBvcGVyYXRpb24gcGVyZm9ybWVkLgogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uY3JlYXRlYCB3aXRob3V0IHN1cHBvcnQgZm9yIGFzc2lnbmluZwogICAqIHByb3BlcnRpZXMgdG8gdGhlIGNyZWF0ZWQgb2JqZWN0LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gcHJvdG8gVGhlIG9iamVjdCB0byBpbmhlcml0IGZyb20uCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbmV3IG9iamVjdC4KICAgKi8KICB2YXIgYmFzZUNyZWF0ZSA9IChmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIG9iamVjdCgpIHt9CiAgICByZXR1cm4gZnVuY3Rpb24ocHJvdG8pIHsKICAgICAgaWYgKCFpc09iamVjdChwcm90bykpIHsKICAgICAgICByZXR1cm4ge307CiAgICAgIH0KICAgICAgaWYgKG9iamVjdENyZWF0ZSkgewogICAgICAgIHJldHVybiBvYmplY3RDcmVhdGUocHJvdG8pOwogICAgICB9CiAgICAgIG9iamVjdC5wcm90b3R5cGUgPSBwcm90bzsKICAgICAgdmFyIHJlc3VsdCA9IG5ldyBvYmplY3Q7CiAgICAgIG9iamVjdC5wcm90b3R5cGUgPSB1bmRlZmluZWQ7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9OwogIH0oKSk7CgogIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCiAgLyoqCiAgICogQ3JlYXRlcyBhIGhhc2ggb2JqZWN0LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAY29uc3RydWN0b3IKICAgKiBAcGFyYW0ge0FycmF5fSBbZW50cmllc10gVGhlIGtleS12YWx1ZSBwYWlycyB0byBjYWNoZS4KICAgKi8KICBmdW5jdGlvbiBIYXNoKGVudHJpZXMpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IGVudHJpZXMgPT0gbnVsbCA/IDAgOiBlbnRyaWVzLmxlbmd0aDsKCiAgICB0aGlzLmNsZWFyKCk7CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICB2YXIgZW50cnkgPSBlbnRyaWVzW2luZGV4XTsKICAgICAgdGhpcy5zZXQoZW50cnlbMF0sIGVudHJ5WzFdKTsKICAgIH0KICB9CgogIC8qKgogICAqIFJlbW92ZXMgYWxsIGtleS12YWx1ZSBlbnRyaWVzIGZyb20gdGhlIGhhc2guCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGNsZWFyCiAgICogQG1lbWJlck9mIEhhc2gKICAgKi8KICBmdW5jdGlvbiBoYXNoQ2xlYXIoKSB7CiAgICB0aGlzLl9fZGF0YV9fID0gbmF0aXZlQ3JlYXRlID8gbmF0aXZlQ3JlYXRlKG51bGwpIDoge307CiAgICB0aGlzLnNpemUgPSAwOwogIH0KCiAgLyoqCiAgICogUmVtb3ZlcyBga2V5YCBhbmQgaXRzIHZhbHVlIGZyb20gdGhlIGhhc2guCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGRlbGV0ZQogICAqIEBtZW1iZXJPZiBIYXNoCiAgICogQHBhcmFtIHtPYmplY3R9IGhhc2ggVGhlIGhhc2ggdG8gbW9kaWZ5LgogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gcmVtb3ZlLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZW50cnkgd2FzIHJlbW92ZWQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBoYXNoRGVsZXRlKGtleSkgewogICAgdmFyIHJlc3VsdCA9IHRoaXMuaGFzKGtleSkgJiYgZGVsZXRlIHRoaXMuX19kYXRhX19ba2V5XTsKICAgIHRoaXMuc2l6ZSAtPSByZXN1bHQgPyAxIDogMDsKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBHZXRzIHRoZSBoYXNoIHZhbHVlIGZvciBga2V5YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgZ2V0CiAgICogQG1lbWJlck9mIEhhc2gKICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIGdldC4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgZW50cnkgdmFsdWUuCiAgICovCiAgZnVuY3Rpb24gaGFzaEdldChrZXkpIHsKICAgIHZhciBkYXRhID0gdGhpcy5fX2RhdGFfXzsKICAgIGlmIChuYXRpdmVDcmVhdGUpIHsKICAgICAgdmFyIHJlc3VsdCA9IGRhdGFba2V5XTsKICAgICAgcmV0dXJuIHJlc3VsdCA9PT0gSEFTSF9VTkRFRklORUQgPyB1bmRlZmluZWQgOiByZXN1bHQ7CiAgICB9CiAgICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbChkYXRhLCBrZXkpID8gZGF0YVtrZXldIDogdW5kZWZpbmVkOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGEgaGFzaCB2YWx1ZSBmb3IgYGtleWAgZXhpc3RzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBoYXMKICAgKiBAbWVtYmVyT2YgSGFzaAogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgZW50cnkgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGFuIGVudHJ5IGZvciBga2V5YCBleGlzdHMsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBoYXNoSGFzKGtleSkgewogICAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fOwogICAgcmV0dXJuIG5hdGl2ZUNyZWF0ZSA/IChkYXRhW2tleV0gIT09IHVuZGVmaW5lZCkgOiBoYXNPd25Qcm9wZXJ0eS5jYWxsKGRhdGEsIGtleSk7CiAgfQoKICAvKioKICAgKiBTZXRzIHRoZSBoYXNoIGBrZXlgIHRvIGB2YWx1ZWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIHNldAogICAqIEBtZW1iZXJPZiBIYXNoCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBzZXQuCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2V0LgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGhhc2ggaW5zdGFuY2UuCiAgICovCiAgZnVuY3Rpb24gaGFzaFNldChrZXksIHZhbHVlKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX187CiAgICB0aGlzLnNpemUgKz0gdGhpcy5oYXMoa2V5KSA/IDAgOiAxOwogICAgZGF0YVtrZXldID0gKG5hdGl2ZUNyZWF0ZSAmJiB2YWx1ZSA9PT0gdW5kZWZpbmVkKSA/IEhBU0hfVU5ERUZJTkVEIDogdmFsdWU7CiAgICByZXR1cm4gdGhpczsKICB9CgogIC8vIEFkZCBtZXRob2RzIHRvIGBIYXNoYC4KICBIYXNoLnByb3RvdHlwZS5jbGVhciA9IGhhc2hDbGVhcjsKICBIYXNoLnByb3RvdHlwZVsnZGVsZXRlJ10gPSBoYXNoRGVsZXRlOwogIEhhc2gucHJvdG90eXBlLmdldCA9IGhhc2hHZXQ7CiAgSGFzaC5wcm90b3R5cGUuaGFzID0gaGFzaEhhczsKICBIYXNoLnByb3RvdHlwZS5zZXQgPSBoYXNoU2V0OwoKICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgogIC8qKgogICAqIENyZWF0ZXMgYW4gbGlzdCBjYWNoZSBvYmplY3QuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBjb25zdHJ1Y3RvcgogICAqIEBwYXJhbSB7QXJyYXl9IFtlbnRyaWVzXSBUaGUga2V5LXZhbHVlIHBhaXJzIHRvIGNhY2hlLgogICAqLwogIGZ1bmN0aW9uIExpc3RDYWNoZShlbnRyaWVzKSB7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICBsZW5ndGggPSBlbnRyaWVzID09IG51bGwgPyAwIDogZW50cmllcy5sZW5ndGg7CgogICAgdGhpcy5jbGVhcigpOwogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgdmFyIGVudHJ5ID0gZW50cmllc1tpbmRleF07CiAgICAgIHRoaXMuc2V0KGVudHJ5WzBdLCBlbnRyeVsxXSk7CiAgICB9CiAgfQoKICAvKioKICAgKiBSZW1vdmVzIGFsbCBrZXktdmFsdWUgZW50cmllcyBmcm9tIHRoZSBsaXN0IGNhY2hlLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBjbGVhcgogICAqIEBtZW1iZXJPZiBMaXN0Q2FjaGUKICAgKi8KICBmdW5jdGlvbiBsaXN0Q2FjaGVDbGVhcigpIHsKICAgIHRoaXMuX19kYXRhX18gPSBbXTsKICAgIHRoaXMuc2l6ZSA9IDA7CiAgfQoKICAvKioKICAgKiBSZW1vdmVzIGBrZXlgIGFuZCBpdHMgdmFsdWUgZnJvbSB0aGUgbGlzdCBjYWNoZS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgZGVsZXRlCiAgICogQG1lbWJlck9mIExpc3RDYWNoZQogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gcmVtb3ZlLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZW50cnkgd2FzIHJlbW92ZWQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBsaXN0Q2FjaGVEZWxldGUoa2V5KSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX18sCiAgICAgICAgaW5kZXggPSBhc3NvY0luZGV4T2YoZGF0YSwga2V5KTsKCiAgICBpZiAoaW5kZXggPCAwKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHZhciBsYXN0SW5kZXggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICBpZiAoaW5kZXggPT0gbGFzdEluZGV4KSB7CiAgICAgIGRhdGEucG9wKCk7CiAgICB9IGVsc2UgewogICAgICBzcGxpY2UuY2FsbChkYXRhLCBpbmRleCwgMSk7CiAgICB9CiAgICAtLXRoaXMuc2l6ZTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogR2V0cyB0aGUgbGlzdCBjYWNoZSB2YWx1ZSBmb3IgYGtleWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGdldAogICAqIEBtZW1iZXJPZiBMaXN0Q2FjaGUKICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIGdldC4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgZW50cnkgdmFsdWUuCiAgICovCiAgZnVuY3Rpb24gbGlzdENhY2hlR2V0KGtleSkgewogICAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fLAogICAgICAgIGluZGV4ID0gYXNzb2NJbmRleE9mKGRhdGEsIGtleSk7CgogICAgcmV0dXJuIGluZGV4IDwgMCA/IHVuZGVmaW5lZCA6IGRhdGFbaW5kZXhdWzFdOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGEgbGlzdCBjYWNoZSB2YWx1ZSBmb3IgYGtleWAgZXhpc3RzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBoYXMKICAgKiBAbWVtYmVyT2YgTGlzdENhY2hlCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSBlbnRyeSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYW4gZW50cnkgZm9yIGBrZXlgIGV4aXN0cywgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGxpc3RDYWNoZUhhcyhrZXkpIHsKICAgIHJldHVybiBhc3NvY0luZGV4T2YodGhpcy5fX2RhdGFfXywga2V5KSA+IC0xOwogIH0KCiAgLyoqCiAgICogU2V0cyB0aGUgbGlzdCBjYWNoZSBga2V5YCB0byBgdmFsdWVgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBzZXQKICAgKiBAbWVtYmVyT2YgTGlzdENhY2hlCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBzZXQuCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2V0LgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGxpc3QgY2FjaGUgaW5zdGFuY2UuCiAgICovCiAgZnVuY3Rpb24gbGlzdENhY2hlU2V0KGtleSwgdmFsdWUpIHsKICAgIHZhciBkYXRhID0gdGhpcy5fX2RhdGFfXywKICAgICAgICBpbmRleCA9IGFzc29jSW5kZXhPZihkYXRhLCBrZXkpOwoKICAgIGlmIChpbmRleCA8IDApIHsKICAgICAgKyt0aGlzLnNpemU7CiAgICAgIGRhdGEucHVzaChba2V5LCB2YWx1ZV0pOwogICAgfSBlbHNlIHsKICAgICAgZGF0YVtpbmRleF1bMV0gPSB2YWx1ZTsKICAgIH0KICAgIHJldHVybiB0aGlzOwogIH0KCiAgLy8gQWRkIG1ldGhvZHMgdG8gYExpc3RDYWNoZWAuCiAgTGlzdENhY2hlLnByb3RvdHlwZS5jbGVhciA9IGxpc3RDYWNoZUNsZWFyOwogIExpc3RDYWNoZS5wcm90b3R5cGVbJ2RlbGV0ZSddID0gbGlzdENhY2hlRGVsZXRlOwogIExpc3RDYWNoZS5wcm90b3R5cGUuZ2V0ID0gbGlzdENhY2hlR2V0OwogIExpc3RDYWNoZS5wcm90b3R5cGUuaGFzID0gbGlzdENhY2hlSGFzOwogIExpc3RDYWNoZS5wcm90b3R5cGUuc2V0ID0gbGlzdENhY2hlU2V0OwoKICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgogIC8qKgogICAqIENyZWF0ZXMgYSBtYXAgY2FjaGUgb2JqZWN0IHRvIHN0b3JlIGtleS12YWx1ZSBwYWlycy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQGNvbnN0cnVjdG9yCiAgICogQHBhcmFtIHtBcnJheX0gW2VudHJpZXNdIFRoZSBrZXktdmFsdWUgcGFpcnMgdG8gY2FjaGUuCiAgICovCiAgZnVuY3Rpb24gTWFwQ2FjaGUoZW50cmllcykgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gZW50cmllcyA9PSBudWxsID8gMCA6IGVudHJpZXMubGVuZ3RoOwoKICAgIHRoaXMuY2xlYXIoKTsKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHZhciBlbnRyeSA9IGVudHJpZXNbaW5kZXhdOwogICAgICB0aGlzLnNldChlbnRyeVswXSwgZW50cnlbMV0pOwogICAgfQogIH0KCiAgLyoqCiAgICogUmVtb3ZlcyBhbGwga2V5LXZhbHVlIGVudHJpZXMgZnJvbSB0aGUgbWFwLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBjbGVhcgogICAqIEBtZW1iZXJPZiBNYXBDYWNoZQogICAqLwogIGZ1bmN0aW9uIG1hcENhY2hlQ2xlYXIoKSB7CiAgICB0aGlzLnNpemUgPSAwOwogICAgdGhpcy5fX2RhdGFfXyA9IHsKICAgICAgJ2hhc2gnOiBuZXcgSGFzaCwKICAgICAgJ21hcCc6IG5ldyAoTWFwIHx8IExpc3RDYWNoZSksCiAgICAgICdzdHJpbmcnOiBuZXcgSGFzaAogICAgfTsKICB9CgogIC8qKgogICAqIFJlbW92ZXMgYGtleWAgYW5kIGl0cyB2YWx1ZSBmcm9tIHRoZSBtYXAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGRlbGV0ZQogICAqIEBtZW1iZXJPZiBNYXBDYWNoZQogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gcmVtb3ZlLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZW50cnkgd2FzIHJlbW92ZWQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBtYXBDYWNoZURlbGV0ZShrZXkpIHsKICAgIHZhciByZXN1bHQgPSBnZXRNYXBEYXRhKHRoaXMsIGtleSlbJ2RlbGV0ZSddKGtleSk7CiAgICB0aGlzLnNpemUgLT0gcmVzdWx0ID8gMSA6IDA7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogR2V0cyB0aGUgbWFwIHZhbHVlIGZvciBga2V5YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgZ2V0CiAgICogQG1lbWJlck9mIE1hcENhY2hlCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBnZXQuCiAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGVudHJ5IHZhbHVlLgogICAqLwogIGZ1bmN0aW9uIG1hcENhY2hlR2V0KGtleSkgewogICAgcmV0dXJuIGdldE1hcERhdGEodGhpcywga2V5KS5nZXQoa2V5KTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBhIG1hcCB2YWx1ZSBmb3IgYGtleWAgZXhpc3RzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBoYXMKICAgKiBAbWVtYmVyT2YgTWFwQ2FjaGUKICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIGVudHJ5IHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBhbiBlbnRyeSBmb3IgYGtleWAgZXhpc3RzLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gbWFwQ2FjaGVIYXMoa2V5KSB7CiAgICByZXR1cm4gZ2V0TWFwRGF0YSh0aGlzLCBrZXkpLmhhcyhrZXkpOwogIH0KCiAgLyoqCiAgICogU2V0cyB0aGUgbWFwIGBrZXlgIHRvIGB2YWx1ZWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIHNldAogICAqIEBtZW1iZXJPZiBNYXBDYWNoZQogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gc2V0LgogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNldC4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBtYXAgY2FjaGUgaW5zdGFuY2UuCiAgICovCiAgZnVuY3Rpb24gbWFwQ2FjaGVTZXQoa2V5LCB2YWx1ZSkgewogICAgdmFyIGRhdGEgPSBnZXRNYXBEYXRhKHRoaXMsIGtleSksCiAgICAgICAgc2l6ZSA9IGRhdGEuc2l6ZTsKCiAgICBkYXRhLnNldChrZXksIHZhbHVlKTsKICAgIHRoaXMuc2l6ZSArPSBkYXRhLnNpemUgPT0gc2l6ZSA/IDAgOiAxOwogICAgcmV0dXJuIHRoaXM7CiAgfQoKICAvLyBBZGQgbWV0aG9kcyB0byBgTWFwQ2FjaGVgLgogIE1hcENhY2hlLnByb3RvdHlwZS5jbGVhciA9IG1hcENhY2hlQ2xlYXI7CiAgTWFwQ2FjaGUucHJvdG90eXBlWydkZWxldGUnXSA9IG1hcENhY2hlRGVsZXRlOwogIE1hcENhY2hlLnByb3RvdHlwZS5nZXQgPSBtYXBDYWNoZUdldDsKICBNYXBDYWNoZS5wcm90b3R5cGUuaGFzID0gbWFwQ2FjaGVIYXM7CiAgTWFwQ2FjaGUucHJvdG90eXBlLnNldCA9IG1hcENhY2hlU2V0OwoKICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgogIC8qKgogICAqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBjYWNoZSBvYmplY3QgdG8gc3RvcmUgdW5pcXVlIHZhbHVlcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQGNvbnN0cnVjdG9yCiAgICogQHBhcmFtIHtBcnJheX0gW3ZhbHVlc10gVGhlIHZhbHVlcyB0byBjYWNoZS4KICAgKi8KICBmdW5jdGlvbiBTZXRDYWNoZSh2YWx1ZXMpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IHZhbHVlcyA9PSBudWxsID8gMCA6IHZhbHVlcy5sZW5ndGg7CgogICAgdGhpcy5fX2RhdGFfXyA9IG5ldyBNYXBDYWNoZTsKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHRoaXMuYWRkKHZhbHVlc1tpbmRleF0pOwogICAgfQogIH0KCiAgLyoqCiAgICogQWRkcyBgdmFsdWVgIHRvIHRoZSBhcnJheSBjYWNoZS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgYWRkCiAgICogQG1lbWJlck9mIFNldENhY2hlCiAgICogQGFsaWFzIHB1c2gKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjYWNoZS4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjYWNoZSBpbnN0YW5jZS4KICAgKi8KICBmdW5jdGlvbiBzZXRDYWNoZUFkZCh2YWx1ZSkgewogICAgdGhpcy5fX2RhdGFfXy5zZXQodmFsdWUsIEhBU0hfVU5ERUZJTkVEKTsKICAgIHJldHVybiB0aGlzOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgaW4gdGhlIGFycmF5IGNhY2hlLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBoYXMKICAgKiBAbWVtYmVyT2YgU2V0Q2FjaGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZWFyY2ggZm9yLgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgZm91bmQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBzZXRDYWNoZUhhcyh2YWx1ZSkgewogICAgcmV0dXJuIHRoaXMuX19kYXRhX18uaGFzKHZhbHVlKTsKICB9CgogIC8vIEFkZCBtZXRob2RzIHRvIGBTZXRDYWNoZWAuCiAgU2V0Q2FjaGUucHJvdG90eXBlLmFkZCA9IFNldENhY2hlLnByb3RvdHlwZS5wdXNoID0gc2V0Q2FjaGVBZGQ7CiAgU2V0Q2FjaGUucHJvdG90eXBlLmhhcyA9IHNldENhY2hlSGFzOwoKICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgogIC8qKgogICAqIENyZWF0ZXMgYSBzdGFjayBjYWNoZSBvYmplY3QgdG8gc3RvcmUga2V5LXZhbHVlIHBhaXJzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAY29uc3RydWN0b3IKICAgKiBAcGFyYW0ge0FycmF5fSBbZW50cmllc10gVGhlIGtleS12YWx1ZSBwYWlycyB0byBjYWNoZS4KICAgKi8KICBmdW5jdGlvbiBTdGFjayhlbnRyaWVzKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX18gPSBuZXcgTGlzdENhY2hlKGVudHJpZXMpOwogICAgdGhpcy5zaXplID0gZGF0YS5zaXplOwogIH0KCiAgLyoqCiAgICogUmVtb3ZlcyBhbGwga2V5LXZhbHVlIGVudHJpZXMgZnJvbSB0aGUgc3RhY2suCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGNsZWFyCiAgICogQG1lbWJlck9mIFN0YWNrCiAgICovCiAgZnVuY3Rpb24gc3RhY2tDbGVhcigpIHsKICAgIHRoaXMuX19kYXRhX18gPSBuZXcgTGlzdENhY2hlOwogICAgdGhpcy5zaXplID0gMDsKICB9CgogIC8qKgogICAqIFJlbW92ZXMgYGtleWAgYW5kIGl0cyB2YWx1ZSBmcm9tIHRoZSBzdGFjay4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgZGVsZXRlCiAgICogQG1lbWJlck9mIFN0YWNrCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byByZW1vdmUuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBlbnRyeSB3YXMgcmVtb3ZlZCwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIHN0YWNrRGVsZXRlKGtleSkgewogICAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fLAogICAgICAgIHJlc3VsdCA9IGRhdGFbJ2RlbGV0ZSddKGtleSk7CgogICAgdGhpcy5zaXplID0gZGF0YS5zaXplOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIHN0YWNrIHZhbHVlIGZvciBga2V5YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgZ2V0CiAgICogQG1lbWJlck9mIFN0YWNrCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBnZXQuCiAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGVudHJ5IHZhbHVlLgogICAqLwogIGZ1bmN0aW9uIHN0YWNrR2V0KGtleSkgewogICAgcmV0dXJuIHRoaXMuX19kYXRhX18uZ2V0KGtleSk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYSBzdGFjayB2YWx1ZSBmb3IgYGtleWAgZXhpc3RzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBoYXMKICAgKiBAbWVtYmVyT2YgU3RhY2sKICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIGVudHJ5IHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBhbiBlbnRyeSBmb3IgYGtleWAgZXhpc3RzLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gc3RhY2tIYXMoa2V5KSB7CiAgICByZXR1cm4gdGhpcy5fX2RhdGFfXy5oYXMoa2V5KTsKICB9CgogIC8qKgogICAqIFNldHMgdGhlIHN0YWNrIGBrZXlgIHRvIGB2YWx1ZWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIHNldAogICAqIEBtZW1iZXJPZiBTdGFjawogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gc2V0LgogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNldC4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBzdGFjayBjYWNoZSBpbnN0YW5jZS4KICAgKi8KICBmdW5jdGlvbiBzdGFja1NldChrZXksIHZhbHVlKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX187CiAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIExpc3RDYWNoZSkgewogICAgICB2YXIgcGFpcnMgPSBkYXRhLl9fZGF0YV9fOwogICAgICBpZiAoIU1hcCB8fCAocGFpcnMubGVuZ3RoIDwgTEFSR0VfQVJSQVlfU0laRSAtIDEpKSB7CiAgICAgICAgcGFpcnMucHVzaChba2V5LCB2YWx1ZV0pOwogICAgICAgIHRoaXMuc2l6ZSA9ICsrZGF0YS5zaXplOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIGRhdGEgPSB0aGlzLl9fZGF0YV9fID0gbmV3IE1hcENhY2hlKHBhaXJzKTsKICAgIH0KICAgIGRhdGEuc2V0KGtleSwgdmFsdWUpOwogICAgdGhpcy5zaXplID0gZGF0YS5zaXplOwogICAgcmV0dXJuIHRoaXM7CiAgfQoKICAvLyBBZGQgbWV0aG9kcyB0byBgU3RhY2tgLgogIFN0YWNrLnByb3RvdHlwZS5jbGVhciA9IHN0YWNrQ2xlYXI7CiAgU3RhY2sucHJvdG90eXBlWydkZWxldGUnXSA9IHN0YWNrRGVsZXRlOwogIFN0YWNrLnByb3RvdHlwZS5nZXQgPSBzdGFja0dldDsKICBTdGFjay5wcm90b3R5cGUuaGFzID0gc3RhY2tIYXM7CiAgU3RhY2sucHJvdG90eXBlLnNldCA9IHN0YWNrU2V0OwoKICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgogIC8qKgogICAqIENyZWF0ZXMgYW4gYXJyYXkgb2YgdGhlIGVudW1lcmFibGUgcHJvcGVydHkgbmFtZXMgb2YgdGhlIGFycmF5LWxpa2UgYHZhbHVlYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcXVlcnkuCiAgICogQHBhcmFtIHtib29sZWFufSBpbmhlcml0ZWQgU3BlY2lmeSByZXR1cm5pbmcgaW5oZXJpdGVkIHByb3BlcnR5IG5hbWVzLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcHJvcGVydHkgbmFtZXMuCiAgICovCiAgZnVuY3Rpb24gYXJyYXlMaWtlS2V5cyh2YWx1ZSwgaW5oZXJpdGVkKSB7CiAgICB2YXIgaXNBcnIgPSBpc0FycmF5KHZhbHVlKSwKICAgICAgICBpc0FyZyA9ICFpc0FyciAmJiBpc0FyZ3VtZW50cyh2YWx1ZSksCiAgICAgICAgaXNCdWZmID0gIWlzQXJyICYmICFpc0FyZyAmJiBpc0J1ZmZlcih2YWx1ZSksCiAgICAgICAgaXNUeXBlID0gIWlzQXJyICYmICFpc0FyZyAmJiAhaXNCdWZmICYmIGlzVHlwZWRBcnJheSh2YWx1ZSksCiAgICAgICAgc2tpcEluZGV4ZXMgPSBpc0FyciB8fCBpc0FyZyB8fCBpc0J1ZmYgfHwgaXNUeXBlLAogICAgICAgIHJlc3VsdCA9IHNraXBJbmRleGVzID8gYmFzZVRpbWVzKHZhbHVlLmxlbmd0aCwgU3RyaW5nKSA6IFtdLAogICAgICAgIGxlbmd0aCA9IHJlc3VsdC5sZW5ndGg7CgogICAgZm9yICh2YXIga2V5IGluIHZhbHVlKSB7CiAgICAgIGlmICgoaW5oZXJpdGVkIHx8IGhhc093blByb3BlcnR5LmNhbGwodmFsdWUsIGtleSkpICYmCiAgICAgICAgICAhKHNraXBJbmRleGVzICYmICgKICAgICAgICAgICAgIC8vIFNhZmFyaSA5IGhhcyBlbnVtZXJhYmxlIGBhcmd1bWVudHMubGVuZ3RoYCBpbiBzdHJpY3QgbW9kZS4KICAgICAgICAgICAgIGtleSA9PSAnbGVuZ3RoJyB8fAogICAgICAgICAgICAgLy8gTm9kZS5qcyAwLjEwIGhhcyBlbnVtZXJhYmxlIG5vbi1pbmRleCBwcm9wZXJ0aWVzIG9uIGJ1ZmZlcnMuCiAgICAgICAgICAgICAoaXNCdWZmICYmIChrZXkgPT0gJ29mZnNldCcgfHwga2V5ID09ICdwYXJlbnQnKSkgfHwKICAgICAgICAgICAgIC8vIFBoYW50b21KUyAyIGhhcyBlbnVtZXJhYmxlIG5vbi1pbmRleCBwcm9wZXJ0aWVzIG9uIHR5cGVkIGFycmF5cy4KICAgICAgICAgICAgIChpc1R5cGUgJiYgKGtleSA9PSAnYnVmZmVyJyB8fCBrZXkgPT0gJ2J5dGVMZW5ndGgnIHx8IGtleSA9PSAnYnl0ZU9mZnNldCcpKSB8fAogICAgICAgICAgICAgLy8gU2tpcCBpbmRleCBwcm9wZXJ0aWVzLgogICAgICAgICAgICAgaXNJbmRleChrZXksIGxlbmd0aCkKICAgICAgICAgICkpKSB7CiAgICAgICAgcmVzdWx0LnB1c2goa2V5KTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIEFzc2lnbnMgYHZhbHVlYCB0byBga2V5YCBvZiBgb2JqZWN0YCBpZiB0aGUgZXhpc3RpbmcgdmFsdWUgaXMgbm90IGVxdWl2YWxlbnQKICAgKiB1c2luZyBbYFNhbWVWYWx1ZVplcm9gXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1zYW1ldmFsdWV6ZXJvKQogICAqIGZvciBlcXVhbGl0eSBjb21wYXJpc29ucy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIG1vZGlmeS4KICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHByb3BlcnR5IHRvIGFzc2lnbi4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBhc3NpZ24uCiAgICovCiAgZnVuY3Rpb24gYXNzaWduVmFsdWUob2JqZWN0LCBrZXksIHZhbHVlKSB7CiAgICB2YXIgb2JqVmFsdWUgPSBvYmplY3Rba2V5XTsKICAgIGlmICghKGhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBrZXkpICYmIGVxKG9ialZhbHVlLCB2YWx1ZSkpIHx8CiAgICAgICAgKHZhbHVlID09PSB1bmRlZmluZWQgJiYgIShrZXkgaW4gb2JqZWN0KSkpIHsKICAgICAgYmFzZUFzc2lnblZhbHVlKG9iamVjdCwga2V5LCB2YWx1ZSk7CiAgICB9CiAgfQoKICAvKioKICAgKiBHZXRzIHRoZSBpbmRleCBhdCB3aGljaCB0aGUgYGtleWAgaXMgZm91bmQgaW4gYGFycmF5YCBvZiBrZXktdmFsdWUgcGFpcnMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7Kn0ga2V5IFRoZSBrZXkgdG8gc2VhcmNoIGZvci4KICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgbWF0Y2hlZCB2YWx1ZSwgZWxzZSBgLTFgLgogICAqLwogIGZ1bmN0aW9uIGFzc29jSW5kZXhPZihhcnJheSwga2V5KSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgd2hpbGUgKGxlbmd0aC0tKSB7CiAgICAgIGlmIChlcShhcnJheVtsZW5ndGhdWzBdLCBrZXkpKSB7CiAgICAgICAgcmV0dXJuIGxlbmd0aDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIC0xOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uYXNzaWduYCB3aXRob3V0IHN1cHBvcnQgZm9yIG11bHRpcGxlIHNvdXJjZXMKICAgKiBvciBgY3VzdG9taXplcmAgZnVuY3Rpb25zLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBkZXN0aW5hdGlvbiBvYmplY3QuCiAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgc291cmNlIG9iamVjdC4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VBc3NpZ24ob2JqZWN0LCBzb3VyY2UpIHsKICAgIHJldHVybiBvYmplY3QgJiYgY29weU9iamVjdChzb3VyY2UsIGtleXMoc291cmNlKSwgb2JqZWN0KTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmFzc2lnbkluYCB3aXRob3V0IHN1cHBvcnQgZm9yIG11bHRpcGxlIHNvdXJjZXMKICAgKiBvciBgY3VzdG9taXplcmAgZnVuY3Rpb25zLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBkZXN0aW5hdGlvbiBvYmplY3QuCiAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgc291cmNlIG9iamVjdC4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VBc3NpZ25JbihvYmplY3QsIHNvdXJjZSkgewogICAgcmV0dXJuIG9iamVjdCAmJiBjb3B5T2JqZWN0KHNvdXJjZSwga2V5c0luKHNvdXJjZSksIG9iamVjdCk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgYXNzaWduVmFsdWVgIGFuZCBgYXNzaWduTWVyZ2VWYWx1ZWAgd2l0aG91dAogICAqIHZhbHVlIGNoZWNrcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIG1vZGlmeS4KICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHByb3BlcnR5IHRvIGFzc2lnbi4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBhc3NpZ24uCiAgICovCiAgZnVuY3Rpb24gYmFzZUFzc2lnblZhbHVlKG9iamVjdCwga2V5LCB2YWx1ZSkgewogICAgaWYgKGtleSA9PSAnX19wcm90b19fJyAmJiBkZWZpbmVQcm9wZXJ0eSkgewogICAgICBkZWZpbmVQcm9wZXJ0eShvYmplY3QsIGtleSwgewogICAgICAgICdjb25maWd1cmFibGUnOiB0cnVlLAogICAgICAgICdlbnVtZXJhYmxlJzogdHJ1ZSwKICAgICAgICAndmFsdWUnOiB2YWx1ZSwKICAgICAgICAnd3JpdGFibGUnOiB0cnVlCiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgb2JqZWN0W2tleV0gPSB2YWx1ZTsKICAgIH0KICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmF0YCB3aXRob3V0IHN1cHBvcnQgZm9yIGluZGl2aWR1YWwgcGF0aHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpdGVyYXRlIG92ZXIuCiAgICogQHBhcmFtIHtzdHJpbmdbXX0gcGF0aHMgVGhlIHByb3BlcnR5IHBhdGhzIHRvIHBpY2suCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBwaWNrZWQgZWxlbWVudHMuCiAgICovCiAgZnVuY3Rpb24gYmFzZUF0KG9iamVjdCwgcGF0aHMpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IHBhdGhzLmxlbmd0aCwKICAgICAgICByZXN1bHQgPSBBcnJheShsZW5ndGgpLAogICAgICAgIHNraXAgPSBvYmplY3QgPT0gbnVsbDsKCiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICByZXN1bHRbaW5kZXhdID0gc2tpcCA/IHVuZGVmaW5lZCA6IGdldChvYmplY3QsIHBhdGhzW2luZGV4XSk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uY2xhbXBgIHdoaWNoIGRvZXNuJ3QgY29lcmNlIGFyZ3VtZW50cy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtudW1iZXJ9IG51bWJlciBUaGUgbnVtYmVyIHRvIGNsYW1wLgogICAqIEBwYXJhbSB7bnVtYmVyfSBbbG93ZXJdIFRoZSBsb3dlciBib3VuZC4KICAgKiBAcGFyYW0ge251bWJlcn0gdXBwZXIgVGhlIHVwcGVyIGJvdW5kLgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGNsYW1wZWQgbnVtYmVyLgogICAqLwogIGZ1bmN0aW9uIGJhc2VDbGFtcChudW1iZXIsIGxvd2VyLCB1cHBlcikgewogICAgaWYgKG51bWJlciA9PT0gbnVtYmVyKSB7CiAgICAgIGlmICh1cHBlciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbnVtYmVyID0gbnVtYmVyIDw9IHVwcGVyID8gbnVtYmVyIDogdXBwZXI7CiAgICAgIH0KICAgICAgaWYgKGxvd2VyICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBudW1iZXIgPSBudW1iZXIgPj0gbG93ZXIgPyBudW1iZXIgOiBsb3dlcjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG51bWJlcjsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmNsb25lYCBhbmQgYF8uY2xvbmVEZWVwYCB3aGljaCB0cmFja3MKICAgKiB0cmF2ZXJzZWQgb2JqZWN0cy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2xvbmUuCiAgICogQHBhcmFtIHtib29sZWFufSBiaXRtYXNrIFRoZSBiaXRtYXNrIGZsYWdzLgogICAqICAxIC0gRGVlcCBjbG9uZQogICAqICAyIC0gRmxhdHRlbiBpbmhlcml0ZWQgcHJvcGVydGllcwogICAqICA0IC0gQ2xvbmUgc3ltYm9scwogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjdXN0b21pemVyXSBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNsb25pbmcuCiAgICogQHBhcmFtIHtzdHJpbmd9IFtrZXldIFRoZSBrZXkgb2YgYHZhbHVlYC4KICAgKiBAcGFyYW0ge09iamVjdH0gW29iamVjdF0gVGhlIHBhcmVudCBvYmplY3Qgb2YgYHZhbHVlYC4KICAgKiBAcGFyYW0ge09iamVjdH0gW3N0YWNrXSBUcmFja3MgdHJhdmVyc2VkIG9iamVjdHMgYW5kIHRoZWlyIGNsb25lIGNvdW50ZXJwYXJ0cy4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgY2xvbmVkIHZhbHVlLgogICAqLwogIGZ1bmN0aW9uIGJhc2VDbG9uZSh2YWx1ZSwgYml0bWFzaywgY3VzdG9taXplciwga2V5LCBvYmplY3QsIHN0YWNrKSB7CiAgICB2YXIgcmVzdWx0LAogICAgICAgIGlzRGVlcCA9IGJpdG1hc2sgJiBDTE9ORV9ERUVQX0ZMQUcsCiAgICAgICAgaXNGbGF0ID0gYml0bWFzayAmIENMT05FX0ZMQVRfRkxBRywKICAgICAgICBpc0Z1bGwgPSBiaXRtYXNrICYgQ0xPTkVfU1lNQk9MU19GTEFHOwoKICAgIGlmIChjdXN0b21pemVyKSB7CiAgICAgIHJlc3VsdCA9IG9iamVjdCA/IGN1c3RvbWl6ZXIodmFsdWUsIGtleSwgb2JqZWN0LCBzdGFjaykgOiBjdXN0b21pemVyKHZhbHVlKTsKICAgIH0KICAgIGlmIChyZXN1bHQgIT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgaWYgKCFpc09iamVjdCh2YWx1ZSkpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogICAgdmFyIGlzQXJyID0gaXNBcnJheSh2YWx1ZSk7CiAgICBpZiAoaXNBcnIpIHsKICAgICAgcmVzdWx0ID0gaW5pdENsb25lQXJyYXkodmFsdWUpOwogICAgICBpZiAoIWlzRGVlcCkgewogICAgICAgIHJldHVybiBjb3B5QXJyYXkodmFsdWUsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHZhciB0YWcgPSBnZXRUYWcodmFsdWUpLAogICAgICAgICAgaXNGdW5jID0gdGFnID09IGZ1bmNUYWcgfHwgdGFnID09IGdlblRhZzsKCiAgICAgIGlmIChpc0J1ZmZlcih2YWx1ZSkpIHsKICAgICAgICByZXR1cm4gY2xvbmVCdWZmZXIodmFsdWUsIGlzRGVlcCk7CiAgICAgIH0KICAgICAgaWYgKHRhZyA9PSBvYmplY3RUYWcgfHwgdGFnID09IGFyZ3NUYWcgfHwgKGlzRnVuYyAmJiAhb2JqZWN0KSkgewogICAgICAgIHJlc3VsdCA9IChpc0ZsYXQgfHwgaXNGdW5jKSA/IHt9IDogaW5pdENsb25lT2JqZWN0KHZhbHVlKTsKICAgICAgICBpZiAoIWlzRGVlcCkgewogICAgICAgICAgcmV0dXJuIGlzRmxhdAogICAgICAgICAgICA/IGNvcHlTeW1ib2xzSW4odmFsdWUsIGJhc2VBc3NpZ25JbihyZXN1bHQsIHZhbHVlKSkKICAgICAgICAgICAgOiBjb3B5U3ltYm9scyh2YWx1ZSwgYmFzZUFzc2lnbihyZXN1bHQsIHZhbHVlKSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmICghY2xvbmVhYmxlVGFnc1t0YWddKSB7CiAgICAgICAgICByZXR1cm4gb2JqZWN0ID8gdmFsdWUgOiB7fTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0ID0gaW5pdENsb25lQnlUYWcodmFsdWUsIHRhZywgYmFzZUNsb25lLCBpc0RlZXApOwogICAgICB9CiAgICB9CiAgICAvLyBDaGVjayBmb3IgY2lyY3VsYXIgcmVmZXJlbmNlcyBhbmQgcmV0dXJuIGl0cyBjb3JyZXNwb25kaW5nIGNsb25lLgogICAgc3RhY2sgfHwgKHN0YWNrID0gbmV3IFN0YWNrKTsKICAgIHZhciBzdGFja2VkID0gc3RhY2suZ2V0KHZhbHVlKTsKICAgIGlmIChzdGFja2VkKSB7CiAgICAgIHJldHVybiBzdGFja2VkOwogICAgfQogICAgc3RhY2suc2V0KHZhbHVlLCByZXN1bHQpOwoKICAgIHZhciBrZXlzRnVuYyA9IGlzRnVsbAogICAgICA/IChpc0ZsYXQgPyBnZXRBbGxLZXlzSW4gOiBnZXRBbGxLZXlzKQogICAgICA6IChpc0ZsYXQgPyBrZXlzSW4gOiBrZXlzKTsKCiAgICB2YXIgcHJvcHMgPSBpc0FyciA/IHVuZGVmaW5lZCA6IGtleXNGdW5jKHZhbHVlKTsKICAgIGFycmF5RWFjaChwcm9wcyB8fCB2YWx1ZSwgZnVuY3Rpb24oc3ViVmFsdWUsIGtleSkgewogICAgICBpZiAocHJvcHMpIHsKICAgICAgICBrZXkgPSBzdWJWYWx1ZTsKICAgICAgICBzdWJWYWx1ZSA9IHZhbHVlW2tleV07CiAgICAgIH0KICAgICAgLy8gUmVjdXJzaXZlbHkgcG9wdWxhdGUgY2xvbmUgKHN1c2NlcHRpYmxlIHRvIGNhbGwgc3RhY2sgbGltaXRzKS4KICAgICAgYXNzaWduVmFsdWUocmVzdWx0LCBrZXksIGJhc2VDbG9uZShzdWJWYWx1ZSwgYml0bWFzaywgY3VzdG9taXplciwga2V5LCB2YWx1ZSwgc3RhY2spKTsKICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmNvbmZvcm1zVG9gIHdoaWNoIGFjY2VwdHMgYHByb3BzYCB0byBjaGVjay4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgb2JqZWN0IG9mIHByb3BlcnR5IHByZWRpY2F0ZXMgdG8gY29uZm9ybSB0by4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYG9iamVjdGAgY29uZm9ybXMsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBiYXNlQ29uZm9ybXNUbyhvYmplY3QsIHNvdXJjZSwgcHJvcHMpIHsKICAgIHZhciBsZW5ndGggPSBwcm9wcy5sZW5ndGg7CiAgICBpZiAob2JqZWN0ID09IG51bGwpIHsKICAgICAgcmV0dXJuICFsZW5ndGg7CiAgICB9CiAgICBvYmplY3QgPSBPYmplY3Qob2JqZWN0KTsKICAgIHdoaWxlIChsZW5ndGgtLSkgewogICAgICB2YXIga2V5ID0gcHJvcHNbbGVuZ3RoXSwKICAgICAgICAgIHByZWRpY2F0ZSA9IHNvdXJjZVtrZXldLAogICAgICAgICAgdmFsdWUgPSBvYmplY3Rba2V5XTsKCiAgICAgIGlmICgodmFsdWUgPT09IHVuZGVmaW5lZCAmJiAhKGtleSBpbiBvYmplY3QpKSB8fCAhcHJlZGljYXRlKHZhbHVlKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBtZXRob2RzIGxpa2UgYF8uZGlmZmVyZW5jZWAgd2l0aG91dCBzdXBwb3J0CiAgICogZm9yIGV4Y2x1ZGluZyBtdWx0aXBsZSBhcnJheXMgb3IgaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHtBcnJheX0gdmFsdWVzIFRoZSB2YWx1ZXMgdG8gZXhjbHVkZS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWVdIFRoZSBpdGVyYXRlZSBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjb21wYXJhdG9yXSBUaGUgY29tcGFyYXRvciBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIGZpbHRlcmVkIHZhbHVlcy4KICAgKi8KICBmdW5jdGlvbiBiYXNlRGlmZmVyZW5jZShhcnJheSwgdmFsdWVzLCBpdGVyYXRlZSwgY29tcGFyYXRvcikgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgaW5jbHVkZXMgPSBhcnJheUluY2x1ZGVzLAogICAgICAgIGlzQ29tbW9uID0gdHJ1ZSwKICAgICAgICBsZW5ndGggPSBhcnJheS5sZW5ndGgsCiAgICAgICAgcmVzdWx0ID0gW10sCiAgICAgICAgdmFsdWVzTGVuZ3RoID0gdmFsdWVzLmxlbmd0aDsKCiAgICBpZiAoIWxlbmd0aCkgewogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgaWYgKGl0ZXJhdGVlKSB7CiAgICAgIHZhbHVlcyA9IGFycmF5TWFwKHZhbHVlcywgYmFzZVVuYXJ5KGl0ZXJhdGVlKSk7CiAgICB9CiAgICBpZiAoY29tcGFyYXRvcikgewogICAgICBpbmNsdWRlcyA9IGFycmF5SW5jbHVkZXNXaXRoOwogICAgICBpc0NvbW1vbiA9IGZhbHNlOwogICAgfQogICAgZWxzZSBpZiAodmFsdWVzLmxlbmd0aCA+PSBMQVJHRV9BUlJBWV9TSVpFKSB7CiAgICAgIGluY2x1ZGVzID0gY2FjaGVIYXM7CiAgICAgIGlzQ29tbW9uID0gZmFsc2U7CiAgICAgIHZhbHVlcyA9IG5ldyBTZXRDYWNoZSh2YWx1ZXMpOwogICAgfQogICAgb3V0ZXI6CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICB2YXIgdmFsdWUgPSBhcnJheVtpbmRleF0sCiAgICAgICAgICBjb21wdXRlZCA9IGl0ZXJhdGVlID09IG51bGwgPyB2YWx1ZSA6IGl0ZXJhdGVlKHZhbHVlKTsKCiAgICAgIHZhbHVlID0gKGNvbXBhcmF0b3IgfHwgdmFsdWUgIT09IDApID8gdmFsdWUgOiAwOwogICAgICBpZiAoaXNDb21tb24gJiYgY29tcHV0ZWQgPT09IGNvbXB1dGVkKSB7CiAgICAgICAgdmFyIHZhbHVlc0luZGV4ID0gdmFsdWVzTGVuZ3RoOwogICAgICAgIHdoaWxlICh2YWx1ZXNJbmRleC0tKSB7CiAgICAgICAgICBpZiAodmFsdWVzW3ZhbHVlc0luZGV4XSA9PT0gY29tcHV0ZWQpIHsKICAgICAgICAgICAgY29udGludWUgb3V0ZXI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlKTsKICAgICAgfQogICAgICBlbHNlIGlmICghaW5jbHVkZXModmFsdWVzLCBjb21wdXRlZCwgY29tcGFyYXRvcikpIHsKICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5maWxsYCB3aXRob3V0IGFuIGl0ZXJhdGVlIGNhbGwgZ3VhcmQuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBmaWxsLgogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGZpbGwgYGFycmF5YCB3aXRoLgogICAqIEBwYXJhbSB7bnVtYmVyfSBbc3RhcnQ9MF0gVGhlIHN0YXJ0IHBvc2l0aW9uLgogICAqIEBwYXJhbSB7bnVtYmVyfSBbZW5kPWFycmF5Lmxlbmd0aF0gVGhlIGVuZCBwb3NpdGlvbi4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC4KICAgKi8KICBmdW5jdGlvbiBiYXNlRmlsbChhcnJheSwgdmFsdWUsIHN0YXJ0LCBlbmQpIHsKICAgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGg7CgogICAgc3RhcnQgPSB0b0ludGVnZXIoc3RhcnQpOwogICAgaWYgKHN0YXJ0IDwgMCkgewogICAgICBzdGFydCA9IC1zdGFydCA+IGxlbmd0aCA/IDAgOiAobGVuZ3RoICsgc3RhcnQpOwogICAgfQogICAgZW5kID0gKGVuZCA9PT0gdW5kZWZpbmVkIHx8IGVuZCA+IGxlbmd0aCkgPyBsZW5ndGggOiB0b0ludGVnZXIoZW5kKTsKICAgIGlmIChlbmQgPCAwKSB7CiAgICAgIGVuZCArPSBsZW5ndGg7CiAgICB9CiAgICBlbmQgPSBzdGFydCA+IGVuZCA/IDAgOiB0b0xlbmd0aChlbmQpOwogICAgd2hpbGUgKHN0YXJ0IDwgZW5kKSB7CiAgICAgIGFycmF5W3N0YXJ0KytdID0gdmFsdWU7CiAgICB9CiAgICByZXR1cm4gYXJyYXk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5mbGF0dGVuYCB3aXRoIHN1cHBvcnQgZm9yIHJlc3RyaWN0aW5nIGZsYXR0ZW5pbmcuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBmbGF0dGVuLgogICAqIEBwYXJhbSB7bnVtYmVyfSBkZXB0aCBUaGUgbWF4aW11bSByZWN1cnNpb24gZGVwdGguCiAgICogQHBhcmFtIHtib29sZWFufSBbcHJlZGljYXRlPWlzRmxhdHRlbmFibGVdIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uCiAgICogQHBhcmFtIHtib29sZWFufSBbaXNTdHJpY3RdIFJlc3RyaWN0IHRvIHZhbHVlcyB0aGF0IHBhc3MgYHByZWRpY2F0ZWAgY2hlY2tzLgogICAqIEBwYXJhbSB7QXJyYXl9IFtyZXN1bHQ9W11dIFRoZSBpbml0aWFsIHJlc3VsdCB2YWx1ZS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBmbGF0dGVuZWQgYXJyYXkuCiAgICovCiAgZnVuY3Rpb24gYmFzZUZsYXR0ZW4oYXJyYXksIGRlcHRoLCBwcmVkaWNhdGUsIGlzU3RyaWN0LCByZXN1bHQpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsKCiAgICBwcmVkaWNhdGUgfHwgKHByZWRpY2F0ZSA9IGlzRmxhdHRlbmFibGUpOwogICAgcmVzdWx0IHx8IChyZXN1bHQgPSBbXSk7CgogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgdmFyIHZhbHVlID0gYXJyYXlbaW5kZXhdOwogICAgICBpZiAoZGVwdGggPiAwICYmIHByZWRpY2F0ZSh2YWx1ZSkpIHsKICAgICAgICBpZiAoZGVwdGggPiAxKSB7CiAgICAgICAgICAvLyBSZWN1cnNpdmVseSBmbGF0dGVuIGFycmF5cyAoc3VzY2VwdGlibGUgdG8gY2FsbCBzdGFjayBsaW1pdHMpLgogICAgICAgICAgYmFzZUZsYXR0ZW4odmFsdWUsIGRlcHRoIC0gMSwgcHJlZGljYXRlLCBpc1N0cmljdCwgcmVzdWx0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXJyYXlQdXNoKHJlc3VsdCwgdmFsdWUpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICghaXNTdHJpY3QpIHsKICAgICAgICByZXN1bHRbcmVzdWx0Lmxlbmd0aF0gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmdldGAgd2l0aG91dCBzdXBwb3J0IGZvciBkZWZhdWx0IHZhbHVlcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7QXJyYXl8c3RyaW5nfSBwYXRoIFRoZSBwYXRoIG9mIHRoZSBwcm9wZXJ0eSB0byBnZXQuCiAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIHJlc29sdmVkIHZhbHVlLgogICAqLwogIGZ1bmN0aW9uIGJhc2VHZXQob2JqZWN0LCBwYXRoKSB7CiAgICBwYXRoID0gY2FzdFBhdGgocGF0aCwgb2JqZWN0KTsKCiAgICB2YXIgaW5kZXggPSAwLAogICAgICAgIGxlbmd0aCA9IHBhdGgubGVuZ3RoOwoKICAgIHdoaWxlIChvYmplY3QgIT0gbnVsbCAmJiBpbmRleCA8IGxlbmd0aCkgewogICAgICBvYmplY3QgPSBvYmplY3RbdG9LZXkocGF0aFtpbmRleCsrXSldOwogICAgfQogICAgcmV0dXJuIChpbmRleCAmJiBpbmRleCA9PSBsZW5ndGgpID8gb2JqZWN0IDogdW5kZWZpbmVkOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYGdldEFsbEtleXNgIGFuZCBgZ2V0QWxsS2V5c0luYCB3aGljaCB1c2VzCiAgICogYGtleXNGdW5jYCBhbmQgYHN5bWJvbHNGdW5jYCB0byBnZXQgdGhlIGVudW1lcmFibGUgcHJvcGVydHkgbmFtZXMgYW5kCiAgICogc3ltYm9scyBvZiBgb2JqZWN0YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGtleXNGdW5jIFRoZSBmdW5jdGlvbiB0byBnZXQgdGhlIGtleXMgb2YgYG9iamVjdGAuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gc3ltYm9sc0Z1bmMgVGhlIGZ1bmN0aW9uIHRvIGdldCB0aGUgc3ltYm9scyBvZiBgb2JqZWN0YC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzIGFuZCBzeW1ib2xzLgogICAqLwogIGZ1bmN0aW9uIGJhc2VHZXRBbGxLZXlzKG9iamVjdCwga2V5c0Z1bmMsIHN5bWJvbHNGdW5jKSB7CiAgICB2YXIgcmVzdWx0ID0ga2V5c0Z1bmMob2JqZWN0KTsKICAgIHJldHVybiBpc0FycmF5KG9iamVjdCkgPyByZXN1bHQgOiBhcnJheVB1c2gocmVzdWx0LCBzeW1ib2xzRnVuYyhvYmplY3QpKTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBnZXRUYWdgIHdpdGhvdXQgZmFsbGJhY2tzIGZvciBidWdneSBlbnZpcm9ubWVudHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHF1ZXJ5LgogICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGB0b1N0cmluZ1RhZ2AuCiAgICovCiAgZnVuY3Rpb24gYmFzZUdldFRhZyh2YWx1ZSkgewogICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWRUYWcgOiBudWxsVGFnOwogICAgfQogICAgcmV0dXJuIChzeW1Ub1N0cmluZ1RhZyAmJiBzeW1Ub1N0cmluZ1RhZyBpbiBPYmplY3QodmFsdWUpKQogICAgICA/IGdldFJhd1RhZyh2YWx1ZSkKICAgICAgOiBvYmplY3RUb1N0cmluZyh2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5ndGAgd2hpY2ggZG9lc24ndCBjb2VyY2UgYXJndW1lbnRzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb21wYXJlLgogICAqIEBwYXJhbSB7Kn0gb3RoZXIgVGhlIG90aGVyIHZhbHVlIHRvIGNvbXBhcmUuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgZ3JlYXRlciB0aGFuIGBvdGhlcmAsCiAgICogIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBiYXNlR3QodmFsdWUsIG90aGVyKSB7CiAgICByZXR1cm4gdmFsdWUgPiBvdGhlcjsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmhhc0luYCB3aXRob3V0IHN1cHBvcnQgZm9yIGRlZXAgcGF0aHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBbb2JqZWN0XSBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7QXJyYXl8c3RyaW5nfSBrZXkgVGhlIGtleSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYGtleWAgZXhpc3RzLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gYmFzZUhhc0luKG9iamVjdCwga2V5KSB7CiAgICByZXR1cm4gb2JqZWN0ICE9IG51bGwgJiYga2V5IGluIE9iamVjdChvYmplY3QpOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgbWV0aG9kcyBsaWtlIGBfLmludGVyc2VjdGlvbmAsIHdpdGhvdXQgc3VwcG9ydAogICAqIGZvciBpdGVyYXRlZSBzaG9ydGhhbmRzLCB0aGF0IGFjY2VwdHMgYW4gYXJyYXkgb2YgYXJyYXlzIHRvIGluc3BlY3QuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5cyBUaGUgYXJyYXlzIHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlXSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY29tcGFyYXRvcl0gVGhlIGNvbXBhcmF0b3IgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBzaGFyZWQgdmFsdWVzLgogICAqLwogIGZ1bmN0aW9uIGJhc2VJbnRlcnNlY3Rpb24oYXJyYXlzLCBpdGVyYXRlZSwgY29tcGFyYXRvcikgewogICAgdmFyIGluY2x1ZGVzID0gY29tcGFyYXRvciA/IGFycmF5SW5jbHVkZXNXaXRoIDogYXJyYXlJbmNsdWRlcywKICAgICAgICBsZW5ndGggPSBhcnJheXNbMF0ubGVuZ3RoLAogICAgICAgIG90aExlbmd0aCA9IGFycmF5cy5sZW5ndGgsCiAgICAgICAgb3RoSW5kZXggPSBvdGhMZW5ndGgsCiAgICAgICAgY2FjaGVzID0gQXJyYXkob3RoTGVuZ3RoKSwKICAgICAgICBtYXhMZW5ndGggPSBJbmZpbml0eSwKICAgICAgICByZXN1bHQgPSBbXTsKCiAgICB3aGlsZSAob3RoSW5kZXgtLSkgewogICAgICB2YXIgYXJyYXkgPSBhcnJheXNbb3RoSW5kZXhdOwogICAgICBpZiAob3RoSW5kZXggJiYgaXRlcmF0ZWUpIHsKICAgICAgICBhcnJheSA9IGFycmF5TWFwKGFycmF5LCBiYXNlVW5hcnkoaXRlcmF0ZWUpKTsKICAgICAgfQogICAgICBtYXhMZW5ndGggPSBuYXRpdmVNaW4oYXJyYXkubGVuZ3RoLCBtYXhMZW5ndGgpOwogICAgICBjYWNoZXNbb3RoSW5kZXhdID0gIWNvbXBhcmF0b3IgJiYgKGl0ZXJhdGVlIHx8IChsZW5ndGggPj0gMTIwICYmIGFycmF5Lmxlbmd0aCA+PSAxMjApKQogICAgICAgID8gbmV3IFNldENhY2hlKG90aEluZGV4ICYmIGFycmF5KQogICAgICAgIDogdW5kZWZpbmVkOwogICAgfQogICAgYXJyYXkgPSBhcnJheXNbMF07CgogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgc2VlbiA9IGNhY2hlc1swXTsKCiAgICBvdXRlcjoKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoICYmIHJlc3VsdC5sZW5ndGggPCBtYXhMZW5ndGgpIHsKICAgICAgdmFyIHZhbHVlID0gYXJyYXlbaW5kZXhdLAogICAgICAgICAgY29tcHV0ZWQgPSBpdGVyYXRlZSA/IGl0ZXJhdGVlKHZhbHVlKSA6IHZhbHVlOwoKICAgICAgdmFsdWUgPSAoY29tcGFyYXRvciB8fCB2YWx1ZSAhPT0gMCkgPyB2YWx1ZSA6IDA7CiAgICAgIGlmICghKHNlZW4KICAgICAgICAgICAgPyBjYWNoZUhhcyhzZWVuLCBjb21wdXRlZCkKICAgICAgICAgICAgOiBpbmNsdWRlcyhyZXN1bHQsIGNvbXB1dGVkLCBjb21wYXJhdG9yKQogICAgICAgICAgKSkgewogICAgICAgIG90aEluZGV4ID0gb3RoTGVuZ3RoOwogICAgICAgIHdoaWxlICgtLW90aEluZGV4KSB7CiAgICAgICAgICB2YXIgY2FjaGUgPSBjYWNoZXNbb3RoSW5kZXhdOwogICAgICAgICAgaWYgKCEoY2FjaGUKICAgICAgICAgICAgICAgID8gY2FjaGVIYXMoY2FjaGUsIGNvbXB1dGVkKQogICAgICAgICAgICAgICAgOiBpbmNsdWRlcyhhcnJheXNbb3RoSW5kZXhdLCBjb21wdXRlZCwgY29tcGFyYXRvcikpCiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgIGNvbnRpbnVlIG91dGVyOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoc2VlbikgewogICAgICAgICAgc2Vlbi5wdXNoKGNvbXB1dGVkKTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uaXNBcmd1bWVudHNgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBgYXJndW1lbnRzYCBvYmplY3QsCiAgICovCiAgZnVuY3Rpb24gYmFzZUlzQXJndW1lbnRzKHZhbHVlKSB7CiAgICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBiYXNlR2V0VGFnKHZhbHVlKSA9PSBhcmdzVGFnOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uaXNBcnJheUJ1ZmZlcmAgd2l0aG91dCBOb2RlLmpzIG9wdGltaXphdGlvbnMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGFuIGFycmF5IGJ1ZmZlciwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VJc0FycmF5QnVmZmVyKHZhbHVlKSB7CiAgICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBiYXNlR2V0VGFnKHZhbHVlKSA9PSBhcnJheUJ1ZmZlclRhZzsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmlzRGF0ZWAgd2l0aG91dCBOb2RlLmpzIG9wdGltaXphdGlvbnMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgZGF0ZSBvYmplY3QsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBiYXNlSXNEYXRlKHZhbHVlKSB7CiAgICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBiYXNlR2V0VGFnKHZhbHVlKSA9PSBkYXRlVGFnOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uaXNFcXVhbGAgd2hpY2ggc3VwcG9ydHMgcGFydGlhbCBjb21wYXJpc29ucwogICAqIGFuZCB0cmFja3MgdHJhdmVyc2VkIG9iamVjdHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbXBhcmUuCiAgICogQHBhcmFtIHsqfSBvdGhlciBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0ge2Jvb2xlYW59IGJpdG1hc2sgVGhlIGJpdG1hc2sgZmxhZ3MuCiAgICogIDEgLSBVbm9yZGVyZWQgY29tcGFyaXNvbgogICAqICAyIC0gUGFydGlhbCBjb21wYXJpc29uCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2N1c3RvbWl6ZXJdIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgY29tcGFyaXNvbnMuCiAgICogQHBhcmFtIHtPYmplY3R9IFtzdGFja10gVHJhY2tzIHRyYXZlcnNlZCBgdmFsdWVgIGFuZCBgb3RoZXJgIG9iamVjdHMuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSB2YWx1ZXMgYXJlIGVxdWl2YWxlbnQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBiYXNlSXNFcXVhbCh2YWx1ZSwgb3RoZXIsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIHN0YWNrKSB7CiAgICBpZiAodmFsdWUgPT09IG90aGVyKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKHZhbHVlID09IG51bGwgfHwgb3RoZXIgPT0gbnVsbCB8fCAoIWlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgIWlzT2JqZWN0TGlrZShvdGhlcikpKSB7CiAgICAgIHJldHVybiB2YWx1ZSAhPT0gdmFsdWUgJiYgb3RoZXIgIT09IG90aGVyOwogICAgfQogICAgcmV0dXJuIGJhc2VJc0VxdWFsRGVlcCh2YWx1ZSwgb3RoZXIsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGJhc2VJc0VxdWFsLCBzdGFjayk7CiAgfQoKICAvKioKICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYGJhc2VJc0VxdWFsYCBmb3IgYXJyYXlzIGFuZCBvYmplY3RzIHdoaWNoIHBlcmZvcm1zCiAgICogZGVlcCBjb21wYXJpc29ucyBhbmQgdHJhY2tzIHRyYXZlcnNlZCBvYmplY3RzIGVuYWJsaW5nIG9iamVjdHMgd2l0aCBjaXJjdWxhcgogICAqIHJlZmVyZW5jZXMgdG8gYmUgY29tcGFyZWQuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBjb21wYXJlLgogICAqIEBwYXJhbSB7T2JqZWN0fSBvdGhlciBUaGUgb3RoZXIgb2JqZWN0IHRvIGNvbXBhcmUuCiAgICogQHBhcmFtIHtudW1iZXJ9IGJpdG1hc2sgVGhlIGJpdG1hc2sgZmxhZ3MuIFNlZSBgYmFzZUlzRXF1YWxgIGZvciBtb3JlIGRldGFpbHMuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY3VzdG9taXplciBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNvbXBhcmlzb25zLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGVxdWFsRnVuYyBUaGUgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGVxdWl2YWxlbnRzIG9mIHZhbHVlcy4KICAgKiBAcGFyYW0ge09iamVjdH0gW3N0YWNrXSBUcmFja3MgdHJhdmVyc2VkIGBvYmplY3RgIGFuZCBgb3RoZXJgIG9iamVjdHMuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBvYmplY3RzIGFyZSBlcXVpdmFsZW50LCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gYmFzZUlzRXF1YWxEZWVwKG9iamVjdCwgb3RoZXIsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGVxdWFsRnVuYywgc3RhY2spIHsKICAgIHZhciBvYmpJc0FyciA9IGlzQXJyYXkob2JqZWN0KSwKICAgICAgICBvdGhJc0FyciA9IGlzQXJyYXkob3RoZXIpLAogICAgICAgIG9ialRhZyA9IG9iaklzQXJyID8gYXJyYXlUYWcgOiBnZXRUYWcob2JqZWN0KSwKICAgICAgICBvdGhUYWcgPSBvdGhJc0FyciA/IGFycmF5VGFnIDogZ2V0VGFnKG90aGVyKTsKCiAgICBvYmpUYWcgPSBvYmpUYWcgPT0gYXJnc1RhZyA/IG9iamVjdFRhZyA6IG9ialRhZzsKICAgIG90aFRhZyA9IG90aFRhZyA9PSBhcmdzVGFnID8gb2JqZWN0VGFnIDogb3RoVGFnOwoKICAgIHZhciBvYmpJc09iaiA9IG9ialRhZyA9PSBvYmplY3RUYWcsCiAgICAgICAgb3RoSXNPYmogPSBvdGhUYWcgPT0gb2JqZWN0VGFnLAogICAgICAgIGlzU2FtZVRhZyA9IG9ialRhZyA9PSBvdGhUYWc7CgogICAgaWYgKGlzU2FtZVRhZyAmJiBpc0J1ZmZlcihvYmplY3QpKSB7CiAgICAgIGlmICghaXNCdWZmZXIob3RoZXIpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIG9iaklzQXJyID0gdHJ1ZTsKICAgICAgb2JqSXNPYmogPSBmYWxzZTsKICAgIH0KICAgIGlmIChpc1NhbWVUYWcgJiYgIW9iaklzT2JqKSB7CiAgICAgIHN0YWNrIHx8IChzdGFjayA9IG5ldyBTdGFjayk7CiAgICAgIHJldHVybiAob2JqSXNBcnIgfHwgaXNUeXBlZEFycmF5KG9iamVjdCkpCiAgICAgICAgPyBlcXVhbEFycmF5cyhvYmplY3QsIG90aGVyLCBiaXRtYXNrLCBjdXN0b21pemVyLCBlcXVhbEZ1bmMsIHN0YWNrKQogICAgICAgIDogZXF1YWxCeVRhZyhvYmplY3QsIG90aGVyLCBvYmpUYWcsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGVxdWFsRnVuYywgc3RhY2spOwogICAgfQogICAgaWYgKCEoYml0bWFzayAmIENPTVBBUkVfUEFSVElBTF9GTEFHKSkgewogICAgICB2YXIgb2JqSXNXcmFwcGVkID0gb2JqSXNPYmogJiYgaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsICdfX3dyYXBwZWRfXycpLAogICAgICAgICAgb3RoSXNXcmFwcGVkID0gb3RoSXNPYmogJiYgaGFzT3duUHJvcGVydHkuY2FsbChvdGhlciwgJ19fd3JhcHBlZF9fJyk7CgogICAgICBpZiAob2JqSXNXcmFwcGVkIHx8IG90aElzV3JhcHBlZCkgewogICAgICAgIHZhciBvYmpVbndyYXBwZWQgPSBvYmpJc1dyYXBwZWQgPyBvYmplY3QudmFsdWUoKSA6IG9iamVjdCwKICAgICAgICAgICAgb3RoVW53cmFwcGVkID0gb3RoSXNXcmFwcGVkID8gb3RoZXIudmFsdWUoKSA6IG90aGVyOwoKICAgICAgICBzdGFjayB8fCAoc3RhY2sgPSBuZXcgU3RhY2spOwogICAgICAgIHJldHVybiBlcXVhbEZ1bmMob2JqVW53cmFwcGVkLCBvdGhVbndyYXBwZWQsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIHN0YWNrKTsKICAgICAgfQogICAgfQogICAgaWYgKCFpc1NhbWVUYWcpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgc3RhY2sgfHwgKHN0YWNrID0gbmV3IFN0YWNrKTsKICAgIHJldHVybiBlcXVhbE9iamVjdHMob2JqZWN0LCBvdGhlciwgYml0bWFzaywgY3VzdG9taXplciwgZXF1YWxGdW5jLCBzdGFjayk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5pc01hcGAgd2l0aG91dCBOb2RlLmpzIG9wdGltaXphdGlvbnMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgbWFwLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gYmFzZUlzTWFwKHZhbHVlKSB7CiAgICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBnZXRUYWcodmFsdWUpID09IG1hcFRhZzsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmlzTWF0Y2hgIHdpdGhvdXQgc3VwcG9ydCBmb3IgaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgb2JqZWN0IG9mIHByb3BlcnR5IHZhbHVlcyB0byBtYXRjaC4KICAgKiBAcGFyYW0ge0FycmF5fSBtYXRjaERhdGEgVGhlIHByb3BlcnR5IG5hbWVzLCB2YWx1ZXMsIGFuZCBjb21wYXJlIGZsYWdzIHRvIG1hdGNoLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjdXN0b21pemVyXSBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNvbXBhcmlzb25zLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgb2JqZWN0YCBpcyBhIG1hdGNoLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gYmFzZUlzTWF0Y2gob2JqZWN0LCBzb3VyY2UsIG1hdGNoRGF0YSwgY3VzdG9taXplcikgewogICAgdmFyIGluZGV4ID0gbWF0Y2hEYXRhLmxlbmd0aCwKICAgICAgICBsZW5ndGggPSBpbmRleCwKICAgICAgICBub0N1c3RvbWl6ZXIgPSAhY3VzdG9taXplcjsKCiAgICBpZiAob2JqZWN0ID09IG51bGwpIHsKICAgICAgcmV0dXJuICFsZW5ndGg7CiAgICB9CiAgICBvYmplY3QgPSBPYmplY3Qob2JqZWN0KTsKICAgIHdoaWxlIChpbmRleC0tKSB7CiAgICAgIHZhciBkYXRhID0gbWF0Y2hEYXRhW2luZGV4XTsKICAgICAgaWYgKChub0N1c3RvbWl6ZXIgJiYgZGF0YVsyXSkKICAgICAgICAgICAgPyBkYXRhWzFdICE9PSBvYmplY3RbZGF0YVswXV0KICAgICAgICAgICAgOiAhKGRhdGFbMF0gaW4gb2JqZWN0KQogICAgICAgICAgKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICBkYXRhID0gbWF0Y2hEYXRhW2luZGV4XTsKICAgICAgdmFyIGtleSA9IGRhdGFbMF0sCiAgICAgICAgICBvYmpWYWx1ZSA9IG9iamVjdFtrZXldLAogICAgICAgICAgc3JjVmFsdWUgPSBkYXRhWzFdOwoKICAgICAgaWYgKG5vQ3VzdG9taXplciAmJiBkYXRhWzJdKSB7CiAgICAgICAgaWYgKG9ialZhbHVlID09PSB1bmRlZmluZWQgJiYgIShrZXkgaW4gb2JqZWN0KSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgc3RhY2sgPSBuZXcgU3RhY2s7CiAgICAgICAgaWYgKGN1c3RvbWl6ZXIpIHsKICAgICAgICAgIHZhciByZXN1bHQgPSBjdXN0b21pemVyKG9ialZhbHVlLCBzcmNWYWx1ZSwga2V5LCBvYmplY3QsIHNvdXJjZSwgc3RhY2spOwogICAgICAgIH0KICAgICAgICBpZiAoIShyZXN1bHQgPT09IHVuZGVmaW5lZAogICAgICAgICAgICAgID8gYmFzZUlzRXF1YWwoc3JjVmFsdWUsIG9ialZhbHVlLCBDT01QQVJFX1BBUlRJQUxfRkxBRyB8IENPTVBBUkVfVU5PUkRFUkVEX0ZMQUcsIGN1c3RvbWl6ZXIsIHN0YWNrKQogICAgICAgICAgICAgIDogcmVzdWx0CiAgICAgICAgICAgICkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uaXNOYXRpdmVgIHdpdGhvdXQgYmFkIHNoaW0gY2hlY2tzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIG5hdGl2ZSBmdW5jdGlvbiwKICAgKiAgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VJc05hdGl2ZSh2YWx1ZSkgewogICAgaWYgKCFpc09iamVjdCh2YWx1ZSkgfHwgaXNNYXNrZWQodmFsdWUpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHZhciBwYXR0ZXJuID0gaXNGdW5jdGlvbih2YWx1ZSkgPyByZUlzTmF0aXZlIDogcmVJc0hvc3RDdG9yOwogICAgcmV0dXJuIHBhdHRlcm4udGVzdCh0b1NvdXJjZSh2YWx1ZSkpOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uaXNSZWdFeHBgIHdpdGhvdXQgTm9kZS5qcyBvcHRpbWl6YXRpb25zLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHJlZ2V4cCwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VJc1JlZ0V4cCh2YWx1ZSkgewogICAgcmV0dXJuIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgYmFzZUdldFRhZyh2YWx1ZSkgPT0gcmVnZXhwVGFnOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uaXNTZXRgIHdpdGhvdXQgTm9kZS5qcyBvcHRpbWl6YXRpb25zLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHNldCwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VJc1NldCh2YWx1ZSkgewogICAgcmV0dXJuIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgZ2V0VGFnKHZhbHVlKSA9PSBzZXRUYWc7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5pc1R5cGVkQXJyYXlgIHdpdGhvdXQgTm9kZS5qcyBvcHRpbWl6YXRpb25zLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHR5cGVkIGFycmF5LCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gYmFzZUlzVHlwZWRBcnJheSh2YWx1ZSkgewogICAgcmV0dXJuIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYKICAgICAgaXNMZW5ndGgodmFsdWUubGVuZ3RoKSAmJiAhIXR5cGVkQXJyYXlUYWdzW2Jhc2VHZXRUYWcodmFsdWUpXTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLml0ZXJhdGVlYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSBbdmFsdWU9Xy5pZGVudGl0eV0gVGhlIHZhbHVlIHRvIGNvbnZlcnQgdG8gYW4gaXRlcmF0ZWUuCiAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBpdGVyYXRlZS4KICAgKi8KICBmdW5jdGlvbiBiYXNlSXRlcmF0ZWUodmFsdWUpIHsKICAgIC8vIERvbid0IHN0b3JlIHRoZSBgdHlwZW9mYCByZXN1bHQgaW4gYSB2YXJpYWJsZSB0byBhdm9pZCBhIEpJVCBidWcgaW4gU2FmYXJpIDkuCiAgICAvLyBTZWUgaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTE1NjAzNCBmb3IgbW9yZSBkZXRhaWxzLgogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnZnVuY3Rpb24nKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgIHJldHVybiBpZGVudGl0eTsKICAgIH0KICAgIGlmICh0eXBlb2YgdmFsdWUgPT0gJ29iamVjdCcpIHsKICAgICAgcmV0dXJuIGlzQXJyYXkodmFsdWUpCiAgICAgICAgPyBiYXNlTWF0Y2hlc1Byb3BlcnR5KHZhbHVlWzBdLCB2YWx1ZVsxXSkKICAgICAgICA6IGJhc2VNYXRjaGVzKHZhbHVlKTsKICAgIH0KICAgIHJldHVybiBwcm9wZXJ0eSh2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5rZXlzYCB3aGljaCBkb2Vzbid0IHRyZWF0IHNwYXJzZSBhcnJheXMgYXMgZGVuc2UuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzLgogICAqLwogIGZ1bmN0aW9uIGJhc2VLZXlzKG9iamVjdCkgewogICAgaWYgKCFpc1Byb3RvdHlwZShvYmplY3QpKSB7CiAgICAgIHJldHVybiBuYXRpdmVLZXlzKG9iamVjdCk7CiAgICB9CiAgICB2YXIgcmVzdWx0ID0gW107CiAgICBmb3IgKHZhciBrZXkgaW4gT2JqZWN0KG9iamVjdCkpIHsKICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBrZXkpICYmIGtleSAhPSAnY29uc3RydWN0b3InKSB7CiAgICAgICAgcmVzdWx0LnB1c2goa2V5KTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmtleXNJbmAgd2hpY2ggZG9lc24ndCB0cmVhdCBzcGFyc2UgYXJyYXlzIGFzIGRlbnNlLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcy4KICAgKi8KICBmdW5jdGlvbiBiYXNlS2V5c0luKG9iamVjdCkgewogICAgaWYgKCFpc09iamVjdChvYmplY3QpKSB7CiAgICAgIHJldHVybiBuYXRpdmVLZXlzSW4ob2JqZWN0KTsKICAgIH0KICAgIHZhciBpc1Byb3RvID0gaXNQcm90b3R5cGUob2JqZWN0KSwKICAgICAgICByZXN1bHQgPSBbXTsKCiAgICBmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSB7CiAgICAgIGlmICghKGtleSA9PSAnY29uc3RydWN0b3InICYmIChpc1Byb3RvIHx8ICFoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwga2V5KSkpKSB7CiAgICAgICAgcmVzdWx0LnB1c2goa2V5KTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmx0YCB3aGljaCBkb2Vzbid0IGNvZXJjZSBhcmd1bWVudHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbXBhcmUuCiAgICogQHBhcmFtIHsqfSBvdGhlciBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBsZXNzIHRoYW4gYG90aGVyYCwKICAgKiAgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VMdCh2YWx1ZSwgb3RoZXIpIHsKICAgIHJldHVybiB2YWx1ZSA8IG90aGVyOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8ubWF0Y2hlc2Agd2hpY2ggZG9lc24ndCBjbG9uZSBgc291cmNlYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgb2JqZWN0IG9mIHByb3BlcnR5IHZhbHVlcyB0byBtYXRjaC4KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBzcGVjIGZ1bmN0aW9uLgogICAqLwogIGZ1bmN0aW9uIGJhc2VNYXRjaGVzKHNvdXJjZSkgewogICAgdmFyIG1hdGNoRGF0YSA9IGdldE1hdGNoRGF0YShzb3VyY2UpOwogICAgaWYgKG1hdGNoRGF0YS5sZW5ndGggPT0gMSAmJiBtYXRjaERhdGFbMF1bMl0pIHsKICAgICAgcmV0dXJuIG1hdGNoZXNTdHJpY3RDb21wYXJhYmxlKG1hdGNoRGF0YVswXVswXSwgbWF0Y2hEYXRhWzBdWzFdKTsKICAgIH0KICAgIHJldHVybiBmdW5jdGlvbihvYmplY3QpIHsKICAgICAgcmV0dXJuIG9iamVjdCA9PT0gc291cmNlIHx8IGJhc2VJc01hdGNoKG9iamVjdCwgc291cmNlLCBtYXRjaERhdGEpOwogICAgfTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLm1hdGNoZXNQcm9wZXJ0eWAgd2hpY2ggZG9lc24ndCBjbG9uZSBgc3JjVmFsdWVgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge3N0cmluZ30gcGF0aCBUaGUgcGF0aCBvZiB0aGUgcHJvcGVydHkgdG8gZ2V0LgogICAqIEBwYXJhbSB7Kn0gc3JjVmFsdWUgVGhlIHZhbHVlIHRvIG1hdGNoLgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IHNwZWMgZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gYmFzZU1hdGNoZXNQcm9wZXJ0eShwYXRoLCBzcmNWYWx1ZSkgewogICAgaWYgKGlzS2V5KHBhdGgpICYmIGlzU3RyaWN0Q29tcGFyYWJsZShzcmNWYWx1ZSkpIHsKICAgICAgcmV0dXJuIG1hdGNoZXNTdHJpY3RDb21wYXJhYmxlKHRvS2V5KHBhdGgpLCBzcmNWYWx1ZSk7CiAgICB9CiAgICByZXR1cm4gZnVuY3Rpb24ob2JqZWN0KSB7CiAgICAgIHZhciBvYmpWYWx1ZSA9IGdldChvYmplY3QsIHBhdGgpOwogICAgICByZXR1cm4gKG9ialZhbHVlID09PSB1bmRlZmluZWQgJiYgb2JqVmFsdWUgPT09IHNyY1ZhbHVlKQogICAgICAgID8gaGFzSW4ob2JqZWN0LCBwYXRoKQogICAgICAgIDogYmFzZUlzRXF1YWwoc3JjVmFsdWUsIG9ialZhbHVlLCBDT01QQVJFX1BBUlRJQUxfRkxBRyB8IENPTVBBUkVfVU5PUkRFUkVEX0ZMQUcpOwogICAgfTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLm50aGAgd2hpY2ggZG9lc24ndCBjb2VyY2UgYXJndW1lbnRzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcXVlcnkuCiAgICogQHBhcmFtIHtudW1iZXJ9IG4gVGhlIGluZGV4IG9mIHRoZSBlbGVtZW50IHRvIHJldHVybi4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgbnRoIGVsZW1lbnQgb2YgYGFycmF5YC4KICAgKi8KICBmdW5jdGlvbiBiYXNlTnRoKGFycmF5LCBuKSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgaWYgKCFsZW5ndGgpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgbiArPSBuIDwgMCA/IGxlbmd0aCA6IDA7CiAgICByZXR1cm4gaXNJbmRleChuLCBsZW5ndGgpID8gYXJyYXlbbl0gOiB1bmRlZmluZWQ7CiAgfQoKICAvKioKICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYGJhc2VQcm9wZXJ0eWAgd2hpY2ggc3VwcG9ydHMgZGVlcCBwYXRocy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggb2YgdGhlIHByb3BlcnR5IHRvIGdldC4KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBhY2Nlc3NvciBmdW5jdGlvbi4KICAgKi8KICBmdW5jdGlvbiBiYXNlUHJvcGVydHlEZWVwKHBhdGgpIHsKICAgIHJldHVybiBmdW5jdGlvbihvYmplY3QpIHsKICAgICAgcmV0dXJuIGJhc2VHZXQob2JqZWN0LCBwYXRoKTsKICAgIH07CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5wdWxsQWxsQnlgIHdpdGhvdXQgc3VwcG9ydCBmb3IgaXRlcmF0ZWUKICAgKiBzaG9ydGhhbmRzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gbW9kaWZ5LgogICAqIEBwYXJhbSB7QXJyYXl9IHZhbHVlcyBUaGUgdmFsdWVzIHRvIHJlbW92ZS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWVdIFRoZSBpdGVyYXRlZSBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjb21wYXJhdG9yXSBUaGUgY29tcGFyYXRvciBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBgYXJyYXlgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VQdWxsQWxsKGFycmF5LCB2YWx1ZXMsIGl0ZXJhdGVlLCBjb21wYXJhdG9yKSB7CiAgICB2YXIgaW5kZXhPZiA9IGNvbXBhcmF0b3IgPyBiYXNlSW5kZXhPZldpdGggOiBiYXNlSW5kZXhPZiwKICAgICAgICBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IHZhbHVlcy5sZW5ndGgsCiAgICAgICAgc2VlbiA9IGFycmF5OwoKICAgIGlmIChhcnJheSA9PT0gdmFsdWVzKSB7CiAgICAgIHZhbHVlcyA9IGNvcHlBcnJheSh2YWx1ZXMpOwogICAgfQogICAgaWYgKGl0ZXJhdGVlKSB7CiAgICAgIHNlZW4gPSBhcnJheU1hcChhcnJheSwgYmFzZVVuYXJ5KGl0ZXJhdGVlKSk7CiAgICB9CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICB2YXIgZnJvbUluZGV4ID0gMCwKICAgICAgICAgIHZhbHVlID0gdmFsdWVzW2luZGV4XSwKICAgICAgICAgIGNvbXB1dGVkID0gaXRlcmF0ZWUgPyBpdGVyYXRlZSh2YWx1ZSkgOiB2YWx1ZTsKCiAgICAgIHdoaWxlICgoZnJvbUluZGV4ID0gaW5kZXhPZihzZWVuLCBjb21wdXRlZCwgZnJvbUluZGV4LCBjb21wYXJhdG9yKSkgPiAtMSkgewogICAgICAgIGlmIChzZWVuICE9PSBhcnJheSkgewogICAgICAgICAgc3BsaWNlLmNhbGwoc2VlbiwgZnJvbUluZGV4LCAxKTsKICAgICAgICB9CiAgICAgICAgc3BsaWNlLmNhbGwoYXJyYXksIGZyb21JbmRleCwgMSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBhcnJheTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnB1bGxBdGAgd2l0aG91dCBzdXBwb3J0IGZvciBpbmRpdmlkdWFsCiAgICogaW5kZXhlcyBvciBjYXB0dXJpbmcgdGhlIHJlbW92ZWQgZWxlbWVudHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBtb2RpZnkuCiAgICogQHBhcmFtIHtudW1iZXJbXX0gaW5kZXhlcyBUaGUgaW5kZXhlcyBvZiBlbGVtZW50cyB0byByZW1vdmUuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGBhcnJheWAuCiAgICovCiAgZnVuY3Rpb24gYmFzZVB1bGxBdChhcnJheSwgaW5kZXhlcykgewogICAgdmFyIGxlbmd0aCA9IGFycmF5ID8gaW5kZXhlcy5sZW5ndGggOiAwLAogICAgICAgIGxhc3RJbmRleCA9IGxlbmd0aCAtIDE7CgogICAgd2hpbGUgKGxlbmd0aC0tKSB7CiAgICAgIHZhciBpbmRleCA9IGluZGV4ZXNbbGVuZ3RoXTsKICAgICAgaWYgKGxlbmd0aCA9PSBsYXN0SW5kZXggfHwgaW5kZXggIT09IHByZXZpb3VzKSB7CiAgICAgICAgdmFyIHByZXZpb3VzID0gaW5kZXg7CiAgICAgICAgaWYgKGlzSW5kZXgoaW5kZXgpKSB7CiAgICAgICAgICBzcGxpY2UuY2FsbChhcnJheSwgaW5kZXgsIDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBiYXNlVW5zZXQoYXJyYXksIGluZGV4KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBhcnJheTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnJlc3RgIHdoaWNoIGRvZXNuJ3QgdmFsaWRhdGUgb3IgY29lcmNlIGFyZ3VtZW50cy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gYXBwbHkgYSByZXN0IHBhcmFtZXRlciB0by4KICAgKiBAcGFyYW0ge251bWJlcn0gW3N0YXJ0PWZ1bmMubGVuZ3RoLTFdIFRoZSBzdGFydCBwb3NpdGlvbiBvZiB0aGUgcmVzdCBwYXJhbWV0ZXIuCiAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gYmFzZVJlc3QoZnVuYywgc3RhcnQpIHsKICAgIHJldHVybiBzZXRUb1N0cmluZyhvdmVyUmVzdChmdW5jLCBzdGFydCwgaWRlbnRpdHkpLCBmdW5jICsgJycpOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uc2V0YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIG1vZGlmeS4KICAgKiBAcGFyYW0ge0FycmF5fHN0cmluZ30gcGF0aCBUaGUgcGF0aCBvZiB0aGUgcHJvcGVydHkgdG8gc2V0LgogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNldC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY3VzdG9taXplcl0gVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBwYXRoIGNyZWF0aW9uLgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuCiAgICovCiAgZnVuY3Rpb24gYmFzZVNldChvYmplY3QsIHBhdGgsIHZhbHVlLCBjdXN0b21pemVyKSB7CiAgICBpZiAoIWlzT2JqZWN0KG9iamVjdCkpIHsKICAgICAgcmV0dXJuIG9iamVjdDsKICAgIH0KICAgIHBhdGggPSBjYXN0UGF0aChwYXRoLCBvYmplY3QpOwoKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IHBhdGgubGVuZ3RoLAogICAgICAgIGxhc3RJbmRleCA9IGxlbmd0aCAtIDEsCiAgICAgICAgbmVzdGVkID0gb2JqZWN0OwoKICAgIHdoaWxlIChuZXN0ZWQgIT0gbnVsbCAmJiArK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHZhciBrZXkgPSB0b0tleShwYXRoW2luZGV4XSksCiAgICAgICAgICBuZXdWYWx1ZSA9IHZhbHVlOwoKICAgICAgaWYgKGluZGV4ICE9IGxhc3RJbmRleCkgewogICAgICAgIHZhciBvYmpWYWx1ZSA9IG5lc3RlZFtrZXldOwogICAgICAgIG5ld1ZhbHVlID0gY3VzdG9taXplciA/IGN1c3RvbWl6ZXIob2JqVmFsdWUsIGtleSwgbmVzdGVkKSA6IHVuZGVmaW5lZDsKICAgICAgICBpZiAobmV3VmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgbmV3VmFsdWUgPSBpc09iamVjdChvYmpWYWx1ZSkKICAgICAgICAgICAgPyBvYmpWYWx1ZQogICAgICAgICAgICA6IChpc0luZGV4KHBhdGhbaW5kZXggKyAxXSkgPyBbXSA6IHt9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgYXNzaWduVmFsdWUobmVzdGVkLCBrZXksIG5ld1ZhbHVlKTsKICAgICAgbmVzdGVkID0gbmVzdGVkW2tleV07CiAgICB9CiAgICByZXR1cm4gb2JqZWN0OwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYHNldFRvU3RyaW5nYCB3aXRob3V0IHN1cHBvcnQgZm9yIGhvdCBsb29wIHNob3J0aW5nLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBtb2RpZnkuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gc3RyaW5nIFRoZSBgdG9TdHJpbmdgIHJlc3VsdC4KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgYGZ1bmNgLgogICAqLwogIHZhciBiYXNlU2V0VG9TdHJpbmcgPSAhZGVmaW5lUHJvcGVydHkgPyBpZGVudGl0eSA6IGZ1bmN0aW9uKGZ1bmMsIHN0cmluZykgewogICAgcmV0dXJuIGRlZmluZVByb3BlcnR5KGZ1bmMsICd0b1N0cmluZycsIHsKICAgICAgJ2NvbmZpZ3VyYWJsZSc6IHRydWUsCiAgICAgICdlbnVtZXJhYmxlJzogZmFsc2UsCiAgICAgICd2YWx1ZSc6IGNvbnN0YW50KHN0cmluZyksCiAgICAgICd3cml0YWJsZSc6IHRydWUKICAgIH0pOwogIH07CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnNsaWNlYCB3aXRob3V0IGFuIGl0ZXJhdGVlIGNhbGwgZ3VhcmQuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBzbGljZS4KICAgKiBAcGFyYW0ge251bWJlcn0gW3N0YXJ0PTBdIFRoZSBzdGFydCBwb3NpdGlvbi4KICAgKiBAcGFyYW0ge251bWJlcn0gW2VuZD1hcnJheS5sZW5ndGhdIFRoZSBlbmQgcG9zaXRpb24uCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VTbGljZShhcnJheSwgc3RhcnQsIGVuZCkgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwoKICAgIGlmIChzdGFydCA8IDApIHsKICAgICAgc3RhcnQgPSAtc3RhcnQgPiBsZW5ndGggPyAwIDogKGxlbmd0aCArIHN0YXJ0KTsKICAgIH0KICAgIGVuZCA9IGVuZCA+IGxlbmd0aCA/IGxlbmd0aCA6IGVuZDsKICAgIGlmIChlbmQgPCAwKSB7CiAgICAgIGVuZCArPSBsZW5ndGg7CiAgICB9CiAgICBsZW5ndGggPSBzdGFydCA+IGVuZCA/IDAgOiAoKGVuZCAtIHN0YXJ0KSA+Pj4gMCk7CiAgICBzdGFydCA+Pj49IDA7CgogICAgdmFyIHJlc3VsdCA9IEFycmF5KGxlbmd0aCk7CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICByZXN1bHRbaW5kZXhdID0gYXJyYXlbaW5kZXggKyBzdGFydF07CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uc29ydGVkSW5kZXhgIGFuZCBgXy5zb3J0ZWRMYXN0SW5kZXhgIHdoaWNoCiAgICogcGVyZm9ybXMgYSBiaW5hcnkgc2VhcmNoIG9mIGBhcnJheWAgdG8gZGV0ZXJtaW5lIHRoZSBpbmRleCBhdCB3aGljaCBgdmFsdWVgCiAgICogc2hvdWxkIGJlIGluc2VydGVkIGludG8gYGFycmF5YCBpbiBvcmRlciB0byBtYWludGFpbiBpdHMgc29ydCBvcmRlci4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIHNvcnRlZCBhcnJheSB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGV2YWx1YXRlLgogICAqIEBwYXJhbSB7Ym9vbGVhbn0gW3JldEhpZ2hlc3RdIFNwZWNpZnkgcmV0dXJuaW5nIHRoZSBoaWdoZXN0IHF1YWxpZmllZCBpbmRleC4KICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBhdCB3aGljaCBgdmFsdWVgIHNob3VsZCBiZSBpbnNlcnRlZAogICAqICBpbnRvIGBhcnJheWAuCiAgICovCiAgZnVuY3Rpb24gYmFzZVNvcnRlZEluZGV4KGFycmF5LCB2YWx1ZSwgcmV0SGlnaGVzdCkgewogICAgdmFyIGxvdyA9IDAsCiAgICAgICAgaGlnaCA9IGFycmF5ID09IG51bGwgPyBsb3cgOiBhcnJheS5sZW5ndGg7CgogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyAmJiB2YWx1ZSA9PT0gdmFsdWUgJiYgaGlnaCA8PSBIQUxGX01BWF9BUlJBWV9MRU5HVEgpIHsKICAgICAgd2hpbGUgKGxvdyA8IGhpZ2gpIHsKICAgICAgICB2YXIgbWlkID0gKGxvdyArIGhpZ2gpID4+PiAxLAogICAgICAgICAgICBjb21wdXRlZCA9IGFycmF5W21pZF07CgogICAgICAgIGlmIChjb21wdXRlZCAhPT0gbnVsbCAmJiAhaXNTeW1ib2woY29tcHV0ZWQpICYmCiAgICAgICAgICAgIChyZXRIaWdoZXN0ID8gKGNvbXB1dGVkIDw9IHZhbHVlKSA6IChjb21wdXRlZCA8IHZhbHVlKSkpIHsKICAgICAgICAgIGxvdyA9IG1pZCArIDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGhpZ2ggPSBtaWQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBoaWdoOwogICAgfQogICAgcmV0dXJuIGJhc2VTb3J0ZWRJbmRleEJ5KGFycmF5LCB2YWx1ZSwgaWRlbnRpdHksIHJldEhpZ2hlc3QpOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uc29ydGVkSW5kZXhCeWAgYW5kIGBfLnNvcnRlZExhc3RJbmRleEJ5YAogICAqIHdoaWNoIGludm9rZXMgYGl0ZXJhdGVlYCBmb3IgYHZhbHVlYCBhbmQgZWFjaCBlbGVtZW50IG9mIGBhcnJheWAgdG8gY29tcHV0ZQogICAqIHRoZWlyIHNvcnQgcmFua2luZy4gVGhlIGl0ZXJhdGVlIGlzIGludm9rZWQgd2l0aCBvbmUgYXJndW1lbnQ7ICh2YWx1ZSkuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBzb3J0ZWQgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBldmFsdWF0ZS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtyZXRIaWdoZXN0XSBTcGVjaWZ5IHJldHVybmluZyB0aGUgaGlnaGVzdCBxdWFsaWZpZWQgaW5kZXguCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggYXQgd2hpY2ggYHZhbHVlYCBzaG91bGQgYmUgaW5zZXJ0ZWQKICAgKiAgaW50byBgYXJyYXlgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VTb3J0ZWRJbmRleEJ5KGFycmF5LCB2YWx1ZSwgaXRlcmF0ZWUsIHJldEhpZ2hlc3QpIHsKICAgIHZhbHVlID0gaXRlcmF0ZWUodmFsdWUpOwoKICAgIHZhciBsb3cgPSAwLAogICAgICAgIGhpZ2ggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aCwKICAgICAgICB2YWxJc05hTiA9IHZhbHVlICE9PSB2YWx1ZSwKICAgICAgICB2YWxJc051bGwgPSB2YWx1ZSA9PT0gbnVsbCwKICAgICAgICB2YWxJc1N5bWJvbCA9IGlzU3ltYm9sKHZhbHVlKSwKICAgICAgICB2YWxJc1VuZGVmaW5lZCA9IHZhbHVlID09PSB1bmRlZmluZWQ7CgogICAgd2hpbGUgKGxvdyA8IGhpZ2gpIHsKICAgICAgdmFyIG1pZCA9IG5hdGl2ZUZsb29yKChsb3cgKyBoaWdoKSAvIDIpLAogICAgICAgICAgY29tcHV0ZWQgPSBpdGVyYXRlZShhcnJheVttaWRdKSwKICAgICAgICAgIG90aElzRGVmaW5lZCA9IGNvbXB1dGVkICE9PSB1bmRlZmluZWQsCiAgICAgICAgICBvdGhJc051bGwgPSBjb21wdXRlZCA9PT0gbnVsbCwKICAgICAgICAgIG90aElzUmVmbGV4aXZlID0gY29tcHV0ZWQgPT09IGNvbXB1dGVkLAogICAgICAgICAgb3RoSXNTeW1ib2wgPSBpc1N5bWJvbChjb21wdXRlZCk7CgogICAgICBpZiAodmFsSXNOYU4pIHsKICAgICAgICB2YXIgc2V0TG93ID0gcmV0SGlnaGVzdCB8fCBvdGhJc1JlZmxleGl2ZTsKICAgICAgfSBlbHNlIGlmICh2YWxJc1VuZGVmaW5lZCkgewogICAgICAgIHNldExvdyA9IG90aElzUmVmbGV4aXZlICYmIChyZXRIaWdoZXN0IHx8IG90aElzRGVmaW5lZCk7CiAgICAgIH0gZWxzZSBpZiAodmFsSXNOdWxsKSB7CiAgICAgICAgc2V0TG93ID0gb3RoSXNSZWZsZXhpdmUgJiYgb3RoSXNEZWZpbmVkICYmIChyZXRIaWdoZXN0IHx8ICFvdGhJc051bGwpOwogICAgICB9IGVsc2UgaWYgKHZhbElzU3ltYm9sKSB7CiAgICAgICAgc2V0TG93ID0gb3RoSXNSZWZsZXhpdmUgJiYgb3RoSXNEZWZpbmVkICYmICFvdGhJc051bGwgJiYgKHJldEhpZ2hlc3QgfHwgIW90aElzU3ltYm9sKTsKICAgICAgfSBlbHNlIGlmIChvdGhJc051bGwgfHwgb3RoSXNTeW1ib2wpIHsKICAgICAgICBzZXRMb3cgPSBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZXRMb3cgPSByZXRIaWdoZXN0ID8gKGNvbXB1dGVkIDw9IHZhbHVlKSA6IChjb21wdXRlZCA8IHZhbHVlKTsKICAgICAgfQogICAgICBpZiAoc2V0TG93KSB7CiAgICAgICAgbG93ID0gbWlkICsgMTsKICAgICAgfSBlbHNlIHsKICAgICAgICBoaWdoID0gbWlkOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbmF0aXZlTWluKGhpZ2gsIE1BWF9BUlJBWV9JTkRFWCk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5zb3J0ZWRVbmlxYCBhbmQgYF8uc29ydGVkVW5pcUJ5YCB3aXRob3V0CiAgICogc3VwcG9ydCBmb3IgaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlXSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBkdXBsaWNhdGUgZnJlZSBhcnJheS4KICAgKi8KICBmdW5jdGlvbiBiYXNlU29ydGVkVW5pcShhcnJheSwgaXRlcmF0ZWUpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IGFycmF5Lmxlbmd0aCwKICAgICAgICByZXNJbmRleCA9IDAsCiAgICAgICAgcmVzdWx0ID0gW107CgogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgdmFyIHZhbHVlID0gYXJyYXlbaW5kZXhdLAogICAgICAgICAgY29tcHV0ZWQgPSBpdGVyYXRlZSA/IGl0ZXJhdGVlKHZhbHVlKSA6IHZhbHVlOwoKICAgICAgaWYgKCFpbmRleCB8fCAhZXEoY29tcHV0ZWQsIHNlZW4pKSB7CiAgICAgICAgdmFyIHNlZW4gPSBjb21wdXRlZDsKICAgICAgICByZXN1bHRbcmVzSW5kZXgrK10gPSB2YWx1ZSA9PT0gMCA/IDAgOiB2YWx1ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnRvU3RyaW5nYCB3aGljaCBkb2Vzbid0IGNvbnZlcnQgbnVsbGlzaAogICAqIHZhbHVlcyB0byBlbXB0eSBzdHJpbmdzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBwcm9jZXNzLgogICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIHN0cmluZy4KICAgKi8KICBmdW5jdGlvbiBiYXNlVG9TdHJpbmcodmFsdWUpIHsKICAgIC8vIEV4aXQgZWFybHkgZm9yIHN0cmluZ3MgdG8gYXZvaWQgYSBwZXJmb3JtYW5jZSBoaXQgaW4gc29tZSBlbnZpcm9ubWVudHMuCiAgICBpZiAodHlwZW9mIHZhbHVlID09ICdzdHJpbmcnKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIGlmIChpc0FycmF5KHZhbHVlKSkgewogICAgICAvLyBSZWN1cnNpdmVseSBjb252ZXJ0IHZhbHVlcyAoc3VzY2VwdGlibGUgdG8gY2FsbCBzdGFjayBsaW1pdHMpLgogICAgICByZXR1cm4gYXJyYXlNYXAodmFsdWUsIGJhc2VUb1N0cmluZykgKyAnJzsKICAgIH0KICAgIGlmIChpc1N5bWJvbCh2YWx1ZSkpIHsKICAgICAgcmV0dXJuIHN5bWJvbFRvU3RyaW5nID8gc3ltYm9sVG9TdHJpbmcuY2FsbCh2YWx1ZSkgOiAnJzsKICAgIH0KICAgIHZhciByZXN1bHQgPSAodmFsdWUgKyAnJyk7CiAgICByZXR1cm4gKHJlc3VsdCA9PSAnMCcgJiYgKDEgLyB2YWx1ZSkgPT0gLUlORklOSVRZKSA/ICctMCcgOiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy51bmlxQnlgIHdpdGhvdXQgc3VwcG9ydCBmb3IgaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlXSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY29tcGFyYXRvcl0gVGhlIGNvbXBhcmF0b3IgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBkdXBsaWNhdGUgZnJlZSBhcnJheS4KICAgKi8KICBmdW5jdGlvbiBiYXNlVW5pcShhcnJheSwgaXRlcmF0ZWUsIGNvbXBhcmF0b3IpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGluY2x1ZGVzID0gYXJyYXlJbmNsdWRlcywKICAgICAgICBsZW5ndGggPSBhcnJheS5sZW5ndGgsCiAgICAgICAgaXNDb21tb24gPSB0cnVlLAogICAgICAgIHJlc3VsdCA9IFtdLAogICAgICAgIHNlZW4gPSByZXN1bHQ7CgogICAgaWYgKGNvbXBhcmF0b3IpIHsKICAgICAgaXNDb21tb24gPSBmYWxzZTsKICAgICAgaW5jbHVkZXMgPSBhcnJheUluY2x1ZGVzV2l0aDsKICAgIH0KICAgIGVsc2UgaWYgKGxlbmd0aCA+PSBMQVJHRV9BUlJBWV9TSVpFKSB7CiAgICAgIHZhciBzZXQgPSBpdGVyYXRlZSA/IG51bGwgOiBjcmVhdGVTZXQoYXJyYXkpOwogICAgICBpZiAoc2V0KSB7CiAgICAgICAgcmV0dXJuIHNldFRvQXJyYXkoc2V0KTsKICAgICAgfQogICAgICBpc0NvbW1vbiA9IGZhbHNlOwogICAgICBpbmNsdWRlcyA9IGNhY2hlSGFzOwogICAgICBzZWVuID0gbmV3IFNldENhY2hlOwogICAgfQogICAgZWxzZSB7CiAgICAgIHNlZW4gPSBpdGVyYXRlZSA/IFtdIDogcmVzdWx0OwogICAgfQogICAgb3V0ZXI6CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICB2YXIgdmFsdWUgPSBhcnJheVtpbmRleF0sCiAgICAgICAgICBjb21wdXRlZCA9IGl0ZXJhdGVlID8gaXRlcmF0ZWUodmFsdWUpIDogdmFsdWU7CgogICAgICB2YWx1ZSA9IChjb21wYXJhdG9yIHx8IHZhbHVlICE9PSAwKSA/IHZhbHVlIDogMDsKICAgICAgaWYgKGlzQ29tbW9uICYmIGNvbXB1dGVkID09PSBjb21wdXRlZCkgewogICAgICAgIHZhciBzZWVuSW5kZXggPSBzZWVuLmxlbmd0aDsKICAgICAgICB3aGlsZSAoc2VlbkluZGV4LS0pIHsKICAgICAgICAgIGlmIChzZWVuW3NlZW5JbmRleF0gPT09IGNvbXB1dGVkKSB7CiAgICAgICAgICAgIGNvbnRpbnVlIG91dGVyOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoaXRlcmF0ZWUpIHsKICAgICAgICAgIHNlZW4ucHVzaChjb21wdXRlZCk7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlKTsKICAgICAgfQogICAgICBlbHNlIGlmICghaW5jbHVkZXMoc2VlbiwgY29tcHV0ZWQsIGNvbXBhcmF0b3IpKSB7CiAgICAgICAgaWYgKHNlZW4gIT09IHJlc3VsdCkgewogICAgICAgICAgc2Vlbi5wdXNoKGNvbXB1dGVkKTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8udW5zZXRgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gbW9kaWZ5LgogICAqIEBwYXJhbSB7QXJyYXl8c3RyaW5nfSBwYXRoIFRoZSBwcm9wZXJ0eSBwYXRoIHRvIHVuc2V0LgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgcHJvcGVydHkgaXMgZGVsZXRlZCwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VVbnNldChvYmplY3QsIHBhdGgpIHsKICAgIHBhdGggPSBjYXN0UGF0aChwYXRoLCBvYmplY3QpOwogICAgb2JqZWN0ID0gcGFyZW50KG9iamVjdCwgcGF0aCk7CiAgICByZXR1cm4gb2JqZWN0ID09IG51bGwgfHwgZGVsZXRlIG9iamVjdFt0b0tleShsYXN0KHBhdGgpKV07CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBtZXRob2RzIGxpa2UgYF8uZHJvcFdoaWxlYCBhbmQgYF8udGFrZVdoaWxlYAogICAqIHdpdGhvdXQgc3VwcG9ydCBmb3IgaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWRpY2F0ZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzRHJvcF0gU3BlY2lmeSBkcm9wcGluZyBlbGVtZW50cyBpbnN0ZWFkIG9mIHRha2luZyB0aGVtLgogICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2Zyb21SaWdodF0gU3BlY2lmeSBpdGVyYXRpbmcgZnJvbSByaWdodCB0byBsZWZ0LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgc2xpY2Ugb2YgYGFycmF5YC4KICAgKi8KICBmdW5jdGlvbiBiYXNlV2hpbGUoYXJyYXksIHByZWRpY2F0ZSwgaXNEcm9wLCBmcm9tUmlnaHQpIHsKICAgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGgsCiAgICAgICAgaW5kZXggPSBmcm9tUmlnaHQgPyBsZW5ndGggOiAtMTsKCiAgICB3aGlsZSAoKGZyb21SaWdodCA/IGluZGV4LS0gOiArK2luZGV4IDwgbGVuZ3RoKSAmJgogICAgICBwcmVkaWNhdGUoYXJyYXlbaW5kZXhdLCBpbmRleCwgYXJyYXkpKSB7fQoKICAgIHJldHVybiBpc0Ryb3AKICAgICAgPyBiYXNlU2xpY2UoYXJyYXksIChmcm9tUmlnaHQgPyAwIDogaW5kZXgpLCAoZnJvbVJpZ2h0ID8gaW5kZXggKyAxIDogbGVuZ3RoKSkKICAgICAgOiBiYXNlU2xpY2UoYXJyYXksIChmcm9tUmlnaHQgPyBpbmRleCArIDEgOiAwKSwgKGZyb21SaWdodCA/IGxlbmd0aCA6IGluZGV4KSk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBtZXRob2RzIGxpa2UgYF8ueG9yYCwgd2l0aG91dCBzdXBwb3J0IGZvcgogICAqIGl0ZXJhdGVlIHNob3J0aGFuZHMsIHRoYXQgYWNjZXB0cyBhbiBhcnJheSBvZiBhcnJheXMgdG8gaW5zcGVjdC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXlzIFRoZSBhcnJheXMgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWVdIFRoZSBpdGVyYXRlZSBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjb21wYXJhdG9yXSBUaGUgY29tcGFyYXRvciBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIHZhbHVlcy4KICAgKi8KICBmdW5jdGlvbiBiYXNlWG9yKGFycmF5cywgaXRlcmF0ZWUsIGNvbXBhcmF0b3IpIHsKICAgIHZhciBsZW5ndGggPSBhcnJheXMubGVuZ3RoOwogICAgaWYgKGxlbmd0aCA8IDIpIHsKICAgICAgcmV0dXJuIGxlbmd0aCA/IGJhc2VVbmlxKGFycmF5c1swXSkgOiBbXTsKICAgIH0KICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIHJlc3VsdCA9IEFycmF5KGxlbmd0aCk7CgogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgdmFyIGFycmF5ID0gYXJyYXlzW2luZGV4XSwKICAgICAgICAgIG90aEluZGV4ID0gLTE7CgogICAgICB3aGlsZSAoKytvdGhJbmRleCA8IGxlbmd0aCkgewogICAgICAgIGlmIChvdGhJbmRleCAhPSBpbmRleCkgewogICAgICAgICAgcmVzdWx0W2luZGV4XSA9IGJhc2VEaWZmZXJlbmNlKHJlc3VsdFtpbmRleF0gfHwgYXJyYXksIGFycmF5c1tvdGhJbmRleF0sIGl0ZXJhdGVlLCBjb21wYXJhdG9yKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBiYXNlVW5pcShiYXNlRmxhdHRlbihyZXN1bHQsIDEpLCBpdGVyYXRlZSwgY29tcGFyYXRvcik7CiAgfQoKICAvKioKICAgKiBUaGlzIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uemlwT2JqZWN0YCB3aGljaCBhc3NpZ25zIHZhbHVlcyB1c2luZyBgYXNzaWduRnVuY2AuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IHByb3BzIFRoZSBwcm9wZXJ0eSBpZGVudGlmaWVycy4KICAgKiBAcGFyYW0ge0FycmF5fSB2YWx1ZXMgVGhlIHByb3BlcnR5IHZhbHVlcy4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBhc3NpZ25GdW5jIFRoZSBmdW5jdGlvbiB0byBhc3NpZ24gdmFsdWVzLgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyBvYmplY3QuCiAgICovCiAgZnVuY3Rpb24gYmFzZVppcE9iamVjdChwcm9wcywgdmFsdWVzLCBhc3NpZ25GdW5jKSB7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICBsZW5ndGggPSBwcm9wcy5sZW5ndGgsCiAgICAgICAgdmFsc0xlbmd0aCA9IHZhbHVlcy5sZW5ndGgsCiAgICAgICAgcmVzdWx0ID0ge307CgogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgdmFyIHZhbHVlID0gaW5kZXggPCB2YWxzTGVuZ3RoID8gdmFsdWVzW2luZGV4XSA6IHVuZGVmaW5lZDsKICAgICAgYXNzaWduRnVuYyhyZXN1bHQsIHByb3BzW2luZGV4XSwgdmFsdWUpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIENhc3RzIGB2YWx1ZWAgdG8gYW4gZW1wdHkgYXJyYXkgaWYgaXQncyBub3QgYW4gYXJyYXkgbGlrZSBvYmplY3QuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGluc3BlY3QuCiAgICogQHJldHVybnMge0FycmF5fE9iamVjdH0gUmV0dXJucyB0aGUgY2FzdCBhcnJheS1saWtlIG9iamVjdC4KICAgKi8KICBmdW5jdGlvbiBjYXN0QXJyYXlMaWtlT2JqZWN0KHZhbHVlKSB7CiAgICByZXR1cm4gaXNBcnJheUxpa2VPYmplY3QodmFsdWUpID8gdmFsdWUgOiBbXTsKICB9CgogIC8qKgogICAqIENhc3RzIGB2YWx1ZWAgdG8gYSBwYXRoIGFycmF5IGlmIGl0J3Mgbm90IG9uZS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0ge09iamVjdH0gW29iamVjdF0gVGhlIG9iamVjdCB0byBxdWVyeSBrZXlzIG9uLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgY2FzdCBwcm9wZXJ0eSBwYXRoIGFycmF5LgogICAqLwogIGZ1bmN0aW9uIGNhc3RQYXRoKHZhbHVlLCBvYmplY3QpIHsKICAgIGlmIChpc0FycmF5KHZhbHVlKSkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICByZXR1cm4gaXNLZXkodmFsdWUsIG9iamVjdCkgPyBbdmFsdWVdIDogc3RyaW5nVG9QYXRoKHRvU3RyaW5nKHZhbHVlKSk7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgY2xvbmUgb2YgIGBidWZmZXJgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0J1ZmZlcn0gYnVmZmVyIFRoZSBidWZmZXIgdG8gY2xvbmUuCiAgICogQHBhcmFtIHtib29sZWFufSBbaXNEZWVwXSBTcGVjaWZ5IGEgZGVlcCBjbG9uZS4KICAgKiBAcmV0dXJucyB7QnVmZmVyfSBSZXR1cm5zIHRoZSBjbG9uZWQgYnVmZmVyLgogICAqLwogIGZ1bmN0aW9uIGNsb25lQnVmZmVyKGJ1ZmZlciwgaXNEZWVwKSB7CiAgICBpZiAoaXNEZWVwKSB7CiAgICAgIHJldHVybiBidWZmZXIuc2xpY2UoKTsKICAgIH0KICAgIHZhciBsZW5ndGggPSBidWZmZXIubGVuZ3RoLAogICAgICAgIHJlc3VsdCA9IGFsbG9jVW5zYWZlID8gYWxsb2NVbnNhZmUobGVuZ3RoKSA6IG5ldyBidWZmZXIuY29uc3RydWN0b3IobGVuZ3RoKTsKCiAgICBidWZmZXIuY29weShyZXN1bHQpOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBjbG9uZSBvZiBgYXJyYXlCdWZmZXJgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0FycmF5QnVmZmVyfSBhcnJheUJ1ZmZlciBUaGUgYXJyYXkgYnVmZmVyIHRvIGNsb25lLgogICAqIEByZXR1cm5zIHtBcnJheUJ1ZmZlcn0gUmV0dXJucyB0aGUgY2xvbmVkIGFycmF5IGJ1ZmZlci4KICAgKi8KICBmdW5jdGlvbiBjbG9uZUFycmF5QnVmZmVyKGFycmF5QnVmZmVyKSB7CiAgICB2YXIgcmVzdWx0ID0gbmV3IGFycmF5QnVmZmVyLmNvbnN0cnVjdG9yKGFycmF5QnVmZmVyLmJ5dGVMZW5ndGgpOwogICAgbmV3IFVpbnQ4QXJyYXkocmVzdWx0KS5zZXQobmV3IFVpbnQ4QXJyYXkoYXJyYXlCdWZmZXIpKTsKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgY2xvbmUgb2YgYGRhdGFWaWV3YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFWaWV3IFRoZSBkYXRhIHZpZXcgdG8gY2xvbmUuCiAgICogQHBhcmFtIHtib29sZWFufSBbaXNEZWVwXSBTcGVjaWZ5IGEgZGVlcCBjbG9uZS4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjbG9uZWQgZGF0YSB2aWV3LgogICAqLwogIGZ1bmN0aW9uIGNsb25lRGF0YVZpZXcoZGF0YVZpZXcsIGlzRGVlcCkgewogICAgdmFyIGJ1ZmZlciA9IGlzRGVlcCA/IGNsb25lQXJyYXlCdWZmZXIoZGF0YVZpZXcuYnVmZmVyKSA6IGRhdGFWaWV3LmJ1ZmZlcjsKICAgIHJldHVybiBuZXcgZGF0YVZpZXcuY29uc3RydWN0b3IoYnVmZmVyLCBkYXRhVmlldy5ieXRlT2Zmc2V0LCBkYXRhVmlldy5ieXRlTGVuZ3RoKTsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBjbG9uZSBvZiBgbWFwYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG1hcCBUaGUgbWFwIHRvIGNsb25lLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGNsb25lRnVuYyBUaGUgZnVuY3Rpb24gdG8gY2xvbmUgdmFsdWVzLgogICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzRGVlcF0gU3BlY2lmeSBhIGRlZXAgY2xvbmUuCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY2xvbmVkIG1hcC4KICAgKi8KICBmdW5jdGlvbiBjbG9uZU1hcChtYXAsIGlzRGVlcCwgY2xvbmVGdW5jKSB7CiAgICB2YXIgYXJyYXkgPSBpc0RlZXAgPyBjbG9uZUZ1bmMobWFwVG9BcnJheShtYXApLCBDTE9ORV9ERUVQX0ZMQUcpIDogbWFwVG9BcnJheShtYXApOwogICAgcmV0dXJuIGFycmF5UmVkdWNlKGFycmF5LCBhZGRNYXBFbnRyeSwgbmV3IG1hcC5jb25zdHJ1Y3Rvcik7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgY2xvbmUgb2YgYHJlZ2V4cGAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSByZWdleHAgVGhlIHJlZ2V4cCB0byBjbG9uZS4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjbG9uZWQgcmVnZXhwLgogICAqLwogIGZ1bmN0aW9uIGNsb25lUmVnRXhwKHJlZ2V4cCkgewogICAgdmFyIHJlc3VsdCA9IG5ldyByZWdleHAuY29uc3RydWN0b3IocmVnZXhwLnNvdXJjZSwgcmVGbGFncy5leGVjKHJlZ2V4cCkpOwogICAgcmVzdWx0Lmxhc3RJbmRleCA9IHJlZ2V4cC5sYXN0SW5kZXg7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhIGNsb25lIG9mIGBzZXRgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gc2V0IFRoZSBzZXQgdG8gY2xvbmUuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2xvbmVGdW5jIFRoZSBmdW5jdGlvbiB0byBjbG9uZSB2YWx1ZXMuCiAgICogQHBhcmFtIHtib29sZWFufSBbaXNEZWVwXSBTcGVjaWZ5IGEgZGVlcCBjbG9uZS4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjbG9uZWQgc2V0LgogICAqLwogIGZ1bmN0aW9uIGNsb25lU2V0KHNldCwgaXNEZWVwLCBjbG9uZUZ1bmMpIHsKICAgIHZhciBhcnJheSA9IGlzRGVlcCA/IGNsb25lRnVuYyhzZXRUb0FycmF5KHNldCksIENMT05FX0RFRVBfRkxBRykgOiBzZXRUb0FycmF5KHNldCk7CiAgICByZXR1cm4gYXJyYXlSZWR1Y2UoYXJyYXksIGFkZFNldEVudHJ5LCBuZXcgc2V0LmNvbnN0cnVjdG9yKTsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBjbG9uZSBvZiB0aGUgYHN5bWJvbGAgb2JqZWN0LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gc3ltYm9sIFRoZSBzeW1ib2wgb2JqZWN0IHRvIGNsb25lLgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGNsb25lZCBzeW1ib2wgb2JqZWN0LgogICAqLwogIGZ1bmN0aW9uIGNsb25lU3ltYm9sKHN5bWJvbCkgewogICAgcmV0dXJuIHN5bWJvbFZhbHVlT2YgPyBPYmplY3Qoc3ltYm9sVmFsdWVPZi5jYWxsKHN5bWJvbCkpIDoge307CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgY2xvbmUgb2YgYHR5cGVkQXJyYXlgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gdHlwZWRBcnJheSBUaGUgdHlwZWQgYXJyYXkgdG8gY2xvbmUuCiAgICogQHBhcmFtIHtib29sZWFufSBbaXNEZWVwXSBTcGVjaWZ5IGEgZGVlcCBjbG9uZS4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjbG9uZWQgdHlwZWQgYXJyYXkuCiAgICovCiAgZnVuY3Rpb24gY2xvbmVUeXBlZEFycmF5KHR5cGVkQXJyYXksIGlzRGVlcCkgewogICAgdmFyIGJ1ZmZlciA9IGlzRGVlcCA/IGNsb25lQXJyYXlCdWZmZXIodHlwZWRBcnJheS5idWZmZXIpIDogdHlwZWRBcnJheS5idWZmZXI7CiAgICByZXR1cm4gbmV3IHR5cGVkQXJyYXkuY29uc3RydWN0b3IoYnVmZmVyLCB0eXBlZEFycmF5LmJ5dGVPZmZzZXQsIHR5cGVkQXJyYXkubGVuZ3RoKTsKICB9CgogIC8qKgogICAqIENvbXBhcmVzIHZhbHVlcyB0byBzb3J0IHRoZW0gaW4gYXNjZW5kaW5nIG9yZGVyLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb21wYXJlLgogICAqIEBwYXJhbSB7Kn0gb3RoZXIgVGhlIG90aGVyIHZhbHVlIHRvIGNvbXBhcmUuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgc29ydCBvcmRlciBpbmRpY2F0b3IgZm9yIGB2YWx1ZWAuCiAgICovCiAgZnVuY3Rpb24gY29tcGFyZUFzY2VuZGluZyh2YWx1ZSwgb3RoZXIpIHsKICAgIGlmICh2YWx1ZSAhPT0gb3RoZXIpIHsKICAgICAgdmFyIHZhbElzRGVmaW5lZCA9IHZhbHVlICE9PSB1bmRlZmluZWQsCiAgICAgICAgICB2YWxJc051bGwgPSB2YWx1ZSA9PT0gbnVsbCwKICAgICAgICAgIHZhbElzUmVmbGV4aXZlID0gdmFsdWUgPT09IHZhbHVlLAogICAgICAgICAgdmFsSXNTeW1ib2wgPSBpc1N5bWJvbCh2YWx1ZSk7CgogICAgICB2YXIgb3RoSXNEZWZpbmVkID0gb3RoZXIgIT09IHVuZGVmaW5lZCwKICAgICAgICAgIG90aElzTnVsbCA9IG90aGVyID09PSBudWxsLAogICAgICAgICAgb3RoSXNSZWZsZXhpdmUgPSBvdGhlciA9PT0gb3RoZXIsCiAgICAgICAgICBvdGhJc1N5bWJvbCA9IGlzU3ltYm9sKG90aGVyKTsKCiAgICAgIGlmICgoIW90aElzTnVsbCAmJiAhb3RoSXNTeW1ib2wgJiYgIXZhbElzU3ltYm9sICYmIHZhbHVlID4gb3RoZXIpIHx8CiAgICAgICAgICAodmFsSXNTeW1ib2wgJiYgb3RoSXNEZWZpbmVkICYmIG90aElzUmVmbGV4aXZlICYmICFvdGhJc051bGwgJiYgIW90aElzU3ltYm9sKSB8fAogICAgICAgICAgKHZhbElzTnVsbCAmJiBvdGhJc0RlZmluZWQgJiYgb3RoSXNSZWZsZXhpdmUpIHx8CiAgICAgICAgICAoIXZhbElzRGVmaW5lZCAmJiBvdGhJc1JlZmxleGl2ZSkgfHwKICAgICAgICAgICF2YWxJc1JlZmxleGl2ZSkgewogICAgICAgIHJldHVybiAxOwogICAgICB9CiAgICAgIGlmICgoIXZhbElzTnVsbCAmJiAhdmFsSXNTeW1ib2wgJiYgIW90aElzU3ltYm9sICYmIHZhbHVlIDwgb3RoZXIpIHx8CiAgICAgICAgICAob3RoSXNTeW1ib2wgJiYgdmFsSXNEZWZpbmVkICYmIHZhbElzUmVmbGV4aXZlICYmICF2YWxJc051bGwgJiYgIXZhbElzU3ltYm9sKSB8fAogICAgICAgICAgKG90aElzTnVsbCAmJiB2YWxJc0RlZmluZWQgJiYgdmFsSXNSZWZsZXhpdmUpIHx8CiAgICAgICAgICAoIW90aElzRGVmaW5lZCAmJiB2YWxJc1JlZmxleGl2ZSkgfHwKICAgICAgICAgICFvdGhJc1JlZmxleGl2ZSkgewogICAgICAgIHJldHVybiAtMTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIDA7CiAgfQoKICAvKioKICAgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiBgc291cmNlYCB0byBgYXJyYXlgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0FycmF5fSBzb3VyY2UgVGhlIGFycmF5IHRvIGNvcHkgdmFsdWVzIGZyb20uCiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5PVtdXSBUaGUgYXJyYXkgdG8gY29weSB2YWx1ZXMgdG8uCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGBhcnJheWAuCiAgICovCiAgZnVuY3Rpb24gY29weUFycmF5KHNvdXJjZSwgYXJyYXkpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IHNvdXJjZS5sZW5ndGg7CgogICAgYXJyYXkgfHwgKGFycmF5ID0gQXJyYXkobGVuZ3RoKSk7CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICBhcnJheVtpbmRleF0gPSBzb3VyY2VbaW5kZXhdOwogICAgfQogICAgcmV0dXJuIGFycmF5OwogIH0KCiAgLyoqCiAgICogQ29waWVzIHByb3BlcnRpZXMgb2YgYHNvdXJjZWAgdG8gYG9iamVjdGAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBzb3VyY2UgVGhlIG9iamVjdCB0byBjb3B5IHByb3BlcnRpZXMgZnJvbS4KICAgKiBAcGFyYW0ge0FycmF5fSBwcm9wcyBUaGUgcHJvcGVydHkgaWRlbnRpZmllcnMgdG8gY29weS4KICAgKiBAcGFyYW0ge09iamVjdH0gW29iamVjdD17fV0gVGhlIG9iamVjdCB0byBjb3B5IHByb3BlcnRpZXMgdG8uCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2N1c3RvbWl6ZXJdIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgY29waWVkIHZhbHVlcy4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLgogICAqLwogIGZ1bmN0aW9uIGNvcHlPYmplY3Qoc291cmNlLCBwcm9wcywgb2JqZWN0LCBjdXN0b21pemVyKSB7CiAgICB2YXIgaXNOZXcgPSAhb2JqZWN0OwogICAgb2JqZWN0IHx8IChvYmplY3QgPSB7fSk7CgogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gcHJvcHMubGVuZ3RoOwoKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHZhciBrZXkgPSBwcm9wc1tpbmRleF07CgogICAgICB2YXIgbmV3VmFsdWUgPSBjdXN0b21pemVyCiAgICAgICAgPyBjdXN0b21pemVyKG9iamVjdFtrZXldLCBzb3VyY2Vba2V5XSwga2V5LCBvYmplY3QsIHNvdXJjZSkKICAgICAgICA6IHVuZGVmaW5lZDsKCiAgICAgIGlmIChuZXdWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbmV3VmFsdWUgPSBzb3VyY2Vba2V5XTsKICAgICAgfQogICAgICBpZiAoaXNOZXcpIHsKICAgICAgICBiYXNlQXNzaWduVmFsdWUob2JqZWN0LCBrZXksIG5ld1ZhbHVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhc3NpZ25WYWx1ZShvYmplY3QsIGtleSwgbmV3VmFsdWUpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gb2JqZWN0OwogIH0KCiAgLyoqCiAgICogQ29waWVzIG93biBzeW1ib2xzIG9mIGBzb3VyY2VgIHRvIGBvYmplY3RgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFRoZSBvYmplY3QgdG8gY29weSBzeW1ib2xzIGZyb20uCiAgICogQHBhcmFtIHtPYmplY3R9IFtvYmplY3Q9e31dIFRoZSBvYmplY3QgdG8gY29weSBzeW1ib2xzIHRvLgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuCiAgICovCiAgZnVuY3Rpb24gY29weVN5bWJvbHMoc291cmNlLCBvYmplY3QpIHsKICAgIHJldHVybiBjb3B5T2JqZWN0KHNvdXJjZSwgZ2V0U3ltYm9scyhzb3VyY2UpLCBvYmplY3QpOwogIH0KCiAgLyoqCiAgICogQ29waWVzIG93biBhbmQgaW5oZXJpdGVkIHN5bWJvbHMgb2YgYHNvdXJjZWAgdG8gYG9iamVjdGAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBzb3VyY2UgVGhlIG9iamVjdCB0byBjb3B5IHN5bWJvbHMgZnJvbS4KICAgKiBAcGFyYW0ge09iamVjdH0gW29iamVjdD17fV0gVGhlIG9iamVjdCB0byBjb3B5IHN5bWJvbHMgdG8uCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgb2JqZWN0YC4KICAgKi8KICBmdW5jdGlvbiBjb3B5U3ltYm9sc0luKHNvdXJjZSwgb2JqZWN0KSB7CiAgICByZXR1cm4gY29weU9iamVjdChzb3VyY2UsIGdldFN5bWJvbHNJbihzb3VyY2UpLCBvYmplY3QpOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgcGVyZm9ybXMgYSByZWxhdGlvbmFsIG9wZXJhdGlvbiBvbiB0d28gdmFsdWVzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvcGVyYXRvciBUaGUgZnVuY3Rpb24gdG8gcGVyZm9ybSB0aGUgb3BlcmF0aW9uLgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IHJlbGF0aW9uYWwgb3BlcmF0aW9uIGZ1bmN0aW9uLgogICAqLwogIGZ1bmN0aW9uIGNyZWF0ZVJlbGF0aW9uYWxPcGVyYXRpb24ob3BlcmF0b3IpIHsKICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSwgb3RoZXIpIHsKICAgICAgaWYgKCEodHlwZW9mIHZhbHVlID09ICdzdHJpbmcnICYmIHR5cGVvZiBvdGhlciA9PSAnc3RyaW5nJykpIHsKICAgICAgICB2YWx1ZSA9IHRvTnVtYmVyKHZhbHVlKTsKICAgICAgICBvdGhlciA9IHRvTnVtYmVyKG90aGVyKTsKICAgICAgfQogICAgICByZXR1cm4gb3BlcmF0b3IodmFsdWUsIG90aGVyKTsKICAgIH07CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgc2V0IG9iamVjdCBvZiBgdmFsdWVzYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gdmFsdWVzIFRoZSB2YWx1ZXMgdG8gYWRkIHRvIHRoZSBzZXQuCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbmV3IHNldC4KICAgKi8KICB2YXIgY3JlYXRlU2V0ID0gIShTZXQgJiYgKDEgLyBzZXRUb0FycmF5KG5ldyBTZXQoWywtMF0pKVsxXSkgPT0gSU5GSU5JVFkpID8gbm9vcCA6IGZ1bmN0aW9uKHZhbHVlcykgewogICAgcmV0dXJuIG5ldyBTZXQodmFsdWVzKTsKICB9OwoKICAvKioKICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYGJhc2VJc0VxdWFsRGVlcGAgZm9yIGFycmF5cyB3aXRoIHN1cHBvcnQgZm9yCiAgICogcGFydGlhbCBkZWVwIGNvbXBhcmlzb25zLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0ge0FycmF5fSBvdGhlciBUaGUgb3RoZXIgYXJyYXkgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0ge251bWJlcn0gYml0bWFzayBUaGUgYml0bWFzayBmbGFncy4gU2VlIGBiYXNlSXNFcXVhbGAgZm9yIG1vcmUgZGV0YWlscy4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjdXN0b21pemVyIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgY29tcGFyaXNvbnMuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZXF1YWxGdW5jIFRoZSBmdW5jdGlvbiB0byBkZXRlcm1pbmUgZXF1aXZhbGVudHMgb2YgdmFsdWVzLgogICAqIEBwYXJhbSB7T2JqZWN0fSBzdGFjayBUcmFja3MgdHJhdmVyc2VkIGBhcnJheWAgYW5kIGBvdGhlcmAgb2JqZWN0cy4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGFycmF5cyBhcmUgZXF1aXZhbGVudCwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGVxdWFsQXJyYXlzKGFycmF5LCBvdGhlciwgYml0bWFzaywgY3VzdG9taXplciwgZXF1YWxGdW5jLCBzdGFjaykgewogICAgdmFyIGlzUGFydGlhbCA9IGJpdG1hc2sgJiBDT01QQVJFX1BBUlRJQUxfRkxBRywKICAgICAgICBhcnJMZW5ndGggPSBhcnJheS5sZW5ndGgsCiAgICAgICAgb3RoTGVuZ3RoID0gb3RoZXIubGVuZ3RoOwoKICAgIGlmIChhcnJMZW5ndGggIT0gb3RoTGVuZ3RoICYmICEoaXNQYXJ0aWFsICYmIG90aExlbmd0aCA+IGFyckxlbmd0aCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLy8gQXNzdW1lIGN5Y2xpYyB2YWx1ZXMgYXJlIGVxdWFsLgogICAgdmFyIHN0YWNrZWQgPSBzdGFjay5nZXQoYXJyYXkpOwogICAgaWYgKHN0YWNrZWQgJiYgc3RhY2suZ2V0KG90aGVyKSkgewogICAgICByZXR1cm4gc3RhY2tlZCA9PSBvdGhlcjsKICAgIH0KICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIHJlc3VsdCA9IHRydWUsCiAgICAgICAgc2VlbiA9IChiaXRtYXNrICYgQ09NUEFSRV9VTk9SREVSRURfRkxBRykgPyBuZXcgU2V0Q2FjaGUgOiB1bmRlZmluZWQ7CgogICAgc3RhY2suc2V0KGFycmF5LCBvdGhlcik7CiAgICBzdGFjay5zZXQob3RoZXIsIGFycmF5KTsKCiAgICAvLyBJZ25vcmUgbm9uLWluZGV4IHByb3BlcnRpZXMuCiAgICB3aGlsZSAoKytpbmRleCA8IGFyckxlbmd0aCkgewogICAgICB2YXIgYXJyVmFsdWUgPSBhcnJheVtpbmRleF0sCiAgICAgICAgICBvdGhWYWx1ZSA9IG90aGVyW2luZGV4XTsKCiAgICAgIGlmIChjdXN0b21pemVyKSB7CiAgICAgICAgdmFyIGNvbXBhcmVkID0gaXNQYXJ0aWFsCiAgICAgICAgICA/IGN1c3RvbWl6ZXIob3RoVmFsdWUsIGFyclZhbHVlLCBpbmRleCwgb3RoZXIsIGFycmF5LCBzdGFjaykKICAgICAgICAgIDogY3VzdG9taXplcihhcnJWYWx1ZSwgb3RoVmFsdWUsIGluZGV4LCBhcnJheSwgb3RoZXIsIHN0YWNrKTsKICAgICAgfQogICAgICBpZiAoY29tcGFyZWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGlmIChjb21wYXJlZCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHJlc3VsdCA9IGZhbHNlOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIC8vIFJlY3Vyc2l2ZWx5IGNvbXBhcmUgYXJyYXlzIChzdXNjZXB0aWJsZSB0byBjYWxsIHN0YWNrIGxpbWl0cykuCiAgICAgIGlmIChzZWVuKSB7CiAgICAgICAgaWYgKCFhcnJheVNvbWUob3RoZXIsIGZ1bmN0aW9uKG90aFZhbHVlLCBvdGhJbmRleCkgewogICAgICAgICAgICAgIGlmICghY2FjaGVIYXMoc2Vlbiwgb3RoSW5kZXgpICYmCiAgICAgICAgICAgICAgICAgIChhcnJWYWx1ZSA9PT0gb3RoVmFsdWUgfHwgZXF1YWxGdW5jKGFyclZhbHVlLCBvdGhWYWx1ZSwgYml0bWFzaywgY3VzdG9taXplciwgc3RhY2spKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlZW4ucHVzaChvdGhJbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSkgewogICAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoISgKICAgICAgICAgICAgYXJyVmFsdWUgPT09IG90aFZhbHVlIHx8CiAgICAgICAgICAgICAgZXF1YWxGdW5jKGFyclZhbHVlLCBvdGhWYWx1ZSwgYml0bWFzaywgY3VzdG9taXplciwgc3RhY2spCiAgICAgICAgICApKSB7CiAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHN0YWNrWydkZWxldGUnXShhcnJheSk7CiAgICBzdGFja1snZGVsZXRlJ10ob3RoZXIpOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgYmFzZUlzRXF1YWxEZWVwYCBmb3IgY29tcGFyaW5nIG9iamVjdHMgb2YKICAgKiB0aGUgc2FtZSBgdG9TdHJpbmdUYWdgLgogICAqCiAgICogKipOb3RlOioqIFRoaXMgZnVuY3Rpb24gb25seSBzdXBwb3J0cyBjb21wYXJpbmcgdmFsdWVzIHdpdGggdGFncyBvZgogICAqIGBCb29sZWFuYCwgYERhdGVgLCBgRXJyb3JgLCBgTnVtYmVyYCwgYFJlZ0V4cGAsIG9yIGBTdHJpbmdgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0ge09iamVjdH0gb3RoZXIgVGhlIG90aGVyIG9iamVjdCB0byBjb21wYXJlLgogICAqIEBwYXJhbSB7c3RyaW5nfSB0YWcgVGhlIGB0b1N0cmluZ1RhZ2Agb2YgdGhlIG9iamVjdHMgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0ge251bWJlcn0gYml0bWFzayBUaGUgYml0bWFzayBmbGFncy4gU2VlIGBiYXNlSXNFcXVhbGAgZm9yIG1vcmUgZGV0YWlscy4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjdXN0b21pemVyIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgY29tcGFyaXNvbnMuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZXF1YWxGdW5jIFRoZSBmdW5jdGlvbiB0byBkZXRlcm1pbmUgZXF1aXZhbGVudHMgb2YgdmFsdWVzLgogICAqIEBwYXJhbSB7T2JqZWN0fSBzdGFjayBUcmFja3MgdHJhdmVyc2VkIGBvYmplY3RgIGFuZCBgb3RoZXJgIG9iamVjdHMuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBvYmplY3RzIGFyZSBlcXVpdmFsZW50LCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gZXF1YWxCeVRhZyhvYmplY3QsIG90aGVyLCB0YWcsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGVxdWFsRnVuYywgc3RhY2spIHsKICAgIHN3aXRjaCAodGFnKSB7CiAgICAgIGNhc2UgZGF0YVZpZXdUYWc6CiAgICAgICAgaWYgKChvYmplY3QuYnl0ZUxlbmd0aCAhPSBvdGhlci5ieXRlTGVuZ3RoKSB8fAogICAgICAgICAgICAob2JqZWN0LmJ5dGVPZmZzZXQgIT0gb3RoZXIuYnl0ZU9mZnNldCkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgb2JqZWN0ID0gb2JqZWN0LmJ1ZmZlcjsKICAgICAgICBvdGhlciA9IG90aGVyLmJ1ZmZlcjsKCiAgICAgIGNhc2UgYXJyYXlCdWZmZXJUYWc6CiAgICAgICAgaWYgKChvYmplY3QuYnl0ZUxlbmd0aCAhPSBvdGhlci5ieXRlTGVuZ3RoKSB8fAogICAgICAgICAgICAhZXF1YWxGdW5jKG5ldyBVaW50OEFycmF5KG9iamVjdCksIG5ldyBVaW50OEFycmF5KG90aGVyKSkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICBjYXNlIGJvb2xUYWc6CiAgICAgIGNhc2UgZGF0ZVRhZzoKICAgICAgY2FzZSBudW1iZXJUYWc6CiAgICAgICAgLy8gQ29lcmNlIGJvb2xlYW5zIHRvIGAxYCBvciBgMGAgYW5kIGRhdGVzIHRvIG1pbGxpc2Vjb25kcy4KICAgICAgICAvLyBJbnZhbGlkIGRhdGVzIGFyZSBjb2VyY2VkIHRvIGBOYU5gLgogICAgICAgIHJldHVybiBlcSgrb2JqZWN0LCArb3RoZXIpOwoKICAgICAgY2FzZSBlcnJvclRhZzoKICAgICAgICByZXR1cm4gb2JqZWN0Lm5hbWUgPT0gb3RoZXIubmFtZSAmJiBvYmplY3QubWVzc2FnZSA9PSBvdGhlci5tZXNzYWdlOwoKICAgICAgY2FzZSByZWdleHBUYWc6CiAgICAgIGNhc2Ugc3RyaW5nVGFnOgogICAgICAgIC8vIENvZXJjZSByZWdleGVzIHRvIHN0cmluZ3MgYW5kIHRyZWF0IHN0cmluZ3MsIHByaW1pdGl2ZXMgYW5kIG9iamVjdHMsCiAgICAgICAgLy8gYXMgZXF1YWwuIFNlZSBodHRwOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtcmVnZXhwLnByb3RvdHlwZS50b3N0cmluZwogICAgICAgIC8vIGZvciBtb3JlIGRldGFpbHMuCiAgICAgICAgcmV0dXJuIG9iamVjdCA9PSAob3RoZXIgKyAnJyk7CgogICAgICBjYXNlIG1hcFRhZzoKICAgICAgICB2YXIgY29udmVydCA9IG1hcFRvQXJyYXk7CgogICAgICBjYXNlIHNldFRhZzoKICAgICAgICB2YXIgaXNQYXJ0aWFsID0gYml0bWFzayAmIENPTVBBUkVfUEFSVElBTF9GTEFHOwogICAgICAgIGNvbnZlcnQgfHwgKGNvbnZlcnQgPSBzZXRUb0FycmF5KTsKCiAgICAgICAgaWYgKG9iamVjdC5zaXplICE9IG90aGVyLnNpemUgJiYgIWlzUGFydGlhbCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAvLyBBc3N1bWUgY3ljbGljIHZhbHVlcyBhcmUgZXF1YWwuCiAgICAgICAgdmFyIHN0YWNrZWQgPSBzdGFjay5nZXQob2JqZWN0KTsKICAgICAgICBpZiAoc3RhY2tlZCkgewogICAgICAgICAgcmV0dXJuIHN0YWNrZWQgPT0gb3RoZXI7CiAgICAgICAgfQogICAgICAgIGJpdG1hc2sgfD0gQ09NUEFSRV9VTk9SREVSRURfRkxBRzsKCiAgICAgICAgLy8gUmVjdXJzaXZlbHkgY29tcGFyZSBvYmplY3RzIChzdXNjZXB0aWJsZSB0byBjYWxsIHN0YWNrIGxpbWl0cykuCiAgICAgICAgc3RhY2suc2V0KG9iamVjdCwgb3RoZXIpOwogICAgICAgIHZhciByZXN1bHQgPSBlcXVhbEFycmF5cyhjb252ZXJ0KG9iamVjdCksIGNvbnZlcnQob3RoZXIpLCBiaXRtYXNrLCBjdXN0b21pemVyLCBlcXVhbEZ1bmMsIHN0YWNrKTsKICAgICAgICBzdGFja1snZGVsZXRlJ10ob2JqZWN0KTsKICAgICAgICByZXR1cm4gcmVzdWx0OwoKICAgICAgY2FzZSBzeW1ib2xUYWc6CiAgICAgICAgaWYgKHN5bWJvbFZhbHVlT2YpIHsKICAgICAgICAgIHJldHVybiBzeW1ib2xWYWx1ZU9mLmNhbGwob2JqZWN0KSA9PSBzeW1ib2xWYWx1ZU9mLmNhbGwob3RoZXIpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CgogIC8qKgogICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgYmFzZUlzRXF1YWxEZWVwYCBmb3Igb2JqZWN0cyB3aXRoIHN1cHBvcnQgZm9yCiAgICogcGFydGlhbCBkZWVwIGNvbXBhcmlzb25zLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0ge09iamVjdH0gb3RoZXIgVGhlIG90aGVyIG9iamVjdCB0byBjb21wYXJlLgogICAqIEBwYXJhbSB7bnVtYmVyfSBiaXRtYXNrIFRoZSBiaXRtYXNrIGZsYWdzLiBTZWUgYGJhc2VJc0VxdWFsYCBmb3IgbW9yZSBkZXRhaWxzLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGN1c3RvbWl6ZXIgVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBjb21wYXJpc29ucy4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcXVhbEZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGRldGVybWluZSBlcXVpdmFsZW50cyBvZiB2YWx1ZXMuCiAgICogQHBhcmFtIHtPYmplY3R9IHN0YWNrIFRyYWNrcyB0cmF2ZXJzZWQgYG9iamVjdGAgYW5kIGBvdGhlcmAgb2JqZWN0cy4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIG9iamVjdHMgYXJlIGVxdWl2YWxlbnQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBlcXVhbE9iamVjdHMob2JqZWN0LCBvdGhlciwgYml0bWFzaywgY3VzdG9taXplciwgZXF1YWxGdW5jLCBzdGFjaykgewogICAgdmFyIGlzUGFydGlhbCA9IGJpdG1hc2sgJiBDT01QQVJFX1BBUlRJQUxfRkxBRywKICAgICAgICBvYmpQcm9wcyA9IGdldEFsbEtleXMob2JqZWN0KSwKICAgICAgICBvYmpMZW5ndGggPSBvYmpQcm9wcy5sZW5ndGgsCiAgICAgICAgb3RoUHJvcHMgPSBnZXRBbGxLZXlzKG90aGVyKSwKICAgICAgICBvdGhMZW5ndGggPSBvdGhQcm9wcy5sZW5ndGg7CgogICAgaWYgKG9iakxlbmd0aCAhPSBvdGhMZW5ndGggJiYgIWlzUGFydGlhbCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB2YXIgaW5kZXggPSBvYmpMZW5ndGg7CiAgICB3aGlsZSAoaW5kZXgtLSkgewogICAgICB2YXIga2V5ID0gb2JqUHJvcHNbaW5kZXhdOwogICAgICBpZiAoIShpc1BhcnRpYWwgPyBrZXkgaW4gb3RoZXIgOiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG90aGVyLCBrZXkpKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgLy8gQXNzdW1lIGN5Y2xpYyB2YWx1ZXMgYXJlIGVxdWFsLgogICAgdmFyIHN0YWNrZWQgPSBzdGFjay5nZXQob2JqZWN0KTsKICAgIGlmIChzdGFja2VkICYmIHN0YWNrLmdldChvdGhlcikpIHsKICAgICAgcmV0dXJuIHN0YWNrZWQgPT0gb3RoZXI7CiAgICB9CiAgICB2YXIgcmVzdWx0ID0gdHJ1ZTsKICAgIHN0YWNrLnNldChvYmplY3QsIG90aGVyKTsKICAgIHN0YWNrLnNldChvdGhlciwgb2JqZWN0KTsKCiAgICB2YXIgc2tpcEN0b3IgPSBpc1BhcnRpYWw7CiAgICB3aGlsZSAoKytpbmRleCA8IG9iakxlbmd0aCkgewogICAgICBrZXkgPSBvYmpQcm9wc1tpbmRleF07CiAgICAgIHZhciBvYmpWYWx1ZSA9IG9iamVjdFtrZXldLAogICAgICAgICAgb3RoVmFsdWUgPSBvdGhlcltrZXldOwoKICAgICAgaWYgKGN1c3RvbWl6ZXIpIHsKICAgICAgICB2YXIgY29tcGFyZWQgPSBpc1BhcnRpYWwKICAgICAgICAgID8gY3VzdG9taXplcihvdGhWYWx1ZSwgb2JqVmFsdWUsIGtleSwgb3RoZXIsIG9iamVjdCwgc3RhY2spCiAgICAgICAgICA6IGN1c3RvbWl6ZXIob2JqVmFsdWUsIG90aFZhbHVlLCBrZXksIG9iamVjdCwgb3RoZXIsIHN0YWNrKTsKICAgICAgfQogICAgICAvLyBSZWN1cnNpdmVseSBjb21wYXJlIG9iamVjdHMgKHN1c2NlcHRpYmxlIHRvIGNhbGwgc3RhY2sgbGltaXRzKS4KICAgICAgaWYgKCEoY29tcGFyZWQgPT09IHVuZGVmaW5lZAogICAgICAgICAgICA/IChvYmpWYWx1ZSA9PT0gb3RoVmFsdWUgfHwgZXF1YWxGdW5jKG9ialZhbHVlLCBvdGhWYWx1ZSwgYml0bWFzaywgY3VzdG9taXplciwgc3RhY2spKQogICAgICAgICAgICA6IGNvbXBhcmVkCiAgICAgICAgICApKSB7CiAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgc2tpcEN0b3IgfHwgKHNraXBDdG9yID0ga2V5ID09ICdjb25zdHJ1Y3RvcicpOwogICAgfQogICAgaWYgKHJlc3VsdCAmJiAhc2tpcEN0b3IpIHsKICAgICAgdmFyIG9iakN0b3IgPSBvYmplY3QuY29uc3RydWN0b3IsCiAgICAgICAgICBvdGhDdG9yID0gb3RoZXIuY29uc3RydWN0b3I7CgogICAgICAvLyBOb24gYE9iamVjdGAgb2JqZWN0IGluc3RhbmNlcyB3aXRoIGRpZmZlcmVudCBjb25zdHJ1Y3RvcnMgYXJlIG5vdCBlcXVhbC4KICAgICAgaWYgKG9iakN0b3IgIT0gb3RoQ3RvciAmJgogICAgICAgICAgKCdjb25zdHJ1Y3RvcicgaW4gb2JqZWN0ICYmICdjb25zdHJ1Y3RvcicgaW4gb3RoZXIpICYmCiAgICAgICAgICAhKHR5cGVvZiBvYmpDdG9yID09ICdmdW5jdGlvbicgJiYgb2JqQ3RvciBpbnN0YW5jZW9mIG9iakN0b3IgJiYKICAgICAgICAgICAgdHlwZW9mIG90aEN0b3IgPT0gJ2Z1bmN0aW9uJyAmJiBvdGhDdG9yIGluc3RhbmNlb2Ygb3RoQ3RvcikpIHsKICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgfQogICAgfQogICAgc3RhY2tbJ2RlbGV0ZSddKG9iamVjdCk7CiAgICBzdGFja1snZGVsZXRlJ10ob3RoZXIpOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgYmFzZVJlc3RgIHdoaWNoIGZsYXR0ZW5zIHRoZSByZXN0IGFycmF5LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBhcHBseSBhIHJlc3QgcGFyYW1ldGVyIHRvLgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGZ1bmN0aW9uLgogICAqLwogIGZ1bmN0aW9uIGZsYXRSZXN0KGZ1bmMpIHsKICAgIHJldHVybiBzZXRUb1N0cmluZyhvdmVyUmVzdChmdW5jLCB1bmRlZmluZWQsIGZsYXR0ZW4pLCBmdW5jICsgJycpOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiBvd24gZW51bWVyYWJsZSBwcm9wZXJ0eSBuYW1lcyBhbmQgc3ltYm9scyBvZiBgb2JqZWN0YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcHJvcGVydHkgbmFtZXMgYW5kIHN5bWJvbHMuCiAgICovCiAgZnVuY3Rpb24gZ2V0QWxsS2V5cyhvYmplY3QpIHsKICAgIHJldHVybiBiYXNlR2V0QWxsS2V5cyhvYmplY3QsIGtleXMsIGdldFN5bWJvbHMpOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiBvd24gYW5kIGluaGVyaXRlZCBlbnVtZXJhYmxlIHByb3BlcnR5IG5hbWVzIGFuZAogICAqIHN5bWJvbHMgb2YgYG9iamVjdGAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzIGFuZCBzeW1ib2xzLgogICAqLwogIGZ1bmN0aW9uIGdldEFsbEtleXNJbihvYmplY3QpIHsKICAgIHJldHVybiBiYXNlR2V0QWxsS2V5cyhvYmplY3QsIGtleXNJbiwgZ2V0U3ltYm9sc0luKTsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIGFwcHJvcHJpYXRlICJpdGVyYXRlZSIgZnVuY3Rpb24uIElmIGBfLml0ZXJhdGVlYCBpcyBjdXN0b21pemVkLAogICAqIHRoaXMgZnVuY3Rpb24gcmV0dXJucyB0aGUgY3VzdG9tIG1ldGhvZCwgb3RoZXJ3aXNlIGl0IHJldHVybnMgYGJhc2VJdGVyYXRlZWAuCiAgICogSWYgYXJndW1lbnRzIGFyZSBwcm92aWRlZCwgdGhlIGNob3NlbiBmdW5jdGlvbiBpcyBpbnZva2VkIHdpdGggdGhlbSBhbmQKICAgKiBpdHMgcmVzdWx0IGlzIHJldHVybmVkLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IFt2YWx1ZV0gVGhlIHZhbHVlIHRvIGNvbnZlcnQgdG8gYW4gaXRlcmF0ZWUuCiAgICogQHBhcmFtIHtudW1iZXJ9IFthcml0eV0gVGhlIGFyaXR5IG9mIHRoZSBjcmVhdGVkIGl0ZXJhdGVlLgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgY2hvc2VuIGZ1bmN0aW9uIG9yIGl0cyByZXN1bHQuCiAgICovCiAgZnVuY3Rpb24gZ2V0SXRlcmF0ZWUoKSB7CiAgICB2YXIgcmVzdWx0ID0gbG9kYXNoLml0ZXJhdGVlIHx8IGl0ZXJhdGVlOwogICAgcmVzdWx0ID0gcmVzdWx0ID09PSBpdGVyYXRlZSA/IGJhc2VJdGVyYXRlZSA6IHJlc3VsdDsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gcmVzdWx0KGFyZ3VtZW50c1swXSwgYXJndW1lbnRzWzFdKSA6IHJlc3VsdDsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIGRhdGEgZm9yIGBtYXBgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gbWFwIFRoZSBtYXAgdG8gcXVlcnkuCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUgcmVmZXJlbmNlIGtleS4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgbWFwIGRhdGEuCiAgICovCiAgZnVuY3Rpb24gZ2V0TWFwRGF0YShtYXAsIGtleSkgewogICAgdmFyIGRhdGEgPSBtYXAuX19kYXRhX187CiAgICByZXR1cm4gaXNLZXlhYmxlKGtleSkKICAgICAgPyBkYXRhW3R5cGVvZiBrZXkgPT0gJ3N0cmluZycgPyAnc3RyaW5nJyA6ICdoYXNoJ10KICAgICAgOiBkYXRhLm1hcDsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIHByb3BlcnR5IG5hbWVzLCB2YWx1ZXMsIGFuZCBjb21wYXJlIGZsYWdzIG9mIGBvYmplY3RgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBtYXRjaCBkYXRhIG9mIGBvYmplY3RgLgogICAqLwogIGZ1bmN0aW9uIGdldE1hdGNoRGF0YShvYmplY3QpIHsKICAgIHZhciByZXN1bHQgPSBrZXlzKG9iamVjdCksCiAgICAgICAgbGVuZ3RoID0gcmVzdWx0Lmxlbmd0aDsKCiAgICB3aGlsZSAobGVuZ3RoLS0pIHsKICAgICAgdmFyIGtleSA9IHJlc3VsdFtsZW5ndGhdLAogICAgICAgICAgdmFsdWUgPSBvYmplY3Rba2V5XTsKCiAgICAgIHJlc3VsdFtsZW5ndGhdID0gW2tleSwgdmFsdWUsIGlzU3RyaWN0Q29tcGFyYWJsZSh2YWx1ZSldOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIG5hdGl2ZSBmdW5jdGlvbiBhdCBga2V5YCBvZiBgb2JqZWN0YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgbWV0aG9kIHRvIGdldC4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgZnVuY3Rpb24gaWYgaXQncyBuYXRpdmUsIGVsc2UgYHVuZGVmaW5lZGAuCiAgICovCiAgZnVuY3Rpb24gZ2V0TmF0aXZlKG9iamVjdCwga2V5KSB7CiAgICB2YXIgdmFsdWUgPSBnZXRWYWx1ZShvYmplY3QsIGtleSk7CiAgICByZXR1cm4gYmFzZUlzTmF0aXZlKHZhbHVlKSA/IHZhbHVlIDogdW5kZWZpbmVkOwogIH0KCiAgLyoqCiAgICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBiYXNlR2V0VGFnYCB3aGljaCBpZ25vcmVzIGBTeW1ib2wudG9TdHJpbmdUYWdgIHZhbHVlcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcXVlcnkuCiAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgcmF3IGB0b1N0cmluZ1RhZ2AuCiAgICovCiAgZnVuY3Rpb24gZ2V0UmF3VGFnKHZhbHVlKSB7CiAgICB2YXIgaXNPd24gPSBoYXNPd25Qcm9wZXJ0eS5jYWxsKHZhbHVlLCBzeW1Ub1N0cmluZ1RhZyksCiAgICAgICAgdGFnID0gdmFsdWVbc3ltVG9TdHJpbmdUYWddOwoKICAgIHRyeSB7CiAgICAgIHZhbHVlW3N5bVRvU3RyaW5nVGFnXSA9IHVuZGVmaW5lZDsKICAgICAgdmFyIHVubWFza2VkID0gdHJ1ZTsKICAgIH0gY2F0Y2ggKGUpIHt9CgogICAgdmFyIHJlc3VsdCA9IG5hdGl2ZU9iamVjdFRvU3RyaW5nLmNhbGwodmFsdWUpOwogICAgaWYgKHVubWFza2VkKSB7CiAgICAgIGlmIChpc093bikgewogICAgICAgIHZhbHVlW3N5bVRvU3RyaW5nVGFnXSA9IHRhZzsKICAgICAgfSBlbHNlIHsKICAgICAgICBkZWxldGUgdmFsdWVbc3ltVG9TdHJpbmdUYWddOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB0aGUgb3duIGVudW1lcmFibGUgc3ltYm9scyBvZiBgb2JqZWN0YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2Ygc3ltYm9scy4KICAgKi8KICB2YXIgZ2V0U3ltYm9scyA9ICFuYXRpdmVHZXRTeW1ib2xzID8gc3R1YkFycmF5IDogZnVuY3Rpb24ob2JqZWN0KSB7CiAgICBpZiAob2JqZWN0ID09IG51bGwpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfQogICAgb2JqZWN0ID0gT2JqZWN0KG9iamVjdCk7CiAgICByZXR1cm4gYXJyYXlGaWx0ZXIobmF0aXZlR2V0U3ltYm9scyhvYmplY3QpLCBmdW5jdGlvbihzeW1ib2wpIHsKICAgICAgcmV0dXJuIHByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwob2JqZWN0LCBzeW1ib2wpOwogICAgfSk7CiAgfTsKCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB0aGUgb3duIGFuZCBpbmhlcml0ZWQgZW51bWVyYWJsZSBzeW1ib2xzIG9mIGBvYmplY3RgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBzeW1ib2xzLgogICAqLwogIHZhciBnZXRTeW1ib2xzSW4gPSAhbmF0aXZlR2V0U3ltYm9scyA/IHN0dWJBcnJheSA6IGZ1bmN0aW9uKG9iamVjdCkgewogICAgdmFyIHJlc3VsdCA9IFtdOwogICAgd2hpbGUgKG9iamVjdCkgewogICAgICBhcnJheVB1c2gocmVzdWx0LCBnZXRTeW1ib2xzKG9iamVjdCkpOwogICAgICBvYmplY3QgPSBnZXRQcm90b3R5cGUob2JqZWN0KTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgLyoqCiAgICogR2V0cyB0aGUgYHRvU3RyaW5nVGFnYCBvZiBgdmFsdWVgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBxdWVyeS4KICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBgdG9TdHJpbmdUYWdgLgogICAqLwogIHZhciBnZXRUYWcgPSBiYXNlR2V0VGFnOwoKICAvLyBGYWxsYmFjayBmb3IgZGF0YSB2aWV3cywgbWFwcywgc2V0cywgYW5kIHdlYWsgbWFwcyBpbiBJRSAxMSBhbmQgcHJvbWlzZXMgaW4gTm9kZS5qcyA8IDYuCiAgaWYgKChEYXRhVmlldyAmJiBnZXRUYWcobmV3IERhdGFWaWV3KG5ldyBBcnJheUJ1ZmZlcigxKSkpICE9IGRhdGFWaWV3VGFnKSB8fAogICAgICAoTWFwICYmIGdldFRhZyhuZXcgTWFwKSAhPSBtYXBUYWcpIHx8CiAgICAgIChQcm9taXNlICYmIGdldFRhZyhQcm9taXNlLnJlc29sdmUoKSkgIT0gcHJvbWlzZVRhZykgfHwKICAgICAgKFNldCAmJiBnZXRUYWcobmV3IFNldCkgIT0gc2V0VGFnKSB8fAogICAgICAoV2Vha01hcCAmJiBnZXRUYWcobmV3IFdlYWtNYXApICE9IHdlYWtNYXBUYWcpKSB7CiAgICBnZXRUYWcgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICB2YXIgcmVzdWx0ID0gYmFzZUdldFRhZyh2YWx1ZSksCiAgICAgICAgICBDdG9yID0gcmVzdWx0ID09IG9iamVjdFRhZyA/IHZhbHVlLmNvbnN0cnVjdG9yIDogdW5kZWZpbmVkLAogICAgICAgICAgY3RvclN0cmluZyA9IEN0b3IgPyB0b1NvdXJjZShDdG9yKSA6ICcnOwoKICAgICAgaWYgKGN0b3JTdHJpbmcpIHsKICAgICAgICBzd2l0Y2ggKGN0b3JTdHJpbmcpIHsKICAgICAgICAgIGNhc2UgZGF0YVZpZXdDdG9yU3RyaW5nOiByZXR1cm4gZGF0YVZpZXdUYWc7CiAgICAgICAgICBjYXNlIG1hcEN0b3JTdHJpbmc6IHJldHVybiBtYXBUYWc7CiAgICAgICAgICBjYXNlIHByb21pc2VDdG9yU3RyaW5nOiByZXR1cm4gcHJvbWlzZVRhZzsKICAgICAgICAgIGNhc2Ugc2V0Q3RvclN0cmluZzogcmV0dXJuIHNldFRhZzsKICAgICAgICAgIGNhc2Ugd2Vha01hcEN0b3JTdHJpbmc6IHJldHVybiB3ZWFrTWFwVGFnOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgcGF0aGAgZXhpc3RzIG9uIGBvYmplY3RgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuCiAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggdG8gY2hlY2suCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gaGFzRnVuYyBUaGUgZnVuY3Rpb24gdG8gY2hlY2sgcHJvcGVydGllcy4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHBhdGhgIGV4aXN0cywgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGhhc1BhdGgob2JqZWN0LCBwYXRoLCBoYXNGdW5jKSB7CiAgICBwYXRoID0gY2FzdFBhdGgocGF0aCwgb2JqZWN0KTsKCiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICBsZW5ndGggPSBwYXRoLmxlbmd0aCwKICAgICAgICByZXN1bHQgPSBmYWxzZTsKCiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICB2YXIga2V5ID0gdG9LZXkocGF0aFtpbmRleF0pOwogICAgICBpZiAoIShyZXN1bHQgPSBvYmplY3QgIT0gbnVsbCAmJiBoYXNGdW5jKG9iamVjdCwga2V5KSkpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBvYmplY3QgPSBvYmplY3Rba2V5XTsKICAgIH0KICAgIGlmIChyZXN1bHQgfHwgKytpbmRleCAhPSBsZW5ndGgpIHsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIGxlbmd0aCA9IG9iamVjdCA9PSBudWxsID8gMCA6IG9iamVjdC5sZW5ndGg7CiAgICByZXR1cm4gISFsZW5ndGggJiYgaXNMZW5ndGgobGVuZ3RoKSAmJiBpc0luZGV4KGtleSwgbGVuZ3RoKSAmJgogICAgICAoaXNBcnJheShvYmplY3QpIHx8IGlzQXJndW1lbnRzKG9iamVjdCkpOwogIH0KCiAgLyoqCiAgICogSW5pdGlhbGl6ZXMgYW4gYXJyYXkgY2xvbmUuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBjbG9uZS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGluaXRpYWxpemVkIGNsb25lLgogICAqLwogIGZ1bmN0aW9uIGluaXRDbG9uZUFycmF5KGFycmF5KSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoLAogICAgICAgIHJlc3VsdCA9IGFycmF5LmNvbnN0cnVjdG9yKGxlbmd0aCk7CgogICAgLy8gQWRkIHByb3BlcnRpZXMgYXNzaWduZWQgYnkgYFJlZ0V4cCNleGVjYC4KICAgIGlmIChsZW5ndGggJiYgdHlwZW9mIGFycmF5WzBdID09ICdzdHJpbmcnICYmIGhhc093blByb3BlcnR5LmNhbGwoYXJyYXksICdpbmRleCcpKSB7CiAgICAgIHJlc3VsdC5pbmRleCA9IGFycmF5LmluZGV4OwogICAgICByZXN1bHQuaW5wdXQgPSBhcnJheS5pbnB1dDsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBJbml0aWFsaXplcyBhbiBvYmplY3QgY2xvbmUuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBjbG9uZS4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBpbml0aWFsaXplZCBjbG9uZS4KICAgKi8KICBmdW5jdGlvbiBpbml0Q2xvbmVPYmplY3Qob2JqZWN0KSB7CiAgICByZXR1cm4gKHR5cGVvZiBvYmplY3QuY29uc3RydWN0b3IgPT0gJ2Z1bmN0aW9uJyAmJiAhaXNQcm90b3R5cGUob2JqZWN0KSkKICAgICAgPyBiYXNlQ3JlYXRlKGdldFByb3RvdHlwZShvYmplY3QpKQogICAgICA6IHt9OwogIH0KCiAgLyoqCiAgICogSW5pdGlhbGl6ZXMgYW4gb2JqZWN0IGNsb25lIGJhc2VkIG9uIGl0cyBgdG9TdHJpbmdUYWdgLgogICAqCiAgICogKipOb3RlOioqIFRoaXMgZnVuY3Rpb24gb25seSBzdXBwb3J0cyBjbG9uaW5nIHZhbHVlcyB3aXRoIHRhZ3Mgb2YKICAgKiBgQm9vbGVhbmAsIGBEYXRlYCwgYEVycm9yYCwgYE51bWJlcmAsIGBSZWdFeHBgLCBvciBgU3RyaW5nYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGNsb25lLgogICAqIEBwYXJhbSB7c3RyaW5nfSB0YWcgVGhlIGB0b1N0cmluZ1RhZ2Agb2YgdGhlIG9iamVjdCB0byBjbG9uZS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjbG9uZUZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGNsb25lIHZhbHVlcy4KICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc0RlZXBdIFNwZWNpZnkgYSBkZWVwIGNsb25lLgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGluaXRpYWxpemVkIGNsb25lLgogICAqLwogIGZ1bmN0aW9uIGluaXRDbG9uZUJ5VGFnKG9iamVjdCwgdGFnLCBjbG9uZUZ1bmMsIGlzRGVlcCkgewogICAgdmFyIEN0b3IgPSBvYmplY3QuY29uc3RydWN0b3I7CiAgICBzd2l0Y2ggKHRhZykgewogICAgICBjYXNlIGFycmF5QnVmZmVyVGFnOgogICAgICAgIHJldHVybiBjbG9uZUFycmF5QnVmZmVyKG9iamVjdCk7CgogICAgICBjYXNlIGJvb2xUYWc6CiAgICAgIGNhc2UgZGF0ZVRhZzoKICAgICAgICByZXR1cm4gbmV3IEN0b3IoK29iamVjdCk7CgogICAgICBjYXNlIGRhdGFWaWV3VGFnOgogICAgICAgIHJldHVybiBjbG9uZURhdGFWaWV3KG9iamVjdCwgaXNEZWVwKTsKCiAgICAgIGNhc2UgZmxvYXQzMlRhZzogY2FzZSBmbG9hdDY0VGFnOgogICAgICBjYXNlIGludDhUYWc6IGNhc2UgaW50MTZUYWc6IGNhc2UgaW50MzJUYWc6CiAgICAgIGNhc2UgdWludDhUYWc6IGNhc2UgdWludDhDbGFtcGVkVGFnOiBjYXNlIHVpbnQxNlRhZzogY2FzZSB1aW50MzJUYWc6CiAgICAgICAgcmV0dXJuIGNsb25lVHlwZWRBcnJheShvYmplY3QsIGlzRGVlcCk7CgogICAgICBjYXNlIG1hcFRhZzoKICAgICAgICByZXR1cm4gY2xvbmVNYXAob2JqZWN0LCBpc0RlZXAsIGNsb25lRnVuYyk7CgogICAgICBjYXNlIG51bWJlclRhZzoKICAgICAgY2FzZSBzdHJpbmdUYWc6CiAgICAgICAgcmV0dXJuIG5ldyBDdG9yKG9iamVjdCk7CgogICAgICBjYXNlIHJlZ2V4cFRhZzoKICAgICAgICByZXR1cm4gY2xvbmVSZWdFeHAob2JqZWN0KTsKCiAgICAgIGNhc2Ugc2V0VGFnOgogICAgICAgIHJldHVybiBjbG9uZVNldChvYmplY3QsIGlzRGVlcCwgY2xvbmVGdW5jKTsKCiAgICAgIGNhc2Ugc3ltYm9sVGFnOgogICAgICAgIHJldHVybiBjbG9uZVN5bWJvbChvYmplY3QpOwogICAgfQogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSBmbGF0dGVuYWJsZSBgYXJndW1lbnRzYCBvYmplY3Qgb3IgYXJyYXkuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGZsYXR0ZW5hYmxlLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gaXNGbGF0dGVuYWJsZSh2YWx1ZSkgewogICAgcmV0dXJuIGlzQXJyYXkodmFsdWUpIHx8IGlzQXJndW1lbnRzKHZhbHVlKSB8fAogICAgICAhIShzcHJlYWRhYmxlU3ltYm9sICYmIHZhbHVlICYmIHZhbHVlW3NwcmVhZGFibGVTeW1ib2xdKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgdmFsaWQgYXJyYXktbGlrZSBpbmRleC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHBhcmFtIHtudW1iZXJ9IFtsZW5ndGg9TUFYX1NBRkVfSU5URUdFUl0gVGhlIHVwcGVyIGJvdW5kcyBvZiBhIHZhbGlkIGluZGV4LgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgdmFsaWQgaW5kZXgsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBpc0luZGV4KHZhbHVlLCBsZW5ndGgpIHsKICAgIGxlbmd0aCA9IGxlbmd0aCA9PSBudWxsID8gTUFYX1NBRkVfSU5URUdFUiA6IGxlbmd0aDsKICAgIHJldHVybiAhIWxlbmd0aCAmJgogICAgICAodHlwZW9mIHZhbHVlID09ICdudW1iZXInIHx8IHJlSXNVaW50LnRlc3QodmFsdWUpKSAmJgogICAgICAodmFsdWUgPiAtMSAmJiB2YWx1ZSAlIDEgPT0gMCAmJiB2YWx1ZSA8IGxlbmd0aCk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgdGhlIGdpdmVuIGFyZ3VtZW50cyBhcmUgZnJvbSBhbiBpdGVyYXRlZSBjYWxsLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSBwb3RlbnRpYWwgaXRlcmF0ZWUgdmFsdWUgYXJndW1lbnQuCiAgICogQHBhcmFtIHsqfSBpbmRleCBUaGUgcG90ZW50aWFsIGl0ZXJhdGVlIGluZGV4IG9yIGtleSBhcmd1bWVudC4KICAgKiBAcGFyYW0geyp9IG9iamVjdCBUaGUgcG90ZW50aWFsIGl0ZXJhdGVlIG9iamVjdCBhcmd1bWVudC4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGFyZ3VtZW50cyBhcmUgZnJvbSBhbiBpdGVyYXRlZSBjYWxsLAogICAqICBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gaXNJdGVyYXRlZUNhbGwodmFsdWUsIGluZGV4LCBvYmplY3QpIHsKICAgIGlmICghaXNPYmplY3Qob2JqZWN0KSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB2YXIgdHlwZSA9IHR5cGVvZiBpbmRleDsKICAgIGlmICh0eXBlID09ICdudW1iZXInCiAgICAgICAgICA/IChpc0FycmF5TGlrZShvYmplY3QpICYmIGlzSW5kZXgoaW5kZXgsIG9iamVjdC5sZW5ndGgpKQogICAgICAgICAgOiAodHlwZSA9PSAnc3RyaW5nJyAmJiBpbmRleCBpbiBvYmplY3QpCiAgICAgICAgKSB7CiAgICAgIHJldHVybiBlcShvYmplY3RbaW5kZXhdLCB2YWx1ZSk7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIHByb3BlcnR5IG5hbWUgYW5kIG5vdCBhIHByb3BlcnR5IHBhdGguCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEBwYXJhbSB7T2JqZWN0fSBbb2JqZWN0XSBUaGUgb2JqZWN0IHRvIHF1ZXJ5IGtleXMgb24uCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBwcm9wZXJ0eSBuYW1lLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gaXNLZXkodmFsdWUsIG9iamVjdCkgewogICAgaWYgKGlzQXJyYXkodmFsdWUpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHZhciB0eXBlID0gdHlwZW9mIHZhbHVlOwogICAgaWYgKHR5cGUgPT0gJ251bWJlcicgfHwgdHlwZSA9PSAnc3ltYm9sJyB8fCB0eXBlID09ICdib29sZWFuJyB8fAogICAgICAgIHZhbHVlID09IG51bGwgfHwgaXNTeW1ib2wodmFsdWUpKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuIHJlSXNQbGFpblByb3AudGVzdCh2YWx1ZSkgfHwgIXJlSXNEZWVwUHJvcC50ZXN0KHZhbHVlKSB8fAogICAgICAob2JqZWN0ICE9IG51bGwgJiYgdmFsdWUgaW4gT2JqZWN0KG9iamVjdCkpOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgc3VpdGFibGUgZm9yIHVzZSBhcyB1bmlxdWUgb2JqZWN0IGtleS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgc3VpdGFibGUsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBpc0tleWFibGUodmFsdWUpIHsKICAgIHZhciB0eXBlID0gdHlwZW9mIHZhbHVlOwogICAgcmV0dXJuICh0eXBlID09ICdzdHJpbmcnIHx8IHR5cGUgPT0gJ251bWJlcicgfHwgdHlwZSA9PSAnc3ltYm9sJyB8fCB0eXBlID09ICdib29sZWFuJykKICAgICAgPyAodmFsdWUgIT09ICdfX3Byb3RvX18nKQogICAgICA6ICh2YWx1ZSA9PT0gbnVsbCk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYGZ1bmNgIGhhcyBpdHMgc291cmNlIG1hc2tlZC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGBmdW5jYCBpcyBtYXNrZWQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBpc01hc2tlZChmdW5jKSB7CiAgICByZXR1cm4gISFtYXNrU3JjS2V5ICYmIChtYXNrU3JjS2V5IGluIGZ1bmMpOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGBmdW5jYCBpcyBjYXBhYmxlIG9mIGJlaW5nIG1hc2tlZC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGBmdW5jYCBpcyBtYXNrYWJsZSwgZWxzZSBgZmFsc2VgLgogICAqLwogIHZhciBpc01hc2thYmxlID0gY29yZUpzRGF0YSA/IGlzRnVuY3Rpb24gOiBzdHViRmFsc2U7CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGxpa2VseSBhIHByb3RvdHlwZSBvYmplY3QuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgcHJvdG90eXBlLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gaXNQcm90b3R5cGUodmFsdWUpIHsKICAgIHZhciBDdG9yID0gdmFsdWUgJiYgdmFsdWUuY29uc3RydWN0b3IsCiAgICAgICAgcHJvdG8gPSAodHlwZW9mIEN0b3IgPT0gJ2Z1bmN0aW9uJyAmJiBDdG9yLnByb3RvdHlwZSkgfHwgb2JqZWN0UHJvdG87CgogICAgcmV0dXJuIHZhbHVlID09PSBwcm90bzsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIHN1aXRhYmxlIGZvciBzdHJpY3QgZXF1YWxpdHkgY29tcGFyaXNvbnMsIGkuZS4gYD09PWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlmIHN1aXRhYmxlIGZvciBzdHJpY3QKICAgKiAgZXF1YWxpdHkgY29tcGFyaXNvbnMsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBpc1N0cmljdENvbXBhcmFibGUodmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZSA9PT0gdmFsdWUgJiYgIWlzT2JqZWN0KHZhbHVlKTsKICB9CgogIC8qKgogICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgbWF0Y2hlc1Byb3BlcnR5YCBmb3Igc291cmNlIHZhbHVlcyBzdWl0YWJsZQogICAqIGZvciBzdHJpY3QgZXF1YWxpdHkgY29tcGFyaXNvbnMsIGkuZS4gYD09PWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgcHJvcGVydHkgdG8gZ2V0LgogICAqIEBwYXJhbSB7Kn0gc3JjVmFsdWUgVGhlIHZhbHVlIHRvIG1hdGNoLgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IHNwZWMgZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gbWF0Y2hlc1N0cmljdENvbXBhcmFibGUoa2V5LCBzcmNWYWx1ZSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iamVjdCkgewogICAgICBpZiAob2JqZWN0ID09IG51bGwpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuIG9iamVjdFtrZXldID09PSBzcmNWYWx1ZSAmJgogICAgICAgIChzcmNWYWx1ZSAhPT0gdW5kZWZpbmVkIHx8IChrZXkgaW4gT2JqZWN0KG9iamVjdCkpKTsKICAgIH07CiAgfQoKICAvKioKICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8ubWVtb2l6ZWAgd2hpY2ggY2xlYXJzIHRoZSBtZW1vaXplZCBmdW5jdGlvbidzCiAgICogY2FjaGUgd2hlbiBpdCBleGNlZWRzIGBNQVhfTUVNT0laRV9TSVpFYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gaGF2ZSBpdHMgb3V0cHV0IG1lbW9pemVkLgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IG1lbW9pemVkIGZ1bmN0aW9uLgogICAqLwogIGZ1bmN0aW9uIG1lbW9pemVDYXBwZWQoZnVuYykgewogICAgdmFyIHJlc3VsdCA9IG1lbW9pemUoZnVuYywgZnVuY3Rpb24oa2V5KSB7CiAgICAgIGlmIChjYWNoZS5zaXplID09PSBNQVhfTUVNT0laRV9TSVpFKSB7CiAgICAgICAgY2FjaGUuY2xlYXIoKTsKICAgICAgfQogICAgICByZXR1cm4ga2V5OwogICAgfSk7CgogICAgdmFyIGNhY2hlID0gcmVzdWx0LmNhY2hlOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIFRoaXMgZnVuY3Rpb24gaXMgbGlrZQogICAqIFtgT2JqZWN0LmtleXNgXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1vYmplY3Qua2V5cykKICAgKiBleGNlcHQgdGhhdCBpdCBpbmNsdWRlcyBpbmhlcml0ZWQgZW51bWVyYWJsZSBwcm9wZXJ0aWVzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcy4KICAgKi8KICBmdW5jdGlvbiBuYXRpdmVLZXlzSW4ob2JqZWN0KSB7CiAgICB2YXIgcmVzdWx0ID0gW107CiAgICBpZiAob2JqZWN0ICE9IG51bGwpIHsKICAgICAgZm9yICh2YXIga2V5IGluIE9iamVjdChvYmplY3QpKSB7CiAgICAgICAgcmVzdWx0LnB1c2goa2V5KTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIENvbnZlcnRzIGB2YWx1ZWAgdG8gYSBzdHJpbmcgdXNpbmcgYE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmdgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb252ZXJ0LgogICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBzdHJpbmcuCiAgICovCiAgZnVuY3Rpb24gb2JqZWN0VG9TdHJpbmcodmFsdWUpIHsKICAgIHJldHVybiBuYXRpdmVPYmplY3RUb1N0cmluZy5jYWxsKHZhbHVlKTsKICB9CgogIC8qKgogICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgYmFzZVJlc3RgIHdoaWNoIHRyYW5zZm9ybXMgdGhlIHJlc3QgYXJyYXkuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGFwcGx5IGEgcmVzdCBwYXJhbWV0ZXIgdG8uCiAgICogQHBhcmFtIHtudW1iZXJ9IFtzdGFydD1mdW5jLmxlbmd0aC0xXSBUaGUgc3RhcnQgcG9zaXRpb24gb2YgdGhlIHJlc3QgcGFyYW1ldGVyLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IHRyYW5zZm9ybSBUaGUgcmVzdCBhcnJheSB0cmFuc2Zvcm0uCiAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gb3ZlclJlc3QoZnVuYywgc3RhcnQsIHRyYW5zZm9ybSkgewogICAgc3RhcnQgPSBuYXRpdmVNYXgoc3RhcnQgPT09IHVuZGVmaW5lZCA/IChmdW5jLmxlbmd0aCAtIDEpIDogc3RhcnQsIDApOwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cywKICAgICAgICAgIGluZGV4ID0gLTEsCiAgICAgICAgICBsZW5ndGggPSBuYXRpdmVNYXgoYXJncy5sZW5ndGggLSBzdGFydCwgMCksCiAgICAgICAgICBhcnJheSA9IEFycmF5KGxlbmd0aCk7CgogICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICAgIGFycmF5W2luZGV4XSA9IGFyZ3Nbc3RhcnQgKyBpbmRleF07CiAgICAgIH0KICAgICAgaW5kZXggPSAtMTsKICAgICAgdmFyIG90aGVyQXJncyA9IEFycmF5KHN0YXJ0ICsgMSk7CiAgICAgIHdoaWxlICgrK2luZGV4IDwgc3RhcnQpIHsKICAgICAgICBvdGhlckFyZ3NbaW5kZXhdID0gYXJnc1tpbmRleF07CiAgICAgIH0KICAgICAgb3RoZXJBcmdzW3N0YXJ0XSA9IHRyYW5zZm9ybShhcnJheSk7CiAgICAgIHJldHVybiBhcHBseShmdW5jLCB0aGlzLCBvdGhlckFyZ3MpOwogICAgfTsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIHBhcmVudCB2YWx1ZSBhdCBgcGF0aGAgb2YgYG9iamVjdGAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcGFyYW0ge0FycmF5fSBwYXRoIFRoZSBwYXRoIHRvIGdldCB0aGUgcGFyZW50IHZhbHVlIG9mLgogICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBwYXJlbnQgdmFsdWUuCiAgICovCiAgZnVuY3Rpb24gcGFyZW50KG9iamVjdCwgcGF0aCkgewogICAgcmV0dXJuIHBhdGgubGVuZ3RoIDwgMiA/IG9iamVjdCA6IGJhc2VHZXQob2JqZWN0LCBiYXNlU2xpY2UocGF0aCwgMCwgLTEpKTsKICB9CgogIC8qKgogICAqIFNldHMgdGhlIGB0b1N0cmluZ2AgbWV0aG9kIG9mIGBmdW5jYCB0byByZXR1cm4gYHN0cmluZ2AuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIG1vZGlmeS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdHJpbmcgVGhlIGB0b1N0cmluZ2AgcmVzdWx0LgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyBgZnVuY2AuCiAgICovCiAgdmFyIHNldFRvU3RyaW5nID0gc2hvcnRPdXQoYmFzZVNldFRvU3RyaW5nKTsKCiAgLyoqCiAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQnbGwgc2hvcnQgb3V0IGFuZCBpbnZva2UgYGlkZW50aXR5YCBpbnN0ZWFkCiAgICogb2YgYGZ1bmNgIHdoZW4gaXQncyBjYWxsZWQgYEhPVF9DT1VOVGAgb3IgbW9yZSB0aW1lcyBpbiBgSE9UX1NQQU5gCiAgICogbWlsbGlzZWNvbmRzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byByZXN0cmljdC4KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBzaG9ydGFibGUgZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gc2hvcnRPdXQoZnVuYykgewogICAgdmFyIGNvdW50ID0gMCwKICAgICAgICBsYXN0Q2FsbGVkID0gMDsKCiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzdGFtcCA9IG5hdGl2ZU5vdygpLAogICAgICAgICAgcmVtYWluaW5nID0gSE9UX1NQQU4gLSAoc3RhbXAgLSBsYXN0Q2FsbGVkKTsKCiAgICAgIGxhc3RDYWxsZWQgPSBzdGFtcDsKICAgICAgaWYgKHJlbWFpbmluZyA+IDApIHsKICAgICAgICBpZiAoKytjb3VudCA+PSBIT1RfQ09VTlQpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHNbMF07CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNvdW50ID0gMDsKICAgICAgfQogICAgICByZXR1cm4gZnVuYy5hcHBseSh1bmRlZmluZWQsIGFyZ3VtZW50cyk7CiAgICB9OwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYHN0cmluZ2AgdG8gYSBwcm9wZXJ0eSBwYXRoIGFycmF5LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyaW5nIFRoZSBzdHJpbmcgdG8gY29udmVydC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHByb3BlcnR5IHBhdGggYXJyYXkuCiAgICovCiAgdmFyIHN0cmluZ1RvUGF0aCA9IG1lbW9pemVDYXBwZWQoZnVuY3Rpb24oc3RyaW5nKSB7CiAgICB2YXIgcmVzdWx0ID0gW107CiAgICBpZiAocmVMZWFkaW5nRG90LnRlc3Qoc3RyaW5nKSkgewogICAgICByZXN1bHQucHVzaCgnJyk7CiAgICB9CiAgICBzdHJpbmcucmVwbGFjZShyZVByb3BOYW1lLCBmdW5jdGlvbihtYXRjaCwgbnVtYmVyLCBxdW90ZSwgc3RyaW5nKSB7CiAgICAgIHJlc3VsdC5wdXNoKHF1b3RlID8gc3RyaW5nLnJlcGxhY2UocmVFc2NhcGVDaGFyLCAnJDEnKSA6IChudW1iZXIgfHwgbWF0Y2gpKTsKICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9KTsKCiAgLyoqCiAgICogQ29udmVydHMgYHZhbHVlYCB0byBhIHN0cmluZyBrZXkgaWYgaXQncyBub3QgYSBzdHJpbmcgb3Igc3ltYm9sLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBpbnNwZWN0LgogICAqIEByZXR1cm5zIHtzdHJpbmd8c3ltYm9sfSBSZXR1cm5zIHRoZSBrZXkuCiAgICovCiAgZnVuY3Rpb24gdG9LZXkodmFsdWUpIHsKICAgIGlmICh0eXBlb2YgdmFsdWUgPT0gJ3N0cmluZycgfHwgaXNTeW1ib2wodmFsdWUpKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIHZhciByZXN1bHQgPSAodmFsdWUgKyAnJyk7CiAgICByZXR1cm4gKHJlc3VsdCA9PSAnMCcgJiYgKDEgLyB2YWx1ZSkgPT0gLUlORklOSVRZKSA/ICctMCcgOiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBDb252ZXJ0cyBgZnVuY2AgdG8gaXRzIHNvdXJjZSBjb2RlLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBjb252ZXJ0LgogICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIHNvdXJjZSBjb2RlLgogICAqLwogIGZ1bmN0aW9uIHRvU291cmNlKGZ1bmMpIHsKICAgIGlmIChmdW5jICE9IG51bGwpIHsKICAgICAgdHJ5IHsKICAgICAgICByZXR1cm4gZnVuY1RvU3RyaW5nLmNhbGwoZnVuYyk7CiAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIChmdW5jICsgJycpOwogICAgICB9IGNhdGNoIChlKSB7fQogICAgfQogICAgcmV0dXJuICcnOwogIH0KCiAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKICAvKioKICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIGVsZW1lbnRzIHNwbGl0IGludG8gZ3JvdXBzIHRoZSBsZW5ndGggb2YgYHNpemVgLgogICAqIElmIGBhcnJheWAgY2FuJ3QgYmUgc3BsaXQgZXZlbmx5LCB0aGUgZmluYWwgY2h1bmsgd2lsbCBiZSB0aGUgcmVtYWluaW5nCiAgICogZWxlbWVudHMuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMy4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcHJvY2Vzcy4KICAgKiBAcGFyYW0ge251bWJlcn0gW3NpemU9MV0gVGhlIGxlbmd0aCBvZiBlYWNoIGNodW5rCiAgICogQHBhcmFtLSB7T2JqZWN0fSBbZ3VhcmRdIEVuYWJsZXMgdXNlIGFzIGFuIGl0ZXJhdGVlIGZvciBtZXRob2RzIGxpa2UgYF8ubWFwYC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBjaHVua3MuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uY2h1bmsoWydhJywgJ2InLCAnYycsICdkJ10sIDIpOwogICAqIC8vID0+IFtbJ2EnLCAnYiddLCBbJ2MnLCAnZCddXQogICAqCiAgICogXy5jaHVuayhbJ2EnLCAnYicsICdjJywgJ2QnXSwgMyk7CiAgICogLy8gPT4gW1snYScsICdiJywgJ2MnXSwgWydkJ11dCiAgICovCiAgZnVuY3Rpb24gY2h1bmsoYXJyYXksIHNpemUsIGd1YXJkKSB7CiAgICBpZiAoKGd1YXJkID8gaXNJdGVyYXRlZUNhbGwoYXJyYXksIHNpemUsIGd1YXJkKSA6IHNpemUgPT09IHVuZGVmaW5lZCkpIHsKICAgICAgc2l6ZSA9IDE7CiAgICB9IGVsc2UgewogICAgICBzaXplID0gbmF0aXZlTWF4KHRvSW50ZWdlcihzaXplKSwgMCk7CiAgICB9CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7CiAgICBpZiAoIWxlbmd0aCB8fCBzaXplIDwgMSkgewogICAgICByZXR1cm4gW107CiAgICB9CiAgICB2YXIgaW5kZXggPSAwLAogICAgICAgIHJlc0luZGV4ID0gMCwKICAgICAgICByZXN1bHQgPSBBcnJheShuYXRpdmVDZWlsKGxlbmd0aCAvIHNpemUpKTsKCiAgICB3aGlsZSAoaW5kZXggPCBsZW5ndGgpIHsKICAgICAgcmVzdWx0W3Jlc0luZGV4KytdID0gYmFzZVNsaWNlKGFycmF5LCBpbmRleCwgKGluZGV4ICs9IHNpemUpKTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGFuIGFycmF5IHdpdGggYWxsIGZhbHNleSB2YWx1ZXMgcmVtb3ZlZC4gVGhlIHZhbHVlcyBgZmFsc2VgLCBgbnVsbGAsCiAgICogYDBgLCBgIiJgLCBgdW5kZWZpbmVkYCwgYW5kIGBOYU5gIGFyZSBmYWxzZXkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gY29tcGFjdC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBmaWx0ZXJlZCB2YWx1ZXMuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uY29tcGFjdChbMCwgMSwgZmFsc2UsIDIsICcnLCAzXSk7CiAgICogLy8gPT4gWzEsIDIsIDNdCiAgICovCiAgZnVuY3Rpb24gY29tcGFjdChhcnJheSkgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGgsCiAgICAgICAgcmVzSW5kZXggPSAwLAogICAgICAgIHJlc3VsdCA9IFtdOwoKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHZhciB2YWx1ZSA9IGFycmF5W2luZGV4XTsKICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgcmVzdWx0W3Jlc0luZGV4KytdID0gdmFsdWU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgbmV3IGFycmF5IGNvbmNhdGVuYXRpbmcgYGFycmF5YCB3aXRoIGFueSBhZGRpdGlvbmFsIGFycmF5cwogICAqIGFuZC9vciB2YWx1ZXMuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gY29uY2F0ZW5hdGUuCiAgICogQHBhcmFtIHsuLi4qfSBbdmFsdWVzXSBUaGUgdmFsdWVzIHRvIGNvbmNhdGVuYXRlLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGNvbmNhdGVuYXRlZCBhcnJheS4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIGFycmF5ID0gWzFdOwogICAqIHZhciBvdGhlciA9IF8uY29uY2F0KGFycmF5LCAyLCBbM10sIFtbNF1dKTsKICAgKgogICAqIGNvbnNvbGUubG9nKG90aGVyKTsKICAgKiAvLyA9PiBbMSwgMiwgMywgWzRdXQogICAqCiAgICogY29uc29sZS5sb2coYXJyYXkpOwogICAqIC8vID0+IFsxXQogICAqLwogIGZ1bmN0aW9uIGNvbmNhdCgpIHsKICAgIHZhciBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoOwogICAgaWYgKCFsZW5ndGgpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfQogICAgdmFyIGFyZ3MgPSBBcnJheShsZW5ndGggLSAxKSwKICAgICAgICBhcnJheSA9IGFyZ3VtZW50c1swXSwKICAgICAgICBpbmRleCA9IGxlbmd0aDsKCiAgICB3aGlsZSAoaW5kZXgtLSkgewogICAgICBhcmdzW2luZGV4IC0gMV0gPSBhcmd1bWVudHNbaW5kZXhdOwogICAgfQogICAgcmV0dXJuIGFycmF5UHVzaChpc0FycmF5KGFycmF5KSA/IGNvcHlBcnJheShhcnJheSkgOiBbYXJyYXldLCBiYXNlRmxhdHRlbihhcmdzLCAxKSk7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIGBhcnJheWAgdmFsdWVzIG5vdCBpbmNsdWRlZCBpbiB0aGUgb3RoZXIgZ2l2ZW4gYXJyYXlzCiAgICogdXNpbmcgW2BTYW1lVmFsdWVaZXJvYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtc2FtZXZhbHVlemVybykKICAgKiBmb3IgZXF1YWxpdHkgY29tcGFyaXNvbnMuIFRoZSBvcmRlciBhbmQgcmVmZXJlbmNlcyBvZiByZXN1bHQgdmFsdWVzIGFyZQogICAqIGRldGVybWluZWQgYnkgdGhlIGZpcnN0IGFycmF5LgogICAqCiAgICogKipOb3RlOioqIFVubGlrZSBgXy5wdWxsQWxsYCwgdGhpcyBtZXRob2QgcmV0dXJucyBhIG5ldyBhcnJheS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7Li4uQXJyYXl9IFt2YWx1ZXNdIFRoZSB2YWx1ZXMgdG8gZXhjbHVkZS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBmaWx0ZXJlZCB2YWx1ZXMuCiAgICogQHNlZSBfLndpdGhvdXQsIF8ueG9yCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uZGlmZmVyZW5jZShbMiwgMV0sIFsyLCAzXSk7CiAgICogLy8gPT4gWzFdCiAgICovCiAgdmFyIGRpZmZlcmVuY2UgPSBiYXNlUmVzdChmdW5jdGlvbihhcnJheSwgdmFsdWVzKSB7CiAgICByZXR1cm4gaXNBcnJheUxpa2VPYmplY3QoYXJyYXkpCiAgICAgID8gYmFzZURpZmZlcmVuY2UoYXJyYXksIGJhc2VGbGF0dGVuKHZhbHVlcywgMSwgaXNBcnJheUxpa2VPYmplY3QsIHRydWUpKQogICAgICA6IFtdOwogIH0pOwoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmRpZmZlcmVuY2VgIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGl0ZXJhdGVlYCB3aGljaAogICAqIGlzIGludm9rZWQgZm9yIGVhY2ggZWxlbWVudCBvZiBgYXJyYXlgIGFuZCBgdmFsdWVzYCB0byBnZW5lcmF0ZSB0aGUgY3JpdGVyaW9uCiAgICogYnkgd2hpY2ggdGhleSdyZSBjb21wYXJlZC4gVGhlIG9yZGVyIGFuZCByZWZlcmVuY2VzIG9mIHJlc3VsdCB2YWx1ZXMgYXJlCiAgICogZGV0ZXJtaW5lZCBieSB0aGUgZmlyc3QgYXJyYXkuIFRoZSBpdGVyYXRlZSBpcyBpbnZva2VkIHdpdGggb25lIGFyZ3VtZW50OgogICAqICh2YWx1ZSkuCiAgICoKICAgKiAqKk5vdGU6KiogVW5saWtlIGBfLnB1bGxBbGxCeWAsIHRoaXMgbWV0aG9kIHJldHVybnMgYSBuZXcgYXJyYXkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0gey4uLkFycmF5fSBbdmFsdWVzXSBUaGUgdmFsdWVzIHRvIGV4Y2x1ZGUuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBpdGVyYXRlZSBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIGZpbHRlcmVkIHZhbHVlcy4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5kaWZmZXJlbmNlQnkoWzIuMSwgMS4yXSwgWzIuMywgMy40XSwgTWF0aC5mbG9vcik7CiAgICogLy8gPT4gWzEuMl0KICAgKgogICAqIC8vIFRoZSBgXy5wcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLgogICAqIF8uZGlmZmVyZW5jZUJ5KFt7ICd4JzogMiB9LCB7ICd4JzogMSB9XSwgW3sgJ3gnOiAxIH1dLCAneCcpOwogICAqIC8vID0+IFt7ICd4JzogMiB9XQogICAqLwogIHZhciBkaWZmZXJlbmNlQnkgPSBiYXNlUmVzdChmdW5jdGlvbihhcnJheSwgdmFsdWVzKSB7CiAgICB2YXIgaXRlcmF0ZWUgPSBsYXN0KHZhbHVlcyk7CiAgICBpZiAoaXNBcnJheUxpa2VPYmplY3QoaXRlcmF0ZWUpKSB7CiAgICAgIGl0ZXJhdGVlID0gdW5kZWZpbmVkOwogICAgfQogICAgcmV0dXJuIGlzQXJyYXlMaWtlT2JqZWN0KGFycmF5KQogICAgICA/IGJhc2VEaWZmZXJlbmNlKGFycmF5LCBiYXNlRmxhdHRlbih2YWx1ZXMsIDEsIGlzQXJyYXlMaWtlT2JqZWN0LCB0cnVlKSwgZ2V0SXRlcmF0ZWUoaXRlcmF0ZWUsIDIpKQogICAgICA6IFtdOwogIH0pOwoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmRpZmZlcmVuY2VgIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGNvbXBhcmF0b3JgCiAgICogd2hpY2ggaXMgaW52b2tlZCB0byBjb21wYXJlIGVsZW1lbnRzIG9mIGBhcnJheWAgdG8gYHZhbHVlc2AuIFRoZSBvcmRlciBhbmQKICAgKiByZWZlcmVuY2VzIG9mIHJlc3VsdCB2YWx1ZXMgYXJlIGRldGVybWluZWQgYnkgdGhlIGZpcnN0IGFycmF5LiBUaGUgY29tcGFyYXRvcgogICAqIGlzIGludm9rZWQgd2l0aCB0d28gYXJndW1lbnRzOiAoYXJyVmFsLCBvdGhWYWwpLgogICAqCiAgICogKipOb3RlOioqIFVubGlrZSBgXy5wdWxsQWxsV2l0aGAsIHRoaXMgbWV0aG9kIHJldHVybnMgYSBuZXcgYXJyYXkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0gey4uLkFycmF5fSBbdmFsdWVzXSBUaGUgdmFsdWVzIHRvIGV4Y2x1ZGUuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NvbXBhcmF0b3JdIFRoZSBjb21wYXJhdG9yIGludm9rZWQgcGVyIGVsZW1lbnQuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2YgZmlsdGVyZWQgdmFsdWVzLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgb2JqZWN0cyA9IFt7ICd4JzogMSwgJ3knOiAyIH0sIHsgJ3gnOiAyLCAneSc6IDEgfV07CiAgICoKICAgKiBfLmRpZmZlcmVuY2VXaXRoKG9iamVjdHMsIFt7ICd4JzogMSwgJ3knOiAyIH1dLCBfLmlzRXF1YWwpOwogICAqIC8vID0+IFt7ICd4JzogMiwgJ3knOiAxIH1dCiAgICovCiAgdmFyIGRpZmZlcmVuY2VXaXRoID0gYmFzZVJlc3QoZnVuY3Rpb24oYXJyYXksIHZhbHVlcykgewogICAgdmFyIGNvbXBhcmF0b3IgPSBsYXN0KHZhbHVlcyk7CiAgICBpZiAoaXNBcnJheUxpa2VPYmplY3QoY29tcGFyYXRvcikpIHsKICAgICAgY29tcGFyYXRvciA9IHVuZGVmaW5lZDsKICAgIH0KICAgIHJldHVybiBpc0FycmF5TGlrZU9iamVjdChhcnJheSkKICAgICAgPyBiYXNlRGlmZmVyZW5jZShhcnJheSwgYmFzZUZsYXR0ZW4odmFsdWVzLCAxLCBpc0FycmF5TGlrZU9iamVjdCwgdHJ1ZSksIHVuZGVmaW5lZCwgY29tcGFyYXRvcikKICAgICAgOiBbXTsKICB9KTsKCiAgLyoqCiAgICogQ3JlYXRlcyBhIHNsaWNlIG9mIGBhcnJheWAgd2l0aCBgbmAgZWxlbWVudHMgZHJvcHBlZCBmcm9tIHRoZSBiZWdpbm5pbmcuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC41LjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcXVlcnkuCiAgICogQHBhcmFtIHtudW1iZXJ9IFtuPTFdIFRoZSBudW1iZXIgb2YgZWxlbWVudHMgdG8gZHJvcC4KICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gRW5hYmxlcyB1c2UgYXMgYW4gaXRlcmF0ZWUgZm9yIG1ldGhvZHMgbGlrZSBgXy5tYXBgLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgc2xpY2Ugb2YgYGFycmF5YC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5kcm9wKFsxLCAyLCAzXSk7CiAgICogLy8gPT4gWzIsIDNdCiAgICoKICAgKiBfLmRyb3AoWzEsIDIsIDNdLCAyKTsKICAgKiAvLyA9PiBbM10KICAgKgogICAqIF8uZHJvcChbMSwgMiwgM10sIDUpOwogICAqIC8vID0+IFtdCiAgICoKICAgKiBfLmRyb3AoWzEsIDIsIDNdLCAwKTsKICAgKiAvLyA9PiBbMSwgMiwgM10KICAgKi8KICBmdW5jdGlvbiBkcm9wKGFycmF5LCBuLCBndWFyZCkgewogICAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoOwogICAgaWYgKCFsZW5ndGgpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfQogICAgbiA9IChndWFyZCB8fCBuID09PSB1bmRlZmluZWQpID8gMSA6IHRvSW50ZWdlcihuKTsKICAgIHJldHVybiBiYXNlU2xpY2UoYXJyYXksIG4gPCAwID8gMCA6IG4sIGxlbmd0aCk7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgc2xpY2Ugb2YgYGFycmF5YCB3aXRoIGBuYCBlbGVtZW50cyBkcm9wcGVkIGZyb20gdGhlIGVuZC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS4KICAgKiBAcGFyYW0ge251bWJlcn0gW249MV0gVGhlIG51bWJlciBvZiBlbGVtZW50cyB0byBkcm9wLgogICAqIEBwYXJhbS0ge09iamVjdH0gW2d1YXJkXSBFbmFibGVzIHVzZSBhcyBhbiBpdGVyYXRlZSBmb3IgbWV0aG9kcyBsaWtlIGBfLm1hcGAuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmRyb3BSaWdodChbMSwgMiwgM10pOwogICAqIC8vID0+IFsxLCAyXQogICAqCiAgICogXy5kcm9wUmlnaHQoWzEsIDIsIDNdLCAyKTsKICAgKiAvLyA9PiBbMV0KICAgKgogICAqIF8uZHJvcFJpZ2h0KFsxLCAyLCAzXSwgNSk7CiAgICogLy8gPT4gW10KICAgKgogICAqIF8uZHJvcFJpZ2h0KFsxLCAyLCAzXSwgMCk7CiAgICogLy8gPT4gWzEsIDIsIDNdCiAgICovCiAgZnVuY3Rpb24gZHJvcFJpZ2h0KGFycmF5LCBuLCBndWFyZCkgewogICAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoOwogICAgaWYgKCFsZW5ndGgpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfQogICAgbiA9IChndWFyZCB8fCBuID09PSB1bmRlZmluZWQpID8gMSA6IHRvSW50ZWdlcihuKTsKICAgIG4gPSBsZW5ndGggLSBuOwogICAgcmV0dXJuIGJhc2VTbGljZShhcnJheSwgMCwgbiA8IDAgPyAwIDogbik7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgc2xpY2Ugb2YgYGFycmF5YCBleGNsdWRpbmcgZWxlbWVudHMgZHJvcHBlZCBmcm9tIHRoZSBlbmQuCiAgICogRWxlbWVudHMgYXJlIGRyb3BwZWQgdW50aWwgYHByZWRpY2F0ZWAgcmV0dXJucyBmYWxzZXkuIFRoZSBwcmVkaWNhdGUgaXMKICAgKiBpbnZva2VkIHdpdGggdGhyZWUgYXJndW1lbnRzOiAodmFsdWUsIGluZGV4LCBhcnJheSkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMy4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcXVlcnkuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3ByZWRpY2F0ZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgc2xpY2Ugb2YgYGFycmF5YC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIHVzZXJzID0gWwogICAqICAgeyAndXNlcic6ICdiYXJuZXknLCAgJ2FjdGl2ZSc6IHRydWUgfSwKICAgKiAgIHsgJ3VzZXInOiAnZnJlZCcsICAgICdhY3RpdmUnOiBmYWxzZSB9LAogICAqICAgeyAndXNlcic6ICdwZWJibGVzJywgJ2FjdGl2ZSc6IGZhbHNlIH0KICAgKiBdOwogICAqCiAgICogXy5kcm9wUmlnaHRXaGlsZSh1c2VycywgZnVuY3Rpb24obykgeyByZXR1cm4gIW8uYWN0aXZlOyB9KTsKICAgKiAvLyA9PiBvYmplY3RzIGZvciBbJ2Jhcm5leSddCiAgICoKICAgKiAvLyBUaGUgYF8ubWF0Y2hlc2AgaXRlcmF0ZWUgc2hvcnRoYW5kLgogICAqIF8uZHJvcFJpZ2h0V2hpbGUodXNlcnMsIHsgJ3VzZXInOiAncGViYmxlcycsICdhY3RpdmUnOiBmYWxzZSB9KTsKICAgKiAvLyA9PiBvYmplY3RzIGZvciBbJ2Jhcm5leScsICdmcmVkJ10KICAgKgogICAqIC8vIFRoZSBgXy5tYXRjaGVzUHJvcGVydHlgIGl0ZXJhdGVlIHNob3J0aGFuZC4KICAgKiBfLmRyb3BSaWdodFdoaWxlKHVzZXJzLCBbJ2FjdGl2ZScsIGZhbHNlXSk7CiAgICogLy8gPT4gb2JqZWN0cyBmb3IgWydiYXJuZXknXQogICAqCiAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy5kcm9wUmlnaHRXaGlsZSh1c2VycywgJ2FjdGl2ZScpOwogICAqIC8vID0+IG9iamVjdHMgZm9yIFsnYmFybmV5JywgJ2ZyZWQnLCAncGViYmxlcyddCiAgICovCiAgZnVuY3Rpb24gZHJvcFJpZ2h0V2hpbGUoYXJyYXksIHByZWRpY2F0ZSkgewogICAgcmV0dXJuIChhcnJheSAmJiBhcnJheS5sZW5ndGgpCiAgICAgID8gYmFzZVdoaWxlKGFycmF5LCBnZXRJdGVyYXRlZShwcmVkaWNhdGUsIDMpLCB0cnVlLCB0cnVlKQogICAgICA6IFtdOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhIHNsaWNlIG9mIGBhcnJheWAgZXhjbHVkaW5nIGVsZW1lbnRzIGRyb3BwZWQgZnJvbSB0aGUgYmVnaW5uaW5nLgogICAqIEVsZW1lbnRzIGFyZSBkcm9wcGVkIHVudGlsIGBwcmVkaWNhdGVgIHJldHVybnMgZmFsc2V5LiBUaGUgcHJlZGljYXRlIGlzCiAgICogaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czogKHZhbHVlLCBpbmRleCwgYXJyYXkpLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDMuMC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtwcmVkaWNhdGU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHNsaWNlIG9mIGBhcnJheWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciB1c2VycyA9IFsKICAgKiAgIHsgJ3VzZXInOiAnYmFybmV5JywgICdhY3RpdmUnOiBmYWxzZSB9LAogICAqICAgeyAndXNlcic6ICdmcmVkJywgICAgJ2FjdGl2ZSc6IGZhbHNlIH0sCiAgICogICB7ICd1c2VyJzogJ3BlYmJsZXMnLCAnYWN0aXZlJzogdHJ1ZSB9CiAgICogXTsKICAgKgogICAqIF8uZHJvcFdoaWxlKHVzZXJzLCBmdW5jdGlvbihvKSB7IHJldHVybiAhby5hY3RpdmU7IH0pOwogICAqIC8vID0+IG9iamVjdHMgZm9yIFsncGViYmxlcyddCiAgICoKICAgKiAvLyBUaGUgYF8ubWF0Y2hlc2AgaXRlcmF0ZWUgc2hvcnRoYW5kLgogICAqIF8uZHJvcFdoaWxlKHVzZXJzLCB7ICd1c2VyJzogJ2Jhcm5leScsICdhY3RpdmUnOiBmYWxzZSB9KTsKICAgKiAvLyA9PiBvYmplY3RzIGZvciBbJ2ZyZWQnLCAncGViYmxlcyddCiAgICoKICAgKiAvLyBUaGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy5kcm9wV2hpbGUodXNlcnMsIFsnYWN0aXZlJywgZmFsc2VdKTsKICAgKiAvLyA9PiBvYmplY3RzIGZvciBbJ3BlYmJsZXMnXQogICAqCiAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy5kcm9wV2hpbGUodXNlcnMsICdhY3RpdmUnKTsKICAgKiAvLyA9PiBvYmplY3RzIGZvciBbJ2Jhcm5leScsICdmcmVkJywgJ3BlYmJsZXMnXQogICAqLwogIGZ1bmN0aW9uIGRyb3BXaGlsZShhcnJheSwgcHJlZGljYXRlKSB7CiAgICByZXR1cm4gKGFycmF5ICYmIGFycmF5Lmxlbmd0aCkKICAgICAgPyBiYXNlV2hpbGUoYXJyYXksIGdldEl0ZXJhdGVlKHByZWRpY2F0ZSwgMyksIHRydWUpCiAgICAgIDogW107CiAgfQoKICAvKioKICAgKiBGaWxscyBlbGVtZW50cyBvZiBgYXJyYXlgIHdpdGggYHZhbHVlYCBmcm9tIGBzdGFydGAgdXAgdG8sIGJ1dCBub3QKICAgKiBpbmNsdWRpbmcsIGBlbmRgLgogICAqCiAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIG11dGF0ZXMgYGFycmF5YC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjIuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBmaWxsLgogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGZpbGwgYGFycmF5YCB3aXRoLgogICAqIEBwYXJhbSB7bnVtYmVyfSBbc3RhcnQ9MF0gVGhlIHN0YXJ0IHBvc2l0aW9uLgogICAqIEBwYXJhbSB7bnVtYmVyfSBbZW5kPWFycmF5Lmxlbmd0aF0gVGhlIGVuZCBwb3NpdGlvbi4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIGFycmF5ID0gWzEsIDIsIDNdOwogICAqCiAgICogXy5maWxsKGFycmF5LCAnYScpOwogICAqIGNvbnNvbGUubG9nKGFycmF5KTsKICAgKiAvLyA9PiBbJ2EnLCAnYScsICdhJ10KICAgKgogICAqIF8uZmlsbChBcnJheSgzKSwgMik7CiAgICogLy8gPT4gWzIsIDIsIDJdCiAgICoKICAgKiBfLmZpbGwoWzQsIDYsIDgsIDEwXSwgJyonLCAxLCAzKTsKICAgKiAvLyA9PiBbNCwgJyonLCAnKicsIDEwXQogICAqLwogIGZ1bmN0aW9uIGZpbGwoYXJyYXksIHZhbHVlLCBzdGFydCwgZW5kKSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7CiAgICBpZiAoIWxlbmd0aCkgewogICAgICByZXR1cm4gW107CiAgICB9CiAgICBpZiAoc3RhcnQgJiYgdHlwZW9mIHN0YXJ0ICE9ICdudW1iZXInICYmIGlzSXRlcmF0ZWVDYWxsKGFycmF5LCB2YWx1ZSwgc3RhcnQpKSB7CiAgICAgIHN0YXJ0ID0gMDsKICAgICAgZW5kID0gbGVuZ3RoOwogICAgfQogICAgcmV0dXJuIGJhc2VGaWxsKGFycmF5LCB2YWx1ZSwgc3RhcnQsIGVuZCk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmZpbmRgIGV4Y2VwdCB0aGF0IGl0IHJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBmaXJzdAogICAqIGVsZW1lbnQgYHByZWRpY2F0ZWAgcmV0dXJucyB0cnV0aHkgZm9yIGluc3RlYWQgb2YgdGhlIGVsZW1lbnQgaXRzZWxmLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDEuMS4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3ByZWRpY2F0ZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEBwYXJhbSB7bnVtYmVyfSBbZnJvbUluZGV4PTBdIFRoZSBpbmRleCB0byBzZWFyY2ggZnJvbS4KICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgZm91bmQgZWxlbWVudCwgZWxzZSBgLTFgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgdXNlcnMgPSBbCiAgICogICB7ICd1c2VyJzogJ2Jhcm5leScsICAnYWN0aXZlJzogZmFsc2UgfSwKICAgKiAgIHsgJ3VzZXInOiAnZnJlZCcsICAgICdhY3RpdmUnOiBmYWxzZSB9LAogICAqICAgeyAndXNlcic6ICdwZWJibGVzJywgJ2FjdGl2ZSc6IHRydWUgfQogICAqIF07CiAgICoKICAgKiBfLmZpbmRJbmRleCh1c2VycywgZnVuY3Rpb24obykgeyByZXR1cm4gby51c2VyID09ICdiYXJuZXknOyB9KTsKICAgKiAvLyA9PiAwCiAgICoKICAgKiAvLyBUaGUgYF8ubWF0Y2hlc2AgaXRlcmF0ZWUgc2hvcnRoYW5kLgogICAqIF8uZmluZEluZGV4KHVzZXJzLCB7ICd1c2VyJzogJ2ZyZWQnLCAnYWN0aXZlJzogZmFsc2UgfSk7CiAgICogLy8gPT4gMQogICAqCiAgICogLy8gVGhlIGBfLm1hdGNoZXNQcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLgogICAqIF8uZmluZEluZGV4KHVzZXJzLCBbJ2FjdGl2ZScsIGZhbHNlXSk7CiAgICogLy8gPT4gMAogICAqCiAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy5maW5kSW5kZXgodXNlcnMsICdhY3RpdmUnKTsKICAgKiAvLyA9PiAyCiAgICovCiAgZnVuY3Rpb24gZmluZEluZGV4KGFycmF5LCBwcmVkaWNhdGUsIGZyb21JbmRleCkgewogICAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoOwogICAgaWYgKCFsZW5ndGgpIHsKICAgICAgcmV0dXJuIC0xOwogICAgfQogICAgdmFyIGluZGV4ID0gZnJvbUluZGV4ID09IG51bGwgPyAwIDogdG9JbnRlZ2VyKGZyb21JbmRleCk7CiAgICBpZiAoaW5kZXggPCAwKSB7CiAgICAgIGluZGV4ID0gbmF0aXZlTWF4KGxlbmd0aCArIGluZGV4LCAwKTsKICAgIH0KICAgIHJldHVybiBiYXNlRmluZEluZGV4KGFycmF5LCBnZXRJdGVyYXRlZShwcmVkaWNhdGUsIDMpLCBpbmRleCk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmZpbmRJbmRleGAgZXhjZXB0IHRoYXQgaXQgaXRlcmF0ZXMgb3ZlciBlbGVtZW50cwogICAqIG9mIGBjb2xsZWN0aW9uYCBmcm9tIHJpZ2h0IHRvIGxlZnQuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMi4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbcHJlZGljYXRlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uCiAgICogQHBhcmFtIHtudW1iZXJ9IFtmcm9tSW5kZXg9YXJyYXkubGVuZ3RoLTFdIFRoZSBpbmRleCB0byBzZWFyY2ggZnJvbS4KICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgZm91bmQgZWxlbWVudCwgZWxzZSBgLTFgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgdXNlcnMgPSBbCiAgICogICB7ICd1c2VyJzogJ2Jhcm5leScsICAnYWN0aXZlJzogdHJ1ZSB9LAogICAqICAgeyAndXNlcic6ICdmcmVkJywgICAgJ2FjdGl2ZSc6IGZhbHNlIH0sCiAgICogICB7ICd1c2VyJzogJ3BlYmJsZXMnLCAnYWN0aXZlJzogZmFsc2UgfQogICAqIF07CiAgICoKICAgKiBfLmZpbmRMYXN0SW5kZXgodXNlcnMsIGZ1bmN0aW9uKG8pIHsgcmV0dXJuIG8udXNlciA9PSAncGViYmxlcyc7IH0pOwogICAqIC8vID0+IDIKICAgKgogICAqIC8vIFRoZSBgXy5tYXRjaGVzYCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy5maW5kTGFzdEluZGV4KHVzZXJzLCB7ICd1c2VyJzogJ2Jhcm5leScsICdhY3RpdmUnOiB0cnVlIH0pOwogICAqIC8vID0+IDAKICAgKgogICAqIC8vIFRoZSBgXy5tYXRjaGVzUHJvcGVydHlgIGl0ZXJhdGVlIHNob3J0aGFuZC4KICAgKiBfLmZpbmRMYXN0SW5kZXgodXNlcnMsIFsnYWN0aXZlJywgZmFsc2VdKTsKICAgKiAvLyA9PiAyCiAgICoKICAgKiAvLyBUaGUgYF8ucHJvcGVydHlgIGl0ZXJhdGVlIHNob3J0aGFuZC4KICAgKiBfLmZpbmRMYXN0SW5kZXgodXNlcnMsICdhY3RpdmUnKTsKICAgKiAvLyA9PiAwCiAgICovCiAgZnVuY3Rpb24gZmluZExhc3RJbmRleChhcnJheSwgcHJlZGljYXRlLCBmcm9tSW5kZXgpIHsKICAgIHZhciBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDsKICAgIGlmICghbGVuZ3RoKSB7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIHZhciBpbmRleCA9IGxlbmd0aCAtIDE7CiAgICBpZiAoZnJvbUluZGV4ICE9PSB1bmRlZmluZWQpIHsKICAgICAgaW5kZXggPSB0b0ludGVnZXIoZnJvbUluZGV4KTsKICAgICAgaW5kZXggPSBmcm9tSW5kZXggPCAwCiAgICAgICAgPyBuYXRpdmVNYXgobGVuZ3RoICsgaW5kZXgsIDApCiAgICAgICAgOiBuYXRpdmVNaW4oaW5kZXgsIGxlbmd0aCAtIDEpOwogICAgfQogICAgcmV0dXJuIGJhc2VGaW5kSW5kZXgoYXJyYXksIGdldEl0ZXJhdGVlKHByZWRpY2F0ZSwgMyksIGluZGV4LCB0cnVlKTsKICB9CgogIC8qKgogICAqIEZsYXR0ZW5zIGBhcnJheWAgYSBzaW5nbGUgbGV2ZWwgZGVlcC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBmbGF0dGVuLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGZsYXR0ZW5lZCBhcnJheS4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5mbGF0dGVuKFsxLCBbMiwgWzMsIFs0XV0sIDVdXSk7CiAgICogLy8gPT4gWzEsIDIsIFszLCBbNF1dLCA1XQogICAqLwogIGZ1bmN0aW9uIGZsYXR0ZW4oYXJyYXkpIHsKICAgIHZhciBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDsKICAgIHJldHVybiBsZW5ndGggPyBiYXNlRmxhdHRlbihhcnJheSwgMSkgOiBbXTsKICB9CgogIC8qKgogICAqIFJlY3Vyc2l2ZWx5IGZsYXR0ZW5zIGBhcnJheWAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMy4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gZmxhdHRlbi4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBmbGF0dGVuZWQgYXJyYXkuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uZmxhdHRlbkRlZXAoWzEsIFsyLCBbMywgWzRdXSwgNV1dKTsKICAgKiAvLyA9PiBbMSwgMiwgMywgNCwgNV0KICAgKi8KICBmdW5jdGlvbiBmbGF0dGVuRGVlcChhcnJheSkgewogICAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoOwogICAgcmV0dXJuIGxlbmd0aCA/IGJhc2VGbGF0dGVuKGFycmF5LCBJTkZJTklUWSkgOiBbXTsKICB9CgogIC8qKgogICAqIFJlY3Vyc2l2ZWx5IGZsYXR0ZW4gYGFycmF5YCB1cCB0byBgZGVwdGhgIHRpbWVzLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuNC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGZsYXR0ZW4uCiAgICogQHBhcmFtIHtudW1iZXJ9IFtkZXB0aD0xXSBUaGUgbWF4aW11bSByZWN1cnNpb24gZGVwdGguCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgZmxhdHRlbmVkIGFycmF5LgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgYXJyYXkgPSBbMSwgWzIsIFszLCBbNF1dLCA1XV07CiAgICoKICAgKiBfLmZsYXR0ZW5EZXB0aChhcnJheSwgMSk7CiAgICogLy8gPT4gWzEsIDIsIFszLCBbNF1dLCA1XQogICAqCiAgICogXy5mbGF0dGVuRGVwdGgoYXJyYXksIDIpOwogICAqIC8vID0+IFsxLCAyLCAzLCBbNF0sIDVdCiAgICovCiAgZnVuY3Rpb24gZmxhdHRlbkRlcHRoKGFycmF5LCBkZXB0aCkgewogICAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoOwogICAgaWYgKCFsZW5ndGgpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfQogICAgZGVwdGggPSBkZXB0aCA9PT0gdW5kZWZpbmVkID8gMSA6IHRvSW50ZWdlcihkZXB0aCk7CiAgICByZXR1cm4gYmFzZUZsYXR0ZW4oYXJyYXksIGRlcHRoKTsKICB9CgogIC8qKgogICAqIFRoZSBpbnZlcnNlIG9mIGBfLnRvUGFpcnNgOyB0aGlzIG1ldGhvZCByZXR1cm5zIGFuIG9iamVjdCBjb21wb3NlZAogICAqIGZyb20ga2V5LXZhbHVlIGBwYWlyc2AuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBwYWlycyBUaGUga2V5LXZhbHVlIHBhaXJzLgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyBvYmplY3QuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uZnJvbVBhaXJzKFtbJ2EnLCAxXSwgWydiJywgMl1dKTsKICAgKiAvLyA9PiB7ICdhJzogMSwgJ2InOiAyIH0KICAgKi8KICBmdW5jdGlvbiBmcm9tUGFpcnMocGFpcnMpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IHBhaXJzID09IG51bGwgPyAwIDogcGFpcnMubGVuZ3RoLAogICAgICAgIHJlc3VsdCA9IHt9OwoKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHZhciBwYWlyID0gcGFpcnNbaW5kZXhdOwogICAgICByZXN1bHRbcGFpclswXV0gPSBwYWlyWzFdOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIGZpcnN0IGVsZW1lbnQgb2YgYGFycmF5YC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBhbGlhcyBmaXJzdAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgZmlyc3QgZWxlbWVudCBvZiBgYXJyYXlgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmhlYWQoWzEsIDIsIDNdKTsKICAgKiAvLyA9PiAxCiAgICoKICAgKiBfLmhlYWQoW10pOwogICAqIC8vID0+IHVuZGVmaW5lZAogICAqLwogIGZ1bmN0aW9uIGhlYWQoYXJyYXkpIHsKICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKSA/IGFycmF5WzBdIDogdW5kZWZpbmVkOwogIH0KCiAgLyoqCiAgICogR2V0cyB0aGUgaW5kZXggYXQgd2hpY2ggdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgYHZhbHVlYCBpcyBmb3VuZCBpbiBgYXJyYXlgCiAgICogdXNpbmcgW2BTYW1lVmFsdWVaZXJvYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtc2FtZXZhbHVlemVybykKICAgKiBmb3IgZXF1YWxpdHkgY29tcGFyaXNvbnMuIElmIGBmcm9tSW5kZXhgIGlzIG5lZ2F0aXZlLCBpdCdzIHVzZWQgYXMgdGhlCiAgICogb2Zmc2V0IGZyb20gdGhlIGVuZCBvZiBgYXJyYXlgLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDAuMS4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2VhcmNoIGZvci4KICAgKiBAcGFyYW0ge251bWJlcn0gW2Zyb21JbmRleD0wXSBUaGUgaW5kZXggdG8gc2VhcmNoIGZyb20uCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIG1hdGNoZWQgdmFsdWUsIGVsc2UgYC0xYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pbmRleE9mKFsxLCAyLCAxLCAyXSwgMik7CiAgICogLy8gPT4gMQogICAqCiAgICogLy8gU2VhcmNoIGZyb20gdGhlIGBmcm9tSW5kZXhgLgogICAqIF8uaW5kZXhPZihbMSwgMiwgMSwgMl0sIDIsIDIpOwogICAqIC8vID0+IDMKICAgKi8KICBmdW5jdGlvbiBpbmRleE9mKGFycmF5LCB2YWx1ZSwgZnJvbUluZGV4KSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7CiAgICBpZiAoIWxlbmd0aCkgewogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICB2YXIgaW5kZXggPSBmcm9tSW5kZXggPT0gbnVsbCA/IDAgOiB0b0ludGVnZXIoZnJvbUluZGV4KTsKICAgIGlmIChpbmRleCA8IDApIHsKICAgICAgaW5kZXggPSBuYXRpdmVNYXgobGVuZ3RoICsgaW5kZXgsIDApOwogICAgfQogICAgcmV0dXJuIGJhc2VJbmRleE9mKGFycmF5LCB2YWx1ZSwgaW5kZXgpOwogIH0KCiAgLyoqCiAgICogR2V0cyBhbGwgYnV0IHRoZSBsYXN0IGVsZW1lbnQgb2YgYGFycmF5YC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHNsaWNlIG9mIGBhcnJheWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaW5pdGlhbChbMSwgMiwgM10pOwogICAqIC8vID0+IFsxLCAyXQogICAqLwogIGZ1bmN0aW9uIGluaXRpYWwoYXJyYXkpIHsKICAgIHZhciBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDsKICAgIHJldHVybiBsZW5ndGggPyBiYXNlU2xpY2UoYXJyYXksIDAsIC0xKSA6IFtdOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB1bmlxdWUgdmFsdWVzIHRoYXQgYXJlIGluY2x1ZGVkIGluIGFsbCBnaXZlbiBhcnJheXMKICAgKiB1c2luZyBbYFNhbWVWYWx1ZVplcm9gXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1zYW1ldmFsdWV6ZXJvKQogICAqIGZvciBlcXVhbGl0eSBjb21wYXJpc29ucy4gVGhlIG9yZGVyIGFuZCByZWZlcmVuY2VzIG9mIHJlc3VsdCB2YWx1ZXMgYXJlCiAgICogZGV0ZXJtaW5lZCBieSB0aGUgZmlyc3QgYXJyYXkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0gey4uLkFycmF5fSBbYXJyYXlzXSBUaGUgYXJyYXlzIHRvIGluc3BlY3QuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2YgaW50ZXJzZWN0aW5nIHZhbHVlcy4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pbnRlcnNlY3Rpb24oWzIsIDFdLCBbMiwgM10pOwogICAqIC8vID0+IFsyXQogICAqLwogIHZhciBpbnRlcnNlY3Rpb24gPSBiYXNlUmVzdChmdW5jdGlvbihhcnJheXMpIHsKICAgIHZhciBtYXBwZWQgPSBhcnJheU1hcChhcnJheXMsIGNhc3RBcnJheUxpa2VPYmplY3QpOwogICAgcmV0dXJuIChtYXBwZWQubGVuZ3RoICYmIG1hcHBlZFswXSA9PT0gYXJyYXlzWzBdKQogICAgICA/IGJhc2VJbnRlcnNlY3Rpb24obWFwcGVkKQogICAgICA6IFtdOwogIH0pOwoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmludGVyc2VjdGlvbmAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgaXRlcmF0ZWVgCiAgICogd2hpY2ggaXMgaW52b2tlZCBmb3IgZWFjaCBlbGVtZW50IG9mIGVhY2ggYGFycmF5c2AgdG8gZ2VuZXJhdGUgdGhlIGNyaXRlcmlvbgogICAqIGJ5IHdoaWNoIHRoZXkncmUgY29tcGFyZWQuIFRoZSBvcmRlciBhbmQgcmVmZXJlbmNlcyBvZiByZXN1bHQgdmFsdWVzIGFyZQogICAqIGRldGVybWluZWQgYnkgdGhlIGZpcnN0IGFycmF5LiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZCB3aXRoIG9uZSBhcmd1bWVudDoKICAgKiAodmFsdWUpLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHsuLi5BcnJheX0gW2FycmF5c10gVGhlIGFycmF5cyB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBpbnRlcnNlY3RpbmcgdmFsdWVzLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmludGVyc2VjdGlvbkJ5KFsyLjEsIDEuMl0sIFsyLjMsIDMuNF0sIE1hdGguZmxvb3IpOwogICAqIC8vID0+IFsyLjFdCiAgICoKICAgKiAvLyBUaGUgYF8ucHJvcGVydHlgIGl0ZXJhdGVlIHNob3J0aGFuZC4KICAgKiBfLmludGVyc2VjdGlvbkJ5KFt7ICd4JzogMSB9XSwgW3sgJ3gnOiAyIH0sIHsgJ3gnOiAxIH1dLCAneCcpOwogICAqIC8vID0+IFt7ICd4JzogMSB9XQogICAqLwogIHZhciBpbnRlcnNlY3Rpb25CeSA9IGJhc2VSZXN0KGZ1bmN0aW9uKGFycmF5cykgewogICAgdmFyIGl0ZXJhdGVlID0gbGFzdChhcnJheXMpLAogICAgICAgIG1hcHBlZCA9IGFycmF5TWFwKGFycmF5cywgY2FzdEFycmF5TGlrZU9iamVjdCk7CgogICAgaWYgKGl0ZXJhdGVlID09PSBsYXN0KG1hcHBlZCkpIHsKICAgICAgaXRlcmF0ZWUgPSB1bmRlZmluZWQ7CiAgICB9IGVsc2UgewogICAgICBtYXBwZWQucG9wKCk7CiAgICB9CiAgICByZXR1cm4gKG1hcHBlZC5sZW5ndGggJiYgbWFwcGVkWzBdID09PSBhcnJheXNbMF0pCiAgICAgID8gYmFzZUludGVyc2VjdGlvbihtYXBwZWQsIGdldEl0ZXJhdGVlKGl0ZXJhdGVlLCAyKSkKICAgICAgOiBbXTsKICB9KTsKCiAgLyoqCiAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5pbnRlcnNlY3Rpb25gIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGNvbXBhcmF0b3JgCiAgICogd2hpY2ggaXMgaW52b2tlZCB0byBjb21wYXJlIGVsZW1lbnRzIG9mIGBhcnJheXNgLiBUaGUgb3JkZXIgYW5kIHJlZmVyZW5jZXMKICAgKiBvZiByZXN1bHQgdmFsdWVzIGFyZSBkZXRlcm1pbmVkIGJ5IHRoZSBmaXJzdCBhcnJheS4gVGhlIGNvbXBhcmF0b3IgaXMKICAgKiBpbnZva2VkIHdpdGggdHdvIGFyZ3VtZW50czogKGFyclZhbCwgb3RoVmFsKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7Li4uQXJyYXl9IFthcnJheXNdIFRoZSBhcnJheXMgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY29tcGFyYXRvcl0gVGhlIGNvbXBhcmF0b3IgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBpbnRlcnNlY3RpbmcgdmFsdWVzLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgb2JqZWN0cyA9IFt7ICd4JzogMSwgJ3knOiAyIH0sIHsgJ3gnOiAyLCAneSc6IDEgfV07CiAgICogdmFyIG90aGVycyA9IFt7ICd4JzogMSwgJ3knOiAxIH0sIHsgJ3gnOiAxLCAneSc6IDIgfV07CiAgICoKICAgKiBfLmludGVyc2VjdGlvbldpdGgob2JqZWN0cywgb3RoZXJzLCBfLmlzRXF1YWwpOwogICAqIC8vID0+IFt7ICd4JzogMSwgJ3knOiAyIH1dCiAgICovCiAgdmFyIGludGVyc2VjdGlvbldpdGggPSBiYXNlUmVzdChmdW5jdGlvbihhcnJheXMpIHsKICAgIHZhciBjb21wYXJhdG9yID0gbGFzdChhcnJheXMpLAogICAgICAgIG1hcHBlZCA9IGFycmF5TWFwKGFycmF5cywgY2FzdEFycmF5TGlrZU9iamVjdCk7CgogICAgY29tcGFyYXRvciA9IHR5cGVvZiBjb21wYXJhdG9yID09ICdmdW5jdGlvbicgPyBjb21wYXJhdG9yIDogdW5kZWZpbmVkOwogICAgaWYgKGNvbXBhcmF0b3IpIHsKICAgICAgbWFwcGVkLnBvcCgpOwogICAgfQogICAgcmV0dXJuIChtYXBwZWQubGVuZ3RoICYmIG1hcHBlZFswXSA9PT0gYXJyYXlzWzBdKQogICAgICA/IGJhc2VJbnRlcnNlY3Rpb24obWFwcGVkLCB1bmRlZmluZWQsIGNvbXBhcmF0b3IpCiAgICAgIDogW107CiAgfSk7CgogIC8qKgogICAqIENvbnZlcnRzIGFsbCBlbGVtZW50cyBpbiBgYXJyYXlgIGludG8gYSBzdHJpbmcgc2VwYXJhdGVkIGJ5IGBzZXBhcmF0b3JgLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGNvbnZlcnQuCiAgICogQHBhcmFtIHtzdHJpbmd9IFtzZXBhcmF0b3I9JywnXSBUaGUgZWxlbWVudCBzZXBhcmF0b3IuCiAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgam9pbmVkIHN0cmluZy4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5qb2luKFsnYScsICdiJywgJ2MnXSwgJ34nKTsKICAgKiAvLyA9PiAnYX5ifmMnCiAgICovCiAgZnVuY3Rpb24gam9pbihhcnJheSwgc2VwYXJhdG9yKSB7CiAgICByZXR1cm4gYXJyYXkgPT0gbnVsbCA/ICcnIDogbmF0aXZlSm9pbi5jYWxsKGFycmF5LCBzZXBhcmF0b3IpOwogIH0KCiAgLyoqCiAgICogR2V0cyB0aGUgbGFzdCBlbGVtZW50IG9mIGBhcnJheWAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcXVlcnkuCiAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGxhc3QgZWxlbWVudCBvZiBgYXJyYXlgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmxhc3QoWzEsIDIsIDNdKTsKICAgKiAvLyA9PiAzCiAgICovCiAgZnVuY3Rpb24gbGFzdChhcnJheSkgewogICAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoOwogICAgcmV0dXJuIGxlbmd0aCA/IGFycmF5W2xlbmd0aCAtIDFdIDogdW5kZWZpbmVkOwogIH0KCiAgLyoqCiAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5pbmRleE9mYCBleGNlcHQgdGhhdCBpdCBpdGVyYXRlcyBvdmVyIGVsZW1lbnRzIG9mCiAgICogYGFycmF5YCBmcm9tIHJpZ2h0IHRvIGxlZnQuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZWFyY2ggZm9yLgogICAqIEBwYXJhbSB7bnVtYmVyfSBbZnJvbUluZGV4PWFycmF5Lmxlbmd0aC0xXSBUaGUgaW5kZXggdG8gc2VhcmNoIGZyb20uCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIG1hdGNoZWQgdmFsdWUsIGVsc2UgYC0xYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5sYXN0SW5kZXhPZihbMSwgMiwgMSwgMl0sIDIpOwogICAqIC8vID0+IDMKICAgKgogICAqIC8vIFNlYXJjaCBmcm9tIHRoZSBgZnJvbUluZGV4YC4KICAgKiBfLmxhc3RJbmRleE9mKFsxLCAyLCAxLCAyXSwgMiwgMik7CiAgICogLy8gPT4gMQogICAqLwogIGZ1bmN0aW9uIGxhc3RJbmRleE9mKGFycmF5LCB2YWx1ZSwgZnJvbUluZGV4KSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7CiAgICBpZiAoIWxlbmd0aCkgewogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICB2YXIgaW5kZXggPSBsZW5ndGg7CiAgICBpZiAoZnJvbUluZGV4ICE9PSB1bmRlZmluZWQpIHsKICAgICAgaW5kZXggPSB0b0ludGVnZXIoZnJvbUluZGV4KTsKICAgICAgaW5kZXggPSBpbmRleCA8IDAgPyBuYXRpdmVNYXgobGVuZ3RoICsgaW5kZXgsIDApIDogbmF0aXZlTWluKGluZGV4LCBsZW5ndGggLSAxKTsKICAgIH0KICAgIHJldHVybiB2YWx1ZSA9PT0gdmFsdWUKICAgICAgPyBzdHJpY3RMYXN0SW5kZXhPZihhcnJheSwgdmFsdWUsIGluZGV4KQogICAgICA6IGJhc2VGaW5kSW5kZXgoYXJyYXksIGJhc2VJc05hTiwgaW5kZXgsIHRydWUpOwogIH0KCiAgLyoqCiAgICogR2V0cyB0aGUgZWxlbWVudCBhdCBpbmRleCBgbmAgb2YgYGFycmF5YC4gSWYgYG5gIGlzIG5lZ2F0aXZlLCB0aGUgbnRoCiAgICogZWxlbWVudCBmcm9tIHRoZSBlbmQgaXMgcmV0dXJuZWQuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4xMS4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7bnVtYmVyfSBbbj0wXSBUaGUgaW5kZXggb2YgdGhlIGVsZW1lbnQgdG8gcmV0dXJuLgogICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBudGggZWxlbWVudCBvZiBgYXJyYXlgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgYXJyYXkgPSBbJ2EnLCAnYicsICdjJywgJ2QnXTsKICAgKgogICAqIF8ubnRoKGFycmF5LCAxKTsKICAgKiAvLyA9PiAnYicKICAgKgogICAqIF8ubnRoKGFycmF5LCAtMik7CiAgICogLy8gPT4gJ2MnOwogICAqLwogIGZ1bmN0aW9uIG50aChhcnJheSwgbikgewogICAgcmV0dXJuIChhcnJheSAmJiBhcnJheS5sZW5ndGgpID8gYmFzZU50aChhcnJheSwgdG9JbnRlZ2VyKG4pKSA6IHVuZGVmaW5lZDsKICB9CgogIC8qKgogICAqIFJlbW92ZXMgYWxsIGdpdmVuIHZhbHVlcyBmcm9tIGBhcnJheWAgdXNpbmcKICAgKiBbYFNhbWVWYWx1ZVplcm9gXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1zYW1ldmFsdWV6ZXJvKQogICAqIGZvciBlcXVhbGl0eSBjb21wYXJpc29ucy4KICAgKgogICAqICoqTm90ZToqKiBVbmxpa2UgYF8ud2l0aG91dGAsIHRoaXMgbWV0aG9kIG11dGF0ZXMgYGFycmF5YC4gVXNlIGBfLnJlbW92ZWAKICAgKiB0byByZW1vdmUgZWxlbWVudHMgZnJvbSBhbiBhcnJheSBieSBwcmVkaWNhdGUuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMi4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gbW9kaWZ5LgogICAqIEBwYXJhbSB7Li4uKn0gW3ZhbHVlc10gVGhlIHZhbHVlcyB0byByZW1vdmUuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGBhcnJheWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBhcnJheSA9IFsnYScsICdiJywgJ2MnLCAnYScsICdiJywgJ2MnXTsKICAgKgogICAqIF8ucHVsbChhcnJheSwgJ2EnLCAnYycpOwogICAqIGNvbnNvbGUubG9nKGFycmF5KTsKICAgKiAvLyA9PiBbJ2InLCAnYiddCiAgICovCiAgdmFyIHB1bGwgPSBiYXNlUmVzdChwdWxsQWxsKTsKCiAgLyoqCiAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5wdWxsYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGFuIGFycmF5IG9mIHZhbHVlcyB0byByZW1vdmUuCiAgICoKICAgKiAqKk5vdGU6KiogVW5saWtlIGBfLmRpZmZlcmVuY2VgLCB0aGlzIG1ldGhvZCBtdXRhdGVzIGBhcnJheWAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gbW9kaWZ5LgogICAqIEBwYXJhbSB7QXJyYXl9IHZhbHVlcyBUaGUgdmFsdWVzIHRvIHJlbW92ZS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIGFycmF5ID0gWydhJywgJ2InLCAnYycsICdhJywgJ2InLCAnYyddOwogICAqCiAgICogXy5wdWxsQWxsKGFycmF5LCBbJ2EnLCAnYyddKTsKICAgKiBjb25zb2xlLmxvZyhhcnJheSk7CiAgICogLy8gPT4gWydiJywgJ2InXQogICAqLwogIGZ1bmN0aW9uIHB1bGxBbGwoYXJyYXksIHZhbHVlcykgewogICAgcmV0dXJuIChhcnJheSAmJiBhcnJheS5sZW5ndGggJiYgdmFsdWVzICYmIHZhbHVlcy5sZW5ndGgpCiAgICAgID8gYmFzZVB1bGxBbGwoYXJyYXksIHZhbHVlcykKICAgICAgOiBhcnJheTsKICB9CgogIC8qKgogICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8ucHVsbEFsbGAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgaXRlcmF0ZWVgIHdoaWNoIGlzCiAgICogaW52b2tlZCBmb3IgZWFjaCBlbGVtZW50IG9mIGBhcnJheWAgYW5kIGB2YWx1ZXNgIHRvIGdlbmVyYXRlIHRoZSBjcml0ZXJpb24KICAgKiBieSB3aGljaCB0aGV5J3JlIGNvbXBhcmVkLiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZCB3aXRoIG9uZSBhcmd1bWVudDogKHZhbHVlKS4KICAgKgogICAqICoqTm90ZToqKiBVbmxpa2UgYF8uZGlmZmVyZW5jZUJ5YCwgdGhpcyBtZXRob2QgbXV0YXRlcyBgYXJyYXlgLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIG1vZGlmeS4KICAgKiBAcGFyYW0ge0FycmF5fSB2YWx1ZXMgVGhlIHZhbHVlcyB0byByZW1vdmUuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBpdGVyYXRlZSBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBgYXJyYXlgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgYXJyYXkgPSBbeyAneCc6IDEgfSwgeyAneCc6IDIgfSwgeyAneCc6IDMgfSwgeyAneCc6IDEgfV07CiAgICoKICAgKiBfLnB1bGxBbGxCeShhcnJheSwgW3sgJ3gnOiAxIH0sIHsgJ3gnOiAzIH1dLCAneCcpOwogICAqIGNvbnNvbGUubG9nKGFycmF5KTsKICAgKiAvLyA9PiBbeyAneCc6IDIgfV0KICAgKi8KICBmdW5jdGlvbiBwdWxsQWxsQnkoYXJyYXksIHZhbHVlcywgaXRlcmF0ZWUpIHsKICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoICYmIHZhbHVlcyAmJiB2YWx1ZXMubGVuZ3RoKQogICAgICA/IGJhc2VQdWxsQWxsKGFycmF5LCB2YWx1ZXMsIGdldEl0ZXJhdGVlKGl0ZXJhdGVlLCAyKSkKICAgICAgOiBhcnJheTsKICB9CgogIC8qKgogICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8ucHVsbEFsbGAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgY29tcGFyYXRvcmAgd2hpY2gKICAgKiBpcyBpbnZva2VkIHRvIGNvbXBhcmUgZWxlbWVudHMgb2YgYGFycmF5YCB0byBgdmFsdWVzYC4gVGhlIGNvbXBhcmF0b3IgaXMKICAgKiBpbnZva2VkIHdpdGggdHdvIGFyZ3VtZW50czogKGFyclZhbCwgb3RoVmFsKS4KICAgKgogICAqICoqTm90ZToqKiBVbmxpa2UgYF8uZGlmZmVyZW5jZVdpdGhgLCB0aGlzIG1ldGhvZCBtdXRhdGVzIGBhcnJheWAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC42LjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gbW9kaWZ5LgogICAqIEBwYXJhbSB7QXJyYXl9IHZhbHVlcyBUaGUgdmFsdWVzIHRvIHJlbW92ZS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY29tcGFyYXRvcl0gVGhlIGNvbXBhcmF0b3IgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIGFycmF5ID0gW3sgJ3gnOiAxLCAneSc6IDIgfSwgeyAneCc6IDMsICd5JzogNCB9LCB7ICd4JzogNSwgJ3knOiA2IH1dOwogICAqCiAgICogXy5wdWxsQWxsV2l0aChhcnJheSwgW3sgJ3gnOiAzLCAneSc6IDQgfV0sIF8uaXNFcXVhbCk7CiAgICogY29uc29sZS5sb2coYXJyYXkpOwogICAqIC8vID0+IFt7ICd4JzogMSwgJ3knOiAyIH0sIHsgJ3gnOiA1LCAneSc6IDYgfV0KICAgKi8KICBmdW5jdGlvbiBwdWxsQWxsV2l0aChhcnJheSwgdmFsdWVzLCBjb21wYXJhdG9yKSB7CiAgICByZXR1cm4gKGFycmF5ICYmIGFycmF5Lmxlbmd0aCAmJiB2YWx1ZXMgJiYgdmFsdWVzLmxlbmd0aCkKICAgICAgPyBiYXNlUHVsbEFsbChhcnJheSwgdmFsdWVzLCB1bmRlZmluZWQsIGNvbXBhcmF0b3IpCiAgICAgIDogYXJyYXk7CiAgfQoKICAvKioKICAgKiBSZW1vdmVzIGVsZW1lbnRzIGZyb20gYGFycmF5YCBjb3JyZXNwb25kaW5nIHRvIGBpbmRleGVzYCBhbmQgcmV0dXJucyBhbgogICAqIGFycmF5IG9mIHJlbW92ZWQgZWxlbWVudHMuCiAgICoKICAgKiAqKk5vdGU6KiogVW5saWtlIGBfLmF0YCwgdGhpcyBtZXRob2QgbXV0YXRlcyBgYXJyYXlgLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDMuMC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIG1vZGlmeS4KICAgKiBAcGFyYW0gey4uLihudW1iZXJ8bnVtYmVyW10pfSBbaW5kZXhlc10gVGhlIGluZGV4ZXMgb2YgZWxlbWVudHMgdG8gcmVtb3ZlLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIHJlbW92ZWQgZWxlbWVudHMuCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBhcnJheSA9IFsnYScsICdiJywgJ2MnLCAnZCddOwogICAqIHZhciBwdWxsZWQgPSBfLnB1bGxBdChhcnJheSwgWzEsIDNdKTsKICAgKgogICAqIGNvbnNvbGUubG9nKGFycmF5KTsKICAgKiAvLyA9PiBbJ2EnLCAnYyddCiAgICoKICAgKiBjb25zb2xlLmxvZyhwdWxsZWQpOwogICAqIC8vID0+IFsnYicsICdkJ10KICAgKi8KICB2YXIgcHVsbEF0ID0gZmxhdFJlc3QoZnVuY3Rpb24oYXJyYXksIGluZGV4ZXMpIHsKICAgIHZhciBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aCwKICAgICAgICByZXN1bHQgPSBiYXNlQXQoYXJyYXksIGluZGV4ZXMpOwoKICAgIGJhc2VQdWxsQXQoYXJyYXksIGFycmF5TWFwKGluZGV4ZXMsIGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgIHJldHVybiBpc0luZGV4KGluZGV4LCBsZW5ndGgpID8gK2luZGV4IDogaW5kZXg7CiAgICB9KS5zb3J0KGNvbXBhcmVBc2NlbmRpbmcpKTsKCiAgICByZXR1cm4gcmVzdWx0OwogIH0pOwoKICAvKioKICAgKiBSZW1vdmVzIGFsbCBlbGVtZW50cyBmcm9tIGBhcnJheWAgdGhhdCBgcHJlZGljYXRlYCByZXR1cm5zIHRydXRoeSBmb3IKICAgKiBhbmQgcmV0dXJucyBhbiBhcnJheSBvZiB0aGUgcmVtb3ZlZCBlbGVtZW50cy4gVGhlIHByZWRpY2F0ZSBpcyBpbnZva2VkCiAgICogd2l0aCB0aHJlZSBhcmd1bWVudHM6ICh2YWx1ZSwgaW5kZXgsIGFycmF5KS4KICAgKgogICAqICoqTm90ZToqKiBVbmxpa2UgYF8uZmlsdGVyYCwgdGhpcyBtZXRob2QgbXV0YXRlcyBgYXJyYXlgLiBVc2UgYF8ucHVsbGAKICAgKiB0byBwdWxsIGVsZW1lbnRzIGZyb20gYW4gYXJyYXkgYnkgdmFsdWUuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMi4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gbW9kaWZ5LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtwcmVkaWNhdGU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiByZW1vdmVkIGVsZW1lbnRzLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgYXJyYXkgPSBbMSwgMiwgMywgNF07CiAgICogdmFyIGV2ZW5zID0gXy5yZW1vdmUoYXJyYXksIGZ1bmN0aW9uKG4pIHsKICAgKiAgIHJldHVybiBuICUgMiA9PSAwOwogICAqIH0pOwogICAqCiAgICogY29uc29sZS5sb2coYXJyYXkpOwogICAqIC8vID0+IFsxLCAzXQogICAqCiAgICogY29uc29sZS5sb2coZXZlbnMpOwogICAqIC8vID0+IFsyLCA0XQogICAqLwogIGZ1bmN0aW9uIHJlbW92ZShhcnJheSwgcHJlZGljYXRlKSB7CiAgICB2YXIgcmVzdWx0ID0gW107CiAgICBpZiAoIShhcnJheSAmJiBhcnJheS5sZW5ndGgpKSB7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICBpbmRleGVzID0gW10sCiAgICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwoKICAgIHByZWRpY2F0ZSA9IGdldEl0ZXJhdGVlKHByZWRpY2F0ZSwgMyk7CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICB2YXIgdmFsdWUgPSBhcnJheVtpbmRleF07CiAgICAgIGlmIChwcmVkaWNhdGUodmFsdWUsIGluZGV4LCBhcnJheSkpIHsKICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSk7CiAgICAgICAgaW5kZXhlcy5wdXNoKGluZGV4KTsKICAgICAgfQogICAgfQogICAgYmFzZVB1bGxBdChhcnJheSwgaW5kZXhlcyk7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogUmV2ZXJzZXMgYGFycmF5YCBzbyB0aGF0IHRoZSBmaXJzdCBlbGVtZW50IGJlY29tZXMgdGhlIGxhc3QsIHRoZSBzZWNvbmQKICAgKiBlbGVtZW50IGJlY29tZXMgdGhlIHNlY29uZCB0byBsYXN0LCBhbmQgc28gb24uCiAgICoKICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgbXV0YXRlcyBgYXJyYXlgIGFuZCBpcyBiYXNlZCBvbgogICAqIFtgQXJyYXkjcmV2ZXJzZWBdKGh0dHBzOi8vbWRuLmlvL0FycmF5L3JldmVyc2UpLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIG1vZGlmeS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIGFycmF5ID0gWzEsIDIsIDNdOwogICAqCiAgICogXy5yZXZlcnNlKGFycmF5KTsKICAgKiAvLyA9PiBbMywgMiwgMV0KICAgKgogICAqIGNvbnNvbGUubG9nKGFycmF5KTsKICAgKiAvLyA9PiBbMywgMiwgMV0KICAgKi8KICBmdW5jdGlvbiByZXZlcnNlKGFycmF5KSB7CiAgICByZXR1cm4gYXJyYXkgPT0gbnVsbCA/IGFycmF5IDogbmF0aXZlUmV2ZXJzZS5jYWxsKGFycmF5KTsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBzbGljZSBvZiBgYXJyYXlgIGZyb20gYHN0YXJ0YCB1cCB0bywgYnV0IG5vdCBpbmNsdWRpbmcsIGBlbmRgLgogICAqCiAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIHVzZWQgaW5zdGVhZCBvZgogICAqIFtgQXJyYXkjc2xpY2VgXShodHRwczovL21kbi5pby9BcnJheS9zbGljZSkgdG8gZW5zdXJlIGRlbnNlIGFycmF5cyBhcmUKICAgKiByZXR1cm5lZC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBzbGljZS4KICAgKiBAcGFyYW0ge251bWJlcn0gW3N0YXJ0PTBdIFRoZSBzdGFydCBwb3NpdGlvbi4KICAgKiBAcGFyYW0ge251bWJlcn0gW2VuZD1hcnJheS5sZW5ndGhdIFRoZSBlbmQgcG9zaXRpb24uCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLgogICAqLwogIGZ1bmN0aW9uIHNsaWNlKGFycmF5LCBzdGFydCwgZW5kKSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7CiAgICBpZiAoIWxlbmd0aCkgewogICAgICByZXR1cm4gW107CiAgICB9CiAgICBpZiAoZW5kICYmIHR5cGVvZiBlbmQgIT0gJ251bWJlcicgJiYgaXNJdGVyYXRlZUNhbGwoYXJyYXksIHN0YXJ0LCBlbmQpKSB7CiAgICAgIHN0YXJ0ID0gMDsKICAgICAgZW5kID0gbGVuZ3RoOwogICAgfQogICAgZWxzZSB7CiAgICAgIHN0YXJ0ID0gc3RhcnQgPT0gbnVsbCA/IDAgOiB0b0ludGVnZXIoc3RhcnQpOwogICAgICBlbmQgPSBlbmQgPT09IHVuZGVmaW5lZCA/IGxlbmd0aCA6IHRvSW50ZWdlcihlbmQpOwogICAgfQogICAgcmV0dXJuIGJhc2VTbGljZShhcnJheSwgc3RhcnQsIGVuZCk7CiAgfQoKICAvKioKICAgKiBVc2VzIGEgYmluYXJ5IHNlYXJjaCB0byBkZXRlcm1pbmUgdGhlIGxvd2VzdCBpbmRleCBhdCB3aGljaCBgdmFsdWVgCiAgICogc2hvdWxkIGJlIGluc2VydGVkIGludG8gYGFycmF5YCBpbiBvcmRlciB0byBtYWludGFpbiBpdHMgc29ydCBvcmRlci4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBzb3J0ZWQgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBldmFsdWF0ZS4KICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBhdCB3aGljaCBgdmFsdWVgIHNob3VsZCBiZSBpbnNlcnRlZAogICAqICBpbnRvIGBhcnJheWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uc29ydGVkSW5kZXgoWzMwLCA1MF0sIDQwKTsKICAgKiAvLyA9PiAxCiAgICovCiAgZnVuY3Rpb24gc29ydGVkSW5kZXgoYXJyYXksIHZhbHVlKSB7CiAgICByZXR1cm4gYmFzZVNvcnRlZEluZGV4KGFycmF5LCB2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnNvcnRlZEluZGV4YCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGBpdGVyYXRlZWAKICAgKiB3aGljaCBpcyBpbnZva2VkIGZvciBgdmFsdWVgIGFuZCBlYWNoIGVsZW1lbnQgb2YgYGFycmF5YCB0byBjb21wdXRlIHRoZWlyCiAgICogc29ydCByYW5raW5nLiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZCB3aXRoIG9uZSBhcmd1bWVudDogKHZhbHVlKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBzb3J0ZWQgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBldmFsdWF0ZS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGl0ZXJhdGVlIGludm9rZWQgcGVyIGVsZW1lbnQuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggYXQgd2hpY2ggYHZhbHVlYCBzaG91bGQgYmUgaW5zZXJ0ZWQKICAgKiAgaW50byBgYXJyYXlgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgb2JqZWN0cyA9IFt7ICd4JzogNCB9LCB7ICd4JzogNSB9XTsKICAgKgogICAqIF8uc29ydGVkSW5kZXhCeShvYmplY3RzLCB7ICd4JzogNCB9LCBmdW5jdGlvbihvKSB7IHJldHVybiBvLng7IH0pOwogICAqIC8vID0+IDAKICAgKgogICAqIC8vIFRoZSBgXy5wcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLgogICAqIF8uc29ydGVkSW5kZXhCeShvYmplY3RzLCB7ICd4JzogNCB9LCAneCcpOwogICAqIC8vID0+IDAKICAgKi8KICBmdW5jdGlvbiBzb3J0ZWRJbmRleEJ5KGFycmF5LCB2YWx1ZSwgaXRlcmF0ZWUpIHsKICAgIHJldHVybiBiYXNlU29ydGVkSW5kZXhCeShhcnJheSwgdmFsdWUsIGdldEl0ZXJhdGVlKGl0ZXJhdGVlLCAyKSk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmluZGV4T2ZgIGV4Y2VwdCB0aGF0IGl0IHBlcmZvcm1zIGEgYmluYXJ5CiAgICogc2VhcmNoIG9uIGEgc29ydGVkIGBhcnJheWAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZWFyY2ggZm9yLgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBtYXRjaGVkIHZhbHVlLCBlbHNlIGAtMWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uc29ydGVkSW5kZXhPZihbNCwgNSwgNSwgNSwgNl0sIDUpOwogICAqIC8vID0+IDEKICAgKi8KICBmdW5jdGlvbiBzb3J0ZWRJbmRleE9mKGFycmF5LCB2YWx1ZSkgewogICAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoOwogICAgaWYgKGxlbmd0aCkgewogICAgICB2YXIgaW5kZXggPSBiYXNlU29ydGVkSW5kZXgoYXJyYXksIHZhbHVlKTsKICAgICAgaWYgKGluZGV4IDwgbGVuZ3RoICYmIGVxKGFycmF5W2luZGV4XSwgdmFsdWUpKSB7CiAgICAgICAgcmV0dXJuIGluZGV4OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gLTE7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnNvcnRlZEluZGV4YCBleGNlcHQgdGhhdCBpdCByZXR1cm5zIHRoZSBoaWdoZXN0CiAgICogaW5kZXggYXQgd2hpY2ggYHZhbHVlYCBzaG91bGQgYmUgaW5zZXJ0ZWQgaW50byBgYXJyYXlgIGluIG9yZGVyIHRvCiAgICogbWFpbnRhaW4gaXRzIHNvcnQgb3JkZXIuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMy4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgc29ydGVkIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gZXZhbHVhdGUuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggYXQgd2hpY2ggYHZhbHVlYCBzaG91bGQgYmUgaW5zZXJ0ZWQKICAgKiAgaW50byBgYXJyYXlgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnNvcnRlZExhc3RJbmRleChbNCwgNSwgNSwgNSwgNl0sIDUpOwogICAqIC8vID0+IDQKICAgKi8KICBmdW5jdGlvbiBzb3J0ZWRMYXN0SW5kZXgoYXJyYXksIHZhbHVlKSB7CiAgICByZXR1cm4gYmFzZVNvcnRlZEluZGV4KGFycmF5LCB2YWx1ZSwgdHJ1ZSk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnNvcnRlZExhc3RJbmRleGAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgaXRlcmF0ZWVgCiAgICogd2hpY2ggaXMgaW52b2tlZCBmb3IgYHZhbHVlYCBhbmQgZWFjaCBlbGVtZW50IG9mIGBhcnJheWAgdG8gY29tcHV0ZSB0aGVpcgogICAqIHNvcnQgcmFua2luZy4gVGhlIGl0ZXJhdGVlIGlzIGludm9rZWQgd2l0aCBvbmUgYXJndW1lbnQ6ICh2YWx1ZSkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgc29ydGVkIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gZXZhbHVhdGUuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBpdGVyYXRlZSBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGluZGV4IGF0IHdoaWNoIGB2YWx1ZWAgc2hvdWxkIGJlIGluc2VydGVkCiAgICogIGludG8gYGFycmF5YC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIG9iamVjdHMgPSBbeyAneCc6IDQgfSwgeyAneCc6IDUgfV07CiAgICoKICAgKiBfLnNvcnRlZExhc3RJbmRleEJ5KG9iamVjdHMsIHsgJ3gnOiA0IH0sIGZ1bmN0aW9uKG8pIHsgcmV0dXJuIG8ueDsgfSk7CiAgICogLy8gPT4gMQogICAqCiAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy5zb3J0ZWRMYXN0SW5kZXhCeShvYmplY3RzLCB7ICd4JzogNCB9LCAneCcpOwogICAqIC8vID0+IDEKICAgKi8KICBmdW5jdGlvbiBzb3J0ZWRMYXN0SW5kZXhCeShhcnJheSwgdmFsdWUsIGl0ZXJhdGVlKSB7CiAgICByZXR1cm4gYmFzZVNvcnRlZEluZGV4QnkoYXJyYXksIHZhbHVlLCBnZXRJdGVyYXRlZShpdGVyYXRlZSwgMiksIHRydWUpOwogIH0KCiAgLyoqCiAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5sYXN0SW5kZXhPZmAgZXhjZXB0IHRoYXQgaXQgcGVyZm9ybXMgYSBiaW5hcnkKICAgKiBzZWFyY2ggb24gYSBzb3J0ZWQgYGFycmF5YC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNlYXJjaCBmb3IuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIG1hdGNoZWQgdmFsdWUsIGVsc2UgYC0xYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5zb3J0ZWRMYXN0SW5kZXhPZihbNCwgNSwgNSwgNSwgNl0sIDUpOwogICAqIC8vID0+IDMKICAgKi8KICBmdW5jdGlvbiBzb3J0ZWRMYXN0SW5kZXhPZihhcnJheSwgdmFsdWUpIHsKICAgIHZhciBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDsKICAgIGlmIChsZW5ndGgpIHsKICAgICAgdmFyIGluZGV4ID0gYmFzZVNvcnRlZEluZGV4KGFycmF5LCB2YWx1ZSwgdHJ1ZSkgLSAxOwogICAgICBpZiAoZXEoYXJyYXlbaW5kZXhdLCB2YWx1ZSkpIHsKICAgICAgICByZXR1cm4gaW5kZXg7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAtMTsKICB9CgogIC8qKgogICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8udW5pcWAgZXhjZXB0IHRoYXQgaXQncyBkZXNpZ25lZCBhbmQgb3B0aW1pemVkCiAgICogZm9yIHNvcnRlZCBhcnJheXMuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBkdXBsaWNhdGUgZnJlZSBhcnJheS4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5zb3J0ZWRVbmlxKFsxLCAxLCAyXSk7CiAgICogLy8gPT4gWzEsIDJdCiAgICovCiAgZnVuY3Rpb24gc29ydGVkVW5pcShhcnJheSkgewogICAgcmV0dXJuIChhcnJheSAmJiBhcnJheS5sZW5ndGgpCiAgICAgID8gYmFzZVNvcnRlZFVuaXEoYXJyYXkpCiAgICAgIDogW107CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnVuaXFCeWAgZXhjZXB0IHRoYXQgaXQncyBkZXNpZ25lZCBhbmQgb3B0aW1pemVkCiAgICogZm9yIHNvcnRlZCBhcnJheXMuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWVdIFRoZSBpdGVyYXRlZSBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGR1cGxpY2F0ZSBmcmVlIGFycmF5LgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnNvcnRlZFVuaXFCeShbMS4xLCAxLjIsIDIuMywgMi40XSwgTWF0aC5mbG9vcik7CiAgICogLy8gPT4gWzEuMSwgMi4zXQogICAqLwogIGZ1bmN0aW9uIHNvcnRlZFVuaXFCeShhcnJheSwgaXRlcmF0ZWUpIHsKICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKQogICAgICA/IGJhc2VTb3J0ZWRVbmlxKGFycmF5LCBnZXRJdGVyYXRlZShpdGVyYXRlZSwgMikpCiAgICAgIDogW107CiAgfQoKICAvKioKICAgKiBHZXRzIGFsbCBidXQgdGhlIGZpcnN0IGVsZW1lbnQgb2YgYGFycmF5YC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHNsaWNlIG9mIGBhcnJheWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8udGFpbChbMSwgMiwgM10pOwogICAqIC8vID0+IFsyLCAzXQogICAqLwogIGZ1bmN0aW9uIHRhaWwoYXJyYXkpIHsKICAgIHZhciBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDsKICAgIHJldHVybiBsZW5ndGggPyBiYXNlU2xpY2UoYXJyYXksIDEsIGxlbmd0aCkgOiBbXTsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBzbGljZSBvZiBgYXJyYXlgIHdpdGggYG5gIGVsZW1lbnRzIHRha2VuIGZyb20gdGhlIGJlZ2lubmluZy4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS4KICAgKiBAcGFyYW0ge251bWJlcn0gW249MV0gVGhlIG51bWJlciBvZiBlbGVtZW50cyB0byB0YWtlLgogICAqIEBwYXJhbS0ge09iamVjdH0gW2d1YXJkXSBFbmFibGVzIHVzZSBhcyBhbiBpdGVyYXRlZSBmb3IgbWV0aG9kcyBsaWtlIGBfLm1hcGAuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnRha2UoWzEsIDIsIDNdKTsKICAgKiAvLyA9PiBbMV0KICAgKgogICAqIF8udGFrZShbMSwgMiwgM10sIDIpOwogICAqIC8vID0+IFsxLCAyXQogICAqCiAgICogXy50YWtlKFsxLCAyLCAzXSwgNSk7CiAgICogLy8gPT4gWzEsIDIsIDNdCiAgICoKICAgKiBfLnRha2UoWzEsIDIsIDNdLCAwKTsKICAgKiAvLyA9PiBbXQogICAqLwogIGZ1bmN0aW9uIHRha2UoYXJyYXksIG4sIGd1YXJkKSB7CiAgICBpZiAoIShhcnJheSAmJiBhcnJheS5sZW5ndGgpKSB7CiAgICAgIHJldHVybiBbXTsKICAgIH0KICAgIG4gPSAoZ3VhcmQgfHwgbiA9PT0gdW5kZWZpbmVkKSA/IDEgOiB0b0ludGVnZXIobik7CiAgICByZXR1cm4gYmFzZVNsaWNlKGFycmF5LCAwLCBuIDwgMCA/IDAgOiBuKTsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBzbGljZSBvZiBgYXJyYXlgIHdpdGggYG5gIGVsZW1lbnRzIHRha2VuIGZyb20gdGhlIGVuZC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS4KICAgKiBAcGFyYW0ge251bWJlcn0gW249MV0gVGhlIG51bWJlciBvZiBlbGVtZW50cyB0byB0YWtlLgogICAqIEBwYXJhbS0ge09iamVjdH0gW2d1YXJkXSBFbmFibGVzIHVzZSBhcyBhbiBpdGVyYXRlZSBmb3IgbWV0aG9kcyBsaWtlIGBfLm1hcGAuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnRha2VSaWdodChbMSwgMiwgM10pOwogICAqIC8vID0+IFszXQogICAqCiAgICogXy50YWtlUmlnaHQoWzEsIDIsIDNdLCAyKTsKICAgKiAvLyA9PiBbMiwgM10KICAgKgogICAqIF8udGFrZVJpZ2h0KFsxLCAyLCAzXSwgNSk7CiAgICogLy8gPT4gWzEsIDIsIDNdCiAgICoKICAgKiBfLnRha2VSaWdodChbMSwgMiwgM10sIDApOwogICAqIC8vID0+IFtdCiAgICovCiAgZnVuY3Rpb24gdGFrZVJpZ2h0KGFycmF5LCBuLCBndWFyZCkgewogICAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoOwogICAgaWYgKCFsZW5ndGgpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfQogICAgbiA9IChndWFyZCB8fCBuID09PSB1bmRlZmluZWQpID8gMSA6IHRvSW50ZWdlcihuKTsKICAgIG4gPSBsZW5ndGggLSBuOwogICAgcmV0dXJuIGJhc2VTbGljZShhcnJheSwgbiA8IDAgPyAwIDogbiwgbGVuZ3RoKTsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBzbGljZSBvZiBgYXJyYXlgIHdpdGggZWxlbWVudHMgdGFrZW4gZnJvbSB0aGUgZW5kLiBFbGVtZW50cyBhcmUKICAgKiB0YWtlbiB1bnRpbCBgcHJlZGljYXRlYCByZXR1cm5zIGZhbHNleS4gVGhlIHByZWRpY2F0ZSBpcyBpbnZva2VkIHdpdGgKICAgKiB0aHJlZSBhcmd1bWVudHM6ICh2YWx1ZSwgaW5kZXgsIGFycmF5KS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbcHJlZGljYXRlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgdXNlcnMgPSBbCiAgICogICB7ICd1c2VyJzogJ2Jhcm5leScsICAnYWN0aXZlJzogdHJ1ZSB9LAogICAqICAgeyAndXNlcic6ICdmcmVkJywgICAgJ2FjdGl2ZSc6IGZhbHNlIH0sCiAgICogICB7ICd1c2VyJzogJ3BlYmJsZXMnLCAnYWN0aXZlJzogZmFsc2UgfQogICAqIF07CiAgICoKICAgKiBfLnRha2VSaWdodFdoaWxlKHVzZXJzLCBmdW5jdGlvbihvKSB7IHJldHVybiAhby5hY3RpdmU7IH0pOwogICAqIC8vID0+IG9iamVjdHMgZm9yIFsnZnJlZCcsICdwZWJibGVzJ10KICAgKgogICAqIC8vIFRoZSBgXy5tYXRjaGVzYCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy50YWtlUmlnaHRXaGlsZSh1c2VycywgeyAndXNlcic6ICdwZWJibGVzJywgJ2FjdGl2ZSc6IGZhbHNlIH0pOwogICAqIC8vID0+IG9iamVjdHMgZm9yIFsncGViYmxlcyddCiAgICoKICAgKiAvLyBUaGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy50YWtlUmlnaHRXaGlsZSh1c2VycywgWydhY3RpdmUnLCBmYWxzZV0pOwogICAqIC8vID0+IG9iamVjdHMgZm9yIFsnZnJlZCcsICdwZWJibGVzJ10KICAgKgogICAqIC8vIFRoZSBgXy5wcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLgogICAqIF8udGFrZVJpZ2h0V2hpbGUodXNlcnMsICdhY3RpdmUnKTsKICAgKiAvLyA9PiBbXQogICAqLwogIGZ1bmN0aW9uIHRha2VSaWdodFdoaWxlKGFycmF5LCBwcmVkaWNhdGUpIHsKICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKQogICAgICA/IGJhc2VXaGlsZShhcnJheSwgZ2V0SXRlcmF0ZWUocHJlZGljYXRlLCAzKSwgZmFsc2UsIHRydWUpCiAgICAgIDogW107CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgc2xpY2Ugb2YgYGFycmF5YCB3aXRoIGVsZW1lbnRzIHRha2VuIGZyb20gdGhlIGJlZ2lubmluZy4gRWxlbWVudHMKICAgKiBhcmUgdGFrZW4gdW50aWwgYHByZWRpY2F0ZWAgcmV0dXJucyBmYWxzZXkuIFRoZSBwcmVkaWNhdGUgaXMgaW52b2tlZCB3aXRoCiAgICogdGhyZWUgYXJndW1lbnRzOiAodmFsdWUsIGluZGV4LCBhcnJheSkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMy4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcXVlcnkuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3ByZWRpY2F0ZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgc2xpY2Ugb2YgYGFycmF5YC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIHVzZXJzID0gWwogICAqICAgeyAndXNlcic6ICdiYXJuZXknLCAgJ2FjdGl2ZSc6IGZhbHNlIH0sCiAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICAnYWN0aXZlJzogZmFsc2UgfSwKICAgKiAgIHsgJ3VzZXInOiAncGViYmxlcycsICdhY3RpdmUnOiB0cnVlIH0KICAgKiBdOwogICAqCiAgICogXy50YWtlV2hpbGUodXNlcnMsIGZ1bmN0aW9uKG8pIHsgcmV0dXJuICFvLmFjdGl2ZTsgfSk7CiAgICogLy8gPT4gb2JqZWN0cyBmb3IgWydiYXJuZXknLCAnZnJlZCddCiAgICoKICAgKiAvLyBUaGUgYF8ubWF0Y2hlc2AgaXRlcmF0ZWUgc2hvcnRoYW5kLgogICAqIF8udGFrZVdoaWxlKHVzZXJzLCB7ICd1c2VyJzogJ2Jhcm5leScsICdhY3RpdmUnOiBmYWxzZSB9KTsKICAgKiAvLyA9PiBvYmplY3RzIGZvciBbJ2Jhcm5leSddCiAgICoKICAgKiAvLyBUaGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy50YWtlV2hpbGUodXNlcnMsIFsnYWN0aXZlJywgZmFsc2VdKTsKICAgKiAvLyA9PiBvYmplY3RzIGZvciBbJ2Jhcm5leScsICdmcmVkJ10KICAgKgogICAqIC8vIFRoZSBgXy5wcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLgogICAqIF8udGFrZVdoaWxlKHVzZXJzLCAnYWN0aXZlJyk7CiAgICogLy8gPT4gW10KICAgKi8KICBmdW5jdGlvbiB0YWtlV2hpbGUoYXJyYXksIHByZWRpY2F0ZSkgewogICAgcmV0dXJuIChhcnJheSAmJiBhcnJheS5sZW5ndGgpCiAgICAgID8gYmFzZVdoaWxlKGFycmF5LCBnZXRJdGVyYXRlZShwcmVkaWNhdGUsIDMpKQogICAgICA6IFtdOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB1bmlxdWUgdmFsdWVzLCBpbiBvcmRlciwgZnJvbSBhbGwgZ2l2ZW4gYXJyYXlzIHVzaW5nCiAgICogW2BTYW1lVmFsdWVaZXJvYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtc2FtZXZhbHVlemVybykKICAgKiBmb3IgZXF1YWxpdHkgY29tcGFyaXNvbnMuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0gey4uLkFycmF5fSBbYXJyYXlzXSBUaGUgYXJyYXlzIHRvIGluc3BlY3QuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2YgY29tYmluZWQgdmFsdWVzLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnVuaW9uKFsyXSwgWzEsIDJdKTsKICAgKiAvLyA9PiBbMiwgMV0KICAgKi8KICB2YXIgdW5pb24gPSBiYXNlUmVzdChmdW5jdGlvbihhcnJheXMpIHsKICAgIHJldHVybiBiYXNlVW5pcShiYXNlRmxhdHRlbihhcnJheXMsIDEsIGlzQXJyYXlMaWtlT2JqZWN0LCB0cnVlKSk7CiAgfSk7CgogIC8qKgogICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8udW5pb25gIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGl0ZXJhdGVlYCB3aGljaCBpcwogICAqIGludm9rZWQgZm9yIGVhY2ggZWxlbWVudCBvZiBlYWNoIGBhcnJheXNgIHRvIGdlbmVyYXRlIHRoZSBjcml0ZXJpb24gYnkKICAgKiB3aGljaCB1bmlxdWVuZXNzIGlzIGNvbXB1dGVkLiBSZXN1bHQgdmFsdWVzIGFyZSBjaG9zZW4gZnJvbSB0aGUgZmlyc3QKICAgKiBhcnJheSBpbiB3aGljaCB0aGUgdmFsdWUgb2NjdXJzLiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZCB3aXRoIG9uZSBhcmd1bWVudDoKICAgKiAodmFsdWUpLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHsuLi5BcnJheX0gW2FycmF5c10gVGhlIGFycmF5cyB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBjb21iaW5lZCB2YWx1ZXMuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8udW5pb25CeShbMi4xXSwgWzEuMiwgMi4zXSwgTWF0aC5mbG9vcik7CiAgICogLy8gPT4gWzIuMSwgMS4yXQogICAqCiAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy51bmlvbkJ5KFt7ICd4JzogMSB9XSwgW3sgJ3gnOiAyIH0sIHsgJ3gnOiAxIH1dLCAneCcpOwogICAqIC8vID0+IFt7ICd4JzogMSB9LCB7ICd4JzogMiB9XQogICAqLwogIHZhciB1bmlvbkJ5ID0gYmFzZVJlc3QoZnVuY3Rpb24oYXJyYXlzKSB7CiAgICB2YXIgaXRlcmF0ZWUgPSBsYXN0KGFycmF5cyk7CiAgICBpZiAoaXNBcnJheUxpa2VPYmplY3QoaXRlcmF0ZWUpKSB7CiAgICAgIGl0ZXJhdGVlID0gdW5kZWZpbmVkOwogICAgfQogICAgcmV0dXJuIGJhc2VVbmlxKGJhc2VGbGF0dGVuKGFycmF5cywgMSwgaXNBcnJheUxpa2VPYmplY3QsIHRydWUpLCBnZXRJdGVyYXRlZShpdGVyYXRlZSwgMikpOwogIH0pOwoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnVuaW9uYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGBjb21wYXJhdG9yYCB3aGljaAogICAqIGlzIGludm9rZWQgdG8gY29tcGFyZSBlbGVtZW50cyBvZiBgYXJyYXlzYC4gUmVzdWx0IHZhbHVlcyBhcmUgY2hvc2VuIGZyb20KICAgKiB0aGUgZmlyc3QgYXJyYXkgaW4gd2hpY2ggdGhlIHZhbHVlIG9jY3Vycy4gVGhlIGNvbXBhcmF0b3IgaXMgaW52b2tlZAogICAqIHdpdGggdHdvIGFyZ3VtZW50czogKGFyclZhbCwgb3RoVmFsKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7Li4uQXJyYXl9IFthcnJheXNdIFRoZSBhcnJheXMgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY29tcGFyYXRvcl0gVGhlIGNvbXBhcmF0b3IgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBjb21iaW5lZCB2YWx1ZXMuCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBvYmplY3RzID0gW3sgJ3gnOiAxLCAneSc6IDIgfSwgeyAneCc6IDIsICd5JzogMSB9XTsKICAgKiB2YXIgb3RoZXJzID0gW3sgJ3gnOiAxLCAneSc6IDEgfSwgeyAneCc6IDEsICd5JzogMiB9XTsKICAgKgogICAqIF8udW5pb25XaXRoKG9iamVjdHMsIG90aGVycywgXy5pc0VxdWFsKTsKICAgKiAvLyA9PiBbeyAneCc6IDEsICd5JzogMiB9LCB7ICd4JzogMiwgJ3knOiAxIH0sIHsgJ3gnOiAxLCAneSc6IDEgfV0KICAgKi8KICB2YXIgdW5pb25XaXRoID0gYmFzZVJlc3QoZnVuY3Rpb24oYXJyYXlzKSB7CiAgICB2YXIgY29tcGFyYXRvciA9IGxhc3QoYXJyYXlzKTsKICAgIGNvbXBhcmF0b3IgPSB0eXBlb2YgY29tcGFyYXRvciA9PSAnZnVuY3Rpb24nID8gY29tcGFyYXRvciA6IHVuZGVmaW5lZDsKICAgIHJldHVybiBiYXNlVW5pcShiYXNlRmxhdHRlbihhcnJheXMsIDEsIGlzQXJyYXlMaWtlT2JqZWN0LCB0cnVlKSwgdW5kZWZpbmVkLCBjb21wYXJhdG9yKTsKICB9KTsKCiAgLyoqCiAgICogQ3JlYXRlcyBhIGR1cGxpY2F0ZS1mcmVlIHZlcnNpb24gb2YgYW4gYXJyYXksIHVzaW5nCiAgICogW2BTYW1lVmFsdWVaZXJvYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtc2FtZXZhbHVlemVybykKICAgKiBmb3IgZXF1YWxpdHkgY29tcGFyaXNvbnMsIGluIHdoaWNoIG9ubHkgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgZWFjaCBlbGVtZW50CiAgICogaXMga2VwdC4gVGhlIG9yZGVyIG9mIHJlc3VsdCB2YWx1ZXMgaXMgZGV0ZXJtaW5lZCBieSB0aGUgb3JkZXIgdGhleSBvY2N1cgogICAqIGluIHRoZSBhcnJheS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGR1cGxpY2F0ZSBmcmVlIGFycmF5LgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnVuaXEoWzIsIDEsIDJdKTsKICAgKiAvLyA9PiBbMiwgMV0KICAgKi8KICBmdW5jdGlvbiB1bmlxKGFycmF5KSB7CiAgICByZXR1cm4gKGFycmF5ICYmIGFycmF5Lmxlbmd0aCkgPyBiYXNlVW5pcShhcnJheSkgOiBbXTsKICB9CgogIC8qKgogICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8udW5pcWAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgaXRlcmF0ZWVgIHdoaWNoIGlzCiAgICogaW52b2tlZCBmb3IgZWFjaCBlbGVtZW50IGluIGBhcnJheWAgdG8gZ2VuZXJhdGUgdGhlIGNyaXRlcmlvbiBieSB3aGljaAogICAqIHVuaXF1ZW5lc3MgaXMgY29tcHV0ZWQuIFRoZSBvcmRlciBvZiByZXN1bHQgdmFsdWVzIGlzIGRldGVybWluZWQgYnkgdGhlCiAgICogb3JkZXIgdGhleSBvY2N1ciBpbiB0aGUgYXJyYXkuIFRoZSBpdGVyYXRlZSBpcyBpbnZva2VkIHdpdGggb25lIGFyZ3VtZW50OgogICAqICh2YWx1ZSkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGl0ZXJhdGVlIGludm9rZWQgcGVyIGVsZW1lbnQuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgZHVwbGljYXRlIGZyZWUgYXJyYXkuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8udW5pcUJ5KFsyLjEsIDEuMiwgMi4zXSwgTWF0aC5mbG9vcik7CiAgICogLy8gPT4gWzIuMSwgMS4yXQogICAqCiAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy51bmlxQnkoW3sgJ3gnOiAxIH0sIHsgJ3gnOiAyIH0sIHsgJ3gnOiAxIH1dLCAneCcpOwogICAqIC8vID0+IFt7ICd4JzogMSB9LCB7ICd4JzogMiB9XQogICAqLwogIGZ1bmN0aW9uIHVuaXFCeShhcnJheSwgaXRlcmF0ZWUpIHsKICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKSA/IGJhc2VVbmlxKGFycmF5LCBnZXRJdGVyYXRlZShpdGVyYXRlZSwgMikpIDogW107CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnVuaXFgIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGNvbXBhcmF0b3JgIHdoaWNoCiAgICogaXMgaW52b2tlZCB0byBjb21wYXJlIGVsZW1lbnRzIG9mIGBhcnJheWAuIFRoZSBvcmRlciBvZiByZXN1bHQgdmFsdWVzIGlzCiAgICogZGV0ZXJtaW5lZCBieSB0aGUgb3JkZXIgdGhleSBvY2N1ciBpbiB0aGUgYXJyYXkuVGhlIGNvbXBhcmF0b3IgaXMgaW52b2tlZAogICAqIHdpdGggdHdvIGFyZ3VtZW50czogKGFyclZhbCwgb3RoVmFsKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjb21wYXJhdG9yXSBUaGUgY29tcGFyYXRvciBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGR1cGxpY2F0ZSBmcmVlIGFycmF5LgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgb2JqZWN0cyA9IFt7ICd4JzogMSwgJ3knOiAyIH0sIHsgJ3gnOiAyLCAneSc6IDEgfSwgeyAneCc6IDEsICd5JzogMiB9XTsKICAgKgogICAqIF8udW5pcVdpdGgob2JqZWN0cywgXy5pc0VxdWFsKTsKICAgKiAvLyA9PiBbeyAneCc6IDEsICd5JzogMiB9LCB7ICd4JzogMiwgJ3knOiAxIH1dCiAgICovCiAgZnVuY3Rpb24gdW5pcVdpdGgoYXJyYXksIGNvbXBhcmF0b3IpIHsKICAgIGNvbXBhcmF0b3IgPSB0eXBlb2YgY29tcGFyYXRvciA9PSAnZnVuY3Rpb24nID8gY29tcGFyYXRvciA6IHVuZGVmaW5lZDsKICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKSA/IGJhc2VVbmlxKGFycmF5LCB1bmRlZmluZWQsIGNvbXBhcmF0b3IpIDogW107CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnppcGAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBhbiBhcnJheSBvZiBncm91cGVkCiAgICogZWxlbWVudHMgYW5kIGNyZWF0ZXMgYW4gYXJyYXkgcmVncm91cGluZyB0aGUgZWxlbWVudHMgdG8gdGhlaXIgcHJlLXppcAogICAqIGNvbmZpZ3VyYXRpb24uCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMS4yLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgb2YgZ3JvdXBlZCBlbGVtZW50cyB0byBwcm9jZXNzLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIHJlZ3JvdXBlZCBlbGVtZW50cy4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIHppcHBlZCA9IF8uemlwKFsnYScsICdiJ10sIFsxLCAyXSwgW3RydWUsIGZhbHNlXSk7CiAgICogLy8gPT4gW1snYScsIDEsIHRydWVdLCBbJ2InLCAyLCBmYWxzZV1dCiAgICoKICAgKiBfLnVuemlwKHppcHBlZCk7CiAgICogLy8gPT4gW1snYScsICdiJ10sIFsxLCAyXSwgW3RydWUsIGZhbHNlXV0KICAgKi8KICBmdW5jdGlvbiB1bnppcChhcnJheSkgewogICAgaWYgKCEoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKSkgewogICAgICByZXR1cm4gW107CiAgICB9CiAgICB2YXIgbGVuZ3RoID0gMDsKICAgIGFycmF5ID0gYXJyYXlGaWx0ZXIoYXJyYXksIGZ1bmN0aW9uKGdyb3VwKSB7CiAgICAgIGlmIChpc0FycmF5TGlrZU9iamVjdChncm91cCkpIHsKICAgICAgICBsZW5ndGggPSBuYXRpdmVNYXgoZ3JvdXAubGVuZ3RoLCBsZW5ndGgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBiYXNlVGltZXMobGVuZ3RoLCBmdW5jdGlvbihpbmRleCkgewogICAgICByZXR1cm4gYXJyYXlNYXAoYXJyYXksIGJhc2VQcm9wZXJ0eShpbmRleCkpOwogICAgfSk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnVuemlwYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGBpdGVyYXRlZWAgdG8gc3BlY2lmeQogICAqIGhvdyByZWdyb3VwZWQgdmFsdWVzIHNob3VsZCBiZSBjb21iaW5lZC4gVGhlIGl0ZXJhdGVlIGlzIGludm9rZWQgd2l0aCB0aGUKICAgKiBlbGVtZW50cyBvZiBlYWNoIGdyb3VwOiAoLi4uZ3JvdXApLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDMuOC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IG9mIGdyb3VwZWQgZWxlbWVudHMgdG8gcHJvY2Vzcy4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIHRvIGNvbWJpbmUKICAgKiAgcmVncm91cGVkIHZhbHVlcy4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiByZWdyb3VwZWQgZWxlbWVudHMuCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciB6aXBwZWQgPSBfLnppcChbMSwgMl0sIFsxMCwgMjBdLCBbMTAwLCAyMDBdKTsKICAgKiAvLyA9PiBbWzEsIDEwLCAxMDBdLCBbMiwgMjAsIDIwMF1dCiAgICoKICAgKiBfLnVuemlwV2l0aCh6aXBwZWQsIF8uYWRkKTsKICAgKiAvLyA9PiBbMywgMzAsIDMwMF0KICAgKi8KICBmdW5jdGlvbiB1bnppcFdpdGgoYXJyYXksIGl0ZXJhdGVlKSB7CiAgICBpZiAoIShhcnJheSAmJiBhcnJheS5sZW5ndGgpKSB7CiAgICAgIHJldHVybiBbXTsKICAgIH0KICAgIHZhciByZXN1bHQgPSB1bnppcChhcnJheSk7CiAgICBpZiAoaXRlcmF0ZWUgPT0gbnVsbCkgewogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgcmV0dXJuIGFycmF5TWFwKHJlc3VsdCwgZnVuY3Rpb24oZ3JvdXApIHsKICAgICAgcmV0dXJuIGFwcGx5KGl0ZXJhdGVlLCB1bmRlZmluZWQsIGdyb3VwKTsKICAgIH0pOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBleGNsdWRpbmcgYWxsIGdpdmVuIHZhbHVlcyB1c2luZwogICAqIFtgU2FtZVZhbHVlWmVyb2BdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLXNhbWV2YWx1ZXplcm8pCiAgICogZm9yIGVxdWFsaXR5IGNvbXBhcmlzb25zLgogICAqCiAgICogKipOb3RlOioqIFVubGlrZSBgXy5wdWxsYCwgdGhpcyBtZXRob2QgcmV0dXJucyBhIG5ldyBhcnJheS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7Li4uKn0gW3ZhbHVlc10gVGhlIHZhbHVlcyB0byBleGNsdWRlLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIGZpbHRlcmVkIHZhbHVlcy4KICAgKiBAc2VlIF8uZGlmZmVyZW5jZSwgXy54b3IKICAgKiBAZXhhbXBsZQogICAqCiAgICogXy53aXRob3V0KFsyLCAxLCAyLCAzXSwgMSwgMik7CiAgICogLy8gPT4gWzNdCiAgICovCiAgdmFyIHdpdGhvdXQgPSBiYXNlUmVzdChmdW5jdGlvbihhcnJheSwgdmFsdWVzKSB7CiAgICByZXR1cm4gaXNBcnJheUxpa2VPYmplY3QoYXJyYXkpCiAgICAgID8gYmFzZURpZmZlcmVuY2UoYXJyYXksIHZhbHVlcykKICAgICAgOiBbXTsKICB9KTsKCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB1bmlxdWUgdmFsdWVzIHRoYXQgaXMgdGhlCiAgICogW3N5bW1ldHJpYyBkaWZmZXJlbmNlXShodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9TeW1tZXRyaWNfZGlmZmVyZW5jZSkKICAgKiBvZiB0aGUgZ2l2ZW4gYXJyYXlzLiBUaGUgb3JkZXIgb2YgcmVzdWx0IHZhbHVlcyBpcyBkZXRlcm1pbmVkIGJ5IHRoZSBvcmRlcgogICAqIHRoZXkgb2NjdXIgaW4gdGhlIGFycmF5cy4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAyLjQuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7Li4uQXJyYXl9IFthcnJheXNdIFRoZSBhcnJheXMgdG8gaW5zcGVjdC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBmaWx0ZXJlZCB2YWx1ZXMuCiAgICogQHNlZSBfLmRpZmZlcmVuY2UsIF8ud2l0aG91dAogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnhvcihbMiwgMV0sIFsyLCAzXSk7CiAgICogLy8gPT4gWzEsIDNdCiAgICovCiAgdmFyIHhvciA9IGJhc2VSZXN0KGZ1bmN0aW9uKGFycmF5cykgewogICAgcmV0dXJuIGJhc2VYb3IoYXJyYXlGaWx0ZXIoYXJyYXlzLCBpc0FycmF5TGlrZU9iamVjdCkpOwogIH0pOwoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnhvcmAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgaXRlcmF0ZWVgIHdoaWNoIGlzCiAgICogaW52b2tlZCBmb3IgZWFjaCBlbGVtZW50IG9mIGVhY2ggYGFycmF5c2AgdG8gZ2VuZXJhdGUgdGhlIGNyaXRlcmlvbiBieQogICAqIHdoaWNoIGJ5IHdoaWNoIHRoZXkncmUgY29tcGFyZWQuIFRoZSBvcmRlciBvZiByZXN1bHQgdmFsdWVzIGlzIGRldGVybWluZWQKICAgKiBieSB0aGUgb3JkZXIgdGhleSBvY2N1ciBpbiB0aGUgYXJyYXlzLiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZCB3aXRoIG9uZQogICAqIGFyZ3VtZW50OiAodmFsdWUpLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHsuLi5BcnJheX0gW2FycmF5c10gVGhlIGFycmF5cyB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBmaWx0ZXJlZCB2YWx1ZXMuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8ueG9yQnkoWzIuMSwgMS4yXSwgWzIuMywgMy40XSwgTWF0aC5mbG9vcik7CiAgICogLy8gPT4gWzEuMiwgMy40XQogICAqCiAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy54b3JCeShbeyAneCc6IDEgfV0sIFt7ICd4JzogMiB9LCB7ICd4JzogMSB9XSwgJ3gnKTsKICAgKiAvLyA9PiBbeyAneCc6IDIgfV0KICAgKi8KICB2YXIgeG9yQnkgPSBiYXNlUmVzdChmdW5jdGlvbihhcnJheXMpIHsKICAgIHZhciBpdGVyYXRlZSA9IGxhc3QoYXJyYXlzKTsKICAgIGlmIChpc0FycmF5TGlrZU9iamVjdChpdGVyYXRlZSkpIHsKICAgICAgaXRlcmF0ZWUgPSB1bmRlZmluZWQ7CiAgICB9CiAgICByZXR1cm4gYmFzZVhvcihhcnJheUZpbHRlcihhcnJheXMsIGlzQXJyYXlMaWtlT2JqZWN0KSwgZ2V0SXRlcmF0ZWUoaXRlcmF0ZWUsIDIpKTsKICB9KTsKCiAgLyoqCiAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy54b3JgIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGNvbXBhcmF0b3JgIHdoaWNoIGlzCiAgICogaW52b2tlZCB0byBjb21wYXJlIGVsZW1lbnRzIG9mIGBhcnJheXNgLiBUaGUgb3JkZXIgb2YgcmVzdWx0IHZhbHVlcyBpcwogICAqIGRldGVybWluZWQgYnkgdGhlIG9yZGVyIHRoZXkgb2NjdXIgaW4gdGhlIGFycmF5cy4gVGhlIGNvbXBhcmF0b3IgaXMgaW52b2tlZAogICAqIHdpdGggdHdvIGFyZ3VtZW50czogKGFyclZhbCwgb3RoVmFsKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7Li4uQXJyYXl9IFthcnJheXNdIFRoZSBhcnJheXMgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY29tcGFyYXRvcl0gVGhlIGNvbXBhcmF0b3IgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBmaWx0ZXJlZCB2YWx1ZXMuCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBvYmplY3RzID0gW3sgJ3gnOiAxLCAneSc6IDIgfSwgeyAneCc6IDIsICd5JzogMSB9XTsKICAgKiB2YXIgb3RoZXJzID0gW3sgJ3gnOiAxLCAneSc6IDEgfSwgeyAneCc6IDEsICd5JzogMiB9XTsKICAgKgogICAqIF8ueG9yV2l0aChvYmplY3RzLCBvdGhlcnMsIF8uaXNFcXVhbCk7CiAgICogLy8gPT4gW3sgJ3gnOiAyLCAneSc6IDEgfSwgeyAneCc6IDEsICd5JzogMSB9XQogICAqLwogIHZhciB4b3JXaXRoID0gYmFzZVJlc3QoZnVuY3Rpb24oYXJyYXlzKSB7CiAgICB2YXIgY29tcGFyYXRvciA9IGxhc3QoYXJyYXlzKTsKICAgIGNvbXBhcmF0b3IgPSB0eXBlb2YgY29tcGFyYXRvciA9PSAnZnVuY3Rpb24nID8gY29tcGFyYXRvciA6IHVuZGVmaW5lZDsKICAgIHJldHVybiBiYXNlWG9yKGFycmF5RmlsdGVyKGFycmF5cywgaXNBcnJheUxpa2VPYmplY3QpLCB1bmRlZmluZWQsIGNvbXBhcmF0b3IpOwogIH0pOwoKICAvKioKICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIGdyb3VwZWQgZWxlbWVudHMsIHRoZSBmaXJzdCBvZiB3aGljaCBjb250YWlucyB0aGUKICAgKiBmaXJzdCBlbGVtZW50cyBvZiB0aGUgZ2l2ZW4gYXJyYXlzLCB0aGUgc2Vjb25kIG9mIHdoaWNoIGNvbnRhaW5zIHRoZQogICAqIHNlY29uZCBlbGVtZW50cyBvZiB0aGUgZ2l2ZW4gYXJyYXlzLCBhbmQgc28gb24uCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0gey4uLkFycmF5fSBbYXJyYXlzXSBUaGUgYXJyYXlzIHRvIHByb2Nlc3MuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2YgZ3JvdXBlZCBlbGVtZW50cy4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy56aXAoWydhJywgJ2InXSwgWzEsIDJdLCBbdHJ1ZSwgZmFsc2VdKTsKICAgKiAvLyA9PiBbWydhJywgMSwgdHJ1ZV0sIFsnYicsIDIsIGZhbHNlXV0KICAgKi8KICB2YXIgemlwID0gYmFzZVJlc3QodW56aXApOwoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmZyb21QYWlyc2AgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyB0d28gYXJyYXlzLAogICAqIG9uZSBvZiBwcm9wZXJ0eSBpZGVudGlmaWVycyBhbmQgb25lIG9mIGNvcnJlc3BvbmRpbmcgdmFsdWVzLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDAuNC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gW3Byb3BzPVtdXSBUaGUgcHJvcGVydHkgaWRlbnRpZmllcnMuCiAgICogQHBhcmFtIHtBcnJheX0gW3ZhbHVlcz1bXV0gVGhlIHByb3BlcnR5IHZhbHVlcy4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBuZXcgb2JqZWN0LgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnppcE9iamVjdChbJ2EnLCAnYiddLCBbMSwgMl0pOwogICAqIC8vID0+IHsgJ2EnOiAxLCAnYic6IDIgfQogICAqLwogIGZ1bmN0aW9uIHppcE9iamVjdChwcm9wcywgdmFsdWVzKSB7CiAgICByZXR1cm4gYmFzZVppcE9iamVjdChwcm9wcyB8fCBbXSwgdmFsdWVzIHx8IFtdLCBhc3NpZ25WYWx1ZSk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnppcE9iamVjdGAgZXhjZXB0IHRoYXQgaXQgc3VwcG9ydHMgcHJvcGVydHkgcGF0aHMuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4xLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBbcHJvcHM9W11dIFRoZSBwcm9wZXJ0eSBpZGVudGlmaWVycy4KICAgKiBAcGFyYW0ge0FycmF5fSBbdmFsdWVzPVtdXSBUaGUgcHJvcGVydHkgdmFsdWVzLgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyBvYmplY3QuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uemlwT2JqZWN0RGVlcChbJ2EuYlswXS5jJywgJ2EuYlsxXS5kJ10sIFsxLCAyXSk7CiAgICogLy8gPT4geyAnYSc6IHsgJ2InOiBbeyAnYyc6IDEgfSwgeyAnZCc6IDIgfV0gfSB9CiAgICovCiAgZnVuY3Rpb24gemlwT2JqZWN0RGVlcChwcm9wcywgdmFsdWVzKSB7CiAgICByZXR1cm4gYmFzZVppcE9iamVjdChwcm9wcyB8fCBbXSwgdmFsdWVzIHx8IFtdLCBiYXNlU2V0KTsKICB9CgogIC8qKgogICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uemlwYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGBpdGVyYXRlZWAgdG8gc3BlY2lmeQogICAqIGhvdyBncm91cGVkIHZhbHVlcyBzaG91bGQgYmUgY29tYmluZWQuIFRoZSBpdGVyYXRlZSBpcyBpbnZva2VkIHdpdGggdGhlCiAgICogZWxlbWVudHMgb2YgZWFjaCBncm91cDogKC4uLmdyb3VwKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjguMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7Li4uQXJyYXl9IFthcnJheXNdIFRoZSBhcnJheXMgdG8gcHJvY2Vzcy4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIHRvIGNvbWJpbmUKICAgKiAgZ3JvdXBlZCB2YWx1ZXMuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2YgZ3JvdXBlZCBlbGVtZW50cy4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy56aXBXaXRoKFsxLCAyXSwgWzEwLCAyMF0sIFsxMDAsIDIwMF0sIGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgKiAgIHJldHVybiBhICsgYiArIGM7CiAgICogfSk7CiAgICogLy8gPT4gWzExMSwgMjIyXQogICAqLwogIHZhciB6aXBXaXRoID0gYmFzZVJlc3QoZnVuY3Rpb24oYXJyYXlzKSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXlzLmxlbmd0aCwKICAgICAgICBpdGVyYXRlZSA9IGxlbmd0aCA+IDEgPyBhcnJheXNbbGVuZ3RoIC0gMV0gOiB1bmRlZmluZWQ7CgogICAgaXRlcmF0ZWUgPSB0eXBlb2YgaXRlcmF0ZWUgPT0gJ2Z1bmN0aW9uJyA/IChhcnJheXMucG9wKCksIGl0ZXJhdGVlKSA6IHVuZGVmaW5lZDsKICAgIHJldHVybiB1bnppcFdpdGgoYXJyYXlzLCBpdGVyYXRlZSk7CiAgfSk7CgogIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCiAgLyoqCiAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgbWVtb2l6ZXMgdGhlIHJlc3VsdCBvZiBgZnVuY2AuIElmIGByZXNvbHZlcmAgaXMKICAgKiBwcm92aWRlZCwgaXQgZGV0ZXJtaW5lcyB0aGUgY2FjaGUga2V5IGZvciBzdG9yaW5nIHRoZSByZXN1bHQgYmFzZWQgb24gdGhlCiAgICogYXJndW1lbnRzIHByb3ZpZGVkIHRvIHRoZSBtZW1vaXplZCBmdW5jdGlvbi4gQnkgZGVmYXVsdCwgdGhlIGZpcnN0IGFyZ3VtZW50CiAgICogcHJvdmlkZWQgdG8gdGhlIG1lbW9pemVkIGZ1bmN0aW9uIGlzIHVzZWQgYXMgdGhlIG1hcCBjYWNoZSBrZXkuIFRoZSBgZnVuY2AKICAgKiBpcyBpbnZva2VkIHdpdGggdGhlIGB0aGlzYCBiaW5kaW5nIG9mIHRoZSBtZW1vaXplZCBmdW5jdGlvbi4KICAgKgogICAqICoqTm90ZToqKiBUaGUgY2FjaGUgaXMgZXhwb3NlZCBhcyB0aGUgYGNhY2hlYCBwcm9wZXJ0eSBvbiB0aGUgbWVtb2l6ZWQKICAgKiBmdW5jdGlvbi4gSXRzIGNyZWF0aW9uIG1heSBiZSBjdXN0b21pemVkIGJ5IHJlcGxhY2luZyB0aGUgYF8ubWVtb2l6ZS5DYWNoZWAKICAgKiBjb25zdHJ1Y3RvciB3aXRoIG9uZSB3aG9zZSBpbnN0YW5jZXMgaW1wbGVtZW50IHRoZQogICAqIFtgTWFwYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtcHJvcGVydGllcy1vZi10aGUtbWFwLXByb3RvdHlwZS1vYmplY3QpCiAgICogbWV0aG9kIGludGVyZmFjZSBvZiBgY2xlYXJgLCBgZGVsZXRlYCwgYGdldGAsIGBoYXNgLCBhbmQgYHNldGAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb24KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBoYXZlIGl0cyBvdXRwdXQgbWVtb2l6ZWQuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3Jlc29sdmVyXSBUaGUgZnVuY3Rpb24gdG8gcmVzb2x2ZSB0aGUgY2FjaGUga2V5LgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IG1lbW9pemVkIGZ1bmN0aW9uLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgb2JqZWN0ID0geyAnYSc6IDEsICdiJzogMiB9OwogICAqIHZhciBvdGhlciA9IHsgJ2MnOiAzLCAnZCc6IDQgfTsKICAgKgogICAqIHZhciB2YWx1ZXMgPSBfLm1lbW9pemUoXy52YWx1ZXMpOwogICAqIHZhbHVlcyhvYmplY3QpOwogICAqIC8vID0+IFsxLCAyXQogICAqCiAgICogdmFsdWVzKG90aGVyKTsKICAgKiAvLyA9PiBbMywgNF0KICAgKgogICAqIG9iamVjdC5hID0gMjsKICAgKiB2YWx1ZXMob2JqZWN0KTsKICAgKiAvLyA9PiBbMSwgMl0KICAgKgogICAqIC8vIE1vZGlmeSB0aGUgcmVzdWx0IGNhY2hlLgogICAqIHZhbHVlcy5jYWNoZS5zZXQob2JqZWN0LCBbJ2EnLCAnYiddKTsKICAgKiB2YWx1ZXMob2JqZWN0KTsKICAgKiAvLyA9PiBbJ2EnLCAnYiddCiAgICoKICAgKiAvLyBSZXBsYWNlIGBfLm1lbW9pemUuQ2FjaGVgLgogICAqIF8ubWVtb2l6ZS5DYWNoZSA9IFdlYWtNYXA7CiAgICovCiAgZnVuY3Rpb24gbWVtb2l6ZShmdW5jLCByZXNvbHZlcikgewogICAgaWYgKHR5cGVvZiBmdW5jICE9ICdmdW5jdGlvbicgfHwgKHJlc29sdmVyICE9IG51bGwgJiYgdHlwZW9mIHJlc29sdmVyICE9ICdmdW5jdGlvbicpKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoRlVOQ19FUlJPUl9URVhUKTsKICAgIH0KICAgIHZhciBtZW1vaXplZCA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cywKICAgICAgICAgIGtleSA9IHJlc29sdmVyID8gcmVzb2x2ZXIuYXBwbHkodGhpcywgYXJncykgOiBhcmdzWzBdLAogICAgICAgICAgY2FjaGUgPSBtZW1vaXplZC5jYWNoZTsKCiAgICAgIGlmIChjYWNoZS5oYXMoa2V5KSkgewogICAgICAgIHJldHVybiBjYWNoZS5nZXQoa2V5KTsKICAgICAgfQogICAgICB2YXIgcmVzdWx0ID0gZnVuYy5hcHBseSh0aGlzLCBhcmdzKTsKICAgICAgbWVtb2l6ZWQuY2FjaGUgPSBjYWNoZS5zZXQoa2V5LCByZXN1bHQpIHx8IGNhY2hlOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICAgIG1lbW9pemVkLmNhY2hlID0gbmV3IChtZW1vaXplLkNhY2hlIHx8IE1hcENhY2hlKTsKICAgIHJldHVybiBtZW1vaXplZDsKICB9CgogIC8vIEV4cG9zZSBgTWFwQ2FjaGVgLgogIG1lbW9pemUuQ2FjaGUgPSBNYXBDYWNoZTsKCiAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKICAvKioKICAgKiBDYXN0cyBgdmFsdWVgIGFzIGFuIGFycmF5IGlmIGl0J3Mgbm90IG9uZS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjQuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gaW5zcGVjdC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGNhc3QgYXJyYXkuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uY2FzdEFycmF5KDEpOwogICAqIC8vID0+IFsxXQogICAqCiAgICogXy5jYXN0QXJyYXkoeyAnYSc6IDEgfSk7CiAgICogLy8gPT4gW3sgJ2EnOiAxIH1dCiAgICoKICAgKiBfLmNhc3RBcnJheSgnYWJjJyk7CiAgICogLy8gPT4gWydhYmMnXQogICAqCiAgICogXy5jYXN0QXJyYXkobnVsbCk7CiAgICogLy8gPT4gW251bGxdCiAgICoKICAgKiBfLmNhc3RBcnJheSh1bmRlZmluZWQpOwogICAqIC8vID0+IFt1bmRlZmluZWRdCiAgICoKICAgKiBfLmNhc3RBcnJheSgpOwogICAqIC8vID0+IFtdCiAgICoKICAgKiB2YXIgYXJyYXkgPSBbMSwgMiwgM107CiAgICogY29uc29sZS5sb2coXy5jYXN0QXJyYXkoYXJyYXkpID09PSBhcnJheSk7CiAgICogLy8gPT4gdHJ1ZQogICAqLwogIGZ1bmN0aW9uIGNhc3RBcnJheSgpIHsKICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgewogICAgICByZXR1cm4gW107CiAgICB9CiAgICB2YXIgdmFsdWUgPSBhcmd1bWVudHNbMF07CiAgICByZXR1cm4gaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZSA6IFt2YWx1ZV07CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgc2hhbGxvdyBjbG9uZSBvZiBgdmFsdWVgLgogICAqCiAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIGxvb3NlbHkgYmFzZWQgb24gdGhlCiAgICogW3N0cnVjdHVyZWQgY2xvbmUgYWxnb3JpdGhtXShodHRwczovL21kbi5pby9TdHJ1Y3R1cmVkX2Nsb25lX2FsZ29yaXRobSkKICAgKiBhbmQgc3VwcG9ydHMgY2xvbmluZyBhcnJheXMsIGFycmF5IGJ1ZmZlcnMsIGJvb2xlYW5zLCBkYXRlIG9iamVjdHMsIG1hcHMsCiAgICogbnVtYmVycywgYE9iamVjdGAgb2JqZWN0cywgcmVnZXhlcywgc2V0cywgc3RyaW5ncywgc3ltYm9scywgYW5kIHR5cGVkCiAgICogYXJyYXlzLiBUaGUgb3duIGVudW1lcmFibGUgcHJvcGVydGllcyBvZiBgYXJndW1lbnRzYCBvYmplY3RzIGFyZSBjbG9uZWQKICAgKiBhcyBwbGFpbiBvYmplY3RzLiBBbiBlbXB0eSBvYmplY3QgaXMgcmV0dXJuZWQgZm9yIHVuY2xvbmVhYmxlIHZhbHVlcyBzdWNoCiAgICogYXMgZXJyb3Igb2JqZWN0cywgZnVuY3Rpb25zLCBET00gbm9kZXMsIGFuZCBXZWFrTWFwcy4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2xvbmUuCiAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGNsb25lZCB2YWx1ZS4KICAgKiBAc2VlIF8uY2xvbmVEZWVwCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBvYmplY3RzID0gW3sgJ2EnOiAxIH0sIHsgJ2InOiAyIH1dOwogICAqCiAgICogdmFyIHNoYWxsb3cgPSBfLmNsb25lKG9iamVjdHMpOwogICAqIGNvbnNvbGUubG9nKHNoYWxsb3dbMF0gPT09IG9iamVjdHNbMF0pOwogICAqIC8vID0+IHRydWUKICAgKi8KICBmdW5jdGlvbiBjbG9uZSh2YWx1ZSkgewogICAgcmV0dXJuIGJhc2VDbG9uZSh2YWx1ZSwgQ0xPTkVfU1lNQk9MU19GTEFHKTsKICB9CgogIC8qKgogICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uY2xvbmVgIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGN1c3RvbWl6ZXJgIHdoaWNoCiAgICogaXMgaW52b2tlZCB0byBwcm9kdWNlIHRoZSBjbG9uZWQgdmFsdWUuIElmIGBjdXN0b21pemVyYCByZXR1cm5zIGB1bmRlZmluZWRgLAogICAqIGNsb25pbmcgaXMgaGFuZGxlZCBieSB0aGUgbWV0aG9kIGluc3RlYWQuIFRoZSBgY3VzdG9taXplcmAgaXMgaW52b2tlZCB3aXRoCiAgICogdXAgdG8gZm91ciBhcmd1bWVudHM7ICh2YWx1ZSBbLCBpbmRleHxrZXksIG9iamVjdCwgc3RhY2tdKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2xvbmUuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2N1c3RvbWl6ZXJdIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgY2xvbmluZy4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgY2xvbmVkIHZhbHVlLgogICAqIEBzZWUgXy5jbG9uZURlZXBXaXRoCiAgICogQGV4YW1wbGUKICAgKgogICAqIGZ1bmN0aW9uIGN1c3RvbWl6ZXIodmFsdWUpIHsKICAgKiAgIGlmIChfLmlzRWxlbWVudCh2YWx1ZSkpIHsKICAgKiAgICAgcmV0dXJuIHZhbHVlLmNsb25lTm9kZShmYWxzZSk7CiAgICogICB9CiAgICogfQogICAqCiAgICogdmFyIGVsID0gXy5jbG9uZVdpdGgoZG9jdW1lbnQuYm9keSwgY3VzdG9taXplcik7CiAgICoKICAgKiBjb25zb2xlLmxvZyhlbCA9PT0gZG9jdW1lbnQuYm9keSk7CiAgICogLy8gPT4gZmFsc2UKICAgKiBjb25zb2xlLmxvZyhlbC5ub2RlTmFtZSk7CiAgICogLy8gPT4gJ0JPRFknCiAgICogY29uc29sZS5sb2coZWwuY2hpbGROb2Rlcy5sZW5ndGgpOwogICAqIC8vID0+IDAKICAgKi8KICBmdW5jdGlvbiBjbG9uZVdpdGgodmFsdWUsIGN1c3RvbWl6ZXIpIHsKICAgIGN1c3RvbWl6ZXIgPSB0eXBlb2YgY3VzdG9taXplciA9PSAnZnVuY3Rpb24nID8gY3VzdG9taXplciA6IHVuZGVmaW5lZDsKICAgIHJldHVybiBiYXNlQ2xvbmUodmFsdWUsIENMT05FX1NZTUJPTFNfRkxBRywgY3VzdG9taXplcik7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmNsb25lYCBleGNlcHQgdGhhdCBpdCByZWN1cnNpdmVseSBjbG9uZXMgYHZhbHVlYC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAxLjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcmVjdXJzaXZlbHkgY2xvbmUuCiAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGRlZXAgY2xvbmVkIHZhbHVlLgogICAqIEBzZWUgXy5jbG9uZQogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgb2JqZWN0cyA9IFt7ICdhJzogMSB9LCB7ICdiJzogMiB9XTsKICAgKgogICAqIHZhciBkZWVwID0gXy5jbG9uZURlZXAob2JqZWN0cyk7CiAgICogY29uc29sZS5sb2coZGVlcFswXSA9PT0gb2JqZWN0c1swXSk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBjbG9uZURlZXAodmFsdWUpIHsKICAgIHJldHVybiBiYXNlQ2xvbmUodmFsdWUsIENMT05FX0RFRVBfRkxBRyB8IENMT05FX1NZTUJPTFNfRkxBRyk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmNsb25lV2l0aGAgZXhjZXB0IHRoYXQgaXQgcmVjdXJzaXZlbHkgY2xvbmVzIGB2YWx1ZWAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHJlY3Vyc2l2ZWx5IGNsb25lLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjdXN0b21pemVyXSBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNsb25pbmcuCiAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGRlZXAgY2xvbmVkIHZhbHVlLgogICAqIEBzZWUgXy5jbG9uZVdpdGgKICAgKiBAZXhhbXBsZQogICAqCiAgICogZnVuY3Rpb24gY3VzdG9taXplcih2YWx1ZSkgewogICAqICAgaWYgKF8uaXNFbGVtZW50KHZhbHVlKSkgewogICAqICAgICByZXR1cm4gdmFsdWUuY2xvbmVOb2RlKHRydWUpOwogICAqICAgfQogICAqIH0KICAgKgogICAqIHZhciBlbCA9IF8uY2xvbmVEZWVwV2l0aChkb2N1bWVudC5ib2R5LCBjdXN0b21pemVyKTsKICAgKgogICAqIGNvbnNvbGUubG9nKGVsID09PSBkb2N1bWVudC5ib2R5KTsKICAgKiAvLyA9PiBmYWxzZQogICAqIGNvbnNvbGUubG9nKGVsLm5vZGVOYW1lKTsKICAgKiAvLyA9PiAnQk9EWScKICAgKiBjb25zb2xlLmxvZyhlbC5jaGlsZE5vZGVzLmxlbmd0aCk7CiAgICogLy8gPT4gMjAKICAgKi8KICBmdW5jdGlvbiBjbG9uZURlZXBXaXRoKHZhbHVlLCBjdXN0b21pemVyKSB7CiAgICBjdXN0b21pemVyID0gdHlwZW9mIGN1c3RvbWl6ZXIgPT0gJ2Z1bmN0aW9uJyA/IGN1c3RvbWl6ZXIgOiB1bmRlZmluZWQ7CiAgICByZXR1cm4gYmFzZUNsb25lKHZhbHVlLCBDTE9ORV9ERUVQX0ZMQUcgfCBDTE9ORV9TWU1CT0xTX0ZMQUcsIGN1c3RvbWl6ZXIpOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGBvYmplY3RgIGNvbmZvcm1zIHRvIGBzb3VyY2VgIGJ5IGludm9raW5nIHRoZSBwcmVkaWNhdGUKICAgKiBwcm9wZXJ0aWVzIG9mIGBzb3VyY2VgIHdpdGggdGhlIGNvcnJlc3BvbmRpbmcgcHJvcGVydHkgdmFsdWVzIG9mIGBvYmplY3RgLgogICAqCiAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIGVxdWl2YWxlbnQgdG8gYF8uY29uZm9ybXNgIHdoZW4gYHNvdXJjZWAgaXMKICAgKiBwYXJ0aWFsbHkgYXBwbGllZC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjE0LjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7T2JqZWN0fSBzb3VyY2UgVGhlIG9iamVjdCBvZiBwcm9wZXJ0eSBwcmVkaWNhdGVzIHRvIGNvbmZvcm0gdG8uCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGBvYmplY3RgIGNvbmZvcm1zLCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBvYmplY3QgPSB7ICdhJzogMSwgJ2InOiAyIH07CiAgICoKICAgKiBfLmNvbmZvcm1zVG8ob2JqZWN0LCB7ICdiJzogZnVuY3Rpb24obikgeyByZXR1cm4gbiA+IDE7IH0gfSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5jb25mb3Jtc1RvKG9iamVjdCwgeyAnYic6IGZ1bmN0aW9uKG4pIHsgcmV0dXJuIG4gPiAyOyB9IH0pOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gY29uZm9ybXNUbyhvYmplY3QsIHNvdXJjZSkgewogICAgcmV0dXJuIHNvdXJjZSA9PSBudWxsIHx8IGJhc2VDb25mb3Jtc1RvKG9iamVjdCwgc291cmNlLCBrZXlzKHNvdXJjZSkpOwogIH0KCiAgLyoqCiAgICogUGVyZm9ybXMgYQogICAqIFtgU2FtZVZhbHVlWmVyb2BdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLXNhbWV2YWx1ZXplcm8pCiAgICogY29tcGFyaXNvbiBiZXR3ZWVuIHR3byB2YWx1ZXMgdG8gZGV0ZXJtaW5lIGlmIHRoZXkgYXJlIGVxdWl2YWxlbnQuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbXBhcmUuCiAgICogQHBhcmFtIHsqfSBvdGhlciBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIHZhbHVlcyBhcmUgZXF1aXZhbGVudCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgb2JqZWN0ID0geyAnYSc6IDEgfTsKICAgKiB2YXIgb3RoZXIgPSB7ICdhJzogMSB9OwogICAqCiAgICogXy5lcShvYmplY3QsIG9iamVjdCk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5lcShvYmplY3QsIG90aGVyKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5lcSgnYScsICdhJyk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5lcSgnYScsIE9iamVjdCgnYScpKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5lcShOYU4sIE5hTik7CiAgICogLy8gPT4gdHJ1ZQogICAqLwogIGZ1bmN0aW9uIGVxKHZhbHVlLCBvdGhlcikgewogICAgcmV0dXJuIHZhbHVlID09PSBvdGhlciB8fCAodmFsdWUgIT09IHZhbHVlICYmIG90aGVyICE9PSBvdGhlcik7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBncmVhdGVyIHRoYW4gYG90aGVyYC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjkuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0geyp9IG90aGVyIFRoZSBvdGhlciB2YWx1ZSB0byBjb21wYXJlLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGdyZWF0ZXIgdGhhbiBgb3RoZXJgLAogICAqICBlbHNlIGBmYWxzZWAuCiAgICogQHNlZSBfLmx0CiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uZ3QoMywgMSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5ndCgzLCAzKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5ndCgxLCAzKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIHZhciBndCA9IGNyZWF0ZVJlbGF0aW9uYWxPcGVyYXRpb24oYmFzZUd0KTsKCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIGBvdGhlcmAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMy45LjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbXBhcmUuCiAgICogQHBhcmFtIHsqfSBvdGhlciBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8KICAgKiAgYG90aGVyYCwgZWxzZSBgZmFsc2VgLgogICAqIEBzZWUgXy5sdGUKICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5ndGUoMywgMSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5ndGUoMywgMyk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5ndGUoMSwgMyk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICB2YXIgZ3RlID0gY3JlYXRlUmVsYXRpb25hbE9wZXJhdGlvbihmdW5jdGlvbih2YWx1ZSwgb3RoZXIpIHsKICAgIHJldHVybiB2YWx1ZSA+PSBvdGhlcjsKICB9KTsKCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgbGlrZWx5IGFuIGBhcmd1bWVudHNgIG9iamVjdC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYW4gYGFyZ3VtZW50c2Agb2JqZWN0LAogICAqICBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNBcmd1bWVudHMoZnVuY3Rpb24oKSB7IHJldHVybiBhcmd1bWVudHM7IH0oKSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0FyZ3VtZW50cyhbMSwgMiwgM10pOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgdmFyIGlzQXJndW1lbnRzID0gYmFzZUlzQXJndW1lbnRzKGZ1bmN0aW9uKCkgeyByZXR1cm4gYXJndW1lbnRzOyB9KCkpID8gYmFzZUlzQXJndW1lbnRzIDogZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIGhhc093blByb3BlcnR5LmNhbGwodmFsdWUsICdjYWxsZWUnKSAmJgogICAgICAhcHJvcGVydHlJc0VudW1lcmFibGUuY2FsbCh2YWx1ZSwgJ2NhbGxlZScpOwogIH07CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYW4gYEFycmF5YCBvYmplY3QuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGFuIGFycmF5LCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNBcnJheShbMSwgMiwgM10pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNBcnJheShkb2N1bWVudC5ib2R5LmNoaWxkcmVuKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5pc0FycmF5KCdhYmMnKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5pc0FycmF5KF8ubm9vcCk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICB2YXIgaXNBcnJheSA9IEFycmF5LmlzQXJyYXk7CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYW4gYEFycmF5QnVmZmVyYCBvYmplY3QuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4zLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGFuIGFycmF5IGJ1ZmZlciwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzQXJyYXlCdWZmZXIobmV3IEFycmF5QnVmZmVyKDIpKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzQXJyYXlCdWZmZXIobmV3IEFycmF5KDIpKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIHZhciBpc0FycmF5QnVmZmVyID0gbm9kZUlzQXJyYXlCdWZmZXIgPyBiYXNlVW5hcnkobm9kZUlzQXJyYXlCdWZmZXIpIDogYmFzZUlzQXJyYXlCdWZmZXI7CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGFycmF5LWxpa2UuIEEgdmFsdWUgaXMgY29uc2lkZXJlZCBhcnJheS1saWtlIGlmIGl0J3MKICAgKiBub3QgYSBmdW5jdGlvbiBhbmQgaGFzIGEgYHZhbHVlLmxlbmd0aGAgdGhhdCdzIGFuIGludGVnZXIgZ3JlYXRlciB0aGFuIG9yCiAgICogZXF1YWwgdG8gYDBgIGFuZCBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gYE51bWJlci5NQVhfU0FGRV9JTlRFR0VSYC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYXJyYXktbGlrZSwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzQXJyYXlMaWtlKFsxLCAyLCAzXSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0FycmF5TGlrZShkb2N1bWVudC5ib2R5LmNoaWxkcmVuKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzQXJyYXlMaWtlKCdhYmMnKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzQXJyYXlMaWtlKF8ubm9vcCk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc0FycmF5TGlrZSh2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlICE9IG51bGwgJiYgaXNMZW5ndGgodmFsdWUubGVuZ3RoKSAmJiAhaXNGdW5jdGlvbih2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmlzQXJyYXlMaWtlYCBleGNlcHQgdGhhdCBpdCBhbHNvIGNoZWNrcyBpZiBgdmFsdWVgCiAgICogaXMgYW4gb2JqZWN0LgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBhcnJheS1saWtlIG9iamVjdCwKICAgKiAgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzQXJyYXlMaWtlT2JqZWN0KFsxLCAyLCAzXSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0FycmF5TGlrZU9iamVjdChkb2N1bWVudC5ib2R5LmNoaWxkcmVuKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzQXJyYXlMaWtlT2JqZWN0KCdhYmMnKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5pc0FycmF5TGlrZU9iamVjdChfLm5vb3ApOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNBcnJheUxpa2VPYmplY3QodmFsdWUpIHsKICAgIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIGlzQXJyYXlMaWtlKHZhbHVlKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSBib29sZWFuIHByaW1pdGl2ZSBvciBvYmplY3QuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgYm9vbGVhbiwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzQm9vbGVhbihmYWxzZSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0Jvb2xlYW4obnVsbCk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc0Jvb2xlYW4odmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZSA9PT0gdHJ1ZSB8fCB2YWx1ZSA9PT0gZmFsc2UgfHwKICAgICAgKGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgYmFzZUdldFRhZyh2YWx1ZSkgPT0gYm9vbFRhZyk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIGJ1ZmZlci4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjMuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBidWZmZXIsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc0J1ZmZlcihuZXcgQnVmZmVyKDIpKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzQnVmZmVyKG5ldyBVaW50OEFycmF5KDIpKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIHZhciBpc0J1ZmZlciA9IG5hdGl2ZUlzQnVmZmVyIHx8IHN0dWJGYWxzZTsKCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgY2xhc3NpZmllZCBhcyBhIGBEYXRlYCBvYmplY3QuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgZGF0ZSBvYmplY3QsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc0RhdGUobmV3IERhdGUpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNEYXRlKCdNb24gQXByaWwgMjMgMjAxMicpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgdmFyIGlzRGF0ZSA9IG5vZGVJc0RhdGUgPyBiYXNlVW5hcnkobm9kZUlzRGF0ZSkgOiBiYXNlSXNEYXRlOwoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBsaWtlbHkgYSBET00gZWxlbWVudC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBET00gZWxlbWVudCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzRWxlbWVudChkb2N1bWVudC5ib2R5KTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzRWxlbWVudCgnPGJvZHk+Jyk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc0VsZW1lbnQodmFsdWUpIHsKICAgIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIHZhbHVlLm5vZGVUeXBlID09PSAxICYmICFpc1BsYWluT2JqZWN0KHZhbHVlKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGFuIGVtcHR5IG9iamVjdCwgY29sbGVjdGlvbiwgbWFwLCBvciBzZXQuCiAgICoKICAgKiBPYmplY3RzIGFyZSBjb25zaWRlcmVkIGVtcHR5IGlmIHRoZXkgaGF2ZSBubyBvd24gZW51bWVyYWJsZSBzdHJpbmcga2V5ZWQKICAgKiBwcm9wZXJ0aWVzLgogICAqCiAgICogQXJyYXktbGlrZSB2YWx1ZXMgc3VjaCBhcyBgYXJndW1lbnRzYCBvYmplY3RzLCBhcnJheXMsIGJ1ZmZlcnMsIHN0cmluZ3MsIG9yCiAgICogalF1ZXJ5LWxpa2UgY29sbGVjdGlvbnMgYXJlIGNvbnNpZGVyZWQgZW1wdHkgaWYgdGhleSBoYXZlIGEgYGxlbmd0aGAgb2YgYDBgLgogICAqIFNpbWlsYXJseSwgbWFwcyBhbmQgc2V0cyBhcmUgY29uc2lkZXJlZCBlbXB0eSBpZiB0aGV5IGhhdmUgYSBgc2l6ZWAgb2YgYDBgLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDAuMS4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBlbXB0eSwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzRW1wdHkobnVsbCk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0VtcHR5KHRydWUpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNFbXB0eSgxKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzRW1wdHkoWzEsIDIsIDNdKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5pc0VtcHR5KHsgJ2EnOiAxIH0pOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNFbXB0eSh2YWx1ZSkgewogICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBpZiAoaXNBcnJheUxpa2UodmFsdWUpICYmCiAgICAgICAgKGlzQXJyYXkodmFsdWUpIHx8IHR5cGVvZiB2YWx1ZSA9PSAnc3RyaW5nJyB8fCB0eXBlb2YgdmFsdWUuc3BsaWNlID09ICdmdW5jdGlvbicgfHwKICAgICAgICAgIGlzQnVmZmVyKHZhbHVlKSB8fCBpc1R5cGVkQXJyYXkodmFsdWUpIHx8IGlzQXJndW1lbnRzKHZhbHVlKSkpIHsKICAgICAgcmV0dXJuICF2YWx1ZS5sZW5ndGg7CiAgICB9CiAgICB2YXIgdGFnID0gZ2V0VGFnKHZhbHVlKTsKICAgIGlmICh0YWcgPT0gbWFwVGFnIHx8IHRhZyA9PSBzZXRUYWcpIHsKICAgICAgcmV0dXJuICF2YWx1ZS5zaXplOwogICAgfQogICAgaWYgKGlzUHJvdG90eXBlKHZhbHVlKSkgewogICAgICByZXR1cm4gIWJhc2VLZXlzKHZhbHVlKS5sZW5ndGg7CiAgICB9CiAgICBmb3IgKHZhciBrZXkgaW4gdmFsdWUpIHsKICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwodmFsdWUsIGtleSkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogUGVyZm9ybXMgYSBkZWVwIGNvbXBhcmlzb24gYmV0d2VlbiB0d28gdmFsdWVzIHRvIGRldGVybWluZSBpZiB0aGV5IGFyZQogICAqIGVxdWl2YWxlbnQuCiAgICoKICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2Qgc3VwcG9ydHMgY29tcGFyaW5nIGFycmF5cywgYXJyYXkgYnVmZmVycywgYm9vbGVhbnMsCiAgICogZGF0ZSBvYmplY3RzLCBlcnJvciBvYmplY3RzLCBtYXBzLCBudW1iZXJzLCBgT2JqZWN0YCBvYmplY3RzLCByZWdleGVzLAogICAqIHNldHMsIHN0cmluZ3MsIHN5bWJvbHMsIGFuZCB0eXBlZCBhcnJheXMuIGBPYmplY3RgIG9iamVjdHMgYXJlIGNvbXBhcmVkCiAgICogYnkgdGhlaXIgb3duLCBub3QgaW5oZXJpdGVkLCBlbnVtZXJhYmxlIHByb3BlcnRpZXMuIEZ1bmN0aW9ucyBhbmQgRE9NCiAgICogbm9kZXMgYXJlIGNvbXBhcmVkIGJ5IHN0cmljdCBlcXVhbGl0eSwgaS5lLiBgPT09YC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0geyp9IG90aGVyIFRoZSBvdGhlciB2YWx1ZSB0byBjb21wYXJlLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgdmFsdWVzIGFyZSBlcXVpdmFsZW50LCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBvYmplY3QgPSB7ICdhJzogMSB9OwogICAqIHZhciBvdGhlciA9IHsgJ2EnOiAxIH07CiAgICoKICAgKiBfLmlzRXF1YWwob2JqZWN0LCBvdGhlcik7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogb2JqZWN0ID09PSBvdGhlcjsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGlzRXF1YWwodmFsdWUsIG90aGVyKSB7CiAgICByZXR1cm4gYmFzZUlzRXF1YWwodmFsdWUsIG90aGVyKTsKICB9CgogIC8qKgogICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uaXNFcXVhbGAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgY3VzdG9taXplcmAgd2hpY2gKICAgKiBpcyBpbnZva2VkIHRvIGNvbXBhcmUgdmFsdWVzLiBJZiBgY3VzdG9taXplcmAgcmV0dXJucyBgdW5kZWZpbmVkYCwgY29tcGFyaXNvbnMKICAgKiBhcmUgaGFuZGxlZCBieSB0aGUgbWV0aG9kIGluc3RlYWQuIFRoZSBgY3VzdG9taXplcmAgaXMgaW52b2tlZCB3aXRoIHVwIHRvCiAgICogc2l4IGFyZ3VtZW50czogKG9ialZhbHVlLCBvdGhWYWx1ZSBbLCBpbmRleHxrZXksIG9iamVjdCwgb3RoZXIsIHN0YWNrXSkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbXBhcmUuCiAgICogQHBhcmFtIHsqfSBvdGhlciBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY3VzdG9taXplcl0gVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBjb21wYXJpc29ucy4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIHZhbHVlcyBhcmUgZXF1aXZhbGVudCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBmdW5jdGlvbiBpc0dyZWV0aW5nKHZhbHVlKSB7CiAgICogICByZXR1cm4gL15oKD86aXxlbGxvKSQvLnRlc3QodmFsdWUpOwogICAqIH0KICAgKgogICAqIGZ1bmN0aW9uIGN1c3RvbWl6ZXIob2JqVmFsdWUsIG90aFZhbHVlKSB7CiAgICogICBpZiAoaXNHcmVldGluZyhvYmpWYWx1ZSkgJiYgaXNHcmVldGluZyhvdGhWYWx1ZSkpIHsKICAgKiAgICAgcmV0dXJuIHRydWU7CiAgICogICB9CiAgICogfQogICAqCiAgICogdmFyIGFycmF5ID0gWydoZWxsbycsICdnb29kYnllJ107CiAgICogdmFyIG90aGVyID0gWydoaScsICdnb29kYnllJ107CiAgICoKICAgKiBfLmlzRXF1YWxXaXRoKGFycmF5LCBvdGhlciwgY3VzdG9taXplcik7CiAgICogLy8gPT4gdHJ1ZQogICAqLwogIGZ1bmN0aW9uIGlzRXF1YWxXaXRoKHZhbHVlLCBvdGhlciwgY3VzdG9taXplcikgewogICAgY3VzdG9taXplciA9IHR5cGVvZiBjdXN0b21pemVyID09ICdmdW5jdGlvbicgPyBjdXN0b21pemVyIDogdW5kZWZpbmVkOwogICAgdmFyIHJlc3VsdCA9IGN1c3RvbWl6ZXIgPyBjdXN0b21pemVyKHZhbHVlLCBvdGhlcikgOiB1bmRlZmluZWQ7CiAgICByZXR1cm4gcmVzdWx0ID09PSB1bmRlZmluZWQgPyBiYXNlSXNFcXVhbCh2YWx1ZSwgb3RoZXIsIHVuZGVmaW5lZCwgY3VzdG9taXplcikgOiAhIXJlc3VsdDsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGFuIGBFcnJvcmAsIGBFdmFsRXJyb3JgLCBgUmFuZ2VFcnJvcmAsIGBSZWZlcmVuY2VFcnJvcmAsCiAgICogYFN5bnRheEVycm9yYCwgYFR5cGVFcnJvcmAsIG9yIGBVUklFcnJvcmAgb2JqZWN0LgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDMuMC4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBlcnJvciBvYmplY3QsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc0Vycm9yKG5ldyBFcnJvcik7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0Vycm9yKEVycm9yKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGlzRXJyb3IodmFsdWUpIHsKICAgIGlmICghaXNPYmplY3RMaWtlKHZhbHVlKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB2YXIgdGFnID0gYmFzZUdldFRhZyh2YWx1ZSk7CiAgICByZXR1cm4gdGFnID09IGVycm9yVGFnIHx8IHRhZyA9PSBkb21FeGNUYWcgfHwKICAgICAgKHR5cGVvZiB2YWx1ZS5tZXNzYWdlID09ICdzdHJpbmcnICYmIHR5cGVvZiB2YWx1ZS5uYW1lID09ICdzdHJpbmcnICYmICFpc1BsYWluT2JqZWN0KHZhbHVlKSk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIGZpbml0ZSBwcmltaXRpdmUgbnVtYmVyLgogICAqCiAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIGJhc2VkIG9uCiAgICogW2BOdW1iZXIuaXNGaW5pdGVgXShodHRwczovL21kbi5pby9OdW1iZXIvaXNGaW5pdGUpLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDAuMS4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIGZpbml0ZSBudW1iZXIsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc0Zpbml0ZSgzKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzRmluaXRlKE51bWJlci5NSU5fVkFMVUUpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNGaW5pdGUoSW5maW5pdHkpOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmlzRmluaXRlKCczJyk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc0Zpbml0ZSh2YWx1ZSkgewogICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyAmJiBuYXRpdmVJc0Zpbml0ZSh2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGEgYEZ1bmN0aW9uYCBvYmplY3QuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgZnVuY3Rpb24sIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc0Z1bmN0aW9uKF8pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNGdW5jdGlvbigvYWJjLyk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc0Z1bmN0aW9uKHZhbHVlKSB7CiAgICBpZiAoIWlzT2JqZWN0KHZhbHVlKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAvLyBUaGUgdXNlIG9mIGBPYmplY3QjdG9TdHJpbmdgIGF2b2lkcyBpc3N1ZXMgd2l0aCB0aGUgYHR5cGVvZmAgb3BlcmF0b3IKICAgIC8vIGluIFNhZmFyaSA5IHdoaWNoIHJldHVybnMgJ29iamVjdCcgZm9yIHR5cGVkIGFycmF5cyBhbmQgb3RoZXIgY29uc3RydWN0b3JzLgogICAgdmFyIHRhZyA9IGJhc2VHZXRUYWcodmFsdWUpOwogICAgcmV0dXJuIHRhZyA9PSBmdW5jVGFnIHx8IHRhZyA9PSBnZW5UYWcgfHwgdGFnID09IGFzeW5jVGFnIHx8IHRhZyA9PSBwcm94eVRhZzsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGFuIGludGVnZXIuCiAgICoKICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgYmFzZWQgb24KICAgKiBbYE51bWJlci5pc0ludGVnZXJgXShodHRwczovL21kbi5pby9OdW1iZXIvaXNJbnRlZ2VyKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYW4gaW50ZWdlciwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzSW50ZWdlcigzKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzSW50ZWdlcihOdW1iZXIuTUlOX1ZBTFVFKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5pc0ludGVnZXIoSW5maW5pdHkpOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmlzSW50ZWdlcignMycpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNJbnRlZ2VyKHZhbHVlKSB7CiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09ICdudW1iZXInICYmIHZhbHVlID09IHRvSW50ZWdlcih2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIHZhbGlkIGFycmF5LWxpa2UgbGVuZ3RoLgogICAqCiAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIGxvb3NlbHkgYmFzZWQgb24KICAgKiBbYFRvTGVuZ3RoYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtdG9sZW5ndGgpLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHZhbGlkIGxlbmd0aCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzTGVuZ3RoKDMpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNMZW5ndGgoTnVtYmVyLk1JTl9WQUxVRSk7CiAgICogLy8gPT4gZmFsc2UKICAgKgogICAqIF8uaXNMZW5ndGgoSW5maW5pdHkpOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmlzTGVuZ3RoKCczJyk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc0xlbmd0aCh2YWx1ZSkgewogICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyAmJgogICAgICB2YWx1ZSA+IC0xICYmIHZhbHVlICUgMSA9PSAwICYmIHZhbHVlIDw9IE1BWF9TQUZFX0lOVEVHRVI7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyB0aGUKICAgKiBbbGFuZ3VhZ2UgdHlwZV0oaHR0cDovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLWVjbWFzY3JpcHQtbGFuZ3VhZ2UtdHlwZXMpCiAgICogb2YgYE9iamVjdGAuIChlLmcuIGFycmF5cywgZnVuY3Rpb25zLCBvYmplY3RzLCByZWdleGVzLCBgbmV3IE51bWJlcigwKWAsIGFuZCBgbmV3IFN0cmluZygnJylgKQogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDAuMS4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBvYmplY3QsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc09iamVjdCh7fSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc09iamVjdChbMSwgMiwgM10pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNPYmplY3QoXy5ub29wKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzT2JqZWN0KG51bGwpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNPYmplY3QodmFsdWUpIHsKICAgIHZhciB0eXBlID0gdHlwZW9mIHZhbHVlOwogICAgcmV0dXJuIHZhbHVlICE9IG51bGwgJiYgKHR5cGUgPT0gJ29iamVjdCcgfHwgdHlwZSA9PSAnZnVuY3Rpb24nKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIG9iamVjdC1saWtlLiBBIHZhbHVlIGlzIG9iamVjdC1saWtlIGlmIGl0J3Mgbm90IGBudWxsYAogICAqIGFuZCBoYXMgYSBgdHlwZW9mYCByZXN1bHQgb2YgIm9iamVjdCIuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIG9iamVjdC1saWtlLCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNPYmplY3RMaWtlKHt9KTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzT2JqZWN0TGlrZShbMSwgMiwgM10pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNPYmplY3RMaWtlKF8ubm9vcCk7CiAgICogLy8gPT4gZmFsc2UKICAgKgogICAqIF8uaXNPYmplY3RMaWtlKG51bGwpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNPYmplY3RMaWtlKHZhbHVlKSB7CiAgICByZXR1cm4gdmFsdWUgIT0gbnVsbCAmJiB0eXBlb2YgdmFsdWUgPT0gJ29iamVjdCc7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGEgYE1hcGAgb2JqZWN0LgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMy4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIG1hcCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzTWFwKG5ldyBNYXApOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNNYXAobmV3IFdlYWtNYXApOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgdmFyIGlzTWFwID0gbm9kZUlzTWFwID8gYmFzZVVuYXJ5KG5vZGVJc01hcCkgOiBiYXNlSXNNYXA7CgogIC8qKgogICAqIFBlcmZvcm1zIGEgcGFydGlhbCBkZWVwIGNvbXBhcmlzb24gYmV0d2VlbiBgb2JqZWN0YCBhbmQgYHNvdXJjZWAgdG8KICAgKiBkZXRlcm1pbmUgaWYgYG9iamVjdGAgY29udGFpbnMgZXF1aXZhbGVudCBwcm9wZXJ0eSB2YWx1ZXMuCiAgICoKICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgZXF1aXZhbGVudCB0byBgXy5tYXRjaGVzYCB3aGVuIGBzb3VyY2VgIGlzCiAgICogcGFydGlhbGx5IGFwcGxpZWQuCiAgICoKICAgKiBQYXJ0aWFsIGNvbXBhcmlzb25zIHdpbGwgbWF0Y2ggZW1wdHkgYXJyYXkgYW5kIGVtcHR5IG9iamVjdCBgc291cmNlYAogICAqIHZhbHVlcyBhZ2FpbnN0IGFueSBhcnJheSBvciBvYmplY3QgdmFsdWUsIHJlc3BlY3RpdmVseS4gU2VlIGBfLmlzRXF1YWxgCiAgICogZm9yIGEgbGlzdCBvZiBzdXBwb3J0ZWQgdmFsdWUgY29tcGFyaXNvbnMuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMy4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7T2JqZWN0fSBzb3VyY2UgVGhlIG9iamVjdCBvZiBwcm9wZXJ0eSB2YWx1ZXMgdG8gbWF0Y2guCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGBvYmplY3RgIGlzIGEgbWF0Y2gsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIG9iamVjdCA9IHsgJ2EnOiAxLCAnYic6IDIgfTsKICAgKgogICAqIF8uaXNNYXRjaChvYmplY3QsIHsgJ2InOiAyIH0pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNNYXRjaChvYmplY3QsIHsgJ2InOiAxIH0pOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNNYXRjaChvYmplY3QsIHNvdXJjZSkgewogICAgcmV0dXJuIG9iamVjdCA9PT0gc291cmNlIHx8IGJhc2VJc01hdGNoKG9iamVjdCwgc291cmNlLCBnZXRNYXRjaERhdGEoc291cmNlKSk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmlzTWF0Y2hgIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGN1c3RvbWl6ZXJgIHdoaWNoCiAgICogaXMgaW52b2tlZCB0byBjb21wYXJlIHZhbHVlcy4gSWYgYGN1c3RvbWl6ZXJgIHJldHVybnMgYHVuZGVmaW5lZGAsIGNvbXBhcmlzb25zCiAgICogYXJlIGhhbmRsZWQgYnkgdGhlIG1ldGhvZCBpbnN0ZWFkLiBUaGUgYGN1c3RvbWl6ZXJgIGlzIGludm9rZWQgd2l0aCBmaXZlCiAgICogYXJndW1lbnRzOiAob2JqVmFsdWUsIHNyY1ZhbHVlLCBpbmRleHxrZXksIG9iamVjdCwgc291cmNlKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgb2JqZWN0IG9mIHByb3BlcnR5IHZhbHVlcyB0byBtYXRjaC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY3VzdG9taXplcl0gVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBjb21wYXJpc29ucy4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYG9iamVjdGAgaXMgYSBtYXRjaCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBmdW5jdGlvbiBpc0dyZWV0aW5nKHZhbHVlKSB7CiAgICogICByZXR1cm4gL15oKD86aXxlbGxvKSQvLnRlc3QodmFsdWUpOwogICAqIH0KICAgKgogICAqIGZ1bmN0aW9uIGN1c3RvbWl6ZXIob2JqVmFsdWUsIHNyY1ZhbHVlKSB7CiAgICogICBpZiAoaXNHcmVldGluZyhvYmpWYWx1ZSkgJiYgaXNHcmVldGluZyhzcmNWYWx1ZSkpIHsKICAgKiAgICAgcmV0dXJuIHRydWU7CiAgICogICB9CiAgICogfQogICAqCiAgICogdmFyIG9iamVjdCA9IHsgJ2dyZWV0aW5nJzogJ2hlbGxvJyB9OwogICAqIHZhciBzb3VyY2UgPSB7ICdncmVldGluZyc6ICdoaScgfTsKICAgKgogICAqIF8uaXNNYXRjaFdpdGgob2JqZWN0LCBzb3VyY2UsIGN1c3RvbWl6ZXIpOwogICAqIC8vID0+IHRydWUKICAgKi8KICBmdW5jdGlvbiBpc01hdGNoV2l0aChvYmplY3QsIHNvdXJjZSwgY3VzdG9taXplcikgewogICAgY3VzdG9taXplciA9IHR5cGVvZiBjdXN0b21pemVyID09ICdmdW5jdGlvbicgPyBjdXN0b21pemVyIDogdW5kZWZpbmVkOwogICAgcmV0dXJuIGJhc2VJc01hdGNoKG9iamVjdCwgc291cmNlLCBnZXRNYXRjaERhdGEoc291cmNlKSwgY3VzdG9taXplcik7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBgTmFOYC4KICAgKgogICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBpcyBiYXNlZCBvbgogICAqIFtgTnVtYmVyLmlzTmFOYF0oaHR0cHM6Ly9tZG4uaW8vTnVtYmVyL2lzTmFOKSBhbmQgaXMgbm90IHRoZSBzYW1lIGFzCiAgICogZ2xvYmFsIFtgaXNOYU5gXShodHRwczovL21kbi5pby9pc05hTikgd2hpY2ggcmV0dXJucyBgdHJ1ZWAgZm9yCiAgICogYHVuZGVmaW5lZGAgYW5kIG90aGVyIG5vbi1udW1iZXIgdmFsdWVzLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDAuMS4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBgTmFOYCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzTmFOKE5hTik7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc05hTihuZXcgTnVtYmVyKE5hTikpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIGlzTmFOKHVuZGVmaW5lZCk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc05hTih1bmRlZmluZWQpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNOYU4odmFsdWUpIHsKICAgIC8vIEFuIGBOYU5gIHByaW1pdGl2ZSBpcyB0aGUgb25seSB2YWx1ZSB0aGF0IGlzIG5vdCBlcXVhbCB0byBpdHNlbGYuCiAgICAvLyBQZXJmb3JtIHRoZSBgdG9TdHJpbmdUYWdgIGNoZWNrIGZpcnN0IHRvIGF2b2lkIGVycm9ycyB3aXRoIHNvbWUKICAgIC8vIEFjdGl2ZVggb2JqZWN0cyBpbiBJRS4KICAgIHJldHVybiBpc051bWJlcih2YWx1ZSkgJiYgdmFsdWUgIT0gK3ZhbHVlOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSBwcmlzdGluZSBuYXRpdmUgZnVuY3Rpb24uCiAgICoKICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgY2FuJ3QgcmVsaWFibHkgZGV0ZWN0IG5hdGl2ZSBmdW5jdGlvbnMgaW4gdGhlIHByZXNlbmNlCiAgICogb2YgdGhlIGNvcmUtanMgcGFja2FnZSBiZWNhdXNlIGNvcmUtanMgY2lyY3VtdmVudHMgdGhpcyBraW5kIG9mIGRldGVjdGlvbi4KICAgKiBEZXNwaXRlIG11bHRpcGxlIHJlcXVlc3RzLCB0aGUgY29yZS1qcyBtYWludGFpbmVyIGhhcyBtYWRlIGl0IGNsZWFyOiBhbnkKICAgKiBhdHRlbXB0IHRvIGZpeCB0aGUgZGV0ZWN0aW9uIHdpbGwgYmUgb2JzdHJ1Y3RlZC4gQXMgYSByZXN1bHQsIHdlJ3JlIGxlZnQKICAgKiB3aXRoIGxpdHRsZSBjaG9pY2UgYnV0IHRvIHRocm93IGFuIGVycm9yLiBVbmZvcnR1bmF0ZWx5LCB0aGlzIGFsc28gYWZmZWN0cwogICAqIHBhY2thZ2VzLCBsaWtlIFtiYWJlbC1wb2x5ZmlsbF0oaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvYmFiZWwtcG9seWZpbGwpLAogICAqIHdoaWNoIHJlbHkgb24gY29yZS1qcy4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBuYXRpdmUgZnVuY3Rpb24sCiAgICogIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc05hdGl2ZShBcnJheS5wcm90b3R5cGUucHVzaCk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc05hdGl2ZShfKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGlzTmF0aXZlKHZhbHVlKSB7CiAgICBpZiAoaXNNYXNrYWJsZSh2YWx1ZSkpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKENPUkVfRVJST1JfVEVYVCk7CiAgICB9CiAgICByZXR1cm4gYmFzZUlzTmF0aXZlKHZhbHVlKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGBudWxsYC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYG51bGxgLCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNOdWxsKG51bGwpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNOdWxsKHZvaWQgMCk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc051bGwodmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZSA9PT0gbnVsbDsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGBudWxsYCBvciBgdW5kZWZpbmVkYC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgbnVsbGlzaCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzTmlsKG51bGwpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNOaWwodm9pZCAwKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzTmlsKE5hTik7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc05pbCh2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlID09IG51bGw7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGEgYE51bWJlcmAgcHJpbWl0aXZlIG9yIG9iamVjdC4KICAgKgogICAqICoqTm90ZToqKiBUbyBleGNsdWRlIGBJbmZpbml0eWAsIGAtSW5maW5pdHlgLCBhbmQgYE5hTmAsIHdoaWNoIGFyZQogICAqIGNsYXNzaWZpZWQgYXMgbnVtYmVycywgdXNlIHRoZSBgXy5pc0Zpbml0ZWAgbWV0aG9kLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDAuMS4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIG51bWJlciwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzTnVtYmVyKDMpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNOdW1iZXIoTnVtYmVyLk1JTl9WQUxVRSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc051bWJlcihJbmZpbml0eSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc051bWJlcignMycpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNOdW1iZXIodmFsdWUpIHsKICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ251bWJlcicgfHwKICAgICAgKGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgYmFzZUdldFRhZyh2YWx1ZSkgPT0gbnVtYmVyVGFnKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgcGxhaW4gb2JqZWN0LCB0aGF0IGlzLCBhbiBvYmplY3QgY3JlYXRlZCBieSB0aGUKICAgKiBgT2JqZWN0YCBjb25zdHJ1Y3RvciBvciBvbmUgd2l0aCBhIGBbW1Byb3RvdHlwZV1dYCBvZiBgbnVsbGAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC44LjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgcGxhaW4gb2JqZWN0LCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIGZ1bmN0aW9uIEZvbygpIHsKICAgKiAgIHRoaXMuYSA9IDE7CiAgICogfQogICAqCiAgICogXy5pc1BsYWluT2JqZWN0KG5ldyBGb28pOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmlzUGxhaW5PYmplY3QoWzEsIDIsIDNdKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5pc1BsYWluT2JqZWN0KHsgJ3gnOiAwLCAneSc6IDAgfSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc1BsYWluT2JqZWN0KE9iamVjdC5jcmVhdGUobnVsbCkpOwogICAqIC8vID0+IHRydWUKICAgKi8KICBmdW5jdGlvbiBpc1BsYWluT2JqZWN0KHZhbHVlKSB7CiAgICBpZiAoIWlzT2JqZWN0TGlrZSh2YWx1ZSkgfHwgYmFzZUdldFRhZyh2YWx1ZSkgIT0gb2JqZWN0VGFnKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHZhciBwcm90byA9IGdldFByb3RvdHlwZSh2YWx1ZSk7CiAgICBpZiAocHJvdG8gPT09IG51bGwpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICB2YXIgQ3RvciA9IGhhc093blByb3BlcnR5LmNhbGwocHJvdG8sICdjb25zdHJ1Y3RvcicpICYmIHByb3RvLmNvbnN0cnVjdG9yOwogICAgcmV0dXJuIHR5cGVvZiBDdG9yID09ICdmdW5jdGlvbicgJiYgQ3RvciBpbnN0YW5jZW9mIEN0b3IgJiYKICAgICAgZnVuY1RvU3RyaW5nLmNhbGwoQ3RvcikgPT0gb2JqZWN0Q3RvclN0cmluZzsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSBgUmVnRXhwYCBvYmplY3QuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgcmVnZXhwLCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNSZWdFeHAoL2FiYy8pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNSZWdFeHAoJy9hYmMvJyk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICB2YXIgaXNSZWdFeHAgPSBub2RlSXNSZWdFeHAgPyBiYXNlVW5hcnkobm9kZUlzUmVnRXhwKSA6IGJhc2VJc1JlZ0V4cDsKCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSBzYWZlIGludGVnZXIuIEFuIGludGVnZXIgaXMgc2FmZSBpZiBpdCdzIGFuIElFRUUtNzU0CiAgICogZG91YmxlIHByZWNpc2lvbiBudW1iZXIgd2hpY2ggaXNuJ3QgdGhlIHJlc3VsdCBvZiBhIHJvdW5kZWQgdW5zYWZlIGludGVnZXIuCiAgICoKICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgYmFzZWQgb24KICAgKiBbYE51bWJlci5pc1NhZmVJbnRlZ2VyYF0oaHR0cHM6Ly9tZG4uaW8vTnVtYmVyL2lzU2FmZUludGVnZXIpLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHNhZmUgaW50ZWdlciwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzU2FmZUludGVnZXIoMyk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc1NhZmVJbnRlZ2VyKE51bWJlci5NSU5fVkFMVUUpOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmlzU2FmZUludGVnZXIoSW5maW5pdHkpOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmlzU2FmZUludGVnZXIoJzMnKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGlzU2FmZUludGVnZXIodmFsdWUpIHsKICAgIHJldHVybiBpc0ludGVnZXIodmFsdWUpICYmIHZhbHVlID49IC1NQVhfU0FGRV9JTlRFR0VSICYmIHZhbHVlIDw9IE1BWF9TQUZFX0lOVEVHRVI7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGEgYFNldGAgb2JqZWN0LgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMy4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHNldCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzU2V0KG5ldyBTZXQpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNTZXQobmV3IFdlYWtTZXQpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgdmFyIGlzU2V0ID0gbm9kZUlzU2V0ID8gYmFzZVVuYXJ5KG5vZGVJc1NldCkgOiBiYXNlSXNTZXQ7CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSBgU3RyaW5nYCBwcmltaXRpdmUgb3Igb2JqZWN0LgogICAqCiAgICogQHN0YXRpYwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBtZW1iZXJPZiBfCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHN0cmluZywgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzU3RyaW5nKCdhYmMnKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzU3RyaW5nKDEpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNTdHJpbmcodmFsdWUpIHsKICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ3N0cmluZycgfHwKICAgICAgKCFpc0FycmF5KHZhbHVlKSAmJiBpc09iamVjdExpa2UodmFsdWUpICYmIGJhc2VHZXRUYWcodmFsdWUpID09IHN0cmluZ1RhZyk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGEgYFN5bWJvbGAgcHJpbWl0aXZlIG9yIG9iamVjdC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBzeW1ib2wsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc1N5bWJvbChTeW1ib2wuaXRlcmF0b3IpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNTeW1ib2woJ2FiYycpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNTeW1ib2wodmFsdWUpIHsKICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ3N5bWJvbCcgfHwKICAgICAgKGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgYmFzZUdldFRhZyh2YWx1ZSkgPT0gc3ltYm9sVGFnKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSB0eXBlZCBhcnJheS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSB0eXBlZCBhcnJheSwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzVHlwZWRBcnJheShuZXcgVWludDhBcnJheSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc1R5cGVkQXJyYXkoW10pOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgdmFyIGlzVHlwZWRBcnJheSA9IG5vZGVJc1R5cGVkQXJyYXkgPyBiYXNlVW5hcnkobm9kZUlzVHlwZWRBcnJheSkgOiBiYXNlSXNUeXBlZEFycmF5OwoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBgdW5kZWZpbmVkYC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAc2luY2UgMC4xLjAKICAgKiBAbWVtYmVyT2YgXwogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYHVuZGVmaW5lZGAsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc1VuZGVmaW5lZCh2b2lkIDApOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNVbmRlZmluZWQobnVsbCk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc1VuZGVmaW5lZCh2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQ7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGEgYFdlYWtNYXBgIG9iamVjdC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjMuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSB3ZWFrIG1hcCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzV2Vha01hcChuZXcgV2Vha01hcCk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc1dlYWtNYXAobmV3IE1hcCk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc1dlYWtNYXAodmFsdWUpIHsKICAgIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIGdldFRhZyh2YWx1ZSkgPT0gd2Vha01hcFRhZzsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSBgV2Vha1NldGAgb2JqZWN0LgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMy4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHdlYWsgc2V0LCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNXZWFrU2V0KG5ldyBXZWFrU2V0KTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzV2Vha1NldChuZXcgU2V0KTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGlzV2Vha1NldCh2YWx1ZSkgewogICAgcmV0dXJuIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgYmFzZUdldFRhZyh2YWx1ZSkgPT0gd2Vha1NldFRhZzsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGxlc3MgdGhhbiBgb3RoZXJgLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDMuOS4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb21wYXJlLgogICAqIEBwYXJhbSB7Kn0gb3RoZXIgVGhlIG90aGVyIHZhbHVlIHRvIGNvbXBhcmUuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgbGVzcyB0aGFuIGBvdGhlcmAsCiAgICogIGVsc2UgYGZhbHNlYC4KICAgKiBAc2VlIF8uZ3QKICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5sdCgxLCAzKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmx0KDMsIDMpOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmx0KDMsIDEpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgdmFyIGx0ID0gY3JlYXRlUmVsYXRpb25hbE9wZXJhdGlvbihiYXNlTHQpOwoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gYG90aGVyYC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjkuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0geyp9IG90aGVyIFRoZSBvdGhlciB2YWx1ZSB0byBjb21wYXJlLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGxlc3MgdGhhbiBvciBlcXVhbCB0bwogICAqICBgb3RoZXJgLCBlbHNlIGBmYWxzZWAuCiAgICogQHNlZSBfLmd0ZQogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmx0ZSgxLCAzKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmx0ZSgzLCAzKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmx0ZSgzLCAxKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIHZhciBsdGUgPSBjcmVhdGVSZWxhdGlvbmFsT3BlcmF0aW9uKGZ1bmN0aW9uKHZhbHVlLCBvdGhlcikgewogICAgcmV0dXJuIHZhbHVlIDw9IG90aGVyOwogIH0pOwoKICAvKioKICAgKiBDb252ZXJ0cyBgdmFsdWVgIHRvIGFuIGFycmF5LgogICAqCiAgICogQHN0YXRpYwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBtZW1iZXJPZiBfCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb252ZXJ0LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgY29udmVydGVkIGFycmF5LgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnRvQXJyYXkoeyAnYSc6IDEsICdiJzogMiB9KTsKICAgKiAvLyA9PiBbMSwgMl0KICAgKgogICAqIF8udG9BcnJheSgnYWJjJyk7CiAgICogLy8gPT4gWydhJywgJ2InLCAnYyddCiAgICoKICAgKiBfLnRvQXJyYXkoMSk7CiAgICogLy8gPT4gW10KICAgKgogICAqIF8udG9BcnJheShudWxsKTsKICAgKiAvLyA9PiBbXQogICAqLwogIGZ1bmN0aW9uIHRvQXJyYXkodmFsdWUpIHsKICAgIGlmICghdmFsdWUpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfQogICAgaWYgKGlzQXJyYXlMaWtlKHZhbHVlKSkgewogICAgICByZXR1cm4gaXNTdHJpbmcodmFsdWUpID8gc3RyaW5nVG9BcnJheSh2YWx1ZSkgOiBjb3B5QXJyYXkodmFsdWUpOwogICAgfQogICAgaWYgKHN5bUl0ZXJhdG9yICYmIHZhbHVlW3N5bUl0ZXJhdG9yXSkgewogICAgICByZXR1cm4gaXRlcmF0b3JUb0FycmF5KHZhbHVlW3N5bUl0ZXJhdG9yXSgpKTsKICAgIH0KICAgIHZhciB0YWcgPSBnZXRUYWcodmFsdWUpLAogICAgICAgIGZ1bmMgPSB0YWcgPT0gbWFwVGFnID8gbWFwVG9BcnJheSA6ICh0YWcgPT0gc2V0VGFnID8gc2V0VG9BcnJheSA6IHZhbHVlcyk7CgogICAgcmV0dXJuIGZ1bmModmFsdWUpOwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYHZhbHVlYCB0byBhIGZpbml0ZSBudW1iZXIuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4xMi4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb252ZXJ0LgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBudW1iZXIuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8udG9GaW5pdGUoMy4yKTsKICAgKiAvLyA9PiAzLjIKICAgKgogICAqIF8udG9GaW5pdGUoTnVtYmVyLk1JTl9WQUxVRSk7CiAgICogLy8gPT4gNWUtMzI0CiAgICoKICAgKiBfLnRvRmluaXRlKEluZmluaXR5KTsKICAgKiAvLyA9PiAxLjc5NzY5MzEzNDg2MjMxNTdlKzMwOAogICAqCiAgICogXy50b0Zpbml0ZSgnMy4yJyk7CiAgICogLy8gPT4gMy4yCiAgICovCiAgZnVuY3Rpb24gdG9GaW5pdGUodmFsdWUpIHsKICAgIGlmICghdmFsdWUpIHsKICAgICAgcmV0dXJuIHZhbHVlID09PSAwID8gdmFsdWUgOiAwOwogICAgfQogICAgdmFsdWUgPSB0b051bWJlcih2YWx1ZSk7CiAgICBpZiAodmFsdWUgPT09IElORklOSVRZIHx8IHZhbHVlID09PSAtSU5GSU5JVFkpIHsKICAgICAgdmFyIHNpZ24gPSAodmFsdWUgPCAwID8gLTEgOiAxKTsKICAgICAgcmV0dXJuIHNpZ24gKiBNQVhfSU5URUdFUjsKICAgIH0KICAgIHJldHVybiB2YWx1ZSA9PT0gdmFsdWUgPyB2YWx1ZSA6IDA7CiAgfQoKICAvKioKICAgKiBDb252ZXJ0cyBgdmFsdWVgIHRvIGFuIGludGVnZXIuCiAgICoKICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgbG9vc2VseSBiYXNlZCBvbgogICAqIFtgVG9JbnRlZ2VyYF0oaHR0cDovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLXRvaW50ZWdlcikuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbnZlcnQuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgY29udmVydGVkIGludGVnZXIuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8udG9JbnRlZ2VyKDMuMik7CiAgICogLy8gPT4gMwogICAqCiAgICogXy50b0ludGVnZXIoTnVtYmVyLk1JTl9WQUxVRSk7CiAgICogLy8gPT4gMAogICAqCiAgICogXy50b0ludGVnZXIoSW5maW5pdHkpOwogICAqIC8vID0+IDEuNzk3NjkzMTM0ODYyMzE1N2UrMzA4CiAgICoKICAgKiBfLnRvSW50ZWdlcignMy4yJyk7CiAgICogLy8gPT4gMwogICAqLwogIGZ1bmN0aW9uIHRvSW50ZWdlcih2YWx1ZSkgewogICAgdmFyIHJlc3VsdCA9IHRvRmluaXRlKHZhbHVlKSwKICAgICAgICByZW1haW5kZXIgPSByZXN1bHQgJSAxOwoKICAgIHJldHVybiByZXN1bHQgPT09IHJlc3VsdCA/IChyZW1haW5kZXIgPyByZXN1bHQgLSByZW1haW5kZXIgOiByZXN1bHQpIDogMDsKICB9CgogIC8qKgogICAqIENvbnZlcnRzIGB2YWx1ZWAgdG8gYW4gaW50ZWdlciBzdWl0YWJsZSBmb3IgdXNlIGFzIHRoZSBsZW5ndGggb2YgYW4KICAgKiBhcnJheS1saWtlIG9iamVjdC4KICAgKgogICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBpcyBiYXNlZCBvbgogICAqIFtgVG9MZW5ndGhgXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy10b2xlbmd0aCkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbnZlcnQuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgY29udmVydGVkIGludGVnZXIuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8udG9MZW5ndGgoMy4yKTsKICAgKiAvLyA9PiAzCiAgICoKICAgKiBfLnRvTGVuZ3RoKE51bWJlci5NSU5fVkFMVUUpOwogICAqIC8vID0+IDAKICAgKgogICAqIF8udG9MZW5ndGgoSW5maW5pdHkpOwogICAqIC8vID0+IDQyOTQ5NjcyOTUKICAgKgogICAqIF8udG9MZW5ndGgoJzMuMicpOwogICAqIC8vID0+IDMKICAgKi8KICBmdW5jdGlvbiB0b0xlbmd0aCh2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlID8gYmFzZUNsYW1wKHRvSW50ZWdlcih2YWx1ZSksIDAsIE1BWF9BUlJBWV9MRU5HVEgpIDogMDsKICB9CgogIC8qKgogICAqIENvbnZlcnRzIGB2YWx1ZWAgdG8gYSBudW1iZXIuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHByb2Nlc3MuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgbnVtYmVyLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnRvTnVtYmVyKDMuMik7CiAgICogLy8gPT4gMy4yCiAgICoKICAgKiBfLnRvTnVtYmVyKE51bWJlci5NSU5fVkFMVUUpOwogICAqIC8vID0+IDVlLTMyNAogICAqCiAgICogXy50b051bWJlcihJbmZpbml0eSk7CiAgICogLy8gPT4gSW5maW5pdHkKICAgKgogICAqIF8udG9OdW1iZXIoJzMuMicpOwogICAqIC8vID0+IDMuMgogICAqLwogIGZ1bmN0aW9uIHRvTnVtYmVyKHZhbHVlKSB7CiAgICBpZiAodHlwZW9mIHZhbHVlID09ICdudW1iZXInKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIGlmIChpc1N5bWJvbCh2YWx1ZSkpIHsKICAgICAgcmV0dXJuIE5BTjsKICAgIH0KICAgIGlmIChpc09iamVjdCh2YWx1ZSkpIHsKICAgICAgdmFyIG90aGVyID0gdHlwZW9mIHZhbHVlLnZhbHVlT2YgPT0gJ2Z1bmN0aW9uJyA/IHZhbHVlLnZhbHVlT2YoKSA6IHZhbHVlOwogICAgICB2YWx1ZSA9IGlzT2JqZWN0KG90aGVyKSA/IChvdGhlciArICcnKSA6IG90aGVyOwogICAgfQogICAgaWYgKHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgewogICAgICByZXR1cm4gdmFsdWUgPT09IDAgPyB2YWx1ZSA6ICt2YWx1ZTsKICAgIH0KICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZShyZVRyaW0sICcnKTsKICAgIHZhciBpc0JpbmFyeSA9IHJlSXNCaW5hcnkudGVzdCh2YWx1ZSk7CiAgICByZXR1cm4gKGlzQmluYXJ5IHx8IHJlSXNPY3RhbC50ZXN0KHZhbHVlKSkKICAgICAgPyBmcmVlUGFyc2VJbnQodmFsdWUuc2xpY2UoMiksIGlzQmluYXJ5ID8gMiA6IDgpCiAgICAgIDogKHJlSXNCYWRIZXgudGVzdCh2YWx1ZSkgPyBOQU4gOiArdmFsdWUpOwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYHZhbHVlYCB0byBhIHBsYWluIG9iamVjdCBmbGF0dGVuaW5nIGluaGVyaXRlZCBlbnVtZXJhYmxlIHN0cmluZwogICAqIGtleWVkIHByb3BlcnRpZXMgb2YgYHZhbHVlYCB0byBvd24gcHJvcGVydGllcyBvZiB0aGUgcGxhaW4gb2JqZWN0LgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDMuMC4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb252ZXJ0LgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBwbGFpbiBvYmplY3QuCiAgICogQGV4YW1wbGUKICAgKgogICAqIGZ1bmN0aW9uIEZvbygpIHsKICAgKiAgIHRoaXMuYiA9IDI7CiAgICogfQogICAqCiAgICogRm9vLnByb3RvdHlwZS5jID0gMzsKICAgKgogICAqIF8uYXNzaWduKHsgJ2EnOiAxIH0sIG5ldyBGb28pOwogICAqIC8vID0+IHsgJ2EnOiAxLCAnYic6IDIgfQogICAqCiAgICogXy5hc3NpZ24oeyAnYSc6IDEgfSwgXy50b1BsYWluT2JqZWN0KG5ldyBGb28pKTsKICAgKiAvLyA9PiB7ICdhJzogMSwgJ2InOiAyLCAnYyc6IDMgfQogICAqLwogIGZ1bmN0aW9uIHRvUGxhaW5PYmplY3QodmFsdWUpIHsKICAgIHJldHVybiBjb3B5T2JqZWN0KHZhbHVlLCBrZXlzSW4odmFsdWUpKTsKICB9CgogIC8qKgogICAqIENvbnZlcnRzIGB2YWx1ZWAgdG8gYSBzYWZlIGludGVnZXIuIEEgc2FmZSBpbnRlZ2VyIGNhbiBiZSBjb21wYXJlZCBhbmQKICAgKiByZXByZXNlbnRlZCBjb3JyZWN0bHkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbnZlcnQuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgY29udmVydGVkIGludGVnZXIuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8udG9TYWZlSW50ZWdlcigzLjIpOwogICAqIC8vID0+IDMKICAgKgogICAqIF8udG9TYWZlSW50ZWdlcihOdW1iZXIuTUlOX1ZBTFVFKTsKICAgKiAvLyA9PiAwCiAgICoKICAgKiBfLnRvU2FmZUludGVnZXIoSW5maW5pdHkpOwogICAqIC8vID0+IDkwMDcxOTkyNTQ3NDA5OTEKICAgKgogICAqIF8udG9TYWZlSW50ZWdlcignMy4yJyk7CiAgICogLy8gPT4gMwogICAqLwogIGZ1bmN0aW9uIHRvU2FmZUludGVnZXIodmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZQogICAgICA/IGJhc2VDbGFtcCh0b0ludGVnZXIodmFsdWUpLCAtTUFYX1NBRkVfSU5URUdFUiwgTUFYX1NBRkVfSU5URUdFUikKICAgICAgOiAodmFsdWUgPT09IDAgPyB2YWx1ZSA6IDApOwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYHZhbHVlYCB0byBhIHN0cmluZy4gQW4gZW1wdHkgc3RyaW5nIGlzIHJldHVybmVkIGZvciBgbnVsbGAKICAgKiBhbmQgYHVuZGVmaW5lZGAgdmFsdWVzLiBUaGUgc2lnbiBvZiBgLTBgIGlzIHByZXNlcnZlZC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29udmVydC4KICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBjb252ZXJ0ZWQgc3RyaW5nLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnRvU3RyaW5nKG51bGwpOwogICAqIC8vID0+ICcnCiAgICoKICAgKiBfLnRvU3RyaW5nKC0wKTsKICAgKiAvLyA9PiAnLTAnCiAgICoKICAgKiBfLnRvU3RyaW5nKFsxLCAyLCAzXSk7CiAgICogLy8gPT4gJzEsMiwzJwogICAqLwogIGZ1bmN0aW9uIHRvU3RyaW5nKHZhbHVlKSB7CiAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCA/ICcnIDogYmFzZVRvU3RyaW5nKHZhbHVlKTsKICB9CgogIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCiAgLyoqCiAgICogR2V0cyB0aGUgdmFsdWUgYXQgYHBhdGhgIG9mIGBvYmplY3RgLiBJZiB0aGUgcmVzb2x2ZWQgdmFsdWUgaXMKICAgKiBgdW5kZWZpbmVkYCwgdGhlIGBkZWZhdWx0VmFsdWVgIGlzIHJldHVybmVkIGluIGl0cyBwbGFjZS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjcuMAogICAqIEBjYXRlZ29yeSBPYmplY3QKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuCiAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggb2YgdGhlIHByb3BlcnR5IHRvIGdldC4KICAgKiBAcGFyYW0geyp9IFtkZWZhdWx0VmFsdWVdIFRoZSB2YWx1ZSByZXR1cm5lZCBmb3IgYHVuZGVmaW5lZGAgcmVzb2x2ZWQgdmFsdWVzLgogICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSByZXNvbHZlZCB2YWx1ZS4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIG9iamVjdCA9IHsgJ2EnOiBbeyAnYic6IHsgJ2MnOiAzIH0gfV0gfTsKICAgKgogICAqIF8uZ2V0KG9iamVjdCwgJ2FbMF0uYi5jJyk7CiAgICogLy8gPT4gMwogICAqCiAgICogXy5nZXQob2JqZWN0LCBbJ2EnLCAnMCcsICdiJywgJ2MnXSk7CiAgICogLy8gPT4gMwogICAqCiAgICogXy5nZXQob2JqZWN0LCAnYS5iLmMnLCAnZGVmYXVsdCcpOwogICAqIC8vID0+ICdkZWZhdWx0JwogICAqLwogIGZ1bmN0aW9uIGdldChvYmplY3QsIHBhdGgsIGRlZmF1bHRWYWx1ZSkgewogICAgdmFyIHJlc3VsdCA9IG9iamVjdCA9PSBudWxsID8gdW5kZWZpbmVkIDogYmFzZUdldChvYmplY3QsIHBhdGgpOwogICAgcmV0dXJuIHJlc3VsdCA9PT0gdW5kZWZpbmVkID8gZGVmYXVsdFZhbHVlIDogcmVzdWx0OwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGBwYXRoYCBpcyBhIGRpcmVjdCBvciBpbmhlcml0ZWQgcHJvcGVydHkgb2YgYG9iamVjdGAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgT2JqZWN0CiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7QXJyYXl8c3RyaW5nfSBwYXRoIFRoZSBwYXRoIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgcGF0aGAgZXhpc3RzLCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBvYmplY3QgPSBfLmNyZWF0ZSh7ICdhJzogXy5jcmVhdGUoeyAnYic6IDIgfSkgfSk7CiAgICoKICAgKiBfLmhhc0luKG9iamVjdCwgJ2EnKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmhhc0luKG9iamVjdCwgJ2EuYicpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaGFzSW4ob2JqZWN0LCBbJ2EnLCAnYiddKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmhhc0luKG9iamVjdCwgJ2InKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGhhc0luKG9iamVjdCwgcGF0aCkgewogICAgcmV0dXJuIG9iamVjdCAhPSBudWxsICYmIGhhc1BhdGgob2JqZWN0LCBwYXRoLCBiYXNlSGFzSW4pOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB0aGUgb3duIGVudW1lcmFibGUgcHJvcGVydHkgbmFtZXMgb2YgYG9iamVjdGAuCiAgICoKICAgKiAqKk5vdGU6KiogTm9uLW9iamVjdCB2YWx1ZXMgYXJlIGNvZXJjZWQgdG8gb2JqZWN0cy4gU2VlIHRoZQogICAqIFtFUyBzcGVjXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1vYmplY3Qua2V5cykKICAgKiBmb3IgbW9yZSBkZXRhaWxzLgogICAqCiAgICogQHN0YXRpYwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBtZW1iZXJPZiBfCiAgICogQGNhdGVnb3J5IE9iamVjdAogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBmdW5jdGlvbiBGb28oKSB7CiAgICogICB0aGlzLmEgPSAxOwogICAqICAgdGhpcy5iID0gMjsKICAgKiB9CiAgICoKICAgKiBGb28ucHJvdG90eXBlLmMgPSAzOwogICAqCiAgICogXy5rZXlzKG5ldyBGb28pOwogICAqIC8vID0+IFsnYScsICdiJ10gKGl0ZXJhdGlvbiBvcmRlciBpcyBub3QgZ3VhcmFudGVlZCkKICAgKgogICAqIF8ua2V5cygnaGknKTsKICAgKiAvLyA9PiBbJzAnLCAnMSddCiAgICovCiAgZnVuY3Rpb24ga2V5cyhvYmplY3QpIHsKICAgIHJldHVybiBpc0FycmF5TGlrZShvYmplY3QpID8gYXJyYXlMaWtlS2V5cyhvYmplY3QpIDogYmFzZUtleXMob2JqZWN0KTsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYW4gYXJyYXkgb2YgdGhlIG93biBhbmQgaW5oZXJpdGVkIGVudW1lcmFibGUgcHJvcGVydHkgbmFtZXMgb2YgYG9iamVjdGAuCiAgICoKICAgKiAqKk5vdGU6KiogTm9uLW9iamVjdCB2YWx1ZXMgYXJlIGNvZXJjZWQgdG8gb2JqZWN0cy4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjAuMAogICAqIEBjYXRlZ29yeSBPYmplY3QKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcy4KICAgKiBAZXhhbXBsZQogICAqCiAgICogZnVuY3Rpb24gRm9vKCkgewogICAqICAgdGhpcy5hID0gMTsKICAgKiAgIHRoaXMuYiA9IDI7CiAgICogfQogICAqCiAgICogRm9vLnByb3RvdHlwZS5jID0gMzsKICAgKgogICAqIF8ua2V5c0luKG5ldyBGb28pOwogICAqIC8vID0+IFsnYScsICdiJywgJ2MnXSAoaXRlcmF0aW9uIG9yZGVyIGlzIG5vdCBndWFyYW50ZWVkKQogICAqLwogIGZ1bmN0aW9uIGtleXNJbihvYmplY3QpIHsKICAgIHJldHVybiBpc0FycmF5TGlrZShvYmplY3QpID8gYXJyYXlMaWtlS2V5cyhvYmplY3QsIHRydWUpIDogYmFzZUtleXNJbihvYmplY3QpOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB0aGUgb3duIGVudW1lcmFibGUgc3RyaW5nIGtleWVkIHByb3BlcnR5IHZhbHVlcyBvZiBgb2JqZWN0YC4KICAgKgogICAqICoqTm90ZToqKiBOb24tb2JqZWN0IHZhbHVlcyBhcmUgY29lcmNlZCB0byBvYmplY3RzLgogICAqCiAgICogQHN0YXRpYwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBtZW1iZXJPZiBfCiAgICogQGNhdGVnb3J5IE9iamVjdAogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IHZhbHVlcy4KICAgKiBAZXhhbXBsZQogICAqCiAgICogZnVuY3Rpb24gRm9vKCkgewogICAqICAgdGhpcy5hID0gMTsKICAgKiAgIHRoaXMuYiA9IDI7CiAgICogfQogICAqCiAgICogRm9vLnByb3RvdHlwZS5jID0gMzsKICAgKgogICAqIF8udmFsdWVzKG5ldyBGb28pOwogICAqIC8vID0+IFsxLCAyXSAoaXRlcmF0aW9uIG9yZGVyIGlzIG5vdCBndWFyYW50ZWVkKQogICAqCiAgICogXy52YWx1ZXMoJ2hpJyk7CiAgICogLy8gPT4gWydoJywgJ2knXQogICAqLwogIGZ1bmN0aW9uIHZhbHVlcyhvYmplY3QpIHsKICAgIHJldHVybiBvYmplY3QgPT0gbnVsbCA/IFtdIDogYmFzZVZhbHVlcyhvYmplY3QsIGtleXMob2JqZWN0KSk7CiAgfQoKICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgogIC8qKgogICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgYHZhbHVlYC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAyLjQuMAogICAqIEBjYXRlZ29yeSBVdGlsCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcmV0dXJuIGZyb20gdGhlIG5ldyBmdW5jdGlvbi4KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBjb25zdGFudCBmdW5jdGlvbi4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIG9iamVjdHMgPSBfLnRpbWVzKDIsIF8uY29uc3RhbnQoeyAnYSc6IDEgfSkpOwogICAqCiAgICogY29uc29sZS5sb2cob2JqZWN0cyk7CiAgICogLy8gPT4gW3sgJ2EnOiAxIH0sIHsgJ2EnOiAxIH1dCiAgICoKICAgKiBjb25zb2xlLmxvZyhvYmplY3RzWzBdID09PSBvYmplY3RzWzFdKTsKICAgKiAvLyA9PiB0cnVlCiAgICovCiAgZnVuY3Rpb24gY29uc3RhbnQodmFsdWUpIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfTsKICB9CgogIC8qKgogICAqIFRoaXMgbWV0aG9kIHJldHVybnMgdGhlIGZpcnN0IGFyZ3VtZW50IGl0IHJlY2VpdmVzLgogICAqCiAgICogQHN0YXRpYwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBtZW1iZXJPZiBfCiAgICogQGNhdGVnb3J5IFV0aWwKICAgKiBAcGFyYW0geyp9IHZhbHVlIEFueSB2YWx1ZS4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyBgdmFsdWVgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgb2JqZWN0ID0geyAnYSc6IDEgfTsKICAgKgogICAqIGNvbnNvbGUubG9nKF8uaWRlbnRpdHkob2JqZWN0KSA9PT0gb2JqZWN0KTsKICAgKiAvLyA9PiB0cnVlCiAgICovCiAgZnVuY3Rpb24gaWRlbnRpdHkodmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZTsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IGludm9rZXMgYGZ1bmNgIHdpdGggdGhlIGFyZ3VtZW50cyBvZiB0aGUgY3JlYXRlZAogICAqIGZ1bmN0aW9uLiBJZiBgZnVuY2AgaXMgYSBwcm9wZXJ0eSBuYW1lLCB0aGUgY3JlYXRlZCBmdW5jdGlvbiByZXR1cm5zIHRoZQogICAqIHByb3BlcnR5IHZhbHVlIGZvciBhIGdpdmVuIGVsZW1lbnQuIElmIGBmdW5jYCBpcyBhbiBhcnJheSBvciBvYmplY3QsIHRoZQogICAqIGNyZWF0ZWQgZnVuY3Rpb24gcmV0dXJucyBgdHJ1ZWAgZm9yIGVsZW1lbnRzIHRoYXQgY29udGFpbiB0aGUgZXF1aXZhbGVudAogICAqIHNvdXJjZSBwcm9wZXJ0aWVzLCBvdGhlcndpc2UgaXQgcmV0dXJucyBgZmFsc2VgLgogICAqCiAgICogQHN0YXRpYwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBtZW1iZXJPZiBfCiAgICogQGNhdGVnb3J5IFV0aWwKICAgKiBAcGFyYW0geyp9IFtmdW5jPV8uaWRlbnRpdHldIFRoZSB2YWx1ZSB0byBjb252ZXJ0IHRvIGEgY2FsbGJhY2suCiAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBjYWxsYmFjay4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIHVzZXJzID0gWwogICAqICAgeyAndXNlcic6ICdiYXJuZXknLCAnYWdlJzogMzYsICdhY3RpdmUnOiB0cnVlIH0sCiAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICdhZ2UnOiA0MCwgJ2FjdGl2ZSc6IGZhbHNlIH0KICAgKiBdOwogICAqCiAgICogLy8gVGhlIGBfLm1hdGNoZXNgIGl0ZXJhdGVlIHNob3J0aGFuZC4KICAgKiBfLmZpbHRlcih1c2VycywgXy5pdGVyYXRlZSh7ICd1c2VyJzogJ2Jhcm5leScsICdhY3RpdmUnOiB0cnVlIH0pKTsKICAgKiAvLyA9PiBbeyAndXNlcic6ICdiYXJuZXknLCAnYWdlJzogMzYsICdhY3RpdmUnOiB0cnVlIH1dCiAgICoKICAgKiAvLyBUaGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy5maWx0ZXIodXNlcnMsIF8uaXRlcmF0ZWUoWyd1c2VyJywgJ2ZyZWQnXSkpOwogICAqIC8vID0+IFt7ICd1c2VyJzogJ2ZyZWQnLCAnYWdlJzogNDAgfV0KICAgKgogICAqIC8vIFRoZSBgXy5wcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLgogICAqIF8ubWFwKHVzZXJzLCBfLml0ZXJhdGVlKCd1c2VyJykpOwogICAqIC8vID0+IFsnYmFybmV5JywgJ2ZyZWQnXQogICAqCiAgICogLy8gQ3JlYXRlIGN1c3RvbSBpdGVyYXRlZSBzaG9ydGhhbmRzLgogICAqIF8uaXRlcmF0ZWUgPSBfLndyYXAoXy5pdGVyYXRlZSwgZnVuY3Rpb24oaXRlcmF0ZWUsIGZ1bmMpIHsKICAgKiAgIHJldHVybiAhXy5pc1JlZ0V4cChmdW5jKSA/IGl0ZXJhdGVlKGZ1bmMpIDogZnVuY3Rpb24oc3RyaW5nKSB7CiAgICogICAgIHJldHVybiBmdW5jLnRlc3Qoc3RyaW5nKTsKICAgKiAgIH07CiAgICogfSk7CiAgICoKICAgKiBfLmZpbHRlcihbJ2FiYycsICdkZWYnXSwgL2VmLyk7CiAgICogLy8gPT4gWydkZWYnXQogICAqLwogIGZ1bmN0aW9uIGl0ZXJhdGVlKGZ1bmMpIHsKICAgIHJldHVybiBiYXNlSXRlcmF0ZWUodHlwZW9mIGZ1bmMgPT0gJ2Z1bmN0aW9uJyA/IGZ1bmMgOiBiYXNlQ2xvbmUoZnVuYywgQ0xPTkVfREVFUF9GTEFHKSk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCByZXR1cm5zIGB1bmRlZmluZWRgLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDIuMy4wCiAgICogQGNhdGVnb3J5IFV0aWwKICAgKiBAZXhhbXBsZQogICAqCiAgICogXy50aW1lcygyLCBfLm5vb3ApOwogICAqIC8vID0+IFt1bmRlZmluZWQsIHVuZGVmaW5lZF0KICAgKi8KICBmdW5jdGlvbiBub29wKCkgewogICAgLy8gTm8gb3BlcmF0aW9uIHBlcmZvcm1lZC4KICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgdGhlIHZhbHVlIGF0IGBwYXRoYCBvZiBhIGdpdmVuIG9iamVjdC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAyLjQuMAogICAqIEBjYXRlZ29yeSBVdGlsCiAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggb2YgdGhlIHByb3BlcnR5IHRvIGdldC4KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBhY2Nlc3NvciBmdW5jdGlvbi4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIG9iamVjdHMgPSBbCiAgICogICB7ICdhJzogeyAnYic6IDIgfSB9LAogICAqICAgeyAnYSc6IHsgJ2InOiAxIH0gfQogICAqIF07CiAgICoKICAgKiBfLm1hcChvYmplY3RzLCBfLnByb3BlcnR5KCdhLmInKSk7CiAgICogLy8gPT4gWzIsIDFdCiAgICoKICAgKiBfLm1hcChfLnNvcnRCeShvYmplY3RzLCBfLnByb3BlcnR5KFsnYScsICdiJ10pKSwgJ2EuYicpOwogICAqIC8vID0+IFsxLCAyXQogICAqLwogIGZ1bmN0aW9uIHByb3BlcnR5KHBhdGgpIHsKICAgIHJldHVybiBpc0tleShwYXRoKSA/IGJhc2VQcm9wZXJ0eSh0b0tleShwYXRoKSkgOiBiYXNlUHJvcGVydHlEZWVwKHBhdGgpOwogIH0KCiAgLyoqCiAgICogVGhpcyBtZXRob2QgcmV0dXJucyBhIG5ldyBlbXB0eSBhcnJheS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjEzLjAKICAgKiBAY2F0ZWdvcnkgVXRpbAogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGVtcHR5IGFycmF5LgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgYXJyYXlzID0gXy50aW1lcygyLCBfLnN0dWJBcnJheSk7CiAgICoKICAgKiBjb25zb2xlLmxvZyhhcnJheXMpOwogICAqIC8vID0+IFtbXSwgW11dCiAgICoKICAgKiBjb25zb2xlLmxvZyhhcnJheXNbMF0gPT09IGFycmF5c1sxXSk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBzdHViQXJyYXkoKSB7CiAgICByZXR1cm4gW107CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCByZXR1cm5zIGBmYWxzZWAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4xMy4wCiAgICogQGNhdGVnb3J5IFV0aWwKICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnRpbWVzKDIsIF8uc3R1YkZhbHNlKTsKICAgKiAvLyA9PiBbZmFsc2UsIGZhbHNlXQogICAqLwogIGZ1bmN0aW9uIHN0dWJGYWxzZSgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCiAgLy8gQWRkIG1ldGhvZHMgdGhhdCByZXR1cm4gd3JhcHBlZCB2YWx1ZXMgaW4gY2hhaW4gc2VxdWVuY2VzLgogIGxvZGFzaC5jYXN0QXJyYXkgPSBjYXN0QXJyYXk7CiAgbG9kYXNoLmNodW5rID0gY2h1bms7CiAgbG9kYXNoLmNvbXBhY3QgPSBjb21wYWN0OwogIGxvZGFzaC5jb25jYXQgPSBjb25jYXQ7CiAgbG9kYXNoLmNvbnN0YW50ID0gY29uc3RhbnQ7CiAgbG9kYXNoLmRpZmZlcmVuY2UgPSBkaWZmZXJlbmNlOwogIGxvZGFzaC5kaWZmZXJlbmNlQnkgPSBkaWZmZXJlbmNlQnk7CiAgbG9kYXNoLmRpZmZlcmVuY2VXaXRoID0gZGlmZmVyZW5jZVdpdGg7CiAgbG9kYXNoLmRyb3AgPSBkcm9wOwogIGxvZGFzaC5kcm9wUmlnaHQgPSBkcm9wUmlnaHQ7CiAgbG9kYXNoLmRyb3BSaWdodFdoaWxlID0gZHJvcFJpZ2h0V2hpbGU7CiAgbG9kYXNoLmRyb3BXaGlsZSA9IGRyb3BXaGlsZTsKICBsb2Rhc2guZmlsbCA9IGZpbGw7CiAgbG9kYXNoLmZsYXR0ZW4gPSBmbGF0dGVuOwogIGxvZGFzaC5mbGF0dGVuRGVlcCA9IGZsYXR0ZW5EZWVwOwogIGxvZGFzaC5mbGF0dGVuRGVwdGggPSBmbGF0dGVuRGVwdGg7CiAgbG9kYXNoLmZyb21QYWlycyA9IGZyb21QYWlyczsKICBsb2Rhc2guaW5pdGlhbCA9IGluaXRpYWw7CiAgbG9kYXNoLmludGVyc2VjdGlvbiA9IGludGVyc2VjdGlvbjsKICBsb2Rhc2guaW50ZXJzZWN0aW9uQnkgPSBpbnRlcnNlY3Rpb25CeTsKICBsb2Rhc2guaW50ZXJzZWN0aW9uV2l0aCA9IGludGVyc2VjdGlvbldpdGg7CiAgbG9kYXNoLml0ZXJhdGVlID0gaXRlcmF0ZWU7CiAgbG9kYXNoLmtleXMgPSBrZXlzOwogIGxvZGFzaC5rZXlzSW4gPSBrZXlzSW47CiAgbG9kYXNoLm1lbW9pemUgPSBtZW1vaXplOwogIGxvZGFzaC5wcm9wZXJ0eSA9IHByb3BlcnR5OwogIGxvZGFzaC5wdWxsID0gcHVsbDsKICBsb2Rhc2gucHVsbEFsbCA9IHB1bGxBbGw7CiAgbG9kYXNoLnB1bGxBbGxCeSA9IHB1bGxBbGxCeTsKICBsb2Rhc2gucHVsbEFsbFdpdGggPSBwdWxsQWxsV2l0aDsKICBsb2Rhc2gucHVsbEF0ID0gcHVsbEF0OwogIGxvZGFzaC5yZW1vdmUgPSByZW1vdmU7CiAgbG9kYXNoLnJldmVyc2UgPSByZXZlcnNlOwogIGxvZGFzaC5zbGljZSA9IHNsaWNlOwogIGxvZGFzaC5zb3J0ZWRVbmlxID0gc29ydGVkVW5pcTsKICBsb2Rhc2guc29ydGVkVW5pcUJ5ID0gc29ydGVkVW5pcUJ5OwogIGxvZGFzaC50YWlsID0gdGFpbDsKICBsb2Rhc2gudGFrZSA9IHRha2U7CiAgbG9kYXNoLnRha2VSaWdodCA9IHRha2VSaWdodDsKICBsb2Rhc2gudGFrZVJpZ2h0V2hpbGUgPSB0YWtlUmlnaHRXaGlsZTsKICBsb2Rhc2gudGFrZVdoaWxlID0gdGFrZVdoaWxlOwogIGxvZGFzaC50b0FycmF5ID0gdG9BcnJheTsKICBsb2Rhc2gudG9QbGFpbk9iamVjdCA9IHRvUGxhaW5PYmplY3Q7CiAgbG9kYXNoLnVuaW9uID0gdW5pb247CiAgbG9kYXNoLnVuaW9uQnkgPSB1bmlvbkJ5OwogIGxvZGFzaC51bmlvbldpdGggPSB1bmlvbldpdGg7CiAgbG9kYXNoLnVuaXEgPSB1bmlxOwogIGxvZGFzaC51bmlxQnkgPSB1bmlxQnk7CiAgbG9kYXNoLnVuaXFXaXRoID0gdW5pcVdpdGg7CiAgbG9kYXNoLnVuemlwID0gdW56aXA7CiAgbG9kYXNoLnVuemlwV2l0aCA9IHVuemlwV2l0aDsKICBsb2Rhc2gudmFsdWVzID0gdmFsdWVzOwogIGxvZGFzaC53aXRob3V0ID0gd2l0aG91dDsKICBsb2Rhc2gueG9yID0geG9yOwogIGxvZGFzaC54b3JCeSA9IHhvckJ5OwogIGxvZGFzaC54b3JXaXRoID0geG9yV2l0aDsKICBsb2Rhc2guemlwID0gemlwOwogIGxvZGFzaC56aXBPYmplY3QgPSB6aXBPYmplY3Q7CiAgbG9kYXNoLnppcE9iamVjdERlZXAgPSB6aXBPYmplY3REZWVwOwogIGxvZGFzaC56aXBXaXRoID0gemlwV2l0aDsKCiAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKICAvLyBBZGQgbWV0aG9kcyB0aGF0IHJldHVybiB1bndyYXBwZWQgdmFsdWVzIGluIGNoYWluIHNlcXVlbmNlcy4KICBsb2Rhc2guY2xvbmUgPSBjbG9uZTsKICBsb2Rhc2guY2xvbmVEZWVwID0gY2xvbmVEZWVwOwogIGxvZGFzaC5jbG9uZURlZXBXaXRoID0gY2xvbmVEZWVwV2l0aDsKICBsb2Rhc2guY2xvbmVXaXRoID0gY2xvbmVXaXRoOwogIGxvZGFzaC5jb25mb3Jtc1RvID0gY29uZm9ybXNUbzsKICBsb2Rhc2guZXEgPSBlcTsKICBsb2Rhc2guZmluZEluZGV4ID0gZmluZEluZGV4OwogIGxvZGFzaC5maW5kTGFzdEluZGV4ID0gZmluZExhc3RJbmRleDsKICBsb2Rhc2guZ2V0ID0gZ2V0OwogIGxvZGFzaC5ndCA9IGd0OwogIGxvZGFzaC5ndGUgPSBndGU7CiAgbG9kYXNoLmhhc0luID0gaGFzSW47CiAgbG9kYXNoLmhlYWQgPSBoZWFkOwogIGxvZGFzaC5pZGVudGl0eSA9IGlkZW50aXR5OwogIGxvZGFzaC5pbmRleE9mID0gaW5kZXhPZjsKICBsb2Rhc2guaXNBcmd1bWVudHMgPSBpc0FyZ3VtZW50czsKICBsb2Rhc2guaXNBcnJheSA9IGlzQXJyYXk7CiAgbG9kYXNoLmlzQXJyYXlCdWZmZXIgPSBpc0FycmF5QnVmZmVyOwogIGxvZGFzaC5pc0FycmF5TGlrZSA9IGlzQXJyYXlMaWtlOwogIGxvZGFzaC5pc0FycmF5TGlrZU9iamVjdCA9IGlzQXJyYXlMaWtlT2JqZWN0OwogIGxvZGFzaC5pc0Jvb2xlYW4gPSBpc0Jvb2xlYW47CiAgbG9kYXNoLmlzQnVmZmVyID0gaXNCdWZmZXI7CiAgbG9kYXNoLmlzRGF0ZSA9IGlzRGF0ZTsKICBsb2Rhc2guaXNFbGVtZW50ID0gaXNFbGVtZW50OwogIGxvZGFzaC5pc0VtcHR5ID0gaXNFbXB0eTsKICBsb2Rhc2guaXNFcXVhbCA9IGlzRXF1YWw7CiAgbG9kYXNoLmlzRXF1YWxXaXRoID0gaXNFcXVhbFdpdGg7CiAgbG9kYXNoLmlzRXJyb3IgPSBpc0Vycm9yOwogIGxvZGFzaC5pc0Zpbml0ZSA9IGlzRmluaXRlOwogIGxvZGFzaC5pc0Z1bmN0aW9uID0gaXNGdW5jdGlvbjsKICBsb2Rhc2guaXNJbnRlZ2VyID0gaXNJbnRlZ2VyOwogIGxvZGFzaC5pc0xlbmd0aCA9IGlzTGVuZ3RoOwogIGxvZGFzaC5pc01hcCA9IGlzTWFwOwogIGxvZGFzaC5pc01hdGNoID0gaXNNYXRjaDsKICBsb2Rhc2guaXNNYXRjaFdpdGggPSBpc01hdGNoV2l0aDsKICBsb2Rhc2guaXNOYU4gPSBpc05hTjsKICBsb2Rhc2guaXNOYXRpdmUgPSBpc05hdGl2ZTsKICBsb2Rhc2guaXNOaWwgPSBpc05pbDsKICBsb2Rhc2guaXNOdWxsID0gaXNOdWxsOwogIGxvZGFzaC5pc051bWJlciA9IGlzTnVtYmVyOwogIGxvZGFzaC5pc09iamVjdCA9IGlzT2JqZWN0OwogIGxvZGFzaC5pc09iamVjdExpa2UgPSBpc09iamVjdExpa2U7CiAgbG9kYXNoLmlzUGxhaW5PYmplY3QgPSBpc1BsYWluT2JqZWN0OwogIGxvZGFzaC5pc1JlZ0V4cCA9IGlzUmVnRXhwOwogIGxvZGFzaC5pc1NhZmVJbnRlZ2VyID0gaXNTYWZlSW50ZWdlcjsKICBsb2Rhc2guaXNTZXQgPSBpc1NldDsKICBsb2Rhc2guaXNTdHJpbmcgPSBpc1N0cmluZzsKICBsb2Rhc2guaXNTeW1ib2wgPSBpc1N5bWJvbDsKICBsb2Rhc2guaXNUeXBlZEFycmF5ID0gaXNUeXBlZEFycmF5OwogIGxvZGFzaC5pc1VuZGVmaW5lZCA9IGlzVW5kZWZpbmVkOwogIGxvZGFzaC5pc1dlYWtNYXAgPSBpc1dlYWtNYXA7CiAgbG9kYXNoLmlzV2Vha1NldCA9IGlzV2Vha1NldDsKICBsb2Rhc2guam9pbiA9IGpvaW47CiAgbG9kYXNoLmxhc3QgPSBsYXN0OwogIGxvZGFzaC5sYXN0SW5kZXhPZiA9IGxhc3RJbmRleE9mOwogIGxvZGFzaC5sdCA9IGx0OwogIGxvZGFzaC5sdGUgPSBsdGU7CiAgbG9kYXNoLnN0dWJBcnJheSA9IHN0dWJBcnJheTsKICBsb2Rhc2guc3R1YkZhbHNlID0gc3R1YkZhbHNlOwogIGxvZGFzaC5udGggPSBudGg7CiAgbG9kYXNoLm5vb3AgPSBub29wOwogIGxvZGFzaC5zb3J0ZWRJbmRleCA9IHNvcnRlZEluZGV4OwogIGxvZGFzaC5zb3J0ZWRJbmRleEJ5ID0gc29ydGVkSW5kZXhCeTsKICBsb2Rhc2guc29ydGVkSW5kZXhPZiA9IHNvcnRlZEluZGV4T2Y7CiAgbG9kYXNoLnNvcnRlZExhc3RJbmRleCA9IHNvcnRlZExhc3RJbmRleDsKICBsb2Rhc2guc29ydGVkTGFzdEluZGV4QnkgPSBzb3J0ZWRMYXN0SW5kZXhCeTsKICBsb2Rhc2guc29ydGVkTGFzdEluZGV4T2YgPSBzb3J0ZWRMYXN0SW5kZXhPZjsKICBsb2Rhc2gudG9GaW5pdGUgPSB0b0Zpbml0ZTsKICBsb2Rhc2gudG9JbnRlZ2VyID0gdG9JbnRlZ2VyOwogIGxvZGFzaC50b0xlbmd0aCA9IHRvTGVuZ3RoOwogIGxvZGFzaC50b051bWJlciA9IHRvTnVtYmVyOwogIGxvZGFzaC50b1NhZmVJbnRlZ2VyID0gdG9TYWZlSW50ZWdlcjsKICBsb2Rhc2gudG9TdHJpbmcgPSB0b1N0cmluZzsKCiAgLy8gQWRkIGFsaWFzZXMuCiAgbG9kYXNoLmZpcnN0ID0gaGVhZDsKCiAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKICAvKioKICAgKiBUaGUgc2VtYW50aWMgdmVyc2lvbiBudW1iZXIuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAdHlwZSB7c3RyaW5nfQogICAqLwogIGxvZGFzaC5WRVJTSU9OID0gVkVSU0lPTjsKCiAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgogIC8vIFNvbWUgQU1EIGJ1aWxkIG9wdGltaXplcnMsIGxpa2Ugci5qcywgY2hlY2sgZm9yIGNvbmRpdGlvbiBwYXR0ZXJucyBsaWtlOgogIGlmICh0eXBlb2YgZGVmaW5lID09ICdmdW5jdGlvbicgJiYgdHlwZW9mIGRlZmluZS5hbWQgPT0gJ29iamVjdCcgJiYgZGVmaW5lLmFtZCkgewogICAgLy8gRXhwb3NlIExvZGFzaCBvbiB0aGUgZ2xvYmFsIG9iamVjdCB0byBwcmV2ZW50IGVycm9ycyB3aGVuIExvZGFzaCBpcwogICAgLy8gbG9hZGVkIGJ5IGEgc2NyaXB0IHRhZyBpbiB0aGUgcHJlc2VuY2Ugb2YgYW4gQU1EIGxvYWRlci4KICAgIC8vIFNlZSBodHRwOi8vcmVxdWlyZWpzLm9yZy9kb2NzL2Vycm9ycy5odG1sI21pc21hdGNoIGZvciBtb3JlIGRldGFpbHMuCiAgICAvLyBVc2UgYF8ubm9Db25mbGljdGAgdG8gcmVtb3ZlIExvZGFzaCBmcm9tIHRoZSBnbG9iYWwgb2JqZWN0LgogICAgcm9vdC5fID0gbG9kYXNoOwoKICAgIC8vIERlZmluZSBhcyBhbiBhbm9ueW1vdXMgbW9kdWxlIHNvLCB0aHJvdWdoIHBhdGggbWFwcGluZywgaXQgY2FuIGJlCiAgICAvLyByZWZlcmVuY2VkIGFzIHRoZSAidW5kZXJzY29yZSIgbW9kdWxlLgogICAgZGVmaW5lKGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gbG9kYXNoOwogICAgfSk7CiAgfQogIC8vIENoZWNrIGZvciBgZXhwb3J0c2AgYWZ0ZXIgYGRlZmluZWAgaW4gY2FzZSBhIGJ1aWxkIG9wdGltaXplciBhZGRzIGl0LgogIGVsc2UgaWYgKGZyZWVNb2R1bGUpIHsKICAgIC8vIEV4cG9ydCBmb3IgTm9kZS5qcy4KICAgIChmcmVlTW9kdWxlLmV4cG9ydHMgPSBsb2Rhc2gpLl8gPSBsb2Rhc2g7CiAgICAvLyBFeHBvcnQgZm9yIENvbW1vbkpTIHN1cHBvcnQuCiAgICBmcmVlRXhwb3J0cy5fID0gbG9kYXNoOwogIH0KICBlbHNlIHsKICAgIC8vIEV4cG9ydCB0byB0aGUgZ2xvYmFsIG9iamVjdC4KICAgIHJvb3QuXyA9IGxvZGFzaDsKICB9Cn0uY2FsbCh0aGlzKSk7Cg==", "moduleName": "Lodash"}, {"javascript": "LyoqIEBmaWxlIFByb3ZpZGUgYSBHbG9iYWwgc3ltYm9sICovCkVYUE9SVEVEX1NZTUJPTFMgPSBbICdHbG9iYWwnIF07CgovLyBJbXBvcnRhbnQgbm90ZTogVGhpcyBtb2R1bGUgY2FuIG5vdCB1c2UgdGhlIExvZyBtb2R1bGUsIGFzIHRoZSBMb2cKLy8gbW9kdWxlIHVzZXMgdGhpcyBtb2R1bGUuIEFuZCwgaG9uZXN0ZWx5LCB3aGF0IHdvdWxkIHlvdSBsb2c/Ci8vIFJpZ2h0LiBKdXN0IGRvbid0IGRvIGl0LiBOb3csIG1vdmUgYWxvbmcsIG5vdGhpbmcgdG8gc2VlIGhlcmUuCgovKioKICogUHJvdmlkZSBjb25zaXN0ZW50IGFjY2VzcyB0byB0aGUgR2xvYmFsIHZhcmlhYmxlLgogKgogKiBXaGVuIHVzZWQsIHRoaXMgbW9kdWxlIHdpbGwgaW50cm9kdWNlIGEgZ2xvYmFsIHZhcmlhYmxlIGNhbGxlZAogKiBgR2xvYmFsYCwgdGhhdCBpcyBhIHJlZmVyZW5jZSB0byB0aGUgdG9wbGV2ZWwgR2xvYmFsIG9iamVjdC4KICogCiAqIFRoaXMgbW9kdWxlIGRvZXMgbm90IHByb3ZpZGUgYW55IG1ldGhvZHMgb3IgbWVtYmVyLCBiZXNpZGVzIHRoZQogKiBHbG9iYWwgdmFyaWFibGUuCiAqCiAqIEB0eXBlIHtvYmplY3R9CiAqIEBleGFtcGxlCi8vIFRoaXMgbG9hZHMgdGhlIEdsb2JhbCBtb2R1bGUsIGFuZCBjcmVhdGVzIGEgdmFyaWFibGUgY2FsbGVkIEdsb2JhbAp1c2UoICJHbG9iYWwiICk7CiogQG5hbWVzcGFjZQogKiBAbmFtZSBHbG9iYWwgKi8KdmFyIEdsb2JhbCA9IGZ1bmN0aW9uKCApIHsKICAgIC8qKiBHZXQgYWNjZXNzIHRvIHRoZSBHbG9iYWwgdmFyaWFibGUuCiAgICAgKiAKICAgICAqIFRoaXMgZnVuY3Rpb24gcmV0dXJucyBhIHJlZmVyZW5jZSB0byB0aGUgdG9wbGV2ZWwgR2xvYmFsCiAgICAgKiB2YXJpYWJsZS4gSW4gbm9uLWJyb3dzZXIgZW52aXJvbm1lbnRzLCB0aGlzIGlzIGVxdWFsIHRvIHRoZQogICAgICogdGhpcyB2YXJpYWJsZSBhdCB0b3BsZXZlbCBzY29wZSwgYnV0IHJlcXVpcmVzIGEgYml0IG1vcmUgdG8gZ2V0CiAgICAgKiB0bywgaWYgbm90IGEgdG9wbGV2ZWwgc2NvcGUuCiAgICAgKiAKICAgICAqIEB0eXBle2Z1bmN0aW9ufQogICAgICogQHByaXZhdGUKICAgICAqIEByZXR1cm4ge29iamVjdH0gQSByZWZlcmVuY2UgdG8gdGhlIGdsb2JhbCBvYmplY3QgKi8KICAgIHZhciBnZXRHbG9iYWwgPSBmdW5jdGlvbiggKSB7CiAgICAgICAgcmV0dXJuICggZnVuY3Rpb24oICkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0gKSggKTsKICAgIH07CiAgICAvLyByZXR1cm4gcmVzdWx0IG9mIGNhbGwgdG8gZ2V0R2xvYmFsLCBpLmUuIHJlZiB0byBnbG9iYWwKICAgIHJldHVybiBnZXRHbG9iYWwoICk7Cn0oICk7Cg==", "moduleName": "Global"}, {"javascript": "LyoqIEBmaWxlIE1vZHVsZSB0aGF0IHByb2R1Y2VzIGFkbWluaXN0cmF0aXZlIGRhdGEuICovCgpFWFBPUlRFRF9TWU1CT0xTID0gWyAnQWRtaW5EYXRhJyBdOwoKdXNlKCAiTG9nIiApOwp1c2UoICJYbWxVdGlsIiApOwp1c2UoICJVdGlsIiApOwoKCi8qKgogKiBNb2R1bGUgdGhhdCBwcm9kdWNlcyBhZG1pbmlzdHJhdGl2ZSBkYXRhIChYTUwpIGZvciB0aGUgZGF0YXdlbGwuCiAqCiAqIEB0eXBlIHtuYW1lc3BhY2V9CiAqIEBuYW1lc3BhY2UKICovCnZhciBBZG1pbkRhdGEgPSBmdW5jdGlvbigpIHsKCiAgICBMb2cuaW5mbyggIkVudGVyaW5nOiBBZG1pbkRhdGEgbW9kdWxlIiApOwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgVGluZyB4bWwgY29udGFpbmVyIGluc3RhbmNlLCBhbmQgYWRkcyBuYW1lc3BhY2VzLgogICAgICoKICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IEFkbWluRGF0YS5jcmVhdGVUaW5nQ29udGFpbmVyKCApCiAgICAgKiBAcmV0dXJuIHtYTUx9IFRpbmcgY29udGFpbmVyIFhNTCBvYmplY3QKICAgICAqIEBleGFtcGxlIEFkbWluRGF0YS5jcmVhdGVUaW5nQ29udGFpbmVyKCApCiAgICAgKiBAbmFtZSBBZG1pbkRhdGEuY3JlYXRlVGluZ0NvbnRhaW5lcgogICAgICogQGZ1bmN0aW9uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNyZWF0ZVRpbmdDb250YWluZXIgKCApIHsKCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmc6IEFkbWluRGF0YS5jcmVhdGVUaW5nQ29udGFpbmVyIGZ1bmN0aW9uIiApOwoKICAgICAgICB2YXIgY29udGFpbmVyID0gWG1sVXRpbC5jcmVhdGVEb2N1bWVudCggImNvbnRhaW5lciIsIFhtbE5hbWVzcGFjZXMudGluZyApOwogICAgICAgIFhtbFV0aWwuYWRkRG9jdW1lbnROYW1lc3BhY2UoY29udGFpbmVyLCBYbWxOYW1lc3BhY2VzLmRrYWJtICk7CiAgICAgICAgWG1sVXRpbC5hZGREb2N1bWVudE5hbWVzcGFjZShjb250YWluZXIsIFhtbE5hbWVzcGFjZXMuYWMgKTsKICAgICAgICBYbWxVdGlsLmFkZERvY3VtZW50TmFtZXNwYWNlKGNvbnRhaW5lciwgWG1sTmFtZXNwYWNlcy5ka2RjcGx1cyApOwogICAgICAgIFhtbFV0aWwuYWRkRG9jdW1lbnROYW1lc3BhY2UoY29udGFpbmVyLCBYbWxOYW1lc3BhY2VzLm9zcyApOwogICAgICAgIFhtbFV0aWwuYWRkRG9jdW1lbnROYW1lc3BhY2UoY29udGFpbmVyLCBYbWxOYW1lc3BhY2VzLmRjICk7CiAgICAgICAgWG1sVXRpbC5hZGREb2N1bWVudE5hbWVzcGFjZShjb250YWluZXIsIFhtbE5hbWVzcGFjZXMuZGN0ZXJtcyApOwogICAgICAgIFhtbFV0aWwuYWRkRG9jdW1lbnROYW1lc3BhY2UoY29udGFpbmVyLCBYbWxOYW1lc3BhY2VzLnhzaSApOwogICAgICAgIFhtbFV0aWwuYWRkRG9jdW1lbnROYW1lc3BhY2UoY29udGFpbmVyLCBYbWxOYW1lc3BhY2VzLmRvY2Jvb2sgKTsKCiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZzogQWRtaW5EYXRhLmNyZWF0ZVRpbmdDb250YWluZXIgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBjb250YWluZXI7CgogICAgfQoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGNvbGxlY3Rpb24gaWRlbnRpZmllcnMgZm9yIHRoZSB4bWwtZG9jdW1lbnQuCiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBBZG1pbkRhdGEuY3JlYXRlQ29sbGVjdGlvbklkZW50aWZpZXJzKCBhZG1pbkluZm8gKQogICAgICogQHBhcmFtIHtPYmplY3R9IGFkbWluSW5mbyBhZG1pbmlzdHJhdGl2ZSBpbmZvcm1hdGlvbgogICAgICogQHJldHVybiB7U3RyaW5nW119IEFycmF5IHdpdGggdGhlIGNvbGxlY3Rpb24gaWRlbnRpZmllcnMgZm9yIHRoZSByZWNvcmQKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgQWRtaW5EYXRhLmNyZWF0ZUNvbGxlY3Rpb25JZGVudGlmaWVycwogICAgICovCiAgICBmdW5jdGlvbiBjcmVhdGVDb2xsZWN0aW9uSWRlbnRpZmllcnMoIGFkbWluSW5mbyApIHsKCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmcgQWRtaW5EYXRhLmNyZWF0ZUNvbGxlY3Rpb25JZGVudGlmaWVycyBmdW5jdGlvbiIgKTsKICAgICAgICB2YXIgc3VibWl0dGVyID0gYWRtaW5JbmZvLnN1Ym1pdHRlcjsKICAgICAgICB2YXIgZm9ybWF0ID0gYWRtaW5JbmZvLmZvcm1hdDsKCiAgICAgICAgdmFyIGNvbGxlY3Rpb25JZGVudGlmaWVycyA9IFtdOwogICAgICAgIGNvbGxlY3Rpb25JZGVudGlmaWVycy5wdXNoKCBzdWJtaXR0ZXIgKyAiLSIgKyBmb3JtYXQgKTsKCiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBBZG1pbkRhdGFNYXJjLmNyZWF0ZUNvbGxlY3Rpb25JZGVudGlmaWVycyBmdW5jdGlvbiIgKTsKCiAgICAgICAgcmV0dXJuIGNvbGxlY3Rpb25JZGVudGlmaWVyczsKCiAgICB9CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IGZpbmRzIHRoZSBsaWJyYXJ5IHR5cGUgb2YgYSByZWNvcmQgYmFzZWQgb24gc3VibWl0dGVyLgogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggQWRtaW5EYXRhLmdldExpYnJhcnlUeXBlKCBzdWJtaXR0ZXIgKQogICAgICogQHBhcmFtIHtPYmplY3R9IGFkbWluSW5mbyBhZG1pbmlzdHJhdGl2ZSBpbmZvcm1hdGlvbjogZS5nLiBzdWJtaXR0ZXIsIGZvcm1hdCwgcmF3IChmb3IgcmF3IHJlcG8gcmVjb3JkKSwgYW5kIGxpYnJhcnkgcnVsZXMgZnJvbSB2aXAKICAgICAqIEByZXR1cm4ge1N0cmluZ30gdGhlIGxpYnJhcnkgdHlwZQogICAgICogQGV4YW1wbGUKICAgICAqIEFkbWluRGF0YS5nZXRMaWJyYXJ5VHlwZSggeyBzdWJtaXR0ZXI6ICI3MTAxMDAiLCBmb3JtYXQ6ICJrYXRhbG9nIiApCiAgICAgKiByZXR1cm5zICJwdWJsaWMiIC8vb2xkIGZ1bmN0aW9uCiAgICAgKiBBZG1pbkRhdGEuZ2V0TGlicmFyeVR5cGUgKCB7IHN1Ym1pdHRlcjogIjcxMDEwMCIsIGZvcm1hdDogImthdGFsb2ciLCByYXc6IHRydWUsIGFnZW5jeVR5cGU6ICJGb2xrZWJpYmxpb3RlayIgfSApCiAgICAgKiByZXR1cm5zICJwdWJsaWMiIC8vbmV3IGZ1bmN0aW9uIHdpdGggT3BlbkFnZW5jeSBydWxlcyBpbiByZWNvcmRzIGZyb20gcmF3IHJlcG8KICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgQWRtaW5EYXRhLmdldExpYnJhcnlUeXBlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldExpYnJhcnlUeXBlKCBhZG1pbkluZm8gKSB7CgogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIEFkbWluRGF0YS5nZXRMaWJyYXJ5VHlwZSBmdW5jdGlvbiIgKTsKCiAgICAgICAgdmFyIHN1Ym1pdHRlciA9IGFkbWluSW5mby5zdWJtaXR0ZXI7CiAgICAgICAgdmFyIGxpYnJhcnlUeXBlID0gIm5vbmUiOwoKICAgICAgICBpZiAoIHRydWUgPT09IGFkbWluSW5mby5yYXcgJiYgdW5kZWZpbmVkICE9PSBhZG1pbkluZm8uYWdlbmN5VHlwZSApIHsKICAgICAgICAgICAgc3dpdGNoICggYWRtaW5JbmZvLmFnZW5jeVR5cGUgKSB7CiAgICAgICAgICAgICAgICBjYXNlICJGb2xrZWJpYmxpb3RlayI6CiAgICAgICAgICAgICAgICAgICAgbGlicmFyeVR5cGUgPSAicHVibGljIjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgIkZvcnNrbmluZ3NiaWJsaW90ZWsiOgogICAgICAgICAgICAgICAgICAgIGxpYnJhcnlUeXBlID0gInJlc2VhcmNoIjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgIlNrb2xlYmlibGlvdGVrIjoKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5VHlwZSA9ICJzY2hvb2wiOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgeyAvL1RPRE8gcmVtb3ZlIHRoaXMgd2hlbiB3ZSd2ZSBhZGRlZCBjYWxsIHRvIE9wZW5BZ2VuY3kgdG8gZ2V0IHZpcCBydWxlcyBmb3Igbm9uIHJhdyByZXBvIHJlY29yZHMgaW4gIzk5NyBpbiBkYXRhaW8KCiAgICAgICAgICAgIGlmICggQWRtaW5EYXRhLmNoZWNrVHlwZU9mU3VibWl0dGVyKCBzdWJtaXR0ZXIsICJzY2hvb2xMaWJyYXJ5IiApICkgewogICAgICAgICAgICAgICAgbGlicmFyeVR5cGUgPSAic2Nob29sIjsKICAgICAgICAgICAgfSBlbHNlIGlmICggQWRtaW5EYXRhLmNoZWNrVHlwZU9mU3VibWl0dGVyKCBzdWJtaXR0ZXIsICJwdWJsaWNMaWJyYXJ5IiApICkgewogICAgICAgICAgICAgICAgbGlicmFyeVR5cGUgPSAicHVibGljIjsKICAgICAgICAgICAgfSBlbHNlIGlmICggc3VibWl0dGVyLm1hdGNoKCAvXjhcZHxeMTJcZC8gKSAmJiAhc3VibWl0dGVyLm1hdGNoKCAvXjg3MDk3LyApICkgewogICAgICAgICAgICAgICAgLy9ubyBsb25nZXIgY2hlY2tpbmcgZm9yIG5vbi1yZXNlYXJjaCBsaWJyYXJpZXMgdGhhdCBsb29rIGxpa2UgcmVzZWFyY2ggbGlicmFyeSBzdWJtaXR0ZXJzIGJlY2F1c2UgdGhleSBhbGwgY29tZSB0aHJvdWdoIGRhdGFpbwogICAgICAgICAgICAgICAgbGlicmFyeVR5cGUgPSAicmVzZWFyY2giOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIEFkbWluRGF0YS5nZXRMaWJyYXJ5VHlwZSBmdW5jdGlvbiIgKTsKICAgICAgICByZXR1cm4gbGlicmFyeVR5cGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IGNoZWNrcyB3aGV0aGVyIGEgc3VibWl0dGVyIGhhcyBhIHNwZWNpYWwgdHlwZSwgZm9yIGluc3RhbmNlIGRhdGFXZWxsQ3VzdG9tZXIgb3Igbm9uRmljdGlvblN1Ym1pdHRlci4KICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IEFkbWluRGF0YS5jaGVja1R5cGVPZlN1Ym1pdHRlciggc3VibWl0dGVyLCB0eXBlICkKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdWJtaXR0ZXIgVGhlIHN1Ym1pdHRlciBvZiBkYXRhCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUaGUgdHlwZSBvZiB0aGUgc3VibWl0dGVyIHRvIGNoZWNrIGZvcgogICAgICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZSBvciBmYWxzZQogICAgICogQGV4YW1wbGUgQWRtaW5EYXRhLmNoZWNrVHlwZU9mU3VibWl0dGVyKCAiODMwMDYwIiwgImRhdGFXZWxsQ3VzdG9tZXIiICkKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgQWRtaW5EYXRhLmNoZWNrVHlwZU9mU3VibWl0dGVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNoZWNrVHlwZU9mU3VibWl0dGVyKCBzdWJtaXR0ZXIsIHR5cGUgKSB7CgogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIEFkbWluRGF0YS5jaGVja1R5cGVPZlN1Ym1pdHRlciBmdW5jdGlvbiIgKTsKCiAgICAgICAgdmFyIHR5cGVPZlN1Ym1pdHRlcjsKICAgICAgICAvLyBUaGUgYXJyYXkgYmVsb3cgbXVzdCBvbmx5IGNvbnRhaW4gUEggTGlicmFyaWVzCiAgICAgICAgdmFyIGRhdGFXZWxsQ3VzdG9tZXJzID0gWyAiODMwMDYwIiwgIjgzMDE5MCIsICI4MzAzNzAiLCAiODMwMzgwIiwgIjgzMDY5MCIsICI4MzEwMjAiLCAiODYwOTAwIiBdOwogICAgICAgIHZhciBub25GaWN0aW9uU3VibWl0dGVycyA9IFsgIjE1MDAwNSIsICIxNTAwMTIiLCAiMTUwMDE4IiwgIjE1MDAyMyIsICIxNTAwMjQiLCAiMTUwMDI5IiwgIjE1MDAzMSIsICIxNTAwMzMiLCAiMTUwMDQyIiwgIjE1MDA0MyIsICIxNTAwNDYiLCAiMTUwMDQ5IiwgIjE1MDA1MiIsICIxNTAwNTgiLCAiMTUwMDYwIiwgIjE1MDA2NSIsICIxNTAwNjgiIF07CgogICAgICAgIHZhciBwdWJsaWNMaWJyYXJ5ID0gL143WzAtOV17NX0kLzsKICAgICAgICB2YXIgc2Nob29sTGlicmFyeSA9IC9eWzM2XVswLTldezV9JHxeMjhbMC05XXs0fSQvOwoKICAgICAgICB2YXIgY2hlY2tBcnJheSA9IFtdOwogICAgICAgIHZhciBjaGVja1JlZ0V4OwoKICAgICAgICBzd2l0Y2ggKCB0eXBlICkgewogICAgICAgICAgICBjYXNlICJkYXRhV2VsbEN1c3RvbWVyIjoKICAgICAgICAgICAgICAgIGNoZWNrQXJyYXkgPSBkYXRhV2VsbEN1c3RvbWVyczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJub25GaWN0aW9uU3VibWl0dGVyIjoKICAgICAgICAgICAgICAgIGNoZWNrQXJyYXkgPSBub25GaWN0aW9uU3VibWl0dGVyczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJwdWJsaWNMaWJyYXJ5IjoKICAgICAgICAgICAgICAgIGNoZWNrUmVnRXggPSBwdWJsaWNMaWJyYXJ5OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgInNjaG9vbExpYnJhcnkiOgogICAgICAgICAgICAgICAgY2hlY2tSZWdFeCA9IHNjaG9vbExpYnJhcnk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIExvZy53YXJuKCAiVGhlIHN1Ym1pdHRlciB0eXBlICIgKyB0eXBlICsgIiBpcyB1bmtub3duLiIgKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgaWYgKCBjaGVja1JlZ0V4ICE9PSB1bmRlZmluZWQgJiYgc3VibWl0dGVyLm1hdGNoKCBjaGVja1JlZ0V4ICkgKSB7CiAgICAgICAgICAgIHR5cGVPZlN1Ym1pdHRlciA9IHRydWU7CiAgICAgICAgfSBlbHNlIGlmICggY2hlY2tBcnJheS5pbmRleE9mKCBzdWJtaXR0ZXIgKSA+IC0xICkgewogICAgICAgICAgICB0eXBlT2ZTdWJtaXR0ZXIgPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHR5cGVPZlN1Ym1pdHRlciA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBBZG1pbkRhdGEuY2hlY2tUeXBlT2ZTdWJtaXR0ZXIgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiB0eXBlT2ZTdWJtaXR0ZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVja3MgaWYgcmVjb3JkIGlzIGNoaWxkcmVucyBtYXRlcmlhbC4KICAgICAqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgZGthYm0gcmVjb3JkIGNvbnRhaW5zICJiXHUwMGY4cm5lbWF0ZXJpYWxlciIgaW4gZGN0ZXJtczphdWRpZW5jZQogICAgICoKICAgICAqIEBzeW50YXggQWRtaW5EYXRhLmlzQ2hpbGRyZW5zTWF0ZXJpYWwoIGNvbnRhaW5lciApCiAgICAgKiBAcGFyYW0ge0RvY3VtZW50fSBjb250YWluZXIgYSB0aW5nIGNvbnRhaW5lciB3aXRoIHhtbCByZXByZXNlbnRpbmcgYSByZWNvcmQgaW4gZGthYm0KICAgICAqIEByZXR1cm5zIHtCb29sZWFufSB0cnVlIGlmIHJlY29yZCBpcyBjaGlsZHJlbnMgbWF0ZXJpYWwKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgQWRtaW5EYXRhLmlzQ2hpbGRyZW5zTWF0ZXJpYWwKICAgICAqLwogICAgZnVuY3Rpb24gaXNDaGlsZHJlbnNNYXRlcmlhbCggY29udGFpbmVyICkgewogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIEFkbWluRGF0YS5pc0NoaWxkcmVuc01hdGVyaWFsIiApOwoKICAgICAgICB2YXIgaXNDaGlsZHJlbnNNYXRlcmlhbCA9IGZhbHNlOwogICAgICAgIHZhciBhdWRpZW5jZU5vZGVzID0gWFBhdGguc2VsZWN0KCAidGluZzpjb250YWluZXIvZGthYm06cmVjb3JkL2RjdGVybXM6YXVkaWVuY2UiLCBjb250YWluZXIgKTsKCiAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgYXVkaWVuY2VOb2Rlcy5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgdmFyIHRleHQgPSBYbWxVdGlsLmdldFRleHQoIGF1ZGllbmNlTm9kZXNbIGkgXSApOwogICAgICAgICAgICBpZiAoICJiXHUwMGY4cm5lbWF0ZXJpYWxlciIgPT09IHRleHQgKSB7CiAgICAgICAgICAgICAgICBpc0NoaWxkcmVuc01hdGVyaWFsID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIEFkbWluRGF0YS5pc0NoaWxkcmVuc01hdGVyaWFsIiApOwogICAgICAgIHJldHVybiBpc0NoaWxkcmVuc01hdGVyaWFsOwogICAgfQoKICAgIC8qKgogICAgKiBGdW5jdGlvbiB0aGF0IGNyZWF0ZXMgYWRtaW5pc3RyYXRpdmUgZGF0YSB4bWwuCiAgICAqCiAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICogQHN5bnRheCBBZG1pbkRhdGEuY3JlYXRlQWRtaW5EYXRhWG1sKCBhZG1pbkluZm8sIGNvbnRhaW5lciApCiAgICAqIEBwYXJhbSB7T2JqZWN0fSBhZG1pbkluZm8gYWRtaW5pc3RyYXRpdmUgaW5mb3JtYXRpb246IGUuZy4gc3VibWl0dGVyLCBmb3JtYXQsIGxpYnJhcnlUeXBlLCBpc0RlbGV0ZVJlY29yZCwgb25saW5lQWNjZXNzIGFuZCBjcmVhdGlvbkRhdGUKICAgICogQHBhcmFtIHtEb2N1bWVudH0gY29udGFpbmVyIHRoZSBYbWwgdGluZyBjb250YWluZXIgZm9yIHRoZSBjb252ZXJ0ZWQgcmVjb3JkCiAgICAqIEByZXR1cm4ge0RvY3VtZW50fSB4bWwgZWxlbWVudHMgd2l0aCBhZG1pbmlzdHJhdGl2ZSBkYXRhIGdhdGhlcmVkIGluIHRoZSBBZG1pbkRhdGFYbWwgZWxlbWVudAogICAgKiBAZnVuY3Rpb24KICAgICogQG5hbWUgQWRtaW5EYXRhLmNyZWF0ZUFkbWluRGF0YVhtbAogICAgKi8KICAgZnVuY3Rpb24gY3JlYXRlQWRtaW5EYXRhWG1sKCBhZG1pbkluZm8sIGNvbnRhaW5lciApIHsKCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmcgQWRtaW5EYXRhLmNyZWF0ZUFkbWluRGF0YVhtbCIgKTsKCiAgICAgICAgdmFyIGFkbWluRGF0YVhtbCA9IFhtbFV0aWwuY3JlYXRlRG9jdW1lbnQoICJhZG1pbkRhdGEiICk7CgogICAgICAgIC8vYWRkaW5nIHJlY29yZFN0YXR1cwogICAgICAgIHZhciByZWNvcmRTdGF0dXMgPSAiYWN0aXZlIjsKICAgICAgICBpZiAoIGFkbWluSW5mby5pc0RlbGV0ZVJlY29yZCA9PT0gdHJ1ZSApIHsKICAgICAgICAgICAgcmVjb3JkU3RhdHVzID0gImRlbGV0ZSI7CiAgICAgICAgfQogICAgICAgIHZhciByZWNvcmRTdGF0dXNYbWwgPSBYbWxVdGlsLmNyZWF0ZUVsZW1lbnQoIGFkbWluRGF0YVhtbCwgInJlY29yZFN0YXR1cyIsIG51bGwsIHJlY29yZFN0YXR1cyApOwogICAgICAgIFhtbFV0aWwuYXBwZW5kQ2hpbGQoIGFkbWluRGF0YVhtbCwgcmVjb3JkU3RhdHVzWG1sICk7CiAgICAgICAgLy9hZGRpbmcgY3JlYXRpb25EYXRlCiAgICAgICAgaWYgKCBhZG1pbkluZm8uY3JlYXRpb25EYXRlICE9PSAiIiApIHsKICAgICAgICAgICAgdmFyIGNyZWF0aW9uRGF0ZVhtbCA9IFhtbFV0aWwuY3JlYXRlRWxlbWVudCggYWRtaW5EYXRhWG1sLCAiY3JlYXRpb25EYXRlIiwgbnVsbCwgYWRtaW5JbmZvLmNyZWF0aW9uRGF0ZSApOwogICAgICAgICAgICBYbWxVdGlsLmFwcGVuZENoaWxkKCBhZG1pbkRhdGFYbWwsIGNyZWF0aW9uRGF0ZVhtbCApOwogICAgICAgIH0KICAgICAgICAvL2FkZGluZyBkYXRhV2VsbEN1c3RvbWVyCiAgICAgICAgaWYgKCBhZG1pbkluZm8uZGF0YVdlbGxDdXN0b21lciA9PT0gdHJ1ZSApIHsKICAgICAgICAgICAgdmFyIGRhdGFXZWxsQ3VzdG9tZXJYbWwgPSBYbWxVdGlsLmNyZWF0ZUVsZW1lbnQoIGFkbWluRGF0YVhtbCwgImRhdGFXZWxsQ3VzdG9tZXIiLCBudWxsLCAidHJ1ZSIgKTsKICAgICAgICAgICAgWG1sVXRpbC5hcHBlbmRDaGlsZCggYWRtaW5EYXRhWG1sLCBkYXRhV2VsbEN1c3RvbWVyWG1sICk7CiAgICAgICAgfQogICAgICAgIC8vYWRkaW5nIGxpYnJhcnlUeXBlCiAgICAgICAgdmFyIGxpYnJhcnlUeXBlWG1sID0gWG1sVXRpbC5jcmVhdGVFbGVtZW50KCBhZG1pbkRhdGFYbWwsICJsaWJyYXJ5VHlwZSIsIG51bGwsIGFkbWluSW5mby5saWJyYXJ5VHlwZSApOwogICAgICAgIFhtbFV0aWwuYXBwZW5kQ2hpbGQoIGFkbWluRGF0YVhtbCwgbGlicmFyeVR5cGVYbWwgKTsKICAgICAgICAvL2FkZGluZyBnZW5yZQogICAgICAgIHZhciBnZW5yZSA9ICIiOwogICAgICAgIGlmICggQWRtaW5EYXRhLmNoZWNrVHlwZU9mU3VibWl0dGVyKCBhZG1pbkluZm8uc3VibWl0dGVyLCAibm9uRmljdGlvblN1Ym1pdHRlciIgKSA9PT0gdHJ1ZSApIHsKICAgICAgICAgICAgZ2VucmUgPSAibm9uZmlrdGlvbiI7CiAgICAgICAgfSBlbHNlIGlmICggInVuZGVmaW5lZCIgIT09IHR5cGVvZiBhZG1pbkluZm8uZ2VucmUgICkgewogICAgICAgICAgICBnZW5yZSA9IGFkbWluSW5mby5nZW5yZTsKICAgICAgICB9CiAgICAgICAgaWYgKCBnZW5yZSAhPT0gIiIgKSB7CiAgICAgICAgICAgIFhtbFV0aWwuYXBwZW5kQ2hpbGRFbGVtZW50KCBhZG1pbkRhdGFYbWwuZG9jdW1lbnRFbGVtZW50LCAiZ2VucmUiLCBudWxsLCBnZW5yZSApOwogICAgICAgIH0KICAgICAgICAvL2FkZGluZyBpbmRleGluZ0FsaWFzCiAgICAgICAgdmFyIGluZGV4aW5nQWxpYXNYbWwgPSBBZG1pbkRhdGEuY3JlYXRlSW5kZXhpbmdBbGlhc1htbCggYWRtaW5JbmZvLmluZGV4aW5nQWxpYXMgKTsKICAgICAgICBYbWxVdGlsLmFwcGVuZENoaWxkKCBhZG1pbkRhdGFYbWwsIGluZGV4aW5nQWxpYXNYbWwgKTsKICAgICAgICAvL2FkZGluZyBhY2Nlc3NUeXBlcwogICAgICAgIHZhciBhY2Nlc3NUeXBlcyA9IFtdOwogICAgICAgIGlmICggInVuZGVmaW5lZCIgIT09IHR5cGVvZiBhZG1pbkluZm8uYWNjZXNzVHlwZSApIHsKICAgICAgICAgICAgYWNjZXNzVHlwZXMgPSBhZG1pbkluZm8uYWNjZXNzVHlwZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhY2Nlc3NUeXBlcyA9IEFkbWluRGF0YS5nZXRBY2Nlc3NUeXBlKCBhZG1pbkluZm8uc3VibWl0dGVyLCBhZG1pbkluZm8ub25saW5lQWNjZXNzICk7CiAgICAgICAgfQogICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IGFjY2Vzc1R5cGVzLmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICAgICAgWG1sVXRpbC5hcHBlbmRDaGlsZEVsZW1lbnQoIGFkbWluRGF0YVhtbC5kb2N1bWVudEVsZW1lbnQsICJhY2Nlc3NUeXBlIiwgbnVsbCwgYWNjZXNzVHlwZXNbIGkgXSApOwogICAgICAgIH0KICAgICAgICAvL2FkZGluZyB3b3JrVHlwZXMKICAgICAgICB2YXIgd29ya1R5cGVzID0gQWRtaW5EYXRhLmNyZWF0ZVdvcmtUeXBlKCBjb250YWluZXIgKTsKICAgICAgICBmb3IgKCB2YXIgYSA9IDA7IGEgPCB3b3JrVHlwZXMubGVuZ3RoOyBhKysgKSB7CiAgICAgICAgICAgICAgICBYbWxVdGlsLmFwcGVuZENoaWxkRWxlbWVudCggYWRtaW5EYXRhWG1sLmRvY3VtZW50RWxlbWVudCwgIndvcmtUeXBlIiwgbnVsbCwgd29ya1R5cGVzWyBhIF0gKTsKICAgICAgICB9CiAgICAgICAgLy9hZGRpbmcgY29sbGVjdGlvbklkZW50aWZpZXJzCiAgICAgICAgLy9UT0RPIGJldGluZ2Vsc2Vza2xhbWFuc2VuIG5lZGVuZm9yIGthbiBzbGV0dGVzLCBodmlzIGh2ZXIga2lsZGUgaGVudGVyIGNvbGxlY3Rpb25JZGVudGlmaWVycyB2ZWQgb3ByZXR0ZWxzZSBhZiBkZXJlcyBhZG1pbkluZm8tb2JqZWt0CiAgICAgICAgaWYgKCAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGFkbWluSW5mby5jb2xsZWN0aW9uSWRlbnRpZmllcnMgKSB7IC8vYWRkaW5nIGNvbGxlY3Rpb25JZGVudGlmaWVycyBmb3Igbm9uLW1hcmMgcmVjb3JkIGkuZS4gb3RoZXIgc291cmNlcwogICAgICAgICAgICBMb2cuZGVidWcoICJBZG1pbkRhdGEuY3JlYXRlQWRtaW5EYXRhWG1sOiBjb2xsZWN0aW9uSWRlbnRpZmllcnMgd2FzIHVuZGVmaW5lZC4gQ2FsbGluZyBjcmVhdGVDb2xsZWN0aW9uSWRlbnRpZmllcnMiICk7CiAgICAgICAgICAgIGFkbWluSW5mby5jb2xsZWN0aW9uSWRlbnRpZmllcnMgPSBBZG1pbkRhdGEuY3JlYXRlQ29sbGVjdGlvbklkZW50aWZpZXJzKCBhZG1pbkluZm8gKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBMb2cuZGVidWcoICJBZG1pbkRhdGEuY3JlYXRlQWRtaW5EYXRhWG1sOiBjb2xsZWN0aW9uSWRlbnRpZmllcnMgZ2l2ZW4gYXMgcGFyYW1ldGVyOiAiLCBKU09OLnN0cmluZ2lmeSggYWRtaW5JbmZvLmNvbGxlY3Rpb25JZGVudGlmaWVycyApKTsKICAgICAgICB9CiAgICAgICAgZm9yICggdmFyIGIgPSAwOyBiIDwgYWRtaW5JbmZvLmNvbGxlY3Rpb25JZGVudGlmaWVycy5sZW5ndGg7IGIrKyApIHsKICAgICAgICAgICAgICAgIFhtbFV0aWwuYXBwZW5kQ2hpbGRFbGVtZW50KCBhZG1pbkRhdGFYbWwuZG9jdW1lbnRFbGVtZW50LCAiY29sbGVjdGlvbklkZW50aWZpZXIiLCBudWxsLCBhZG1pbkluZm8uY29sbGVjdGlvbklkZW50aWZpZXJzWyBiIF0gKTsKICAgICAgICB9CiAgICAgICAgLy9hZGRpbmcgcmV2aWV3ZWQgd29yayBkYXRhIGlmIHJlbGV2YW50IElPICM5NTUKICAgICAgICBpZiAoICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgYWRtaW5JbmZvLnJldmlld2VkQ3JlYXRvciApIHsKICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgYWRtaW5JbmZvLnJldmlld2VkQ3JlYXRvci5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgICAgIFhtbFV0aWwuYXBwZW5kQ2hpbGRFbGVtZW50KCBhZG1pbkRhdGFYbWwuZG9jdW1lbnRFbGVtZW50LCAicmV2aWV3ZWRDcmVhdG9yIiwgbnVsbCwgYWRtaW5JbmZvLnJldmlld2VkQ3JlYXRvclsgaSBdICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGFkbWluSW5mby5yZXZpZXdlZFRpdGxlICYmICIiICE9PSBhZG1pbkluZm8ucmV2aWV3ZWRUaXRsZSApIHsKICAgICAgICAgICAgWG1sVXRpbC5hcHBlbmRDaGlsZEVsZW1lbnQoIGFkbWluRGF0YVhtbC5kb2N1bWVudEVsZW1lbnQsICJyZXZpZXdlZFRpdGxlIiwgbnVsbCwgYWRtaW5JbmZvLnJldmlld2VkVGl0bGUgKTsKICAgICAgICB9CiAgICAgICAgaWYgKCAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGFkbWluSW5mby5yZXZpZXdlZFB1Ymxpc2hlciApIHsKICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgYWRtaW5JbmZvLnJldmlld2VkUHVibGlzaGVyLmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICAgICAgWG1sVXRpbC5hcHBlbmRDaGlsZEVsZW1lbnQoIGFkbWluRGF0YVhtbC5kb2N1bWVudEVsZW1lbnQsICJyZXZpZXdlZFB1Ymxpc2hlciIsIG51bGwsIGFkbWluSW5mby5yZXZpZXdlZFB1Ymxpc2hlclsgaSBdICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGFkbWluSW5mby5yZXZpZXdlZFR5cGUgKSB7CiAgICAgICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IGFkbWluSW5mby5yZXZpZXdlZFR5cGUubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgICAgICAgICBYbWxVdGlsLmFwcGVuZENoaWxkRWxlbWVudCggYWRtaW5EYXRhWG1sLmRvY3VtZW50RWxlbWVudCwgInJldmlld2VkVHlwZSIsIG51bGwsIGFkbWluSW5mby5yZXZpZXdlZFR5cGVbIGkgXSApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICggInVuZGVmaW5lZCIgIT09IHR5cGVvZiBhZG1pbkluZm8ucmV2aWV3ZWRXb3JrVHlwZSApIHsKICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgYWRtaW5JbmZvLnJldmlld2VkV29ya1R5cGUubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgICAgICAgICBYbWxVdGlsLmFwcGVuZENoaWxkRWxlbWVudCggYWRtaW5EYXRhWG1sLmRvY3VtZW50RWxlbWVudCwgInJldmlld2VkV29ya1R5cGUiLCBudWxsLCBhZG1pbkluZm8ucmV2aWV3ZWRXb3JrVHlwZVsgaSBdICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmcgQWRtaW5EYXRhLmNyZWF0ZUFkbWluRGF0YVhtbCIgKTsKCiAgICAgICAgICAgIHJldHVybiBhZG1pbkRhdGFYbWw7CiAgICAgICAgfQoKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgY3JlYXRlcyB0aGUgeG1sIGVsZW1lbnQgd2l0aCBpbmRleGluZ0FsaWFzIGZvciB0aGUgcmVjb3JkIGJhc2VkIG9uIHN1Ym1pdHRlciBhbmQgZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggQWRtaW5EYXRhLmNyZWF0ZUluZGV4aW5nQWxpYXNYbWwoIGluZGV4aW5nQWxpYXMgKQogICAgICogQHBhcmFtIHtTdHJpbmd9IGluZGV4aW5nQWxpYXMKICAgICAqIEByZXR1cm4ge05vZGV9IGluZGV4aW5nQWxpYXNYbWwKICAgICAqIEBleGFtcGxlIEFkbWluRGF0YS5jcmVhdGVJbmRleGluZ0FsaWFzWG1sKCB7ICJmb3JtYXQiOiAiYmFzaXMiLCAic3VibWl0dGVyIjogIjg3MDk3MCIgfSApCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIEFkbWluRGF0YS5jcmVhdGVJbmRleGluZ0FsaWFzWG1sCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNyZWF0ZUluZGV4aW5nQWxpYXNYbWwoIGluZGV4aW5nQWxpYXMgKSB7CgogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIEFkbWluRGF0YS5jcmVhdGVJbmRleGluZ0FsaWFzWG1sIiApOwoKICAgICAgICB2YXIgaW5kZXhpbmdBbGlhc1htbCA9IFhtbFV0aWwuY3JlYXRlRG9jdW1lbnQoICJpbmRleGluZ0FsaWFzIiApOwoKICAgICAgICBpZiAoIHVuZGVmaW5lZCA9PT0gaW5kZXhpbmdBbGlhcyB8fCAiIiA9PT0gaW5kZXhpbmdBbGlhcyApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgICAgICAgICAgIkFkbWluRGF0YS5jcmVhdGVJbmRleGluZ0FsaWFzWG1sOiBubyBpbmRleGluZ0FsaWFzIGRlZmluZWQiCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIFhtbFV0aWwuYXBwZW5kVGV4dCggaW5kZXhpbmdBbGlhc1htbCwgaW5kZXhpbmdBbGlhcyApOwoKICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIEFkbWluRGF0YS5jcmVhdGVJbmRleGluZ0FsaWFzWG1sIiApOwoKICAgICAgICByZXR1cm4gaW5kZXhpbmdBbGlhc1htbDsKCiAgICB9CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IGRldGVybWluZXMgYWNjZXNzVHlwZSBmb3IgdGhlIHJlY29yZC4KICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IEFkbWluRGF0YS5nZXRBY2Nlc3NUeXBlKCBzdWJtaXR0ZXIsIG9ubGluZUFjY2VzcywgW3JlY29yZF0gKQogICAgICogQHBhcmFtIHtTdHJpbmd9IHN1Ym1pdHRlciBUaGUgc3VibWl0dGVyIG9mIGRhdGEKICAgICAqIC8vVE9ETyBjaGFuZ2Ugb25saW5lQWNjZXNzIHRvIGJvb2xlYW4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBvbmxpbmVBY2Nlc3MgU3RhdHVzIG9mIG9ubGluZSBhY2Nlc3Mgc2hvdWxkIGJlICJub3QgYXZhaWxhYmxlIiBpZiB1cmwgZG9lcyBub3Qgd29yaywgb3RoZXJ3aXNlIGVtcHR5IHN0cmluZwogICAgICogQHJldHVybiB7U3RyaW5nW119IGFjY2Vzc1R5cGVzIGZvciB0aGUgcmVjb3JkIC0gd2l0aCAibm9uZSIgYXMgdGhlIG9ubHkgZWxlbWVudCBpZiBubyBhY2Nlc3MgdHlwZSBleGlzdHMKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgQWRtaW5EYXRhLmdldEFjY2Vzc1R5cGUKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0QWNjZXNzVHlwZSggc3VibWl0dGVyLCBvbmxpbmVBY2Nlc3MgKSB7CgogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIEFkbWluRGF0YS5nZXRBY2Nlc3NUeXBlIiApOwoKICAgICAgICB2YXIgYWNjZXNzVHlwZXMgPSBbXTsKICAgICAgICAvL1RPRE8gY2hhbmdlIG9ubGluZUFjY2VzcyB0byBib29sZWFuCiAgICAgICAgaWYgKCBzdWJtaXR0ZXIubWF0Y2goIC9eMTUwLyApICYmIG9ubGluZUFjY2VzcyAhPT0gIm5vdCBhdmFpbGFibGUiICkgewogICAgICAgICAgICBhY2Nlc3NUeXBlcy5wdXNoKCAib25saW5lIiApOwogICAgICAgIH0KICAgICAgICBpZiAoIDAgPT09IGFjY2Vzc1R5cGVzLmxlbmd0aCApIHsKICAgICAgICAgICAgYWNjZXNzVHlwZXMucHVzaCggIm5vbmUiICk7CiAgICAgICAgfQoKICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIEFkbWluRGF0YS5nZXRBY2Nlc3NUeXBlIiApOwoKICAgICAgICByZXR1cm4gYWNjZXNzVHlwZXM7CgogICAgfQoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIHRoZSB3b3JrIHR5cGUgb2YgdGhlIGRhdGEgKGxpdGVyYXR1cmUsIG11c2ljLCBtb3ZpZSBldGMuKSBiYXNlZCBvbiB0aGUgbWF0ZXJpYWwgdHlwZSAoREtBQk0pLgogICAgICoKICAgICAqCiAgICAgKiBAc3ludGF4IEFkbWluRGF0YS5jcmVhdGVXb3JrVHlwZSggZGthYm1YbWwgKQogICAgICogQHBhcmFtIHtEb2N1bWVudH0gY29udGFpbmVyIHRoZSBYbWwgdGluZyBjb250YWluZXIgZm9yIHRoZSBjb252ZXJ0ZWQgcmVjb3JkCiAgICAgKiBAcmV0dXJuIHtTdHJpbmdbXX0gQW4gYXJyYXkgb2Ygd29yayB0eXBlcwogICAgICogQG5hbWUgQWRtaW5EYXRhLmNyZWF0ZVdvcmtUeXBlCiAgICAgKiBAZnVuY3Rpb24KICAgICAqLwogICAgZnVuY3Rpb24gY3JlYXRlV29ya1R5cGUoIGNvbnRhaW5lciApIHsKCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmcgQWRtaW5EYXRhLmNyZWF0ZVdvcmtUeXBlIiApOwoKICAgICAgICB2YXIgd29ya1R5cGVzID0gewogICAgICAgICAgICAiQmlsbGVkYm9nIjogImxpdGVyYXR1cmUiLAogICAgICAgICAgICAiQm9nIjogImxpdGVyYXR1cmUiLAogICAgICAgICAgICAiQm9nIHN0b3Igc2tyaWZ0IjogImxpdGVyYXR1cmUiLAogICAgICAgICAgICAiRGlza2V0dGUiOiAibGl0ZXJhdHVyZSIsCiAgICAgICAgICAgICJEVEJvb2siOiAibGl0ZXJhdHVyZSIsCiAgICAgICAgICAgICJEdmQtcm9tIjogImxpdGVyYXR1cmUiLAogICAgICAgICAgICAiRWJvZyI6ICJsaXRlcmF0dXJlIiwKICAgICAgICAgICAgIkx5ZGJvZyAoYlx1MDBlNW5kKSI6ICJsaXRlcmF0dXJlIiwKICAgICAgICAgICAgIkx5ZGJvZyAoY2QpIjogImxpdGVyYXR1cmUiLAogICAgICAgICAgICAiTHlkYm9nIChuZXQpIjogImxpdGVyYXR1cmUiLAogICAgICAgICAgICAiTHlkYm9nIChjZC1tcDMpIjogImxpdGVyYXR1cmUiLAogICAgICAgICAgICAiTmV0ZG9rdW1lbnQiOiAibGl0ZXJhdHVyZSIsCiAgICAgICAgICAgICJQdW5rdHNrcmlmdCI6ICJsaXRlcmF0dXJlIiwKICAgICAgICAgICAgIlRlZ25lc2VyaWUiOiAibGl0ZXJhdHVyZSIsCiAgICAgICAgICAgICJUZWduZXNlcmllIChuZXQpIjogImxpdGVyYXR1cmUiLAogICAgICAgICAgICAiR3JhcGhpYyBub3ZlbCI6ICJsaXRlcmF0dXJlIiwKICAgICAgICAgICAgIlx1MDBDNXJib2ciOiAibGl0ZXJhdHVyZSIsCiAgICAgICAgICAgICJBdmlzIjogInBlcmlvZGljYSIsCiAgICAgICAgICAgICJBdmlzIChuZXQpIjogInBlcmlvZGljYSIsCiAgICAgICAgICAgICJUaWRzc2tyaWZ0IjogInBlcmlvZGljYSIsCiAgICAgICAgICAgICJUaWRzc2tyaWZ0IChuZXQpIjogInBlcmlvZGljYSIsCiAgICAgICAgICAgICJQZXJpb2Rpa3VtIjogInBlcmlvZGljYSIsCiAgICAgICAgICAgICJQZXJpb2Rpa3VtIChuZXQpIjogInBlcmlvZGljYSIsCiAgICAgICAgICAgICJCbHUtcmF5IjogIm1vdmllIiwKICAgICAgICAgICAgIkJsdS1yYXkgM0QiOiAibW92aWUiLAogICAgICAgICAgICAiQmx1LXJheSA0SyI6ICJtb3ZpZSIsCiAgICAgICAgICAgICJEdmQiOiAibW92aWUiLAogICAgICAgICAgICAiQmlvZ3JhZmZpbG0iOiAibW92aWUiLAogICAgICAgICAgICAiRmlsbSI6ICJtb3ZpZSIsCiAgICAgICAgICAgICJGaWxtIChuZXQpIjogIm1vdmllIiwKICAgICAgICAgICAgIlZpZGVvIjogIm1vdmllIiwKICAgICAgICAgICAgIkJcdTAwZTVuZCI6ICJtdXNpYyIsCiAgICAgICAgICAgICJDZCAobXVzaWspIjogIm11c2ljIiwKICAgICAgICAgICAgIkdyYW1tb2ZvbnBsYWRlIjogIm11c2ljIiwKICAgICAgICAgICAgIk1pbmkgZGlzYyI6ICJtdXNpYyIsCiAgICAgICAgICAgICJNdXNpayAobmV0KSI6ICJtdXNpYyIsCiAgICAgICAgICAgICJNdXNpa3RyYWNrIChuZXQpIjogInRyYWNrIiwKICAgICAgICAgICAgIkdhbWVCb3kiOiAiZ2FtZSIsCiAgICAgICAgICAgICJHYW1lQm95IEFkdmFuY2UiOiAiZ2FtZSIsCiAgICAgICAgICAgICJOaW50ZW5kbyBEUyI6ICJnYW1lIiwKICAgICAgICAgICAgIk5pbnRlbmRvIFN3aXRjaCI6ICJnYW1lIiwKICAgICAgICAgICAgIlBjLXNwaWwiOiAiZ2FtZSIsCiAgICAgICAgICAgICJQYy1zcGlsIChuZXQpIjogImdhbWUiLAogICAgICAgICAgICAiUGxheXN0YXRpb24iOiAiZ2FtZSIsCiAgICAgICAgICAgICJQU1AiOiAiZ2FtZSIsCiAgICAgICAgICAgICJXaWkiOiAiZ2FtZSIsCiAgICAgICAgICAgICJYYm94IjogImdhbWUiLAogICAgICAgICAgICAiQXJ0aWtlbCI6ICJhcnRpY2xlIiwKICAgICAgICAgICAgIkF2aXNhcnRpa2VsIjogImFydGljbGUiLAogICAgICAgICAgICAiVGlkc3NrcmlmdHNhcnRpa2VsIjogImFydGljbGUiLAogICAgICAgICAgICAiU3BcdTAwZjhyZ3NtXHUwMEU1bCBvZyBzdmFyIjogImFydGljbGUiLCAvL0JpYmxpb3Rla3N2YWd0ZW4KICAgICAgICAgICAgIk5vZGUiOiAic2hlZXRtdXNpYyIsCiAgICAgICAgICAgICJFLW5vZGUiOiAic2hlZXRtdXNpYyIsCiAgICAgICAgICAgICJLb3J0IjogIm1hcCIsCiAgICAgICAgICAgICJFLWtvcnQiOiAibWFwIiwKICAgICAgICAgICAgIkFubWVsZGVsc2UiOiAicmV2aWV3IiwKICAgICAgICAgICAgIk9tdGFsZSI6ICJib29rZGVzY3JpcHRpb24iCiAgICAgICAgfTsKCiAgICAgICAgdmFyIGNyZWF0ZWRXb3JrVHlwZXMgPSBbXTsKICAgICAgICB2YXIgc3ViamVjdHMgPSBYUGF0aC5zZWxlY3RNdWx0aXBsZVRleHQoICIvKi9ka2FibTpyZWNvcmQvZGM6c3ViamVjdCIsIGNvbnRhaW5lciApOwoKICAgICAgICAvLyBpbiBjYXNlIG9mIEZvcmZhdHRlcnBvcnRyYWV0CiAgICAgICAgaWYgKCBzdWJqZWN0cy50b1N0cmluZygpLm1hdGNoKCAvb3JmYXR0ZXJwb3J0ci8gKSApIHsKICAgICAgICAgICAgY3JlYXRlZFdvcmtUeXBlcy5wdXNoKCAicG9ydHJhaXQiICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIGJpYkRrVHlwZXMgPSBYUGF0aC5zZWxlY3QoICcvdGluZzpjb250YWluZXIvZGthYm06cmVjb3JkL2RjOnR5cGUnLCBjb250YWluZXIgKTsKICAgICAgICAgICAgZm9yICggdmFyIGogPSAwOyBqIDwgYmliRGtUeXBlcy5sZW5ndGg7IGorKyApIHsKICAgICAgICAgICAgICAgIGlmICggYmliRGtUeXBlc1sgaiBdLmdldEF0dHJpYnV0ZSggJ3hzaTp0eXBlJyApID09PSAiZGtkY3BsdXM6QmliREstVHlwZSIgKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBBZG1pbkRhdGEuY2xlYW5NYXRlcmlhbFR5cGUoIGJpYkRrVHlwZXNbIGogXS50ZXh0Q29udGVudCApOwogICAgICAgICAgICAgICAgICAgIGlmICggdHlwZSAhPT0gIlNhbW1lbnNhdCBtYXRlcmlhbGUiICYmIHdvcmtUeXBlc1sgdHlwZSBdICE9PSB1bmRlZmluZWQgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRXb3JrVHlwZXMucHVzaCggd29ya1R5cGVzWyB0eXBlIF0gKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCgogICAgICAgICAgICAvL2FkZGluZyB3b3JrVHlwZXMgYmFzZWQgb24gZGM6c3ViamVjdCBlbGVtZW50cwogICAgICAgICAgICBpZiAoIHN1YmplY3RzLnRvU3RyaW5nKCkubWF0Y2goIC9saXR0ZXJhdHVyYW5hbHlzZS8gKSApIHsKICAgICAgICAgICAgICAgIGNyZWF0ZWRXb3JrVHlwZXMucHVzaCggImFuYWx5c2lzIiApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vaWYgIm1vdmllIiBpcyBhIHdvcmtUeXBlLCB3ZSBjaGVjayBpZiB0aGlzIG1vdmllIGlzIGEgbXVzaWMgbW92aWUgZS5nLiBhbiBvcGVyYWZpbG0gb3IgYSBjb25jZXJ0LCBpZiBpdCBpcyB3ZSBhZGQgd29ya1R5cGU9Im11c2ljIiAoVVMxOTApCiAgICAgICAgaWYgKCAtMSAhPT0gY3JlYXRlZFdvcmtUeXBlcy5pbmRleE9mKCAibW92aWUiICkgJiYgQWRtaW5EYXRhLmlzTXVzaWNNb3ZpZSggY29udGFpbmVyICkgKSB7CiAgICAgICAgICAgIGNyZWF0ZWRXb3JrVHlwZXMucHVzaCggIm11c2ljIiApOwogICAgICAgIH0KCiAgICAgICAgLy9pbiBjYXNlIG5vIHdvcmt0eXBlIGhhcyBiZWVuIGZvdW5kIHlldCwgc2V0IGl0IHRvICJub25lIgogICAgICAgIGlmICggY3JlYXRlZFdvcmtUeXBlcy5sZW5ndGggPT09IDAgKSB7CiAgICAgICAgICAgIGNyZWF0ZWRXb3JrVHlwZXMucHVzaCggIm5vbmUiICk7CiAgICAgICAgfQoKICAgICAgICBjcmVhdGVkV29ya1R5cGVzID0gVXRpbC51bmlxdWVWYWx1ZXMoIGNyZWF0ZWRXb3JrVHlwZXMgKTsKCiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBBZG1pbkRhdGEuY3JlYXRlV29ya1R5cGUiICk7CgogICAgICAgIHJldHVybiBjcmVhdGVkV29ya1R5cGVzOwoKICAgIH0KCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgdHJhbnNmb3JtcyBzcGVjaWZpYyBtYXRlcmlhbHR5cGVzIGludG8gbW9yZSBnZW5lcmFsIG1hdGVyaWFsdHlwZXMKICAgICAqIHNvIHRoYXQgdGhlIG1hdGVyaWFsdHlwZSBjYW4gYmUgbG9va2VkIHVwIGluIGEgdGFibGUgdGhhdCBkb2VzIG5vdAogICAgICogbmVjZXNzYXJpbHkgaGF2ZSBhbGwgc3BlY2lmaWMgdHlwZXMgbGlzdGVkCiAgICAgKiBlLmcuIFBsYXlzdGF0aW9uIDMgYW5kIFBsYXlzdGF0aW9uIDQgYXJlIGJvdGggdHJhbnNmb3JtZWQgaW50bwogICAgICogIlBsYXlzdGF0aW9uIiBhcyBtYXRlcmlhbHR5cGUgdG8gbG9vayB1cAogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggQWRtaW5EYXRhLmNsZWFuTWF0ZXJpYWxUeXBlKCBtYXRlcmlhbFR5cGUgKQogICAgICogQHBhcmFtIHtTdHJpbmd9IG1hdGVyaWFsVHlwZSBUaGUgbWF0ZXJpYWx0eXBlIHRvIG1vZGlmeQogICAgICogQHJldHVybiB7U3RyaW5nfSB0aGUgbW9kaWZpZWQgbWF0ZXJpYWx0eXBlCiAgICAgKiBAZXhhbXBsZSBBZG1pbkRhdGEuY2xlYW5NYXRlcmlhbFR5cGUoICJQbGF5c3RhdGlvbiA0IiApCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIEFkbWluRGF0YS5jbGVhbk1hdGVyaWFsVHlwZQogICAgICovCiAgICBmdW5jdGlvbiBjbGVhbk1hdGVyaWFsVHlwZSggbWF0ZXJpYWxUeXBlICkgewoKICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZzogQWRtaW5EYXRhLmNsZWFuTWF0ZXJpYWxUeXBlIiApOwoKICAgICAgICBpZiAoIG1hdGVyaWFsVHlwZS5tYXRjaCggL3BsYXlzdGF0aW9uL2kgKSApIHsKICAgICAgICAgICAgbWF0ZXJpYWxUeXBlID0gIlBsYXlzdGF0aW9uIjsKICAgICAgICB9IGVsc2UgaWYgKCBtYXRlcmlhbFR5cGUubWF0Y2goIC94Ym94L2kgKSApIHsKICAgICAgICAgICAgbWF0ZXJpYWxUeXBlID0gIlhib3giOwogICAgICAgIH0gZWxzZSBpZiAoIG1hdGVyaWFsVHlwZS5tYXRjaCggL3dpaS9pICkgKSB7CiAgICAgICAgICAgIG1hdGVyaWFsVHlwZSA9ICJXaWkiOwogICAgICAgIH0KCiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZzogQWRtaW5EYXRhLmNsZWFuTWF0ZXJpYWxUeXBlIiApOwoKICAgICAgICByZXR1cm4gbWF0ZXJpYWxUeXBlOwogICAgfQoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjaGVja3MgaWYgYSBtb3ZpZSByZWNvcmQgaXMgYSBtdXNpYyBtb3ZpZQogICAgICoKICAgICAqIEB0eXBlIGZ1bmN0aW9uCiAgICAgKiBAc3ludGF4IEFkbWluRGF0YS5pc011c2ljTW92aWUKICAgICAqIEBwYXJhbSBjb250YWluZXIKICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUgaWYgbXVzaWMgbW92aWUKICAgICAqLwogICAgZnVuY3Rpb24gaXNNdXNpY01vdmllKCBjb250YWluZXIgKSB7CgogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIEFkbWluRGF0YS5pc011c2ljTW92aWUiICk7CgogICAgICAgIHZhciBzdWJUZXh0ID0gWFBhdGguc2VsZWN0VGV4dCggIi8qL21hcmN4OmNvbGxlY3Rpb24vbWFyY3g6cmVjb3JkL21hcmN4OmRhdGFmaWVsZFsgQHRhZyA9ICcwMDknIF0vbWFyY3g6c3ViZmllbGRbIEBjb2RlID0gJ2EnIF1bIDEgXSIsIGNvbnRhaW5lciApOwogICAgICAgIHN1YlRleHQgKz0gWFBhdGguc2VsZWN0VGV4dCggIi8qL21hcmN4OmNvbGxlY3Rpb24vbWFyY3g6cmVjb3JkL21hcmN4OmRhdGFmaWVsZFsgQHRhZyA9ICcwMDknIF0vbWFyY3g6c3ViZmllbGRbIEBjb2RlID0gJ2InIF1bIDEgXSIsIGNvbnRhaW5lciApOwoKICAgICAgICBpZiAoIHN1YlRleHQubWF0Y2goIC9zLyApICkgewogICAgICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIEFkbWluRGF0YS5pc011c2ljTW92aWUiICk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICAvL2lra2UgYWxsZSBwb3N0ZXIgbWVkIGRlIGRpc3NlIGdlbnJlciBoYXIgcyBpIDAwOSBhIGVsbGVyIGIuIE1BUiB2aWwgZ2VybmUgaGF2ZSwgYXQgbWVzdCBtdWxpZ3QgYmxpdmVyIHdvcmtUeXBlPW11c2lrLiBEZXJmb3IgZmFuZ2VyIHZpIGRlbSBoZXIvMjAxNi0wMi0wMSBTVFcKICAgICAgICB2YXIgZ2VucmVzID0gWFBhdGguc2VsZWN0KCAiLyovZGthYm06cmVjb3JkL2RjOnN1YmplY3RbIEB4c2k6dHlwZSA9ICdka2RjcGx1czpnZW5yZScgXSIsIGNvbnRhaW5lciApOwogICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IGdlbnJlcy5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgc3dpdGNoICggZ2VucmVzWyBpIF0udGV4dENvbnRlbnQgKSB7CiAgICAgICAgICAgICAgICBjYXNlICJwb3BmaWxtIjoKICAgICAgICAgICAgICAgIGNhc2UgImphenpmaWxtIjoKICAgICAgICAgICAgICAgIGNhc2UgIm11c2ljYWxmaWxtIjoKICAgICAgICAgICAgICAgIGNhc2UgInJvY2tmaWxtIjoKICAgICAgICAgICAgICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIEFkbWluRGF0YS5pc011c2ljTW92aWUiICk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgoKICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIEFkbWluRGF0YS5pc011c2ljTW92aWUiICk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogTWV0aG9kIHRoYXQgY3JlYXRlcyBhbiBBZGRpIHJlZmVyZW5jZSB4bWwgaW5zdGFuY2UuCiAgICAgKiBUaGUgcmVmRGF0YU9iamVjdCBjb250YWlucyBpbmZvcm1hdGlvbiBzcGVjaWZpYyBmb3IgdXNlIGluIHRoZSBJTyBzeXN0ZW0gYWJvdXQKICAgICAqIGVucmljaG1lbnRUcmFpbCBpZiB0aGUgcmVjb3JkIGlzIGEgInBhYWhhZW5nc3Bvc3QiCiAgICAgKiBlbmNvZGVBczI3MDkgdHJ1ZSBpZiByZWNvcmQgaXMgZ29pbmcgdG8gQkFTSVMgYW5kIG5lZWRzIHRvIGJlIGVuY29kZWQgYXMgMjcwOSBpbiB0aGUgRVMgc2luawogICAgICogdXBkYXRlVGVtcGxhdGUgdGhlIHRlbXBsYXRlIHRoYXQgc2hvdWxkIGJlIHVzZWQgaWYgdGhlIHJlY29yZCBpcyBnb2luZyB0byBiZSB2YWxpZGF0ZWQgYWdhaW5zdCB0aGUgT3BlblVwZGF0ZSBzZXJ2aWNlCiAgICAgKgogICAgICogQHR5cGUge21ldGhvZH0KICAgICAqIEBzeW50YXggQWRtaW5EYXRhLmNyZWF0ZVJlZmVyZW5jZURhdGFGb3JEYXRhd2VsbCggc3VibWl0dGVyLCBmb3JtYXQsIGxhbmd1YWdlLCByZWZEYXRhT2JqZWN0ICkKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdWJtaXR0ZXIgU3VibWl0dGVyIG51bWJlciBvZiB0aGUgc291cmNlCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZm9ybWF0IEZvcm1hdCBvZiB0aGUgc291cmNlCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbGFuZ3VhZ2UgbGFuZ3VhZ2Ugb2YgdGhlIHNvdXJjZQogICAgICogQHBhcmFtIHtPYmplY3R9IHJlZkRhdGFPYmplY3Qgb2JqZWN0IGNvbnRhaW5pbmcgcG9zc2libGUgZW5yaWNobWVudFRyYWlsLCBlbmNvZGVBczI3MDkgb3IgdXBkYXRlVGVtcGxhdGUKICAgICAqIEByZXR1cm4ge0RvY3VtZW50fSBBZGRpIHJlZmVyZW5jZSBYTUwgb2JqZWN0CiAgICAgKiBAZXhhbXBsZSBBZG1pbkRhdGEuY3JlYXRlUmVmZXJlbmNlRGF0YUZvckRhdGF3ZWxsKCAiODkwNzkxIiwgImFydGlrbGVyIiwgImRhbiIgKQogICAgICogQGV4YW1wbGUgQWRtaW5EYXRhLmNyZWF0ZVJlZmVyZW5jZURhdGFGb3JEYXRhd2VsbCggIjg5MDc5MCIsICJrYXRhbG9nIiwgImRhbiIsIHsgImVucmljaG1lbnRUcmFpbCI6ICI3NjE1MDAiIH0gKQogICAgICogQGV4YW1wbGUgQWRtaW5EYXRhLmNyZWF0ZVJlZmVyZW5jZURhdGFGb3JEYXRhd2VsbCggIjg5MDc5MCIsICJrYXRhbG9nIiwgImRhbiIsIHsgImVuY29kZUFzMjcwOSI6IHRydWUgfSApCiAgICAgKiBAZXhhbXBsZSBBZG1pbkRhdGEuY3JlYXRlUmVmZXJlbmNlRGF0YUZvckRhdGF3ZWxsKCAiODkwNzkwIiwgImthdGFsb2ciLCAiZGFuIiwgeyAidXBkYXRlVGVtcGxhdGUiOiAiZGJjIiB9ICkKICAgICAqIEBuYW1lIEFkbWluRGF0YS5jcmVhdGVSZWZlcmVuY2VEYXRhRm9yRGF0YXdlbGwKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgZnVuY3Rpb24gY3JlYXRlUmVmZXJlbmNlRGF0YUZvckRhdGF3ZWxsICggc3VibWl0dGVyLCBmb3JtYXQsIGxhbmd1YWdlLCByZWZEYXRhT2JqZWN0ICkgewoKICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZzogQWRtaW5EYXRhLmNyZWF0ZVJlZmVyZW5jZURhdGFGb3JEYXRhd2VsbCBmdW5jdGlvbiIgKTsKCiAgICAgICAgdmFyIHJlZmVyZW5jZWRhdGEgPSBYbWxVdGlsLmNyZWF0ZURvY3VtZW50KCAicmVmZXJlbmNlZGF0YSIsIFhtbE5hbWVzcGFjZXMuZXMgKTsKICAgICAgICB2YXIgaW5mbyA9IFhtbFV0aWwuYXBwZW5kQ2hpbGRFbGVtZW50KCByZWZlcmVuY2VkYXRhLCAiaW5mbyIsIFhtbE5hbWVzcGFjZXMuZXMgKTsKICAgICAgICBYbWxVdGlsLnNldEF0dHJpYnV0ZSggaW5mbywgJ3N1Ym1pdHRlcicsIHN1Ym1pdHRlciApOwogICAgICAgIGlmICggIm5ldGx5ZHVuZyIgPT09IGZvcm1hdCApIHsKICAgICAgICAgICBYbWxVdGlsLnNldEF0dHJpYnV0ZSggaW5mbywgJ2Zvcm1hdCcsICJuZXRseWRib2ciICk7CiAgICAgICAgfSBlbHNlIGlmICggImVib2d1bmciID09PSBmb3JtYXQgKXsKICAgICAgICAgICBYbWxVdGlsLnNldEF0dHJpYnV0ZSggaW5mbywgJ2Zvcm1hdCcsICJlYm9nIiApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICBYbWxVdGlsLnNldEF0dHJpYnV0ZSggaW5mbywgJ2Zvcm1hdCcsIGZvcm1hdCApOwogICAgICAgIH0KICAgICAgICBYbWxVdGlsLnNldEF0dHJpYnV0ZSggaW5mbywgJ2xhbmd1YWdlJywgbGFuZ3VhZ2UgKTsKICAgICAgICBpZiAoIHVuZGVmaW5lZCAhPT0gcmVmRGF0YU9iamVjdCAmJiB1bmRlZmluZWQgIT09IHJlZkRhdGFPYmplY3QuZW5yaWNobWVudFRyYWlsICkgewogICAgICAgICAgICBYbWxVdGlsLnNldEF0dHJpYnV0ZSggaW5mbywgJ2NvbnRlbnRGcm9tJywgcmVmRGF0YU9iamVjdC5lbnJpY2htZW50VHJhaWwpOwogICAgICAgIH0KICAgICAgICBpZiAoIHVuZGVmaW5lZCAhPT0gcmVmRGF0YU9iamVjdCAmJiB1bmRlZmluZWQgIT09IHJlZkRhdGFPYmplY3QuZW5jb2RlQXMyNzA5ICYmIHRydWUgPT09IHJlZkRhdGFPYmplY3QuZW5jb2RlQXMyNzA5ICkgewoKICAgICAgICAgICAgdmFyIGVuY29kZVhtbCA9IFhtbFV0aWwuZnJvbVN0cmluZygnPGRhdGFpbzpzaW5rLXByb2Nlc3NpbmcgeG1sbnM6ZGF0YWlvPSJkay5kYmMuZGF0YWlvLnByb2Nlc3NpbmciIGVuY29kZUFzMjcwOT0idHJ1ZSIgY2hhcnNldD0iZGFubWFyYzIiLz4nKTsKICAgICAgICAgICAgWG1sVXRpbC5hcHBlbmRDaGlsZCggcmVmZXJlbmNlZGF0YSwgZW5jb2RlWG1sICk7CiAgICAgICAgfQogICAgICAgIGlmICggdW5kZWZpbmVkICE9PSByZWZEYXRhT2JqZWN0ICYmIHVuZGVmaW5lZCAhPT0gcmVmRGF0YU9iamVjdC51cGRhdGVUZW1wbGF0ZSApIHsKCiAgICAgICAgICAgIHZhciBlbmNvZGVYbWwgPSBYbWxVdGlsLmZyb21TdHJpbmcoJzxkYXRhaW86c2luay11cGRhdGUtdGVtcGxhdGUgeG1sbnM6ZGF0YWlvPSJkay5kYmMuZGF0YWlvLnByb2Nlc3NpbmciIHVwZGF0ZVRlbXBsYXRlPSInICsgcmVmRGF0YU9iamVjdC51cGRhdGVUZW1wbGF0ZSArICciLz4nKTsKICAgICAgICAgICAgWG1sVXRpbC5hcHBlbmRDaGlsZCggcmVmZXJlbmNlZGF0YSwgZW5jb2RlWG1sICk7CiAgICAgICAgfQogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmc6IEFkbWluRGF0YS5jcmVhdGVSZWZlcmVuY2VEYXRhRm9yRGF0YXdlbGwgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiByZWZlcmVuY2VkYXRhOwoKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIGNyZWF0ZVRpbmdDb250YWluZXI6IGNyZWF0ZVRpbmdDb250YWluZXIsCiAgICAgICAgZ2V0TGlicmFyeVR5cGU6IGdldExpYnJhcnlUeXBlLAogICAgICAgIGNoZWNrVHlwZU9mU3VibWl0dGVyOiBjaGVja1R5cGVPZlN1Ym1pdHRlciwKICAgICAgICBjcmVhdGVDb2xsZWN0aW9uSWRlbnRpZmllcnM6IGNyZWF0ZUNvbGxlY3Rpb25JZGVudGlmaWVycywKICAgICAgICBpc0NoaWxkcmVuc01hdGVyaWFsOiBpc0NoaWxkcmVuc01hdGVyaWFsLAogICAgICAgIGNyZWF0ZUFkbWluRGF0YVhtbDogY3JlYXRlQWRtaW5EYXRhWG1sLAogICAgICAgIGNyZWF0ZUluZGV4aW5nQWxpYXNYbWw6IGNyZWF0ZUluZGV4aW5nQWxpYXNYbWwsCiAgICAgICAgZ2V0QWNjZXNzVHlwZTogZ2V0QWNjZXNzVHlwZSwKICAgICAgICBjcmVhdGVXb3JrVHlwZTogY3JlYXRlV29ya1R5cGUsCiAgICAgICAgY2xlYW5NYXRlcmlhbFR5cGU6IGNsZWFuTWF0ZXJpYWxUeXBlLAogICAgICAgIGlzTXVzaWNNb3ZpZTogaXNNdXNpY01vdmllLAogICAgICAgIGNyZWF0ZVJlZmVyZW5jZURhdGFGb3JEYXRhd2VsbDogY3JlYXRlUmVmZXJlbmNlRGF0YUZvckRhdGF3ZWxsCiAgICAgICAgfTsKCgogICAgfSgpOw==", "moduleName": "AdminData"}, {"javascript": "LyoqCiAqIEBmaWxlIEZpbGUgdGhhdCBwcm92aWRlcyBhIG1vZHVsZSB0byBoYW5kbGUgc29tZSBzbWFsbCBjb252ZXJzaW9uCiAqIGlzc3VlcyB3aXRoIFhNTCBzdHJpbmdzIGFuZCBvYmplY3RzIGFuZCBvdGhlciB1dGlsaXRpZXMuICovCgp1c2UoICJMb2ciICk7CnVzZSggIlhNTERPTSIgKTsKdXNlKCAiWFBhdGgiICk7CnVzZSggIlV0aWwiICk7CnVzZSggIk5vZGVUeXBlcyIgKTsKCkVYUE9SVEVEX1NZTUJPTFMgPSBbICJYbWxVdGlsIiBdOwovKioKICogVXRpbGl0eSBtZXRob2RzIGZvciBYTUwgaGFuZGxpbmcuCiAqIAogKiBWYXJpb3VzIHV0aWxpdHkgbWV0aG9kcyBmb3IgWE1MIGhhbmRsaW5nLiBTb21lIG1vc3RseSB0byBlbnN1cmUgc2FtZQogKiB0cmVhdG1lbnQgb2YgWE1MIGNvZGUgYWNyb3NzIHZhcmlvdXMgaW1wbGVtZW50YXRpb25zLiAKICogCiAqIEB0eXBlIHtuYW1lc3BhY2V9CiAqIEBuYW1lc3BhY2UgCiAqIEBuYW1lIFhtbFV0aWwKICovCnZhciBYbWxVdGlsID0gZnVuY3Rpb24oICkgewoKICAgIC8vIE9iamVjdCB0aGF0IGV2ZW50dWFsbHkgZ2V0cyBleHBvcnRlZAogICAgdmFyIHRoYXQgPSB7fTsKICAgIAogICAgLyoqCiAgICAgKiBJbnN0YW5jZSBvZiBET01JbXBsZW1lbnRhdGlvbgogICAgICogaHR0cDovL3d3dy53My5vcmcvVFIvRE9NLUxldmVsLTItQ29yZS9jb3JlLmh0bWwjSUQtMTAyMTYxNDkwCiAgICAgKiBAdHlwZSB7RE9NSW1wbGVtZW50YXRpb259CiAgICAgKi8KICAgIHRoYXQuZG9tSW1wbCA9IG5ldyBYTUxET00uRE9NSW1wbGVtZW50YXRpb24oKTsKCiAgICB0aGF0Ll9fZ2V0QWN0dWFsTm9kZSA9IGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgICAvLyBTdXBwb3J0IGJvdGggZG9jdW1lbnRzIGFuZCBub2RlcyBhcyBkZXN0aW5hdGlvbgogICAgICAgIGlmKFhtbFV0aWwuaXNEb2N1bWVudChub2RlKSl7CiAgICAgICAgICAgIGlmKG5vZGUuZG9jdW1lbnRFbGVtZW50ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBub2RlLmRvY3VtZW50RWxlbWVudDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgcmV0dXJuIG5vZGUuZ2V0RG9jdW1lbnRFbGVtZW50KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgICB9CiAgICB9OwogICAgdGhhdC5fX3Rocm93RXJyb3IgPSBmdW5jdGlvbihlcnJvcikgewogICAgICAgIExvZy5lcnJvcihlcnJvcik7CiAgICAgICAgdGhyb3cgRXJyb3IoZXJyb3IpOwogICAgfTsKCiAgICAvKioKICAgICAqIFBhcnNlciBmb3IgcGFyc2luZyB4bWwgc3RyaW5ncyBpbnRvIERPTSBEb2N1bWVudHMKICAgICAqIEB0eXBlIHtET01QYXJzZXJ9CiAgICAgKi8KICAgIHRoYXQucGFyc2VyID0gbmV3IFhNTERPTS5ET01QYXJzZXIoewogICAgICAgIGVycm9ySGFuZGxlcjogZnVuY3Rpb24gKGtleSwgbXNnKSB7CiAgICAgICAgICAgIHZhciBlcnJvciA9ICJFcnJvciBwYXJzaW5nIGRvY3VtZW50LCBrZXk6JyIgKyBrZXkgKyAiJywgbWVzc2FnZTonIiArIG1zZyArICInIjsKICAgICAgICAgICAgWG1sVXRpbC5fX3Rocm93RXJyb3IoZXJyb3IpOwogICAgICAgIH19CiAgICApOwogICAgCiAgICAvKioKICAgICAqIFBhcnNlcyBYTUwgaW4gYSBzdHJpbmcgaW50byBhIERPTSBkb2N1bWVudAogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhtbFV0aWwuZnJvbVN0cmluZwogICAgICogQHN5bnRheCBYbWxVdGlsLmZyb21TdHJpbmcoeG1sU3RyaW5nKQogICAgICogQHBhcmFtIHtzdHJpbmd9IHhtbFN0cmluZyBzdHJpbmcgdG8gYmUgcGFyc2VkIHRvIERPTQogICAgICogQHJldHVybiB7RG9jdW1lbnR9IFBhcnNlZCBYTUwgRG9jdW1lbnQKICAgICAqIEBleGFtcGxlCiAgICAgKiB2YXIgZG9jID0gWG1sVXRpbC5mcm9tU3RyaW5nKCI8cm9vdD48Y2hpbGQ+aGVsbG8gJmFtcDsgd29ybGQ8L2NoaWxkPjxjaGlsZD5mb28gJmFtcDsgYmFyPC9jaGlsZD48L3Jvb3Q+IikKICAgICAqLwogICAgdGhhdC5mcm9tU3RyaW5nID0gZnVuY3Rpb24oeG1sU3RyaW5nKXsKICAgICAgICBMb2cudHJhY2UoIkVudGVyaW5nIFhtbFV0aWwuZnJvbVN0cmluZywgJyIsIHhtbFN0cmluZywgIiciKTsKLy8gICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICggeG1sU3RyaW5nID09PSBudWxsIHx8IHhtbFN0cmluZyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBYbWxVdGlsLl9fdGhyb3dFcnJvcigiWG1sVXRpbC5mcm9tU3RyaW5nOiBkb2N1bWVudCBpcyByZXF1aXJlZCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggeG1sU3RyaW5nID09PSAnJykgewogICAgICAgICAgICAgICAgWG1sVXRpbC5fX3Rocm93RXJyb3IoIlhtbFV0aWwuZnJvbVN0cmluZzogZG9jdW1lbnQgaXMgZW1wdHkiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gWG1sVXRpbC5wYXJzZXIucGFyc2VGcm9tU3RyaW5nKHhtbFN0cmluZyk7Ci8vICAgICAgICB9IGZpbmFsbHkgewovLyAgICAgICAgICAgIExvZy50cmFjZSgiTGVhdmluZyBYbWxVdGlsLmZyb21TdHJpbmciKTsKLy8gICAgICAgIH0KICAgIH07CgoKICAgIC8qKgogICAgICogTWFrZSBvYmplY3QgdGhhdCB1c2VzIHRvWG1sU3RyaW5nIGFzIHRvU3RyaW5nLgogICAgICoKICAgICAqIFRoaXMgZnVuY3Rpb24gIndyYXBzIiB0aGUgeG1sIG9iamVjdCBwYXNzZWQgdG8gaXQsIGFuZCBjcmVhdGVzIGEgbmV3IG9iamVjdCB0aGF0IHVzZXMgdGhlIHRvWG1sU3RyaW5nIGFzIHRvU3RyaW5nLgogICAgICogSXQgaXMgbW9zdGx5IGludGVuZGVkIHRvIGJlIHVzZWQgd2hlbiBsb2dnaW5nIFhNTCBvYmplY3RzLiBCeSB1c2luZyB0aGlzIG1ldGhvZCwgdGhlIHRvWG1sU3RyaW5nIGlzIG9ubHkgY2FsbGVkIGlmIHRoZQogICAgICogbG9nIGxldmVsIGlzIGVuYWJsZWQsIHdoaWNoIGNhbiByZXN1bHQgaW4gaHVnZSBwZXJmb3JtYW5jZSBpbXByb3ZlbWVudHMgd2hlbiBsZXZlbHMgYXJlIGRpc2FibGVkLgogICAgICogIFNlZSB0aGUgZXhhbXBsZSBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KICAgICAqCiAgICAgKiBAZXhhbXBsZQovLyBEbyB0aGlzLCB3aGVuIHlvdSBuZWVkIHRvIGxvZyBzb21lIFhNTCAoZ29vZCk6CkxvZy5kZWJ1ZyggIlRoZSB4bWwgaXM6ICIsIFhtbFV0aWwubG9nWG1sU3RyaW5nKCB4bWwgKSApOwovLyBpbnN0ZWFkIG9mIHRoaXMgKGJhZCwgZG9uJ3QgZG8gdGhpcyk6CkxvZy5kZWJ1ZyggIlRoZSB4bWwgaXM6ICIsIHhtbC50b1htbFN0cmluZygpICk7CiAgICAgKgogICAgICogQHBhcmFtIHtEb2N1bWVudHxFbGVtZW50fSB4bWwgQW4geG1sIG9iamVjdCBvciBhcnJheSBvZiB4bWwgb2JqZWN0cyB0byBjYWxsIHRvWE1MU3RyaW5nIG9uLgogICAgICogQHJldHVybiB7T2JqZWN0fSBBbiBvYmplY3QgdGhhdCBjYW4gYmUgdXNlZCBmb3IgZGVsYXllZCB0b1N0cmluZyBpbnZvY2F0aW9ucy4KICAgICAqIEBzeW50YXggWG1sVXRpbC5sb2dYbWxTdHJpbmcoIHhtbCApOwogICAgICogQG5hbWUgWG1sVXRpbC5sb2dYbWxTdHJpbmcKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgdGhhdC5sb2dYbWxTdHJpbmcgPSBmdW5jdGlvbiAoIHhtbCApIHsKICAgICAgICB2YXIgcmVzID0ge307CiAgICAgICAgcmVzLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoIFV0aWwuZ2V0VHlwZSggeG1sICkgPT09ICdBcnJheScgKSB7CiAgICAgICAgICAgICAgICB2YXIgcmVzID0gIiI7CiAgICAgICAgICAgICAgICBmb3IgKCB2YXIgaSA9IDAgOyBpIDwgeG1sLmxlbmd0aCA7IGkrKyApIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzKz0gIiwiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXMgKz0gWG1sVXRpbC50b1htbFN0cmluZyh4bWxbaV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBYbWxVdGlsLnRvWG1sU3RyaW5nKHhtbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHJldHVybiByZXM7CiAgICB9OwoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHhtbERvY3VtZW50KHMpLgogICAgICogSWYgcGFyYW1ldGVyIGlzIGFuIGFycmF5LCBhIGNvbW1hIHNlcGFyYXRlZCBzdHJpbmcgcmVwcmVzZW50YXRpb24gaXMgcHJvZHVjZWQKICAgICAqCiAgICAgKiBAbWV0aG9kIAogICAgICogQHBhcmFtIHtOb2RlfE5vZGVbXX0gZG9jIE5vZGUgb3IgTm9kZXMgdG8gY29udmVydCB0byBzdHJpbmcKICAgICAqIEBzeW50YXggWG1sVXRpbC50b1htbFN0cmluZyggZG9jICkKICAgICAqIEBuYW1lIFhtbFV0aWwudG9YbWxTdHJpbmcKICAgICAqIEByZXR1cm5zIHtzdHJpbmd9CiAgICAgKi8KICAgIHRoYXQudG9YbWxTdHJpbmcgPSBmdW5jdGlvbiAoZG9jKSB7CiAgICAgICAgdmFyIHJldHVyblN0cmluZyA9ICcnOwogICAgICAgIGlmIChkb2MgaW5zdGFuY2VvZiBBcnJheSkgewogICAgICAgICAgICBmb3IgKCB2YXIgaSA9IDAgOyBpIDwgZG9jLmxlbmd0aCA7IGkrKyApIHsKICAgICAgICAgICAgICAgIGlmIChyZXR1cm5TdHJpbmcubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgICAgIHJldHVyblN0cmluZyArPSAnLCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm5TdHJpbmcgKz0gWG1sVXRpbC5wYXJzZXIudG9YbWxTdHJpbmcoZG9jW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuU3RyaW5nID0gWG1sVXRpbC5wYXJzZXIudG9YbWxTdHJpbmcoZG9jKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFN0cmluZyggcmV0dXJuU3RyaW5nICk7CiAgICB9OwoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIGlmIGEgbm9kZSBpcyBhIERvY3VtZW50IG5vZGUKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLmlzRG9jdW1lbnQKICAgICAqIEBzeW50YXggWG1sVXRpbC5pc0RvY3VtZW50KG5vZGUpCiAgICAgKiBAcGFyYW0ge05vZGV9IG5vZGUKICAgICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIG5vZGUgaXMgYSBkb2N1bWVudAogICAgICogQGV4YW1wbGUKICAgICAqIGlmICggWG1sVXRpbC5pc0RvY3VtZW50KG5vZGUpICkgewogICAgICogICAvLyBEbyBzdHVmZgogICAgICogfQogICAgICovCiAgICB0aGF0LmlzRG9jdW1lbnQgPSBmdW5jdGlvbihub2RlKSB7CiAgICAgICAgdmFyIG5vZGVUeXBlID0gbm9kZS5ub2RlVHlwZTsKICAgICAgICByZXR1cm4gKG5vZGVUeXBlID09PSBOb2RlVHlwZXMuRE9DVU1FTlRfTk9ERSk7CiAgICB9OwoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIGlmIGEgbm9kZSBpcyBhbiBFbGVtZW50IG5vZGUKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLmlzRWxlbWVudAogICAgICogQHN5bnRheCBYbWxVdGlsLmlzRWxlbWVudChub2RlKQogICAgICogQHBhcmFtIHtOb2RlfSBub2RlCiAgICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBub2RlIGlzIGEgZG9jdW1lbnQKICAgICAqIEBleGFtcGxlCiAgICAgKiBpZiAoIFhtbFV0aWwuaXNFbGVtZW50KG5vZGUpICkgewogICAgICogICAvLyBEbyBzdHVmZgogICAgICogfQogICAgICovCiAgICB0aGF0LmlzRWxlbWVudCA9IGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgICB2YXIgbm9kZVR5cGUgPSBub2RlLm5vZGVUeXBlOwogICAgICAgIC8vTG9nLnRyYWNlKCJFbnRlcmluZyBYbWxVdGlsLmlzRWxlbWVudCBmb3Igbm9kZSB0eXBlICIgKyBub2RlVHlwZSApOwogICAgICAgIHJldHVybiAobm9kZVR5cGUgPT09IE5vZGVUeXBlcy5FTEVNRU5UX05PREUpOwogICAgfTsKCgogICAvKioKICAgICAqIERldGVybWluZSBpZiBuYW1lc3BhY2UgaXMgZGVmaW5lZCBpbiB0aGUgbm9kZSBvciBvbmUgb2YgaXRzIGFuY2VzdG9ycwogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhtbFV0aWwuaXNOYW1lc3BhY2VEZWZpbmVkCiAgICAgKiBAc3ludGF4IFhtbFV0aWwuaXNOYW1lc3BhY2VEZWZpbmVkKG5vZGUsIG5hbWVzcGFjZSkKICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZQogICAgICogQHBhcmFtIHtOYW1lc3BhY2V9IG5hbWVzcGFjZQogICAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgbm9kZSBpcyBhIGRvY3VtZW50CiAgICAgKiBAZXhhbXBsZQogICAgICogaWYgKCBYbWxVdGlsLmlzTmFtZXNwYWNlRGVmaW5lZChub2RlLCBYbWxOYW1lc3BhY2VzLmRjKSApIHsKICAgICAqICAgLy8gRG8gc3R1ZmYKICAgICAqIH0KICAgICAqLwogICAgdGhhdC5pc05hbWVzcGFjZURlZmluZWQgPSBmdW5jdGlvbihub2RlLCBuYW1lc3BhY2UpIHsKLy8gICAgICAgIExvZy50cmFjZSgiRW50ZXJpbmcgWG1sVXRpbC5pc05hbWVzcGFjZURlZmluZWQgZm9yIG5vZGUgIiArIG5vZGUudG9TdHJpbmcoKSk7Ci8vICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgZG9jID0gbm9kZS5vd25lckRvY3VtZW50OwogICAgICAgICAgICB2YXIgY3VycmVudCA9IG5vZGU7CiAgICAgICAgICAgIHZhciBhdHRyTmFtZSA9IFhtbE5hbWVzcGFjZXMueG1sbnMucHJlZml4ICsgIjoiICsgbmFtZXNwYWNlLnByZWZpeDsKICAgICAgICAgICAgTG9nLnRyYWNlKCJYbWxVdGlsLmlzTmFtZXNwYWNlRGVmaW5lZCwgbG9va2luZyBmb3IgbmFtZXNwYWNlIGRlZmluaXRpb246ICIsIGF0dHJOYW1lKTsKICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICAgIGlmICggIWN1cnJlbnQgfHwgWG1sVXRpbC5pc0RvY3VtZW50KGN1cnJlbnQpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGN1cnJlbnQuZ2V0QXR0cmlidXRlKGF0dHJOYW1lKSAhPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vTG9nLmRlYnVnKCAiWG1sVXRpbC5pc05hbWVzcGFjZURlZmluZWQsIGN1cnJlbnQ6ICIsIFhtbFV0aWwudG9YbWxTdHJpbmcoIGN1cnJlbnQgKSApOwogICAgICAgICAgICAgICAgY3VycmVudCA9IGN1cnJlbnQucGFyZW50Tm9kZTsKICAgICAgICAgICAgfQovLyAgICAgICAgfQovLyAgICAgICAgZmluYWxseSB7Ci8vICAgICAgICAgICAgTG9nLnRyYWNlKCJMZWF2aW5nIFhtbFV0aWwuaXNOYW1lc3BhY2VEZWZpbmVkIGZvciBub2RlIHR5cGUgIiArIG5vZGUubm9kZVR5cGUpOwovLyAgICAgICAgfQogICAgfTsKCiAgICAvKioKICAgICAqIENyZWF0ZSBhIGRvY3VtZW50IHdpdGggYSBuYW1lZCByb290IGVsZW1lbnQKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLmNyZWF0ZURvY3VtZW50CiAgICAgKiBAc3ludGF4IFhtbFV0aWwuY3JlYXRlRG9jdW1lbnQocm9vdEVsZW1lbnROYW1lLCBuYW1lc3BhY2UpCiAgICAgKiBAcGFyYW0ge3N0cmluZ3x1bmRlZmluZWR9IHJvb3RFbGVtZW50TmFtZSBuYW1lIG9mIHJvb3QgZWxlbWVudC4gU2tpcCB0aGlzIHRvIGNyZWF0ZSBhIGRvY3VtZW50IHdpdGggbm8gZG9jdW1lbnRFbGVtZW50CiAgICAgKiBAcGFyYW0ge05hbWVzcGFjZXx1bmRlZmluZWR9IG5hbWVzcGFjZSBvcHRpb25hbCBuYW1lc3BhY2Ugb2JqZWN0IGluIFhtbE5hbWVzcGFjZXMKICAgICAqIEByZXR1cm4ge0RvY3VtZW50fSBOZXdseSBjcmVhdGVkIGRvY3VtZW50CiAgICAgKiBAZXhhbXBsZQogICAgICogdmFyIGRvYyA9IFhtbFV0aWwuY3JlYXRlRG9jdW1lbnQoKQogICAgICogdmFyIGRvYyA9IFhtbFV0aWwuY3JlYXRlRG9jdW1lbnQoImRjIiwgWG1sTmFtZXNwYWNlcy5vYWlfZGMpCiAgICAgKiAvLyBjcmVhdGVzICc8b2FpX2RjOmRjIHhtbG5zOm9haV9kYz0iaHR0cDovL3d3dy5vcGVuYXJjaGl2ZXMub3JnL09BSS8yLjAvb2FpX2RjLyIvPicKICAgICAqLwogICAgdGhhdC5jcmVhdGVEb2N1bWVudCA9IGZ1bmN0aW9uKHJvb3RFbGVtZW50TmFtZSwgbmFtZXNwYWNlKSB7Ci8vICAgICAgICBMb2cudHJhY2UoIkVudGVyaW5nIFhtbFV0aWwuY3JlYXRlRG9jdW1lbnQiKTsKLy8gICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChuYW1lc3BhY2UpIHsKICAgICAgICAgICAgICAgIHZhciBwcmVmaXggPSBuYW1lc3BhY2UucHJlZml4OwogICAgICAgICAgICAgICAgdmFyIG5hbWVzcGFjZVVSSSA9IG5hbWVzcGFjZS51cmk7CiAgICAgICAgICAgICAgICB2YXIgcXVhbGlmaWVkTmFtZSA9IHByZWZpeCArICI6IiArIHJvb3RFbGVtZW50TmFtZTsKICAgICAgICAgICAgICAgIExvZy5kZWJ1ZygiWG1sVXRpbC5jcmVhdGVEb2N1bWVudCwgY3JlYXRpbmcgZG9jdW1lbnQgd2l0aCByb290IGVsZW1lbnQgJyIsIHF1YWxpZmllZE5hbWUsICInIGFuZCBuYW1lc3BhY2UgdXJpICciLCBuYW1lc3BhY2VVUkksICInIik7CiAgICAgICAgICAgICAgICB2YXIgZG9jdW1lbnQgPSBYbWxVdGlsLmRvbUltcGwuY3JlYXRlRG9jdW1lbnQobmFtZXNwYWNlVVJJLCBxdWFsaWZpZWROYW1lLG51bGwpOwogICAgICAgICAgICAgICAgLy92YXIgZG9jdW1lbnQgPSBYTUxET00uY3JlYXRlRG9jdW1lbnQobmFtZXNwYWNlLCByb290RWxlbWVudE5hbWUpCgogICAgICAgICAgICAgICAgWG1sVXRpbC5hZGREb2N1bWVudE5hbWVzcGFjZShkb2N1bWVudCwgbmFtZXNwYWNlKTsKICAgICAgICAgICAgICAgIHJldHVybiBkb2N1bWVudDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIExvZy5kZWJ1ZygiWG1sVXRpbC5jcmVhdGVEb2N1bWVudCwgY3JlYXRpbmcgZG9jdW1lbnQgd2l0aCByb290IGVsZW1lbnQgJyIsIHJvb3RFbGVtZW50TmFtZSwgIiciKTsKICAgICAgICAgICAgICAgIHJldHVybiBYbWxVdGlsLmRvbUltcGwuY3JlYXRlRG9jdW1lbnQodW5kZWZpbmVkLCByb290RWxlbWVudE5hbWUpOwogICAgICAgICAgICAgICAgLy9yZXR1cm4gWG1sVXRpbC5kb21JbXBsLmNyZWF0ZURvY3VtZW50KG51bGwsIG51bGwsbnVsbCk7CiAgICAgICAgICAgIH0KLy8gICAgICAgIH0gZmluYWxseSB7Ci8vICAgICAgICAgICAgTG9nLnRyYWNlKCJMZWF2aW5nIFhtbFV0aWwuY3JlYXRlRG9jdW1lbnQiKTsKLy8gICAgICAgIH0KICAgIH07CgogICAgLyoqCiAgICAgKiBBZGQgYSBuYW1lc3BhY2UgcHJlZml4IGRlZmluaXRpb24gdG8gdGhlIHJvb3QgZG9jdW1lbnQgZWxlbWVudCBpbiBhIGRvY3VtZW50CiAgICAgKgogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgWG1sVXRpbC5hZGREb2N1bWVudE5hbWVzcGFjZQogICAgICogQHN5bnRheCBYbWxVdGlsLmFkZERvY3VtZW50TmFtZXNwYWNlKGRvY3VtZW50LCBuYW1lc3BhY2UpCiAgICAgKiBAcGFyYW0ge0RvY3VtZW50fSBkb2N1bWVudCBEb2N1bWVudCB0byBhZGQgbmFtZXNwYWNlIGZvcgogICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWVzcGFjZSBuYW1lc3BhY2UgcHJlZml4IHRvIGxvb2sgdXAKCiAgICAgKiBAZXhhbXBsZQogICAgICogdmFyIGRjWG1sID0gWG1sVXRpbC5hZGREb2N1bWVudE5hbWVzcGFjZSgiZGMiLCAib2FpX2RjIik7CiAgICAgKiBYbWxVdGlsLmFkZERvY3VtZW50TmFtZXNwYWNlKGRjWG1sLCAiZGMiKTsKICAgICAqIC8vIGNyZWF0ZXMgJzxvYWlfZGM6ZGMgeG1sbnM6b2FpX2RjPSJodHRwOi8vd3d3Lm9wZW5hcmNoaXZlcy5vcmcvT0FJLzIuMC9vYWlfZGMvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iLz4nCiAgICAgKi8KICAgIHRoYXQuYWRkRG9jdW1lbnROYW1lc3BhY2UgPSBmdW5jdGlvbihkb2N1bWVudCwgbmFtZXNwYWNlKSB7Ci8vICAgICAgICBMb2cudHJhY2UoIkVudGVyaW5nIFhtbFV0aWwuYWRkRG9jdW1lbnROYW1lc3BhY2UsIHByZWZpeDoiLCBuYW1lc3BhY2UucHJlZml4KTsKLy8gICAgICAgIHRyeSB7CiAgICAgICAgICAgIFhtbFV0aWwuYWRkTmFtZXNwYWNlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwgbmFtZXNwYWNlKTsKLy8gICAgICAgIH0gZmluYWxseSB7Ci8vICAgICAgICAgICAgTG9nLnRyYWNlKCJMZWF2aW5nIFhtbFV0aWwuYWRkRG9jdW1lbnROYW1lc3BhY2UiKTsKLy8gICAgICAgIH0KICAgIH07CgogICAgLyoqCiAgICAgKiBBZGQgYSBuYW1lc3BhY2UgcHJlZml4IGRlZmluaXRpb24gdG8gc29tZSBlbGVtZW50IGluIGEgZG9jdW1lbnQKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLmFkZE5hbWVzcGFjZQogICAgICogQHN5bnRheCBYbWxVdGlsLmFkZE5hbWVzcGFjZShkb2N1bWVudCwgbmFtZXNwYWNlKQogICAgICogQHBhcmFtIHtOb2RlfSBub2RlIGVsZW1lbnQgdG8gYWRkIG5hbWVzcGFjZSB0bwogICAgICogQHBhcmFtIHtOYW1lc3BhY2V9IG5hbWVzcGFjZSBuYW1lc3BhY2UgcHJlZml4IHRvIGxvb2sgdXAKCiAgICAgKiAqIEBleGFtcGxlCiAgICAgKiB2YXIgc29tZSA9IFhtbFV0aWwuZnJvbVN0cmluZygiPHJvb3Q+PGNoaWxkPjwvY2hpbGQ+PC9yb290PiIpOwogICAgICogWG1sVXRpbC5hZGROYW1lc3BhY2Uoc29tZSwgWG1sTmFtZXNwYWNlLmRjKTsKICAgICAqIC8vIGNyZWF0ZXMgJzxyb290PjxjaGlsZCB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iPjwvY2hpbGQ+PC9yb290PicKICAgICAqLwogICAgdGhhdC5hZGROYW1lc3BhY2UgPSBmdW5jdGlvbiAobm9kZSwgbmFtZXNwYWNlKSB7Ci8vICAgICAgICBMb2cudHJhY2UoIkVudGVyaW5nIFhtbFV0aWwuYWRkTmFtZXNwYWNlLCBwcmVmaXg6IiwgbmFtZXNwYWNlLnByZWZpeCk7Ci8vICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgYWN0dWFsTm9kZSA9IFhtbFV0aWwuX19nZXRBY3R1YWxOb2RlKG5vZGUpOwogICAgICAgICAgICBMb2cuZGVidWcoIlhtbFV0aWwuYWRkTmFtZXNwYWNlLCBjcmVhdGluZyBuYW1lc3BhY2UgYXR0cmlidXRlIHdpdGggcHJlZml4ICciLCBuYW1lc3BhY2UucHJlZml4LCAiJyBhbmQgbmFtZXNwYWNlIHVyaSAnIiwgbmFtZXNwYWNlLnVyaSwgIiciKTsKICAgICAgICAgICAgWG1sVXRpbC5zZXRBdHRyaWJ1dGUoYWN0dWFsTm9kZSwgbmFtZXNwYWNlLnByZWZpeCwgbmFtZXNwYWNlLnVyaSwgWG1sTmFtZXNwYWNlcy54bWxucyk7Ci8vICAgICAgICB9IGZpbmFsbHkgewovLyAgICAgICAgICAgIExvZy50cmFjZSgiTGVhdmluZyBYbWxVdGlsLmFkZE5hbWVzcGFjZSIpOwovLyAgICAgICAgfQogICAgfTsKCiAgICAvKioKICAgICAqIFNldHMgdGhlIG5hbWVzcGFjZS1wcmVmaXggb24gYW4gZWxlbWVudC4gSWYgdGhlIG5hbWVzcGFjZSBpcyBub3QgZGVjbGFyZWQgb24gYW4gYW5jZXN0b3IgYWxlbWVudAogICAgICogaXQgd2lsbCBiZSBkZWNsYXJlZCBvbiB0aGUgcm9vdCBlbGVtZW50LgogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhtbFV0aWwuc2V0TmFtZXNwYWNlCiAgICAgKiBAc3ludGF4IFhtbFV0aWwuc2V0TmFtZXNwYWNlKGRvY3VtZW50LCBuYW1lc3BhY2UpCiAgICAgKiBAcGFyYW0ge05vZGV9IG5vZGUgZWxlbWVudCB0byBhcHBseSB0aGUgcHJlZml4IG9uCiAgICAgKiBAcGFyYW0ge05hbWVzcGFjZX0gbmFtZXNwYWNlIG5hbWVzcGFjZSB0byBzZXQKCiAgICAgKiAqIEBleGFtcGxlCiAgICAgKiB2YXIgc29tZSA9IFhtbFV0aWwuZnJvbVN0cmluZygiPHJvb3Q+PGNoaWxkPjwvY2hpbGQ+PC9yb290PiIpOwogICAgICogWG1sVXRpbC5zZXROYW1lc3BhY2Uoc29tZSwgWG1sTmFtZXNwYWNlLmRjKTsKICAgICAqIC8vIGNyZWF0ZXMgJzxyb290PjxjaGlsZCB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iPjwvY2hpbGQ+PC9yb290PicKICAgICAqLwogICAgdGhhdC5zZXROYW1lc3BhY2UgPSBmdW5jdGlvbiAobm9kZSwgbmFtZXNwYWNlKSB7Ci8vICAgICAgICBMb2cudHJhY2UoIkVudGVyaW5nIFhtbFV0aWwuc2V0TmFtZXNwYWNlLCBwcmVmaXg6IiwgbmFtZXNwYWNlLnByZWZpeCk7Ci8vICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgYWN0dWFsTm9kZSA9IFhtbFV0aWwuX19nZXRBY3R1YWxOb2RlKG5vZGUpOwogICAgICAgICAgICBMb2cuZGVidWcoIlhtbFV0aWwuc2V0TmFtZXNwYWNlLCBjcmVhdGluZyBuYW1lc3BhY2UgYXR0cmlidXRlIHdpdGggcHJlZml4ICciLCBuYW1lc3BhY2UucHJlZml4LCAiJyBhbmQgbmFtZXNwYWNlIHVyaSAnIiwgbmFtZXNwYWNlLnVyaSwgIiciKTsKCiAgICAgICAgICAgIGlmIChYbWxVdGlsLmlzTmFtZXNwYWNlRGVmaW5lZChhY3R1YWxOb2RlLCBuYW1lc3BhY2UpID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgWG1sVXRpbC5hZGREb2N1bWVudE5hbWVzcGFjZShhY3R1YWxOb2RlLm93bmVyRG9jdW1lbnQsIG5hbWVzcGFjZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWN0dWFsTm9kZS5vd25lckRvY3VtZW50LnJlbmFtZU5vZGUoYWN0dWFsTm9kZSwgbmFtZXNwYWNlLnVyaSwgbmFtZXNwYWNlLnByZWZpeCArICI6IiArIGFjdHVhbE5vZGUubm9kZU5hbWUpOwovLyAgICAgICAgfSBmaW5hbGx5IHsKLy8gICAgICAgICAgICBMb2cudHJhY2UoIkxlYXZpbmcgWG1sVXRpbC5zZXROYW1lc3BhY2UiKTsKLy8gICAgICAgIH0KICAgIH07CgogICAgLy8gVE9ETzogY29uc2lkZXIgcmVuYW1pbmcgdG8ganVzdCBjbG9uZToKICAgIC8qKgogICAgICogTWFrZXMgYW4gZXhhY3QgY2xvbmUgb2YgYSBub2RlCiAgICAgKgogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgWG1sVXRpbC5kZWVwQ2xvbmUKICAgICAqIEBzeW50YXggWG1sVXRpbC5kZWVwQ2xvbmUoeG1sTm9kZSkKICAgICAqIEBwYXJhbSB7Tm9kZX0geG1sTm9kZQogICAgICogQHJldHVybiB7RG9jdW1lbnR9CiAgICAgKiBAZXhhbXBsZQogICAgICogWG1sVXRpbC5kZWVwQ2xvbmUoWG1sVXRpbC5mcm9tU3RyaW5nKCI8cm9vdC8+IikpOwogICAgICovCiAgICB0aGF0LmRlZXBDbG9uZSA9IGZ1bmN0aW9uKHhtbE5vZGUpewovLyAgICAgICAgTG9nLnRyYWNlKCJFbnRlcmluZyBYbWxVdGlsLmRlZXBDbG9uZSwgbm9kZTogIiwgWG1sVXRpbC5sb2dYbWxTdHJpbmcoIHhtbE5vZGUgKSApOwovLyAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIHhtbE5vZGUuY2xvbmVOb2RlKHRydWUpOwovLyAgICAgICAgfSBmaW5hbGx5IHsKLy8gICAgICAgICAgICBMb2cudHJhY2UoIkxlYXZpbmcgWG1sVXRpbC5kZWVwQ2xvbmUiKTsKLy8gICAgICAgIH0KICAgIH07CgogICAgLyoqCiAgICAgKiBBIG5vZGUgaXMgY29uc2lkZXJlZCB0byBjb250YWluIGNvbXBsZXggY29udGVudCBpZiBpdCBoYXMgb25lCiAgICAgKiBvciBtb3JlIGNoaWxkIG5vZGVzIG9mIHR5cGUgRUxFTUVOVF9OT0RFLgogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhtbFV0aWwuaGFzQ29tcGxleENvbnRlbnQKICAgICAqIEBzeW50YXggWG1sVXRpbC5oYXNDb21wbGV4Q29udGVudCh4bWxOb2RlKQogICAgICogQHBhcmFtIHtOb2RlfSB4bWxOb2RlCiAgICAgKiBAcmV0dXJuIHtib29sZWFufQogICAgICogQGV4YW1wbGUKICAgICAqIFhtbFV0aWwuaGFzQ29tcGxleENvbnRlbnQoWG1sVXRpbC5mcm9tU3RyaW5nKCI8cm9vdC8+IikpOyAvLyBmYWxzZQogICAgICogWG1sVXRpbC5oYXNDb21wbGV4Q29udGVudChYbWxVdGlsLmZyb21TdHJpbmcoIjxyb290IHNvbWVhdHRyPSdzb21lIGF0dHJpYnV0ZSc+YSB0ZXh0IG5vZGU8L3Jvb3Q+IikpOyAvLyBmYWxzZQogICAgICogWG1sVXRpbC5oYXNDb21wbGV4Q29udGVudChYbWxVdGlsLmZyb21TdHJpbmcoIjxyb290PjxjaGlsZC8+PC9yb290PiIpKTsgLy8gdHJ1ZQogICAgICovCiAgICB0aGF0Lmhhc0NvbXBsZXhDb250ZW50ID0gZnVuY3Rpb24oeG1sTm9kZSl7CiAgICAgICAgTG9nLnRyYWNlKCJFbnRlcmluZyBYbWxVdGlsLmhhc0NvbXBsZXhDb250ZW50ICIsIFhtbFV0aWwubG9nWG1sU3RyaW5nKCB4bWxOb2RlICkgKTsKICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgYWN0dWFsWG1sTm9kZSA9IFhtbFV0aWwuX19nZXRBY3R1YWxOb2RlKHhtbE5vZGUpOwogICAgICAgICAgICBpZiAoICFhY3R1YWxYbWxOb2RlLmNoaWxkTm9kZXMgfHwgeG1sTm9kZS5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gMCkgeyAKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFjdHVhbFhtbE5vZGUuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYoYWN0dWFsWG1sTm9kZS5jaGlsZE5vZGVzLml0ZW0oaSkubm9kZVR5cGUgPT09IE5vZGVUeXBlcy5FTEVNRU5UX05PREUpewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIFhtbFV0aWwuaGFzQ29tcGxleENvbnRlbnQiKTsKICAgICAgICB9IAogICAgfTsKCiAgICAvKioKICAgICAqIEFwcGVuZCBhIGNoaWxkIHRvIGEgcGFyZW50IG5vZGUuCiAgICAgKgogICAgICogQXV0b21hdGljYWxseSBjbG9uZXMgb3IgaW1wb3J0cyBjaGlsZCBpZiBuZWNlc3NhcnkuCiAgICAgKiBJZiBjaGlsZCBiZWxvbmdzIHRvIGEgZGlmZmVyZW50IGRvY3VtZW50LCBpdCBpcyBpbXBvcnRlZC4KICAgICAqIElmIGNoaWxkIGFscmVhZHkgaGFzIGEgcGFyZW50LCBpdCBpcyBjbG9uZWQKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLmFwcGVuZENoaWxkCiAgICAgKiBAc3ludGF4IFhtbFV0aWwuYXBwZW5kQ2hpbGQocGFyZW50LCBjaGlsZCkKICAgICAqIEBwYXJhbSB7Tm9kZXxEb2N1bWVudH0gcGFyZW50IE5vZGUgdG8gcmVjZWl2ZSBjaGlsZAogICAgICogQHBhcmFtIHtOb2RlfSBjaGlsZCAgVGhlIGNoaWxkIHRvIGFwcGVuZAogICAgICogQHJldHVybiB7Tm9kZX0gdGhlIGFwcGVuZGVkIG5vZGUKICAgICAqIEBleGFtcGxlCiAgICAgKiBYbWxVdGlsLmFwcGVuZENoaWxkKHBhcmVudCwgY2hpbGQpCiAgICAgKi8KICAgIHRoYXQuYXBwZW5kQ2hpbGQgPSBmdW5jdGlvbiggcGFyZW50LCBjaGlsZCApIHsKICAgICAgICBpZiAocGFyZW50ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgWG1sVXRpbC5fX3Rocm93RXJyb3IoIlhtbFV0aWwuYXBwZW5kQ2hpbGQsIHBhcmVudCBpcyB1bmRlZmluZWQiKTsKICAgICAgICB9CiAgICAgICAgaWYgKGNoaWxkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgWG1sVXRpbC5fX3Rocm93RXJyb3IoIlhtbFV0aWwuYXBwZW5kQ2hpbGQsIGNoaWxkIGlzIHVuZGVmaW5lZCIpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGFjdHVhbFBhcmVudCA9IFhtbFV0aWwuX19nZXRBY3R1YWxOb2RlKHBhcmVudCk7CiAgICAgICAgdmFyIGFjdHVhbENoaWxkID0gWG1sVXRpbC5fX2dldEFjdHVhbE5vZGUoY2hpbGQpOwovLyAgICAgICAgTG9nLnRyYWNlKCJFbnRlcmluZyBYbWxVdGlsLmFwcGVuZENoaWxkIik7CiAgICAgICAgLy8gSW1wb3J0IGNoaWxkIGlmIGl0IGJlbG9uZ3MgdG8gYSBkaWZmZXJlbnQgZG9jdW1lbnQKICAgICAgICBpZiAoYWN0dWFsQ2hpbGQub3duZXJEb2N1bWVudCAhPT0gYWN0dWFsUGFyZW50Lm93bmVyRG9jdW1lbnQpIHsKICAgICAgICAgICAgTG9nLmRlYnVnKCJYbWxVdGlsLmFwcGVuZENoaWxkLCBpbXBvcnRpbmcgY2hpbGQgdG8gbmV3IGRvY3VtZW50Iik7CiAgICAgICAgICAgIGFjdHVhbENoaWxkID0gYWN0dWFsUGFyZW50Lm93bmVyRG9jdW1lbnQuaW1wb3J0Tm9kZShhY3R1YWxDaGlsZCx0cnVlKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoYWN0dWFsQ2hpbGQucGFyZW50Tm9kZSAhPT0gdW5kZWZpbmVkICYmIGFjdHVhbENoaWxkLnBhcmVudE5vZGUgIT09IG51bGwpIHsKICAgICAgICAgICAgTG9nLmRlYnVnKCJYbWxVdGlsLmFwcGVuZENoaWxkLCBjaGlsZCBhbHJlYWR5IGhhcyBhIHBhcmVudC4gQ2xvbmluZyBpdCIpOwogICAgICAgICAgICBhY3R1YWxDaGlsZCA9IGFjdHVhbENoaWxkLmNsb25lTm9kZSh0cnVlKTsKICAgICAgICB9CiAgICAgICAgdmFyIG5ld05vZGUgPSBhY3R1YWxQYXJlbnQuYXBwZW5kQ2hpbGQoYWN0dWFsQ2hpbGQpOwoKICAgICAgICAvLyBHbyB0aHJvdWdoIG5ld2x5IGFwcGVuZGVkIHN0cnVjdHVyZSBhbmQgYWRkIG9yIHJlbW92ZSBuYW1lc3BhY2UgYXR0cmlidXRlIGRlZmluaXRpb25zIGFzIHJlcXVpcmVkCiAgICAgICAgdmFyIHByb2Nlc3NOYW1lc3BhY2VzID0gZnVuY3Rpb24oIG5vZGUgKSB7CiAgICAgICAgICAgIExvZy50cmFjZSgiRW50ZXJpbmcgWG1sVXRpbC5wcm9jZXNzTmFtZXNwYWNlcywgIiwgWG1sVXRpbC5sb2dYbWxTdHJpbmcoIG5vZGUgKSApOwogICAgICAgICAgICBpZiAoIFhtbFV0aWwuaXNFbGVtZW50KCBub2RlICkgKSB7CiAgICAgICAgICAgICAgICB2YXIgbmFtZXNwYWNlc1RvQWRkID0gW107CiAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlc1RvUmVtb3ZlID0gW107CiAgICAgICAgICAgICAgICB2YXIgcGFyZW50ID0gbm9kZS5wYXJlbnROb2RlOwoKICAgICAgICAgICAgICAgIC8vIEFkZGluZyBub2RlIG5hbWVzcGFjZSBpZiByZXF1aXJlZAogICAgICAgICAgICAgICAgaWYgKCBub2RlLnByZWZpeCAmJiBub2RlLm5hbWVzcGFjZVVSSSApIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZXNwYWNlID0geyBwcmVmaXg6IG5vZGUucHJlZml4LCB1cmk6IG5vZGUubmFtZXNwYWNlVVJJfTsKICAgICAgICAgICAgICAgICAgICBpZiAoICEgWG1sVXRpbC5pc05hbWVzcGFjZURlZmluZWQoIHBhcmVudCwgbmFtZXNwYWNlICkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgWG1sVXRpbC5hZGROYW1lc3BhY2UoIG5vZGUsIG5hbWVzcGFjZSApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBDaGVjayBmb3IgYXR0cmlidXRlIG5hbWVzcGFjZXMgYXMgd2VsbCBhcyBuYW1lc3BhY2UgZGVmaW5pdGlvbiBhdHRyaWJ1dGVzCiAgICAgICAgICAgICAgICBMb2cudHJhY2UoIlhtbFV0aWwucHJvY2Vzc05hbWVzcGFjZXMsIGNoZWNrIGF0dHJpYnV0ZXMiICk7CiAgICAgICAgICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBub2RlLmF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gbm9kZS5hdHRyaWJ1dGVzLml0ZW0oaSk7CgogICAgICAgICAgICAgICAgICAgIGlmICggYXR0cmlidXRlLnByZWZpeCAmJiBhdHRyaWJ1dGUubmFtZXNwYWNlVVJJICkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBBdHRyaWJ1dGUgd2l0aCBhIG5hbWVzcGFjZQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZXNwYWNlID0geyBwcmVmaXg6IGF0dHJpYnV0ZS5wcmVmaXgsIHVyaTogYXR0cmlidXRlLm5hbWVzcGFjZVVSSX07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggYXR0cmlidXRlLnByZWZpeCA9PSBYbWxOYW1lc3BhY2VzLnhtbG5zLnByZWZpeCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5hbWVzcGFjZSBkZWZpbml0aW9uIGF0dHJpYnV0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZXNwYWNlID0geyBwcmVmaXg6IGF0dHJpYnV0ZS5sb2NhbE5hbWUsIHVyaTogYXR0cmlidXRlLm5vZGVWYWx1ZX07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIFhtbFV0aWwuaXNOYW1lc3BhY2VEZWZpbmVkKCBwYXJlbnQsIG5hbWVzcGFjZSApICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFscmVhZHkgZGVmaW5lZCBpbiBhbmNlc3RvciwgcmVtb3ZlIGl0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlc1RvUmVtb3ZlLnB1c2goIGF0dHJpYnV0ZSApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCAhWG1sVXRpbC5pc05hbWVzcGFjZURlZmluZWQoIG5vZGUsIG5hbWVzcGFjZSApICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTmFtZXNwYWNlIGlzIG5vdCBkZWZpbmVkIGluIGFuY2VzdG9ycywgc28gZGVmaW5lIGl0IGhlcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzcGFjZXNUb0FkZC5wdXNoKCBuYW1lc3BhY2UgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgbmFtZXNwYWNlIGRlZmluaXRpb24gYXR0cmlidXRlcyBmb3IgbmFtZXNwYWNlcyBhbHJlYWR5IGRlZmluZWQgaW4gYW5jZXN0b3JzCiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzVG9SZW1vdmUuZm9yRWFjaCggZnVuY3Rpb24gKCBhdHRyaWJ1dGUgKSB7CiAgICAgICAgICAgICAgICAgICAgTG9nLmRlYnVnKCAiUmVtb3ZpbmcgZHVwbGljYXRlIG5hbWVzcGFjZSBhdHRyaWJ1dGUgIiwgYXR0cmlidXRlLm5vZGVOYW1lLCAiIGZvciAiLCBYbWxVdGlsLmxvZ1htbFN0cmluZyggbm9kZSApICk7CiAgICAgICAgICAgICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGVOb2RlKCBhdHRyaWJ1dGUgKTsKICAgICAgICAgICAgICAgIH0gKTsKCiAgICAgICAgICAgICAgICBuYW1lc3BhY2VzVG9BZGQuZm9yRWFjaCggZnVuY3Rpb24gKCBuYW1lc3BhY2UgKSB7IFhtbFV0aWwuYWRkTmFtZXNwYWNlKCBub2RlLCBuYW1lc3BhY2UgKTsgfSApOwoKCiAgICAgICAgICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBub2RlLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGQgPSBub2RlLmNoaWxkTm9kZXMuaXRlbSggaSApOwogICAgICAgICAgICAgICAgICAgIHByb2Nlc3NOYW1lc3BhY2VzKCBjaGlsZCApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICBwcm9jZXNzTmFtZXNwYWNlcyggbmV3Tm9kZSApOwoKLy8gICAgICAgIExvZy50cmFjZSgiTGVhdmluZyBYbWxVdGlsLmFwcGVuZENoaWxkIik7CiAgICAgICAgcmV0dXJuIG5ld05vZGU7CiAgICB9OwoKICAgIC8qKgogICAgICogQXBwZW5kIG9uZSBvciBtb3JlIGNoaWxkcmVuIHRvIGEgcGFyZW50IG5vZGUuCiAgICAgKgogICAgICogQXV0b21hdGljYWxseSBjbG9uZXMgb3IgaW1wb3J0cyBjaGlsZHJlbiBpZiBuZWNlc3NhcnkuCiAgICAgKiBJZiBjaGlsZCBiZWxvbmdzIHRvIGEgZGlmZmVyZW50IGRvY3VtZW50LCBpdCBpcyBpbXBvcnRlZC4KICAgICAqIElmIGNoaWxkIGFscmVhZHkgaGFzIGEgcGFyZW50LCBpdCBpcyBjbG9uZWQKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLmFwcGVuZENoaWxkcmVuCiAgICAgKiBAc3ludGF4IFhtbFV0aWwuYXBwZW5kQ2hpbGRyZW4ocGFyZW50LCBjaGlsZCkKICAgICAqIEBwYXJhbSB7Tm9kZXxEb2N1bWVudH0gcGFyZW50IE5vZGUgdG8gcmVjZWl2ZSBjaGlsZAogICAgICogQHBhcmFtIHtBcnJheX0gY2hpbGRyZW4gU2luZ2xlIG5vZGUgb3IgYXJyYXkgb2Ygbm9kZXMgdG8gYXBwZW5kCiAgICAgKiBAZXhhbXBsZQogICAgICogWG1sVXRpbC5hcHBlbmRDaGlsZHJlbihwYXJlbnQsIG90aGVyTm9kZS5jaGlsZE5vZGVzKQogICAgICovCiAgICB0aGF0LmFwcGVuZENoaWxkcmVuID0gZnVuY3Rpb24oIHBhcmVudCwgY2hpbGRyZW4gKSB7Ci8vICAgICAgICBMb2cudHJhY2UoIkVudGVyaW5nIFhtbFV0aWwuYXBwZW5kQ2hpbGRyZW4iKTsKLy8gICAgICAgIExvZy50cmFjZSgiWG1sVXRpbC5hcHBlbmRDaGlsZHJlbiwgYXBwZW5kaW5nIGNoaWxkcmVuOiIsIFhtbFV0aWwubG9nWG1sU3RyaW5nKCBjaGlsZHJlbiApLCAiIHRvIHBhcmVudDoiLCBYbWxVdGlsLmxvZ1htbFN0cmluZyggcGFyZW50ICkgKTsKCiAgICAgICAgdmFyIGFjdHVhbFBhcmVudCA9IFhtbFV0aWwuX19nZXRBY3R1YWxOb2RlKHBhcmVudCk7CgogICAgICAgIGlmKCBjaGlsZHJlbi5ub2RlVHlwZSAhPT0gdW5kZWZpbmVkKXsKICAgICAgICAgICAgLy8gSWYgY2hpbGRyZW4gaXMgYSBzaW5nbGUgbm9kZSwgYXBwZW5kIGl0CiAgICAgICAgICAgIFhtbFV0aWwuYXBwZW5kQ2hpbGQoYWN0dWFsUGFyZW50LCBjaGlsZHJlbik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgTG9nLnRyYWNlKCJYbWxVdGlsLmFwcGVuZENoaWxkcmVuLCBjaGlsZHJlbi5sZW5ndGg9IiwgY2hpbGRyZW4ubGVuZ3RoKTsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAgOyBpICA8IGNoaWxkcmVuLmxlbmd0aCA7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIGNoaWxkID0gY2hpbGRyZW5baV07CiAgICAgICAgICAgICAgICBMb2cudHJhY2UoIlhtbFV0aWwuYXBwZW5kQ2hpbGRyZW4sIGNoaWxkcmVuWyIsIGkgLCAiXT0iLCBYbWxVdGlsLmxvZ1htbFN0cmluZyggY2hpbGQgKSApOwogICAgICAgICAgICAgICAgWG1sVXRpbC5hcHBlbmRDaGlsZChhY3R1YWxQYXJlbnQsIGNoaWxkcmVuW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KLy8gICAgICAgIExvZy50cmFjZSgiTGVhdmluZyBYbWxVdGlsLmFwcGVuZENoaWxkcmVuIik7CiAgICB9OwoKICAgIC8qKgogICAgICogU2VsZWN0IG5vZGVzIGZyb20gb25lIGRvY3VtZW50IG9yIG5vZGUgYW5kIGFwcGVuZCB0byBhbm90aGVyIG5vZGUKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLmFwcGVuZFNlbGVjdGVkCiAgICAgKiBAc3ludGF4IFhtbFV0aWwuYXBwZW5kU2VsZWN0ZWQoc291cmNlWFBhdGgsIHNvdXJjZU5vZGUsIGRlc3RpbmF0aW9uTm9kZSwgZGVzdGluYXRpb25YUGF0aCkKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzb3VyY2VYUGF0aCBUaGUgcGF0aCB0byBzZWxlY3Qgc291cmNlIG5vZGVzIGZyb20KICAgICAqIEBwYXJhbSB7RG9jdW1lbnR8Tm9kZX0gc291cmNlTm9kZSBUaGUgZG9jdW1lbnQgb3Igbm9kZSB0byBzZWxlY3Qgc291cmNlIG5vZGVzIGZyb20KICAgICAqIEBwYXJhbSB7Tm9kZX0gZGVzdGluYXRpb25Ob2RlIFRoZSBub2RlIHRvIGJlIHBhcmVudCBvZiB0aGUgYXBwZW5kZWQgbm9kZXMKICAgICAqIEBwYXJhbSB7U3RyaW5nfFVuZGVmaW5lZH0gZGVzdGluYXRpb25YUGF0aCBPcHRpb25hbCB4cGF0aCB0byBzZWxlY3QgZGVzdGluYXRpb24gbm9kZSBpbnNpZGUgZGVzdGluYXRpb25Ob2RlLgogICAgICogSWYgbm90IHNwZWNpZmllZCwgc291cmNlIG5vZGVzIHdpbGwgYmUgcHV0IGluIGFzIGNoaWxkcmVuIGRpcmVjdGx5IHVuZGVyIGRlc3RpbmF0aW9uTm9kZQogICAgICogQHJldHVybiB7Tm9kZX0gdGhlIGRlc3RpbmF0aW9uIG5vZGUgdGhhdCBpcyBwYXJlbnQgb2YgdGhlIG5ldyBpbXBvcnRlZCBjaGlsZHJlbgogICAgICogQGV4YW1wbGUKICAgICAqIFhtbFV0aWwuYXBwZW5kU2VsZWN0ZWQoJy9yb290LyonLCBzb3VyY2VEb2MsIGRlc3RpbmF0aW9uRG9jKTsKICAgICAqIFhtbFV0aWwuYXBwZW5kU2VsZWN0ZWQoJy9yb290LyonLCBzb3VyY2VEb2MsIGRlc3RpbmF0aW9uRG9jLCAnL25ld1Jvb3QnKTsKICAgICAqLwogICAgdGhhdC5hcHBlbmRTZWxlY3RlZCA9IGZ1bmN0aW9uKHNvdXJjZVhQYXRoLCBzb3VyY2VOb2RlLCBkZXN0aW5hdGlvbk5vZGUsIGRlc3RpbmF0aW9uWFBhdGgpIHsKLy8gICAgICAgIExvZy50cmFjZSgiRW50ZXJpbmcgWG1sVXRpbC5hcHBlbmRTZWxlY3RlZCIpOwovLyAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gU3VwcG9ydCBib3RoIGRvY3VtZW50cyBhbmQgbm9kZXMgYXMgZGVzdGluYXRpb24KICAgICAgICAgICAgdmFyIGFjdHVhbERlc3RpbmF0aW9uTm9kZSA9IFhtbFV0aWwuX19nZXRBY3R1YWxOb2RlKGRlc3RpbmF0aW9uTm9kZSk7CgogICAgICAgICAgICBpZiAoZGVzdGluYXRpb25YUGF0aCkgewogICAgICAgICAgICAgICAgTG9nLmRlYnVnKCJYbWxVdGlsLmFwcGVuZFNlbGVjdGVkLCBzZWxlY3RpbmcgZGVzdGluYXRpb24gbm9kZSB3aXRoICIsIGRlc3RpbmF0aW9uWFBhdGgpOwogICAgICAgICAgICAgICAgYWN0dWFsRGVzdGluYXRpb25Ob2RlID0gWFBhdGguc2VsZWN0Tm9kZShkZXN0aW5hdGlvblhQYXRoLCBhY3R1YWxEZXN0aW5hdGlvbk5vZGUgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIGFjdHVhbERlc3RpbmF0aW9uTm9kZSA9PT0gdW5kZWZpbmVkICkgewogICAgICAgICAgICAgICAgWG1sVXRpbC5fX3Rocm93RXJyb3IoIlhtbFV0aWwuYXBwZW5kU2VsZWN0ZWQsIGRlc3RpbmF0aW9uIG5vZGUgaXMgdW5kZWZpbmVkIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIExvZy5kZWJ1ZygiWG1sVXRpbC5hcHBlbmRTZWxlY3RlZCwgc2VsZWN0aW5nIHNvdXJjZSBub2RlcyB3aXRoICIsIHNvdXJjZVhQYXRoKTsKICAgICAgICAgICAgdmFyIGNoaWxkcmVuID0gWFBhdGguc2VsZWN0KHNvdXJjZVhQYXRoLCBzb3VyY2VOb2RlKTsKICAgICAgICAgICAgWG1sVXRpbC5hcHBlbmRDaGlsZHJlbihhY3R1YWxEZXN0aW5hdGlvbk5vZGUsIGNoaWxkcmVuKTsKCiAgICAgICAgICAgIHJldHVybiBhY3R1YWxEZXN0aW5hdGlvbk5vZGU7Ci8vICAgICAgICB9IGZpbmFsbHkgewovLyAgICAgICAgICAgIExvZy50cmFjZSgiTGVhdmluZyBYbWxVdGlsLmFwcGVuZFNlbGVjdGVkIik7Ci8vICAgICAgICB9CiAgICB9OwoKCiAgICAvKioKICAgICAqIENyZWF0ZSBhbmQgYXBwZW5kIGEgbmV3IGVsZW1lbnQgbm9kZSB3aXRoIG9wdGlvbmFsIG5hbWVzcGFjZSBhbmQgdGV4dCBjb250ZW50IHRvIHRoZSBzcGVjaWZpZWQgbm9kZQogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhtbFV0aWwuYXBwZW5kQ2hpbGRFbGVtZW50CiAgICAgKiBAc3ludGF4IFhtbFV0aWwuYXBwZW5kQ2hpbGRFbGVtZW50KG5vZGUsIGVsZW1lbnROYW1lLCBuYW1lc3BhY2UsIGVsZW1lbnRWYWx1ZSkKICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZSBwYXJlbnQgb2YgbmV3IG5vZGUKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50TmFtZSBuYW1lIG9mIHRoZSBlbGVtZW50IG5vZGUgdG8gY3JlYXRlCiAgICAgKiBAcGFyYW0ge05hbWVzcGFjZXx1bmRlZmluZWR9IG5hbWVzcGFjZSBvcHRpb25hbCBuYW1lc3BhY2UgZm9yIG5vZGUKICAgICAqIEBwYXJhbSB7c3RyaW5nfHVuZGVmaW5lZH0gZWxlbWVudFZhbHVlIG9wdGlvbmFsIHN0cmluZyB2YWx1ZSB0byBpbnNlcnQgaW4gYSB0ZXh0IG5vZGUKICAgICAqIEByZXR1cm4ge0VsZW1lbnR9IFhNTERPTSBFbGVtZW50IHRoYXQgd2FzIGNyZWF0ZWQKICAgICAqIEBleGFtcGxlCiAgICAgKiB2YXIgZWxlbWVudCA9IFhtbFV0aWwuYXBwZW5kQ2hpbGRFbGVtZW50KG5vZGUsICJjcmVhdG9yIiwgWG1sTmFtZXNwYWNlcy5kYywgIk1lIik7CiAgICAgKiB2YXIgZWxlbWVudCA9IFhtbFV0aWwuYXBwZW5kQ2hpbGRFbGVtZW50KG5vZGUsICJjcmVhdG9yIiwgWG1sTmFtZXNwYWNlcy5kYyk7CiAgICAgKiB2YXIgZWxlbWVudCA9IFhtbFV0aWwuYXBwZW5kQ2hpbGRFbGVtZW50KG5vZGUsICJjcmVhdG9yIiwgdW5kZWZpbmVkLCAiTWUiKTsKICAgICAqIHZhciBlbGVtZW50ID0gWG1sVXRpbC5hcHBlbmRDaGlsZEVsZW1lbnQobm9kZSwgImNyZWF0b3IiKTsKICAgICAqLwogICAgdGhhdC5hcHBlbmRDaGlsZEVsZW1lbnQgPSBmdW5jdGlvbiggbm9kZSwgZWxlbWVudE5hbWUsIG5hbWVzcGFjZSwgZWxlbWVudFZhbHVlICkgewovLyAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmcgWG1sVXRpbC5hcHBlbmRDaGlsZEVsZW1lbnQiICk7Ci8vICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBTdXBwb3J0IGJvdGggZG9jdW1lbnRzIGFuZCBub2RlcyBhcyBkZXN0aW5hdGlvbgogICAgICAgICAgICB2YXIgYWN0dWFsTm9kZSA9IFhtbFV0aWwuX19nZXRBY3R1YWxOb2RlKG5vZGUpOwoKICAgICAgICAgICAgdmFyIGRvY3VtZW50ID0gYWN0dWFsTm9kZS5vd25lckRvY3VtZW50OwogICAgICAgICAgICB2YXIgZWxlbWVudCA9IFhtbFV0aWwuY3JlYXRlRWxlbWVudChkb2N1bWVudCwgZWxlbWVudE5hbWUsIG5hbWVzcGFjZSwgZWxlbWVudFZhbHVlKTsKCiAgICAgICAgICAgIFhtbFV0aWwuYXBwZW5kQ2hpbGQoIGFjdHVhbE5vZGUsIGVsZW1lbnQgKTsKCiAgICAgICAgICAgIHJldHVybiBlbGVtZW50OwovLyAgICAgICAgfSBmaW5hbGx5IHsKLy8gICAgICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIFhtbFV0aWwuYXBwZW5kQ2hpbGRFbGVtZW50IiApOwovLyAgICAgICAgfQogICAgfTsKCiAgICAvKioKICAgICAqIENyZWF0ZSBhbmQgYXBwZW5kIG9yIHJlcGxhY2UgYW4gZWxlbWVudCBub2RlIHdpdGggb3B0aW9uYWwgbmFtZXNwYWNlIGFuZCB0ZXh0IGNvbnRlbnQgdG8gdGhlIHNwZWNpZmllZCBub2RlLgogICAgICogCiAgICAgKiBJZiBhIG5vZGUgd2l0aCB0aGUgc3BlY2lmaWVkIG5hbWUgYWxyZWFkeSBleGlzdHMsIGl0cyB0ZXh0IHdpbGwgYmUgcmVwbGFjZWQuCiAgICAgKiBFbHNlIGEgbmV3IG5vZGUgd2lsbCBiZSBjcmVhdGVkCiAgICAgKgogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgWG1sVXRpbC5yZXBsYWNlQ2hpbGRFbGVtZW50CiAgICAgKiBAc3ludGF4IFhtbFV0aWwucmVwbGFjZUNoaWxkRWxlbWVudChub2RlLCBlbGVtZW50TmFtZSwgbmFtZXNwYWNlLCBlbGVtZW50VmFsdWUpCiAgICAgKiBAcGFyYW0ge05vZGV9IG5vZGUgcGFyZW50IG9mIG5ldyBub2RlCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudE5hbWUgbmFtZSBvZiB0aGUgZWxlbWVudCBub2RlIHRvIGNyZWF0ZQogICAgICogQHBhcmFtIHtOYW1lc3BhY2V8dW5kZWZpbmVkfSBuYW1lc3BhY2Ugb3B0aW9uYWwgbmFtZXNwYWNlIGZvciBub2RlCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudFZhbHVlIHN0cmluZyB2YWx1ZSB0byBpbnNlcnQgaW4gYSB0ZXh0IG5vZGUKICAgICAqIEByZXR1cm4ge0VsZW1lbnR9IFhNTERPTSBFbGVtZW50IHRoYXQgd2FzIGNyZWF0ZWQKICAgICAqIEBleGFtcGxlCiAgICAgKiB2YXIgZWxlbWVudCA9IFhtbFV0aWwucmVwbGFjZUNoaWxkRWxlbWVudChub2RlLCAiY3JlYXRvciIsIFhtbE5hbWVzcGFjZXMuZGMsICJNZSIpOwogICAgICogdmFyIGVsZW1lbnQgPSBYbWxVdGlsLnJlcGxhY2VDaGlsZEVsZW1lbnQobm9kZSwgImNyZWF0b3IiLCBYbWxOYW1lc3BhY2VzLmRjKTsKICAgICAqIHZhciBlbGVtZW50ID0gWG1sVXRpbC5yZXBsYWNlQ2hpbGRFbGVtZW50KG5vZGUsICJjcmVhdG9yIik7CiAgICAgKi8KICAgIHRoYXQucmVwbGFjZUNoaWxkRWxlbWVudCA9IGZ1bmN0aW9uKCBub2RlLCBlbGVtZW50TmFtZSwgbmFtZXNwYWNlLCBlbGVtZW50VmFsdWUgKSB7Ci8vICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZyBYbWxVdGlsLnJlcGxhY2VDaGlsZEVsZW1lbnQiICk7Ci8vICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBTdXBwb3J0IGJvdGggZG9jdW1lbnRzIGFuZCBub2RlcyBhcyBkZXN0aW5hdGlvbgogICAgICAgICAgICB2YXIgYWN0dWFsTm9kZSA9IFhtbFV0aWwuX19nZXRBY3R1YWxOb2RlKG5vZGUpOwogICAgICAgICAgICAKICAgICAgICAgICAgdmFyIGV4aXN0aW5nRWxlbWVudHMgPSBYbWxVdGlsLmdldENoaWxkRWxlbWVudHMoYWN0dWFsTm9kZSwgZWxlbWVudE5hbWUsIG5hbWVzcGFjZSk7CiAgICAgICAgICAgIGlmICggZXhpc3RpbmdFbGVtZW50cy5sZW5ndGggPiAwICkgewogICAgICAgICAgICAgICAgTG9nLmRlYnVnKCAiWG1sVXRpbC5yZXBsYWNlQ2hpbGRFbGVtZW50LCBmb3VuZCAiLCBleGlzdGluZ0VsZW1lbnRzLmxlbmd0aCwgIiBlbGVtZW50KHMpIHdpdGggbmFtZSAiLCBlbGVtZW50TmFtZSApOwogICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBleGlzdGluZ0VsZW1lbnRzWzBdOwogICAgICAgICAgICAgICAgLy92YXIgZWxlbWVudCA9IGV4aXN0aW5nRWxlbWVudHMuaXRlbSgwKTsKICAgICAgICAgICAgICAgIExvZy5kZWJ1ZyggIlhtbFV0aWwucmVwbGFjZUNoaWxkRWxlbWVudCwgYmVmb3JlIHJlcGxhY2UiLCBYbWxVdGlsLmxvZ1htbFN0cmluZyggZWxlbWVudCApKTsKICAgICAgICAgICAgICAgIC8vIE92ZXJ3cml0ZSBleGlzdGluZyB0ZXh0CiAgICAgICAgICAgICAgICBYbWxVdGlsLmFwcGVuZFRleHQoZWxlbWVudCwgZWxlbWVudFZhbHVlLCB0cnVlKTsKICAgICAgICAgICAgICAgIExvZy5kZWJ1ZyggIlhtbFV0aWwucmVwbGFjZUNoaWxkRWxlbWVudCwgcmVwbGFjZWQgZWxlbWVudCAiLCBYbWxVdGlsLmxvZ1htbFN0cmluZyggZWxlbWVudCApICk7CiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIExvZy5kZWJ1ZyggIlhtbFV0aWwucmVwbGFjZUNoaWxkRWxlbWVudCwgZXhpc3RpbmcgZWxlbWVudCBub3QgZm91bmQuIENyZWF0ZSBuZXcgZWxlbWVudCIgKTsKICAgICAgICAgICAgICAgIHJldHVybiBYbWxVdGlsLmFwcGVuZENoaWxkRWxlbWVudChhY3R1YWxOb2RlLCBlbGVtZW50TmFtZSwgbmFtZXNwYWNlLCBlbGVtZW50VmFsdWUpOwogICAgICAgICAgICB9Ci8vICAgICAgICB9IGZpbmFsbHkgewovLyAgICAgICAgICAgIExvZy50cmFjZSggIkxlYXZpbmcgWG1sVXRpbC5yZXBsYWNlQ2hpbGRFbGVtZW50IiApOwovLyAgICAgICAgfQogICAgfTsKCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBlbGVtZW50IG5vZGUgd2l0aCBvcHRpb25hbCBuYW1lc3BhY2UgYW5kIHRleHQgY29udGVudAogICAgICoKICAgICAqICoqTm90ZToqKiBPbmx5IGNyZWF0ZXMgdGhlIG5vZGUuIEl0IGlzIG5vdCBhZGRlZCBhcyBhIGNoaWxkIG5vZGUgdG8gYW55IG90aGVyIG5vZGUgaW4gdGhlIGRvY3VtZW50LgogICAgICogdXNlIGFwcGVuZENoaWxkIG1ldGhvZCBvZiB0aGUgbm9kZSB5b3Ugd2FuIHRvIGluc2VydCBpdCBpbgogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhtbFV0aWwuY3JlYXRlRWxlbWVudAogICAgICogQHN5bnRheCBYbWxVdGlsLmNyZWF0ZUVsZW1lbnQoZG9jdW1lbnQsIGVsZW1lbnROYW1lLCBuYW1lc3BhY2UsIGVsZW1lbnRWYWx1ZSkKICAgICAqIEBwYXJhbSB7RG9jdW1lbnR9IGRvY3VtZW50IHRvIGNyZWF0ZSBlbGVtZW50IGluCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudE5hbWUgbmFtZSBvZiB0aGUgZWxlbWVudCBub2RlIHRvIGNyZWF0ZQogICAgICogQHBhcmFtIHtOYW1lc3BhY2V8dW5kZWZpbmVkfSBuYW1lc3BhY2Ugb3B0aW9uYWwgbmFtZXNwYWNlIGZvciBub2RlCiAgICAgKiBAcGFyYW0ge3N0cmluZ3x1bmRlZmluZWR9IGVsZW1lbnRWYWx1ZSBvcHRpb25hbCBzdHJpbmcgdmFsdWUgdG8gaW5zZXJ0IGluIGEgdGV4dCBub2RlCiAgICAgKiBAcmV0dXJuIHtFbGVtZW50fSBYTUxET00gRWxlbWVudCB0aGF0IHdhcyBjcmVhdGVkCiAgICAgKiBAZXhhbXBsZQogICAgICogdmFyIGVsZW1lbnQgPSBYbWxVdGlsLmNyZWF0ZUVsZW1lbnQoZG9jdW1lbnQsICJjcmVhdG9yIiwgWG1sTmFtZXNwYWNlcy5kYywgIk1lIik7CiAgICAgKiB2YXIgZWxlbWVudCA9IFhtbFV0aWwuY3JlYXRlRWxlbWVudChkb2N1bWVudCwgImNyZWF0b3IiLCBYbWxOYW1lc3BhY2VzLmRjKTsKICAgICAqIHZhciBlbGVtZW50ID0gWG1sVXRpbC5jcmVhdGVFbGVtZW50KGRvY3VtZW50LCAiY3JlYXRvciIsIHVuZGVmaW5lZCwgIk1lIik7CiAgICAgKiB2YXIgZWxlbWVudCA9IFhtbFV0aWwuY3JlYXRlRWxlbWVudChkb2N1bWVudCwgImNyZWF0b3IiKTsKICAgICAqLwogICAgdGhhdC5jcmVhdGVFbGVtZW50ID0gZnVuY3Rpb24oIGRvY3VtZW50LCBlbGVtZW50TmFtZSwgbmFtZXNwYWNlLCBlbGVtZW50VmFsdWUgKSB7Ci8vICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZyBYbWxVdGlsLmNyZWF0ZUVsZW1lbnQiICk7Ci8vICAgICAgICB0cnkgewoKICAgICAgICAvLyBqYXZhIG9iamVjdHMgbXVzdCBvcGVyYXRlIG9uIG93bmVyZG9jdW1lbnQKICAgICAgICAvLyBAVE9ETyBpcyB0aGlzIE9LID8/CiAgICAgICAgaWYoZG9jdW1lbnQub3duZXJEb2N1bWVudCAhPT0gdW5kZWZpbmVkICYmIGRvY3VtZW50Lm93bmVyRG9jdW1lbnQgIT09IG51bGwpIHsKICAgICAgICAgICAgZG9jdW1lbnQgPSBkb2N1bWVudC5vd25lckRvY3VtZW50OwogICAgICAgIH0KICAgICAgICAgICAgdmFyIGVsZW1lbnQ7CiAgICAgICAgICAgIGlmICggIW5hbWVzcGFjZSApIHsKICAgICAgICAgICAgICAgIExvZy50cmFjZSggIlhtbFV0aWwuY3JlYXRlRWxlbWVudCwgY3JlYXRlIGVsZW1lbnQ6ICIsIGVsZW1lbnROYW1lICk7CiAgICAgICAgICAgICAgICBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChlbGVtZW50TmFtZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoIW5hbWVzcGFjZS5wcmVmaXgpIHsKICAgICAgICAgICAgICAgICAgICBYbWxVdGlsLl9fdGhyb3dFcnJvcigiWG1sVXRpbC5jcmVhdGVFbGVtZW50LCBOYW1lc3BhY2UgcHJlZml4IG1pc3NpbmcgIiArIG5hbWVzcGFjZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIW5hbWVzcGFjZS51cmkpIHsKICAgICAgICAgICAgICAgICAgICBYbWxVdGlsLl9fdGhyb3dFcnJvcigiWG1sVXRpbC5jcmVhdGVFbGVtZW50LCBOYW1lc3BhY2UgdXJpIG1pc3NpbmcgIiArIG5hbWVzcGFjZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBMb2cudHJhY2UoICJYbWxVdGlsLmNyZWF0ZUVsZW1lbnQsIGNyZWF0ZSBlbGVtZW50OiAiLCBuYW1lc3BhY2UucHJlZml4LCAiOiIsIGVsZW1lbnROYW1lICk7CiAgICAgICAgICAgICAgICBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKG5hbWVzcGFjZS51cmksIG5hbWVzcGFjZS5wcmVmaXggKyAiOiIgKyBlbGVtZW50TmFtZSk7CiAgICAgICAgICAgICAgICBYbWxVdGlsLmFkZE5hbWVzcGFjZShlbGVtZW50LCBuYW1lc3BhY2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChlbGVtZW50VmFsdWUpIHsKICAgICAgICAgICAgICAgIC8vTG9nLnRyYWNlKCAiWG1sVXRpbC5jcmVhdGVFbGVtZW50LCBhZGRpbmcgdGV4dCBub2RlOiAnIiwgZWxlbWVudFZhbHVlLCAiJyIgKTsKICAgICAgICAgICAgICAgIHZhciB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZWxlbWVudFZhbHVlKTsKICAgICAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQodGV4dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgTG9nLnRyYWNlKCJYbWxVdGlsLmNyZWF0ZUVsZW1lbnQsIGNyZWF0ZWQgZWxlbWVudCAiLCBYbWxVdGlsLmxvZ1htbFN0cmluZyggZWxlbWVudCApICk7CiAgICAgICAgICAgIHJldHVybiBlbGVtZW50OwovLyAgICAgICAgfSBmaW5hbGx5IHsKLy8gICAgICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIFhtbFV0aWwuY3JlYXRlRWxlbWVudCIgKTsKLy8gICAgICAgIH0KICAgIH07CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIGNoaWxkIG5vZGVzIHRoYXQgYXJlIEVsZW1lbnQgbm9kZXMuCiAgICAgKiBJLmUuIHNraXAgdGV4dCBvciBvdGhlciBjaGlsZCBub2Rlcy4KICAgICAqCiAgICAgKiBBZGRpdGlvbmFsIHBhcmFtZXRlcnMgYWxsb3cgdG8gc3BlY2lmeSB0aGF0IHlvdSBvbmx5IHdhbnQgZWxlbWVudHMgd2l0aCBhIHNwZWNpZmljIG5hbWUsCiAgICAgKiBlbGVtZW50cyB0aGF0IGhhdmUgYSBwYXJ0aWN1bGFyIGF0dHJpYnV0ZSAoYnkgbmFtZSBhbmQvb3IgdmFsdWUpCiAgICAgKgogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgWG1sVXRpbC5nZXRDaGlsZEVsZW1lbnRzCiAgICAgKiBAc3ludGF4IFhtbFV0aWwuZ2V0Q2hpbGRFbGVtZW50cyhub2RlKQogICAgICogQHBhcmFtIHtEb2N1bWVudHxOb2RlfSBub2RlIHRvIGdldCBjaGlsZCBlbGVtZW50cyBmcm9tCiAgICAgKiBAcGFyYW0ge1N0cmluZ3x1bmRlZmluZWR9IGVsZW1lbnROYW1lIE9wdGlvbmFsIGVsZW1lbnQgbmFtZSBmaWx0ZXIgcmVzdWx0IGZvcgogICAgICogQHBhcmFtIHtPYmplY3R8dW5kZWZpbmVkfSBlbGVtZW50TmFtZXNwYWNlIE9wdGlvbmFsIG5hbWVzcGFjZSBmb3IgZWxlbWVudCBuYW1lCiAgICAgKiBAcGFyYW0ge1N0cmluZ3x1bmRlZmluZWR9IGF0dHJpYnV0ZU5hbWUgT3B0aW9uYWwgYXR0cmlidXRlIG5hbWUgZmlsdGVyIHJlc3VsdCBmb3IKICAgICAqIEBwYXJhbSB7T2JqZWN0fHVuZGVmaW5lZH0gYXR0cmlidXRlTmFtZXNwYWNlIE9wdGlvbmFsIG5hbWVzcGFjZSBmb3IgYXR0cmlidXRlIG5hbWUKICAgICAqIEBwYXJhbSB7T2JqZWN0fHVuZGVmaW5lZH0gYXR0cmlidXRlVmFsdWUgT3B0aW9uYWwgYXR0cmlidXRlIHZhbHVlIHRvIGZpbHRlciByZXN1bHQgZm9yCiAgICAgKiBAcmV0dXJuIHtFbGVtZW50W119IEFycmF5IG9mIGNoaWxkIGVsZW1lbnRzCiAgICAgKiBAZXhhbXBsZQogICAgICogdmFyIGVsZW1lbnRzID0gWG1sVXRpbC5nZXRDaGlsZEVsZW1lbnRzKGRvY3VtZW50KTsKICAgICAqIHZhciBlbGVtZW50cyA9IFhtbFV0aWwuZ2V0Q2hpbGRFbGVtZW50cyhkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpOwogICAgICogdmFyIGVsZW1lbnRzID0gWG1sVXRpbC5nZXRDaGlsZEVsZW1lbnRzKGRvY3VtZW50LCAiY2hpbGQiKTsKICAgICAqIHZhciBlbGVtZW50cyA9IFhtbFV0aWwuZ2V0Q2hpbGRFbGVtZW50cyhkb2N1bWVudCwgImNoaWxkIiwgWG1sTmFtZXNwYWNlcy5kYyk7IC8vZmlsdGVyIGJ5IGVsZW1lbnQgbmFtZQogICAgICogdmFyIGVsZW1lbnRzID0gWG1sVXRpbC5nZXRDaGlsZEVsZW1lbnRzKGRvY3VtZW50LCAiY2hpbGQiLCBYbWxOYW1lc3BhY2VzLmRjLCAiYXR0IiwgWG1sTmFtZXNwYWNlcy5kYyk7IC8vZmlsdGVyIGJ5IGVsZW1lbnQgbmFtZSBhbmQgYXR0cmlidXRlIG5hbWUKICAgICAqIHZhciBlbGVtZW50cyA9IFhtbFV0aWwuZ2V0Q2hpbGRFbGVtZW50cyhkb2N1bWVudCwgImNoaWxkIiwgWG1sTmFtZXNwYWNlcy5kYywgImF0dCIsIFhtbE5hbWVzcGFjZXMuZGMsICJ2YWx1ZSIpOyAvL2ZpbHRlciBieSBlbGVtZW50IG5hbWUsIGF0dHJpYnV0ZSBuYW1lIGFuZCBhdHRyaWJ1dGUgdmFsdWUKICAgICAqIHZhciBlbGVtZW50cyA9IFhtbFV0aWwuZ2V0Q2hpbGRFbGVtZW50cyhkb2N1bWVudCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCAidmFsdWUiKTsgLy9maWx0ZXIgYnkgYXR0cmlidXRlIHZhbHVlCiAgICAgKi8KICAgIHRoYXQuZ2V0Q2hpbGRFbGVtZW50cyA9IGZ1bmN0aW9uKCBub2RlLCBlbGVtZW50TmFtZSwgZWxlbWVudE5hbWVzcGFjZSwgYXR0cmlidXRlTmFtZSwgYXR0cmlidXRlTmFtZXNwYWNlLCBhdHRyaWJ1dGVWYWx1ZSApIHsKLy8gICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIFhtbFV0aWwuZ2V0Q2hpbGRFbGVtZW50cyIgKTsKLy8gICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghWG1sVXRpbC5pc1htbChub2RlKSkgewogICAgICAgICAgICAgICAgWG1sVXRpbC5fX3Rocm93RXJyb3IoIk5vZGUgaXMgbm90IGFuIHhtbCBub2RlOiIgKyBub2RlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBTdXBwb3J0IGJvdGggZG9jdW1lbnRzIGFuZCBub2RlcwogICAgICAgICAgICB2YXIgYWN0dWFsTm9kZSA9IFhtbFV0aWwuX19nZXRBY3R1YWxOb2RlKG5vZGUpOwoKICAgICAgICAgICAgaWYoZWxlbWVudE5hbWVzcGFjZSl7CiAgICAgICAgICAgICAgICBlbGVtZW50TmFtZSA9IGVsZW1lbnROYW1lc3BhY2UucHJlZml4ICsgIjoiICsgZWxlbWVudE5hbWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBlbGVtZW50cyA9IFtdOwogICAgICAgICAgICBmb3IodmFyIGkgPSAwIDsgaSA8IGFjdHVhbE5vZGUuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgICAgICAvL3ZhciBjaGlsZCA9IGFjdHVhbE5vZGUuY2hpbGROb2Rlc1tpXTsKICAgICAgICAgICAgICAgIHZhciBjaGlsZCA9IGFjdHVhbE5vZGUuY2hpbGROb2Rlcy5pdGVtKGkpOwogICAgICAgICAgICAgICAgaWYgKGNoaWxkLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuRUxFTUVOVF9OT0RFKSB7CgkJICAgIGlmKGVsZW1lbnROYW1lICYmIGVsZW1lbnROYW1lICE9PSBjaGlsZC5ub2RlTmFtZSl7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoJCSAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoYXR0cmlidXRlTmFtZSAmJiAhWG1sVXRpbC5nZXRBdHRyaWJ1dGUoY2hpbGQsIGF0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZU5hbWVzcGFjZSkpewogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoYXR0cmlidXRlVmFsdWUpewogICAgICAgICAgICAgICAgICAgICAgICBpZihhdHRyaWJ1dGVOYW1lKXsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihhdHRyaWJ1dGVWYWx1ZSAhPT0gWG1sVXRpbC5nZXRBdHRyaWJ1dGUoY2hpbGQsIGF0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZU5hbWVzcGFjZSkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIGF0dHJpYnV0ZU5hbWUgaXMgbm90IGRlZmluZWQsIHdlIGNoZWNrIGFnYWluc3QgYWxsIGF0dHJpYnV0ZSB2YWx1ZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmb3VuZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKCB2YXIgaiA9IDA7IGogPCBjaGlsZC5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrICl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9pZihhdHRyaWJ1dGVWYWx1ZSA9PT0gY2hpbGQuYXR0cmlidXRlc1tqXS5ub2RlVmFsdWUpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGF0dHJpYnV0ZVZhbHVlID09PSBjaGlsZC5hdHRyaWJ1dGVzLml0ZW0oaikubm9kZVZhbHVlKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighZm91bmQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLnB1c2goY2hpbGQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vTG9nLnRyYWNlKCJYbWxVdGlsLmdldENoaWxkRWxlbWVudHMsIHJldHVybmluZyBlbGVtZW50cyAiLCBlbGVtZW50cyk7CiAgICAgICAgICAgIHJldHVybiBlbGVtZW50czsKLy8gICAgICAgIH0gZmluYWxseSB7Ci8vICAgICAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBYbWxVdGlsLmdldENoaWxkRWxlbWVudHMiICk7Ci8vICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAgICogR2V0IHRoZSB0ZXh0IGZyb20gYSBub2RlLgogICAgICogSWYgdGhlIG5vZGUgaXMgYSB0ZXh0IG5vZGUgaXRzIHZhbHVlIHdpbGwgYmUgcmV0dXJuZWQuIAogICAgICogSWYgbm9kZSBpcyBhbiBlbGVtZW50IG5vZGUsIGl0ZXJhdGUgdGhyb3VnaCBmaXJzdCBsZXZlbCBjaGlsZHJlbiBhbmQgbG9vayBmb3IgdGV4dCBub2RlLgogICAgICogQ29uY2F0ZW5hdGUgc3RyaW5ncyBpZiB0aGUgbm9kZSBoYXMgbXVsdGlwbGUgdGV4dCBub2RlIGNoaWxkcmVuCiAgICAgKgogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgWG1sVXRpbC5nZXRUZXh0CiAgICAgKiBAc3ludGF4IFhtbFV0aWwuZ2V0VGV4dChub2RlKQogICAgICogQHBhcmFtIHtOb2RlfSBub2RlIGRvY3VtZW50IG9yIG5vZGUgdG8gZ2V0IHRleHQgZnJvbQogICAgICogQHJldHVybiB7U3RyaW5nfSBUaGUgbm9kZSB0ZXh0IG9yICcnIGlmIG5vZGUgaGFzIG5vIHRleHQKICAgICAqIEBleGFtcGxlCiAgICAgKiB2YXIgZG9jdW1lbnQgPSBYbWxVdGlsLmZyb21TdHJpbmcoIjxyb290PmhlbGxvPGNoaWxkPnRleHQ8L2NoaWxkPndvcmxkPC9yb290PiIpOwogICAgICogdmFyIHRleHQgPSBYbWxVdGlsLmdldFRleHQoZG9jdW1lbnQpOwogICAgICogLy8gcmV0dXJucyAnaGVsbG93b3JsZCcKICAgICAqIHZhciBjaGlsZCA9IFhQYXRoLnNlbGVjdE5vZGUoIi9yb290L2NoaWxkIiwgZG9jdW1lbnQpOwogICAgICogdmFyIHRleHQgPSBYbWxVdGlsLmdldFRleHQoY2hpbGQpOwogICAgICogLy8gcmV0dXJucyAndGV4dCcKICAgICAqLwogICAgdGhhdC5nZXRUZXh0ID0gZnVuY3Rpb24oIG5vZGUgKSB7Ci8vICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZyBYbWxVdGlsLmdldFRleHQiICk7Ci8vICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBTdXBwb3J0IGJvdGggZG9jdW1lbnRzIGFuZCBub2RlcyBhcyBkZXN0aW5hdGlvbgogICAgICAgICAgICB2YXIgYWN0dWFsTm9kZSA9IFhtbFV0aWwuX19nZXRBY3R1YWxOb2RlKG5vZGUpOwogICAgICAgICAgICB2YXIgdGV4dCA9ICIiOwoKICAgICAgICAgICAgaWYgKGFjdHVhbE5vZGUubm9kZVR5cGUgPT0gTm9kZVR5cGVzLlRFWFRfTk9ERSB8fCBhY3R1YWxOb2RlLm5vZGVUeXBlID09IE5vZGVUeXBlcy5DREFUQV9TRUNUSU9OX05PREUpIHsKICAgICAgICAgICAgICAgIHRleHQgPSBhY3R1YWxOb2RlLm5vZGVWYWx1ZTsKICAgICAgICAgICAgfSBlbHNlIGlmIChhY3R1YWxOb2RlLmNoaWxkTm9kZXMpewogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAgOyBpIDwgYWN0dWFsTm9kZS5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNoaWxkID0gYWN0dWFsTm9kZS5jaGlsZE5vZGVzLml0ZW0oaSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLm5vZGVUeXBlID09IE5vZGVUeXBlcy5URVhUX05PREUgfHwgY2hpbGQubm9kZVR5cGUgPT0gTm9kZVR5cGVzLkNEQVRBX1NFQ1RJT05fTk9ERSkgewogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ICs9IGNoaWxkLm5vZGVWYWx1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgTG9nLnRyYWNlKCAiWG1sVXRpbC5nZXRUZXh0LCByZXR1cm5pbmcgJyIsIHRleHQsICInIiApOwogICAgICAgICAgICByZXR1cm4gdGV4dDsKLy8gICAgICAgIH0gZmluYWxseSB7Ci8vICAgICAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBYbWxVdGlsLmdldFRleHQiICk7Ci8vICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAgICogQXBwZW5kIGEgdGV4dCBub2RlIHRvIGFuIGV4aXN0aW5nIG5vZGUuIElmIG5vZGUgYWxyZWFkeSBoYXMgYSB0ZXh0IG5vZGUsIGFwcGVuZCB0ZXh0IHRvIHRoZSBleGlzdGluZyB0ZXh0LAogICAgICogdW5sZXNzIG92ZXJ3cml0ZSBmbGFnIGlzIHNldAogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhtbFV0aWwuYXBwZW5kVGV4dAogICAgICogQHN5bnRheCBYbWxVdGlsLmFwcGVuZFRleHQobm9kZSwgdmFsdWUpCiAgICAgKiBAcGFyYW0ge05vZGV9IG5vZGUgcGFyZW50IG9mIG5ldyB0ZXh0IG5vZGUKICAgICAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZSBzdHJpbmcgdmFsdWUgdG8gaW5zZXJ0IGluIHRleHQgbm9kZQogICAgICogQHBhcmFtIHtib29sZWFufHVuZGVmaW5lZH0gb3ZlcndyaXRlIG92ZXJ3cml0ZXMgZXhpc3RpbmcgdmFsdWUgaW4gc3RlYWQgb2YgYXBwcGVuZGluZyBpZiB0cnVlLCBhcHBlbmRzIGlmIGZhbHNlIG9yIHVuZGVmaW5lZCAob3B0aW9uYWwpCiAgICAgKiBAcmV0dXJuIHtFbGVtZW50fSBYTUxET00gVGV4dCBub2RlIHRoYXQgd2FzIGNyZWF0ZWQgb3IgYXBwcGVuZGVkIHRvCiAgICAgKiBAZXhhbXBsZQogICAgICogdmFyIHRleHQgPSBYbWxVdGlsLmFwcGVuZFRleHQobm9kZSwgInNvbWUgdmFsdWUiKTsKICAgICAqIExvZy5kZWJ1ZygidGV4dCBpcyBub3c6IiwgdGV4dC5ub2RlVmFsdWUpOwogICAgICovCiAgICB0aGF0LmFwcGVuZFRleHQgPSBmdW5jdGlvbiggbm9kZSwgdmFsdWUsIG92ZXJ3cml0ZSApIHsKLy8gICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIFhtbFV0aWwuYXBwZW5kVGV4dCIgKTsKLy8gICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIFN1cHBvcnQgYm90aCBkb2N1bWVudHMgYW5kIG5vZGVzIGFzIGRlc3RpbmF0aW9uCiAgICAgICAgICAgIHZhciBhY3R1YWxOb2RlID0gWG1sVXRpbC5fX2dldEFjdHVhbE5vZGUobm9kZSk7CiAgICAgICAgICAgIHZhciB0ZXh0ID0gWFBhdGguc2VsZWN0Tm9kZSgidGV4dCgpIiwgYWN0dWFsTm9kZSk7CiAgICAgICAgICAgIGlmICh0ZXh0ICYmIG92ZXJ3cml0ZSkgewogICAgICAgICAgICAgICAgTG9nLmRlYnVnKCJYbWxVdGlsLmFwcGVuZFRleHQsIFJlcGxhY2luZyAnIiwgdGV4dC5ub2RlVmFsdWUsICInIHdpdGggJyIsIHZhbHVlLCAiJyBvbiBub2RlICciLCBhY3R1YWxOb2RlLm5vZGVOYW1lLCAiJyIpOwogICAgICAgICAgICAgICAgdGV4dC5ub2RlVmFsdWUgPSB2YWx1ZS50b1N0cmluZygpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgTG9nLmRlYnVnKCJYbWxVdGlsLmFwcGVuZFRleHQsIGNyZWF0aW5nIHRleHQgJyIsIHZhbHVlLCAiJyBvbiBub2RlICciLCBhY3R1YWxOb2RlLm5vZGVOYW1lLCAiJyIpOwogICAgICAgICAgICAgICAgdmFyIGRvY3VtZW50ID0gYWN0dWFsTm9kZS5vd25lckRvY3VtZW50OwogICAgICAgICAgICAgICAgdmFyIHRleHQgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh2YWx1ZSk7CiAgICAgICAgICAgICAgICBhY3R1YWxOb2RlLmFwcGVuZENoaWxkKHRleHQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0ZXh0OwovLyAgICAgICAgfSBmaW5hbGx5IHsKLy8gICAgICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIFhtbFV0aWwuYXBwZW5kVGV4dCIgKTsKLy8gICAgICAgIH0KICAgIH07CgogICAgLyoqCiAgICAgKiBHZXQgYW4gYXR0cmlidXRlIGZvciBhIG5vZGUKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLmdldEF0dHJpYnV0ZQogICAgICogQHN5bnRheCBYbWxVdGlsLmdldEF0dHJpYnV0ZShub2RlLCBhdHRyaWJ1dGVOYW1lLCBhdHRyaWJ1dGVOYW1lc3BhY2UpCiAgICAgKiBAcGFyYW0ge05vZGV9IG5vZGUgRG9jdW1lbnQgb3IgZWxlbWVudCB0byBnZXQgYXR0cmlidXRlIGZyb20KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBhdHRyaWJ1dGVOYW1lIGF0dHJpYnV0ZSBuYW1lCiAgICAgKiBAcGFyYW0ge05hbWVzcGFjZXx1bmRlZmluZWR9IGF0dHJpYnV0ZU5hbWVzcGFjZSBvcHRpb25hbCBuYW1lc3BhY2UgZm9yIGF0dHJpYnV0ZQogICAgICogQHJldHVybiB7U3RyaW5nfFVuZGVmaW5lZH0gVmFsdWUgb2YgYXR0cmlidXRlIChtYXkgYmUgZW1wdHkpIG9yIHVuZGVmaW5lZCBpbiBub2RlcyBkb2VzIG5vdCBoYXZlIHRoZSBhdHRyaWJ1dGUKICAgICAqIEBleGFtcGxlCmRvY3VtZW50ID0gWG1sVXRpbC5mcm9tU3RyaW5nKCc8cm9vdCB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiBmb289ImJhciIvPicpOwpYbWxVdGlsLmdldEF0dHJpYnV0ZShkb2N1bWVudCwgInhzaSIsIFhtbE5hbWVzcGFjZXMueG1sbnMpOwpYbWxVdGlsLmdldEF0dHJpYnV0ZShkb2N1bWVudCwgImZvbyIpOwogICAgICovCiAgICB0aGF0LmdldEF0dHJpYnV0ZSA9IGZ1bmN0aW9uKCBub2RlLCBhdHRyaWJ1dGVOYW1lLCBhdHRyaWJ1dGVOYW1lc3BhY2UpIHsKLy8gICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIFhtbFV0aWwuZ2V0QXR0cmlidXRlIiApOwovLyAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gU3VwcG9ydCBib3RoIGRvY3VtZW50cyBhbmQgbm9kZXMgYXMgZGVzdGluYXRpb24KICAgICAgICAgICAgdmFyIGFjdHVhbE5vZGUgPSBYbWxVdGlsLl9fZ2V0QWN0dWFsTm9kZShub2RlKTsKICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZU5hbWVzcGFjZSkgewogICAgICAgICAgICAgICAgTG9nLmRlYnVnKCJYbWxVdGlsLmdldEF0dHJpYnV0ZSwgR2V0dGluZyBhdHRyaWJ1dGUgJyIsIGF0dHJpYnV0ZU5hbWUsICInIHdpdGggbmFtZXNwYWNlICIsIGF0dHJpYnV0ZU5hbWVzcGFjZS5wcmVmaXgpOwogICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IGFjdHVhbE5vZGUuYXR0cmlidXRlcy5nZXROYW1lZEl0ZW1OUyhhdHRyaWJ1dGVOYW1lc3BhY2UudXJpLCBhdHRyaWJ1dGVOYW1lKTsKICAgICAgICAgICAgICAgIGlmIChhdHRyaWJ1dGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXR0cmlidXRlLm5vZGVWYWx1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIExvZy5kZWJ1ZygiWG1sVXRpbC5nZXRBdHRyaWJ1dGUsIEdldHRpbmcgYXR0cmlidXRlICciLCBhdHRyaWJ1dGVOYW1lLCAiJyIpOwogICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IGFjdHVhbE5vZGUuYXR0cmlidXRlcy5nZXROYW1lZEl0ZW0oYXR0cmlidXRlTmFtZSk7CiAgICAgICAgICAgICAgICBpZiAoYXR0cmlidXRlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZS5ub2RlVmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KLy8gICAgICAgIH0gZmluYWxseSB7Ci8vICAgICAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBYbWxVdGlsLmdldEF0dHJpYnV0ZSIgKTsKLy8gICAgICAgIH0KICAgIH07CgogICAgLyoqCiAgICAgKiBTZXQgYW4gYXR0cmlidXRlIGZvciBhIG5vZGUKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLnNldEF0dHJpYnV0ZQogICAgICogQHN5bnRheCBYbWxVdGlsLnNldEF0dHJpYnV0ZShub2RlLCBhdHRyaWJ1dGVOYW1lLCBhdHRyaWJ1dGVWYWx1ZSwgYXR0cmlidXRlTmFtZXNwYWNlKQogICAgICogQHBhcmFtIHtOb2RlfSBub2RlIERvY3VtZW50IHRvIGFkZCBhdHRyaWJ1dGUgbmFtZSBmb3IKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBhdHRyaWJ1dGVOYW1lIGF0dHJpYnV0ZSBuYW1lCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gYXR0cmlidXRlVmFsdWUgYXR0cmlidXRlIHZhbHVlCiAgICAgKiBAcGFyYW0ge05hbWVzcGFjZXx1bmRlZmluZWR9IGF0dHJpYnV0ZU5hbWVzcGFjZSBvcHRpb25hbCBuYW1lc3BhY2UgZm9yIGF0dHJpYnV0ZQoKICAgICAqIEBleGFtcGxlCiAgICAgKiBkb2N1bWVudCA9IFhtbFV0aWwuZnJvbVN0cmluZygiPHJvb3QvPiIpOwogICAgICogdmFyIGVsZW1lbnQgPSBYbWxVdGlsLmNyZWF0ZUVsZW1lbnQoZG9jdW1lbnQsICJjaGlsZCIpOwogICAgICogLy8gV2l0aG91dCBuYW1lc3BhY2UsIHByb2R1Y2VzIDxyb290PjxjaGlsZCBhdHRyPSJ2YWx1ZSIvPjwvcm9vdD4KICAgICAqIFhtbFV0aWwuc2V0QXR0cmlidXRlKGVsZW1lbnQsICJhdHRyIiwgInZhbHVlIik7CiAgICAgKgogICAgICogLy8gd2l0aCBuYW1lc3BhY2UsIHByb2R1Y2VzIDxyb290PjxjaGlsZCBkYzpjcmVhdG9yPSJtZSIvPjwvcm9vdD4KICAgICAqIFhtbFV0aWwuc2V0QXR0cmlidXRlKGVsZW1lbnQsICJjcmVhdG9yIiwgIm1lIiwgWG1sTmFtZXNwYWNlcy5kYyk7CiAgICAgKi8KICAgIHRoYXQuc2V0QXR0cmlidXRlID0gZnVuY3Rpb24oIG5vZGUsIGF0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZVZhbHVlLCBhdHRyaWJ1dGVOYW1lc3BhY2UpIHsKLy8gICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIFhtbFV0aWwuc2V0QXR0cmlidXRlIiApOwovLyAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdmFyIGFjdHVhbE5vZGUgPSBYbWxVdGlsLl9fZ2V0QWN0dWFsTm9kZShub2RlKTsKICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZU5hbWVzcGFjZSkgewogICAgICAgICAgICAgICAgTG9nLnRyYWNlKCJTZXR0aW5nIGF0dHJpYnV0ZSAnIiwgYXR0cmlidXRlTmFtZSwgIic9JyIsIGF0dHJpYnV0ZVZhbHVlLCAiJyB3aXRoIG5hbWVzcGFjZSAiLCBhdHRyaWJ1dGVOYW1lc3BhY2UucHJlZml4KTsKICAgICAgICAgICAgICAgIGlmICggYXR0cmlidXRlTmFtZXNwYWNlICE9PSBYbWxOYW1lc3BhY2VzLnhtbG5zICYmICFYbWxVdGlsLmlzTmFtZXNwYWNlRGVmaW5lZChhY3R1YWxOb2RlLCBhdHRyaWJ1dGVOYW1lc3BhY2UpKSB7CiAgICAgICAgICAgICAgICAgICAgWG1sVXRpbC5hZGROYW1lc3BhY2UoYWN0dWFsTm9kZSwgYXR0cmlidXRlTmFtZXNwYWNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGFjdHVhbE5vZGUuc2V0QXR0cmlidXRlTlMoYXR0cmlidXRlTmFtZXNwYWNlLnVyaSwgYXR0cmlidXRlTmFtZXNwYWNlLnByZWZpeCArICI6IiArIGF0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZVZhbHVlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIExvZy50cmFjZSgiU2V0dGluZyBhdHRyaWJ1dGUgJyIsIGF0dHJpYnV0ZU5hbWUsICInPSciLCBhdHRyaWJ1dGVWYWx1ZSwgIiciKTsKICAgICAgICAgICAgICAgIGFjdHVhbE5vZGUuc2V0QXR0cmlidXRlKGF0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZVZhbHVlKTsKICAgICAgICAgICAgfQovLyAgICAgICAgfSBmaW5hbGx5IHsKLy8gICAgICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIFhtbFV0aWwuc2V0QXR0cmlidXRlIiApOwovLyAgICAgICAgfQogICAgfTsKICAgIAogICAgICAgCiAgICAvKioKICAgICAqIERlbGV0ZXMgdGhlIGNvcnJlc3BvbmRpbmcgbm9kZQogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhtbFV0aWwuZGVsZXRlTm9kZQogICAgICogQHN5bnRheCBYbWxVdGlsLmRlbGV0ZU5vZGUoeG1sTm9kZSkKICAgICAqIEBwYXJhbSB7Tm9kZX0geG1sTm9kZQogICAgICogQGV4YW1wbGUKICAgICAqIHZhciB4bWxOb2RlID0gWG1sVXRpbC5mcm9tU3RyaW5nKCI8cm9vdD48Y2hpbGQ+PC9jaGlsZD48L3Jvb3Q+IikKICAgICAqIFhtbFV0aWwuZGVsZXRlTm9kZShYbWxVdGlsLnNlbGVjdE5vZGUoIi9yb290L2NoaWxkIiwgeG1sTm9kZSkpOwogICAgICogeG1sTm9kZS50b1N0cmluZygpIC8vICI8cm9vdC8+IgogICAgICovCiAgICB0aGF0LmRlbGV0ZU5vZGUgPSBmdW5jdGlvbih4bWxOb2RlKXsKICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZyBYbWxVdGlsLmRlbGV0ZU5vZGUsIG5vZGU6ICIsIFhtbFV0aWwubG9nWG1sU3RyaW5nKCB4bWxOb2RlICkgKTsKICAgICAgICB4bWxOb2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoeG1sTm9kZSk7Ci8vICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIFhtbFV0aWwuZGVsZXRlTm9kZSIpOwogICAgfTsKCiAgICAvKioKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLmlzWG1sCiAgICAgKiBAcGFyYW0gcG9zc2libGVYbWwgSmF2YVNjcmlwdCBPYmplY3QKICAgICAqIEByZXR1cm4ge2Jvb2xlYW59IHJldHVybiBpZiBUaGUgdmFyaWFibGUgaXMgYSB4bWxFbGVtZW50CiAgICAgKi8KICAgIHRoYXQuaXNYbWwgPSBmdW5jdGlvbihwb3NzaWJsZVhtbCkgewogICAgICAgIHJldHVybiBwb3NzaWJsZVhtbC5ub2RlVHlwZSAhPT0gdW5kZWZpbmVkICYmICh0eXBlb2YgcG9zc2libGVYbWwubm9kZVR5cGUpID09PSAibnVtYmVyIjsKICAgIH07CgogICAgLyoqCiAgICAgKiBQcmV0dHkgcHJpbnQgYW4gWE1MIGRvY3VtZW50L3NuaXBwZXQsIHdpdGggcmVzdHJpY3Rpb25zLgogICAgICoKICAgICAqIFRoaXMgbWV0aG9kIHRha2VzIGFuZCBYTUwgb2JqZWN0IChub3QgWE1MTGlzdCkgYW5kIHByb2R1Y2VzIGEgc3RyaW5nCiAgICAgKiByZXByZXNlbnRpbmcgdGhlIG9iamVjdCB0aGF0IGlzIHN1aXRlZCBmb3IgZS5nLiB1c2Ugd2l0aCBkaWZmIAogICAgICogCiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgc2xvdyEgQ29tcGFyZWQgdG8gdGhlIGJ1aWx0aW4gdG9YTUxTdHJpbmcsCiAgICAgKiB0aGUgbWV0aG9kIGlzIDEwLTMwIHRpbWVzIGFzIHNsb3cuIEl0IHNob3VsZCBub3QgYmUgdXNlZCBmb3IKICAgICAqIHByb2dyYW1zIHRoYXQgbmVlZHMgdG8gcnVuIHF1aWNrbHkuIEFsc286IFRoZSBvdXRwdXQgc3RyaW5nIG1heQogICAgICogbm90IGFsd2F5cyByZXByZXNlbnQgdGhlIGV4YWN0IFhNTCBpbnB1dDogSW5zaWduaWZpY2FudAogICAgICogd2hpdGVzcGFjZSBjYW4gYmUgaW50cm9kdWNlZCBiZXR3ZWVuIGVsZW1lbnRzLCBidXQgbm90ICppbioKICAgICAqIHRleHQgZWxlbWVudHMuIENvbnRhaW5zIG5vIHN1cHBvcnQgZm9yIG91dHB1dHRpbmcgQ0RBVEEsCiAgICAgKiB0b3BsZXZlbC1jb21tZW50cyBvciBwcmVwcm9jZXNzaW5nIG5vZGVzLCBhcyB0aGVyZSBpcyBubyBrbm93biB3YXkgdG8KICAgICAqIGdldCB0aGVzZSBub2RlcyBpbnRvIHRoZSBYTUwgb2JqZWN0LiBPbmx5IHRoZSBjb250cm9sCiAgICAgKiBjaGFyYWN0ZXJzIG9mIHhtbCAxLjAgYXJlIHN1cHBvcnRlZCAoeDksIHhBLCB4RCkuCiAgICAgKgogICAgICogQHN5bnRheCBYbWxVdGlsLnByZXR0eVByaW50KCB4bWwsIG9wdGlvbnMgKQogICAgICogQHBhcmFtIHtOb2RlfSB4bWwgQW4geG1sIGRvY3VtZW50L2VsZW1lbnQgdG8gcHJldHR5IHByaW50CiAgICAgKiBAcGFyYW0gb3B0aW9ucyBPYmplY3Qgd2l0aCBvcHRpb25zIGZvciB0aGUgY3JlYXRpb24gb2YgdGhlIFhNTCBzdHJpbmcgcmVwcmVzZW50YXRpb24uCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLnNvcnRBdHRyaWJ1dGVzPXRydWVdIElmIHRydWUsIHRoZSBhdHRyaWJ1dGVzIHdpbGwgYmUgc29ydGVkIHdoZW4gb3V0cHV0CiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLmRpZmZJbXByb3ZlPXRydWVdIElmIHRydWUsIG91dHB1dCB3aWxsIGJlIGJldHRlciBzdWl0ZWQgZm9yIGRpZmYgKGF0dHJpYnV0ZXMgYW5kIG5hbWVzcGFjZXMgb24gc2luZ2xlIGxpbmVzKS4KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5pbmRlbnRMZXZlbD0yXSBMZXZlbCBvZiBpbmRlbnQgZm9yIGVhY2ggWE1MIGxldmVsCiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IEEgc3RyaW5nIHdpdGggYSByZXByZXNlbnRhdGlvbiBvZiB0aGUgWE1MIChzZWUgbm90ZSkKICAgICAqIEBleGFtcGxlCi8vIFRoaXMgZXhhbXBsZSwgZnJvbSB1c2luZyBhIEphdmFTY3JpcHQgc2hlbGwsIGRlbW9uc3RyYXRlcyB0aGUgZm9ybWF0dGluZyBvZiBhIHNpbXBsZSBYTUwgZG9jdW1lbnQKanM+IFhtbFV0aWwucHJldHR5UHJpbnQoIFhtbFV0aWwuZnJvbVN0cmluZygiPHJvb3QgYT0nYWF0JyAgIGM9J2NhdCcgYj0nYmF0Jz48Zm9vIGZvb2FhdD0nZm9vYWF0YXQnICBmb29iYXQ9J2Zvb2JhdGF0Jz5iYXI8L2Zvbz48L3Jvb3Q+IiksIHsgZGlmZkltcHJvdmUgOiB0cnVlIH0gKTsKPHJvb3QKICAgIGE9ImFhdCIKICAgIGI9ImJhdCIKICAgIGM9ImNhdCI+CiAgPGZvbwogICAgICBmb29hYXQ9ImZvb2FhdGF0IgogICAgICBmb29iYXQ9ImZvb2JhdGF0Ij5iYXI8L2Zvbz4KPC9yb290PgogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgWG1sVXRpbC5wcmV0dHlQcmludCAqLwogICAgdGhhdC5wcmV0dHlQcmludCA9IGZ1bmN0aW9uKCB4bWwsIG9wdGlvbnMgKSB7CiAgICAgICAgLy8gTm90ZTogVGVjaG5pY2FsbHkgdGhpcyBzaG91bGQgYmUgYSByZWltcGxlbWVudGF0aW9uIG9mIHRvWE1MU3RyaW5nIGZyb20gdGhlIEVDTUEgc3RhbmRhcmQsCiAgICAgICAgLy8gcHAgMTAuMi4xLCBidXQgdGhhdCB3YXMganVzdCB0b28gY3JhenksIHNvIEkgZGlkIHRoaXMgaW5zdGVhZC4gCiAgICAgICAgLy8gTm9ybWFsIHRvWE1MU3RyaW5nIGNhbiBpbnNlcnQgbm9uLXNpZ25pZmljYW50IHdoaXRlc3BhY2UgaW4gdGV4dCBlbGVtZW50cywgYW5kIGJldHdlZW4gZWxlbWVudHMuCiAgICAgICAgLy8gVGhpcyBpbXBsZW1lbnRhdGlvbiBvbmx5IGluc2VydHMgd2hpdGVzcGFjZSBiZXR3ZWVuIGVsZW1lbnRzLCBub3QgKmluKiBlbGVtZW50cy4KICAgICAgICAvLyBOb3RlOiBUaGUgdXNlIG9mIGEgYnVmZmVyIHRvIGNvbGxlY3QgZ2VuZXJhdGVkIHN0cmluZ3MgaW4sIGlzIGludGVudGlvbmFsIGFuZCBkdWUgdG8gKHJlYWwpIHBlcmZvcm1hbmNlIGlzc3VlcyAKICAgICAgICAvLyBpbiBzdHJpbmcgY29uY2F0ZW5hdGlvbi4KICAgICAgICBMb2cudHJhY2UoICItPlhtbFV0aWwucHJldHR5UHJpbnQiICk7CiAgICAgICAgLy8gU2V0IHVwIGRlZmF1bHQgb3B0aW9ucwogICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICAgIGlmICggb3B0aW9ucy5zb3J0QXR0cmlidXRlcyA9PT0gdW5kZWZpbmVkICkgewogICAgICAgICAgICBvcHRpb25zLnNvcnRBdHRyaWJ1dGVzID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgb3B0aW9ucy5kaWZmSW1wcm92ZSA9IG9wdGlvbnMuZGlmZkltcHJvdmUgfHwgZmFsc2U7CiAgICAgICAgaWYgKCBvcHRpb25zLmRpZmZJbXByb3ZlICkgewogICAgICAgICAgICBvcHRpb25zLnNvcnRBdHRyaWJ1dGVzID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgb3B0aW9ucy5pbmRlbnRMZXZlbCA9IG9wdGlvbnMuaW5kZW50TGV2ZWwgfHwgMjsKCiAgICAgICAgdmFyIG5ld0xpbmU9IlxuIjsKICAgICAgICBpZiggb3B0aW9ucy5ub05ld0xpbmVzICE9PSB1bmRlZmluZWQgKSB7CiAgICAgICAgICAgIG5ld0xpbmU9IiI7CiAgICAgICAgICAgIG9wdGlvbnMuaW5kZW50TGV2ZWw9MDsKICAgICAgICB9CgogICAgICAgIExvZy5kZWJ1ZyggImRpZmZJbXByb3ZlOiAiICsgb3B0aW9ucy5kaWZmSW1wcm92ZS50b1N0cmluZyggKSArICIsIHNvcnRBdHRyaWJ1dGVzOiAiICsgb3B0aW9ucy5zb3J0QXR0cmlidXRlcy50b1N0cmluZyggKSArCiAgICAgICAgICAgICIsIGluZGVudExldmVsOiAiICsgb3B0aW9ucy5pbmRlbnRMZXZlbC50b1N0cmluZyggKSApOwoKCiAgICAgICAgLy8gRml4IGluZGVudHByZWZpeCAtIGFkZCBvbmUgYmVjYXVzZSBqb2luIGlzICJpbi1iZXR3ZWVuIi4KICAgICAgICB2YXIgaW5kZW50UHJlZml4ID0gbmV3IEFycmF5KCBvcHRpb25zLmluZGVudExldmVsICsgMSApLmpvaW4oICIgIiApOyAvLyBuZXcgQXJyYXkgT0sKCiAgICAgICAgLy8gVGhpcyBpcyBhICJmdW5jdGlvbiBnbG9iYWwiIGJ1ZmZlciB0aGF0IGlzIHVzZWQgdG8gY29sbGVjdCB0aGUgCiAgICAgICAgLy8gcmVzdWx0IGluLiBUaGUgaWRlYSBpcyB0byByZWR1Y2UgdGhlIG51bWJlciBvZiBzdHJpbmcgb3BlcmF0aW9ucwogICAgICAgIHZhciBidWZmZXIgPSBbIF07CgogICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgIC8vIEVzY2FwZXMgc29tZSBrZXkgY2hhcnMuCiAgICAgICAgLy8gTGlmdGVkIGZyb20gYSBnaXN0LCBubyBsaWNlbnNlLgogICAgICAgIC8vIE5COiBBZGp1c3RlZCB0byB3b3JrIGFsbW9zdCBhY2NvcmRpbmcgdG8gRUNNQQogICAgICAgIC8vIDEwLjIuMS4xIDogRXNjYXBlRWxlbWVudFZhbHVlCiAgICAgICAgLy8gMTAuMi4xLjIgOiBFc2NhcGVBdHRyaWJ1dGVWYWx1ZQogICAgICAgIHZhciBYTUxfQ0hBUl9NQVAgPSB7CiAgICAgICAgICAgICc8JzogJyZsdDsnLAogICAgICAgICAgICAnPic6ICcmZ3Q7JywKICAgICAgICAgICAgJyYnOiAnJmFtcDsnLAogICAgICAgICAgICAnIic6ICcmcXVvdDsnLAogICAgICAgICAgICAiJyI6ICcmYXBvczsnLAogICAgICAgICAgICAiXHUwMDBBIjogIiYjeEE7IiwKICAgICAgICAgICAgIlx1MDAwRCI6ICImI3hEOyIsCiAgICAgICAgICAgICJcdTAwMDkiOiAiJiN4OTsiLAogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIGVzY2FwZVhtbCggcyApIHsKICAgICAgICAgICAgcmV0dXJuIHMucmVwbGFjZSggL1s8PiZcIlwnXHJcdFxuXS9nLCBmdW5jdGlvbiggY2ggKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFhNTF9DSEFSX01BUFsgY2ggXTsKICAgICAgICAgICAgICAgIH0gKTsKICAgICAgICB9OwoKICAgICAgICB2YXIgZ2V0TmFtZXNwYWNlcyA9IGZ1bmN0aW9uKCB4bWwgKXsKICAgICAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmcgWG1sVXRpbC5nZXROYW1lc3BhY2VzIiApOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFyIG5hbWVzcGFjZXMgPSBbXTsKICAgICAgICAgICAgICAgIGlmICggeG1sLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuRUxFTUVOVF9OT0RFICkgewogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgeG1sLmF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoeG1sLmF0dHJpYnV0ZXMuaXRlbShpKS5ub2RlVHlwZSA9PT0gTm9kZVR5cGVzLkFUVFJJQlVURV9OT0RFKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHhtbC5hdHRyaWJ1dGVzLml0ZW0oaSkubmFtZS5pbmRleE9mKCJ4bWxucyIpID09PSAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lc3BhY2VzLnB1c2goeG1sLmF0dHJpYnV0ZXMuaXRlbShpKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nLmRlYnVnKCJmb3VuZCBuYW1lc3BhY2UiLCB4bWwuYXR0cmlidXRlcy5pdGVtKGkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBuYW1lc3BhY2VzOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBYbWxVdGlsLmdldE5hbWVzcGFjZXMiICk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHZhciBnZXRBdHRyaWJ1dGVzID0gZnVuY3Rpb24oIHhtbCApewogICAgICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZyBYbWxVdGlsLmdldEF0dHJpYnV0ZXMiICk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlcyA9IFtdOwogICAgICAgICAgICAgICAgaWYgKCB4bWwubm9kZVR5cGUgPT09IE5vZGVUeXBlcy5FTEVNRU5UX05PREUgKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG5vZGVBdHRyaWJ1dGVzPXhtbC5hdHRyaWJ1dGVzOwogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZUF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZT1ub2RlQXR0cmlidXRlcy5pdGVtKGkpOwogICAgICAgICAgICAgICAgICAgICAgICBpZihhdHRyaWJ1dGUubm9kZVR5cGUgPT09IE5vZGVUeXBlcy5BVFRSSUJVVEVfTk9ERSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihhdHRyaWJ1dGUubmFtZS5pbmRleE9mKCJ4bWxucyIpICE9PSAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzLnB1c2goYXR0cmlidXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cuZGVidWcoImZvdW5kIGF0dHJpYnV0ZSIsIGF0dHJpYnV0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYXR0cmlidXRlczsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIExvZy50cmFjZSggIkxlYXZpbmcgWG1sVXRpbC5nZXRBdHRyaWJ1dGVzIiApOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyBGb3JtYXQgYSBzaW5nbGUgbmFtZXNwYWNlCiAgICAgICAgdmFyIGZvcm1hdE5hbWVzcGFjZSA9IGZ1bmN0aW9uKCBuYW1lc3BhY2UgKSB7CiAgICAgICAgICAgIExvZy50cmFjZSgiZm9ybWF0IG5hbWVzcGFjZSIsbmFtZXNwYWNlKTsKICAgICAgICAgICAgdmFyIG5hbWUgPSBuYW1lc3BhY2UubG9jYWxOYW1lOwogICAgICAgICAgICBpZiAobmFtZSA9PSAieG1sbnMiKXsKICAgICAgICAgICAgICAgIG5hbWUgPSAiIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIG5hbWUgIT0gIiIgKSB7CiAgICAgICAgICAgICAgICBuYW1lID0gIjoiICsgbmFtZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgcmVzID0gWyBdOwogICAgICAgICAgICByZXMucHVzaCggInhtbG5zIiApOwogICAgICAgICAgICByZXMucHVzaCggbmFtZSApOwogICAgICAgICAgICByZXMucHVzaCggJz0iJyApOwogICAgICAgICAgICByZXMucHVzaCggZXNjYXBlWG1sKCBuYW1lc3BhY2UudmFsdWUgKSApOwogICAgICAgICAgICByZXMucHVzaCggJyInICk7CiAgICAgICAgICAgIHJldHVybiByZXMuam9pbiggIiIgKTsKICAgICAgICB9OwoKICAgICAgICAvLyBGb3JtYXQgYWxsIHRoZSBhdmFpbGFibGUgbmFtZXNwYWNlcyBmb3IgYSBwYXJ0aWN1bGFyIG5vZGUuLi4KICAgICAgICB2YXIgZm9ybWF0TmFtZXNwYWNlcyA9IGZ1bmN0aW9uKCB4bWwsIGxldmVsICkgewogICAgICAgICAgICB2YXIgbmFtZXNwYWNlcyA9IGdldE5hbWVzcGFjZXMoeG1sKTsKICAgICAgICAgICAgaWYgKCBuYW1lc3BhY2VzLmxlbmd0aCA9PSAwICkgewogICAgICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggb3B0aW9ucy5zb3J0QXR0cmlidXRlcyApIHsKICAgICAgICAgICAgICAgIG5hbWVzcGFjZXMuc29ydCggZnVuY3Rpb24oIGEsIGIgKSB7ICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGEubG9jYWxOYW1lID09PSAieG1sbnMiKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZihiLmxvY2FsTmFtZSA9PT0gInhtbG5zIil7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5sb2NhbE5hbWUubG9jYWxlQ29tcGFyZShiLmxvY2FsTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgfSApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciByZXMgPSBbIF07CiAgICAgICAgICAgIHZhciBuZXdsaW5lID0gIiI7CiAgICAgICAgICAgIHZhciBpbmRlbnQgPSAiICI7CiAgICAgICAgICAgIGlmICggb3B0aW9ucy5kaWZmSW1wcm92ZSAmJiBuYW1lc3BhY2VzLmxlbmd0aCA+IDEgKSB7CiAgICAgICAgICAgICAgICBuZXdsaW5lID0gIlxuIjsKICAgICAgICAgICAgICAgIGluZGVudCA9IGxldmVsICsgaW5kZW50UHJlZml4ICsgaW5kZW50UHJlZml4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbmFtZXNwYWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgcmVzLnB1c2goIG5ld2xpbmUgKTsKICAgICAgICAgICAgICAgIHJlcy5wdXNoKCBpbmRlbnQgKTsKICAgICAgICAgICAgICAgIHJlcy5wdXNoKCBmb3JtYXROYW1lc3BhY2UoIG5hbWVzcGFjZXNbIGkgXSApICk7CiAgICAgICAgICAgIH0KICAKICAgICAgICAgICAgcmV0dXJuIHJlcy5qb2luKCAiIiApOwogICAgICAgIH07CgogICAgICAgIC8vIEZvcm1hdCBhIHNpbmdsZSBhdHRyaWJ1dGUsIG5vIGluZGVudCwgbm8gbmV3bGluZSwgbm8gbm90aGluZwogICAgICAgIC8vIFRha2VzIGludG8gYWNvdW50IG5hbWVzcGFjZXMgYW5kIHByZWZpeCB2YWx1ZXMuCiAgICAgICAgdmFyIGZvcm1hdEF0dHJpYnV0ZSA9IGZ1bmN0aW9uKCB4bWwgKSB7CiAgICAgICAgICAgIExvZy50cmFjZSgiZm9ybWF0IGF0dHJpYnV0ZSIseG1sKTsKICAgICAgICAgICAgdmFyIHJlcyA9IFsgXTsKICAgICAgICAgICAgdmFyIG5hbWUgPSB4bWwubm9kZU5hbWU7CiAgICAgICAgICAgIHJlcy5wdXNoKCBuYW1lICk7CiAgICAgICAgICAgIHJlcy5wdXNoKCAnPSInICk7CiAgICAgICAgICAgIHJlcy5wdXNoKCBlc2NhcGVYbWwoIHhtbC52YWx1ZSApICk7CiAgICAgICAgICAgIHJlcy5wdXNoKCAnIicgKTsKICAgICAgICAgICAgcmV0dXJuIHJlcy5qb2luKCAiIiApOwogICAgICAgIH07CgogICAgICAgIC8vIEZvcm1hdCBhbGwgYXR0cmlidXRlcyBvZiBhbiBlbGVtZW50CiAgICAgICAgLy8gVGFrZXMgaW50byBhY2NvdW50IGluZGVudCBhbmQgbmV3bGluZXMgKGlmIG1vcmUgdGhhbiBvbmUgYXR0cmlidXRlKQogICAgICAgIC8vIFRoZSByZXR1cm5lZCByZXN1bHQgYWx3YXlzIHN0YXJ0cyB3aXRoIGF0IGxlYXN0IGEgc2luZ2xlIHNwYWNlIG9yIGEgbmV3bGluZQogICAgICAgIHZhciBmb3JtYXRBdHRyaWJ1dGVzID0gZnVuY3Rpb24oIHhtbCwgbGV2ZWwgKSB7CiAgICAgICAgICAgIHZhciBkb19jb21wYXJlID0gZnVuY3Rpb24gKGEsYikgewogICAgICAgICAgICAgICAgaWYoYT5iKSByZXR1cm4gMTsKICAgICAgICAgICAgICAgIGlmKGE8YikgcmV0dXJuIC0xOwogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIExvZy50cmFjZSgiZm9ybWF0IGF0dHJpYnV0ZXMiLHhtbCk7CiAgICAgICAgICAgIHZhciBhdHRyaWJ1dGVzID0gZ2V0QXR0cmlidXRlcyh4bWwpOwogICAgICAgICAgICBpZiAoIGF0dHJpYnV0ZXMubGVuZ3RoID09IDAgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gSWYgYXBwbGljYWJsZSwgc29ydCwgYnV0IG9ubHkgYnkgbG9jYWxOYW1lLiBQcmVmaXgnZXMgd2lsbCBiZSAiaW50ZXJtaXhlZCIuCiAgICAgICAgICAgIGlmICggb3B0aW9ucy5zb3J0QXR0cmlidXRlcyApIHsKICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXMuc29ydCggZnVuY3Rpb24oIGEsIGIgKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRvX2NvbXBhcmUoYS5sb2NhbE5hbWUsIGIubG9jYWxOYW1lKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciByZXMgPSBbIF07CiAgICAgICAgICAgIHZhciBuZXdsaW5lID0gIiI7CiAgICAgICAgICAgIHZhciBpbmRlbnQgPSAiICI7CiAgICAgICAgICAgIGlmICggb3B0aW9ucy5kaWZmSW1wcm92ZSAmJiBhdHRyaWJ1dGVzLmxlbmd0aCA+IDEgKSB7CiAgICAgICAgICAgICAgICBuZXdsaW5lID0gIlxuIjsKICAgICAgICAgICAgICAgIGluZGVudCA9IGxldmVsICsgaW5kZW50UHJlZml4ICsgaW5kZW50UHJlZml4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXR0cmlidXRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgcmVzLnB1c2goIG5ld2xpbmUgKTsKICAgICAgICAgICAgICAgIHJlcy5wdXNoKCBpbmRlbnQgKTsKICAgICAgICAgICAgICAgIHJlcy5wdXNoKCBmb3JtYXRBdHRyaWJ1dGUoIGF0dHJpYnV0ZXNbIGkgXSApICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZXMuam9pbiggIiIgKTsKICAgICAgICB9OwoKCiAgICAgICAgLy8gRm9ybWF0IGFuIG9iamVjdCwgdGhhdCBpcywgdGhpcyBvYmplY3QsIGFuZCBhbGwgY2hpbGRyZW4uCiAgICAgICAgLy8geG1sIC0gdGhlIHhtbCBvYmplY3QvZWxlbWVudCB0byBmb3JtYXQKICAgICAgICAvLyBpbmRlbnQgLSB3aGV0ZXIgdG8gZG8gaW5kZW50L2Zvcm1hdCBmaXJzdCBsaW5lIG9mIGVsZW1lbnQgb3Igbm90CiAgICAgICAgLy8gbGV2ZWwgLSB0aGUgY3VycmVudCBpbmRlbnRhdGlvbiBsZXZlbCAoYXMgYSBzdHJpbmcpCiAgICAgICAgdmFyIGZvcm1hdE5vZGUgPSBmdW5jdGlvbiggeG1sLCBpbmRlbnQsIGxldmVsICkgewogICAgICAgICAgICBMb2cudHJhY2UoImZvcm1hdCBub2RlIixYbWxVdGlsLmxvZ1htbFN0cmluZyggeG1sICkpOwogICAgICAgICAgICAvLyBEbyBkaWZmZXJlbnQgdGhpbmdzIGZvciBlbGVtZW50LCB0ZXh0LCBjb21tZW50IGFuZCBwcmVwcm9jZXNzZXIgaW5zdHJ1Y3Rpb24KICAgICAgICAgICAgCiAgICAgICAgICAgIHhtbCA9IHRoYXQuX19nZXRBY3R1YWxOb2RlKHhtbCk7CiAgICAgICAgICAgIGlmICggeG1sLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuRUxFTUVOVF9OT0RFICkgewogICAgICAgICAgICAgICAgLy8gRm9ybWF0IG5hbWVzcGFjZXMsIGF0dHJpYnV0ZXMgYW5kIGNoaWxkcmVuLgoKICAgICAgICAgICAgICAgIHZhciBuYW1lID0geG1sLm5vZGVOYW1lOwogICAgICAgICAgICAgICAgaWYgKCBpbmRlbnQgKSB7CiAgICAgICAgICAgICAgICAgICAgYnVmZmVyLnB1c2goIG5ld0xpbmUgKTsKICAgICAgICAgICAgICAgICAgICBidWZmZXIucHVzaCggbGV2ZWwgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJ1ZmZlci5wdXNoKCAiPCIgKTsKICAgICAgICAgICAgICAgIGJ1ZmZlci5wdXNoKCBuYW1lICk7CiAgICAgICAgICAgICAgICBidWZmZXIucHVzaCggZm9ybWF0TmFtZXNwYWNlcyggeG1sLCBsZXZlbCApICk7CiAgICAgICAgICAgICAgICBidWZmZXIucHVzaCggZm9ybWF0QXR0cmlidXRlcyggeG1sLCBsZXZlbCApICk7CgogICAgICAgICAgICAgICAgLy8gRm9yIGNoaWxkcmVuOgogICAgICAgICAgICAgICAgLy8gVGhlIGlkZWEgaXMgdG8gaGF2ZSBlYWNoIGVsZW1lbnQgZm9ybWF0IGl0c2VsZiByZWN1cnNpdmVseS4KICAgICAgICAgICAgICAgIC8vIEZvcm1hdHRpbmcgaW5jbHVkZXMgbmV3bGluZSBhbmQgaW5kZW50cyBiZWZvcmUgdGhlIGVsZW1lbnQsIGJ1dCBub3QgYWZ0ZXIuCiAgICAgICAgICAgICAgICAvLyBUZXh0IGVsZW1lbnRzIGRvIG5vdCBpbnNlcnQgbmV3bGluZXMgYmVmb3JlIHRoZW1zZWx2ZXMKICAgICAgICAgICAgICAgIC8vIEVsZW1lbnRzIGZvbGxvd2luZyBhIHRleHRlbGVtZW50IGlzIG5vdCBhbGxvd2VkIHRvIG5ld2xpbmUgYW5kIGluZGVudCBiZWZvcmUsIGJ1dCBtYXkgZG8gYWZ0ZXIuCiAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGNvbnRyb2xsZWQgYnkgdGhlICJpbmRlbnQiIHZhcmlhYmxlLgogICAgICAgICAgICAgICAgLy8gSWYgdGhlIGZpbmFsIGVsZW1lbnQgaXMgYSBuZXdsaW5lLCB0aGUgY2xvc2luZyB0YWcgaXMgbm90IHNldAogICAgICAgICAgICAgICAgLy8gSWYgdGhpcyBlbGVtZW50IGNvbnRhaW5zIGFueSB0ZXh0IG5vZGVzLCB3ZSBkbyBub3Qgd2FudCB0byBpbmRlbnQgdGhlIGNvbnRlbnQgb2YgdGhpcyAKICAgICAgICAgICAgICAgIC8vIGVsZW1lbnQuIChUaGlzIGRvZXMgbm90IGluZmx1ZW5jZSBlLmcuIGF0dHJpYnV0ZXMgb24gc2VwYXJhdGUgbGluZXMpLgoKICAgICAgICAgICAgICAgIC8vIFVzZWQgZm9yIGl0ZXJhdGlvbgogICAgICAgICAgICAgICAgdmFyIGNoaWxkcmVuID0geG1sLmNoaWxkTm9kZXM7CgogICAgICAgICAgICAgICAgLy8gVXNlZCB0byB0cmFjayBpZiB0aGUgY2hpbGRyZW5zIG1hZGUgYW55IGNvbnRlbnQKICAgICAgICAgICAgICAgIC8vIE9wdGltaXN0aWNhbGx5IGFzc3VtZSB0aGF0IGNoaWxkcmVuIG1lYW5zIHRoYXQgd2UgbmVlZCBhIGNsb3NpbmcgdGFnCiAgICAgICAgICAgICAgICB2YXIgY29udGVudEluZGV4ID0gYnVmZmVyLnB1c2goICI+IiApOwoKICAgICAgICAgICAgICAgIC8vIEFjdHVhbGx5IGZpZ3VyZSBvdXQgaWYgd2UgY2FuIGludHJvZHVjZSBzcGFjZXMvZm9ybWF0dGluZyBpbnRvIGFuIGVsZW1lbnQvbWl4ZWQgY29udGVudAogICAgICAgICAgICAgICAgdmFyIGxhc3RXYXNOb25Ucml2aWFsVGV4dE5vZGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBmb3JtYXROb2RlKCBjaGlsZHJlbi5pdGVtKCBpICksICFsYXN0V2FzTm9uVHJpdmlhbFRleHROb2RlLCBsZXZlbCArIGluZGVudFByZWZpeCApOwogICAgICAgICAgICAgICAgICAgIGxhc3RXYXNOb25Ucml2aWFsVGV4dE5vZGUgPSAoICggY2hpbGRyZW4uaXRlbSggaSApLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuVEVYVF9OT0RFICYmIFhtbFV0aWwudG9YbWxTdHJpbmcoIGNoaWxkcmVuLml0ZW0oaSkgKSAhPSAiIiApICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gRGlkIHdlIGdlbmVyYXRlIGFueSBjb250ZW50IGF0IGFsbD8gSWYgbm90LCBjbG9zZSB0YWcgYnkgaXQgc2VsZi4KICAgICAgICAgICAgICAgIGlmICggY29udGVudEluZGV4ID09IGJ1ZmZlci5sZW5ndGggKSB7CiAgICAgICAgICAgICAgICAgICAgYnVmZmVyWyBjb250ZW50SW5kZXggLSAxIF0gPSAiLz4iOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBJZiBsYXN0IHdhcyBhIG5vbiB0cml2aWFsIHRleHQgbm9kZSwgZG8gbm90IGluc2VydCBhIG5ld2xpbmUgYmVmb3JlIGNsb3NlIHRhZwogICAgICAgICAgICAgICAgICAgIC8vIGJ1ZmZlcltjb250ZW50SW5kZXgtMV0gPSAiPiI7IC8vIGFscmVhZHkgZG9uZQogICAgICAgICAgICAgICAgICAgIGlmICggIWxhc3RXYXNOb25Ucml2aWFsVGV4dE5vZGUgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlci5wdXNoKCBuZXdMaW5lICsgbGV2ZWwgKTsKICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJ1ZmZlci5wdXNoKCAiPC8iICsgbmFtZSArICI+IiApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKCB4bWwubm9kZVR5cGUgPT09IE5vZGVUeXBlcy5URVhUX05PREUgKSB7CiAgICAgICAgICAgICAgICBidWZmZXIucHVzaCggZXNjYXBlWG1sKFhtbFV0aWwudG9YbWxTdHJpbmcoIHhtbCApICkgKTsKICAgICAgICAgICAgfSBlbHNlIGlmICggeG1sLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuQ09NTUVOVF9OT0RFICkgewogICAgICAgICAgICAgICAgYnVmZmVyLnB1c2goIG5ld0xpbmUgKyBsZXZlbCArIFhtbFV0aWwudG9YbWxTdHJpbmcoIHhtbCApICk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIHhtbC5ub2RlVHlwZSA9PT0gTm9kZVR5cGVzLkNEQVRBX1NFQ1RJT05fTk9ERSApIHsKICAgICAgICAgICAgICAgIGJ1ZmZlci5wdXNoKCBuZXdMaW5lICsgbGV2ZWwgKyB4bWwubm9kZVZhbHVlICk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBXZSBkbyBub3QgYWN0dWFsbHkgZXhwZWN0IHRvIGdldCBoZXJlIQogICAgICAgICAgICAgICAgTG9nLndhcm4oICJYbWxVdGlsLnByZXR0eVByaW50OiBVbmV4cGVjdGVkIG5vZGVLaW5kICIgKyB4bWwubm9kZVR5cGUgKyAiIG9jY3VyZWQuIFJldmVydGluZyB0byB0b1hNTFN0cmluZygpIiApOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBidWZmZXIucHVzaCggeG1sLm5vZGVUeXBlICk7CiAgICAgICAgICAgICAgICB9IGNhdGNoICggZSApIHsKICAgICAgICAgICAgICAgICAgICBYbWxVdGlsLl9fdGhyb3dFcnJvciggIldoaWxlIHRyeWluZyB0byBnZW5lcmF0ZSBYTUwgZm9yIHVua25vd24gbm9kZUtpbmQgOiAnIiArIHhtbC5ub2RlVHlwZSArICInLCBhbiBlcnJvciBvY2N1cnJlZDogIiArIGUgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGZvcm1hdE5vZGUoIHhtbCwgZmFsc2UsICIiICk7CiAgICAgICAgcmV0dXJuIGJ1ZmZlci5qb2luKCAiIiApOwogICAgfTsKCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBEb2N1bWVudCBmcm9tIGF0IEVsZW1lbnRzLiBBbGwgTmFtZXNwYWNlcyBmcm9tIHRoaXMgY2hpbGQgdG8gdGhlIGRvY3VtZW50CiAgICAgKiBpcyBjb3B5ZWQgdG8gdGhlIG5ldyBkb2N1bWVudEVsZW1lbnQKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLmNyZWF0ZURvY3VtZW50RnJvbUVsZW1lbnQKICAgICAqIEBwYXJhbSBFbGVtZW50IHRvIGJlIG5ldyB0b3BsZXZlbCBmb3IgdGhlIGRvY3VtZW50CiAgICAgKiBAcmV0dXJuIHtEb2N1bWVudH0gbmV3IGRvY3VtZW50IHdpdGggY2hpbGQgYXMgZG9jdW1lbnRFbGVtZW50CiAgICAgKi8KICAgIHRoYXQuY3JlYXRlRG9jdW1lbnRGcm9tRWxlbWVudCA9IGZ1bmN0aW9uKCBFbGVtZW50ICkgewogICAgICAgIC8qKgogICAgICAgICAqICByZWN1cnNpdmUgdHJhY2UgdXAgdG8gYW5kIGNvbGxlY3QgYWxsIGF0dHJvYnV0ZXMgc3RhcnRpbmcgd2l0aCB4bWxucwogICAgICAgICAqIEBuYW1lIFhtbFV0aWwuY3JlYXRlRG9jdW1lbnRGcm9tRWxlbWVudC5leHRyYWN0UGFyZW50TmFtZXNwYWNlQXR0cmlidXRlcwogICAgICAgICAqIEBwYXJhbSBjaGlsZAogICAgICAgICAqIEByZXR1cm4ge0FycmF5fSBvZiBOYW1lc3BhY2VzIG5vZGVzIGZyb20gY2hpbGQgdXAgdG8gRG9jdW1lbnQ7CiAgICAgICAgICovCiAgICAgICAgdmFyIGV4dHJhY3RQYXJlbnROYW1lc3BhY2VBdHRyaWJ1dGVzPWZ1bmN0aW9uKCBjaGlsZCApIHsKCiAgICAgICAgICAgIHZhciBuYW1lc3BhY2VBdHRyaWJ1dGVzPVtdOwogICAgICAgICAgICBpZiAoIGNoaWxkLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuRUxFTUVOVF9OT0RFICkgewogICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZXM9Y2hpbGQuYXR0cmlidXRlczsKICAgICAgICAgICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IGF0dHJpYnV0ZXMubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZT1hdHRyaWJ1dGVzLml0ZW0oaSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCBhdHRyaWJ1dGUubm9kZVR5cGUgPT09IE5vZGVUeXBlcy5BVFRSSUJVVEVfTk9ERSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZS5wcmVmaXggPT09IFhtbE5hbWVzcGFjZXMueG1sbnMucHJlZml4IHx8IGF0dHJpYnV0ZS5ub2RlTmFtZSA9PT0gInhtbG5zIiApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzcGFjZUF0dHJpYnV0ZXMucHVzaCggYXR0cmlidXRlICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCBjaGlsZC5wYXJlbnROb2RlICkgewogICAgICAgICAgICAgICAgbmFtZXNwYWNlQXR0cmlidXRlcz1uYW1lc3BhY2VBdHRyaWJ1dGVzLmNvbmNhdCggZXh0cmFjdFBhcmVudE5hbWVzcGFjZUF0dHJpYnV0ZXMoIGNoaWxkLnBhcmVudE5vZGUgKSApOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbmFtZXNwYWNlQXR0cmlidXRlczsKICAgICAgICB9OwoKCiAgICAgICAgdmFyIHJlc3VsdERvY3VtZW50PVhtbFV0aWwuZG9tSW1wbC5jcmVhdGVEb2N1bWVudCgpOwogICAgICAgIHZhciBuZXdDaGlsZD1yZXN1bHREb2N1bWVudC5pbXBvcnROb2RlKEVsZW1lbnQsdHJ1ZSk7CiAgICAgICAgcmVzdWx0RG9jdW1lbnQuYXBwZW5kQ2hpbGQobmV3Q2hpbGQpOwoKICAgICAgICB2YXIgbnM9ZXh0cmFjdFBhcmVudE5hbWVzcGFjZUF0dHJpYnV0ZXMoIEVsZW1lbnQgKTsKICAgICAgICBucy5mb3JFYWNoKCBmdW5jdGlvbiggbnMgKSB7IG5ld0NoaWxkLnNldEF0dHJpYnV0ZU5TKCBucy5uYW1lc3BhY2VVUkksIG5zLm5hbWUsIG5zLnZhbHVlICk7IH0pOwoKICAgICAgICByZXR1cm4gcmVzdWx0RG9jdW1lbnQ7CiAgICB9OwoKICAgIC8qKgogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhtbFV0aWwubm9ybWFsaXplWG1sCiAgICAgKiBAcGFyYW0ge0RvY3VtZW50fE5vZGV9IHhtbAogICAgICogQHJldHVybiB7RG9jdW1lbnR9IG5ldyBkb2N1bWVudCB3aXRoIGNoaWxkIGFzIGRvY3VtZW50RWxlbWVudAogICAgICovCiAgICB0aGF0Lm5vcm1hbGl6ZVhtbCA9IGZ1bmN0aW9uICggeG1sICkgewoKCiAgICAgICAgZnVuY3Rpb24gZG9tVHJpbSggeG1sRWxlbWVudCApIHsKICAgICAgICAgICAgaWYoIHhtbEVsZW1lbnQubm9kZVR5cGUgPT09IE5vZGVUeXBlcy5URVhUX05PREUgKSB7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIE9ubHkgdHJpbSBpZiBURVhUIG5vZGUgaGFzIGEgc2libGluZyB3aGljaCBpcyBub3QgYSBURVhUIG5vZGUKICAgICAgICAgICAgICAgIGlmKCAoIHhtbEVsZW1lbnQucHJldmlvdXNTaWJsaW5nICYmIHhtbEVsZW1lbnQucHJldmlvdXNTaWJsaW5nLm5vZGVUeXBlICE9PSBOb2RlVHlwZXMuVEVYVF9OT0RFICkKICAgICAgICAgICAgICAgICAgICAgICAgfHwgKCB4bWxFbGVtZW50Lm5leHRTaWJsaW5nICYmIHhtbEVsZW1lbnQubmV4dFNpYmxpbmcubm9kZVR5cGUgIT09IE5vZGVUeXBlcy5URVhUX05PREUgKSApIHsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB4bWxFbGVtZW50Lm5vZGVWYWx1ZSA9IHhtbEVsZW1lbnQubm9kZVZhbHVlLnRyaW0oKTsgICAgICAgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGNoaWxkPXhtbEVsZW1lbnQuZmlyc3RDaGlsZDsKICAgICAgICAgICAgd2hpbGUoY2hpbGQpIHsKICAgICAgICAgICAgICAgIGRvbVRyaW0oIGNoaWxkICk7CiAgICAgICAgICAgICAgICBjaGlsZCA9IGNoaWxkLm5leHRTaWJsaW5nOwoKICAgICAgICAgICAgfQogICAgICAgIH0KCgogICAgICAgIC8vIHJlbW92ZXMgbmFtZXNwYWNlcyBmcm9tIHRoaXMgbm9kZQogICAgICAgIC8vCiAgICAgICAgZnVuY3Rpb24gZXh0cmFjdE5hbWVzcGFjZXNGcm9tRWxlbWVudCggeG1sRWxlbWVudCApIHsKICAgICAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmcgWG1sVXRpbC5nZXROYW1lc3BhY2VzICIsIFhtbFV0aWwubG9nWG1sU3RyaW5nKCB4bWxFbGVtZW50ICkpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFyIG5hbWVzcGFjZXMgPSBbXTsKICAgICAgICAgICAgICAgIHZhciBub25fbmFtZXNwYWNlcyA9IFtdOwogICAgICAgICAgICAgICAgaWYgKCB4bWxFbGVtZW50Lm5vZGVUeXBlID09PSBOb2RlVHlwZXMuRUxFTUVOVF9OT0RFICkgewogICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGVMaXN0PXhtbEVsZW1lbnQuYXR0cmlidXRlczsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGF0dHJpYnV0ZUxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZT1hdHRyaWJ1dGVMaXN0Lml0ZW0oaSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCBhdHRyaWJ1dGUubm9kZVR5cGUgPT09IE5vZGVUeXBlcy5BVFRSSUJVVEVfTk9ERSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihhdHRyaWJ1dGUucHJlZml4ID09PSBYbWxOYW1lc3BhY2VzLnhtbG5zLnByZWZpeCApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzcGFjZXMucHVzaChhdHRyaWJ1dGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZy50cmFjZSgiZm91bmQgbmFtZXNwYWNlIiwgYXR0cmlidXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9uX25hbWVzcGFjZXMucHVzaCggYXR0cmlidXRlICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBuYW1lc3BhY2VzLmZvckVhY2goZnVuY3Rpb24obnMpIHsgeG1sRWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUobnMubmFtZSk7fSk7CiAgICAgICAgICAgICAgICBub25fbmFtZXNwYWNlcy5mb3JFYWNoKCBmdW5jdGlvbihucyl7IHhtbEVsZW1lbnQucmVtb3ZlQXR0cmlidXRlTm9kZShucyk7fSk7CiAgICAgICAgICAgICAgICBub25fbmFtZXNwYWNlcy5zb3J0KGZ1bmN0aW9uIChhLGIpIHsKICAgICAgICAgICAgICAgICAgICBpZihhLm5hbWU+Yi5uYW1lKSByZXR1cm4gMTsKICAgICAgICAgICAgICAgICAgICBpZihhLm5hbWU8Yi5uYW1lKSByZXR1cm4gLTE7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIG5vbl9uYW1lc3BhY2VzLmZvckVhY2goZnVuY3Rpb24obnMpeyBYbWxVdGlsLnNldEF0dHJpYnV0ZSh4bWxFbGVtZW50LCBucy5uYW1lLG5zLnZhbHVlLCBucy5uYW1lc3BhY2UpO30pOwogICAgICAgICAgICAgICAgcmV0dXJuIG5hbWVzcGFjZXM7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIFhtbFV0aWwuZ2V0TmFtZXNwYWNlcyIsIFhtbFV0aWwubG9nWG1sU3RyaW5nKCB4bWxFbGVtZW50ICkgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZXh0cmFjdE5hbWVzcGFjZXMoIHhtbEVsZW1lbnQgKSB7CiAgICAgICAgICAgIExvZy50cmFjZSgiRW50ZXJpbmcgZXh0cmFjdE5hbWVzcGFjZXMgOiAiLCBYbWxVdGlsLmxvZ1htbFN0cmluZyggeG1sRWxlbWVudCApICk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB2YXIgbmFtZXNwYWNlcyA9IGV4dHJhY3ROYW1lc3BhY2VzRnJvbUVsZW1lbnQoeG1sRWxlbWVudCk7CgogICAgICAgICAgICAgICAgdmFyIGNoaWxkID0geG1sRWxlbWVudC5maXJzdENoaWxkOwogICAgICAgICAgICAgICAgd2hpbGUgKCBjaGlsZCApIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbmV3bnMgPSBleHRyYWN0TmFtZXNwYWNlcyggY2hpbGQgKTsKICAgICAgICAgICAgICAgICAgICBuZXducy5mb3JFYWNoKCBmdW5jdGlvbiAoIGUgKSB7IG5hbWVzcGFjZXMucHVzaCggZSApOyB9ICk7CiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBjaGlsZC5uZXh0U2libGluZzsKCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIG5hbWVzcGFjZXM7CiAgICAgICAgICAgIH0gZmluYWxseXsKICAgICAgICAgICAgICBMb2cudHJhY2UoIkxlYXZpbmcgZXh0cmFjdE5hbWVzcGFjZXMgOiAiLCBYbWxVdGlsLmxvZ1htbFN0cmluZyggeG1sRWxlbWVudCApICk7CiAgICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICB2YXIgZG9jdW1lbnRFbGVtZW50PXhtbDsKICAgICAgICBpZiggeG1sLmRvY3VtZW50RWxlbWVudCApIHsKICAgICAgICAgICAgZG9jdW1lbnRFbGVtZW50PXhtbC5kb2N1bWVudEVsZW1lbnQ7CiAgICAgICAgfQoKICAgICAgICBkb21UcmltKCBkb2N1bWVudEVsZW1lbnQgKTsKICAgICAgICB2YXIgdG9wbnM9ZXh0cmFjdE5hbWVzcGFjZXMoIGRvY3VtZW50RWxlbWVudCApOwogICAgICAgIHRvcG5zLnNvcnQoZnVuY3Rpb24gKGEsYikgewogICAgICAgICAgICBpZihhLm5hbWU+Yi5uYW1lKSByZXR1cm4gMTsKICAgICAgICAgICAgaWYoYS5uYW1lPGIubmFtZSkgcmV0dXJuIC0xOwogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9KTsKICAgICAgICB0b3Bucy5mb3JFYWNoKGZ1bmN0aW9uKG5zKXsKICAgICAgICAgICAgZG9jdW1lbnRFbGVtZW50LnNldEF0dHJpYnV0ZU5TKG5zLm5hbWVzcGFjZVVSSSwgbnMubmFtZSwgbnMudmFsdWUpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiB4bWw7CiAgICB9OwoKCiAgICAvKioKICAgICAqIEdldHMgeG1sIGFzIGVpdGhlciBzdHJpbmcsIGRvY3VtZW50LCBvciBlbGVtZW50IGFuZCB3aWxsIGFsd2F5cyByZXR1cm4gYW4gZWxlbWVudAogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhtbFV0aWwuYXNFbGVtZW50CiAgICAgKiBAc3ludGF4IFhtbFV0aWwuYXNFbGVtZW50KCB4bWwgKQogICAgICogQHBhcmFtIHtOb2RlfERvY3VtZW50fFN0cmluZyB9IHhtbCB4bWwgZWl0aGVyIGFzIGRvY3VtZW50LCBlbGVtZW50IG9yIHN0cmluZwogICAgICogQGV4YW1wbGUKICAgICAqIHZhciBlbGVtZW50ID0gWG1sVXRpbC5hc0VsZW1lbnQoIHhtbCApOwogICAgICogWG1sVXRpbC5hc0VsZW1lbnQoICI8dGFnPjwvdGFnPiIpOwogICAgICovCgogICAgdGhhdC5hc0VsZW1lbnQgPSBmdW5jdGlvbiggeG1sICkgewoKICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZyBYbWxVdGlsLmFzRWxlbWVudCIgKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIHVuZGVmaW5lZCA9PT0geG1sIHx8IG51bGwgPT09IHhtbCApIHsKICAgICAgICAgICAgICAgIFhtbFV0aWwuX190aHJvd0Vycm9yKCAiRXJyb3IgLSBpbnB1dCB0byBYbWxVdGlsLmFzRWxlbWVudCB3YXMgZWl0aGVyIG51bGwgb3IgdW5kZWZpbmVkIiApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciB0eXBlID0gVXRpbC5nZXRUeXBlKCB4bWwgKTsKCiAgICAgICAgICAgIHN3aXRjaCAoIHR5cGUgKSB7CiAgICAgICAgICAgICAgICBjYXNlICJvYmplY3QiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGF0Ll9fZ2V0QWN0dWFsTm9kZSggeG1sICk7CiAgICAgICAgICAgICAgICBjYXNlICJEb2N1bWVudCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHhtbC5kb2N1bWVudEVsZW1lbnQ7CiAgICAgICAgICAgICAgICBjYXNlICJzdHJpbmciOgogICAgICAgICAgICAgICAgY2FzZSAiU3RyaW5nIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gWG1sVXRpbC5mcm9tU3RyaW5nKHhtbCkuZG9jdW1lbnRFbGVtZW50OwogICAgICAgICAgICAgICAgY2FzZSAiRWxlbWVudCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHhtbDsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgWG1sVXRpbC5fX3Rocm93RXJyb3IoICJFcnJvciAtIGlucHV0IHRvIFhtbFV0aWwuYXNFbGVtZW50IHdhcyBub3QgeG1sIiApOwogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBYbWxVdGlsLmFzRWxlbWVudCIgKTsKICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAgICogU29ydCBjaGlsZCBlbGVtZW50cyBhbHBoYWJldGljYWxseS4KICAgICAqIAogICAgICogU29ydCBjaGlsZCBlbGVtZW50cyBvZiB0aGUgcGFzc2VkIG5vZGUgYWxwaGFiZXRpY2FsbHkgYWNjb3JkaW5nIHRvIGZ1bGx5IHF1YWxpZmllZCBuYW1lCiAgICAgKgogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgWG1sVXRpbC5zb3J0RWxlbWVudHMKICAgICAqIEBzeW50YXggWG1sVXRpbC5hc0VsZW1lbnQoIHhtbCApCiAgICAgKiBAcGFyYW0ge05vZGV8RG9jdW1lbnQgfSB4bWwgeG1sIGVpdGhlciBhcyBkb2N1bWVudCBvciBlbGVtZW50CiAgICAgKiBAcmV0dXJuIHtOb2RlfSB0aGUgbW9kaWZpZWQgbm9kZQogICAgICogQGV4YW1wbGUKICAgICAqIFhtbFV0aWwuc29ydEVsZW1lbnRzKCB4bWwgKTsKICAgICAqLwogICAgdGhhdC5zb3J0RWxlbWVudHMgPSBmdW5jdGlvbiggeG1sICl7CiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmcgWG1sVXRpbC5zb3J0RWxlbWVudHMiICk7CiAgICAgICAgdmFyIHBhcmVudE5vZGUgPSBYbWxVdGlsLl9fZ2V0QWN0dWFsTm9kZSh4bWwpOwogICAgICAgIHZhciBlbGVtZW50cyA9IFtdOwogICAgICAgIC8vTG9nLmRlYnVnKCJYbWxVdGlsLnNvcnRFbGVtZW50cywgaW5wdXQgaGFzICIsIHBhcmVudE5vZGUuY2hpbGROb2Rlcy5sZW5ndGgsICIgbm9kZXMiKTsKICAgICAgICBmb3IgKCB2YXIgaSA9IHBhcmVudE5vZGUuY2hpbGROb2Rlcy5sZW5ndGgtMSA7IGkgPj0gMCA7IGktLSApIHsKICAgICAgICAgICAgLy92YXIgbm9kZSA9IHBhcmVudE5vZGUuY2hpbGROb2Rlc1sgaSBdOwogICAgICAgICAgICB2YXIgbm9kZT0gcGFyZW50Tm9kZS5jaGlsZE5vZGVzLml0ZW0oaSk7CiAgICAgICAgICAgIC8vTG9nLmRlYnVnKCJYbWxVdGlsLnNvcnRFbGVtZW50cywgcmVtb3ZlICIsIG5vZGUpOwogICAgICAgICAgICBwYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBub2RlICk7CiAgICAgICAgICAgIGVsZW1lbnRzLnB1c2goIG5vZGUgKTsKICAgICAgICB9CiAgICAgICAgLy9Mb2cuZGVidWcoIlhtbFV0aWwuc29ydEVsZW1lbnRzLCBlbGVtZW50cyBoYXMgIiwgZWxlbWVudHMubGVuZ3RoLCAiIG5vZGVzIik7CiAgICAgICAgLy9Mb2cuZGVidWcoIlhtbFV0aWwuc29ydEVsZW1lbnRzLCBjbGVhbmVkIG91dHB1dCBoYXMgIiwgcGFyZW50Tm9kZS5jaGlsZE5vZGVzLmxlbmd0aCwgIiBub2RlcyIpOwogICAgICAgIGVsZW1lbnRzLnNvcnQoZnVuY3Rpb24gKGEsYikgewogICAgICAgICAgICBpZihhLm5vZGVOYW1lPmIubm9kZU5hbWUpIHJldHVybiAxOwogICAgICAgICAgICBpZihhLm5vZGVOYW1lPGIubm9kZU5hbWUpIHJldHVybiAtMTsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfSk7CiAgICAgICAgTG9nLmRlYnVnKCJYbWxVdGlsLnNvcnRFbGVtZW50cywgc29ydGVkIGVsZW1lbnRzIGhhcyAiLCBlbGVtZW50cy5sZW5ndGgsICIgbm9kZXMiKTsKCiAgICAgICAgZm9yICggdmFyIGkgPSAwIDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICB2YXIgbm9kZSA9IGVsZW1lbnRzWyBpIF07CiAgICAgICAgICAgIC8vTG9nLmRlYnVnKCJYbWxVdGlsLnNvcnRFbGVtZW50cywgYXBwZW5kIHNvcnRlZCAiLCBub2RlKTsKICAgICAgICAgICAgWG1sVXRpbC5hcHBlbmRDaGlsZChwYXJlbnROb2RlLCBub2RlKTsKICAgICAgICAgICAgLy9wYXJlbnROb2RlLmFwcGVuZENoaWxkKG5vZGUpOwogICAgICAgICAgICAvL0xvZy5kZWJ1ZygiWG1sVXRpbC5zb3J0RWxlbWVudHMsIG91dHB1dCAiLCBwYXJlbnROb2RlKTsKICAgICAgICB9CiAgICAgICAgLy9Mb2cuZGVidWcoIlhtbFV0aWwuc29ydEVsZW1lbnRzLCBvdXRwdXQgaGFzICIsIHBhcmVudE5vZGUuY2hpbGROb2Rlcy5sZW5ndGgsICIgbm9kZXMiKTsKICAgICAgICBMb2cuZGVidWcoIlhtbFV0aWwuc29ydEVsZW1lbnRzLCBvdXRwdXQgIiwgcGFyZW50Tm9kZSk7CiAgICAgICAgcmV0dXJuIHhtbDsKICAgIH07CgogICAgcmV0dXJuIHRoYXQ7Cn0oICk7Cgo=", "moduleName": "XmlUtil"}, {"javascript": "LyoqIEBmaWxlIFByb3ZpZGUgVzNDIGNvbXBhdGlibGUgWE1MRE9NIGltcGxlbWVudGF0aW9uLiAqLwpFWFBPUlRFRF9TWU1CT0xTID0gWyAnWE1MRE9NJyBdOwpJR05PUkVEX1NZTUJPTFMgPSBbICdfX3VzZV9qYXZhX3htbF9kb20nIF07CnVzZSggIkVuZ2luZSIgKTsKdXNlKCAiTG9nIiApOwoKLy8gWE1MRE9NIHR1dG9yaWFsOiBodHRwOi8vd3d3Lnczc2Nob29scy5jb20vRG9tLwovLyBYTUxET00gcmVmZXJlbmNlOiBodHRwOi8vd3d3Lnczc2Nob29scy5jb20vRG9tL2RvbV9kb2N1bWVudC5hc3AKLy8gWE1MRE9NIGNvbW5mb3JtYW5jZSB0ZXN0OiBodHRwOi8vd3d3LnczLm9yZy9ET00vVGVzdC8KCi8qKgogKiBQcm92aWRlcyBhbiBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgVzNDIFhNTCBET00uCiAqIAogKiBUaGlzIG1vZHVsZSBhbGxvd3Mgd29ya2luZyB3aXRoIFhNTCB1c2luZyB0aGUgc3RhbmRhcmRpemVkIFhNTCBBUEkgZnJvbSBXQzMuIAogKiAKICogVGhlcmUgaXMgYW4gaW50cm9kdWN0aW9uL3R1dG9yaWFsIGZvciB0aGlzLCBoZXJlOiB7QGxpbmsgaHR0cDovL3d3dy53M3NjaG9vbHMuY29tL0RvbS99LgogKiBBIGZ1bGwgcmVmZXJlbmNlIGlzIGF2YWlsYWJsZSBoZXJlOiB7QGxpbmsgaHR0cDovL3d3dy53M3NjaG9vbHMuY29tL0RvbS9kb21fZG9jdW1lbnQuYXNwfS4KICogCiAqIFRoZSBhY3R1YWwgaW1wbGVtZW50YXRpb24gaXMgYmFzZWQgb24ge0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS9qaW5kdy94bWxkb219IChjbG9uZWQgaW50byB7QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL0RCQ0RLL3htbGRvbS5naXR9LgogKiAKICogKipOT1RFOioqIFRoaXMgaXMgY3VycmVudGx5IGFuIGltcGxlbWVudGF0aW9uIG9mIHRoZSB2ZXJzaW9uIDIgb2YgdGhlIFhNTCBET00gc3RhbmRhcmQuCiAqIAogKiAqKk5PVEU6KiogVGhpcyBtb2R1bGUgZGVwZW5kcyBvbiBhIENvbW1vbkpTL01vZHVsZXMvMS4wIG1vZHVsZSwgdGhhdCBsaXZlcyBhcyBhIHN1YmRpcmVjdG9yeSB0byB0aGUganNjb21tb24gZXh0ZXJuYWxzIG1vZHVsZS4gRXJyb3JzIGxpa2UgIkVycm9yOiBSZXF1aXJlLnJlcXVpcmUsIHVuYWJsZSB0byByZXNvbHZlICgnJywgJ3htbGRvbScpIHRvIGEgbW9kdWxlLiAoUmVxdWlyZS51c2UuanMjMzc5KSIgaW5kaWNhdGVzIHRoYXQKICogdGhlIHNlYXJjaCBwYXRocyBuZWVkcyB0byBoYXZlIHRoaXMgc2V0IChpbiBhYnNvbHV0ZSBvciByZWxhdGl2ZSBmb3JtYXQ6IHNlZSB7QGxpbmsgUmVxdWlyZX0gZm9yIG1vcmUgaW5mb3JtYXRpb24pLiAKCiAqIAogKiBAZXhhbXBsZSAvLyBIb3cgdG8gY3JlYXRlIGEgc2ltcGxlIFhNTCBkb2N1bWVudCBmcm9tIGEgc3RyaW5nLCBhbmQgZXh0cmFjdCBpbmZvcm1hdGlvbiBhYm91dCB0aGUgZG9jdW1lbnRSb290cyBsb2NhbE5hbWU6CnVzZSggIlhNTERPTSIgKTsKLy8gQ3JlYXRlIGEgbmV3IERPTSBwYXJzZXIsIHRoYXQgY2FuIGUuZy4gcGFyc2UgeG1sIGRvY3VtZW50cwp2YXIgZG9tUGFyc2VyID0gbmV3IFhNTERPTS5ET01QYXJzZXIoKTsKLy8gQ3JlYXRlIGEgc2ltcGxlIGRvY3VtZW50IGZyb20gYSBzaW1wbGUgc3RyaW5nCnZhciBkb2MgPSBkb21QYXJzZXIucGFyc2VGcm9tU3RyaW5nKCAiPHNvbWU+eG1sPC9zb21lPiIgKTsKLy8gVGhpcyByZXR1cm5zICJzb21lIgpkb2MuZG9jdW1lbnRFbGVtZW50LmxvY2FsTmFtZQogKgogKiBAbmFtZXNwYWNlCiAqIEBuYW1lIFhNTERPTQogKi8KCi8vIEBUT0RPIGNoZWNrIGZvciBqYXZhIG9yIGMrKyBlbnZpcm9ubWVudCBhbmQgYWN0IGFjY29yZGluZ2x5CgovLyBGbGFnIHRvIHVzZSBqYXZhIG9yIGphdmFzY3JpcHQgWE1MRE9NIGltcGxlbWVudGF0aW9uCi8vIENvbnRyb2xsZWQgYnkgZW52aXJvbm1lbnQgdmFyaWFibGUgVVNFX0pBVkFfWE1MX0RPTSBvciBieSBwdXR0aW5nIHRoZSBnbG9iYWwgcHJvcGVydHkKLy8gX19VU0VfSkFWQV9YTUxfRE9NIGluIHRoZSBqYXZhc2NyaXB0IGVudmlyb25tZW50Ci8vIERlZmF1bHRzIHRvIHVzZSBKYXZhc2NyaXB0IERPTSBpbXBsZW1lbnRhdGlvbgp2YXIgX191c2VfamF2YV94bWxfZG9tID0gZnVuY3Rpb24oKSB7CiAgICBpZiAoICEgRW5naW5lLmlzRW5naW5lKEVuZ2luZS5OQVNIT1JOKSApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB2YXIgc3lzdGVtID0gUGFja2FnZXMuamF2YS5sYW5nLlN5c3RlbTsKICAgIHZhciB2YWx1ZSA9IHN5c3RlbS5nZXRlbnYoIlVTRV9KQVZBX1hNTF9ET00iKTsKICAgIExvZy5kZWJ1ZyggIkVudmlyb25tZW50IHZhcmlhYmxlOiBVU0VfSkFWQV9YTUxfRE9NOiAiLCBMb2cuc2FmZVZhbHVlKCB2YWx1ZSApICk7CgogICAgdmFyIGdsb2JhbCA9IHRoaXMuaGFzT3duUHJvcGVydHkoICJfX1VTRV9KQVZBX1hNTF9ET00iICkgJiYgX19VU0VfSkFWQV9YTUxfRE9NOwogICAgTG9nLmRlYnVnKCAiR2xvYmFsIDogX19VU0VfSkFWQV9YTUxfRE9NOiAiLCBMb2cuc2FmZVZhbHVlKCBnbG9iYWwgKSApOwogICAgICAKICAgIGlmKCBzeXN0ZW0uZ2V0ZW52KCJVU0VfSkFWQV9YTUxfRE9NIikgPT09IG51bGwgJiYgCiAgICAgICAgICAgIHRoaXMuaGFzT3duUHJvcGVydHkoICJfX1VTRV9KQVZBX1hNTF9ET00iICkgPT09IGZhbHNlICkgewogICAgICAgIHJldHVybiB0cnVlOyAvLyBkZWZhdWx0CiAgICB9CgogICAgaWYgKCBnbG9iYWwgfHwgKCB2YWx1ZSAmJiBKU09OLnBhcnNlKCB2YWx1ZSApICkgKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KfTsKCmlmICggIV9fdXNlX2phdmFfeG1sX2RvbSgpICkgewogICAgLy8gSmF2YXNjcmlwdCBpbXBsZW1lbnRhdGlvbgogICAgTG9nLmluZm8oIlVzaW5nIFhNTERPTSBpbXBsZW1lbnRhdGlvbjogSmF2YXNjcmlwdCIpOwogICAgLy8gT25seSBsb2FkIHJlcXVpcmUgbW9kdWxlcyBpZiAncmVxdWlyZWQnCiAgICB1c2UoICJSZXF1aXJlIiApOwogICAgdmFyIFhNTERPTSA9IChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHRoYXQgPSByZXF1aXJlKCJ4bWxkb20iKTsKICAgICAgICB0aGF0LkRPTVBhcnNlci5wcm90b3R5cGUudG9YbWxTdHJpbmcgPSBmdW5jdGlvbiAoZG9jKSB7CiAgICAgICAgICAgIHJldHVybiBkb2MudG9TdHJpbmcoKTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gdGhhdDsKICAgIH0pKCk7Cn0gZWxzZSB7CiAgICAvLyBKYXZhIGltcGxlbWVudGF0aW9uCiAgICBMb2cuaW5mbygiVXNpbmcgWE1MRE9NIGltcGxlbWVudGF0aW9uOiBKYXZhIik7CiAgICB2YXIgWE1MRE9NID0gKCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGRvY0J1aWxkZXJGYWMgPSBQYWNrYWdlcy5qYXZheC54bWwucGFyc2Vycy5Eb2N1bWVudEJ1aWxkZXJGYWN0b3J5Lm5ld0luc3RhbmNlKCk7CiAgICAgICAgZG9jQnVpbGRlckZhYy5uYW1lc3BhY2VBd2FyZSA9IHRydWU7CiAgICAgICAgdmFyIGRvY0J1aWxkZXIgPSBkb2NCdWlsZGVyRmFjLm5ld0RvY3VtZW50QnVpbGRlcigpOwogICAgICAgIHZhciBkb21JbXBsZW1lbnRhdGlvbiA9IGRvY0J1aWxkZXIuZ2V0RE9NSW1wbGVtZW50YXRpb24oKTsKICAgICAgICB2YXIgbHNTZXJpYWxpemVyID0gZG9tSW1wbGVtZW50YXRpb24uY3JlYXRlTFNTZXJpYWxpemVyKCk7CiAgICAgICAgdmFyIEJvb2xlYW4gPSBQYWNrYWdlcy5qYXZhLmxhbmcuQm9vbGVhbjsKICAgICAgICBsc1NlcmlhbGl6ZXIuZG9tQ29uZmlnLnNldFBhcmFtZXRlciggInhtbC1kZWNsYXJhdGlvbiIsIEJvb2xlYW4uRkFMU0UgKTsKCiAgICAgICAgdmFyIERPTVBhcnNlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHBhcnNlRnJvbVN0cmluZzogZnVuY3Rpb24gKCB4bWxTdHJpbmcgKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGlzID0gbmV3IFBhY2thZ2VzLm9yZy54bWwuc2F4LklucHV0U291cmNlKCBuZXcgUGFja2FnZXMuamF2YS5pby5TdHJpbmdSZWFkZXIoIHhtbFN0cmluZyApICk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGRvY3VtZW50ID0gZG9jQnVpbGRlci5wYXJzZSggaXMgKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZG9jdW1lbnQ7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdG9YbWxTdHJpbmc6IGZ1bmN0aW9uICggZG9jICkgewogICAgICAgICAgICAgICAgICAgIGlmICggZG9jICkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgeG1sID0gbHNTZXJpYWxpemVyLndyaXRlVG9TdHJpbmcoIGRvYyApOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geG1sOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICB9OwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIERPTVBhcnNlcjogRE9NUGFyc2VyLAogICAgICAgICAgICBET01JbXBsZW1lbnRhdGlvbjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBjcmVhdGVEb2N1bWVudDogZnVuY3Rpb24gKCBuYW1lc3BhY2VVUkksIHF1YWxpZmllZE5hbWUsIGRvY3R5cGUgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IDM7IGkrKyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggYXJndW1lbnRzW2ldID09IHVuZGVmaW5lZCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHNbaV0gPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkb21JbXBsZW1lbnRhdGlvbi5jcmVhdGVEb2N1bWVudCggYXJndW1lbnRzWzBdLCBhcmd1bWVudHNbMV0sIGFyZ3VtZW50c1syXSApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfSkoKTsKfQoKCi8qKiBQcm92aWRlcyBhbiBpbXBsZW1lbnRhdGlvbiBvZiBhIERPTVBhcnNlci4KICogCiAqIFRoaXMgcHJvdmlkZXMgYW4gaW1wbGVtZW50YXRpb24gb2YgdGhlIHtAbGluayBodHRwOi8vZG9tcGFyc2luZy5zcGVjLndoYXR3Zy5vcmcvI3RoZS1kb21wYXJzZXItaW50ZXJmYWNlfERPTVBhcnNlciBpbnRlcmZhY2V9LiBZb3UgbW9zdGx5IHVzZSBpdCB0byBjcmVhdGUgYSBET00gRG9jdW1lbnQgd2l0aCB0aGUgcGFyc2VGcm9tU3RyaW5nIG1ldGhvZC4KICogCiAqIEBleGFtcGxlIC8vIEhvdyB0byBjcmVhdGUgYSBzaW1wbGUgWE1MIGRvY3VtZW50IGZyb20gYSBzdHJpbmcKdXNlKCAiWE1MRE9NIiApOwp2YXIgZG9jID0gKG5ldyBYTUxET00uRE9NUGFyc2VyKCkpLnBhcnNlRnJvbVN0cmluZyggIjxzb21lPnhtbDwvc29tZT4iICk7CiAqCiAqIAogKiBAY29uc3RydWN0b3IKICogQG5hbWUgWE1MRE9NLkRPTVBhcnNlciAKICovCgovKiogUHJvdmlkZXMgYW4gaW1wbGVtZW50YXRpb24gb2YgdGhlIERPTUltcGxlbWVudGF0aW9uIGludGVyZmFjZS4KICogCiAqIFRoZSBET01JbXBsZW1lbnRhdGlvbiBpbnRlcmZhY2UgcmVwcmVzZW50IGFuIG9iamVjdCBwcm92aWRpbmcgbWV0aG9kcyB3aGljaCBhcmUgbm90IGRlcGVuZGVudCBvbiBhbnkgcGFydGljdWxhciBkb2N1bWVudC4gU3VjaCBhbiBvYmplY3QgaXMgcmV0dXJuZWQgYnkgdGhlIERvY3VtZW50LmltcGxlbWVudGF0aW9uIHByb3BlcnR5LgogKiAKICogKipOb3RlOioqIFRoaXMgaXMgcmFyZWx5IHVzZWQsIEkgdGhpbmsuCiAqIAogKiBAZXhhbXBsZSAvLyBIb3cgdG8gdXNlIHRoZSBET01JbXBsZW1lbnRhdGlvbiB0byBjcmVhdGUgYSBkb2N1bWVudAp1c2UoICJYTUxET00iICk7CnZhciBkb21pID0gbmV3IFhNTERPTS5ET01JbXBsZW1lbnRhdGlvbigpOwovLyBDcmVhdGUgbmV3IGVtcHR5IGRvY3VtZW50Lgp2YXIgZG9jID0gZG9taS5jcmVhdGVEb2N1bWVudCgpOwogKgogKiAKICogQGNvbnN0cnVjdG9yCiAqIEBuYW1lIFhNTERPTS5ET01JbXBsZW1lbnRhdGlvbgogKi8KCi8qKiBQcm92aWRlcyBhIHNlcmlhbGl6ZXIgdGhhdCBjYW4gY29udmVydCBET00gc3VidHJlZSBvciBkb2N1bWVudCBpbnRvIHRleHQuCiAqCiAqIFhNTFNlcmlhbGl6ZXIgY2FuIGJlIHVzZWQgdG8gY29udmVydCBET00gc3VidHJlZSBvciBET00gZG9jdW1lbnQgaW50byB0ZXh0LgogKiAKICogQGV4YW1wbGUgLy8gSG93IHRvIHNlcmlhbGl6ZSBhIGRvY3VtZW50CnVzZSggIlhNTERPTSIgKTsKdmFyIGRvYyA9IChuZXcgWE1MRE9NLkRPTVBhcnNlcigpKS5wYXJzZUZyb21TdHJpbmcoICI8c29tZT54bWw8L3NvbWU+IiApOwovLyBBZGQgYW4gImVkaXRpb24iIGVsZW1lbnQKZG9jLmRvY3VtZW50RWxlbWVudC5hcHBlbmRDaGlsZCggZG9jLmNyZWF0ZUVsZW1lbnQoICJlZGl0aW9uIiApICk7Ci8vIENyZWF0ZSBhIHNlcmlhbGl6ZXIKdmFyIHhtbHMgPSBuZXcgWE1MRE9NLlhNTFNlcmlhbGl6ZXIoKTsKLy8gU2VyaWFsaXNlIHdob2xlIGVsZW1lbnQgLSByZXR1cm5zIDxzb21lPnhtbDxlZGl0aW9uLz48L3NvbWU+CnhtbHMuc2VyaWFsaXplVG9TdHJpbmcoIGRvYyApOwogKiAKICogQGNvbnN0cnVjdG9yCiAqIEBuYW1lIFhNTERPTS5YTUxTZXJpYWxpemVyICAKKi8K", "moduleName": "XMLDOM"}, {"javascript": "Ly8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpFWFBPUlRFRF9TWU1CT0xTID0gWyAnRW5naW5lJyBdOwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovKioKICoKICoKICogQGNvbnN0cnVjdG9yCiAqLwp2YXIgRW5naW5lID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgU1BJREVSTU9OS0VZID0gInNwaWRlcm1vbmtleSI7CiAgICB2YXIgUkhJTk8gPSAicmhpbm8iOwogICAgdmFyIE5BU0hPUk4gPSAibmFzaG9ybiI7CgogICAgZnVuY3Rpb24gaXNFbmdpbmUoIG5hbWUgKSB7CiAgICAgICAgc3dpdGNoKCBuYW1lICkgewogICAgICAgICAgICBjYXNlIFJISU5POiB7CiAgICAgICAgICAgICAgICByZXR1cm4gKCB0eXBlb2YgUGFja2FnZXMgPT09ICJvYmplY3QiICkgJiYgKCB0eXBlb2YgUGFja2FnZXMuamF2YSA9PT0gIm9iamVjdCIgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2FzZSBOQVNIT1JOOiB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mKCBfX2Vudmlyb25tZW50ICkgPT09ICJvYmplY3QiOwogICAgICAgICAgICB9CgogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgICBpZiggbmFtZSAhPT0gU1BJREVSTU9OS0VZICkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gIWlzRW5naW5lKCBSSElOTyApICYmICFpc0VuZ2luZSggTkFTSE9STiApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgJ1NQSURFUk1PTktFWSc6IFNQSURFUk1PTktFWSwKICAgICAgICAnUkhJTk8nOiBSSElOTywKICAgICAgICAnTkFTSE9STic6IE5BU0hPUk4sCiAgICAgICAgJ2lzRW5naW5lJzogaXNFbmdpbmUKICAgIH0KfSgpOwo=", "moduleName": "Engine"}, {"javascript": "LyoqIEBmaWxlIFByb3ZpZGUgRE9NIDMgWFBhdGggaW1wbGVtZW50YXRpb24uICovCkVYUE9SVEVEX1NZTUJPTFMgPSBbICdYUGF0aCcgXTsKCnVzZSggIlhtbE5hbWVzcGFjZXMiICk7CnVzZSggIlV0aWwiICk7CnVzZSggIkxvZyIgKTsKdXNlKCAiTm9kZVR5cGVzIiApOwp1c2UoICJFbmdpbmUiICk7CgovLyBYUGF0aCB0dXRvcmlhbDogaHR0cDovL3d3dy53M3NjaG9vbHMuY29tL1hQYXRoLwovLyBYUGF0aCByZWZlcmVuY2U6ID8gCgoKLyoqCiAqIFByb3ZpZGVzIGFuIGltcGxlbWVudGF0aW9uIG9mIGFuIERPTSAzIFhQYXRoIGltcGxlbWVudGF0aW9uLgogKiAKICogVGhpcyBtb2R1bGUgYWxsb3dzIHdvcmtpbmcgd2l0aCBYTUwgdXNpbmcgdGhlIHN0YW5kYXJkaXplZCBYUGF0aCBBUEkgZnJvbSBXQzMuIAogKiAKICogVGhlcmUgaXMgYW4gaW50cm9kdWN0aW9uL3R1dG9yaWFsIGZvciB0aGlzLCBoZXJlOiB7QGxpbmsgaHR0cDovL3d3dy53M3NjaG9vbHMuY29tL1hQYXRoL30uCiAqIAogKiBUaGUgYWN0dWFsIGltcGxlbWVudGF0aW9uIGlzIGJhc2VkIG9uIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vZ290bzEwMC94cGF0aH0gKGNsb25lZCBpbnRvIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vREJDREsveHBhdGguZ2l0fSkuCiAqIAogKiBUaGlzIG1vZHVsZSBjb250YWlucyBubyBkb2N1bWVudGF0aW9uIC0geW91IHdpbGwgaGF2ZSB0byBjb25zdWx0IG9ubGluZSBzb3VyY2VzIG9yIHRoZSB0dXRvcmlhbCBhYm92ZSBmb3IgZG9jdW1lbnRhdGlvbi4KICogCiAqICoqTk9URToqKiBUaGlzIG1vZHVsZSBhdXRvbWF0aWNhbGx5IGxvYWRzIHRoZSB7QGxpbmsgWE1MRE9NfSBtb2R1bGUsIHNpbmNlIGl0IGlzIGFzc3VtZWQgdGhhdCB5b3Ugd2lzaCB0byB3b3JrIHdpdGggdGhpcy4KICogCiAqICoqTk9URToqKiBUaGlzIG1vZHVsZSBkZXBlbmRzIG9uIGEgQ29tbW9uSlMvTW9kdWxlcy8xLjAgbW9kdWxlLCB0aGF0IGxpdmVzIGFzIGEgc3ViZGlyZWN0b3J5IHRvIHRoZSBqc2NvbW1vbiBleHRlcm5hbHMgbW9kdWxlLiBFcnJvcnMgbGlrZSAiRXJyb3I6IFJlcXVpcmUucmVxdWlyZSwgdW5hYmxlIHRvIHJlc29sdmUgKCcnLCAneHBhdGgnKSB0byBhIG1vZHVsZS4gKFJlcXVpcmUudXNlLmpzIzM3OSkiIGluZGljYXRlcyB0aGF0CiAqIHRoZSBzZWFyY2ggcGF0aHMgbmVlZHMgdG8gaGF2ZSB0aGlzIHNldCAoaW4gYWJzb2x1dGUgb3IgcmVsYXRpdmUgZm9ybWF0OiBzZWUge0BsaW5rIFJlcXVpcmV9IGZvciBtb3JlIGluZm9ybWF0aW9uKS4gCiAqIAogKiBAZXhhbXBsZSAvLyBSZWFkIHRoZSB0aXRsZSBmcm9tIGEgc2ltcGxlIHhtbCBkb2N1bWVudAp1c2UoICJYUGF0aCIgKTsKdmFyIHhtbFN0cmluZyA9ICI8Ym9vaz48dGl0bGU+SGFycnkgUG90dGVyPC90aXRsZT48L2Jvb2s+IjsKLy8gQ3JlYXRlIGEgRE9NIGRvY3VtZW50IGZyb20gdGhlIHN0cmluZy4KdmFyIGRvYyA9IChuZXcgWE1MRE9NLkRPTVBhcnNlcigpKS5wYXJzZUZyb21TdHJpbmcoeG1sU3RyaW5nKTsKLy8gR2V0IGFsbCB0aXRsZSBub2Rlcwp2YXIgbm9kZXMgPSBYUGF0aC5zZWxlY3QoIi8vdGl0bGUiLCBkb2MpOwovLyBMb2NhbG5hbWUgYW5kIGRhdGEgPT4gdGl0bGU6IEhhcnJ5IFBvdHRlcgpub2Rlc1swXS5ub2RlTmFtZSArICI6ICIgKyBub2Rlc1swXS5maXJzdENoaWxkLm5vZGVWYWx1ZTsKLy8gTm9kZSBub2RlOiA8dGl0bGU+SGFycnkgUG90dGVyPC90aXRsZT4KIm5vZGU6ICIgKyBub2Rlc1swXS50b1N0cmluZygpOwogKgogKiBAbmFtZXNwYWNlCiAqIEBuYW1lIFhQYXRoCiAqLwp2YXIgWFBhdGggPSAoZnVuY3Rpb24oKSB7CiAgICB2YXIgdGhhdDsKICAgIAogICAgLy8gRmxhZyB0byB1c2UgamF2YSBvciBqYXZhc2NyaXB0IFhQQVRIIGltcGxlbWVudGF0aW9uCiAgICAvLyBDb250cm9sbGVkIGJ5IGVudmlyb25tZW50IHZhcmlhYmxlIFVTRV9KQVZBX1hQQVRIIG9yIGJ5IHB1dHRpbmcgdGhlIGdsb2JhbCBwcm9wZXJ0eQogICAgLy8gX19VU0VfSkFWQV9YUEFUSCBpbiB0aGUgamF2YXNjcmlwdCBlbnZpcm9ubWVudAogICAgLy8gRGVmYXVsdHMgdG8gdXNlIEphdmFzY3JpcHQgRE9NIGltcGxlbWVudGF0aW9uCiAgICB2YXIgX191c2VfamF2YV94cGF0aCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICggISBFbmdpbmUuaXNFbmdpbmUoRW5naW5lLk5BU0hPUk4pICkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHZhciBzeXN0ZW0gPSBQYWNrYWdlcy5qYXZhLmxhbmcuU3lzdGVtOwogICAgICAgIHZhciB2YWx1ZSA9IHN5c3RlbS5nZXRlbnYoIlVTRV9KQVZBX1hQQVRIIik7CiAgICAgICAgTG9nLmRlYnVnKCAiRW52aXJvbm1lbnQgdmFyaWFibGU6IFVTRV9KQVZBX1hQQVRIOiAiLCBMb2cuc2FmZVZhbHVlKCB2YWx1ZSApICk7CgogICAgICAgIHZhciBnbG9iYWwgPSB0aGlzLmhhc093blByb3BlcnR5KCAiX19VU0VfSkFWQV9YUEFUSCIgKSAmJiBfX1VTRV9KQVZBX1hQQVRIOwogICAgICAgIExvZy5kZWJ1ZyggIkdsb2JhbCA6IF9fVVNFX0pBVkFfWFBBVEg6ICIsIExvZy5zYWZlVmFsdWUoIGdsb2JhbCApICk7CiAgICAgICAgCiAgICAgICAgaWYoIHN5c3RlbS5nZXRlbnYoIlVTRV9KQVZBX1hQQVRIIikgPT09IG51bGwgJiYgCiAgICAgICAgICAgICAgICB0aGlzLmhhc093blByb3BlcnR5KCAiX19VU0VfSkFWQV9YUEFUSCIgKSA9PT0gZmFsc2UgKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOyAvLyBkZWZhdWx0CiAgICAgICAgfQoKICAgICAgICBpZiAoIGdsb2JhbCB8fCAoIHZhbHVlICYmIEpTT04ucGFyc2UoIHZhbHVlICkgKSApIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH07CgogICAgaWYgKCAhX191c2VfamF2YV94cGF0aCgpICkgewogICAgICAgIExvZy5pbmZvKCJVc2luZyBYUEFUSCBpbXBsZW1lbnRhdGlvbjogSmF2YXNjcmlwdCIpOwogICAgICAgIC8vIE9ubHkgbG9hZCByZXF1aXJlIG1vZHVsZXMgaWYgJ3JlcXVpcmVkJwogICAgICAgIHVzZSggIlJlcXVpcmUiICk7CiAgICAgICAgdGhhdCA9IHJlcXVpcmUoICJ4cGF0aCIgKTsKICAgICAgICB0aGF0LnNlbGVjdEltcGwgPSB0aGF0LnVzZU5hbWVzcGFjZXMoWG1sTmFtZXNwYWNlcy5uYW1lc3BhY2VNYXApOwogICAgICAgIC8vIFNhdmUgb3JpZ2luYWwgc2VsZWN0IG1ldGhvZCBpbiBjYXNlIGl0IGlzIG5lZWRlZAogICAgICAgIHRoYXQuc2VsZWN0T3JpZ2luYWwgPSB0aGF0LnNlbGVjdDsKCiAgICB9IGVsc2UgewogICAgICAgIExvZy5pbmZvKCJVc2luZyBYUEFUSCBpbXBsZW1lbnRhdGlvbjogSmF2YSIpOwogICAgICAgIHRoYXQgPSB7fTsKICAgICAgICB2YXIgZmFjdG9yeSA9IFBhY2thZ2VzLmphdmF4LnhtbC54cGF0aC5YUGF0aEZhY3RvcnkubmV3SW5zdGFuY2UoKTsKICAgICAgICB2YXIgeFBhdGggPSBmYWN0b3J5Lm5ld1hQYXRoKCk7CiAgICAgICAgdmFyIFhQYXRoQ29uc3RhbnRzID0gIFBhY2thZ2VzLmphdmF4LnhtbC54cGF0aC5YUGF0aENvbnN0YW50czsKICAgICAgICAKICAgICAgICAvLyBtYXAgeHBhdGggZnVuY3Rpb25zIHRvIHJldHVybiB0eXBlCiAgICAgICAgdmFyIHJldHVyblR5cGVzID0gewogICAgICAgICAgICAiYm9vbGVhbiI6IFhQYXRoQ29uc3RhbnRzLkJPT0xFQU4sCiAgICAgICAgICAgICJub3QiOiBYUGF0aENvbnN0YW50cy5CT09MRUFOLAogICAgICAgICAgICAidHJ1ZSI6IFhQYXRoQ29uc3RhbnRzLkJPT0xFQU4sCiAgICAgICAgICAgICJmYWxzZSI6IFhQYXRoQ29uc3RhbnRzLkJPT0xFQU4sCiAgICAgICAgICAgICJib29sZWFuLWZyb20tc3RyaW5nIjogWFBhdGhDb25zdGFudHMuQk9PTEVBTiwKICAgICAgICAgICAgImlmIjogWFBhdGhDb25zdGFudHMuQk9PTEVBTiwKICAgICAgICAgICAgCiAgICAgICAgICAgICJzdHJpbmciOiBYUGF0aENvbnN0YW50cy5TVFJJTkcsCiAgICAgICAgICAgICJjb25jYXQiOiBYUGF0aENvbnN0YW50cy5TVFJJTkcsCiAgICAgICAgICAgICJzdGFydHMtd2l0aCI6IFhQYXRoQ29uc3RhbnRzLlNUUklORywKICAgICAgICAgICAgImNvbnRhaW5zIjogWFBhdGhDb25zdGFudHMuU1RSSU5HLAogICAgICAgICAgICAic3Vic3RyaW5nLWJlZm9yZSI6IFhQYXRoQ29uc3RhbnRzLlNUUklORywKICAgICAgICAgICAgInN1YnN0cmluZy1hZnRlciI6IFhQYXRoQ29uc3RhbnRzLlNUUklORywKICAgICAgICAgICAgInN1YnN0cmluZyI6IFhQYXRoQ29uc3RhbnRzLlNUUklORywKICAgICAgICAgICAgIm5vcm1hbGl6ZS1zcGFjZSI6IFhQYXRoQ29uc3RhbnRzLlNUUklORywKICAgICAgICAgICAgInRyYW5zbGF0ZSI6IFhQYXRoQ29uc3RhbnRzLlNUUklORywKICAgICAgICAgICAgImxvd2VyLWNhc2UiOiBYUGF0aENvbnN0YW50cy5TVFJJTkcsCiAgICAgICAgICAgICJ1cHBlci1jYXNlIjogWFBhdGhDb25zdGFudHMuU1RSSU5HLAogICAgICAgICAgICAiZW5kcy13aXRoIjogWFBhdGhDb25zdGFudHMuU1RSSU5HLAogICAgICAgICAgICAibG9jYWwtbmFtZSI6IFhQYXRoQ29uc3RhbnRzLlNUUklORywKICAgICAgICAgICAgIm5hbWVzcGFjZS11cmkiOiBYUGF0aENvbnN0YW50cy5TVFJJTkcsCiAgICAgICAgICAgICJuYW1lIjogWFBhdGhDb25zdGFudHMuU1RSSU5HLAogICAgICAgICAgICAKICAgICAgICAgICAgImNvdW50IjogWFBhdGhDb25zdGFudHMuTlVNQkVSLAogICAgICAgICAgICAic3RyaW5nLWxlbmd0aCI6IFhQYXRoQ29uc3RhbnRzLk5VTUJFUiwKICAgICAgICAgICAgImxhc3QiOiBYUGF0aENvbnN0YW50cy5OVU1CRVIsCiAgICAgICAgICAgICJwb3NpdGlvbiI6IFhQYXRoQ29uc3RhbnRzLk5VTUJFUiwKICAgICAgICAgICAgInN1bSI6IFhQYXRoQ29uc3RhbnRzLk5VTUJFUiwKICAgICAgICAgICAgImZsb29yIjogWFBhdGhDb25zdGFudHMuTlVNQkVSLAogICAgICAgICAgICAiY2VpbGluZyI6IFhQYXRoQ29uc3RhbnRzLk5VTUJFUiwKICAgICAgICAgICAgInJvdW5kIjogWFBhdGhDb25zdGFudHMuTlVNQkVSLAogICAgICAgICAgICAiYXZnIjogWFBhdGhDb25zdGFudHMuTlVNQkVSLAogICAgICAgICAgICAibWluIjogWFBhdGhDb25zdGFudHMuTlVNQkVSLAogICAgICAgICAgICAibWF4IjogWFBhdGhDb25zdGFudHMuTlVNQkVSLAogICAgICAgICAgICAiY291bnQtbm90LWVtcHR5IjogWFBhdGhDb25zdGFudHMuTlVNQkVSLAogICAgICAgICAgICAKICAgICAgICAgICAgImlkIjogWFBhdGhDb25zdGFudHMuTk9ERVNFVCwKICAgICAgICAgICAgImV2YWx1YXRlIjogWFBhdGhDb25zdGFudHMuTk9ERVNFVCwKICAgICAgICAgICAgIm1hdGNoIjogWFBhdGhDb25zdGFudHMuTk9ERVNFVCwKICAgICAgICAgICAgImluc3RhbmNlIjogWFBhdGhDb25zdGFudHMuTk9ERVNFVAogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgdmFyIGNvbnRleHQgPSB7CiAgICAgICAgICAgIGdldE5hbWVzcGFjZVVSSTogZnVuY3Rpb24oIHByZWZpeCApIHsgCgogICAgICAgICAgICAgICAgaWYoICFwcmVmaXggKSB7IAogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oIk51bGwgcHJlZml4Iik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyIHVyaSA9IFhtbE5hbWVzcGFjZXMubmFtZXNwYWNlTWFwWyBwcmVmaXggXTsKICAgICAgICAgICAgICAgIGlmKCAhdXJpICkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB1cmk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHhQYXRoLnNldE5hbWVzcGFjZUNvbnRleHQoIG5ldyBQYWNrYWdlcy5qYXZheC54bWwubmFtZXNwYWNlLk5hbWVzcGFjZUNvbnRleHQoIGNvbnRleHQgKSApOwogICAgICAgIAogICAgICAgIAogICAgICAgIHRoYXQuZ2V0UmV0dXJuVHlwZSA9IGZ1bmN0aW9uICggeHBhdGggKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICB2YXIgb3BlcmF0aW9uID0geHBhdGgubWF0Y2goIC8oXlx3Kylccz9cKC8gKTsKICAgICAgICAgICAgaWYoIG9wZXJhdGlvbiApIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5UeXBlc1sgb3BlcmF0aW9uWzFdIF07CiAgICAgICAgICAgIH0KCiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRoYXQuc2VsZWN0SW1wbCA9IGZ1bmN0aW9uICggeHBhdGgsIHhtbE5vZGUsIHNpbmdsZSApIHsKICAgICAgICAgICAgdmFyIHJlc3VsdDsKICAgICAgICAgICAgdmFyIHJldHVyblR5cGUgPSBYUGF0aENvbnN0YW50cy5OT0RFU0VUOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRGVyaXZlIHRoZSByZXR1cm4gdHlwZSBmcm9tIHhwYXRoIHF1ZXJ5LiAKICAgICAgICAgICAgLy8gSmF2YSdzIFhQYXRoIGV2YWx1YXRlIG1ldGhvZCByZXF1aXJlcyBhIHJldHVybiB0eXBlIGFyZ3VtZW50ICh1bmxlc3MgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gaXMgd2FudGVkKS4KICAgICAgICAgICAgLy8gSGVuY2UgdGhlIHhwYXRoIHF1ZXJ5IGlzIGNoZWNrZWQsIHRvIHNlZSBpZiBhbiBYUGF0aCBmdW5jdGlvbiBpcyB3cmFwcGluZyB0aGUgbm9kZSBzZWxlY3Rpb24uCiAgICAgICAgICAgIC8vIEZ4ICdjb3VudCgvL2NoaWxkKScgcmV0dXJucyBhIFhQYXRoQ29uc3RhbnRzLk5VTUJFUgogICAgICAgICAgICB2YXIgZnVuY1N0ciA9IHhwYXRoLm1hdGNoKCAvXlxzKihcdyspXHMqXCgvICk7CiAgICAgICAgICAgIGlmKCBmdW5jU3RyICkgewogICAgICAgICAgICAgICAgLy8gTG9nLnRyYWNlKCJYUGF0aCBmdW5jdGlvbiB3cmFwcyBub2RlIHNlbGVjdGlvbi4gZnVuY3Rpb246JyIsIGZ1bmNTdHJbMV0sICInLCBYUGF0aCBxdWVyeTogJyIsIHhwYXRoLCAiJyIpOwogICAgICAgICAgICAgICAgcmV0dXJuVHlwZSA9IHJldHVyblR5cGVzWyBmdW5jU3RyWzFdIF0gfHwgWFBhdGhDb25zdGFudHMuTk9ERVNFVDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiggc2luZ2xlID09PSB0cnVlICYmIHJldHVyblR5cGUgPT09IFhQYXRoQ29uc3RhbnRzLk5PREVTRVQgKSB7CiAgICAgICAgICAgICAgICByZXR1cm5UeXBlID0gWFBhdGhDb25zdGFudHMuTk9ERTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBMb2cudHJhY2UoIlhQYXRoIHJldHVybiB0eXBlOiAnIiwgcmV0dXJuVHlwZSwgIicsIFhQYXRoIHF1ZXJ5OiAnIiwgeHBhdGgsICInIik7CgogICAgICAgICAgICAvLyBUT0RPOiBDYWNoZSBjb21waWxlZCB4cGF0aD8KICAgICAgICAgICAgcmVzdWx0ID0geFBhdGguY29tcGlsZSggeHBhdGggKS5ldmFsdWF0ZSggeG1sTm9kZSwgcmV0dXJuVHlwZSApOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYoIHJldHVyblR5cGUgPT09ICBYUGF0aENvbnN0YW50cy5OT0RFU0VUICkgewogICAgICAgICAgICAgICAgdmFyIG5vZGVzID0gW107CiAgICAgICAgICAgICAgICBmb3IoIHZhciBpID0gMDsgaSA8IHJlc3VsdC5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgICAgICAgICBub2Rlcy5wdXNoKCByZXN1bHQuaXRlbSggaSApICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXN1bHQgPSBub2RlczsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0ID09PSBudWxsID8gdW5kZWZpbmVkIDogcmVzdWx0OwogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9OwogICAgfQoKICAgIHRoYXQuX190aHJvd0Vycm9yID0gZnVuY3Rpb24oZXJyb3IpIHsKICAgICAgICBMb2cuZXJyb3IoZXJyb3IpOwogICAgICAgIHRocm93IEVycm9yKGVycm9yKTsKICAgIH07CgogICAgLy8gTXVzdCBiZSBkdXBsaWNhdGVkIGhlcmUgdG8gYXZvaWQgY3ljbGljIGRlcGVuZGVuY2llcwogICAgdGhhdC5fX2lzWG1sID0gZnVuY3Rpb24ocG9zaWJsZVhtbCkgewogICAgICAgIHJldHVybiBwb3NpYmxlWG1sLm5vZGVUeXBlICE9PSB1bmRlZmluZWQgJiYgKHR5cGVvZiBwb3NpYmxlWG1sLm5vZGVUeXBlKSA9PT0gIm51bWJlciI7CiAgICB9OwogICAgCiAgICAvKioKICAgICAqIFhQYXRoIHNlbGVjdG9yIGZ1bmN0aW9uIHdpdGggc3VwcG9ydCBmb3IgYWxsIGN1cnJlbnRseSBrbm93biBuYW1lc3BhY2VzLgogICAgICoKICAgICAqIFNlbGVjdCBub2RlcyBpbiB0aGUgeG1sIGRvY3VtZW50IGJhc2VkIG9uIFhQYXRoIGV4cHJlc3Npb24uCiAgICAgKgogICAgICogU2VlIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMDAvUkVDLURPTS1MZXZlbC0yLUNvcmUtMjAwMDExMTMvY29yZS5odG1sI0lELTE5NTA2NDEyNDcKICAgICAqIGZvciBub2RlIGFuZCBzdWJjbGFzc2VzIGludGVyZmFjZQogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhQYXRoLnNlbGVjdAogICAgICogQHN5bnRheCBYUGF0aC5zZWxlY3QoeHBhdGgsIHhtbE5vZGUpCiAgICAgKiBAcGFyYW0ge3N0cmluZ30geHBhdGggZXhwcmVzc2lvbiB0byBzZWxlY3QKICAgICAqIEBwYXJhbSB7Tm9kZX0geG1sTm9kZSBkb2N1bWVudCB0byBzZWxlY3QgaW4KICAgICAqIEBwYXJhbSB7Ym9vbGVhbnx1bmRlZmluZWR9IHNpbmdsZSBSZXR1cm4gYSBzaW5nbGUgbm9kZSBpbiBzdGVhZCBvZiBhbiBhcnJheSBvZiBub2RlcyAob3B0aW9uYWwpCiAgICAgKiBAcmV0dXJuIHtOb2RlW119IG5vZGVzIG1hdGNoaW5nIGV4cHJlc3Npb24uIEVtcHR5IGlmIG5vdGhpbmcgbWF0Y2hlcwogICAgICogQGV4YW1wbGUKICAgICAqIHZhciBub2RlcyA9IFhQYXRoLnNlbGVjdCgiL3Jvb3QvY2hpbGQiLCBkb2MpCiAgICAgKiBAZXhhbXBsZQogICAgICogdmFyIHRleHQgPSBYUGF0aC5zZWxlY3QoIi9yb290L2NoaWxkWzFdL3RleHQoKSIsIGRvYywgdHJ1ZSkubm9kZVZhbHVlCiAgICAgKi8KICAgIHRoYXQuc2VsZWN0ID0gZnVuY3Rpb24oeHBhdGgsIHhtbE5vZGUsIHNpbmdsZSl7CiAgICAgICAgLy8gTG9nLnRyYWNlKCJFbnRlcmluZyBYUGF0aC5zZWxlY3QsIHhwYXRoOiciLCB4cGF0aCwgIiciKTsKLy8gICAgICAgIExvZy50cmFjZSgiRW50ZXJpbmcgWFBhdGguc2VsZWN0LCB4cGF0aDonIiwgeHBhdGgsICInLCBmcm9tICIsIHhtbE5vZGUpOwovLyAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHhwYXRoID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHZhciBtc2cgPSAiWFBhdGguc2VsZWN0OiB4cGF0aCBhcmd1bWVudCBtaXNzaW5nIjsKICAgICAgICAgICAgICAgIExvZy5lcnJvcihtc2cpOwogICAgICAgICAgICAgICAgdGhhdC5fX3Rocm93RXJyb3IobXNnKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgaWYgKHhtbE5vZGUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgdmFyIG1zZyA9ICJYUGF0aC5zZWxlY3Q6IHhtbE5vZGUgYXJndW1lbnQgbWlzc2luZyI7CiAgICAgICAgICAgICAgICBMb2cuZXJyb3IobXNnKTsKICAgICAgICAgICAgICAgIHRoYXQuX190aHJvd0Vycm9yKG1zZyk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBpZiAoISB0aGF0Ll9faXNYbWwoeG1sTm9kZSkgKSB7CiAgICAgICAgICAgICAgICB2YXIgbXNnID0gIlhQYXRoLnNlbGVjdDogeG1sTm9kZSBpcyBub3QgYW4gWE1MRE9NIG5vZGU6ICIgKyBVdGlsLmdldFR5cGUoeG1sTm9kZSk7CiAgICAgICAgICAgICAgICBMb2cuZXJyb3IobXNnKTsKICAgICAgICAgICAgICAgIHRoYXQuX190aHJvd0Vycm9yKG1zZyk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gdGhhdC5zZWxlY3RJbXBsKHhwYXRoLCB4bWxOb2RlLCBzaW5nbGUpOwovLyAgICAgICAgICAgICAgICBMb2cudHJhY2UoIlhQYXRoLnNlbGVjdCwgcmV0dXJuaW5nICIsIChyZXN1bHQpID8gcmVzdWx0IDogIi0tbm90aGluZy0tIik7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgTG9nLmVycm9yKCJYUGF0aC5zZWxlY3QsIENhdWdodCBleGNlcHRpb24gd2hpbGUgc2VsZWN0aW5nICciLCB4cGF0aCwgIicgZnJvbSAiLCBYbWxVdGlsLmxvZ1htbFN0cmluZyh4bWxOb2RlKSwgIi4gRXJyb3IgaXMgIiwgZXJyb3IpOwogICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7CiAgICAgICAgICAgIH0KLy8gICAgICAgIH0gZmluYWxseSB7Ci8vICAgICAgICAgICAgTG9nLnRyYWNlKCJMZWF2aW5nIFhQYXRoLnNlbGVjdCIpOwovLyAgICAgICAgfQogICAgfTsKICAgIAogICAgLyoqCiAgICAgKiBTZWxlY3QgdGhlIGZpcnN0IG5vZGUgdGhhdCBtYXRjaGVzIHRoZSBzcGVjaWZpZWQgeHBhdGguCiAgICAgKgogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgWFBhdGguc2VsZWN0Tm9kZQogICAgICogQHN5bnRheCBYUGF0aC5zZWxlY3ROb2RlKHhwYXRoLCB4bWxOb2RlKQogICAgICogQHBhcmFtIHtzdHJpbmd9IHhwYXRoIGV4cHJlc3Npb24gdG8gbWF0Y2gKICAgICAqIEBwYXJhbSB7Tm9kZX0geG1sTm9kZSBEb2N1bWVudCB0byBtYXRjaCB4cGF0aCBpbgogICAgICogQHJldHVybiB7Tm9kZXx1bmRlZmluZWR9IFRoZSBmaXJzdCBub2RlIHRoYXQgbWF0Y2hlcyB0aGUgcGF0aCBvciB1bmRlZmluZWQgaWYgbm8gbm9kZSBtYXRjaGVzCiAgICAgKiBAZXhhbXBsZQogICAgICogWFBhdGguc2VsZWN0Tm9kZSgiL3Jvb3QvY2hpbGQiLCBkb2MpCiAgICAqLwogICAgdGhhdC5zZWxlY3ROb2RlID0gZnVuY3Rpb24oeHBhdGgsIHhtbE5vZGUpewovLyAgICAgICAgTG9nLnRyYWNlKCJFbnRlcmluZyBYUGF0aC5zZWxlY3ROb2RlIik7Ci8vICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgbm9kZSA9IHRoYXQuc2VsZWN0KHhwYXRoLCB4bWxOb2RlLCB0cnVlKTsKICAgICAgICAgICAgLy8gaWYgKG5vZGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAvLyAgICAgTG9nLnRyYWNlKCJYUGF0aC5zZWxlY3ROb2RlLCBub2RlOiAnIiwgbm9kZS5ub2RlTmFtZSwgIiciKTsKICAgICAgICAgICAgLy8gfQogICAgICAgICAgICByZXR1cm4gbm9kZTsKLy8gICAgICAgIH0gZmluYWxseSB7Ci8vICAgICAgICAgICAgTG9nLnRyYWNlKCJMZWF2aW5nIFhQYXRoLnNlbGVjdE5vZGUiKTsKLy8gICAgICAgIH0KICAgIH07CiAgICAKICAgICAvKioKICAgICAqIFNlbGVjdCB0ZXh0IGNvbnRlbnQgZnJvbSB0aGUgZmlyc3Qgbm9kZSB0aGF0IG1hdGNoZXMgdGhlIHNwZWNpZmllZCBYUGF0aAogICAgICoKICAgICAqICoqTk9URToqKiBOb2RlcyBzZWxlY3RlZCBieSB4cGF0aCBhcmUgbm90IHJldHVybmVkIGluIGFueSBwYXJ0aWN1bGFyIG9yZGVyLgogICAgICogVGhlIG9yZGVyIG9mIGZvdW5kIG5vZGVzIG1heSBub3QgYmUgdGhlIG9yZGVyIHRoZXkgYXBwZWFyIGluIHRoZSBkb2N1bWVudC4KICAgICAqIFRvIHNwZWNpZnkgYSBwYXJ0aWN1bGFyIG5vZGUgaW4gdGhlIGRvY3VtZW50IG9yZGVyIHVzZSBlLmcuIFsxXSBpbiB0aGUgeHBhdGggZXhwcmVzc2lvbgogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhQYXRoLnNlbGVjdFRleHQKICAgICAqIEBzeW50YXggWFBhdGguc2VsZWN0VGV4dCh4cGF0aCwgeG1sTm9kZSkKICAgICAqIEBwYXJhbSB7c3RyaW5nfSB4cGF0aCBleHByZXNzaW9uIHRvIG1hdGNoCiAgICAgKiBAcGFyYW0ge05vZGV9IHhtbE5vZGUgRG9jdW1lbnQgdG8gbWF0Y2ggeHBhdGggaW4KICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IGNvbnRlbnQgb2YgZmlyc3Qgc3RyaW5nIG5vZGUgb3IgIiIgaWYgbm8gbm9kZSBvciB0ZXh0IGZvdW5kCiAgICAgKiBAZXhhbXBsZQogICAgICogWFBhdGguc2VsZWN0VGV4dCgiL3Jvb3QvY2hpbGQiLCBkb2MpCiAgICAgKi8KICAgIHRoYXQuc2VsZWN0VGV4dCA9IGZ1bmN0aW9uKHhwYXRoLCB4bWxOb2RlKXsKLy8gICAgICAgIExvZy50cmFjZSgiRW50ZXJpbmcgWFBhdGguc2VsZWN0VGV4dCIpOwovLyAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gQXBwZW5kIC90ZXh0KCkgaWYgbmVjZXNzYXJ5CiAgICAgICAgICAgIHZhciBub2RlID0gdGhhdC5zZWxlY3ROb2RlKHhwYXRoLCB4bWxOb2RlKTsKCiAgICAgICAgICAgIHZhciB0ZXh0ID0gIiI7CiAgICAgICAgICAgIGlmIChub2RlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIExvZy5kZWJ1ZygiTm8gbm9kZSBtYXRjaGluZyAnIiwgeHBhdGgsICInIGZvdW5kIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAobm9kZS5ub2RlVHlwZSA9PT0gTm9kZVR5cGVzLlRFWFRfTk9ERSB8fCBub2RlLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuQ0RBVEFfU0VDVElPTl9OT0RFKSB7CiAgICAgICAgICAgICAgICB0ZXh0ID0gbm9kZS5ub2RlVmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAobm9kZS5maXJzdENoaWxkICYmIChub2RlLmZpcnN0Q2hpbGQubm9kZVR5cGUgPT09IE5vZGVUeXBlcy5URVhUX05PREUgfHwgbm9kZS5maXJzdENoaWxkLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuQ0RBVEFfU0VDVElPTl9OT0RFICkgKSB7CiAgICAgICAgICAgICAgICB0ZXh0ID0gbm9kZS5maXJzdENoaWxkLm5vZGVWYWx1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIExvZy5kZWJ1ZygiTm9kZSBpcyBub3QgYSB0ZXh0IG5vZGUgYW5kIGhhcyBubyB0ZXh0IG5vZGUgY2hpbGQiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBMb2cudHJhY2UoIlhQYXRoLnNlbGVjdFRleHQsIHJldHVybmluZzogJyIsIHRleHQsICInIik7CiAgICAgICAgICAgIHJldHVybiB0ZXh0OwovLyAgICAgICAgfSBmaW5hbGx5IHsKLy8gICAgICAgICAgICBMb2cudHJhY2UoIkxlYXZpbmcgWFBhdGguc2VsZWN0VGV4dCIpOwovLyAgICAgICAgfQogICAgfTsKICAgIAogICAgLyoqCiAgICAgKiBTZWxlY3QgdGV4dCBjb250ZW50IGZyb20gdGhlIG11bHRpcGxlIG5vZGVzIHRoYXQgbWF0Y2hlcyB0aGUgc3BlY2lmaWVkIFhQYXRoCiAgICAgKgogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgWFBhdGguc2VsZWN0TXVsdGlwbGVUZXh0CiAgICAgKiBAc3ludGF4IFhQYXRoLnNlbGVjdE11bHRpcGxlVGV4dCh4cGF0aCwgeG1sTm9kZSkKICAgICAqIEBwYXJhbSB7c3RyaW5nfSB4cGF0aCBleHByZXNzaW9uIHRvIG1hdGNoCiAgICAgKiBAcGFyYW0ge05vZGV9IHhtbE5vZGUgRG9jdW1lbnQgdG8gbWF0Y2ggeHBhdGggaW4KICAgICAqIEByZXR1cm5zIHtTdHJpbmdbXX0gY29udGVudHMgIHN0cmluZyBub2Rlcy4gRW1wdHkgaWYgbm8gbm9kZXMgbWF0Y2gKICAgICAqIEBleGFtcGxlCiAgICAgKiBYUGF0aC5zZWxlY3RNdWx0aXBsZVRleHQoIi9yb290L2NoaWxkIiwgZG9jKQogICAgICovCiAgICB0aGF0LnNlbGVjdE11bHRpcGxlVGV4dCA9IGZ1bmN0aW9uKHhwYXRoLCB4bWxOb2RlKXsKLy8gICAgICAgIExvZy50cmFjZSgiRW50ZXJpbmcgWFBhdGguc2VsZWN0TXVsdGlwbGVUZXh0Iik7Ci8vICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gW107CiAgICAgICAgICAgIHRoYXQuZm9yRWFjaE5vZGVUZXh0KHhwYXRoLCB4bWxOb2RlLCBmdW5jdGlvbih0ZXh0KSB7CiAgICAgICAgICAgICAgICAvLyBMb2cudHJhY2UoIlhQYXRoLnNlbGVjdE11bHRpcGxlVGV4dCwgYWRkaW5nIHRleHQ6ICciLCB0ZXh0LCAiJyIpOwogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGV4dCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwovLyAgICAgICAgfSBmaW5hbGx5IHsKLy8gICAgICAgICAgICBMb2cudHJhY2UoIkxlYXZpbmcgWFBhdGguc2VsZWN0TXVsdGlwbGVUZXh0Iik7Ci8vICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAgICogSXRlcmF0ZSBvdmVyIHRleHQgbm9kZXMgYW5kIGNhbGwgYSBmdW5jdGlvbiBmb3IgZWFjaCBmb3VuZCB2YWx1ZQogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhQYXRoLmZvckVhY2hOb2RlVGV4dAogICAgICogQHN5bnRheCBYUGF0aC5mb3JFYWNoTm9kZVRleHQoeHBhdGgsIHhtbE5vZGUsIGZuKQogICAgICogQHBhcmFtIHtzdHJpbmd9IHhwYXRoIGV4cHJlc3Npb24gdG8gbWF0Y2gKICAgICAqIEBwYXJhbSB7Tm9kZX0geG1sTm9kZSBEb2N1bWVudCB0byBtYXRjaCB4cGF0aCBpbgogICAgICogQHBhcmFtIHtmdW5jdGlvbn0gZm4gRnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCBmb3IgZWFjaCB0ZXh0IHN0cmluZwogICAgICogQGV4YW1wbGUKICAgICAqIFhQYXRoLmZvckVhY2hOb2RlVGV4dCgiL3Jvb3QvY2hpbGQiLCBkb2MsIGZ1bmN0aW9uKHRleHQpIHsgcHJpbnRuKHRleHQpIH0gKTsKICAgICAqLwogICAgdGhhdC5mb3JFYWNoTm9kZVRleHQgPSBmdW5jdGlvbih4cGF0aCwgeG1sTm9kZSwgZm4pewovLyAgICAgICAgTG9nLnRyYWNlKCJFbnRlcmluZyBYUGF0aC5mb3JFYWNoTm9kZVRleHQiKTsKLy8gICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIEFwcGVuZCAvdGV4dCgpIGlmIG5lY2Vzc2FyeQovLyAgICAgICAgICAgIGlmICgheHBhdGgubWF0Y2goL1wvdGV4dFwoXCkkLykpIHsKLy8gICAgICAgICAgICAgICAgeHBhdGggKz0gIi90ZXh0KCkiOwovLyAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG5vZGVzID0gdGhhdC5zZWxlY3QoeHBhdGgsIHhtbE5vZGUpOwogICAgICAgICAgICBub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgICAgICAgICAgIGlmICggbm9kZS5ub2RlVHlwZSA9PT0gTm9kZVR5cGVzLlRFWFRfTk9ERSB8fCBub2RlLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuQ0RBVEFfU0VDVElPTl9OT0RFICkgewogICAgICAgICAgICAgICAgICAgIGZuKCBub2RlLm5vZGVWYWx1ZSApOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICggbm9kZS5jaGlsZE5vZGVzICkgewogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwIDsgaSA8IG5vZGUuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGQgPSBub2RlLmNoaWxkTm9kZXMuaXRlbShpKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuVEVYVF9OT0RFIHx8IGNoaWxkLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuQ0RBVEFfU0VDVElPTl9OT0RFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbiggY2hpbGQubm9kZVZhbHVlICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwovLyAgICAgICAgfSBmaW5hbGx5IHsKLy8gICAgICAgICAgICBMb2cudHJhY2UoIkxlYXZpbmcgWFBhdGguZm9yRWFjaE5vZGVUZXh0Iik7Ci8vICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAgICogU2VsZWN0IHRoZSBmaXJzdCBhdHRyaWJ1dGUgdGhhdCBtYXRjaGVzIHRoZSBzcGVjaWZpZWQgWFBhdGgKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYUGF0aC5zZWxlY3RBdHRyaWJ1dGUKICAgICAqIEBzeW50YXggWFBhdGguc2VsZWN0QXR0cmlidXRlKHhwYXRoLCB4bWxOb2RlKQogICAgICogQHBhcmFtIHtzdHJpbmd9IHhwYXRoIGV4cHJlc3Npb24gdG8gbWF0Y2gKICAgICAqIEBwYXJhbSB7Tm9kZX0geG1sTm9kZSBEb2N1bWVudCB0byBtYXRjaCB4cGF0aCBpbgogICAgICogQHJldHVybnMge1N0cmluZ3x1bmRlZmluZWR9IGNvbnRlbnQgb2YgZmlyc3QgbWF0Y2hpbmcgYXR0cmlidXRlIG9yIHVuZGVmaW5lZCBpZiBubyBhdHRyaWJ1dGUgZm91bmQKICAgICAqIEBleGFtcGxlCiAgICAgKiBYUGF0aC5zZWxlY3RBdHRyaWJ1dGUoIi9yb290L2NoaWxkL0BhdHRyaWJ1dGUiLCBkb2MpCiAgICAgKi8KICAgIHRoYXQuc2VsZWN0QXR0cmlidXRlID0gZnVuY3Rpb24oeHBhdGgsIHhtbE5vZGUpewovLyAgICAgICAgTG9nLnRyYWNlKCJFbnRlcmluZyBYUGF0aC5zZWxlY3RBdHRyaWJ1dGUiKTsKLy8gICAgICAgIHRyeSB7CiAgICAgICAgICAgIHZhciBub2RlID0gdGhhdC5zZWxlY3ROb2RlKHhwYXRoLCB4bWxOb2RlKTsKICAgICAgICAgICAgaWYgKG5vZGUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChub2RlLm5vZGVUeXBlICE9PSBOb2RlVHlwZXMuQVRUUklCVVRFX05PREUpIHsKICAgICAgICAgICAgICAgIExvZy5lcnJvcigiWFBhdGguc2VsZWN0QXR0cmlidXRlLCBzZWxlY3RlZCBub2RlIGlzIG5vdCBhbiBhdHRyaWJ1dGUgbm9kZToiLCBYbWxVdGlsLmxvZ1htbFN0cmluZyhub2RlKSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciB2YWx1ZSA9IG5vZGUubm9kZVZhbHVlOwogICAgICAgICAgICAvLyBMb2cudHJhY2UoIlhQYXRoLnNlbGVjdEF0dHJpYnV0ZSwgdmFsdWU6ICciLCB2YWx1ZSwgIiciKTsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwovLyAgICAgICAgfSBmaW5hbGx5IHsKLy8gICAgICAgICAgICBMb2cudHJhY2UoIkxlYXZpbmcgWFBhdGguc2VsZWN0QXR0cmlidXRlIik7Ci8vICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAgICogRGVsZXRlcyBub2RlcyB0aGF0IG1hdGNoIHhwYXRoIGV4cHJlc3Npb24KICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYUGF0aC5kZWxldGUKICAgICAqIEBzeW50YXggWFBhdGguZGVsZXRlKHhwYXRoLCB4bWxOb2RlKQogICAgICogQHBhcmFtIHtzdHJpbmd9IHhwYXRoIGV4cHJlc3Npb24gdG8gbWF0Y2gKICAgICAqIEBwYXJhbSB7Tm9kZX0geG1sTm9kZQogICAgICogQHJldHVybnMKICAgICAqIEBleGFtcGxlCiAgICAgKiB2YXIgeG1sTm9kZSA9IFhtbFV0aWwuZnJvbVN0cmluZygiPHJvb3Q+PGNoaWxkPjwvY2hpbGQ+PG90aGVyPjwvb3RoZXI+PC9yb290PiIpCiAgICAgKiBYUGF0aC5kZWxldGUoIi9yb290LyoiLCB4bWxOb2RlKTsKICAgICAqIHhtbE5vZGUudG9TdHJpbmcoKSAvLyAiPHJvb3QvPiIKICAgICAqLwogICAgdGhhdC5kZWxldGUgPSBmdW5jdGlvbih4cGF0aCwgeG1sTm9kZSl7CiAgICAgICAgdmFyIG5vZGVzID0gdGhhdC5zZWxlY3QoIHhwYXRoLCB4bWxOb2RlICk7CiAgICAgICAgZm9yKCB2YXIgaSA9IDA7IGkgPCBub2Rlcy5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgdmFyIHZhbHVlID0gbm9kZXNbaV07CiAgICAgICAgICAgIHZhciBwYXJlbnQgPSB2YWx1ZS5wYXJlbnROb2RlOwogICAgICAgICAgICAvLyBMb2cudHJhY2UoIlJlbW92aW5nICciLCB2YWx1ZS5ub2RlTmFtZSwgIicgZnJvbSBwYXJlbnQgJyIsIHBhcmVudC5ub2RlTmFtZSwgIiciICk7CiAgICAgICAgICAgIHBhcmVudC5yZW1vdmVDaGlsZCh2YWx1ZSk7CiAgICAgICAgfQogICAgfTsKICAgIAogICAgcmV0dXJuIHRoYXQ7Cn0pKCk7Cgo=", "moduleName": "XPath"}, {"javascript": "LyoqIEBmaWxlIE5hbWVzcGFjZXMgYW5kIG1hcHMgb2YgbmFtZXNwYWNlcyBmb3IgdXNlIHdpdGggWE1MRE9NIGFuZCBYUGF0aCAqLwpFWFBPUlRFRF9TWU1CT0xTID0gWyAnWG1sTmFtZXNwYWNlcycgXTsKCi8qKgogKiBNb2R1bGUgdGhhdCBob2xkcyBhIG51bWJlciBvZiBuYW1lc3BhY2UgZGVjbGFyYXRpb25zLi4KICoKICogVGhpcyBuYW1lc3BhY2UgaG9sZHMgYSBudW1iZXIgb2YgbmFtZXNwYWNlIGRlY2xhcmF0aW9ucyB0aGF0IGFyZSB1c2VkCiAqIGFzIGNvbnN0YW50cyBpbiBwYXJ0cyBvZiB0aGUgY29kZS4KICoKICogQHR5cGUge25hbWVzcGFjZX0KICogQG5hbWVzcGFjZQogKiBAbmFtZSBYbWxOYW1lc3BhY2VzICovCnZhciBYbWxOYW1lc3BhY2VzID0gZnVuY3Rpb24oICkgewoKICAgIHZhciB0aGF0ID0ge307CgogICAgdGhhdC5uYW1lc3BhY2VNYXAgPSB7fTsKICAgIHRoYXQucmV2ZXJzZU5hbWVzcGFjZU1hcCA9IHt9OwoKICAgIHRoYXQuTmFtZXNwYWNlID0gZnVuY3Rpb24gKHByZWZpeCwgdXJpKSB7CiAgICAgICAgdmFyIG5zID0ge307CiAgICAgICAgbnMucHJlZml4ID0gcHJlZml4OwogICAgICAgIG5zLnVyaSA9IHVyaTsKICAgICAgICBucy50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHByZWZpeCArICI9IiArIHVyaSB9OyAvLyBGb3IgbG9nZ2luZwogICAgICAgIHRoYXQubmFtZXNwYWNlTWFwW3ByZWZpeF0gPSB1cmk7CiAgICAgICAgdGhhdC5yZXZlcnNlTmFtZXNwYWNlTWFwW3VyaV0gPSBwcmVmaXg7CiAgICAgICAgcmV0dXJuIG5zOwogICAgfTsKCiAgICAvKiogeG1sbnMgbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGB4bWxuc2AuIFRoZSB1cmkgZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBodHRwOi8vd3d3LnczLm9yZy8yMDAwL3htbG5zL2AuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy54bWxucyAqLwogICAgdGhhdC54bWxucyA9IHRoYXQuTmFtZXNwYWNlKCAieG1sbnMiLCAiaHR0cDovL3d3dy53My5vcmcvMjAwMC94bWxucy8iICk7CiAgICAvKiogdWJmIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgdWJmYC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGh0dHA6Ly93d3cuZGJjLmRrL3ViZmAKICAgICAqCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy51YmYgKi8KICAgIHRoYXQudWJmID0gdGhhdC5OYW1lc3BhY2UoICJ1YmYiLCAiaHR0cDovL3d3dy5kYmMuZGsvdWJmIiApOwogICAgLyoqIG9ycyBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYG9yc2AuIFRoZSB1cmkgZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBodHRwOi8vb3NzLmRiYy5kay9ucy9vcGVucmVzb3VyY2VzaGFyaW5nYC4KICAgICAqCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5vcnMgKi8KICAgIHRoYXQub3JzID0gdGhhdC5OYW1lc3BhY2UoICJvcnMiLCAiaHR0cDovL29zcy5kYmMuZGsvbnMvb3BlbnJlc291cmNlc2hhcmluZyIgKTsKICAgIC8qKiBob2xkaW5ncyBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGhzYC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGh0dHA6Ly9vc3MuZGJjLmRrL25zL2hvbGRpbmdzYC4KICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLmhvbGRpbmdzICovCiAgICB0aGF0LmhvbGRpbmdzID0gdGhhdC5OYW1lc3BhY2UoICJocyIsICJodHRwOi8vb3NzLmRiYy5kay9ucy9ob2xkaW5ncyIgKTsKICAgIC8qKiBpbGw1IG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaWxsNWAuIFRoZSB1cmkgZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGAKICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLmlsbDUgKi8KICAgIHRoYXQuaWxsNSA9IHRoYXQuTmFtZXNwYWNlKCAiaWxsNSIsICJodHRwOi8vd3d3LmxvYy5nb3YvejM5NTAvYWdlbmN5L2RlZm5zL2lsbDUiICk7CiAgICAvKiogemlnaG9sZGluZ3MgbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBuYC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGh0dHA6Ly93d3cubG9jLmdvdi96Mzk1MC9hZ2VuY3kvZGVmbnMvSG9sZGluZ3NTY2hlbWE4YC4KICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLnppZ2hvbGRpbmdzICovCiAgICB0aGF0LnppZ2hvbGRpbmdzID0gdGhhdC5OYW1lc3BhY2UoICJuIiwgImh0dHA6Ly93d3cubG9jLmdvdi96Mzk1MC9hZ2VuY3kvZGVmbnMvSG9sZGluZ3NTY2hlbWE4IiApOwogICAgLyoqIG9wZW5hZ2VuY3kgbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBvYWAuIFRoZSB1cmkgZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBodHRwOi8vb3NzLmRiYy5kay9ucy9vcGVuYWdlbmN5YC4KICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLm9wZW5hZ2VuY3kgKi8KICAgIHRoYXQub3BlbmFnZW5jeSA9IHRoYXQuTmFtZXNwYWNlKCAib2EiLCAiaHR0cDovL29zcy5kYmMuZGsvbnMvb3BlbmFnZW5jeSIgKTsKICAgIC8qKiB0aW5nIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgdGluZ2AuIFRoZSB1cmkgZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBodHRwOi8vd3d3LmRiYy5kay90aW5nYC4KICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLnRpbmcgKi8KICAgIHRoYXQudGluZyA9IHRoYXQuTmFtZXNwYWNlKCAidGluZyIsICJodHRwOi8vd3d3LmRiYy5kay90aW5nIiApOwogICAgLyoqIGVzIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgZXNgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL29zcy5kYmMuZGsvbnMvZXNgLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMuZXMgKi8KICAgIHRoYXQuZXMgPSB0aGF0Lk5hbWVzcGFjZSggImVzIiwgImh0dHA6Ly9vc3MuZGJjLmRrL25zL2VzIiApOwogICAgLyoqIGRrYWJtIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgZGthYm1gLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL2JpYmxzdGFuZGFyZC5kay9hYm0vbmFtZXNwYWNlL2RrYWJtL2AuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5ka2FibSAqLwogICAgdGhhdC5ka2FibSA9IHRoYXQuTmFtZXNwYWNlKCAiZGthYm0iLCAiaHR0cDovL2JpYmxzdGFuZGFyZC5kay9hYm0vbmFtZXNwYWNlL2RrYWJtLyIgKTsKICAgIC8qKiBhYyBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGFjYC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGh0dHA6Ly9iaWJsc3RhbmRhcmQuZGsvYWMvbmFtZXNwYWNlL2AuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5hYyAqLwogICAgdGhhdC5hYyA9IHRoYXQuTmFtZXNwYWNlKCAiYWMiLCAiaHR0cDovL2JpYmxzdGFuZGFyZC5kay9hYy9uYW1lc3BhY2UvIiApOwogICAgLyoqIGRrZGNwbHVzIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgZGtkY3BsdXNgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL2JpYmxzdGFuZGFyZC5kay9hYm0vbmFtZXNwYWNlL2RrZGNwbHVzL2AuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5ka2RjcGx1cyAqLwogICAgdGhhdC5ka2RjcGx1cyA9IHRoYXQuTmFtZXNwYWNlKCAiZGtkY3BsdXMiLCAiaHR0cDovL2JpYmxzdGFuZGFyZC5kay9hYm0vbmFtZXNwYWNlL2RrZGNwbHVzLyIgKTsKICAgIC8qKiBvc3MgbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBvc3NgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL29zcy5kYmMuZGsvbnMvb3NzdHlwZXNgLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMub3NzICovCiAgICB0aGF0Lm9zcyA9IHRoYXQuTmFtZXNwYWNlKCAib3NzIiwgImh0dHA6Ly9vc3MuZGJjLmRrL25zL29zc3R5cGVzIiApOwogICAgLyoqIGRjIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgZGNgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS9gLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMuZGMgKi8KICAgIHRoYXQuZGMgPSB0aGF0Lk5hbWVzcGFjZSggImRjIiwgImh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiApOwogICAgLyoqIG9haSBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYG9haWAuIFRoZSB1cmkgZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBodHRwOi8vd3d3Lm9wZW5hcmNoaXZlcy5vcmcvT0FJLzIuMC9gLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMub2FpICovCiAgICB0aGF0Lm9haSA9IHRoYXQuTmFtZXNwYWNlKCAib2FpIiwgImh0dHA6Ly93d3cub3BlbmFyY2hpdmVzLm9yZy9PQUkvMi4wLyIgKTsKCiAgICAvKiogb2FpX2RjIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgb2FpX2RjYC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGh0dHA6Ly93d3cub3BlbmFyY2hpdmVzLm9yZy9PQUkvMi4wL29haV9kYy9gLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMub2FpX2RjICovCiAgICB0aGF0Lm9haV9kYyA9IHRoYXQuTmFtZXNwYWNlKCAib2FpX2RjIiwgImh0dHA6Ly93d3cub3BlbmFyY2hpdmVzLm9yZy9PQUkvMi4wL29haV9kYy8iICk7CiAgICAvKiogZGN0ZXJtcyBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGRjdGVybXNgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL3B1cmwub3JnL2RjL3Rlcm1zL2AuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5kY3Rlcm1zICovCiAgICB0aGF0LmRjdGVybXMgPSB0aGF0Lk5hbWVzcGFjZSggImRjdGVybXMiLCAiaHR0cDovL3B1cmwub3JnL2RjL3Rlcm1zLyIgKTsKICAgIC8qKiB4c2kgbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGB4c2lgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VgLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMueHNpICovCiAgICB0aGF0LnhzaSA9IHRoYXQuTmFtZXNwYWNlKCAieHNpIiwgImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiApOwogICAgLyoqIG1hcmN4IG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgbWFyY3hgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaW5mbzpsYy94bWxucy9tYXJjeGNoYW5nZS12MWAuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5tYXJjeCAqLwogICAgdGhhdC5tYXJjeCA9IHRoYXQuTmFtZXNwYWNlKCAibWFyY3giLCAiaW5mbzpsYy94bWxucy9tYXJjeGNoYW5nZS12MSIgKTsKICAgIC8qKiBteCBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYG14YC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGh0dHA6Ly93d3cubG9jLmdvdi9NQVJDMjEvc2xpbWAuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5teCAqLwogICAgdGhhdC5teCA9IHRoYXQuTmFtZXNwYWNlKCAibXgiLCAiaHR0cDovL3d3dy5sb2MuZ292L01BUkMyMS9zbGltIiApOwogICAgLyoqIGRvY2Jvb2sgbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBkb2Nib29rYC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGh0dHA6Ly9kb2Nib29rLm9yZy9ucy9kb2Nib29rYC4KICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLmRvY2Jvb2sgKi8KICAgIHRoYXQuZG9jYm9vayA9IHRoYXQuTmFtZXNwYWNlKCAiZG9jYm9vayIsICJodHRwOi8vZG9jYm9vay5vcmcvbnMvZG9jYm9vayIgKTsKICAgIC8qKiBvc28gbmFtZXNwYWNlLgogICAgICoKIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBvc29gLiAgICAgKiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL29zcy5kYmMuZGsvbnMvb3BlbnNlYXJjaG9iamVjdHNgLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMub3NvICovCiAgICB0aGF0Lm9zbyA9IHRoYXQuTmFtZXNwYWNlKCAib3NvIiwgImh0dHA6Ly9vc3MuZGJjLmRrL25zL29wZW5zZWFyY2hvYmplY3RzIiApOwogICAgLyoqIHhzZCBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYHhzZGAuIFRoZSB1cmkgZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSNgLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMueHNkICovCiAgICB0aGF0LnhzZCA9IHRoYXQuTmFtZXNwYWNlKCAieHNkIiwgImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIyIgKTsKICAgIC8qKiB4bWwgbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGB4bWxgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL3d3dy53My5vcmcvWE1MLzE5OTgvbmFtZXNwYWNlYC4KICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLnhtbCAqLwogICAgdGhhdC54bWwgPSB0aGF0Lk5hbWVzcGFjZSggInhtbCIsICJodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2UiICk7CiAgICAvKiogcmRmIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgcmRmYC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyNgLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMucmRmICovCiAgICB0aGF0LnJkZiA9IHRoYXQuTmFtZXNwYWNlKCAicmRmIiwgImh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiICk7CiAgICAvKiogc2tvcyBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYHNrb3NgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL3d3dy53My5vcmcvMjAwOC8wNS9za29zI2AuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5za29zICovCiAgICB0aGF0LnNrb3MgPSB0aGF0Lk5hbWVzcGFjZSggInNrb3MiLCAiaHR0cDovL3d3dy53My5vcmcvMjAwOC8wNS9za29zIyIgKTsKICAgIC8qKiBmb2FmIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgZm9hZmAuIFRoZSB1cmkgZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBodHRwOi8veG1sbnMuY29tL2ZvYWYvMC4xYC4KICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLmZvYWYgKi8KICAgIHRoYXQuZm9hZiA9IHRoYXQuTmFtZXNwYWNlKCAiZm9hZiIsICJodHRwOi8veG1sbnMuY29tL2ZvYWYvMC4xIiApOwogICAgLyoqIG9mIG5hbWVzcGFjZS4KICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBvZmAuCiAgICAgKiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL29zcy5kYmMuZGsvbnMvb3BlbmZvcm1hdGAuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5vZiAqLwogICAgdGhhdC5vZiA9IHRoYXQuTmFtZXNwYWNlKCAib2YiLCAiaHR0cDovL29zcy5kYmMuZGsvbnMvb3BlbmZvcm1hdCIgKTsKICAgIC8qKiBvZm8gbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBvZm9gLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL29zcy5kYmMuZGsvbnMvb3BlbmZvcm1hdG91dHB1dGAuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5vZm8gKi8KICAgIHRoYXQub2ZvID0gdGhhdC5OYW1lc3BhY2UoICJvZm8iLCAiaHR0cDovL29zcy5kYmMuZGsvbnMvb3BlbmZvcm1hdG91dHB1dCIgKTsKICAgIC8qKiBiaWJkayBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGJpYmRrYC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGh0dHA6Ly9vc3MuZGJjLmRrL25zL29wZW5mb3JtYXRvdXRwdXQvYmlibGlvdGVrZGtkaXNwbGF5YC4KICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLmJpYmRrICovCiAgICB0aGF0LmJpYmRrID0gdGhhdC5OYW1lc3BhY2UoICJiaWJkayIsICJodHRwOi8vb3NzLmRiYy5kay9ucy9vcGVuZm9ybWF0b3V0cHV0L2JpYmxpb3Rla2RrZGlzcGxheSIgKTsKICAgIC8qKiBvcyBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYG9zYC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGh0dHA6Ly9vc3MuZGJjLmRrL25zL29wZW5zZWFyY2hgLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMub3MgKi8KICAgIHRoYXQub3MgPSB0aGF0Lk5hbWVzcGFjZSggIm9zIiwgImh0dHA6Ly9vc3MuZGJjLmRrL25zL29wZW5zZWFyY2giICk7CiAgICAvKiogaXNvMTg2MjYgbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBuMWAuIFRoZSB1cmkgZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBodHRwOi8vaWxsdHJhbnNhY3Rpb25zLm9yZy8yMDEzL2lzbzE4NjI2YC4KICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLmlzbzE4NjI2ICovCiAgICB0aGF0LmlzbzE4NjI2ID0gdGhhdC5OYW1lc3BhY2UoICJuMSIsICJodHRwOi8vaWxsdHJhbnNhY3Rpb25zLm9yZy8yMDEzL2lzbzE4NjI2IiApOwogICAgLyoqIGxuIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgbG5gLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL29zcy5kYmMuZGsvbnMvbGlua3NgLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMubG4gKi8KICAgIHRoYXQubG4gPSB0aGF0Lk5hbWVzcGFjZSggImxuIiwgImh0dHA6Ly9vc3MuZGJjLmRrL25zL2xpbmtzIiApOwoKICAgIC8qKiBmb3htbCBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGZveG1sYC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGluZm86ZmVkb3JhL2ZlZG9yYS1zeXN0ZW06ZGVmL2ZveG1sI2AuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5mb3htbCAqLwogICAgdGhhdC5mb3htbCA9IHRoYXQuTmFtZXNwYWNlKCAiZm94bWwiLCAiaW5mbzpmZWRvcmEvZmVkb3JhLXN5c3RlbTpkZWYvZm94bWwjIiApOwoKICAgIC8qKiBmZWRvcmEgbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBmZWRvcmFgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaW5mbzpmZWRvcmEvYC4KICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLmZlZG9yYSAqLwogICAgdGhhdC5mZWRvcmEgPSB0aGF0Lk5hbWVzcGFjZSggImZlZG9yYSIsICJpbmZvOmZlZG9yYS8iICk7CgogICAgLyoqIFNPQVAtRU5WIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgU09BUC1FTlZgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvc29hcC9lbnZlbG9wZS9gLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMuc29hcGVudiAqLwogICAgdGhhdC5zb2FwZW52ID0gdGhhdC5OYW1lc3BhY2UoICJTT0FQLUVOViIsICJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy9zb2FwL2VudmVsb3BlLyIgKTsKCiAgICAvKiogIFRoZSBuYW1lc3BhY2UgZm9yIHRoZQogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBkYXRhaW9jb250YWluZXJgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL29zcy5kYmMuZGsvbnMvZGF0YS1jb250YWluZXJgLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMuZGF0YWlvY29udGFpbmVyICovCiAgICB0aGF0LmRhdGFpb2NvbnRhaW5lciA9IHRoYXQuTmFtZXNwYWNlKCAiZGF0YWlvY29udGFpbmVyIiwgImh0dHA6Ly9vc3MuZGJjLmRrL25zL2RhdGEtY29udGFpbmVyIiApOwoKICAgIC8qKiBmZWRvcmEgbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGB6c2AuIFRoZSB1cmkgZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBodHRwOi8vZG9jcy5vYXNpcy1vcGVuLm9yZy9ucy9zZWFyY2gtd3Mvc3J1UmVzcG9uc2VgLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMuenMgKi8KICAgIHRoYXQuenMgPSB0aGF0Lk5hbWVzcGFjZSggInpzIiwgImh0dHA6Ly9kb2NzLm9hc2lzLW9wZW4ub3JnL25zL3NlYXJjaC13cy9zcnVSZXNwb25zZSIgKTsKCiAgICByZXR1cm4gdGhhdDsKfSggKTsKCg==", "moduleName": "XmlNamespaces"}, {"javascript": "LyoqIEBmaWxlIFZhcmlvdXMgdXRpbGl0aWVzICovCgpFWFBPUlRFRF9TWU1CT0xTID0gWyAnVXRpbCcgXTsKdXNlKCAiTG9kYXNoIiApOwp1c2UoICJNYXJjIiApOwoKLyoqCiAqIFZhcmlvdXMgdXRpbGl0aWVzLgogKiAKICogVmFyaW91cyB1dGlsaXRpZXMsIG1vc3RseSByZWxhdGVkIHRvIG9iamVjdHMuCiAqIAogKiBAbmFtZSBVdGlsCiAqIEBuYW1lc3BhY2UgCiAqLwp2YXIgVXRpbCA9IGZ1bmN0aW9uKCApIHsKCiAgICAvKioKICAgICAqIEFkZCBhbiBvYmplY3QgdG8gYW4gYXJyYXksIGlmIHRoZSBvYmplY3QgaXMgbm90IGFscmVhZHkgaW4gdGhlIGFycmF5CiAgICAgKiAKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggVXRpbC5hZGRVbmlxdWVPYmplY3RUb0FycmF5KCBhcnJheSwgb2JqICk7CiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBBbiBhcnJheSBvZiBvYmplY3RzIHRvIHB1c2ggYW4gdW5pcXVlIG9iamVjdCB0by4KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmogVGhlIG9iamVjdCB0byBwdXNoIHRvIHRoZSBhcnJheS4KICAgICAqIEByZXR1cm4ge0FycmF5IH0gdGhlIHVwZGF0ZWQgYXJyYXkuCiAgICAgKiBAbmFtZSBVdGlsLmFkZFVuaXF1ZU9iamVjdFRvQXJyYXkgCiAgICAqIEBleGFtcGxlIFV0aWwuYWRkVW5pcXVlT2JqZWN0VG9BcnJheSggW3sgImZpcnN0TmFtZSI6ICJIYW5zIiwgImZhbWlseU5hbWUiOiAiSmVuc2VuIiB9LCB7ICJmaXJzdE5hbWUiOiAiSmVucyIsICJmYW1pbHlOYW1lIjogIkhhbnNlbiJ9LCB7ICJmaXJzdE5hbWUiOiAiSmVucyIsICJmYW1pbHlOYW1lIjogIkplbnNlbiIgfV0sIHsgImZpcnN0TmFtZSI6ICJIYW5zIiwiZmFtaWx5TmFtZSI6ICJIYW5zZW4iIH0gKTsgCiAgICAgKiAvL3JldHVybnMgW3sgImZpcnN0TmFtZSI6ICJIYW5zIiwgImZhbWlseU5hbWUiOiAiSmVuc2VuIiB9LCB7ICJmaXJzdE5hbWUiOiAiSmVucyIsICJmYW1pbHlOYW1lIjogIkhhbnNlbiIgfSwgeyAiZmlyc3ROYW1lIjogIkplbnMiLCAiZmFtaWx5TmFtZSI6ICJKZW5zZW4iIH0sIHsgImZpcnN0TmFtZSI6ICJIYW5zIiwiZmFtaWx5TmFtZSI6ICJIYW5zZW4iIH0gXQogICAgICogCiAgICAgKiBAbWV0aG9kIAogICAgICovCgogICAgZnVuY3Rpb24gYWRkVW5pcXVlT2JqZWN0VG9BcnJheSggYXJyYXksIG9iaiApIHsKCiAgICAgICAgdmFyIGlzVW5pcXVlID0gdHJ1ZTsKICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgaWYgKCAwID09PSBhcnJheS5sZW5ndGggfHwgdHJ1ZSA9PT0gXy5pc0VxdWFsKCBhcnJheVsgaSBdLCBvYmogKSApIHsKICAgICAgICAgICAgICAgIHZhciBpc1VuaXF1ZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCB0cnVlID09PSBpc1VuaXF1ZSApIHsKICAgICAgICAgICAgYXJyYXkucHVzaCggb2JqICk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhcnJheTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUga2V5cyBmcm9tIGFuIG9iamVjdCBhcyBhbiBhcnJheS4KICAgICAqIAogICAgICogR2V0IGFuIGFycmF5IG9mIGtleXMgb2YgdGhlIG9iamVjdCwgdXNpbmcgc29tZSB0cmlja3MgZnJvbSB0aGUgYmFnIG9mCiAgICAgKiBSSkUgCiAgICAgKiAKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggVXRpbC5hcnJheU9mS2V5cyhvYmopOwogICAgICogQHBhcmFtIHtvYmplY3R9IG9iaiBUaGUgb2JqZWN0IHRvIGdldCB0aGUga2V5cyBmb3IuCiAgICAgKiBAcmV0dXJuIHtvYmplY3RbXX0gUmV0dXJucyBhIG5ldyBhcnJheSBjb250YWluaW5nIGFsbCB0aGUga2V5cyBvZiBvYmouCiAgICAgKiBAbmFtZSBVdGlsLmFycmF5T2ZLZXlzCiAgICAgKiBAZXhhbXBsZQogICAgICogVXRpbC5hcnJheU9mS2V5cyggeyAnZWxlbWVudE5hbWUnOiAndGl0bGUnLCAnZWxlbWVudFZhbHVlJzogJ0RlbiBnYW1sZSBtYW5kIG9nIGhhdmV0JyB9ICksCiAgICAgKiAvL3JldHVybnMgWyAiZWxlbWVudE5hbWUiLCAiZWxlbWVudFZhbHVlIiBdCiAgICAgKiAgCiAgICAgKiBAbWV0aG9kICovCgogICAgZnVuY3Rpb24gYXJyYXlPZktleXMoIG9iaiApIHsKCiAgICAgICAgdmFyIHJlc3VsdCA9IFsgXTsKICAgICAgICBmb3IgKCB2YXIgZWxlbSBpbiBvYmogKQogICAgICAgICAgICBpZiAoIG9iai5oYXNPd25Qcm9wZXJ0eSggZWxlbSApICkgewogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goIGVsZW0gKTsKICAgICAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgb2JqZWN0IHRoYXQgaGFzIHRoZSBhcmd1bWVudCBhcyBwcm90b3R5cGUKICAgICAqIAogICAgICogU2VlIENyb2NrZm9yZCBwYWdlIDIyLiBJbiBzb21lIG9mIENyb2NrZm9yZHMgbm90ZXMsIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIAogICAgICogImJlZ2V0Ii4gVGhpcyB3aWxsIGJlY29tZSBPYmplY3QuY3JlYXRlIGluIEVTNS4KICAgICAqICAKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggVXRpbC5rZXlTb3J0ZWRPYmplY3QoIHByb3RvdHlwZV9vYmplY3QgKTsKICAgICAqIEBwYXJhbSB7T2JqZWN0fSAKICAgICAqIEByZXR1cm4ge09iamVjdH0gCiAgICAgKiBAbmFtZSBVdGlsLmNyZWF0ZQogICAgICogQG1ldGhvZCAqLwoKICAgIGZ1bmN0aW9uIGNyZWF0ZSggcHJvdG90eXBlX29iamVjdCApIHsKICAgICAgICB2YXIgRiA9IGZ1bmN0aW9uKCApIHt9OwogICAgICAgIEYucHJvdG90eXBlID0gcHJvdG90eXBlX29iamVjdDsKICAgICAgICByZXR1cm4gbmV3IEYoICk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYXAgYSBmdW5jdGlvbiBhY3Jvc3MgdGhlIG1hdGNoZXMgb2YgYSBSZWdFeHAuIAogICAgICoKICAgICAqICoqVE9ETzoqKiBSSkUgbmVlZHMgdG8gZG9jdW1lbnQgdGhpcywgYW5kIGdpdmUgYXQgbGVhc3Qgb25lIGV4YW1wbGUgb24gaG93IHRvIHVzZSBpdC4KICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAbWV0aG9kCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyIFRoZSBzdHJpbmcgdG8gc2VhcmNoIGZvciBtYXRjaGVzLgogICAgICogQHBhcmFtIHtSZWdFeHB9IHJlIFJlZ3VsYXIgZXhwcmVzc2lvbiB0byBtYXRjaCBhZ2FpbnN0LgogICAgICogQHBhcmFtIHtmdW5jdGlvbn0gZm4gRnVuY3Rpb24gdG8gbWFwLCB0aGlzIGdldHMgdGhlIG1hdGNoZWQgcmVnZXgtZ3JvdXBzIGFzIHBhcmFtZXRlcnMgKHRoZSBmdWxsIG1hdGNoIGFzIHRoZSBmaXJzdCBvZiB0aGVtKS4KICAgICAqIEBuYW1lIFV0aWwuZm9yRWFjaEdyb3VwZWRSZWdFeHBNYXRjaAogICAgICovCgogICAgZnVuY3Rpb24gZm9yRWFjaEdyb3VwZWRSZWdFeHBNYXRjaCggc3RyLCByZSwgZm4gKSB7CiAgICAgICAgLy8gSmF2YVNjcmlwdCBxdWlyY2s6IHRoZSBlYXNpZXN0IHdheSB0byBtYXAgYSBmdW5jdGlvbiBhY3Jvc3MgdGhlIF9ncm91cHNfIG9mIHRoZSBtYXRjaGVzIG9mIGEgcmVnZXggaXMgdG8gY2FsbCByZXBsYWNlIGFuZCB0aHJvdyB0aGUgcmVzdWx0IGF3YXkuIAogICAgICAgIHN0ci5yZXBsYWNlKCByZSwgZm4gKTsKICAgIH0KCgoKICAgIC8qKgogICAgICogR2V0IHRoZSB0eXBlIG9mIGFuIG9iamVjdC4KICAgICAqIAogICAgICogR2V0IHRoZSB0eXBlIG9mIGFuIG9iamVjdCwgdXNpbmcgc29tZSB0cmlja3MgZnJvbSB0aGUgYmFnIG9mIFJKRS4uLgogICAgICogTk9URTogVGhpcyBkb2VzIG5vdCB3b3JrIHdpdGggY3VzdG9tIG1hZGUgb2JqZWN0cyBsaWtlIFJlY29yZCwgRmllbGQsIFN1YmZpZWxkLCBzbyBiZSBjYXJlZnVsbC4gCiAgICAgKiBOT1RFOiBVc2UgdGhpcyBvbmx5IHdoZW4geW91IGV4cGVjdCBidWlsdCBpbiB0eXBlcyBvciB1c2UgdHlwZW9mIG9yIGluc3RhbmNlb2YgaW5zdGVhZC4KICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggVXRpbC5nZXRUeXBlKG9iaik7CiAgICAgKiBAcGFyYW0ge29iamVjdH0gb2JqIFRoZSBvYmplY3QgdG8gZ2V0IHRoZSB0eXBlIGZvci4KICAgICAqIEByZXR1cm4ge3N0cmluZ30gdHlwZW9mIG9iaiwgb3IgbmFtZSBvZiBvYmouY29uc3RydWN0b3IgaWYgYXZhaWxhYmxlLgogICAgICogQG5hbWUgVXRpbC5nZXRUeXBlCiAgICAgKiBAbWV0aG9kCiAgICAgKi8KCiAgICBmdW5jdGlvbiBnZXRUeXBlKCBvYmogKSB7CgogICAgICAgIHZhciB0eXBlID0gdHlwZW9mKCBvYmogKTsKICAgICAgICBpZiAoIHR5cGUgPT09ICJvYmplY3QiICYmIG9iaiAhPT0gbnVsbCAmJiBvYmouY29uc3RydWN0b3IgKSB7CiAgICAgICAgICAgIHZhciBtYXRjaCA9IFJlZ0V4cCggImZ1bmN0aW9uIChbXihdW14oXSopIiApLmV4ZWMoIG9iai5jb25zdHJ1Y3Rvci50b1NvdXJjZSggKSApOwogICAgICAgICAgICBpZiAoIG1hdGNoICYmIG1hdGNoLmxlbmd0aCA9PSAyICkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoWyAxIF07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHR5cGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBBcmUgdHdvIG9iamVjdHMgdGhlIHNhbWUuCiAgICAgKiAKICAgICAqIENvbXBhcmVzIHR3byBvYmplY3RzIHRvIGRldGVybWluZSBpZiB0aGV5IGFyZSBlcXVhbC4KICAgICAqIAogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBVdGlsLmlzRXF1YWwob2JqZWN0MSwgb2JqZWN0MikKICAgICAqIEBwYXJhbSB7b2JqZWN0fSBvYmplY3QxIFRoZSBmaXJzdCBvYmplY3QgZm9yIHRoZSBjb21wYXJpc29uIHRlc3QKICAgICAqIEBwYXJhbSB7b2JqZWN0fSBvYmplY3QyIFRoZSBzZWNvbmQgb2JqZWN0IGZvciB0aGUgY29tcGFyaXNvbiB0ZXN0CiAgICAgKiBAcmV0dXJuIHtib29sZWFufSB0cnVlIGlmIHRoZSB0d28gb2JqZWN0cyBhcmUgZXF1YWwsIG90aGVyd2lzZSBmYWxzZQogICAgICogQG5hbWUgVXRpbC5pc0VxdWFsCiAgICAgKiBAZXhhbXBsZQogICAgICogVXRpbC5pc0VxdWFsKCB7IGVsZW1lbnROYW1lOiAndGl0bGUnLCBlbGVtZW50VmFsdWU6ICdEZW4gZ2FtbGUgbWFuZCBvZyBoYXZldCcgfSwgeyBlbGVtZW50TmFtZTogJ3RpdGxlJywgZWxlbWVudFZhbHVlOiAnRGVuIGdhbWxlIG1hbmQgb2cgaGF2ZXQnIH0gKQogICAgICogLy9yZXR1cm5zIHRydWUKICAgICAqIAogICAgICogVXRpbC5pc0VxdWFsKCB7IGVsZW1lbnRWYWx1ZTogJ0RlbiBnYW1sZSBtYW5kIG9nIGhhdmV0JywgZWxlbWVudE5hbWU6ICd0aXRsZScgfSwgeyBlbGVtZW50TmFtZTogJ3RpdGxlJywgZWxlbWVudFZhbHVlOiAnRGVuIGdhbWxlIG1hbmQgb2cgaGF2ZXQnIH0gKQogICAgICogLy9yZXR1cm5zIHRydWUKICAgICAqIAogICAgICogVXRpbC5pc0VxdWFsKCB7IGVsZW1lbnROYW1lOiAndGl0bGUnLCBlbGVtZW50VmFsdWU6ICdEZW4gZ2FtbGUgbWFuZCBvZyBoYXZldCcgfSwgeyBlbGVtZW50TmFtZTogJ3RpdGxlJywgZWxlbWVudFZhbHVlOiAnRGVuIGdhbWxlIG1hbmQgb2cgaGF2ZXQnLCBlbGVtZW50UHJvcGVydHk6ICJmdWxsIiB9ICkKICAgICAqIC8vcmV0dXJucyBmYWxzZQogICAgICogCiAgICAgKiBAbWV0aG9kICovCgogICAgZnVuY3Rpb24gaXNFcXVhbCggb2JqZWN0MSwgb2JqZWN0MiApIHsKCiAgICAgICAgcmV0dXJuIF8uaXNFcXVhbCggb2JqZWN0MSwgb2JqZWN0MiApOwoKICAgIH0KCgoKICAgIC8qKgogICAgICogSXMgdGhpcyBhbiBvYmplY3QuIERvIG5vdCB1c2UgdGhpcyBmdW5jdGlvbiBpbiBuZXcgY29kZS4KICAgICAqIAogICAgICogRmlndXJlcyBvdXQgaWYgdGhpcyBpcyBhbiBvYmplY3QsIHVzaW5nIHNvbWUgdHJpY2tzIGZyb20gdGhlIGJhZyBvZiBSSkUuCiAgICAgKiAKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggVXRpbC5pc09iamVjdChvYmopOwogICAgICogQHBhcmFtIHtvYmplY3R9IG9iaiBUaGUgb2JqZWN0IHRvIHRlc3QgZm9yIGJlZWluZyBhbiBvYmplY3QuCiAgICAgKiBAcmV0dXJuIHtib29sZWFufSB0cnVlIGlmIG9iaiBpcyBhbiBvYmplY3QgKG5vdCBudWxsIG9yIGFycmF5KQogICAgICogQG5hbWUgVXRpbC5pc09iamVjdAogICAgICogQG1ldGhvZCAqLwoKICAgIGZ1bmN0aW9uIGlzT2JqZWN0KCBvYmogKSB7CiAgICAgICAgdGhyb3cgImRlcHJlY2F0ZWQiOyAvL1RoaXMgaXMgcHJvYmFibHkgaW5zZXJ0ZWQgdG8gcHJldmVudCBhbnkgdXNlIG9mIHRoZSBmdW5jdGlvbgogICAgICAgIHJldHVybiBvYmogIT0gbnVsbCAmJiB0eXBlb2YoIG9iaiApID09PSAib2JqZWN0IiAmJiAhKCBvYmogaW5zdGFuY2VvZiBBcnJheSApICYmICEoIG9iaiBpbnN0YW5jZW9mIERhdGUgKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBhIG5ldyBvYmplY3Qgd2l0aCBzb3J0ZWQga2V5cy4KICAgICAqIAogICAgICogR2V0IGEgbmV3IG9iamVjdCB3aXRoIHRoZSBzYW1lIGtleXMvdmFsdWVzIGFzIHRoZSBvYmosIGJ1dCBpbnNlcnRlZCBpbgogICAgICogYWxwaGFiZXRpY2FsIG9yZGVyLCB1c2luZyBzb21lIHRyaWNrcyBmcm9tIHRoZSBiYWcgb2YgUkpFLgogICAgICogCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IFV0aWwua2V5U29ydGVkT2JqZWN0KG9iaik7CiAgICAgKiBAcGFyYW0ge29iamVjdH0gb2JqIFRoZSBvYmplY3QgdG8gc29ydCBrZXlzIGZvci4KICAgICAqIEByZXR1cm4ge29iamVjdH0gQSBuZXcgb2JqZWN0IHdpdGggdGhlIHNhbWUga2V5cy92YWx1ZXMgYXMgdGhlIG9iaiwgYnV0IGluc2VydGVkIGluIGFscGhhYmV0aWNhbCBvcmRlcgogICAgICogQG5hbWUgVXRpbC5rZXlTb3J0ZWRPYmplY3QKICAgICAqIEBleGFtcGxlIFV0aWwua2V5U29ydGVkT2JqZWN0KCB7IGVsZW1lbnROYW1lOiAndGl0bGUnLCBlbGVtZW50VmFsdWU6ICdEZW4gZ2FtbGUgbWFuZCBvZyBoYXZldCcsIGVsZW1lbnRQcm9wZXJ0eTogImZ1bGwiIH0pOwogICAgICogLy9yZXR1cm5zIHsgZWxlbWVudE5hbWU6ICd0aXRsZScsIGVsZW1lbnRQcm9wZXJ0eTogImZ1bGwiLCBlbGVtZW50VmFsdWU6ICdEZW4gZ2FtbGUgbWFuZCBvZyBoYXZldCcgfQogICAgICogCiAgICAgKiBAbWV0aG9kICovCgogICAgZnVuY3Rpb24ga2V5U29ydGVkT2JqZWN0KCBvYmogKSB7CgogICAgICAgIGlmICggb2JqID09PSBudWxsIHx8IHR5cGVvZiggb2JqICkgIT09ICJvYmplY3QiIHx8ICggb2JqIGluc3RhbmNlb2YgQXJyYXkgKSB8fCAoIG9iaiBpbnN0YW5jZW9mIERhdGUgKSApIHsKICAgICAgICAgICAgcmV0dXJuIG9iajsKICAgICAgICB9CiAgICAgICAgdmFyIHJlc3VsdCA9IHt9OwogICAgICAgIF8ua2V5cyggb2JqICkuc29ydCggKS5mb3JFYWNoKCBmdW5jdGlvbigga2V5ICkgewogICAgICAgICAgICByZXN1bHRbIGtleSBdID0gb2JqWyBrZXkgXTsKICAgICAgICB9ICk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICAvKioKICAgICAqIE1ldGhvZCB0aGF0IGhhbmRsZXMgbnVtZXJpYyBzb3J0aW5nIG9mIGFuIGFycmF5LgogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggVXRpbC5zb3J0QXJyYXlPZk51bWJlcnMoIGFycmF5LCBbbW9kZV0gKQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgQW4gYXJyYXkgY29udGFpbmluZyBudW1iZXJzLiBUaGUgbnVtYmVycyBhcmUgYWxzbyBhbGxvd2VkIGFzIHN0cmluZ3MuCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW21vZGVdIEEgImQiIGdpdmluZyBkZXNjZW5kaW5nIG9yZGVyIG9yIGFueXRoaW5nIGVsc2UgZ2l2aW5nIGFzY2VuZGluZyBvcmRlcgogICAgICogQHJldHVybiB7QXJyYXl9IEEgbmV3IGFycmF5IGNvbnRhaW5pbmcgc29ydGVkIG51bWJlcnMKICAgICAqIEBleGFtcGxlIFV0aWwuc29ydEFycmF5T2ZOdW1iZXJzKCBbIDMsIDcsIDEyLCAxLCAxMDAsIDQ3IF0sICJkIiApCiAgICAgKiAvL3JldHVybnMgWyAxMDAsIDQ3LCAxMiwgNywgMywgMSBdCiAgICAgKiAgCiAgICAgKiBAZXhhbXBsZSBVdGlsLnNvcnRBcnJheU9mTnVtYmVycyggWyAiMDIwIiwgIjMiLCAiNzUiICwiMzAxIiwgIjAwMSIgXSApCiAgICAgKiAvLyByZXR1cm5zIFsgIjAwMSIsICIzIiwgIjAyMCIsICI3NSIgLCIzMDEiIF0KICAgICAqIAogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgVXRpbC5zb3J0QXJyYXlPZk51bWJlcnMKICAgICAqLwogICAgZnVuY3Rpb24gc29ydEFycmF5T2ZOdW1iZXJzKCBhcnJheSwgbW9kZSApIHsKCiAgICAgICAgYXJyYXkuc29ydCggZnVuY3Rpb24oIGEsIGIgKSB7CiAgICAgICAgICAgIGlmICggbW9kZSAhPT0gImQiICkgewogICAgICAgICAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGIgLSBhOwogICAgICAgICAgICB9CiAgICAgICAgfSApOwoKICAgICAgICByZXR1cm4gYXJyYXk7CgogICAgfQoKICAgIC8qKgogICAgICogTWV0aG9kIHRoYXQgaGFuZGxlcyBhbHBoYWJldGljYWwgc29ydGluZyBvbiBhIHNwZWNpZmllZCBwcm9wZXJ0eSBmb3IgYW4gYXJyYXkgb2Ygb2JqZWN0cy4KICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IFV0aWwuc29ydEFycmF5T2ZPYmplY3RzKCBhcnJheSwgcHJvcGVydHkgKQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgQW4gYXJyYXkgY29udGFpbmluZyBvYmplY3RzCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcHJvcGVydHkgVGhlIG5hbWUgb2YgdGhlIHByb3BlcnR5IHVzZWQgZm9yIHNvcnRpbmcKICAgICAqIEByZXR1cm4ge0FycmF5fSBBIG5ldyBhcnJheSBjb250YWluaW5nIHNvcnRlZCBvYmplY3RzCiAgICAgKiBAZXhhbXBsZSBVdGlsLnNvcnRBcnJheU9mT2JqZWN0cyggWyB7ICJ2YWx1ZSI6ICJoZXN0IiwgInR5cGUiOiAiYW5pbWFsIiB9LHsgInZhbHVlIjogImtvIiwgInR5cGUiOiAiYW5pbWFsIiB9LHsgInZhbHVlIjogImdyaXMiLCAidHlwZSI6ICJhbmltYWwiIH0gXSwgInZhbHVlIiApIAogICAgICogLy8gcmV0dXJucyBbIHsgInZhbHVlIjogImdyaXMiLCAidHlwZSI6ICJhbmltYWwiIH0sIHsgInZhbHVlIjogImhlc3QiLCAidHlwZSI6ICJhbmltYWwiIH0seyAidmFsdWUiOiAia28iLCAidHlwZSI6ICJhbmltYWwiIH0gXQogICAgICogCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBVdGlsLnNvcnRBcnJheU9mT2JqZWN0cwogICAgICovCiAgICBmdW5jdGlvbiBzb3J0QXJyYXlPZk9iamVjdHMoIGFycmF5LCBwcm9wZXJ0eSApIHsKCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmc6IFV0aWwuc29ydEFycmF5T2ZPYmplY3RzIG1ldGhvZCIgKTsKCiAgICAgICAgdmFyIHNvcnRlZEFycmF5ID0gYXJyYXkuc29ydCggZnVuY3Rpb24oIGEsIGIgKSB7CiAgICAgICAgICAgIGlmICggYVsgcHJvcGVydHkgXSA8IGJbIHByb3BlcnR5IF0gKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCBhWyBwcm9wZXJ0eSBdID4gYlsgcHJvcGVydHkgXSApIHsKICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0gKTsKCiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZzogVXRpbC5zb3J0QXJyYXlPZk9iamVjdHMgbWV0aG9kIiApOwoKICAgICAgICByZXR1cm4gc29ydGVkQXJyYXk7CgogICAgfQoKICAgIC8qKgogICAgICogTWV0aG9kIHRoYXQgcmVtb3ZlcyBkdXBsaWNhdGUgb2JqZWN0cyBpbiBhbiBhcnJheS4KICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IFV0aWwudW5pcXVlT2JqZWN0c0luQXJyYXkoIGFycmF5T2ZPYmplY3RzICkKICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IEFuIGFycmF5IGNvbnRhaW5pbmcgT2JqZWN0cwogICAgICogQHJldHVybiB7QXJyYXl9IEEgbmV3IGFycmF5IGNvbnRhaW5pbmcgb25seSB1bmlxdWUgb2JqZWN0cwogICAgICogQGV4YW1wbGUgVXRpbC51bmlxdWVPYmplY3RzSW5BcnJheSggWyB7ICJhbmltYWwiOiAiaG9yc2UiLCAiY29sb3VyIjogImJyb3duIiB9LHsgImFuaW1hbCI6ICJob3JzZSIsICJjb2xvdXIiOiAiYmxhY2siIH0seyAiYW5pbWFsIjogImhvcnNlIiwgImNvbG91ciI6ICJicm93biIgfSBdICkKICAgICAqIC8vcmV0dXJucyBbIHsgImFuaW1hbCI6ICJob3JzZSIsICJjb2xvdXIiOiAiYmxhY2siIH0seyAiYW5pbWFsIjogImhvcnNlIiwgImNvbG91ciI6ICJicm93biIgfSBdCiAgICAgKiAKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFV0aWwudW5pcXVlT2JqZWN0c0luQXJyYXkKICAgICAqLwoKICAgIGZ1bmN0aW9uIHVuaXF1ZU9iamVjdHNJbkFycmF5KCBhcnJheU9mT2JqZWN0cyApIHsKCiAgICAgICAgdmFyIG51bWJlck9mT2JqZWN0cyA9IGFycmF5T2ZPYmplY3RzLmxlbmd0aDsKICAgICAgICB2YXIgYXJyYXlPZlVuaXF1ZU9iamVjdHMgPSBbIF07CiAgICAgICAgZm9yICggdmFyIGogPSAwOyBqIDwgYXJyYXlPZk9iamVjdHMubGVuZ3RoOyBqKysgKSB7CiAgICAgICAgICAgIHZhciByZXN0ID0gYXJyYXlPZk9iamVjdHMuc2xpY2UoIGogKyAxLCBudW1iZXJPZk9iamVjdHMgKQogICAgICAgICAgICB2YXIgY3VycmVudE9iamVjdCA9IGFycmF5T2ZPYmplY3RzWyBqIF07CiAgICAgICAgICAgIHZhciBpc1VuaXF1ZSA9IHRydWU7CiAgICAgICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IHJlc3QubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgICAgICAgICBpZiAoIF8uaXNFcXVhbCggY3VycmVudE9iamVjdCwgcmVzdFsgaSBdICkgKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGlzVW5pcXVlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmICggdHJ1ZSA9PT0gaXNVbmlxdWUgKSB7CiAgICAgICAgICAgICAgICBhcnJheU9mVW5pcXVlT2JqZWN0cy5wdXNoKCBjdXJyZW50T2JqZWN0ICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFycmF5T2ZVbmlxdWVPYmplY3RzOwogICAgfQoKCiAgICAvKioKICAgICAqIE1ldGhvZCB0aGF0IHJlbW92ZXMgZHVwbGljYXRlIHZhbHVlcyBpbiBhbiBhcnJheS4KICAgICAqIAogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBVdGlsLnVuaXF1ZVZhbHVlcyggYXJyYXkgKQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIHNvcnRlZCBhcnJheSB3aGVyZSBkdXBsaWNhdGVzIG5lZWQgdG8gYmUgcmVtb3ZlZAogICAgICogQHJldHVybiB7QXJyYXl9IEFuIGFycmF5IGNvbnRhaW5pbmcgdW5pcXVlIHZhbHVlcwogICAgICogQGV4YW1wbGUgVXRpbC51bmlxdWVWYWx1ZXMoIFsgIjIwNyIsICIyMTciLCAiMjE3IiwgIjU4MyIsICIyMTciXSApCiAgICAgKiAvL3JldHVybnMgWyAiMjA3IiwgIjU4MyIsICIyMTciXQogICAgICogCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBVdGlsLnVuaXF1ZVZhbHVlcwogICAgICovCiAgICBmdW5jdGlvbiB1bmlxdWVWYWx1ZXMoIGFycmF5ICkgewoKICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZzogVXRpbC51bmlxdWVWYWx1ZXMgbWV0aG9kIiApOwoKICAgICAgICB2YXIgdW5pcXVlVmFsdWVBcnJheSA9IFsgXTsKICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgaWYgKCB1bmlxdWVWYWx1ZUFycmF5LmluZGV4T2YoIGFycmF5WyBpIF0gKSA8IDAgKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVWYWx1ZUFycmF5LnB1c2goIGFycmF5WyBpIF0gKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZzogVXRpbC51bmlxdWVWYWx1ZXMgbWV0aG9kIiApOwoKICAgICAgICByZXR1cm4gdW5pcXVlVmFsdWVBcnJheTsKCiAgICB9CgogICAgLyoqCiAgICAgKiBEZWVwIGNsb25lcyBhbiBvYmplY3QuCiAgICAgKgogICAgICogSGFuZGxlcyBSZWNvcmQsIEZpZWxkLCBTdWJmaWVsZCwgeG1sIE5vZGVzLCBhbmQgcGxhaW4gamF2YXNjcmlwdCBvYmplY3RzLgogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggVXRpbC5jbG9uZURlZXAoIG9iaiApCiAgICAgKiBAcGFyYW0geyp9IG9iaiBhbiBvYmplY3QgdG8gY2xvbmUKICAgICAqIEByZXR1cm5zIHsqfSBhIGRlZXAgY2xvbmUgb2YgdGhlIGlucHV0IG9iamVjdAogICAgICogQGZ1bmN0aW9uCiAgICAgKiBAbmFtZSBVdGlsLmNsb25lRGVlcAogICAgICoKICAgICAqIEBleGFtcGxlCiAgICAgKiB2YXIgYSA9IFt7ImEiOiAxfSwgeyJiIjogMn1dOwogICAgICogdmFyIGNsb25lID0gVXRpbC5jbG9uZURlZXAoYSk7CiAgICAgKiBhWzBdID09PSBjbG9uZVswXSAvLyA9PiBmYWxzZQogICAgICovCiAgICBmdW5jdGlvbiBjbG9uZURlZXAoIG9iaiApIHsKICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZyBVdGlsLmNsb25lRGVlcCIgKTsKCiAgICAgICAgdmFyIGNsb25lID0gbnVsbDsKICAgICAgICBpZiAoIG9iaiBpbnN0YW5jZW9mIFJlY29yZCB8fCBvYmogaW5zdGFuY2VvZiBGaWVsZCB8fAogICAgICAgICAgICBvYmogaW5zdGFuY2VvZiBTdWJmaWVsZCApIHsKICAgICAgICAgICAgY2xvbmUgPSBvYmouY2xvbmUoKTsKICAgICAgICB9IGVsc2UgaWYgKCB0eXBlb2YgUGFja2FnZXMgIT09ICd1bmRlZmluZWQnICYmIG9iaiBpbnN0YW5jZW9mIFBhY2thZ2VzLm9yZy53M2MuZG9tLk5vZGUgKSB7CiAgICAgICAgICAgIGNsb25lID0gb2JqLmNsb25lTm9kZSggdHJ1ZSApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNsb25lID0gXy5jbG9uZURlZXAoIG9iaiApOwogICAgICAgIH0KCiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBVdGlsLmNsb25lRGVlcCIgKTsKICAgICAgICByZXR1cm4gY2xvbmU7CiAgICB9CgoKICAgIC8qKgogICAgICogTWV0aG9kIHRoYXQgY29udmVydHMgcm9tYW4gbnVtYmVycyB0byBsYXRpbiBudW1iZXJzIGFzIGEgc3RyaW5nCiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBVdGlsLmNvbnZlcnRSb21hbk51bWJlcnNUb0xhdGluKCBzdHJpbmcgKQogICAgICogQHBhcmFtIHtTdHJpbmd9IGlucHV0IFRoZSByb21hbiBudW1iZXIKICAgICAqIEByZXR1cm4ge051bWJlcn0gVGhlIGxhdGluIG51bWJlciBvciB6ZXJvCiAgICAgKiBAZXhhbXBsZSBVdGlsLmNvbnZlcnRSb21hbk51bWJlcnNUb0xhdGluKCAiTURDQ1hYSVYiICkKICAgICAqIC8vcmV0dXJucyAiMTcyNCIKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBVdGlsLmNvbnZlcnRSb21hbk51bWJlcnNUb0xhdGluCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbnZlcnRSb21hbk51bWJlcnNUb0xhdGluKCBpbnB1dCApIHsKCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmc6IFV0aWwuY29udmVydFJvbWFuTnVtYmVyc1RvTGF0aW4gbWV0aG9kIiApOwoKICAgICAgICBpZiggdHlwZW9mIGlucHV0ICE9ICJzdHJpbmciICl7CiAgICAgICAgICAgIExvZy53YXJuKCAiaW5wdXQgbnVtYmVyIGlzIG5vdCB3cml0dGVuIGFzIGEgc3RyaW5nIiApOwogICAgICAgICAgICBpbnB1dCA9IFN0cmluZyggaW5wdXQgKTsKICAgICAgICB9CgogICAgICAgIHZhciBfX2NoYXJfdG9faW50ID0gZnVuY3Rpb24oIGMgKSB7CiAgICAgICAgICAgIHN3aXRjaCAoIGMgKSB7CiAgICAgICAgICAgICAgICBjYXNlICdJJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgICAgIGNhc2UgJ1YnOgogICAgICAgICAgICAgICAgICAgIHJldHVybiA1OwogICAgICAgICAgICAgICAgY2FzZSAnWCc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEwOwogICAgICAgICAgICAgICAgY2FzZSAnTCc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDUwOwogICAgICAgICAgICAgICAgY2FzZSAnQyc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEwMDsKICAgICAgICAgICAgICAgIGNhc2UgJ0QnOgogICAgICAgICAgICAgICAgICAgIHJldHVybiA1MDA7CiAgICAgICAgICAgICAgICBjYXNlICdNJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTAwMDsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgaWYgKCBpbnB1dCA9PSBudWxsICkgcmV0dXJuIC0xOwogICAgICAgIHZhciBudW1iZXIgPSBfX2NoYXJfdG9faW50KCBpbnB1dC5jaGFyQXQoIDAgKSApOwogICAgICAgIHZhciBwcmU7CiAgICAgICAgdmFyIGN1cnI7CgogICAgICAgIGZvciAoIHZhciBpID0gMTsgaSA8IGlucHV0Lmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICBjdXJyID0gX19jaGFyX3RvX2ludCggaW5wdXQuY2hhckF0KCBpICkgKTsKICAgICAgICAgICAgcHJlID0gX19jaGFyX3RvX2ludCggaW5wdXQuY2hhckF0KCBpIC0gMSApICk7CiAgICAgICAgICAgIGlmICggY3VyciA8PSBwcmUgKSB7CiAgICAgICAgICAgICAgICBudW1iZXIgKz0gY3VycjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG51bWJlciA9IG51bWJlciAtIHByZSAqIDIgKyBjdXJyOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiggbnVtYmVyIDwgMCApewogICAgICAgICAgICBudW1iZXIgPSAwOwogICAgICAgICAgICBMb2cud2FybiggIklucHV0IG51bWJlciBpcyBub3QgY29udmVydGFibGUgLSByZXR1cm5pbmcgMCIgKTsKCiAgICAgICAgfQoKICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nOiBVdGlsLmNvbnZlcnRSb21hbk51bWJlcnNUb0xhdGluIG1ldGhvZCIgKTsKCiAgICAgICAgcmV0dXJuIG51bWJlcjsKCiAgICB9CgoKICAgIC8qKgogICAgICogTWV0aG9kIHRoYXQgY29udmVydHMgbGF0aW4gbnVtYmVycyB0byByb21hbiBudW1iZXJzCiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBVdGlsLmNvbnZlcnRMYXRpbk51bWJlcnNUb1JvbWFuKCBzdHJpbmcgKQogICAgICogQHBhcmFtIHtTdHJpbmd9IHN0cmluZyBUaGUgcm9tYW4gbnVtYmVyCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IFRoZSBsYXRpbiBudW1iZXJzIGFzIGEgc3RyaW5nCiAgICAgKiBAZXhhbXBsZSBVdGlsLmNvbnZlcnRMYXRpbk51bWJlcnNUb1JvbWFuKCAgKQogICAgICogLy9yZXR1cm5zICIiCiAgICAgKgogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgVXRpbC5jb252ZXJ0TGF0aW5OdW1iZXJzVG9Sb21hbgogICAgICovCiAgICBmdW5jdGlvbiBjb252ZXJ0TGF0aW5OdW1iZXJzVG9Sb21hbiggbnVtYmVyICkgewoKICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZzogVXRpbC5jb252ZXJ0TGF0aW5OdW1iZXJzVG9Sb21hbiBtZXRob2QiICk7CgogICAgICAgIHZhciByb21hbk51bWJlciA9ICcnOwogICAgICAgIHZhciByb20gPSBbICdNJywgJ0NNJywgJ0QnLCAnQ0QnLCAnQycsICdYQycsICdMJywgJ1hMJywgJ1gnLCAnSVgnLCAnVicsICdJVicsICdJJyBdOwogICAgICAgIHZhciBhcmEgPSBbIDEwMDAsIDkwMCwgNTAwLCA0MDAsIDEwMCwgOTAsIDUwLCA0MCwgMTAsIDksIDUsIDQsIDEgXTsKCiAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgcm9tLmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICB3aGlsZSAoIG51bWJlciA+PSBhcmFbIGkgXSApIHsKICAgICAgICAgICAgICAgIHJvbWFuTnVtYmVyICs9IHJvbVsgaSBdOwogICAgICAgICAgICAgICAgbnVtYmVyIC09IGFyYVsgaSBdOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nOiBVdGlsLmNvbnZlcnRMYXRpbk51bWJlcnNUb1JvbWFuIG1ldGhvZCIgKTsKCiAgICAgICAgcmV0dXJuIHJvbWFuTnVtYmVyOwoKICAgIH0KCiAgICByZXR1cm4gewoKICAgICAgICBhZGRVbmlxdWVPYmplY3RUb0FycmF5OiBhZGRVbmlxdWVPYmplY3RUb0FycmF5LAogICAgICAgIGFycmF5T2ZLZXlzOiBhcnJheU9mS2V5cywKICAgICAgICBjcmVhdGU6IGNyZWF0ZSwKICAgICAgICBjbG9uZURlZXA6IGNsb25lRGVlcCwKICAgICAgICBmb3JFYWNoR3JvdXBlZFJlZ0V4cE1hdGNoOiBmb3JFYWNoR3JvdXBlZFJlZ0V4cE1hdGNoLAogICAgICAgIGdldFR5cGU6IGdldFR5cGUsCiAgICAgICAgaXNFcXVhbDogaXNFcXVhbCwKCQlpc09iamVjdDogaXNPYmplY3QsCiAgICAgICAga2V5U29ydGVkT2JqZWN0OiBrZXlTb3J0ZWRPYmplY3QsCgkJc29ydEFycmF5T2ZOdW1iZXJzOiBzb3J0QXJyYXlPZk51bWJlcnMsCQkJCgkJc29ydEFycmF5T2ZPYmplY3RzOiBzb3J0QXJyYXlPZk9iamVjdHMsCQogICAgICAgIHVuaXF1ZU9iamVjdHNJbkFycmF5OiB1bmlxdWVPYmplY3RzSW5BcnJheSwKICAgICAgICB1bmlxdWVWYWx1ZXM6IHVuaXF1ZVZhbHVlcywKICAgICAgICBjb252ZXJ0Um9tYW5OdW1iZXJzVG9MYXRpbjogY29udmVydFJvbWFuTnVtYmVyc1RvTGF0aW4sCiAgICAgICAgY29udmVydExhdGluTnVtYmVyc1RvUm9tYW46IGNvbnZlcnRMYXRpbk51bWJlcnNUb1JvbWFuCgogICAgfTsKCn0oICk7CgovLyB1bml0dGVzdHMgYXJlIGluIFV0aWwudGVzdC5qcwovLyAoYmVjYXVzZSB0aGUgVW5pdFRlc3QgbW9kdWxlIGlzIG5vdCBhdmFpbGFibGUgZnJvbSB0aGlzIG1vZHVsZSkK", "moduleName": "Util"}, {"javascript": "LyoqIEBmaWxlIFNvbWUgYWRkZWQgZnVuY3Rpb25hbGl0eSB0byBtYXJjIGNsYXNzZXMgKi8KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLyohCiAgICBcZmlsZSBtYXJjLmpzCiovCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyAgICAgICAgICAgICAgICAgICAgICBFeHBvcnRlZCBTeW1ib2xzCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgpFWFBPUlRFRF9TWU1CT0xTID0gWyAnRWFjaEZhY3RvcnknLCAnSGFuZGxlcicgXTsKCi8vIE1hcmMgZGVwZW5kcyBvbiBNYXJjQ2xhc3Nlcwp1c2UoICJNYXJjQ2xhc3NlcyIgKTsKdXNlKCAiTWFyY01hdGNoZXJzIiApOwp1c2UoICJMb2ciICk7CgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyAgICAgICAgICAgIFN1YmZpZWxkIHByb3RvdHlwZXMKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzClN1YmZpZWxkLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKCApIHsKICAgIHJldHVybiBuZXcgU3ViZmllbGQoIHRoaXMubmFtZSwgdGhpcy52YWx1ZSApOwp9OwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gICAgICAgICAgICBGaWVsZCBwcm90b3R5cGVzCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgovLyBTZWUgZG9jIGluIE1hcmNDbGFzc2VzLnVzZS5qcwpGaWVsZC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiggKSB7CiAgICB2YXIgbmV3RmllbGQgPSBuZXcgRmllbGQoIHRoaXMubmFtZSwgdGhpcy5pbmRpY2F0b3IgKTsKCiAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCB0aGlzLnNpemUoICk7IGkrKyApIHsKICAgICAgICBuZXdGaWVsZC5hcHBlbmQoIHRoaXMuc3ViZmllbGQoIGkgKS5jbG9uZSggKSApOwogICAgfQoKICAgIHJldHVybiBuZXdGaWVsZDsKfTsKCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzCkZpZWxkLnByb3RvdHlwZS5lbXB0eSA9IGZ1bmN0aW9uKCApIHsKICAgIHJldHVybiB0aGlzLnNpemUoICkgPT09IDA7Cn07CgovLyBTZWUgZG9jIGluIE1hcmNDbGFzc2VzLnVzZS5qcwpGaWVsZC5wcm90b3R5cGUuc2l6ZSA9IGZ1bmN0aW9uKCApIHsKICAgIHJldHVybiB0aGlzLmNvdW50KCApOwp9OwoKLy8gU2VlIGRvYyBpbiBNYXJjQ2xhc3Nlcy51c2UuanMKRmllbGQucHJvdG90eXBlLmVhY2hTdWJGaWVsZCA9IGZ1bmN0aW9uKCBtYXRjaGVyLCBoYW5kbGVyICkgewogICAgcmV0dXJuIG5ldyBFYWNoRmFjdG9yeSggKS5lYWNoU3ViRmllbGQoIHRoaXMsIGdldE1hdGNoU3ViRmllbGQoIG1hdGNoZXIgKSwgaGFuZGxlciApOwp9OwoKLy8gU2VlIGRvYyBpbiBNYXJjQ2xhc3Nlcy51c2UuanMKRmllbGQucHJvdG90eXBlLmVhY2hTdWJGaWVsZE1hcCA9IGZ1bmN0aW9uKCBtYXAsIGV4dHJhRGF0YSApIHsKCiAgICB2YXIgbnVtc3ViZmllbGRzPXRoaXMuc2l6ZSgpOwogICAgZm9yICggdmFyIGkgPSAwOyBpIDwgbnVtc3ViZmllbGRzOyBpKysgKSB7CiAgICAgICAgdmFyIGN1cnN1YmZpZWxkPXRoaXMuc3ViZmllbGQoIGkgKTsKICAgICAgICB2YXIgc3ViZmllbGRGdW5jdGlvbnMgPSBtYXAuZnVuY3Rpb25zW2N1cnN1YmZpZWxkLm5hbWVdOwogICAgICAgIGlmIChzdWJmaWVsZEZ1bmN0aW9ucykgewogICAgICAgICAgICB2YXIgbGVuZ3RoID0gc3ViZmllbGRGdW5jdGlvbnMubGVuZ3RoOwogICAgICAgICAgICBMb2cuZGVidWcoIlJlY29yZC5lYWNoU3ViRmllbGRNYXAgQ2FsbGluZyAiLCBsZW5ndGgsICIgbWV0aG9kcyBmb3Igc3ViZmllbGQgIiwgY3Vyc3ViZmllbGQpOwogICAgICAgICAgICBmb3IgKHZhciBqID0gMCA7IGogPCBsZW5ndGggOyBqKyspIHsKICAgICAgICAgICAgICAgIChzdWJmaWVsZEZ1bmN0aW9uc1tqXSkodGhpcywgY3Vyc3ViZmllbGQsIGV4dHJhRGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKfTsKCgovLyBTZWUgZG9jIGluIE1hcmNDbGFzc2VzLnVzZS5qcwpGaWVsZC5wcm90b3R5cGUuZmlyc3RTdWJGaWVsZCA9IGZ1bmN0aW9uKCBtYXRjaGVyLCBoYW5kbGVyICkgewogICAgcmV0dXJuIG5ldyBFYWNoRmFjdG9yeSggKS5maXJzdFN1YkZpZWxkKCB0aGlzLCBnZXRNYXRjaFN1YkZpZWxkKCBtYXRjaGVyICksIGhhbmRsZXIgKTsKfTsKCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzCkZpZWxkLnByb3RvdHlwZS5lYWNoU3ViRmllbGRTZXF1ZW5jZSA9IGZ1bmN0aW9uKCBtYXRjaGVycywgaGFuZGxlciApIHsKICAgIHJldHVybiBuZXcgRWFjaEZhY3RvcnkoICkuZWFjaEZpZWxkU2VxdWVuY2UoIHRoaXMsIG1hdGNoZXJzLCBoYW5kbGVyICk7Cn07CgovLyBTZWUgZG9jIGluIE1hcmNDbGFzc2VzLnVzZS5qcwpGaWVsZC5wcm90b3R5cGUuZXhpc3RzID0gZnVuY3Rpb24oIG1hdGNoZXIgKSB7CiAgICB2YXIgcmVzdWx0ID0gZmFsc2U7CgogICAgdGhpcy5lYWNoU3ViRmllbGQoIGdldE1hdGNoU3ViRmllbGQoIG1hdGNoZXIgKSwgZnVuY3Rpb24oIGZpZWxkLCBzdWJGaWVsZCApIHsKICAgICAgICAgICAgcmVzdWx0ID0gdHJ1ZTsKICAgICAgICB9ICk7CgogICAgcmV0dXJuIHJlc3VsdDsKfTsKCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzCkZpZWxkLnByb3RvdHlwZS5pc1VuaXF1ZSA9IGZ1bmN0aW9uKCBtYXRjaGVyICkgewogICAgcmV0dXJuIHRoaXMuZWFjaFN1YkZpZWxkKCBnZXRNYXRjaFN1YkZpZWxkKCBtYXRjaGVyICksIGZ1bmN0aW9uKCBmaWVsZCwgc3ViRmllbGQgKSB7CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0gKSA9PSAxOwp9OwoKLy8gU2VlIGRvYyBpbiBNYXJjQ2xhc3Nlcy51c2UuanMKRmllbGQucHJvdG90eXBlLmdldEZpcnN0VmFsdWUgPSBmdW5jdGlvbiggbWF0Y2hlciApIHsKCiAgICB2YXIgbXNmID0gbWF0Y2hlcjsKICAgIHZhciByZXN1bHQgPSB0aGlzLmZpcnN0U3ViRmllbGQoIG1zZiwgZnVuY3Rpb24oIGZpZWxkLCBzdWJGaWVsZCApIHsKICAgICAgICAgICAgaWYgKCAiIiAhPT0gc3ViRmllbGQudmFsdWUgfHwgc3ViRmllbGQudmFsdWUgIT09IHVuZGVmaW5lZCApIHsKICAgICAgICAgICAgICAgIHJldHVybiBzdWJGaWVsZC52YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0gKTsKICAgIGlmICggcmVzdWx0ICE9ICIiICkgewogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAiIjsKICAgIH07Cn07CgovLyBTZWUgZG9jIGluIE1hcmNDbGFzc2VzLnVzZS5qcwpGaWVsZC5wcm90b3R5cGUuZ2V0VmFsdWVBc0FycmF5ID0gZnVuY3Rpb24oIG1hdGNoZXIgKSB7CgogICAgdmFyIG1hdGNoZXJzOwoKICAgIGlmICggbWF0Y2hlciBpbnN0YW5jZW9mIEFycmF5ICkgewogICAgICAgIG1hdGNoZXJzID0gbWF0Y2hlcjsKICAgIH0gZWxzZSB7CiAgICAgICAgbWF0Y2hlcnMgPSBbIG1hdGNoZXIgXTsKICAgIH07CgogICAgdmFyIHJlc3VsdCA9IFtdOwogICAgZm9yICggdmFyIGkgPSAwOyBpIDwgbWF0Y2hlcnMubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgdmFyIG1zZiA9IGdldE1hdGNoU3ViRmllbGQoIG1hdGNoZXJzWyBpIF0gKTsKCiAgICAgICAgdGhpcy5lYWNoU3ViRmllbGQoIG1zZiwgZnVuY3Rpb24oIGZpZWxkLCBzdWJGaWVsZCApIHsKICAgICAgICAgICAgICAgIGlmICggc3ViRmllbGQudmFsdWUgIT09ICIiICYmIHN1YkZpZWxkLnZhbHVlICE9PSB1bmRlZmluZWQgKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goIHN1YkZpZWxkLnZhbHVlICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gKTsKICAgIH07CiAgICBpZiAoIHJlc3VsdC5sZW5ndGggPiAwICkgewogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICByZXR1cm4gWyBdOwp9OwoKLy8gU2VlIGRvYyBpbiBNYXJjQ2xhc3Nlcy51c2UuanMKRmllbGQucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24oIG1hdGNoZXIsIHNlcCApIHsKCiAgICB2YXIgbWF0Y2hlcnM7CgogICAgaWYgKCBtYXRjaGVyIGluc3RhbmNlb2YgQXJyYXkgKSB7CiAgICAgICAgbWF0Y2hlcnMgPSBtYXRjaGVyOwogICAgfSBlbHNlIHsKICAgICAgICBtYXRjaGVycyA9IFsgbWF0Y2hlciBdOwogICAgfTsKCiAgICB2YXIgcmVzdWx0ID0gIiI7CiAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBtYXRjaGVycy5sZW5ndGg7IGkrKyApIHsKICAgICAgICB2YXIgbXNmID0gZ2V0TWF0Y2hTdWJGaWVsZCggbWF0Y2hlcnNbIGkgXSApOwoKICAgICAgICB0aGlzLmVhY2hTdWJGaWVsZCggbXNmLCBmdW5jdGlvbiggZmllbGQsIHN1YkZpZWxkICkgewogICAgICAgICAgICAgICAgaWYgKCByZXN1bHQgPT09ICIiICkgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHN1YkZpZWxkLnZhbHVlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIHNlcCAhPT0gdW5kZWZpbmVkICYmIHJlc3VsdCAhPT0gIiIgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBzZXA7CiAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHN1YkZpZWxkLnZhbHVlOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSApOwoKICAgIH07CgogICAgcmV0dXJuIHJlc3VsdDsKfTsKCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzCkZpZWxkLnByb3RvdHlwZS5tYXRjaFZhbHVlID0gZnVuY3Rpb24oIG1hdGNoZXIsIHZhbHVlUmVnRXhwICkgewogICAgcmV0dXJuIHZhbHVlUmVnRXhwLnRlc3QoIHRoaXMuZ2V0VmFsdWUoIG1hdGNoZXIgKSApOwp9OwoKLy8gU2VlIGRvYyBpbiBNYXJjQ2xhc3Nlcy51c2UuanMKRmllbGQucHJvdG90eXBlLnJlbW92ZVdpdGhNYXRjaGVyID0gZnVuY3Rpb24oIG1hdGNoZXIgKSB7CiAgICB2YXIgbWF0Y2hlcnM7CgogICAgaWYgKCBtYXRjaGVyIGluc3RhbmNlb2YgQXJyYXkgKSB7CiAgICAgICAgbWF0Y2hlcnMgPSBtYXRjaGVyOwogICAgfSBlbHNlIHsKICAgICAgICBtYXRjaGVycyA9IFsgbWF0Y2hlciBdOwogICAgfTsKCiAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBtYXRjaGVycy5sZW5ndGg7IGkrKyApIHsKICAgICAgICB2YXIgbXNmID0gZ2V0TWF0Y2hTdWJGaWVsZCggbWF0Y2hlcnNbIGkgXSApOwoKICAgICAgICB2YXIgaiA9IDA7CiAgICAgICAgd2hpbGUgKCBqIDwgdGhpcy5zaXplKCApICkgewogICAgICAgICAgICBpZiAoIG1zZi5tYXRjaFN1YkZpZWxkKCB0aGlzLCB0aGlzLnN1YmZpZWxkKCBqICkgKSApIHsKICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKCBqICk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBqKys7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIHJldHVybiAiIjsKfTsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vICAgICAgICAgICAgUmVjb3JkIHByb3RvdHlwZXMKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzClJlY29yZC5wcm90b3R5cGUuZ2V0Rmlyc3RGaWVsZEFzRmllbGQgPSBmdW5jdGlvbiggcmVnRXhGaWVsZE1hdGNoZXIgKSB7CiAgICAvL2lmIGl0cyBub3QgYSByZWdleCBvYmogd2Ugc2hvdWxkIHByb2JhbGx5IHRocm93IGFuIGVycm9yIGluIHRoZSBmdXR1cmUgbXZzCiAgICAvL2lmICghcmVnRXhGaWVsZE1hdGNoZXIgaW5zdGFuY2VvZiBSZWdFeHAgICkgewogICAgLy8gIHJldHVybiAiIjsKICAgIC8vfQoKICAgIC8vInRoaXMiIHJlZmVycyB0byB0aGUgcmVjb3JkIG9iagogICAgdmFyIHNpemUgPSB0aGlzLm51bWJlck9mRmllbGRzKCApOwoKICAgIGZvciAoIHZhciBpID0gMDsgaSA8IHNpemU7IGkrKyApIHsKICAgICAgICBpZiAoIHRoaXMuZmllbGQoIGkgKS5uYW1lLm1hdGNoKCByZWdFeEZpZWxkTWF0Y2hlciApICkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5maWVsZCggaSApOwogICAgICAgIH0KICAgIH07CiAgICAvL3dlIHJldHVybiBhbiBlbXB0eSBzdHJpbmcgaWYgbm8gdmFsaWQgZmllbGRzIGFyZSBpbiB0aGUgcmVjb3JkcwogICAgcmV0dXJuICIiOwp9OwoKLy8gU2VlIGRvYyBpbiBNYXJjQ2xhc3Nlcy51c2UuanMKUmVjb3JkLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKCApIHsKICAgIHZhciBuZXdSZWNvcmQgPSBuZXcgUmVjb3JkOwoKICAgIG5ld1JlY29yZC5yZWNvcmRTdGF0dXMgPSB0aGlzLnJlY29yZFN0YXR1czsKICAgIG5ld1JlY29yZC5pbXBsZW1lbnRhdGlvbkNvZGVzID0gdGhpcy5pbXBsZW1lbnRhdGlvbkNvZGVzOwoKICAgIGZvciAoIHZhciBpID0gMDsgaSA8IHRoaXMuc2l6ZSggKTsgaSsrICkgewogICAgICAgIG5ld1JlY29yZC5hcHBlbmQoIHRoaXMuZmllbGQoIGkgKS5jbG9uZSggKSApOwogICAgfTsKCiAgICByZXR1cm4gbmV3UmVjb3JkOwp9OwoKLy8gU2VlIGRvYyBpbiBNYXJjQ2xhc3Nlcy51c2UuanMKUmVjb3JkLnByb3RvdHlwZS5lbXB0eSA9IGZ1bmN0aW9uKCApIHsKICAgIHJldHVybiB0aGlzLnNpemUoICkgPT09IDA7Cn07CgovLyBTZWUgZG9jIGluIE1hcmNDbGFzc2VzLnVzZS5qcwpSZWNvcmQucHJvdG90eXBlLmVhY2hGaWVsZCA9IGZ1bmN0aW9uKCBtYXRjaGVyLCBhcmcyLCBhcmczICkgewogICAgaWYgKCBhcmczICE9IHVuZGVmaW5lZCApIHsKICAgICAgICByZXR1cm4gbmV3IEVhY2hGYWN0b3J5KCB0aGlzLCBhcmcyICkuZWFjaEZpZWxkKCBnZXRNYXRjaEZpZWxkKCBtYXRjaGVyICksIGFyZzMgKTsKICAgIH07CiAgICByZXR1cm4gbmV3IEVhY2hGYWN0b3J5KCB0aGlzICkuZWFjaEZpZWxkKCBnZXRNYXRjaEZpZWxkKCBtYXRjaGVyICksIGFyZzIgKTsKfTsKCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzClJlY29yZC5wcm90b3R5cGUuZWFjaEZpZWxkTWFwID0gZnVuY3Rpb24oIG1hcCwgZXh0cmFEYXRhICkgewogICAgdmFyIG51bWZpZWxkcz10aGlzLnNpemUoKTsKICAgIGZvciAoIHZhciBpID0gMDsgaSA8IG51bWZpZWxkczsgaSsrICkgewogICAgICAgIHZhciBjdXJmaWVsZD10aGlzLmZpZWxkKCBpICk7CiAgICAgICAgdmFyIGZpZWxkRnVuY3Rpb25zID0gbWFwLmZ1bmN0aW9uc1tjdXJmaWVsZC5uYW1lXTsKICAgICAgICBpZiAoZmllbGRGdW5jdGlvbnMpIHsKICAgICAgICAgICAgdmFyIGxlbmd0aCA9IGZpZWxkRnVuY3Rpb25zLmxlbmd0aDsKICAgICAgICAgICAgTG9nLmRlYnVnKCJSZWNvcmQuZWFjaEZpZWxkTWFwIENhbGxpbmcgIiwgbGVuZ3RoLCAiIG1ldGhvZHMgZm9yIGZpZWxkICIsIGN1cmZpZWxkKTsKICAgICAgICAgICAgZm9yICh2YXIgaiA9IDAgOyBqIDwgbGVuZ3RoIDsgaisrKSB7CiAgICAgICAgICAgICAgICAoZmllbGRGdW5jdGlvbnNbal0pKGN1cmZpZWxkLCBleHRyYURhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKfTsKCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzClJlY29yZC5wcm90b3R5cGUuZWFjaEZpZWxkTWFwV2l0aERlZmF1bHQgPSBmdW5jdGlvbiggbWFwLGRlZmF1bHRGdW5jdGlvbiwgZXh0cmFEYXRhKSB7CgogICAgdmFyIG1hdGNoID0gewogICAgICAgIG1hdGNoRmllbGQ6IGZ1bmN0aW9uKHJlY29yZCwgZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgbnVtZmllbGRzPXRoaXMuc2l6ZSgpOwogICAgZm9yICggdmFyIGkgPSAwOyBpIDwgbnVtZmllbGRzOyBpKysgKSB7CiAgICAgICAgdmFyIGN1cmZpZWxkPXRoaXMuZmllbGQoIGkgKTsKCiAgICAgICAgdmFyIGZpZWxkRnVuY3Rpb25zID0gbWFwLmZ1bmN0aW9uc1tjdXJmaWVsZC5uYW1lXTsKCiAgICAgICAgaWYgKCBmaWVsZEZ1bmN0aW9ucyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGZpZWxkRnVuY3Rpb25zID0gW2RlZmF1bHRGdW5jdGlvbl07CiAgICAgICAgfQogICAgICAgIHZhciBsZW5ndGggPSBmaWVsZEZ1bmN0aW9ucy5sZW5ndGg7CiAgICAgICAgZm9yICh2YXIgZmluZGV4ID0gMCA7IGZpbmRleCA8IGxlbmd0aCA7IGZpbmRleCsrKSB7CiAgICAgICAgICAgIChmaWVsZEZ1bmN0aW9uc1tmaW5kZXhdKShjdXJmaWVsZCwgZXh0cmFEYXRhKTsKCiAgICAgICAgfQogICAgfQp9OwoKCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzClJlY29yZC5wcm90b3R5cGUuZmlyc3RGaWVsZCA9IGZ1bmN0aW9uKCBtYXRjaGVyLCBhcmcyLCBhcmczICkgewogICAgaWYgKCBhcmczICE9IHVuZGVmaW5lZCApIHsKICAgICAgICByZXR1cm4gbmV3IEVhY2hGYWN0b3J5KCB0aGlzLCBhcmcyICkuZmlyc3RGaWVsZCggZ2V0TWF0Y2hGaWVsZCggbWF0Y2hlciApLCBhcmczICk7CiAgICB9OwoKICAgIHJldHVybiBuZXcgRWFjaEZhY3RvcnkoIHRoaXMgKS5maXJzdEZpZWxkKCBnZXRNYXRjaEZpZWxkKCBtYXRjaGVyICksIGFyZzIgKTsKfTsKCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzClJlY29yZC5wcm90b3R5cGUuZWFjaEZpZWxkU2VxdWVuY2UgPSBmdW5jdGlvbiggbWF0Y2hlcnMsIGFyZzIsIGFyZzMgKSB7CiAgICBpZiAoIGFyZzMgIT0gdW5kZWZpbmVkICkgewogICAgICAgIHJldHVybiBuZXcgRWFjaEZhY3RvcnkoIHRoaXMsIGFyZzIgKS5lYWNoRmllbGRTZXF1ZW5jZSggbWF0Y2hlcnMsIGFyZzMgKTsKICAgIH07CgogICAgcmV0dXJuIG5ldyBFYWNoRmFjdG9yeSggdGhpcyApLmVhY2hGaWVsZFNlcXVlbmNlKCBtYXRjaGVycywgYXJnMiApOwp9OwoKLy8gU2VlIGRvYyBpbiBNYXJjQ2xhc3Nlcy51c2UuanMKUmVjb3JkLnByb3RvdHlwZS5zZWxlY3RGaWVsZHMgPSBmdW5jdGlvbiggbWF0Y2hlciwgc29ydGVycyApIHsKICAgIHJldHVybiBuZXcgRWFjaEZhY3RvcnkoIHRoaXMsIHNvcnRlcnMgKS5zZWxlY3RGaWVsZHMoIGdldE1hdGNoRmllbGQoIG1hdGNoZXIgKSApOwp9OwoKLy8gU2VlIGRvYyBpbiBNYXJjQ2xhc3Nlcy51c2UuanMKUmVjb3JkLnByb3RvdHlwZS5zZWxlY3RGaWVsZHNTZXF1ZW5jZSA9IGZ1bmN0aW9uKCBtYXRjaGVyLCBzb3J0ZXJzICkgewogICAgcmV0dXJuIG5ldyBFYWNoRmFjdG9yeSggdGhpcywgc29ydGVycyApLnNlbGVjdEZpZWxkc1NlcXVlbmNlKCBtYXRjaGVyICk7Cn07CgovLyBTZWUgZG9jIGluIE1hcmNDbGFzc2VzLnVzZS5qcwpSZWNvcmQucHJvdG90eXBlLnNpemUgPSBmdW5jdGlvbiggKSB7CiAgICByZXR1cm4gdGhpcy5udW1iZXJPZkZpZWxkcyggKTsKfTsKCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzClJlY29yZC5wcm90b3R5cGUuZXhpc3RGaWVsZCA9IGZ1bmN0aW9uKCBtYXRjaGVyICkgewogICAgdmFyIHJlc3VsdCA9IGZhbHNlOwoKCXZhciBkb01hdGNoZXIgPSBnZXRNYXRjaEZpZWxkKCBtYXRjaGVyICk7CglpZiAoIGRvTWF0Y2hlciA9PT0gdW5kZWZpbmVkICkgewoJCQkvLyBRdWVzdGlvbiBpcyBpZiB0aGlzIGJlaGF2aW91ciBtYWtlcyBzZW5zZQoJCQlyZXR1cm4gdHJ1ZTsKCX0KCgl2YXIgc3RvcHBlciA9IHRoaXMuc2l6ZSgpOwogICAgZm9yICggdmFyIGkgPSAwOyBpIDwgc3RvcHBlcjsgaSsrICkgewogICAgICAgIGlmICggZG9NYXRjaGVyLm1hdGNoRmllbGQoIHRoaXMsIHRoaXMuZmllbGQoIGkgKSApICkgewoJCQlyZXR1cm4gdHJ1ZTsKICAgICAgICB9OwogICAgfTsKCiAgICByZXR1cm4gcmVzdWx0Owp9OwoKLy8gU2VlIGRvYyBpbiBNYXJjQ2xhc3Nlcy51c2UuanMKUmVjb3JkLnByb3RvdHlwZS5pc1VuaXF1ZSA9IGZ1bmN0aW9uKCBtYXRjaGVyICkgewogICAgcmV0dXJuIHRoaXMuZWFjaEZpZWxkKCBnZXRNYXRjaEZpZWxkKCBtYXRjaGVyICksIGZ1bmN0aW9uKCBmaWVsZCApIHsKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfSApID09IDE7Cn07CgovLyBTZWUgZG9jIGluIE1hcmNDbGFzc2VzLnVzZS5qcwpSZWNvcmQucHJvdG90eXBlLmdldEZpcnN0VmFsdWUgPSBmdW5jdGlvbiggZmllbGRNYXRjaGVyLCBzdWJGaWVsZE1hdGNoZXIgKSB7CgogICAgdmFyIHJlc3VsdCA9IHRoaXMuZmlyc3RGaWVsZCggZ2V0TWF0Y2hGaWVsZCggZmllbGRNYXRjaGVyICksIGZ1bmN0aW9uKCBmaWVsZCApIHsKICAgICAgICAgICAgaWYgKCAiIiAhPSBmaWVsZC5nZXRGaXJzdFZhbHVlKCBzdWJGaWVsZE1hdGNoZXIgKSApIHsKICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZC5nZXRGaXJzdFZhbHVlKCBzdWJGaWVsZE1hdGNoZXIgKTsKICAgICAgICAgICAgfQogICAgICAgIH0gKTsKICAgIGlmICggIiIgIT0gcmVzdWx0ICYmIHVuZGVmaW5lZCAhPT0gcmVzdWx0ICkgewogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAiIjsKICAgIH07Cn07CgovLyBTZWUgZG9jIGluIE1hcmNDbGFzc2VzLnVzZS5qcwpSZWNvcmQucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24oIGZpZWxkTWF0Y2hlciwgc3ViRmllbGRNYXRjaGVyLCBzZXAgKSB7CiAgICB2YXIgcmVzdWx0ID0gIiI7CgogICAgdGhpcy5lYWNoRmllbGQoIGdldE1hdGNoRmllbGQoIGZpZWxkTWF0Y2hlciApLCBmdW5jdGlvbiggZmllbGQgKSB7CiAgICAgICAgICAgIGlmICggc2VwICE9PSB1bmRlZmluZWQgJiYgcmVzdWx0ICE9PSAiIiApIHsKICAgICAgICAgICAgICAgIHJlc3VsdCArPSBzZXA7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICByZXN1bHQgKz0gZmllbGQuZ2V0VmFsdWUoIHN1YkZpZWxkTWF0Y2hlciwgc2VwICk7CiAgICAgICAgfSApOwoKICAgIHJldHVybiByZXN1bHQ7Cn07CgovLyBTZWUgZG9jIGluIE1hcmNDbGFzc2VzLnVzZS5qcwpSZWNvcmQucHJvdG90eXBlLm1hdGNoVmFsdWUgPSBmdW5jdGlvbiggZmllbGRNYXRjaGVyLCBzdWJGaWVsZE1hdGNoZXIsIHZhbHVlUmVnRXhwICkgewogICAgcmV0dXJuIHZhbHVlUmVnRXhwLnRlc3QoIHRoaXMuZ2V0VmFsdWUoIGZpZWxkTWF0Y2hlciwgc3ViRmllbGRNYXRjaGVyICkgKTsKfTsKCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzClJlY29yZC5wcm90b3R5cGUucmVtb3ZlV2l0aE1hdGNoZXIgPSBmdW5jdGlvbiggbWF0Y2hlciApIHsKICAgIHZhciBtYXRjaGVyczsKCiAgICBpZiAoIG1hdGNoZXIgaW5zdGFuY2VvZiBBcnJheSApIHsKICAgICAgICBtYXRjaGVycyA9IG1hdGNoZXI7CiAgICB9IGVsc2UgewogICAgICAgIG1hdGNoZXJzID0gWyBtYXRjaGVyIF07CiAgICB9OwoKICAgIGZvciAoIHZhciBpID0gMDsgaSA8IG1hdGNoZXJzLmxlbmd0aDsgaSsrICkgewogICAgICAgIHZhciBtc2YgPSBnZXRNYXRjaEZpZWxkKCBtYXRjaGVyc1sgaSBdICk7CgogICAgICAgIHZhciBqID0gMDsKICAgICAgICB3aGlsZSAoIGogPCB0aGlzLnNpemUoICkgKSB7CiAgICAgICAgICAgIGlmICggbXNmLm1hdGNoRmllbGQoIHRoaXMsIHRoaXMuZmllbGQoIGogKSApICkgewogICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoIGogKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGorKzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07Cn07CgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICBFYWNoRmFjdG9yeSBjbGFzcwovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKZnVuY3Rpb24gRWFjaEZhY3RvcnkoIHJlY29yZCwgc29ydGVyICkgewogICAgdGhpcy5yZWNvcmQgPSByZWNvcmQ7CiAgICB0aGlzLnNvcnRlciA9IHNvcnRlcjsKfTsKCkVhY2hGYWN0b3J5LnByb3RvdHlwZS5lYWNoRmllbGQgPSBmdW5jdGlvbiggbWF0Y2hlciwgaGFuZGxlciApIHsKICAgIHZhciByZXN1bHQgPSAiIjsKICAgIHZhciBmaWVsZHMgPSB0aGlzLnNlbGVjdEZpZWxkcyggbWF0Y2hlciApOwoKICAgIGlmICggdGhpcy5zb3J0ZXIgIT0gdW5kZWZpbmVkICkgewogICAgICAgIHZhciBzb3J0ZXIgPSBuZXcgU29ydGVyKCB0aGlzLnNvcnRlciApOwoKICAgICAgICBmaWVsZHMuc29ydCggZnVuY3Rpb24oIGEsIGIgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc29ydGVyLnNvcnQoIGEsIGIgKTsKICAgICAgICAgICAgfSApOwogICAgfTsKCiAgICB2YXIgZmlyc3QgPSB0cnVlOwogICAgZm9yICggdmFyIGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrICkgewogICAgICAgIGlmICggZmlyc3QgKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuY2FsbEZpZWxkSGFuZGxlciggaGFuZGxlciwgZmllbGRzWyBpIF0gKTsKICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHQgKz0gdGhpcy5jYWxsRmllbGRIYW5kbGVyKCBoYW5kbGVyLCBmaWVsZHNbIGkgXSApOwogICAgICAgIH07CiAgICB9OwoKICAgIHJldHVybiByZXN1bHQ7Cn07CgpFYWNoRmFjdG9yeS5wcm90b3R5cGUuZmlyc3RGaWVsZCA9IGZ1bmN0aW9uKCBtYXRjaGVyLCBoYW5kbGVyICkgewoKICAgIHZhciByZXN1bHQgPSAiIjsKICAgIHZhciBmaWVsZHMgPSB0aGlzLnNlbGVjdEZpZWxkcyggbWF0Y2hlciApOwoKICAgIGlmICggdGhpcy5zb3J0ZXIgIT0gdW5kZWZpbmVkICkgewogICAgICAgIHZhciBzb3J0ZXIgPSBuZXcgU29ydGVyKCB0aGlzLnNvcnRlciApOwoKICAgICAgICBmaWVsZHMuc29ydCggZnVuY3Rpb24oIGEsIGIgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc29ydGVyLnNvcnQoIGEsIGIgKTsKICAgICAgICAgICAgfSApOwogICAgfTsKCiAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgcmVzdWx0ID0gdGhpcy5jYWxsRmllbGRIYW5kbGVyKCBoYW5kbGVyLCBmaWVsZHNbIGkgXSApOwogICAgICAgIGlmICggIiIgIT0gcmVzdWx0ICYmIHVuZGVmaW5lZCAhPT0gcmVzdWx0ICkgewogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgIH07CiAgICByZXR1cm4gcmVzdWx0Owp9OwoKRWFjaEZhY3RvcnkucHJvdG90eXBlLmVhY2hGaWVsZFNlcXVlbmNlID0gZnVuY3Rpb24oIG1hdGNoZXJzLCBoYW5kbGVyICkgewogICAgdmFyIHJlc3VsdCA9ICIiOwogICAgdmFyIG1heCA9IDA7CiAgICB2YXIgc2VxcyA9IG5ldyBBcnJheTsKCiAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBtYXRjaGVycy5sZW5ndGg7IGkrKyApIHsKICAgICAgICB2YXIgc2VxID0gdGhpcy5zZWxlY3RGaWVsZHMoIG1hdGNoZXJzWyBpIF0gKTsKCiAgICAgICAgaWYgKCB0aGlzLnNvcnRlciAhPSB1bmRlZmluZWQgKSB7CiAgICAgICAgICAgIHZhciBzb3J0ZXIgPSBuZXcgU29ydGVyKCB0aGlzLnNvcnRlciApOwoKICAgICAgICAgICAgc2VxLnNvcnQoIGZ1bmN0aW9uKCBhLCBiICkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzb3J0ZXIuc29ydCggYSwgYiApOwogICAgICAgICAgICAgICAgfSApOwogICAgICAgIH07CgogICAgICAgIHNlcXMucHVzaCggc2VxICk7CgogICAgICAgIGlmICggbWF4IDwgc2VxLmxlbmd0aCApIHsKICAgICAgICAgICAgbWF4ID0gc2VxLmxlbmd0aDsKICAgICAgICB9OwogICAgfTsKCiAgICB2YXIgZmlyc3QgPSB0cnVlOwogICAgZm9yICggdmFyIGkgPSAwOyBpIDwgbWF4OyBpKysgKSB7CiAgICAgICAgZm9yICggdmFyIHNlcSA9IDA7IHNlcSA8IHNlcXMubGVuZ3RoOyBzZXErKyApIHsKICAgICAgICAgICAgaWYgKCBpIDwgc2Vxc1sgc2VxIF0ubGVuZ3RoICkgewogICAgICAgICAgICAgICAgaWYgKCBmaXJzdCApIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLmNhbGxGaWVsZEhhbmRsZXIoIGhhbmRsZXIsIHNlcXNbIHNlcSBdWyBpIF0gKTsKICAgICAgICAgICAgICAgICAgICBmaXJzdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gdGhpcy5jYWxsRmllbGRIYW5kbGVyKCBoYW5kbGVyLCBzZXFzWyBzZXEgXVsgaSBdICk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9OwogICAgICAgIH07CiAgICB9OwoKICAgIHJldHVybiByZXN1bHQ7Cn07CgpFYWNoRmFjdG9yeS5wcm90b3R5cGUuZmlyc3RTdWJGaWVsZCA9IGZ1bmN0aW9uKCBmaWVsZCwgbWF0Y2hlciwgaGFuZGxlciApIHsKCiAgICB2YXIgcmVzdWx0ID0gIiI7CgogICAgZm9yICggdmFyIGkgPSAwOyBpIDwgZmllbGQuY291bnQoICk7IGkrKyApIHsKICAgICAgICBpZiAoIG1hdGNoZXIgPT0gdW5kZWZpbmVkIHx8IG1hdGNoZXIubWF0Y2hTdWJGaWVsZCggZmllbGQsIGZpZWxkLnN1YmZpZWxkKCBpICkgKSApIHsKICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5jYWxsU3ViRmllbGRIYW5kbGVyKCBoYW5kbGVyLCBmaWVsZCwgZmllbGQuc3ViZmllbGQoIGkgKSApOwogICAgICAgICAgICBpZiAoICIiICE9IHJlc3VsdCApIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfTsKCiAgICBpZiAoIHJlc3VsdCA9PT0gdW5kZWZpbmVkICkge30gZWxzZSB7CgogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKfTsKRWFjaEZhY3RvcnkucHJvdG90eXBlLmVhY2hTdWJGaWVsZCA9IGZ1bmN0aW9uKCBmaWVsZCwgbWF0Y2hlciwgaGFuZGxlciApIHsKCiAgICB2YXIgcmVzdWx0ID0gIiI7CgoKICAgIHZhciBmaXJzdCA9IHRydWU7CiAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBmaWVsZC5jb3VudCggKTsgaSsrICkgewogICAgICAgIGlmICggbWF0Y2hlciA9PSB1bmRlZmluZWQgfHwgbWF0Y2hlci5tYXRjaFN1YkZpZWxkKCBmaWVsZCwgZmllbGQuc3ViZmllbGQoIGkgKSApICkgewogICAgICAgICAgICBpZiAoIGZpcnN0ICkgewogICAgICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5jYWxsU3ViRmllbGRIYW5kbGVyKCBoYW5kbGVyLCBmaWVsZCwgZmllbGQuc3ViZmllbGQoIGkgKSApOwogICAgICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlc3VsdCArPSB0aGlzLmNhbGxTdWJGaWVsZEhhbmRsZXIoIGhhbmRsZXIsIGZpZWxkLCBmaWVsZC5zdWJmaWVsZCggaSApICk7CiAgICAgICAgICAgIH07CiAgICAgICAgfTsKICAgIH07CgogICAgcmV0dXJuIHJlc3VsdDsKfTsKCkVhY2hGYWN0b3J5LnByb3RvdHlwZS5lYWNoU3ViRmllbGRTZXF1ZW5jZSA9IGZ1bmN0aW9uKCBmaWVsZCwgbWF0Y2hlcnMsIGhhbmRsZXIgKSB7CiAgICB2YXIgcmVzdWx0ID0gIiI7CgogICAgdmFyIGZpcnN0ID0gdHJ1ZTsKICAgIGZvciAoIHZhciBpID0gMDsgaSA8IG1hdGNoZXJzLmxlbmd0aDsgaSsrICkgewogICAgICAgIGlmICggZmlyc3QgKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuZWFjaFN1YkZpZWxkKCBmaWVsZCwgbWF0Y2hlcnNbIGkgXSwgaGFuZGxlciApOwogICAgICAgICAgICBmaXJzdCA9IGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlc3VsdCArPSB0aGlzLmVhY2hTdWJGaWVsZCggZmllbGQsIG1hdGNoZXJzWyBpIF0sIGhhbmRsZXIgKTsKICAgICAgICB9OwogICAgfTsKCiAgICByZXR1cm4gcmVzdWx0Owp9OwoKCgpFYWNoRmFjdG9yeS5wcm90b3R5cGUuc2VsZWN0RmllbGRzID0gZnVuY3Rpb24oIG1hdGNoZXIgKSB7CiAgICB2YXIgbGlzdCA9IG5ldyBBcnJheTsKCiAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCB0aGlzLnJlY29yZC5zaXplKCApOyBpKysgKSB7CiAgICAgICAgaWYgKCBtYXRjaGVyID09PSB1bmRlZmluZWQgfHwgbWF0Y2hlci5tYXRjaEZpZWxkKCB0aGlzLnJlY29yZCwgdGhpcy5yZWNvcmQuZmllbGQoIGkgKSApICkgewogICAgICAgICAgICBsaXN0LnB1c2goIHRoaXMucmVjb3JkLmZpZWxkKCBpICkgKTsKICAgICAgICB9OwogICAgfTsKCiAgICByZXR1cm4gbGlzdDsKfTsKCkVhY2hGYWN0b3J5LnByb3RvdHlwZS5zZWxlY3RGaWVsZHNTZXF1ZW5jZSA9IGZ1bmN0aW9uKCBtYXRjaGVycyApIHsKICAgIHZhciBsaXN0ID0gbmV3IEFycmF5OwoKICAgIGZvciAoIHZhciBpID0gMDsgaSA8IG1hdGNoZXJzLmxlbmd0aDsgaSsrICkgewogICAgICAgIGxpc3QgPSBsaXN0LmNvbmNhdCggdGhpcy5zZWxlY3RGaWVsZHMoIG1hdGNoZXJzWyBpIF0gKSApOwogICAgfTsKCiAgICByZXR1cm4gbGlzdDsKfTsKCkVhY2hGYWN0b3J5LnByb3RvdHlwZS5jYWxsRmllbGRIYW5kbGVyID0gZnVuY3Rpb24oIGhhbmRsZXIsIHJlY29yZCwgZmllbGQgKSB7CiAgICBpZiAoIGhhbmRsZXIgaW5zdGFuY2VvZiBIYW5kbGVyICkgewogICAgICAgIHJldHVybiBoYW5kbGVyLmZ1bmMuY2FsbCggaGFuZGxlci50aGlzT2JqLCByZWNvcmQsIGZpZWxkICk7CiAgICB9OwoKICAgIHJldHVybiBoYW5kbGVyKCByZWNvcmQsIGZpZWxkICk7Cn07CgpFYWNoRmFjdG9yeS5wcm90b3R5cGUuY2FsbFN1YkZpZWxkSGFuZGxlciA9IGZ1bmN0aW9uKCBoYW5kbGVyLCBmaWVsZCwgc3ViRmllbGQgKSB7CiAgICBpZiAoIGhhbmRsZXIgaW5zdGFuY2VvZiBIYW5kbGVyICkgewogICAgICAgIHJldHVybiBoYW5kbGVyLmZ1bmMuY2FsbCggaGFuZGxlci50aGlzT2JqLCBmaWVsZCwgc3ViRmllbGQgKTsKICAgIH07CgogICAgcmV0dXJuIGhhbmRsZXIoIGZpZWxkLCBzdWJGaWVsZCApOwp9OwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgSGFuZGxlciBjbGFzcwovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKLyoqIERlZmluZXMgYSBoYW5kbGVyIG9iamVjdCB0aGVuIHdlIGl0ZXJhdGUgb3ZlciBmaWVsZHMgb3Igc3ViIGZpZWxkcyB3aXRoIFJlY29yZC5lYWNoRmllbGQsCiAqIEZpZWxkLmVhY2hTdWJGaWVsZHMsIGV0Yy4KICoKICogQHBhcmFtIHtPYmplY3R9IFt0aGlzT2JqXSBUaGlzIGlzIHRoZSBvYmplY3QgdGhhdCB3aWxsIGJlIHBhc3NlZCBhcyB0aGUgInRoaXMiIG9iamVjdCwgdGhlbiB0aGUgZnVuY3Rpb24KICogCQkgIGlzIGludm9rZWQuIFRoaXMgbG9naWMgaXMgaW1wbGVtZW50YXRlZCBpbiB0aGUgRWFjaEZhY3RvcnkgdHlwZS4KICogQHBhcmFtIHtGdW5jdGlvbn0gW2Z1bmNdIFRoZSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgaW52b2tlZCBmb3IgZWFjaCBGaWVsZCBvciBTdWJmaWVsZCBpbiBhIHJlY29yZC4KICogQGNvbnN0cnVjdG9yCiAqIEBzZWUgTWFyY0NsYXNzZXMKICogQHNlZSBSZWNvcmQKICogQHNlZSBGaWVsZAogKiBAbmFtZSBIYW5kbGVyICovCmZ1bmN0aW9uIEhhbmRsZXIoIHRoaXNPYmosIGZ1bmMgKSB7CiAgICB0aGlzLnRoaXNPYmogPSB0aGlzT2JqOwogICAgdGhpcy5mdW5jID0gZnVuYzsKfTsKCg==", "moduleName": "Marc"}, {"javascript": "LyoqIEBmaWxlIGRvY3VtZW50YXRpb24gZm9yIFJlY29yZCwgRmllbGQgYW5kIFN1YmZpZWxkICovCi8vIFRoaXMgaXMgbm90IGFjdHVhbGx5IHRoZSBNYXJjQ2xhc3NlcyAoUmVjb3JkLCBGaWVsZCwgU3ViZmllbGQpLCAKLy8gYnV0IHJhdGhlciB0aGUgZG9jdW1lbnRhdGlvbiBvZiB0aGVtLgovLyBUaGUgYWN0dWFsIGltcGxlbWVudGF0aW9uIGlzIGluIE1hcmNDbGFzc2VzQ29yZS4KCnVzZSggIlN5c3RlbSIgKTsKdXNlKCAiTWFyY0NsYXNzZXNDb3JlIiApOwoKRVhQT1JURURfU1lNQk9MUyA9IFsiTWFyY0NsYXNzZXMiXTsKCgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyBET0NVTUVOVEFUSU9OCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgovKiogTW9kdWxlIHRvIGFsbG93IHJlcHJlc2VudGF0aW9uIG9mIE1hcmMgb2JqZWN0cy4KICoKICogSW4gb3JkZXIgdG8gYWxsb3cgcmVwcmVzZW50YXRpb25zIG9mIE1hcmMgb2JqZWN0cywgdGhlIE1hcmNDbGFzc2VzCiAqIG1vZHVsZSBleHBvc2VzIHRocmVlIGNsYXNzZXM6IFJlY29yZCwgRmllbGQgYW5kIFN1YmZpZWxkLiBUaGV5CiAqIHJlcHJlc2VudCBhIE1hcmMgcmVjb3JkLCBmaWVsZCBhbmQgc3ViZmllbGQgcmVzcGVjdGl2ZWx5LgogKgogKiBBbHRob3VnaCBNYXJjQ2xhc3NlcyBpcyBwcmVzZW50ZWQgYXMgYSBuYW1lc3BhY2UsIHRoZSBSZWNvcmQsIEZpZWxkCiAqIGFuZCBTdWJmaWVsZCBjbGFzc2VzIGxpdmUgaW4gdGhlIGdsb2JhbCBuYW1lc3BhY2UuIFRoaXMgaXMgZm9yCiAqIGhpc3RvcmljYWwgcmVhc29ucyAtIHRoZXNlIGNsYXNzZXMgd2VyZSBpbnRyb2R1Y2VkIGludG8gdGhlIERCQwogKiBKYXZhU2NyaXB0IHN5c3RlbSBiZWZvcmUgbW9kdWxlIHN1cHBvcnQgd2FzIGVzdGFibGlzaGVkLgogKgogKiBAc2VlIFJlY29yZAogKiBAc2VlIEZpZWxkCiAqIEBzZWUgU3ViZmllbGQKICogQG5hbWUgTWFyY0NsYXNzZXMKICogQG5hbWVzcGFjZSAqLwpNYXJjQ2xhc3NlcyA9ICggZnVuY3Rpb24oKSB7CiAgICB2YXIgZXhwb3J0cyA9IHt9OwogICAgZXhwb3J0cy5SZWNvcmQgPSBSZWNvcmQ7CiAgICBleHBvcnRzLkZpZWxkID0gRmllbGQ7CiAgICBleHBvcnRzLlN1YmZpZWxkID0gU3ViZmllbGQ7CiAgICByZXR1cm4gZXhwb3J0czsKfSgpICk7CgoKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyBSRUNPUkQKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKLy8gTm90ZSwgdGhhdCBhIGxvdCBwcm9wZXJ0aWVzIGlzIGFzc2lnbmVkIHRvIHRoZSBjb25zdHJ1Y3RvciwgdG8gaGF2ZSBzb21ldGhpbmcKLy8gdG8gYXR0YWNoIHRoZSBkb2N1bWVudGF0aW9uIHRvLgoKLyoqIEFic3RyYWN0aW9uIGZvciBhIE1hcmMgcmVjb3JkLgogKgogKiBUaGUgUmVjb3JkIGNsYXNzIGlzIGFuIGFic3RyYWN0aW9uIGZvciBhIE1hcmMgcmVjb3JkLgogKgogKiBJdCBjb250YWlucyBhIG51bWJlciBvZiBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzIHRvIHJlcHJlc2VudCBhbmQKICogbWFuaXB1bGF0ZSBhIHJlY29yZCwgaW5jbHVkaW5nIHRoZSBoZWFkZXIuCiAqCiAqIEBleGFtcGxlIC8vIFlvdSBjb25zdHJ1Y3QgYSBuZXcgUmVjb3JkIGluc3RhbmNlIGxpa2UgdGhpczoKIHZhciByID0gbmV3IFJlY29yZCgpOwogKgogKiBAbmFtZSBSZWNvcmQKICogQGNvbnN0cnVjdG9yCiAqIEBzZWUgTWFyY0NsYXNzZXMKICogQHNlZSBGaWVsZAogKiBAc2VlIFN1YmZpZWxkICovCi8vIERvIG5vdCByZW1vdmUgdGhpcyBjb21tZW50CgovLyBQUk9QRVJUSUVTCgovKiogVGhlIGZvclVzZXJTeXN0ZW1zIHByb3BlcnR5IG9mIHRoZSByZWNvcmQuCiAqCiAqIFRoaXMgcHJvcGVydHkgaG9sZHMgdGhlIGZvclVzZXJTeXN0ZW1zIHN0cmluZyBmb3IgdGhlIHJlY29yZC4KICoKICogQHR5cGUge3N0cmluZ30KICogQG5hbWUgUmVjb3JkLmZvclVzZXJTeXN0ZW1zCiAqIEBuYW1lIFJlY29yZCNmb3JVc2VyU3lzdGVtcyAqLwpSZWNvcmQuZm9yVXNlclN5c3RlbXMgPSBuZXcgU3RyaW5nKCk7CgovKiogVGhlIGltcGxlbWVudGF0aW9uIGNvZGVzIG9mIHRoZSByZWNvcmQuCiAqCiAqIFRoaXMgcHJvcGVydHkgaG9sZHMgdGhlIGltcGxlbWVudGF0aW9uIGNvZGVzIGZvciB0aGUgcmVjb3JkLCBhcyBhIHN0cmluZy4KICoKICogQHR5cGUge3N0cmluZ30KICogQG5hbWUgUmVjb3JkLmltcGxlbWVudGF0aW9uQ29kZXMKICogQG5hbWUgUmVjb3JkI2ltcGxlbWVudGF0aW9uQ29kZXMgKi8KUmVjb3JkLmltcGxlbWVudGF0aW9uQ29kZXMgPSBuZXcgU3RyaW5nKCk7CgovKiogVGhlIHN0YXR1cyBvZiB0aGUgcmVjb3JkLgogKgogKiBUaGlzIHByb3BlcnR5IGhvbGRzIHRoZSBzdGF0dXMgb2YgdGhlIHJlY29yZCBhcyBhIHN0cmluZyB3aXRoIGEgc2luZ2xlIGNoYXJhY3RlciBpbi4KICoKICogQHR5cGUge3N0cmluZ30KICogQG5hbWUgUmVjb3JkLnJlY29yZFN0YXR1cwogKiBAbmFtZSBSZWNvcmQjcmVjb3JkU3RhdHVzICovClJlY29yZC5yZWNvcmRTdGF0dXMgPSBuZXcgU3RyaW5nKCk7CgovLyBNRVRIT0RTCgovKiogQWRkcyBhIGZpZWxkIHRvIHRoZSByZWNvcmQuCiAqCiAqIFRoaXMgbWV0aG9kIGFkZHMgYSBmaWVsZCB0byB0aGUgcmVjb3JkLgogKgogKiBJdCBjYW4gYmUgY2FsbGVkIHdpdGggZWl0aGVyIGEgRmllbGQgaW5zdGFuY2UsIG9yIHR3byBTdHJpbmdzLgogKgogKiBJZiBjYWxsZWQgd2l0aCBhIEZpZWxkIGluc3RhbmNlLCB0aGUgaW5zdGFuY2UgaXMgY29waWVkIHRvIHRoZSByZWNvcmQuCiAqCiAqIElmIGNhbGxlZCB3aXRoIHR3byBTdHJpbmdzLCBhIG5ldyBGaWVsZCBpbnN0YW5jZSB3aWxsIGJlIGNyZWF0ZWQsCiAqIGJhc2VkIG9uIHRoZSB2YWx1ZSBvZiB0aGUgc3RyaW5ncywgYW5kIGFwcGVuZGVkIHRvIHRoZSByZWNvcmQuIFRoZQogKiBmaXJzdCBzdHJpbmcgaXMgdGhlbiB0aGUgbmFtZSBvZiB0aGUgZmllbGQsIHRoZSBzZWNvbmQgdGhlIGZpZWxkCiAqIGluZGljYXRvci4KICoKICogKipOb3RlOioqIEZvciB0aGUgQysrIGltcGxlbWVudGF0aW9uOiBBbnkgcmVmZXJlbmNlIHRvIGV4aXN0aW5nCiAqIGZpZWxkcyBvbiB0aGlzIHJlY29yZCBtYXkgYmUgaW52YWxpZGF0ZWQgYnkgYXBwZW5kIGEgZmllbGQuIFRoaXMKICogaGFzIGEgbnVtYmVyIG9mIHBvdGVudGlhbCBiYWQgY29uc2VxdWVuY2VzLCBtb3N0IG9mIHdoaWNoIGxlYWRzIHRvCiAqIGNyYXNoZXMgb3IgdW5wcmVkaWN0YWJsZSBiZWhhdmlvdXIuIEl0IGlzIGVhc3kgdG8gZmFsbCBpbnRvIHRoZQogKiB0cmFwIG9mIGUuZy4gaXRlcmF0aW5nIGFsbCBmaWVsZHMgaW4gYSByZWNvcmQsIGFuZCBhcHBlbmQgc29tZQogKiB3aGlsZSBpdGVyYXRpbmcuIFRoaXMgaXMgYWxtb3N0IGNlcnRhaW4gdG8gbWFrZSB5b3VyIGFwcGxpY2F0aW9uCiAqIGNyYXNoLiBJbnN0ZWFkLCBjb2xsZWN0IHRoZSBuZXcgZmllbGRzIHlvdSB3aXNoIHRvIGFwcGVuZCwgdGhlbgogKiBhcHBlbmQgdGhlbSBhZnRlciB5b3VyIG1haW4gaXRlcmF0aW9uLgogKgogKiBAZXhhbXBsZQogLy8gQXBwZW5kIGFuIGV4aXN0aW5nIGZpZWxkIHRvIGEgcmVjb3JkIChmaWVsZCB3aWxsIGJlIGNvcGllZCkKIGFSZWNvcmQuYXBwZW5kKCBmaWVsZCApOwogLy8gQ3JlYXRlIGEgbmV3IGZpZWxkLCBhbmQgYXBwZW5kIGl0IHRvIHRoZSByZWNvcmQKIGFSZWNvcmQuYXBwZW5kKCAiMDEwIiwgIjAyIiApOwogKiBAZXhhbXBsZQogLy8gVGhpcyBleGFtcGxlIGlsbHVzdHJhdGVzIHRoZSByZWxhdGlvbiBiZXR3ZWVuIGV4aXN0aW5nIHJlZmVyZW5jZXMsIGFuZCBuZXcgRmllbGRzLgogdmFyIGFSZWNvcmQgPSBuZXcgUmVjb3JkKCk7CiBhUmVjb3JkLmFwcGVuZCggIjAwMSIsICIwMiIgKTsKIHZhciBhRmllbGQgPSBhUmVjb3JkLmZpZWxkKCAiMDAxIiApOwogYUZpZWxkLm5hbWUgPSAiMDAyIiAvLyBDaGFuZ2VzIHRoZSBuYW1lIG9mIHRoZSBmaWVsZCBpbiBhUmVjb3JkCiB2YXIgbmV3UmVjb3JkID0gbmV3IFJlY29yZCgpOwogbmV3UmVjb3JkLmFwcGVuZCggYUZpZWxkICk7IC8vIGFGaWVsZCBpcyBjb3BpZWQgaW50byBuZXdSZWNvcmQKIGFGaWVsZC5uYW1lID0gIjAwMSIgLy8gQ2hhbmdlcyB0aGUgbmFtZSBvZiB0aGUgZmllbGQgaW4gYVJlY29yZCwgYnV0IG5vdCBpbiBuZXdSZWNvcmQuCiAqCiAqIEBwYXJhbSB7RmllbGR8c3RyaW5nfSBmaWVsZE9yRmllbGROYW1lIEEgRmllbGQgaW5zdGFuY2UgdG8gYWRkLCBvciB0aGUgbmFtZSBvZiBhIG5ldyBmaWVsZCB0byBjb25zdHJ1Y3QgYW5kIGFkZAogKiBAcGFyYW0ge3N0cmluZ30gW2ZpZWxkSW5kaWNhdG9yXSBUaGUgaW5kaWNhdG9yIHZhbHVlIG9mIHRoZSBuZXcgRmllbGQgdG8gYWRkLiAqTXVzdCBiZSBwcm92aWRlZCwgaWYgZmllbGRPckZpZWxkTmFtZSBpcyBhIHN0cmluZyBpbnN0YW5jZSB3aXRoIHRoZSBuYW1lIG9mIGEgZmllbGQuKgogKiBAbWV0aG9kCiAqIEBuYW1lIFJlY29yZC5hcHBlbmQKICogQG5hbWUgUmVjb3JkI2FwcGVuZCAqLwpSZWNvcmQuYXBwZW5kID0gbmV3IFN0cmluZygpOwoKLyoqIENyZWF0ZSBhIGNsb25lIChjb3B5KSBvZiB0aGlzIHJlY29yZC4KICoKICogQWxsIHRoZSBmaWVsZHMgb2YgdGhpcyBmaWVsZCBhcmUgYWxzbyBjbG9uZWQgYnkgdGhpcyBmdW5jdGlvbi4KICoKICogQHJldHVybiB7UmVjb3JkfSBBbiBleGFjdCBjbG9uZSBvZiB0aGlzIHJlY29yZC4KICoKICogQG1ldGhvZAogKiBAbmFtZSBSZWNvcmQuY2xvbmUKICogQG5hbWUgUmVjb3JkI2Nsb25lICovClJlY29yZC5jbG9uZSA9IG5ldyBTdHJpbmcoKTsKCi8qKiBDb3VudCB0aGUgbnVtYmVyIG9mIGZpZWxkcyBpbiBhIHJlY29yZCB3aXRoIGEgZ2l2ZW4gbmFtZS4KICoKICogR2l2ZW4gdGhlIG5hbWUgb2YgYSBmaWVsZCwgdGhpcyBtZXRob2QgcmV0dXJucyB0aGUgbnVtYmVyIG9mIGZpZWxkcwogKiB3aXRoIHRoYXQgbmFtZS4KICoKICogQHBhcmFtIHtzdHJpbmd9IGZpZWxkTmFtZSBUaGUgbmFtZSBvZiBhIGZpZWxkLgogKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBudW1iZXIgb2YgZmllbGRzIHdpdGggdGhlIGdpdmVuIGZpZWxkTmFtZQogKgogKiBAZXhhbXBsZQogLy8gR2V0IHRoZSBudW1iZXIgb2YgNTQ1IGZpZWxkcyBpbiBhIHJlY29yZAogdmFyIG51bSA9IGFSZWNvcmQuY291bnQoICI1NDUiICk7CiAqIEBtZXRob2QKICogQG5hbWUgUmVjb3JkLmNvdW50CiAqIEBuYW1lIFJlY29yZCNjb3VudCAqLwpSZWNvcmQuY291bnQgPSBuZXcgU3RyaW5nKCk7CgoKLyoqIEl0ZXJhdGVzIG92ZXIgdGhlIGZpZWxkcyBhbmQgY2FsbHMgYSBoYW5kbGVyIG9uIGVhY2ggZmllbGQuCiAqCiAqIFRoaXMgZnVuY3Rpb24gaGFzIDIgZm9ybXM6CiAqCiAqIElmIGdpdmVuIGEgbWF0Y2hlciBhbmQgYSBoYW5kbGVyLCB0aGVuIHRoZSBoYW5kbGVyIGlzIGNhbGxlZCBmb3IgZWFjaCBmaWVsZC4KICoKICogSWYgZ2l2ZW4gYSBtYXRjaGVyLCBhbiBhcnJheSBvZiBzb3J0ZXIgb2JqZWN0cyBhbmQgYSBoYW5kbGVyLCB0aGVuIHRoZSBtYXRjaGVkCiAqIGZpZWxkcyBhcmUgc29ydGVkIGJlZm9yZSB0aGUgaGFuZGxlciBpcyBjYWxsZWQgZm9yIGVhY2ggZmllbGQuCiAqCiAqIEBwYXJhbSB7UmVnRXhwfFN0cmluZ3xPYmplY3R9IG1hdGNoZXIgQSBSZWdFeHAgb3Igc3RyaW5nIHRoYXQgbWF0Y2hlcyB0aGUgZmllbGQgbmFtZQogKiAgICAgICAgICBvciBhbiBvYmplY3Qgd2l0aCBhIGZ1bmN0aW9uIG9mIHRoZSBub3JtOiBmdW5jdGlvbiBtYXRjaEZpZWxkKCByZWNvcmQsIGZpZWxkICkuCiAqICAgICAgICBUaGUgZnVuY3Rpb24gc2hvdWxkIHJldHVybiBhIGJvb2xlYW4gdmFsdWUuCiAqIEBwYXJhbSB7QXJyYXl9IHNvcnRlciBBbiBhcnJheSBvZiBvYmplY3RzIHRoYXQgaGFzIGEgZnVuY3Rpb246IHNvcnQoIGEsIGIgKS4gYSBhbmQKICogICAgICAgICAgYiBhcmUgZmllbGRzIGFuZCB0aGUgZnVuY3Rpb24gc2hvdWxkIHJldHVybiAtMSAoYSA8IGIpLCAwICggYSA9PSBiKSBvciAxIChhID4gYikuCiAqICAgICAgICAgIElmIHRoZSBmdW5jdGlvbiByZXR1cm5zIC0xIG9yIDEsIHRoZW4gdGhlIHR3byBmaWVsZHMgYXJlIHNvcnRlZCBhbmQgYW55IGZ1cnRoZXIKICogICAgICAgICAgZWxlbWVudHMgaW4gdGhlIGFycmF5IGFyZSBpZ25vcmVkIGZvciB0aGVzZSB0d28gZmllbGRzLgogKiBAcGFyYW0ge0hhbmRsZXJ8RnVuY3Rpb259IGhhbmRsZXIgVGhlIGhhbmRsZXIgdG8gY2FsbCBmb3IgZWFjaCBzdWJmaWVsZCBmb3VuZAogKiAgICAgICAgICBieSBtYXRjaGVyLgogKgogKiBAcmV0dXJuIElmIGhhbmRsZXIgcmV0dXJucyBhIHZhbHVlIHRoZW4gYWxsIHRoZSB2YWx1ZXMgYXJlIGFkZGVkIHRvZ2V0aGVyIGludG8gYQogKiAgICAgICAgICAgc2luZ2xlIHZhbHVlLgogKgogKiBAZXhhbXBsZQogLy8gUHJpbnQgYWxsIGZpZWxkcwogcmVjb3JkLmVhY2hGaWVsZCggLy4vLCBmdW5jdGlvbiggZmllbGQgKSB7CiAgICBwcmludCggZmllbGQudG9TdHJpbmcoKSArICJcbiIgKTsKfSApOwoKIC8vIExpc3QgZmllbGQgNzk1IHNvcnRlZCBieSBzdWIgZmllbGQgIsOlIgogcmVjb3JkLmVhY2hGaWVsZCggIjc5NSIsIFsgbmV3IFNvcnRCeVN1YkZpZWxkcyggL8OlLyApIF0sIGZ1bmN0aW9uKCBmaWVsZCApIHsKICAgIHByaW50KCBmaWVsZC50b1N0cmluZygpICsgIlxuIiApOwp9ICk7CgogLy8gSG93IHRvIHVzZSBhIGN1c3RvbSBtYXRjaGVyIGZ1bmN0aW9uIHdpdGggZWFjaEZpZWxkCiAvLyBUaGUgZnVuY3Rpb24gbWF0Y2hlcyBhbGwgZmllbGRzICI3MDAiIHdpdGggYSBzdWJmaWVsZCAiYSIuCiByZWNvcmQuZWFjaEZpZWxkKCB7IG1hdGNoRmllbGQ6IGZ1bmN0aW9uKCByZWNvcmQsIGZpZWxkICkgewogICAgcmV0dXJuIGZpZWxkLm5hbWUgPT09ICI3MDAiICYmIGZpZWxkLmV4aXN0cyggL2EvICkgfSB9LCBmdW5jdGlvbiggZmllbGQgKSB7CiAgICBwcmludCggZmllbGQudG9TdHJpbmcoKSArICJcbiIgICk7Cn0gKTsKCiAvL2NvbWJpbmUgZWFjaEZpZWxkIHdpdGggZWFjaFN1YkZpZWxkIHRvIHByaW50IGFsbCBzdWJmaWVsZCB2YWx1ZXMgaW4gYWxsIGZpZWxkcwogcmVjb3JkLmVhY2hGaWVsZCAoIC8uLywgZnVuY3Rpb24gKCBmaWVsZCApIHsKICAgIGZpZWxkLmVhY2hTdWJGaWVsZCAoIC8uLywgZnVuY3Rpb24gKCBmaWVsZCwgc3ViZmllbGQgKSB7CiAgICAgICAgcHJpbnQgKCBzdWJmaWVsZC52YWx1ZSArICJcbiIgKTsKICAgIH0gKTsgLy9lbmQgZWFjaFN1YkZpZWxkCiAgfSk7IC8vZW5kIGVhY2hGaWVsZAoKICoKICogQG1ldGhvZAogKiBAbmFtZSBSZWNvcmQuZWFjaEZpZWxkCiAqIEBuYW1lIFJlY29yZCNlYWNoRmllbGQgKi8KUmVjb3JkLmVhY2hGaWVsZCA9IG5ldyBTdHJpbmcoKTsKCi8qKiBJdGVyYXRlcyBvdmVyIHRoZSBmaWVsZHMgYW5kIGxvb2t1cCBoYW5kbGVycyBpbiBhIG1hcC4KICoKICogVGhpcyBtZXRob2QgaXMgdXNlZnVsIHdoZW4geW91IHdhbnQgdG8gaGFuZGxlIG11bHRpcGxlIGZpZWxkcyBpbiBhIHJlY29yZCB3aXRoIGRpZmZlcmVudCBmdW5jdGlvbnMKICoKICogSXQgaXMgbW9yZSBlZmZpY2llbnQgdGhhbiBtYWtpbmcgbXVsdGlwbGUgZWFjaEZpZWxkIGNhbGxzLCBzaW5jZSBpdCBvbmx5IGxvb3BzIHRocm91Z2ggZmllbGRzIG9uY2UgYW5kCiAqIHVzZXMgbWFwIHN0cmluZyBsb29rdXAgaW5zdGVhZCBvZiByZWd1bGFyIGV4cHJlc3Npb25zLgogKiBCdXQgaXQgY2FuIG9ubHkgbWF0Y2ggb24gZXhhY3QgZmllbGQgbmFtZXMsIGJlY2F1c2Ugb2YgdGhlIG1hcCBsb29rdXAuCiAqCiAqIEBwYXJhbSB7TWF0Y2hNYXB9IG1hcCBBbiBvYmplY3QgY29udGFpbmluZyBtYXBwaW5nIGJldHdlZW4gZmllbGRuYW1lIHN0cmluZ3MgYW5kIGZ1bmN0aW9ucyB0byBjYWxsCiAqIEBwYXJhbSB7T2JqZWN0fFVuZGVmaW5lZH0gZXh0cmFEYXRhIGdpdmVuIHRvIGFsbCBmdW5jdGlvbnMgY2FsbGVkIGFzIHNlY29uZCBwYXJhbWV0ZXIKICoKICogQGV4YW1wbGUKIHZhciBtYXAgPSBuZXcgTWF0Y2hNYXAoKTsKIG1hcC5wdXQoICI3MDAiLCBmdW5jdGlvbiggZmllbGQgKSB7CiAgICAvLyBoYW5kbGUgZmllbGQgNzAwCn0pOwogbWFwLnB1dCggIjc5NSIsIGZ1bmN0aW9uKCBmaWVsZCApIHsKICAgIC8vIGhhbmRsZSBmaWVsZCA3OTUKfSk7CiBtYXAucHV0KCAiMTAwIiwgIjEwMSIsIGZ1bmN0aW9uKCBmaWVsZCApIHsKICAgIC8vIGhhbmRsZSBmaWVsZCAxMDAgYW5kIDEwMQp9KTsKIHJlY29yZC5lYWNoRmllbGRNYXAobWFwKTsKIC8vIEFsdGVybmF0ZQogdmFyIG1hcDIgPSBuZXcgTWF0Y2hNYXAoKTsKIG1hcDIucHV0KCAiNzAwIiwgZnVuY3Rpb24oIGZpZWxkLCBjb2xsZWN0b3IgKSB7CiAgICBjb2xsZWN0b3IucHVzaCggZmllbGQudmFsdWUgKTsKfSk7CiB2YXIgdmFsdWVzID0gW10KIHJlY29yZC5lYWNoRmllbGRNYXAobWFwMiwgdmFsdWVzKTsKICoKICogQG1ldGhvZAogKiBAbmFtZSBSZWNvcmQuZWFjaEZpZWxkTWFwCiAqIEBuYW1lIFJlY29yZCNlYWNoRmllbGRNYXAgKi8KUmVjb3JkLmVhY2hGaWVsZE1hcCA9IG5ldyBTdHJpbmcoKTsKCgovKiogSXRlcmF0ZXMgb3ZlciB0aGUgZmllbGRzIGFuZCBsb29rdXAgaGFuZGxlcnMgaW4gYSBtYXAuCiAqCiAqIFRoaXMgbWV0aG9kIGlzIHVzZWZ1bCB3aGVuIHlvdSB3YW50IHRvIGhhbmRsZSBtdWx0aXBsZSBmaWVsZHMgaW4gYSByZWNvcmQgd2l0aCBkaWZmZXJlbnQgZnVuY3Rpb25zIGFuZCBub25zcGVjaWZpZWQKICogZmllbGRzIHdpdGggYSBkZWZhdWx0IGZ1bmN0aW9uLiBTbyBhbGwgZmllbGRzIHRoYXQgYXJlIGFkZGVkIHRvIHRoZSBtYXAgdXNlIGEgc3BlY2lmaWMgZnVuY3Rpb24gYW5kIHRoZSByZW1haW5pbmcgZmllbGRzCiAqIGFyZSBjYWxsZWQgd2l0aCB0aGUgZGVmYXVsdCBmdW5jdGlvbi4KICoKICogSXQgaXMgbW9yZSBlZmZpY2llbnQgdGhhbiBtYWtpbmcgbXVsdGlwbGUgZWFjaEZpZWxkIGNhbGxzLCBzaW5jZSBpdCBvbmx5IGxvb3BzIHRocm91Z2ggZmllbGRzIG9uY2UgYW5kCiAqIHVzZXMgbWFwIHN0cmluZyBsb29rdXAgaW4gc3RlYWQgb2YgcmVndWxhciBleHByZXNzaW9ucy4KICogQnV0IGl0IGNhbiBvbmx5IG1hdGNoIG9uIGV4YWN0IGZpZWxkIG5hbWVzLCBiZWNhdXNlIG9mIHRoZSBtYXAgbG9va3VwCiAqCiAqIEBwYXJhbSB7TWF0Y2hNYXB9IG1hcCBBbiBvYmplY3QgY29udGFpbmluZyBtYXBwaW5nIGJldHdlZW4gZmllbGQgbmFtZSBzdHJpbmdzIGFuZCBmdW5jdGlvbnMgdG8gY2FsbAogKiBAcGFyYW0ge2RlZmF1bHRGdW5jdGlvbn0gZGVmYXVsdEZ1bmN0aW9uIHRvIGNhbGwgZm9yIGZpZWxkcyBub3QgaSBNYXRjaE1hcAogKiBAcGFyYW0ge2V4dHJhRGF0YX0gT2JqZWN0IGdpdmVuIHRvIGFsbCBmdW5jdGlvbnMgY2FsbGVkIGFzIHNlY29uZCBwYXJhbWV0ZXIKICoKICoKICogQGV4YW1wbGUKIHZhciBtYXAgPSBuZXcgTWF0Y2hNYXAoKTsKCiBtYXAucHV0KCAiMDAxIiwgZnVuY3Rpb24oIGYsIHJlc3VsdERhdGEgKSB7IHJlc3VsdERhdGEucHVzaCggIjAwMSBjYWxsZWQgIitmLm5hbWUgKTsgfSApOwogbWFwLnB1dCggIjAwMiIsIGZ1bmN0aW9uKCBmLCByZXN1bHREYXRhICkgeyByZXN1bHREYXRhLnB1c2goICIwMDIgY2FsbGVkICIrZi5uYW1lICk7IH0gKTsKCiB2YXIgZGVmYXVsdEZ1bmN0aW9uID0gZnVuY3Rpb24gKCBmLCByZXN1bHREYXRhICkgeyByZXN1bHREYXRhLnB1c2goICJkZWZhdWx0IGNhbGxlZCAiICsgZi5uYW1lICk7IH07CgogdmFyIHJlc3VsdERhdGE9W107CgogcmVjb3JkLmVhY2hGaWVsZE1hcFdpdGhEZWZhdWx0KCBtYXAsIGRlZmF1bHRGdW5jdGlvbiwgcmVzdWx0RGF0YSApOwoKIC8vIGlmIHJlY29yZCBpcwogLy8gMDAxIDAwICphCiAvLyAwMDIgMDAgKmEKIC8vIDI0NSAwMCAqYQogLy8gMzAwIDAwICphCiAvL3Jlc3VsdCBkYXRhIGlzIG5vdyBbICIwMDEgY2FsbGVkIDAwMSIsICIwMDIgY2FsbGVkIDAwMiIsICJkZWZhdWx0IGNhbGxlZCAyNDUiLCAiZGVmYXVsdCBjYWxsZWQgMzAwIiBdCgogKgogKiBAbWV0aG9kCiAqIEBuYW1lIFJlY29yZC5lYWNoRmllbGRNYXBXaXRoRGVmYXVsdAogKiBAbmFtZSBSZWNvcmQjZWFjaEZpZWxkTWFwV2l0aERlZmF1bHQgKi8KUmVjb3JkLmVhY2hGaWVsZE1hcFdpdGhEZWZhdWx0ID0gbmV3IFN0cmluZygpOwoKLyoqIEl0ZXJhdGVzIG92ZXIgdGhlIGZpZWxkcyBhbmQgY2FsbHMgYSBoYW5kbGVyIG9uIGVhY2ggZmllbGQgYXMgYSBzZXF1ZW5jZS4KICoKICogQSBzZXF1ZW5jZSBpcyBhbiBhcnJheSBvZiBtYXRjaGVycyB0aGF0IGlzIHVzZWQgdG8gZXh0cmFjdCBmaWVsZHMuIFRoZSBoYW5kbGVyIGlzIHRoZW4KICogdXNlZCBvbiB0aGUgZmlyc3QgZmllbGQgZnJvbSBlYWNoIG1hdGNoZXIsIHRoZW4gb24gdGhlIHNlY29uZCBmaWVsZCBmcm9tIGVhY2ggbWF0Y2hlciwKICogYW5kIHNvIG9uLgogKgogKiBJZiB0aGUgbWF0Y2hlcnMgbWF0Y2hlcyBvbiBkaWZmZXJlbnQgbnVtYmVyIG9mIGZpZWxkcywgdGhlbiBvbmx5IHRoZSBzbWFsbGVzdCBudW1iZXIgb2YgbWF0Y2hlZAogKiBmaWVsZHMgaXMgdXNlZCwgdGhlbiB3ZSBpbnZva2UgdGhlIGhhbmRsZXIgb24gdGhlIHN1YiBmaWVsZC4KICoKICogVGhpcyBmdW5jdGlvbiBoYXMgMiBmb3JtczoKICoKICogSWYgZ2l2ZW4gYSBtYXRjaGVyIGFuZCBhIGhhbmRsZXIsIHRoZW4gdGhlIGhhbmRsZXIgaXMgY2FsbGVkIGZvciBlYWNoIGZpZWxkLgogKgogKiBJZiBnaXZlbiBhIG1hdGNoZXIsIGFuIGFycmF5IG9mIHNvcnRlciBvYmplY3RzIGFuZCBhIGhhbmRsZXIsIHRoZW4gdGhlIG1hdGNoZWQKICogZmllbGRzIGFyZSBzb3J0ZWQgYmVmb3JlIHRoZSBoYW5kbGVyIGlzIGNhbGxlZCBmb3IgZWFjaCBmaWVsZC4KICoKICogQHBhcmFtIHtBcnJheX0gbWF0Y2hlcnMgQW4gQXJyYXkgb2YgUmVnRXhwIHRoYXQgbWF0Y2hlcyB0aGUgZmllbGQgbmFtZQogKiAgICAgICAgICBvciBhbiBvYmplY3Qgd2l0aCBhIGZ1bmN0aW9uIG9mIHRoZSBub3JtOiBmdW5jdGlvbiBtYXRjaEZpZWxkKCByZWNvcmQsIGZpZWxkICkuCiAqICAgICAgICBUaGUgZnVuY3Rpb24gc2hvdWxkIHJldHVybiBhIGJvb2xlYW4gdmFsdWUuCiAqIEBwYXJhbSB7QXJyYXl9IHNvcnRlciBBbiBhcnJheSBvZiBvYmplY3RzIHRoYXQgaGFzIGEgZnVuY3Rpb246IHNvcnQoIGEsIGIgKS4gYSBhbmQKICogICAgICAgICAgYiBhcmUgZmllbGRzIGFuZCB0aGUgZnVuY3Rpb24gc2hvdWxkIHJldHVybiAtMSAoYSA8IGIpLCAwICggYSA9PSBiKSBvciAxIChhID4gYikuCiAqICAgICAgICAgIElmIHRoZSBmdW5jdGlvbiByZXR1cm5zIC0xIG9yIDEsIHRoZW4gdGhlIHR3byBmaWVsZHMgYXJlIHNvcnRlZCBhbmQgYW55IGZ1cnRoZXIKICogICAgICAgICAgZWxlbWVudHMgaW4gdGhlIGFycmF5IGFyZSBpZ25vcmVkIGZvciB0aGVzZSB0d28gZmllbGRzLgogKiBAcGFyYW0ge0hhbmRsZXJ8RnVuY3Rpb259IGhhbmRsZXIgVGhlIGhhbmRsZXIgdG8gY2FsbCBmb3IgZWFjaCBzdWIgZmllbGQgZm91bmQKICogICAgICAgICAgYnkgbWF0Y2hlci4KICoKICogQHJldHVybiBJZiBoYW5kbGVyIHJldHVybnMgYSB2YWx1ZSB0aGVuIGFsbCB0aGUgdmFsdWVzIGFyZSBhZGRlZCB0b2dldGhlciBpbnRvIGEKICogICAgICAgICAgIHNpbmdsZSB2YWx1ZS4KICoKICogQGV4YW1wbGUKIC8vIFByaW50IGZpZWxkcyAiNzcwIiBhbmQgIjc5NSIgYXMgcGFpcnMuCiByZWNvcmQuZWFjaEZpZWxkU2VxdWVuY2UoIFsgLzc3MC8sIC83OTUvIF0sIGZ1bmN0aW9uKCBmaWVsZCApIHsKICAgIHByaW50KCBmaWVsZC50b1N0cmluZygpICsgIlxuIiApOwp9ICk7CgogLy8gU2VxdWVuY2Ugd2l0aCBhIGN1c3RvbSBtYXRjaGVyLgogcmVjb3JkLmVhY2hGaWVsZFNlcXVlbmNlKCBbIHsgbWF0Y2hGaWVsZDogZnVuY3Rpb24oIHJlY29yZCwgZmllbGQgKSB7IHJldHVybiBmaWVsZC5uYW1lID09PSAiNjUyIiAmJiBmaWVsZC5leGlzdHMoIC8wLyApIH0KCQkJCQkJICAgIH0sIC83NzAvLCAvNzk1LyBdLCBmdW5jdGlvbiggZmllbGQgKSB7IHByaW50KCBmaWVsZC50b1N0cmluZygpICsgIlxuIiApOyB9ICk7CgogKiBAbWV0aG9kCiAqIEBuYW1lIFJlY29yZC5lYWNoRmllbGRTZXF1ZW5jZQogKiBAbmFtZSBSZWNvcmQjZWFjaEZpZWxkU2VxdWVuY2UgKi8KUmVjb3JkLmVhY2hGaWVsZFNlcXVlbmNlID0gbmV3IFN0cmluZygpOwoKLyoqIENoZWNrcyBpZiB0aGUgcmVjb3JkIGlzIGVtcHR5LCB0aGF0IGl0IGhhcyB6ZXJvIGZpZWxkcy4KICoKICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgcmVjb3JkIGlzIGVtcHR5LCBmYWxzZSBvdGhlcndpc2UuCiAqCiAqIEBleGFtcGxlCiAvLyBlbXB0eSgpIGlzIG1hbnkgdGltZXMgdXNlZCBhcyBhbiBlYXJseSBjaGVjayBpbiB0aGUgYmVnaW5uaW5nIG9mIGEgZnVuY3Rpb24KIGZ1bmN0aW9uIGYoIHJlY29yZCApIHsKCWlmKCByZWNvcmQuZW1wdHkoKSApIHsKIAkJcmV0dXJuOwogCX0KIAkKIAkvLyBOb3JtYWwgbG9naWMuLi4gCQp9CiAqIEBtZXRob2QKICogQG5hbWUgUmVjb3JkLmVtcHR5CiAqIEBuYW1lIFJlY29yZCNlbXB0eSAqLwpSZWNvcmQuZW1wdHkgPSBuZXcgU3RyaW5nKCk7CgovKiogQ2hlY2tzIGlmIHRoaXMgcmVjb3JkIGNvbnRhaW5zIGF0IGxlYXN0IG9uZSBmaWVsZCwgdGhhdCBtYXRjaGVzIGEgY3JpdGVyaWEuCiAqCiAqIEBwYXJhbSB7UmVnRXhwfFN0cmluZ3xPYmplY3R9IG1hdGNoZXIgQW4gUmVnRXhwIG9yIHN0cmluZyB0aGF0IG1hdGNoZXMgdGhlIGZpZWxkIG5hbWUKICogICAgICAgICAgb3IgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbiBvZiB0aGUgbm9ybTogZnVuY3Rpb24gbWF0Y2hGaWVsZCggcmVjb3JkLCBmaWVsZCApLgogKiAgICAgICAgVGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBib29sZWFuIHZhbHVlLgogKgogKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIGEgZmllbGQgbWF0Y2hlcyB0aGUgbWF0Y2hlciBhcmd1bWVudCwgRmFsc2Ugb3RoZXJ3aXNlLgogKgogKiBAZXhhbXBsZQogZnVuY3Rpb24gaGFzVGl0bGUoIHJlY29yZCApIHsKCXJldHVybiByZWNvcmQuZXhpc3RGaWVsZCggLzI0NS8gKTsKfQogLy9UaGUgZnVuY3Rpb24gaGFzVGl0bGUgY2hlY2tzIGlmIHRoZSBwYXNzZWQgcmVjb3JkIGNvbnRhaW5zIGEgZmllbGQgd2l0aCBuYW1lICIyNDUiLgoKCiB2YXIgZXhhbXBsZVJlY29yZF9PbmUgPSBuZXcgUmVjb3JkKCk7CiB2YXIgZXhhbXBsZUZpZWxkID0gbmV3IEZpZWxkICggIjI0NSIsICIwMCIgKTsKIGV4YW1wbGVSZWNvcmRfT25lLmFwcGVuZCAoIGV4YW1wbGVGaWVsZCApOwoKIGhhc1RpdGxlICggZXhhbXBsZVJlY29yZF9PbmUgKTsgLy8gPC0tIHRoaXMgY2FsbCByZXR1cm5zIFRydWUKCiB2YXIgZXhhbXBsZVJlY29yZF9Ud28gPSBuZXcgUmVjb3JkKCk7CiB2YXIgZXhhbXBsZUZpZWxkID0gbmV3IEZpZWxkICggIjI2MCIsICIwMCIgKTsKIGV4YW1wbGVSZWNvcmRfVHdvLmFwcGVuZCAoIGV4YW1wbGVGaWVsZCApOwoKIGhhc1RpdGxlICggZXhhbXBsZVJlY29yZF9Ud28gKTsgLy8gPC0tIHRoaXMgY2FsbCByZXR1cm5zIEZhbHNlCgogKgogKgogKgogKiBAbWV0aG9kCiAqIEBuYW1lIFJlY29yZC5leGlzdEZpZWxkCiAqIEBuYW1lIFJlY29yZCNleGlzdEZpZWxkICovClJlY29yZC5leGlzdEZpZWxkID0gbmV3IFN0cmluZygpOwoKLyoqIEdldCBhIHJlZmVyZW5jZSB0byBhIGZpZWxkIGluIHRoZSByZWNvcmQuCiAqCiAqIEdpdmVuIHRoZSBpbmRleCBvZiBhIGZpZWxkLCBvciBhIGZpZWxkTmFtZSwgb3IgYSBmaWVsZE5hbWUgYW5kIGFuCiAqIGluZGV4LCByZXR1cm4gYSByZWZlcmVuY2UgdG8gYSBmaWVsZC4KICoKICogVGhpcyBpcyB0aGUgcHJpbWFyeSBtZXRob2QgdG8gZ2V0IGFjY2VzcyB0byB0aGUgZmllbGRzIG9mIGEKICogcmVjb3JkLiBUaGUgbWV0aG9kIGV4aXN0cyBpbiB0aHJlZSB2ZXJzaW9ucywgZGVwZW5kaW5nIG9uIHRoZQogKiBudW1iZXIgYW5kIHR5cGUgb2YgYXJndW1lbnRzIGdpdmVuLgogKgogKiBJZiBnaXZlbiBhIG51bWVyaWNhbCBpbmRleCBvbmx5LCBpdCByZXR1cm5zIHRoZSBmaWVsZCBhdCB0aGF0IHBvc2l0aW9uCiAqIGluIHRoZSByZWNvcmRzIGludGVybmFsIHJlcHJlc2VudGF0aW9uIG9mIGZpZWxkcy4gVGhpcyBpcyBwcm9iYWJseQogKiBvbmx5IHVzZWZ1bCBpbiBjb25qdW5jdGlvbiB3aXRoIGUuZy4gbG9vcGluZyB0aHJvdWdoIGFsbCBmaWVsZHMgaW4KICogdGhlIHJlY29yZC4KICoKICogSWYgZ2l2ZW4gYSBuYW1lLCBpdCByZXR1cm5zIHRoZSBmaXJzdCBmaWVsZCBmb3VuZCwgdGhhdCBtYXRjaGVzIHRoZQogKiBnaXZlbiBuYW1lLgogKgogKiBJZiBnaXZlbiBhIG5hbWUgYW5kIGFuIGluZGV4IG4sIGl0IHJldHVybnMgdGhlIG4ndGggZmllbGQgd2l0aAogKiB0aGUgZ2l2ZW4gbmFtZS4KICoKICogTm90ZSwgdGhhdCBpZiB0aGUgZmllbGQgaXMgbm90IGZvdW5kLCBhbiBlbXB0eSBmaWVsZCBpcwogKiByZXR1cm5lZC4gVGhpcyBmaWVsZCBpcyBub3QgcGFydCBvZiB0aGUgcmVjb3JkLgogKgogKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IGZpZWxkSW5kZXhPckZpZWxkTmFtZSBJbmRleCBvZiBmaWVsZCB0byBmaW5kLCB6ZXJvLWJhc2VkLCBvciBuYW1lIG9mIGEgZmllbGQgdG8gZmluZC4KICogQHBhcmFtIHtudW1iZXJ9IFtmaWVsZE5hbWVJbmRleF0gSW5kZXggb2YgbmFtZWQgZmllbGQgdG8gZmluZCwgemVyby1iYXNlZC4gKk9ubHkgYWxsb3dlZCBpZiBmaXJzdCBhcmd1bWVudCBpcyBhIGZpZWxkTmFtZS4qCiAqIEByZXR1cm4ge0ZpZWxkfSBBIHJlZmVyZW5jZSB0byBhIGZpZWxkLCBvciBhbiBlbXB0eSBmaWVsZCwgaWYgbm90IGZvdW5kLgogKiBAZXhhbXBsZQogLy9leGFtcGxlIHJlY29yZAogdmFyIHJlY29yZCA9IG5ldyBSZWNvcmQoKTsKIGZpZWxkID0gbmV3IEZpZWxkICggIjAyMSIsICIwMCIgKTsKIGZpZWxkLmFwcGVuZCAoICJlIiwgIjk3ODA2MTgyNjAzMDAiICk7CiByZWNvcmQuYXBwZW5kKCBmaWVsZCApOwogZmllbGQgPSBuZXcgRmllbGQgKCAiMDIxIiwgIjAwIiApOwogZmllbGQuYXBwZW5kICggImEiLCAiMDYxODE2MjIxNiIgKTsKIHJlY29yZC5hcHBlbmQoIGZpZWxkICk7CiBmaWVsZCA9IG5ldyBGaWVsZCAoICIxMDAiLCAiMDAiICk7CiBmaWVsZC5hcHBlbmQgKCAiYSIsICJUb2xraWVuIiApOwogZmllbGQuYXBwZW5kICggImgiLCAiSi5SLlIuIiApOwogcmVjb3JkLmFwcGVuZCggZmllbGQgKTsKIGZpZWxkID0gbmV3IEZpZWxkICggIjI0NSIsICIwMCIgKTsKIGZpZWxkLmFwcGVuZCAoICJhIiwgIlRoZSBob2JiaXQsIG9yLCBUaGVyZSBhbmQgYmFjayBhZ2FpbiIgKTsKIHJlY29yZC5hcHBlbmQoIGZpZWxkICk7CgoKIC8vIEdldCB0aGUgdGhpcmQgZmllbGQgaW4gdGhlIHJlY29yZAogdmFyIGYxID0gcmVjb3JkLmZpZWxkKCAyICk7IC8vPC0tIHRoaXMgcmVmZXJzIHRvIGZpZWxkIDEwMAoKIC8vIEJlIGF3YXJlIGlmIHlvdSB1c2Ugb25seSB0aGUgbmFtZSBvZiB0aGUgZmllbGQgYW5kIHRoZXJlIGlzIG1vcmUgdGhhbiBvbmUgb2YgdGhhdCBmaWVsZAogLy8geW91IHdpbGwgZ2V0IGEgcmVmZXJlbmNlIHRvIHRoZSBmaXJzdCBmaWVsZAogdmFyIGYyID0gcmVjb3JkLmZpZWxkKCAiMDIxIiApOyAgLy8gPC0tIHRoaXMgcmVmZXJzIHRvIGZpZWxkIDAyMSBjb250YWluaW5nIHN1YmZpZWxkICJlIiB2YWx1ZSA9IDk3ODA2MTgyNjAzMDAKCiAvLyBHZXQgdGhlIHNlY29uZCAwMjEgZmllbGQKIHZhciBmMyA9IHJlY29yZC5maWVsZCggIjAyMSIsIDEgKTsgLy8gPC0tIHRoaXMgcmVmZXJzIHRvIGZpZWxkIDAyMSBjb250YWluaW5nIHN1YmZpZWxkICJhIiB2YWx1ZSA9IDA2MTgxNjIyMTYKCiAvL0JlIGF3YXJlIGlmIHlvdSByZWZlciB0byBhIGZpZWxkIHdpdGggbmFtZSBhbmQgaW5kZXggdGhhdCBpcyBub3QgdGhlcmUgeW91IGdldCBhbiBlbXB0eSBmaWVsZAogdmFyIGY0ID0gcmVjb3JkLmZpZWxkKCAiMDIxIiwgMiApOyAvLyA8LS0gdGhpcyByZWZlcnMgdG8gYW4gZW1wdHkgZmllbGQsIGJlY2F1c2UgdGhlcmUgYXJlIG9ubHkgdHdvIGZpZWxkIDAyMSBpbiB0aGlzIHJlY29yZAoKICogQG1ldGhvZAogKiBAbmFtZSBSZWNvcmQuZmllbGQKICogQG5hbWUgUmVjb3JkI2ZpZWxkICovClJlY29yZC5maWVsZCA9IG5ldyBTdHJpbmcoKTsKCi8qKiBJdGVyYXRlcyBvdmVyIHRoZSBmaWVsZHMgYW5kIGNhbGxzIGEgaGFuZGxlciBvbiBlYWNoIGZpZWxkLiBSZXR1cm5zIHRoZSB2YWx1ZSBvZgogKiB0aGUgZmlyc3QgdmFsdWUgdGhlIGhhbmRsZXIgcmV0dXJucywgdGhhdCBpcyBub3QgdW5kZWZpbmVkLgogKgogKiBUaGlzIGZ1bmN0aW9uIGhhcyAyIGZvcm1zOgogKgogKiBJZiBnaXZlbiBhIG1hdGNoZXIgYW5kIGEgaGFuZGxlciwgdGhlbiB0aGUgaGFuZGxlciBpcyBjYWxsZWQgZm9yIGVhY2ggZmllbGQuCiAqCiAqIElmIGdpdmVuIGEgbWF0Y2hlciwgYW4gYXJyYXkgb2Ygc29ydGVyIG9iamVjdHMgYW5kIGEgaGFuZGxlciwgdGhlbiB0aGUgbWF0Y2hlZAogKiBmaWVsZHMgYXJlIHNvcnRlZCBiZWZvcmUgdGhlIGhhbmRsZXIgaXMgY2FsbGVkIGZvciBlYWNoIGZpZWxkLgogKgogKiBAcGFyYW0ge1JlZ0V4cHxTdHJpbmd8T2JqZWN0fSBtYXRjaGVyIEEgUmVnRXhwIG9yIHN0cmluZyB0aGF0IG1hdGNoZXMgdGhlIGZpZWxkIG5hbWUKICogICAgICAgICAgb3IgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbiBvZiB0aGUgbm9ybTogZnVuY3Rpb24gbWF0Y2hGaWVsZCggcmVjb3JkLCBmaWVsZCApLgogKiAgICAgICAgVGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBib29sZWFuIHZhbHVlLgogKiBAcGFyYW0ge0FycmF5fSBzb3J0ZXIgQW4gYXJyYXkgb2Ygb2JqZWN0cyB0aGF0IGhhcyBhIGZ1bmN0aW9uOiBzb3J0KCBhLCBiICkuIGEgYW5kCiAqICAgICAgICAgIGIgYXJlIGZpZWxkcyBhbmQgdGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gLTEgKGEgPCBiKSwgMCAoIGEgPT0gYikgb3IgMSAoYSA+IGIpLgogKiAgICAgICAgICBJZiB0aGUgZnVuY3Rpb24gcmV0dXJucyAtMSBvciAxLCB0aGVuIHRoZSB0d28gZmllbGRzIGFyZSBzb3J0ZWQgYW5kIGFueSBmdXJ0aGVyCiAqICAgICAgICAgIGVsZW1lbnRzIGluIHRoZSBhcnJheSBhcmUgaWdub3JlZCBmb3IgdGhlc2UgdHdvIGZpZWxkcy4KICogQHBhcmFtIHtIYW5kbGVyfEZ1bmN0aW9ufSBoYW5kbGVyIFRoZSBoYW5kbGVyIHRvIGNhbGwgZm9yIGVhY2ggc3ViZmllbGQgZm91bmQKICogICAgICAgICAgYnkgbWF0Y2hlci4KICoKICogQHJldHVybiBSZXR1cm5zIHRoZSBmaXJzdCB2YWx1ZSB0aGUgaGFuZGxlciByZXR1cm5zLgogKgogKiBAZXhhbXBsZQogLy8gR2V0IHRoZSBmaXJzdCBwZXJzb24gbmFtZSBmcm9tIDc5NQogdmFyIHBlcnNvbk5hbWUgPSByZWNvcmQuZmlyc3RGaWVsZCggLzc5NS8sIGZ1bmN0aW9uKCBmaWVsZCApIHsgZmllbGQuZ2V0VmFsdWUoIC9hLyApIH0gKTsKCiAvLyBBbmQgd2l0aCBhIGN1c3RvbSBtYXRjaGVyCiB2YXIgcGVyc29uTmFtZSA9IHJlY29yZC5maXJzdEZpZWxkKCB7IG1hdGNoRmllbGQ6IGZ1bmN0aW9uKCByZWNvcmQsIGZpZWxkICkgeyByZXR1cm4gZmllbGQubmFtZSA9PT0gIjc5NSIgfSB9LCBmdW5jdGlvbiggZmllbGQgKSB7IGZpZWxkLmdldFZhbHVlKCAvYS8gKSB9ICk7CgogLy8gR2V0cyB0aGUgZmlyc3QgbmFtZSBvZiAiNzk1IiBhZnRlciB0aGUgZmllbGRzIGhhdmUgYmVlbiBzb3J0ZWQgYnkgc3ViIGZpZWxkICLDpSIKIHZhciBwZXJzb25OYW1lID0gcmVjb3JkLmZpcnN0RmllbGQoIC83OTUvLCBbIG5ldyBTb3J0QnlTdWJGaWVsZHMoIC/DpS8sIFNvcnRlci5BU0MgKSBdLCBmdW5jdGlvbiggZmllbGQgKSB7IGZpZWxkLmdldFZhbHVlKCAvYS8gKSB9ICk7CiAqCiAqIEBtZXRob2QKICogQG5hbWUgUmVjb3JkLmZpcnN0RmllbGQKICogQG5hbWUgUmVjb3JkI2ZpcnN0RmllbGQgKi8KUmVjb3JkLmZpcnN0RmllbGQgPSBuZXcgU3RyaW5nKCk7CgovKiogUmV0dXJucyB0aGUgZmlyc3QgZmllbGQgdGhhdCBtYXRjaGVzIGEgZ2l2ZW4gbWF0Y2hlci4KICoKICogQHBhcmFtIHtSZWdFeHB9IHJlZ0V4RmllbGRNYXRjaGVyIFJlZ3VsYXIgZXhwcmVzc2lvbiB0aGF0IG1hdGNoZXMgdGhlIGZpZWxkIG5hbWUKICogICAgICAgICAgICAgICAgICAgb2YgdGhlIGZpZWxkIHlvdSB3YW50IHRvIHJldHVybi4KICoKICogQHJldHVybiB7RmllbGR9IFRoZSBmaXJzdCBmaWVsZCB3aG9zZSBuYW1lIG1hdGNoZXMgdGhlIG1hdGNoZXIgaW4gcmVnRXhGaWVsZE1hdGNoZXIuCiAqCiAqIEBleGFtcGxlCiAvLyBUaGlzIGZ1bmN0aW9uIHJldHVybnMgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgZmllbGQgMjQ1LgogZnVuY3Rpb24gZ2V0VGl0bGUoKSB7CglyZXR1cm4gcmVjb3JkLmdldEZpcnN0RmllbGRBc0ZpZWxkKCAvMjQ1LyApOwp9CiAqIEBtZXRob2QKICogQG5hbWUgUmVjb3JkLmdldEZpcnN0RmllbGRBc0ZpZWxkCiAqIEBuYW1lIFJlY29yZCNnZXRGaXJzdEZpZWxkQXNGaWVsZCAqLwpSZWNvcmQuZ2V0Rmlyc3RGaWVsZEFzRmllbGQgPSBuZXcgU3RyaW5nKCk7CgovKiogUmV0dXJucyB0aGUgZmlyc3Qgc3ViZmllbGQgdmFsdWUgaW4gdGhlIHJlY29yZC4KICoKICogQHBhcmFtIHtSZWdFeHB8U3RyaW5nfE9iamVjdH0gZmllbGRNYXRjaGVyIEEgUmVnRXhwIG9yIHN0cmluZyB0aGF0IG1hdGNoZXMgdGhlIGZpZWxkIG5hbWUKICogICAgICAgICAgb3IgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbiBvZiB0aGUgbm9ybTogZnVuY3Rpb24gbWF0Y2hGaWVsZCggcmVjb3JkLCBmaWVsZCApLgogKiAgICAgICAgVGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBib29sZWFuIHZhbHVlLgogKiBAcGFyYW0ge1JlZ0V4cHxTdHJpbmd8T2JqZWN0fSBzdWJGaWVsZE1hdGNoZXIgQSBSZWdFeHAgb3IgU3RyaW5nIHRoYXQgbWF0Y2hlcyB0aGUgc3ViZmllbGQgbmFtZQogKiAgICAgICAgICBvciBhbiBvYmplY3Qgd2l0aCBhIGZ1bmN0aW9uIG9mIHRoZSBub3JtOiBmdW5jdGlvbiBtYXRjaFN1YkZpZWxkKCBmaWVsZCwgc3ViZmllbGQgKS4KICogICAgICAgIFRoZSBmdW5jdGlvbiBzaG91bGQgcmV0dXJuIGEgYm9vbGVhbiB2YWx1ZS4KICoKICogQHJldHVybiB7U3RyaW5nfSBUaGUgZmlyc3QgdmFsdWUgZm91bmQgaW4gdGhlIHJlY29yZCBvciB0aGUgZW1wdHkgc3RyaW5nLgogKgogKiBAZXhhbXBsZQogZnVuY3Rpb24gZmlyc3RTdWJqZWN0KCByZWNvcmQgKSB7CglyZXR1cm4gcmVjb3JkLmdldEZpcnN0VmFsdWUoIC82NjYvLCAvZi8gKTsKfQogKgogKiBAbWV0aG9kCiAqIEBuYW1lIFJlY29yZC5nZXRGaXJzdFZhbHVlCiAqIEBuYW1lIFJlY29yZCNnZXRGaXJzdFZhbHVlICovClJlY29yZC5nZXRGaXJzdFZhbHVlID0gbmV3IFN0cmluZygpOwoKLyoqIEl0ZXJhdGVzIG92ZXIgdGhlIGZpZWxkcyBhbmQgcmV0dXJucyB0aGUgdmFsdWVzIG9mIGFueSBzdWJmaWVsZCB0aGF0IG1hdGNoZXMgYSBjcml0ZXJpYS4KICoKICogQHBhcmFtIHtSZWdFeHB8U3RyaW5nfE9iamVjdH0gZmllbGRNYXRjaGVyIEEgUmVnRXhwIG9yIFN0cmluZyB0aGF0IG1hdGNoZXMgdGhlIGZpZWxkIG5hbWUKICogICAgICAgICAgb3IgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbiBvZiB0aGUgbm9ybTogZnVuY3Rpb24gbWF0Y2hGaWVsZCggcmVjb3JkLCBmaWVsZCApLgogKiAgICAgICAgVGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBib29sZWFuIHZhbHVlLgogKiBAcGFyYW0ge1JlZ0V4cHxTdHJpbmd8T2JqZWN0fSBzdWJGaWVsZE1hdGNoZXIgQW4gUmVnRXhwIG9yIHN0cmluZyB0aGF0IG1hdGNoZXMgdGhlIHN1YmZpZWxkIG5hbWUKICogICAgICAgICAgb3IgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbiBvZiB0aGUgbm9ybTogZnVuY3Rpb24gbWF0Y2hTdWJGaWVsZCggZmllbGQsIHN1YmZpZWxkICkuCiAqICAgICAgICBUaGUgZnVuY3Rpb24gc2hvdWxkIHJldHVybiBhIGJvb2xlYW4gdmFsdWUuCiAqIEBwYXJhbSB7U3RyaW5nfSBzZXAgQSBzZXBhcmF0b3IgdG8gaW5zZXJ0IGJldHdlZW4gdGhlIHZhbHVlcywgaWYgbW9yZSB0aGFuIG9uZSBpcyBmb3VuZC4KICoKICogQHJldHVybiB7U3RyaW5nfSBUaGUgZm91bmQgdmFsdWVzIGFzIGEgc3RyaW5nLiBJZiBubyB2YWx1ZXMgYXJlIGZvdW5kLCB0aGUgZnVuY3Rpb24gd2lsbAogKiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoZSBlbXB0eSBzdHJpbmcuCiAqCiAqIEBleGFtcGxlCiAvLyBSZXR1cm5zIGFsbCB2YWx1ZXMgZnJvbSBmaWVsZCAiMjQ1YSIgd2l0aG91dCBhbnkgc2VwYXJhdG9yLgogZnVuY3Rpb24gZ2V0VGl0bGVzKCByZWNvcmQgKSB7CglyZXR1cm4gcmVjb3JkLmdldFZhbHVlKCAiMjQ1IiwgImEiICk7Cn0KCiAvLyBSZXR1cm5zIGFsbCB2YWx1ZXMgZnJvbSBmaWVsZCAiMjQ1YSIgd2l0aCBhIGNvbW1hIHNlcGFyYXRvci4KIGZ1bmN0aW9uIGdldFRpdGxlcyggcmVjb3JkICkgewoJcmV0dXJuIHJlY29yZC5nZXRWYWx1ZSggIjI0NSIsICJhIiwgIiwgIiApOwp9CiAqCiAqIEBtZXRob2QKICogQG5hbWUgUmVjb3JkLmdldFZhbHVlCiAqIEBuYW1lIFJlY29yZCNnZXRWYWx1ZSAqLwpSZWNvcmQuZ2V0VmFsdWUgPSBuZXcgU3RyaW5nKCk7CgovKiogQ2hlY2tzIGlmIGEgbWF0Y2hlciBvbmx5IG1hdGNoZXMgb25lIGZpZWxkLgogKgogKiBAcGFyYW0ge1JlZ0V4cHxPYmplY3R9IG1hdGNoZXIgQSBSZWdFeHAgdGhhdCBtYXRjaGVzIHRoZSBmaWVsZCBuYW1lCiAqICAgICAgICAgIG9yIGFuIG9iamVjdCB3aXRoIGEgZnVuY3Rpb24gb2YgdGhlIG5vcm06IGZ1bmN0aW9uIG1hdGNoRmllbGQoIHJlY29yZCwgZmllbGQgKS4KICogICAgICAgIFRoZSBmdW5jdGlvbiBzaG91bGQgcmV0dXJuIGEgYm9vbGVhbiB2YWx1ZS4KICoKICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiBvbmx5IG9uZSBmaWVsZCBtYXRjaGVzIG1hdGNoZXIsIEZhbHNlIG90aGVyd2lzZS4KICogQG1ldGhvZAogKiBAbmFtZSBSZWNvcmQuaXNVbmlxdWUKICogQG5hbWUgUmVjb3JkI2lzVW5pcXVlICovClJlY29yZC5pc1VuaXF1ZSA9IG5ldyBTdHJpbmcoKTsKCi8qKiBJdGVyYXRlcyBvdmVyIHRoZSBmaWVsZHMgYW5kIGNoZWNrcyBpZiBhbnkgb2YgdGhlIHN1YmZpZWxkcyBoYXMgYSBnaXZlbiB2YWx1ZS4KICoKICogQHBhcmFtIHtSZWdFeHB8U3RyaW5nfE9iamVjdH0gZmllbGRNYXRjaGVyIEEgUmVnRXhwIG9yIHN0cmluZyB0aGF0IG1hdGNoZXMgdGhlIGZpZWxkIG5hbWUKICogICAgICAgICAgb3IgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbiBvZiB0aGUgbm9ybTogZnVuY3Rpb24gbWF0Y2hGaWVsZCggcmVjb3JkLCBmaWVsZCApLgogKiAgICAgICAgVGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBib29sZWFuIHZhbHVlLgogKiBAcGFyYW0ge1JlZ0V4cHxTdHJpbmd8T2JqZWN0fSBzdWJGaWVsZE1hdGNoZXIgQSBSZWdFeHAgb3Igc3RyaW5nIHRoYXQgbWF0Y2hlcyB0aGUgc3ViZmllbGQgbmFtZQogKiAgICAgICAgICBvciBhbiBvYmplY3Qgd2l0aCBhIGZ1bmN0aW9uIG9mIHRoZSBub3JtOiBmdW5jdGlvbiBtYXRjaFN1YkZpZWxkKCBmaWVsZCwgc3ViZmllbGQgKS4KICogICAgICAgIFRoZSBmdW5jdGlvbiBzaG91bGQgcmV0dXJuIGEgYm9vbGVhbiB2YWx1ZS4KICogQHBhcmFtIHtSZWdFeHB9IHZhbHVlUmVnRXhwIFRoZSB2YWx1ZSB0aGF0IHlvdSB3YW50IHRvIG1hdGNoLgogKgogKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIGEgdmFsdWUgaXMgbWF0Y2hlZCwgRmFsc2Ugb3RoZXJ3aXNlLgogKgogKiBAZXhhbXBsZQogLy8gQ2hlY2tzIGlmIGEgcmVjb3JkIGlzIGEgYm9vawogZnVuY3Rpb24gaXNCb29rKCByZWNvcmQgKSB7CglyZXR1cm4gcmVjb3JkLm1hdGNoVmFsdWUoIC8wMDkvLCAvYS8sIC94eC8gKTsKfQogKgogKiBAbWV0aG9kCiAqIEBuYW1lIFJlY29yZC5tYXRjaFZhbHVlCiAqIEBuYW1lIFJlY29yZCNtYXRjaFZhbHVlICovClJlY29yZC5tYXRjaFZhbHVlID0gbmV3IFN0cmluZygpOwoKLyoqIFRoZSBudW1iZXIgb2YgZmllbGRzIGluIHRoZSByZWNvcmQuCiAqCiAqIFRoaXMgbWV0aG9kIHJldHVybnMgdGhlIG51bWJlciBvZiBmaWVsZHMgaW4gdGhlIHJlY29yZC4gSXQgaXMgbW9zdAogKiBvZnRlbiB1c2VkIHRvIGl0ZXJhdGUgdGhlIGZpZWxkcyBvZiBhIHJlY29yZC4KICoKICogQHJldHVybiB7bnVtYmVyfSBUaGUgbnVtYmVyIG9mIGZpZWxkcyBpbiB0aGUgcmVjb3JkLgogKiBAZXhhbXBsZSAvLyBJdGVyYXRlIGFsbCBmaWVsZHMgb2YgYSByZWNvcmQgYW5kIHByaW50IHRoZW0KIGZvciggdmFyIGkgPSAwOyBpIDwgcmVjb3JkLm51bWJlck9mRmllbGRzKCk7ICsraSApIHsKICBwcmludCggcmVjb3JkLmZpZWxkKCBpICkudG9TdHJpbmcoKSApOwp9CiAqIEBtZXRob2QKICogQG5hbWUgUmVjb3JkLm51bWJlck9mRmllbGRzCiAqIEBuYW1lIFJlY29yZCNudW1iZXJPZkZpZWxkcyAqLwpSZWNvcmQubnVtYmVyT2ZGaWVsZHMgPSBuZXcgU3RyaW5nKCk7CgovKiogUmVtb3ZlIGEgZmllbGQgZnJvbSBhIHJlY29yZC4KICoKICogR2l2ZW4gdGhlIGluZGV4IG9mIGEgZmllbGQsIG9yIGEgZmllbGROYW1lLCBvciBhIGZpZWxkTmFtZSBhbmQgYW4KICogaW5kZXgsIHJlbW92ZXMgdGhlIGZpZWxkIGZyb20gdGhlIHJlY29yZC4KICoKICogVGhlIG1ldGhvZCBleGlzdHMgaW4gdGhyZWUgdmVyc2lvbnMsIGRlcGVuZGluZyBvbiB0aGUKICogbnVtYmVyIGFuZCB0eXBlIG9mIGFyZ3VtZW50cyBnaXZlbi4KICoKICogSWYgZ2l2ZW4gYSBudW1lcmljYWwgaW5kZXgsIGl0IHJlbW92ZXMgdGhlIGZpZWxkIGF0IHRoYXQgcG9zaXRpb24KICogaW4gdGhlIHJlY29yZHMgaW50ZXJuYWwgcmVwcmVzZW50YXRpb24gb2YgZmllbGRzLgogKgogKiBJZiBnaXZlbiBhIG5hbWUsIGl0IHJlbW92ZXMgdGhlIGZpcnN0IGZpZWxkIGZvdW5kLCB0aGF0IG1hdGNoZXMgdGhlCiAqIGdpdmVuIG5hbWUuCiAqCiAqIElmIGdpdmVuIGEgbmFtZSBhbmQgYW4gaW5kZXggbiwgaXQgcmVtb3ZlcyB0aGUgbid0aCBmaWVsZCB3aXRoCiAqIHRoZSBnaXZlbiBuYW1lLgogKgogKiBJZiBubyBmaWVsZCBtYXRjaGVzIHRoZSBwYXJhbWV0ZXJzLCBub3RoaW5nIGhhcHBlbnMuCiAqCiAqICoqTm90ZToqKiBGb3IgdGhlIEMrKyBpbXBsZW1lbnRhdGlvbjogQW55IHJlZmVyZW5jZSB0byBleGlzdGluZwogKiBmaWVsZHMgb24gdGhpcyByZWNvcmQgbWF5IGJlIGludmFsaWRhdGVkIGJ5IHJlbW92aW5nIGEgZmllbGQuIFRoaXMKICogaGFzIGEgbnVtYmVyIG9mIHBvdGVudGlhbCBiYWQgY29uc2VxdWVuY2VzLCBtb3N0IG9mIHdoaWNoIGxlYWRzIHRvCiAqIGNyYXNoZXMgb3IgdW5wcmVkaWN0YWJsZSBiZWhhdmlvdXIuIEl0IGlzIGVhc3kgdG8gZmFsbCBpbnRvIHRoZQogKiB0cmFwIG9mIGUuZy4gaXRlcmF0aW5nIGFsbCBmaWVsZHMgaW4gYSByZWNvcmQsIGFuZCByZW1vdmUgc29tZSBvZgogKiB0aGVtLiBUaGlzIGlzIGFsbW9zdCBjZXJ0YWluIHRvIG1ha2UgeW91ciBhcHBsaWNhdGlvbgogKiBjcmFzaC4gSW5zdGVhZCwgY29sbGVjdCB0aGUgbmFtZXMgb3IgaW5kZXhlcyBvZiB0aGUgZmllbGRzIHlvdSB3aXNoCiAqIHRvIHJlbW92ZSwgdGhlbiByZW1vdmUgdGhlbSBhZnRlciB5b3VyIG1haW4gaXRlcmF0aW9uLgogKgogKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IGZpZWxkSW5kZXhPckZpZWxkTmFtZSBJbmRleCBvZiBmaWVsZCB0byByZW1vdmUsIHplcm8tYmFzZWQsIG9yIG5hbWUgb2YgYSBmaWVsZCB0byByZW1vdmUKICogQHBhcmFtIHtudW1iZXJ9IFtmaWVsZE5hbWVJbmRleF0gSW5kZXggb2YgbmFtZWQgZmllbGQgdG8gcmVtb3ZlLCB6ZXJvLWJhc2VkLiAqT25seSBhbGxvd2VkIGlmIGZpcnN0IGFyZ3VtZW50IGlzIGEgZmllbGROYW1lLioKICogQGV4YW1wbGUKIC8vIFJlbW92ZSB0aGUgdGhpcmQgZmllbGQgaW4gdGhlIHJlY29yZAogYVJlY29yZC5yZW1vdmUoIDIgKTsKIC8vIFJlbW92ZSB0aGUgZmlyc3QgNTQ1IGZpZWxkCiBhUmVjb3JkLnJlbW92ZSggIjU0NSIgKTsKIC8vIFJlbW92ZSB0aGUgc2Vjb25kIDU0NSBmaWVsZAogYVJlY29yZC5yZW1vdmUoICI1NDUiLCAxICk7CiAqIEBtZXRob2QKICogQG1lbWJlck9mIFJlY29yZAogKiBAbmFtZSBSZWNvcmQucmVtb3ZlCiAqIEBuYW1lIFJlY29yZCNyZW1vdmUgKi8KUmVjb3JkLnJlbW92ZSA9IG5ldyBTdHJpbmcoKTsKCi8qKiBSZW1vdmUgYWxsIG1hdGNoaW5nIGZpZWxkcyBmcm9tIGEgcmVjb3JkLgogKgogKiBHaXZlbiBhIGZpZWxkIG5hbWUsIHJlbW92ZXMgYWxsIG1hdGNoaW5nIGZpZWxkcyBmcm9tIHRoZSByZWNvcmQuCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBmaWVsZE5hbWUgTmFtZSBvZiBmaWVsZCB0byByZW1vdmUKICogQGV4YW1wbGUKIC8vIFJlbW92ZSBhbGwgNTQ1IGZpZWxkcwogYVJlY29yZC5yZW1vdmVBbGwoICI1NDUiICk7CiAqIEBtZXRob2QKICogQG1lbWJlck9mIFJlY29yZAogKiBAbmFtZSBSZWNvcmQucmVtb3ZlQWxsCiAqIEBuYW1lIFJlY29yZCNyZW1vdmVBbGwgKi8KUmVjb3JkLnJlbW92ZUFsbCA9IG5ldyBTdHJpbmcoKTsKCi8qKiBSZW1vdmVzIGFueSBmaWVsZCBpbiB0aGUgcmVjb3JkLCB0aGF0IG1hdGNoZXMgYSBnaXZlbiBjcml0ZXJpYS4KICoKICogQHBhcmFtIHtSZWdFeHB8T2JqZWN0fSBtYXRjaGVyIEEgUmVnRXhwIHRoYXQgbWF0Y2hlcyB0aGUgZmllbGQgbmFtZQogKiAgICAgICAgICBvciBhbiBvYmplY3Qgd2l0aCBhIGZ1bmN0aW9uIG9mIHRoZSBub3JtOiBmdW5jdGlvbiBtYXRjaEZpZWxkKCByZWNvcmQsIGZpZWxkICkuCiAqICAgICAgICBUaGUgZnVuY3Rpb24gc2hvdWxkIHJldHVybiBhIGJvb2xlYW4gdmFsdWUuCiAqCiAqIEByZXR1cm4gTm90aGluZy4KICoKICogQGV4YW1wbGUKIGZ1bmN0aW9uIHJlbW92ZVN1YmplY3RzKCByZWNvcmQgKSB7CglyZXR1cm4gcmVjb3JkLnJlbW92ZVdpdGhNYXRjaGVyKCAvNjY2LyApOwp9CiAqCiAqIEBtZXRob2QKICogQG5hbWUgUmVjb3JkLnJlbW92ZVdpdGhNYXRjaGVyCiAqIEBuYW1lIFJlY29yZCNyZW1vdmVXaXRoTWF0Y2hlciAqLwpSZWNvcmQucmVtb3ZlV2l0aE1hdGNoZXIgPSBuZXcgU3RyaW5nKCk7CgovKiogSXRlcmF0ZXMgb3ZlciB0aGUgZmllbGRzIGFuZCByZXR1cm5zIGFuIGFycmF5IG9mIHRoZSBzZWxlY3RlZCBmaWVsZHMKICoKICogQHBhcmFtIHtSZWdFeHB8U3RyaW5nfE9iamVjdH0gbWF0Y2hlciBBIFJlZ0V4cCB0aGF0IG1hdGNoZXMgdGhlIGZpZWxkIG5hbWUKICogICAgICAgICAgb3IgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbiBvZiB0aGUgbm9ybTogZnVuY3Rpb24gbWF0Y2hGaWVsZCggcmVjb3JkLCBmaWVsZCApLgogKiAgICAgICAgVGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBib29sZWFuIHZhbHVlLgogKiBAcGFyYW0ge0FycmF5fSBzb3J0ZXIgQW4gYXJyYXkgb2Ygb2JqZWN0cyB0aGF0IGhhcyBhIGZ1bmN0aW9uOiBzb3J0KCBhLCBiICkuIGEgYW5kCiAqICAgICAgICAgIGIgYXJlIGZpZWxkcyBhbmQgdGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gLTEgKGEgPCBiKSwgMCAoIGEgPT0gYikgb3IgMSAoYSA+IGIpLgogKiAgICAgICAgICBJZiB0aGUgZnVuY3Rpb24gcmV0dXJucyAtMSBvciAxLCB0aGVuIHRoZSB0d28gZmllbGRzIGFyZSBzb3J0ZWQgYW5kIGFueSBmdXJ0aGVyCiAqICAgICAgICAgIGVsZW1lbnRzIGluIHRoZSBhcnJheSBhcmUgaWdub3JlZCBmb3IgdGhlc2UgdHdvIGZpZWxkcy4KICoKICogQHJldHVybiB7QXJyYXl9IEFuIGFycmF5IG9mIHRoZSBzZWxlY3RlZCBmaWVsZHMuIEVhY2ggZWxlbWVudCBpcyBvZiB0eXBlIEZpZWxkLgogKgogKiBAbWV0aG9kCiAqIEBuYW1lIFJlY29yZC5zZWxlY3RGaWVsZHMKICogQG5hbWUgUmVjb3JkI3NlbGVjdEZpZWxkcyAqLwoKUmVjb3JkLnNlbGVjdEZpZWxkcyA9IG5ldyBTdHJpbmcoKTsKCi8qKiBJdGVyYXRlcyBvdmVyIHRoZSBmaWVsZHMgYW5kIHJldHVybnMgYW4gYXJyYXkgb2YgdGhlIHNlbGVjdGVkIGZpZWxkcyBhcyBhIHNlcXVlbmNlLgogKgogKiBBIHNlcXVlbmNlIGlzIGFuIGFycmF5IG9mIG1hdGNoZXJzIHRoYXQgaXMgdXNlZCB0byBleHRyYWN0IGZpZWxkcy4gVGhlIHJldHVybmVkIGFycmF5IGNvbnRhaW5zCiAqIGZpcnN0IHRoZSBmaXJzdCBmaWVsZCBmcm9tIGVhY2ggbWF0Y2hlciwgdGhlbiBvbiB0aGUgc2Vjb25kIGZpZWxkIGZyb20gZWFjaCBtYXRjaGVyLAogKiBhbmQgc28gb24uCiAqCiAqIElmIHRoZSBtYXRjaGVycyBtYXRjaGVzIG9uIGRpZmZlcmVudCBudW1iZXIgb2YgZmllbGRzLCB0aGVuIG9ubHkgdGhlIHNtYWxsZXN0IG51bWJlciBvZiBtYXRjaGVkCiAqIGZpZWxkcyBpcyB1c2VkLgogKgogKiBAcGFyYW0ge1JlZ0V4cHxPYmplY3R9IG1hdGNoZXIgQSBSZWdFeHAgdGhhdCBtYXRjaGVzIHRoZSBmaWVsZCBuYW1lCiAqICAgICAgICAgIG9yIGFuIG9iamVjdCB3aXRoIGEgZnVuY3Rpb24gb2YgdGhlIG5vcm06IGZ1bmN0aW9uIG1hdGNoRmllbGQoIHJlY29yZCwgZmllbGQgKS4KICogICAgICAgIFRoZSBmdW5jdGlvbiBzaG91bGQgcmV0dXJuIGEgYm9vbGVhbiB2YWx1ZS4KICogQHBhcmFtIHtBcnJheX0gc29ydGVyIEFuIGFycmF5IG9mIG9iamVjdHMgdGhhdCBoYXMgYSBmdW5jdGlvbjogc29ydCggYSwgYiApLiBhIGFuZAogKiAgICAgICAgICBiIGFyZSBmaWVsZHMgYW5kIHRoZSBmdW5jdGlvbiBzaG91bGQgcmV0dXJuIC0xIChhIDwgYiksIDAgKCBhID09IGIpIG9yIDEgKGEgPiBiKS4KICogICAgICAgICAgSWYgdGhlIGZ1bmN0aW9uIHJldHVybnMgLTEgb3IgMSwgdGhlbiB0aGUgdHdvIGZpZWxkcyBhcmUgc29ydGVkIGFuZCBhbnkgZnVydGhlcgogKiAgICAgICAgICBlbGVtZW50cyBpbiB0aGUgYXJyYXkgYXJlIGlnbm9yZWQgZm9yIHRoZXNlIHR3byBmaWVsZHMuCiAqCiAqIEByZXR1cm4ge0FycmF5fSBBbiBhcnJheSBvZiB0aGUgc2VsZWN0ZWQgZmllbGRzLiBFYWNoIGVsZW1lbnQgaXMgb2YgdHlwZSBGaWVsZC4KICoKICogQG1ldGhvZAogKiBAbmFtZSBSZWNvcmQuc2VsZWN0RmllbGRzU2VxdWVuY2UKICogQG5hbWUgUmVjb3JkI3NlbGVjdEZpZWxkc1NlcXVlbmNlICovClJlY29yZC5zZWxlY3RGaWVsZHNTZXF1ZW5jZSA9IG5ldyBTdHJpbmcoKTsKCi8qKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgZmllbGRzIGluIHRoaXMgcmVjb3JkLgogKgogKiAgQHJldHVybiB7TnVtYmVyfSBUaGUgbnVtYmVyIG9mIGZpZWxkcy4KICogIEBleGFtcGxlCiAvLyBUaGlzIGZ1bmN0aW9uIGlzIG1vc3RseSB1c2VkIGluIGZ1bmN0aW9ucyB3aXRoIGZvci1zdHJ1Y3R1cmVzIGxpa2U6CiBmdW5jdGlvbiBwcmludEZpZWxkcyggcmVjb3JkICkgewoJZm9yKCB2YXIgaSA9IDA7IGkgPCByZWNvcmQuc2l6ZSgpOyBpKysgKSB7CgkJdmFyIGZpZWxkID0gcmVjb3JkLmZpZWxkKCBpICk7CgkJCgkJcHJpbnQoIGZpZWxkLnRvU3RyaW5nKCkgKyAiXG4iICk7Cgl9Cn0KICoKICogQG1ldGhvZAogKiBAbmFtZSBSZWNvcmQuc2l6ZQogKiBAbmFtZSBSZWNvcmQjc2l6ZSAqLwpSZWNvcmQuc2l6ZSA9IG5ldyBTdHJpbmcoKTsKCi8qKiBHZXQgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIHJlY29yZC4KICoKICogVGhpcyBtZXRob2QgcmV0dXJucyBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgcmVjb3JkLCBpbiBhCiAqIGZvcm1hdCB2ZXJ5IGNsb3NlIHRvIGEgc3RhbmRhcmQgTWFyYyBsaW5lIGZvcm1hdC4gVGhlIHN0cmluZyBpcwogKiBjb25zdHJ1Y3RlZCBieSBjYWxsaW5nIHRoZSB0b1N0cmluZyBtZXRob2Qgb2YgYWxsIHRoZSBmaWVsZHMgdGhlCiAqIHJlY29yZCBjb250YWlucy4KICoKICogQW55IHZhbHVlcyBvZiBAIG9yICogaW4gZmllbGRzL3N1YmZpZWxkcywgd2lsbCBiZSB3cml0dGVuIGFzCiAqIEBAIGFuZCBAKiByZXNwZWN0aXZlbHkuCiAqCiAqIEByZXR1cm4ge1N0cmluZ30gQSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIHJlY29yZAogKiBAbWV0aG9kCiAqIEBtZW1iZXJPZiBSZWNvcmQKICogQG5hbWUgUmVjb3JkLnRvU3RyaW5nCiAqIEBuYW1lIFJlY29yZCN0b1N0cmluZyAqLwpSZWNvcmQudG9TdHJpbmcgPSBuZXcgU3RyaW5nKCk7CgovKiogQ3JlYXRlIGEgcmVjb3JkIGZyb20gYSBzdHJpbmcuCiAqCiAqIFRoaXMgbWV0aG9kIGNoYW5nZXMgdGhlIHJlY29yZCB0byByZXByZXNlbnQgdGhlIGlucHV0IGluIHRoZSBzdHJpbmcuCiAqCiAqIEV4aXN0aW5nIGNvbnRlbnQgb2YgdGhlIHJlY29yZCBpcyBjbGVhcmVkLiBUaGUgaW5wdXQgaXMgcGFyc2VkIHRvCiAqIGJ1aWxkIGEgbmV3IHJlY29yZCBpbiBwbGFjZS4gVGhlIHBhcnNlciBob25vcnMgdHdvICJzdGFuZGFyZCIgTWFyYwogKiByZWNvcmQgZXNjYXBlIGNvZGVzOiBAQCBhbmQgQFwqLCB3aGljaCBhcmUgdHJhbnNsYXRlZCB0byBAIGFuZCBcKgogKiByZXNwZWN0aXZlbHkuIE90aGVyIEAgY29kZXMgYXJlIG5vdCBpbnRlcnByZXRlZCwgYnV0IGFyZSBjYXJyaWVkCiAqIHRocm91Z2ggdW5jaGFuZ2VkLgogKgogKiAqKk5PVEU6KiogY29udHJvbEZpZWxkcyBhcmUgKm5vdCBzdXBwb3J0ZWQqIGJ5IHRoaXMgbWV0aG9kLgogKgogKiBAcGFyYW0ge1N0cmluZ30gc3RyaW5nIEEgTWFyYyByZWNvcmQgaW4gbGluZSBmb3JtYXQuCiAqIEBtZXRob2QKICogQG1lbWJlck9mIFJlY29yZAogKiBAbmFtZSBSZWNvcmQuZnJvbVN0cmluZwogKiBAbmFtZSBSZWNvcmQjZnJvbVN0cmluZyAqLwpSZWNvcmQuZnJvbVN0cmluZyA9IG5ldyBTdHJpbmcoKTsKCgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vIEZJRUxECi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCi8qKiBBIGZpZWxkIGluIGEgTWFyYyByZWNvcmQuCiAqCiAqIFRoZSBGaWVsZCBjbGFzcyBpcyBhbiBhYnN0cmFjdGlvbiBmb3IgYSBGaWVsZCBpbiBhIE1hcmMgcmVjb3JkLiBJdAogKiBjb250YWlucyBhIG51bWJlciBvZiBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzIHRvIHJlcHJlc2VudCBhbmQKICogbWFuaXB1bGF0ZSBhIGZpZWxkLgogKgogKiBZb3UgY2FuIGNvbnN0cnVjdCBhIGZpZWxkIGluc3RhbmNlIGluIG9uZSBvZiB0d28gd2F5cywgZWl0aGVyIGFzIGFuCiAqIGVtcHR5IGZpZWxkLCBvciBieSBnaXZpbmcgaXQgYSBuYW1lIGFuZCBhbiBpbmRpY2F0b3IuCiAqCiAqIEEgZmllbGQgY2FuIGJlIGVpdGhlciBhICpub3JtYWwgZmllbGQqLCB3aXRoIG5hbWUsIGluZGljYXRvciBhbmQKICogc3ViZmllbGRzLCBvciBpdCBjYW4gYmUgYSAqY29udHJvbCBmaWVsZCosIHdpdGggbmFtZSBhbmQgdmFsdWUuIEFsbAogKiBmaWVsZHMgYXJlIGNvbnN0cnVjdGVkIGFzIG5vcm1hbCBmaWVsZHMuIElmIHlvdSB3YW50IHRvIGNyZWF0ZSBhCiAqIGNvbnRyb2wgZmllbGQsIHlvdSBtdXN0IHVzZSB0aGUgZGVmYXVsdCBjb25zdHJ1Y3RvciAobm8gYXJndW1lbnQpLAogKiB0aGVuIHNldCB0aGUgbmFtZSBhbmQgdmFsdWUgcHJvcGVydGllcyBhZnRlcndhcmRzLiBTZXR0aW5nIHRoZQogKiB2YWx1ZSBwcm9wZXJ0eSBvbiBhIGZpZWxkIHdpdGggbm8gaW5kaWNhdG9yLCBhbmQgbm8gc3ViZmllbGRzLAogKiB0dXJucyBpdCBpbnRvIGEgY29udHJvbCBmaWVsZC4gSXQgaXMgbm90IHBvc3NpYmx5IHRvIHR1cm4gYSBjb250cm9sCiAqIGZpZWxkIGJhY2sgaW50byBhIG5vcm1hbCBmaWVsZC4KICoKICogQGV4YW1wbGUKIC8vIFN5bnRheAogdmFyIGYxID0gbmV3IEZpZWxkKCk7CiB2YXIgZjIgPSBuZXcgRmllbGQoIGZpZWxkTmFtZSwgaW5kaWNhdG9yICk7CiAqIEBleGFtcGxlCiAvLyBUaGlzIGNvbnN0cnVjdHMgYSBub3JtYWwgZmllbGQsIGFuZCBhZGRzIGEgc3ViZmllbGQKIHZhciBub3JtYWxGaWVsZCA9IG5ldyBGaWVsZCggIjAwMSIsICIwMiIgKTsKIG5vcm1hbEZpZWxkLmFwcGVuZCggbmV3IFN1YmZpZWxkKCAiYSIsICJ2YWx1ZSBvZiBhIHN1YmZpZWxkIiApICk7CiAqIEBleGFtcGxlCiAvLyBUaGlzIGNvbnN0cnVjdHMgYSBub3JtYWwgZmllbGQsIHdpdGggbm8gbmFtZSBvciBpbmRpY2F0b3IsCiAvLyB3aGljaCBpcyB0aGVuIHRyYW5zZm9ybWVkIHRvIGEgY29udHJvbCBmaWVsZCBieSBzZXR0aW5ncyBpdHMgdmFsdWUKIHZhciBjb250cm9sRmllbGQgPSBuZXcgRmllbGQoKTsKIGNvbnRyb2xGaWVsZC5uYW1lID0gIjAwMiI7CiBjb250cm9sRmllbGQudmFsdWUgPSAiVGhpcyBpcyB0aGUgdmFsdWUgb2YgdGhlIGNvbnRyb2wgZmllbGQiCiAqIEBwYXJhbSB7c3RyaW5nfSBbZmllbGROYW1lXSBOYW1lIG9mIHRoZSBuZXcgZmllbGQuCiAqIEBwYXJhbSB7c3RyaW5nfSBbaW5kaWNhdG9yXSBWYWx1ZSBvZiB0aGUgaW5kaWNhdG9yLiAqTXVzdCBiZSBwcmVzZW50IGlmIGZpZWxkTmFtZSBpcyBnaXZlbi4qCiAqIEBjb25zdHJ1Y3RvcgogKiBAc2VlIE1hcmNDbGFzc2VzCiAqIEBzZWUgUmVjb3JkCiAqIEBzZWUgU3ViZmllbGQKICogQG5hbWUgRmllbGQgKi8KLy8gRG8gbm90IHJlbW92ZSB0aGlzIGNvbW1lbnQKCi8vIFBST1BFUlRJRVMKCi8qKiBUaGUgbmFtZSBvZiB0aGUgZmllbGQuCiAqCiAqIFRoaXMgcHJvcGVydHkgaG9sZHMgdGhlIG5hbWUgb2YgdGhlIGZpZWxkLgogKgogKiBAdHlwZSB7c3RyaW5nfQogKiBAbmFtZSBGaWVsZC5uYW1lCiAqIEBuYW1lIEZpZWxkI25hbWUgKi8KRmllbGQubmFtZSA9IG5ldyBTdHJpbmcoKTsKCi8qKiBUaGUgaW5kaWNhdG9yIGZvciB0aGUgZmllbGQuCiAqCiAqIFRoaXMgcHJvcGVydHkgaG9sZHMgdGhlIGluZGljYXRvciBmb3IgdGhlIGZpZWxkLCBhcyBhIHN0cmluZywgaWYKICogdGhlIGZpZWxkIGlzIGEgKm5vcm1hbCogZmllbGQuCiAqCiAqIFRoaXMgcHJvcGVydHkgaXMgb25seSBhdmFpbGFibGUsIGlmIHRoZSBmaWVsZCBpcyBhIG5vcm1hbCBmaWVsZCwKICogbm90IGEgY29udHJvbCBmaWVsZC4gQXNzaWduaW5nIHRvLCBvciByZWFkaW5nIGZyb20sIHRoaXMgcHJvcGVydHksCiAqIGlmIHRoZSBmaWVsZCBpcyBhIGNvbnRyb2wgZmllbGQsIHdpbGwgdGhyb3cgYW4gZXhjZXB0aW9uLgogKgogKiBAdHlwZSB7c3RyaW5nfQogKiBAbmFtZSBGaWVsZC5pbmRpY2F0b3IKICogQG5hbWUgRmllbGQjaW5kaWNhdG9yICovCkZpZWxkLmluZGljYXRvciA9IG5ldyBTdHJpbmcoKTsKCi8qKiBUaGUgdmFsdWUgb2YgdGhlIGZpZWxkLgogKgogKiBUaGlzIHByb3BlcnR5IGhvbGRzIHRoZSB2YWx1ZSBvZiB0aGUgZmllbGQsIGlmIHRoZSBmaWVsZCBpcyBhICpjb250cm9sKiBmaWVsZC4KICoKICogQXNzaWduaW5nIHRvIHRoaXMgcHJvcGVydHksIHdpbGwgY29udmVydCBhIG5vcm1hbCBmaWVsZCB0byBhCiAqIGNvbnRyb2wgZmllbGQsICppZiogdGhlIGZpZWxkIGRvZXMgbm90IGNvbnRhaW4gYW4gaW5kaWNhdG9yIG9yIGFueQogKiBzdWJmaWVsZHMuIElmIGl0IGRvZXMsIGFuIGV4Y2VwdGlvbiB3aWxsIGJlIHRocm93bi4gUmVhZGluZyBmcm9tCiAqIHRoaXMgcHJvcGVydHkgd2lsbCBhbHNvIHRocm93LCBpZiB0aGUgZmllbGQgaXMgYSBub3JtYWwgZmllbGQuCiAqCiAqIEB0eXBlIHtzdHJpbmd9CiAqIEBuYW1lIEZpZWxkLnZhbHVlCiAqIEBuYW1lIEZpZWxkI3ZhbHVlICovCkZpZWxkLnZhbHVlID0gbmV3IFN0cmluZygpOwoKLy8gTUVUSE9EUwoKLyoqIEFwcGVuZCBhIHN1YmZpZWxkIHRvIGEgZmllbGQuCiAqCiAqIFRoaXMgbWV0aG9kIGFwcGVuZHMgYSBzdWJmaWVsZCB0byBhIGZpZWxkLiBJdCBjYW4gYmUgY2FsbGVkIGluCiAqIHRocmVlIGRpZmZlcmVudCB3YXlzLgogKgogKiBJZiBjYWxsZWQgd2l0aCBhIFN1YmZpZWxkIGluc3RhbmNlLCB0aGUgc3ViZmllbGQgaXMgYWRkZWQgKGNvcGllZCkKICogdG8gdGhlIGZpZWxkLgogKgogKiBJZiBjYWxsZWQgd2l0aCBhIG5hbWUgYW5kIHZhbHVlLCBhIG5ldyBzdWJmaWVsZCBpcyBjcmVhdGVkIGFuZAogKiBhZGRlZCB0byB0aGUgZmllbGQuCiAqCiAqIElmIGNhbGxlZCB3aXRoIGEgbmFtZSwgYSB2YWx1ZSwgYW5kIGEgYm9vbCBzZXQgdG8gdHJ1ZSwgYSBzdWJmaWVsZAogKiB3aWxsIGJlIGNyZWF0ZWQsIGFuZCBpdCB3aWxsIHJlcGxhY2UgdGhlIGZpcnN0IHN1YmZpZWxkIHdpdGggdGhlCiAqIHNhbWUgbmFtZSwgaWYgcHJlc2VudCwgb3RoZXJ3aXNlIGl0IHdpbGwganVzdCBiZSBhcHBlbmRlZC4KICoKICogVGhlIGFwcGVuZCBvcGVyYXRpb24gY2FuIG9ubHkgYmUgY2FsbGVkIG9uIG5vcm1hbCBmaWVsZHMsIG5vdAogKiBjb250cm9sIGZpZWxkcy4KICoKICogKipOb3RlOioqIEZvciB0aGUgQysrIGltcGxlbWVudGF0aW9uOiBBbnkgcmVmZXJlbmNlIHRvIGV4aXN0aW5nCiAqIHN1YmZpZWxkcyBvbiB0aGlzIHJlY29yZCBtYXkgYmUgaW52YWxpZGF0ZWQgYnkgYXBwZW5kIGEKICogc3ViZmllbGQuIFRoaXMgaGFzIGEgbnVtYmVyIG9mIHBvdGVudGlhbCBiYWQgY29uc2VxdWVuY2VzLCBtb3N0IG9mCiAqIHdoaWNoIGxlYWRzIHRvIGNyYXNoZXMgb3IgdW5wcmVkaWN0YWJsZSBiZWhhdmlvdXIuIEl0IGlzIGVhc3kgdG8KICogZmFsbCBpbnRvIHRoZSB0cmFwIG9mIGUuZy4gaXRlcmF0aW5nIGFsbCBzdWJmaWVsZHMgaW4gYSBmaWVsZCwgYW5kCiAqIGFwcGVuZCBzb21lIHdoaWxlIGl0ZXJhdGluZy4gVGhpcyBpcyBhbG1vc3QgY2VydGFpbiB0byBtYWtlIHlvdXIKICogYXBwbGljYXRpb24gY3Jhc2guIEluc3RlYWQsIGNvbGxlY3QgdGhlIG5ldyBzdWJmaWVsZHMgeW91IHdpc2ggdG8KICogYXBwZW5kLCB0aGVuIGFwcGVuZCB0aGVtIGFmdGVyIHlvdXIgbWFpbiBpdGVyYXRpb24uCiAqCiAqIEBleGFtcGxlCiAvLyBBcHBlbmQgYW4gZXhpc3RpbmcgZmVsZAogYUZpZWxkLmFwcGVuZCggc3ViZmllbGQgKTsKIC8vIENyZWF0ZSBhIG5ldyBzdWJmaWVsZCwgYW5kIGFwcGVuZCBpdAogYUZpZWxkLmFwcGVuZCggImEiLCAiSSBhbSBhbiBhIHN1YmZpZWxkIiApOwogLy8gQ3JlYXRlIGEgbmV3IHN1YmZpZWxkLCBhbmQgYXBwZW5kIGl0IHRvIHRoZSBmaWVsZCwgcmVwbGFjaW5nIHRoZSBmaXJzdCBzaW1pbGFyIHN1YmZpZWxkCiBhRmllbGQuYXBwZW5kKCAiYSIsICJJIGFtIGFuIGEgc3ViZmllbGQiLCB0cnVlICk7CiAqIEBleGFtcGxlIC8vIFRoaXMgZXhhbXBsZSBpbGx1c3RyYXRlcyB0aGUgcmVsYXRpb24gYmV0d2VlbiBleGlzdGluZyByZWZlcmVuY2VzLCBhbmQgbmV3IFN1YmZpZWxkcy4KIHZhciBhRmllbGQgPSBuZXcgRmllbGQoKTsKIGFGaWVsZC5hcHBlbmQoICJhIiwgIkkgYW0gYW4gc3ViZmllbGQiICk7CiB2YXIgYVN1YmZpZWxkID0gYUZpZWxkLnN1YmZpZWxkKCAiYSIgKTsKIGFTdWJmaWVsZC5uYW1lID0gImIiIC8vIENoYW5nZXMgdGhlIG5hbWUgb2YgdGhlIHN1YmZpZWxkIGluIGFGaWVsZAogdmFyIG5ld0ZpZWxkID0gbmV3IEZpZWxkKCk7CiBuZXdGaWVsZC5hcHBlbmQoIGFTdWJmaWVsZCApOyAvLyBhU3ViZmllbGQgaXMgY29waWVkIGludG8gbmV3RmllbGQKIGFTdWJmaWVsZC5uYW1lID0gImEiIC8vIENoYW5nZXMgdGhlIG5hbWUgb2YgdGhlIGZpZWxkIGluIGFGaWVsZCwgYnV0IG5vdCBpbiBuZXdGaWVsZC4KICoKICogQHBhcmFtIHtTdWJmaWVsZHxTdHJpbmd9IHN1YmZpZWxkT3JTdWJmaWVsZE5hbWUgVGhlIFN1YmZpZWxkIHRvIGFkZCwgb3IgdGhlIG5hbWUgb2YgYSBuZXcgc3ViZmllbGQgdG8gY3JlYXRlIGFuZCBhZGQuCiAqIEBwYXJhbSB7U3RyaW5nfSBbc3ViZmllbGRWYWx1ZV0gVGhlIHZhbHVlIG9mIHRoZSBuZXcgU3ViZmllbGQgdG8gYWRkLiAqTXVzdCBiZSBwcmVzZW50IGlmIHRoZSBmaXJzdCBhcmd1bWVudCBpcyBhIHN1YmZpZWxkTmFtZS4qCiAqIEBwYXJhbSB7Qm9vbH0gW3JlcGxhY2VdIElmIHRydWUsIHJlcGxhY2UgZXhpc3Rpbmcgc3ViZmllbGRzIG9mIHRoZSBzYW1lIG5hbWUuCiAqIEBtZXRob2QKICogQG5hbWUgRmllbGQuYXBwZW5kCiAqIEBuYW1lIEZpZWxkI2FwcGVuZCAqLwpGaWVsZC5hcHBlbmQgPSBuZXcgU3RyaW5nKCk7CgovKiogQ3JlYXRlIGEgY2xvbmUgKGNvcHkpIG9mIHRoaXMgZmllbGQuCiAqCiAqIEFsbCB0aGUgc3ViIGZpZWxkcyBvZiB0aGlzIGZpZWxkIGFyZSBhbHNvIGNsb25lZCBieSB0aGlzIGZ1bmN0aW9uLgogKgogKiBAcmV0dXJuIHtGaWVsZH0gQW4gZXhhY3QgY2xvbmUgb2YgdGhpcyBmaWVsZC4KICoKICogQG1ldGhvZAogKiBAbmFtZSBGaWVsZC5jbG9uZQogKiBAbmFtZSBGaWVsZCNjbG9uZSAqLwpGaWVsZC5jbG9uZSA9IG5ldyBTdHJpbmcoKTsKCi8qKiBDb3VudCB0aGUgbnVtYmVyIG9mIHN1YmZpZWxkcyBpbiBhIGZpZWxkIHdpdGggYSBnaXZlbiBuYW1lLgogKgogKiBHaXZlbiB0aGUgbmFtZSBvZiBhIHN1YmZpZWxkLCB0aGlzIG1ldGhvZCByZXR1cm5zIHRoZSBudW1iZXIgb2YKICogc3ViZmllbGRzIHdpdGggdGhhdCBuYW1lLgogKgogKiBAcGFyYW0ge3N0cmluZ30gc3ViZmllbGROYW1lIFRoZSBuYW1lIG9mIGEgZmllbGQuCiAqIEByZXR1cm4ge251bWJlcn0gVGhlIG51bWJlciBvZiBzdWJmaWVsZHMgd2l0aCB0aGUgZ2l2ZW4gc3ViZmllbGROYW1lCiAqCiAqIEBleGFtcGxlCiAvLyBDb3VudCB0aGUgbnVtYmVyIG9mICJhIiBzdWJmaWVsZHMKIHZhciBudW0gPSBmaWVsZC5jb3VudCggImEiICk7CiAqIEBtZXRob2QKICogQG5hbWUgRmllbGQuY291bnQKICogQG5hbWUgRmllbGQjY291bnQgKi8KRmllbGQuY291bnQgPSBuZXcgU3RyaW5nKCk7CgovKiogSXRlcmF0ZXMgb3ZlciB0aGUgc3ViIGZpZWxkcyBhbmQgY2FsbHMgYW4gaGFuZGxlciBvbiBlYWNoIHN1YiBmaWVsZC4KICoKICogQHBhcmFtIHtSZWdFeHB8U3RyaW5nfE9iamVjdH0gbWF0Y2hlciBBbiBSZWdFeHAgb3Igc3RyaW5nIHRoYXQgbWF0Y2hlcyB0aGUgc3ViZmllbGQgbmFtZQogKiAgICAgICAgICBvciBhbiBvYmplY3Qgd2l0aCBhIGZ1bmN0aW9uIG9mIHRoZSBub3JtOiBmdW5jdGlvbiBtYXRjaFN1YkZpZWxkKCBmaWVsZCwgc3ViZmllbGQgKS4KICogICAgICAgIFRoZSBmdW5jdGlvbiBzaG91bGQgcmV0dXJuIGEgYm9vbGVhbiB2YWx1ZS4KICogQHBhcmFtIHtIYW5kbGVyfEZ1bmN0aW9ufSBoYW5kbGVyIFRoZSBoYW5kbGVyIHRvIGNhbGwgZm9yIGVhY2ggc3ViZmllbGQgZm91bmQKICogICAgICAgICAgYnkgbWF0Y2hlci4KICoKICogQHJldHVybiBJZiBoYW5kbGVyIHJldHVybnMgYSB2YWx1ZSB0aGVuIGFsbCB0aGUgdmFsdWVzIGFyZSBhZGRlZCB0b2dldGhlciBpbnRvIGEKICogICAgICAgICAgIHNpbmdsZSB2YWx1ZS4KICoKICogQGV4YW1wbGUKIGZ1bmN0aW9uIGdldFZhbHVlKCBmaWVsZCApIHsKCXJldHVybiBmaWVsZC5lYWNoU3ViRmllbGQoICJhIiwgZnVuY3Rpb24oIGZpZWxkLCBzdWJGaWVsZCApIHsgcmV0dXJuIHN1YkZpZWxkLnZhbHVlOyB9ICk7Cn0KICoKICogVGhlIGZ1bmN0aW9uIGdldFZhbHVlIGlzIHBhc3NlZCBhIGZpZWxkIGFuZCBpdGVyYXRlcyBvdmVyIGEgc3ViIGZpZWxkcyB3aXRoIG5hbWUgImEiIGFuZCBjb2xsZWN0cyB0aGUgdmFsdWVzIG9mIGFsbCBzdWIgZmllbGRzIHdpdGggbmFtZSAiYSIKICoKICogQG1ldGhvZAogKiBAbmFtZSBGaWVsZC5lYWNoU3ViRmllbGQKICogQG5hbWUgRmllbGQjZWFjaFN1YkZpZWxkICovCkZpZWxkLmVhY2hTdWJGaWVsZCA9IG5ldyBTdHJpbmcoKTsKCi8qKiBJdGVyYXRlcyBvdmVyIHRoZSBzdWJmaWVsZHMgYW5kIGNhbGxzIGEgaGFuZGxlciBvbiBlYWNoIHN1YmZpZWxkIGFzIGEgc2VxdWVuY2UuCiAqCiAqIEEgc2VxdWVuY2UgaXMgYW4gYXJyYXkgb2YgbWF0Y2hlcnMgdGhhdCBpcyB1c2VkIHRvIGV4dHJhY3Qgc3ViZmllbGRzLiBUaGUgaGFuZGxlcgogKiBpcyB0aGVuIHVzZWQgb24gdGhlIGZpcnN0IHN1YmZpZWxkIGZyb20gZWFjaCBtYXRjaGVyLCB0aGVuIG9uIHRoZSBzZWNvbmQgc3ViZmllbGQKICogZnJvbSBlYWNoIG1hdGNoZXIsIGFuZCBzbyBvbi4KICoKICogSWYgdGhlIG1hdGNoZXJzIG1hdGNoZXMgb24gZGlmZmVyZW50IG51bWJlciBvZiBzdWJmaWVsZHMsIHRoZW4gb25seSB0aGUgc21hbGxlc3QKICogbnVtYmVyIG9mIG1hdGNoZWQgc3ViZmllbGRzIGluIHVzZWQsIHRoZW4gd2UgaW52b2tlIHRoZSBoYW5kbGVyIG9uIHRoZSBzdWJmaWVsZC4KICoKICogQHBhcmFtIHtBcnJheX0gbWF0Y2hlcnMgQW4gQXJyYXkgb2YgbWF0Y2hlciBvYmplY3RzIChSZWdFeHAncyBvciBPYmplY3RzKS4KICogICAgICAgICAgVXNlIFJlZ0V4cCB0byBtYXRjaCB0aGUgc3ViZmllbGQgbmFtZSBvciB1c2UgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbgogKiAgICAgICAgICBvZiB0aGUgbm9ybTogZnVuY3Rpb24oIGZpZWxkLCBzdWJmaWVsZCApLiBUaGUgZnVuY3Rpb24gc2hvdWxkIHJldHVybiBhCiAqICAgICAgICAgIGJvb2xlYW4gdmFsdWUuCiAqIEBwYXJhbSB7SGFuZGxlcnxGdW5jdGlvbn0gaGFuZGxlciBUaGUgaGFuZGxlciB0byBjYWxsIGZvciBlYWNoIHN1YmZpZWxkIGZvdW5kCiAqICAgICAgICAgIGJ5IG1hdGNoZXIuCiAqCiAqIEByZXR1cm4gSWYgaGFuZGxlciByZXR1cm5zIGEgdmFsdWUgdGhlbiBhbGwgdGhlIHZhbHVlcyBhcmUgYWRkZWQgdG9nZXRoZXIgaW50byBhCiAqICAgICAgICAgICBzaW5nbGUgdmFsdWUuCiAqCiAqIEBleGFtcGxlCiBmaWVsZC5lYWNoU3ViRmllbGQoIFsgL2EvLCAvaS8gXSwgZnVuY3Rpb24oIGZpZWxkLCBzdWJGaWVsZCApIHsgcHJpbnQoIHN1YkZpZWxkLnZhbHVlICsgIiAiICkgfSApOwogKgogKiBUaGUgZnVuY3Rpb24gcHJpbnRzIHRoZSBzdWIgZmllbGRzICJhIiBhbmQgImkiIGluIHRoaXMgb3JkZXI6IEZpcnN0IGEsIGZpcnN0IGksIHNlY29uZCBhLAogKiBzZWNvbmQgaSwgYW5kIHNvIG9uLgogKgogKiBAbWV0aG9kCiAqIEBuYW1lIEZpZWxkLmVhY2hTdWJGaWVsZFNlcXVlbmNlCiAqIEBuYW1lIEZpZWxkI2VhY2hTdWJGaWVsZFNlcXVlbmNlICovCkZpZWxkLmVhY2hTdWJGaWVsZFNlcXVlbmNlID0gbmV3IFN0cmluZygpOwoKRmllbGQuZWFjaFN1YkZpZWxkTWFwID0gbmV3IFN0cmluZygpOwoKLyoqIENoZWNrcyBpZiB0aGUgZmllbGQgaXMgZW1wdHksIHRoYXQgaXQgaGFzIHplcm8gc3ViZmllbGRzLgogKgogKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBmaWVsZCBpcyBlbXB0eSwgZmFsc2Ugb3RoZXJ3aXNlLgogKgogKiBAZXhhbXBsZQogLy8gZW1wdHkoKSBpcyBhbnkgdGltZXMgdXNlZCBhcyBhIGVhcmx5IGNoZWNrIGluIHRoZSBiZWdpbm5pbmcgb2YgYSBmdW5jdGlvbgogZnVuY3Rpb24gZiggZmllbGQgKSB7CglpZiggZmllbGQuZW1wdHkoKSApIHsKIAkJcmV0dXJuOwogCX0KIAkKIAkvLyBOb3JtYWwgbG9naWMuLi4gCQp9CiAqIEBtZXRob2QKICogQG5hbWUgRmllbGQuZW1wdHkKICogQG5hbWUgRmllbGQjZW1wdHkgKi8KRmllbGQuZW1wdHkgPSBuZXcgU3RyaW5nKCk7CgovKiogQ2hlY2tzIGlmIHRoZSBmaWVsZCBjb250YWlucyBhdCBsZWFzdCBvbmUgc3ViZmllbGQsIHRoYXQgbWF0Y2hlcyBhIGNyaXRlcmlhLgogKgogKiBAcGFyYW0ge1JlZ0V4cHxPYmplY3R9IG1hdGNoZXIgQSBSZWdFeHAgdGhhdCBtYXRjaGVzIHRoZSBzdWJmaWVsZCBuYW1lCiAqICAgICAgICAgIG9yIGFuIG9iamVjdCB3aXRoIGEgZnVuY3Rpb24gb2YgdGhlIG5vcm06IGZ1bmN0aW9uIG1hdGNoU3ViRmllbGQoIGZpZWxkLCBzdWJmaWVsZCApLgogKiAgICAgICAgVGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBib29sZWFuIHZhbHVlLgogKgogKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIGEgc3ViIGZpZWxkIG1hdGNoZXMgdGhlIG1hdGNoZXIgYXJndW1lbnQsIEZhbHNlIG90aGVyd2lzZS4KICoKICogQGV4YW1wbGUKIGZ1bmN0aW9uIGhhc1RpdGxlKCBmaWVsZCApIHsKCXJldHVybiBmaWVsZC5leGlzdHMoIC9hLyApOwp9CiAqCiAqIFRoZSBmdW5jdGlvbiBoYXNUaXRsZSBjaGVja3MgaWYgdGhlIHBhc3NlZCBmaWVsZCBjb250YWlucyBhIHN1YiBmaWVsZCB3aXRoIG5hbWUgImEiLgogKgogKiBAbWV0aG9kCiAqIEBuYW1lIEZpZWxkLmV4aXN0cwogKiBAbmFtZSBGaWVsZCNleGlzdHMgKi8KRmllbGQuZXhpc3RzID0gbmV3IFN0cmluZygpOwoKLyoqIEl0ZXJhdGVzIG92ZXIgdGhlIHN1YmZpZWxkcyBhbmQgcmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIGZpcnN0IHN1YmZpZWxkIHRoYXQgbWF0Y2hlcyBhIGNyaXRlcmlhLgogKgogKiBAcGFyYW0ge1JlZ0V4cHxTdHJpbmd8T2JqZWN0fSBtYXRjaGVyIEEgUmVnRXhwIG9yIHN0cmluZyB0aGF0IG1hdGNoZXMgdGhlIHN1YmZpZWxkIG5hbWUKICogICAgICAgICAgb3IgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbiBvZiB0aGUgbm9ybTogZnVuY3Rpb24gbWF0Y2hTdWJGaWVsZCggZmllbGQsIHN1YmZpZWxkICkuCiAqICAgICAgICBUaGUgZnVuY3Rpb24gc2hvdWxkIHJldHVybiBhIGJvb2xlYW4gdmFsdWUuCiAqIEBwYXJhbSB7SGFuZGxlcnxGdW5jdGlvbn0gaGFuZGxlciBUaGUgaGFuZGxlciB0byBjYWxsIGZvciBlYWNoIHN1YmZpZWxkIGZvdW5kCiAqICAgICAgICAgIGJ5IG1hdGNoZXIuCiAqCiAqIEByZXR1cm4gSWYgaGFuZGxlciByZXR1cm5zIGEgdmFsdWUgdGhlbiB0aGF0IHZhbHVlIGlzIHJldHVybmVkIGJ5IEZpZWxkLmZpcnN0U3ViRmllbGQKICoKICogQGV4YW1wbGUKIGZ1bmN0aW9uIGdldFRpdGxlKCBmaWVsZCApIHsKCXJldHVybiBmaWVsZC5maXJzdFN1YkZpZWxkKCAvYS8sIGZ1bmN0aW9uKCBmaWVsZCwgc3ViRmllbGQgKSB7IHJldHVybiBzdWJGaWVsZC52YWx1ZTsgfSApOwp9CiAqCiAqIFRoZSBmdW5jdGlvbiBnZXRUaXRsZSBpcyBwYXNzZWQgYSBmaWVsZCBhbmQgaXRlcmF0ZXMgb3ZlciBzdWJmaWVsZHMgd2l0aCBuYW1lICJhIiBhbmQKICogcmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIGZpcnN0IG9jY3VyZW5jZSBvZiBzdWJmaWVsZCAiYSIuCiAqCiAqIEBtZXRob2QKICogQG5hbWUgRmllbGQuZmlyc3RTdWJGaWVsZAogKiBAbmFtZSBGaWVsZCNmaXJzdFN1YkZpZWxkICovCkZpZWxkLmZpcnN0U3ViRmllbGQgPSBuZXcgU3RyaW5nKCk7CgovKiogUmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIGZpcnN0IHN1YmZpZWxkIHRoYXQgbWF0Y2hlcyBhIG1hdGNoZXIuCiAqCiAqIEBwYXJhbSB7UmVnRXhwfFN0cmluZ3xPYmplY3R9IG1hdGNoZXIgQSBSZWdFeHAgb3Igc3RyaW5nIHRoYXQgbWF0Y2hlcyB0aGUgc3ViZmllbGQgbmFtZQogKiAgICAgICAgICBvciBhbiBvYmplY3Qgd2l0aCBhIGZ1bmN0aW9uIG9mIHRoZSBub3JtOiBmdW5jdGlvbiBtYXRjaFN1YkZpZWxkKCBmaWVsZCwgc3ViZmllbGQgKS4KICogICAgICAgIFRoZSBmdW5jdGlvbiBzaG91bGQgcmV0dXJuIGEgYm9vbGVhbiB2YWx1ZS4KICoKICogQHJldHVybiB7U3RyaW5nfSBJZiBoYW5kbGVyIHJldHVybnMgYSB2YWx1ZSB0aGVuIHRoYXQgdmFsdWUgaXMgcmV0dXJuZWQgYnkgRmllbGQuZmlyc3RTdWJGaWVsZAogKgogKiBAZXhhbXBsZQogZnVuY3Rpb24gZ2V0Rmlyc3RUaXRsZSggZmllbGQgKSB7CglyZXR1cm4gZmllbGQuZ2V0Rmlyc3RWYWx1ZSggL2EvICk7Cn0KICoKICogVGhlIGZ1bmN0aW9uIGdldEZpcnN0VGl0bGUgaXMgcGFzc2VkIGEgbWF0Y2hlciBhbmQgcmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIGZpcnN0IHN1YmZpZWxkIHdpdGggbmFtZSAiYSIuCiAqCiAqIEBtZXRob2QKICogQG5hbWUgRmllbGQuZ2V0Rmlyc3RWYWx1ZQogKiBAbmFtZSBGaWVsZCNnZXRGaXJzdFZhbHVlICovCkZpZWxkLmdldEZpcnN0VmFsdWUgPSBuZXcgU3RyaW5nKCk7CgovKiogSXRlcmF0ZXMgb3ZlciB0aGUgc3ViZmllbGRzIGFuZCByZXR1cm5zIHRoZSB2YWx1ZXMgb2YgYW55IHN1YmZpZWxkIHRoYXQgbWF0Y2hlcyB0aGUgY3JpdGVyaWEuCiAqCiAqIEBwYXJhbSB7UmVnRXhwfE9iamVjdH0gbWF0Y2hlciBBIFJlZ0V4cCB0aGF0IG1hdGNoZXMgdGhlIHN1YiBmaWVsZG5hbWUKICogICAgICAgICAgb3IgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbiBvZiB0aGUgbm9ybTogZnVuY3Rpb24gbWF0Y2hTdWJGaWVsZCggZmllbGQsIHN1YmZpZWxkICkuCiAqICAgICAgICBUaGUgZnVuY3Rpb24gc2hvdWxkIHJldHVybiBhIGJvb2xlYW4gdmFsdWUuCiAqCiAqIEByZXR1cm4ge0FycmF5fSBBbiBhcnJheSB3aXRoIGFsbCB0aGUgZm91bmQgdmFsdWVzLgogKgogKiBAZXhhbXBsZQogZnVuY3Rpb24gZ2V0VGl0bGVzKCBmaWVsZCApIHsKCXJldHVybiBmaWVsZC5nZXRWYWx1ZUFzQXJyYXkoIC9hLyApOwp9CiAqCiAqIFRoZSBmdW5jdGlvbiBnZXRUaXRsZXMgaXMgcGFzc2VkIGEgZmllbGQgYW5kIGl0ZXJhdGVzIG92ZXIgYSBzdWJmaWVsZHMgd2l0aCBuYW1lICJhIiBhbmQKICogcmV0dXJucyB0aGUgdmFsdWVzIG9mIHRoZSBhbGwgc3ViZmllbGQgd2l0aCBuYW1lICJhIgogKgogKiBAbWV0aG9kCiAqIEBuYW1lIEZpZWxkLmdldFZhbHVlQXNBcnJheQogKiBAbmFtZSBGaWVsZCNnZXRWYWx1ZUFzQXJyYXkgKi8KRmllbGQuZ2V0VmFsdWVBc0FycmF5ID0gbmV3IFN0cmluZygpOwoKLyoqIEl0ZXJhdGVzIG92ZXIgdGhlIHN1YmZpZWxkcyBhbmQgcmV0dXJucyB0aGUgdmFsdWVzIG9mIGFueSBzdWJmaWVsZCB0aGF0IG1hdGNoZXMgYSBjcml0ZXJpYS4KICoKICogQHBhcmFtIHtSZWdFeHB8U3RyaW5nfE9iamVjdH0gbWF0Y2hlciBBIFJlZ0V4cCBvciBzdHJpbmcgdGhhdCBtYXRjaGVzIHRoZSBzdWJmaWVsZCBuYW1lCiAqICAgICAgICAgIG9yIGFuIG9iamVjdCB3aXRoIGEgZnVuY3Rpb24gb2YgdGhlIG5vcm06IGZ1bmN0aW9uIG1hdGNoU3ViRmllbGQoIGZpZWxkLCBzdWJmaWVsZCApLgogKiAgICAgICAgVGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBib29sZWFuIHZhbHVlLgogKiBAcGFyYW0ge1N0cmluZ30gc2VwIEEgc2VwYXJhdG9yIHRvIGluc2VydCBiZXR3ZWVuIHRoZSB2YWx1ZXMsIGlmIG1vcmUgdGhhbiBvbmUgaXMgZm91bmQuCiAqCiAqIEByZXR1cm4ge1N0cmluZ30gVGhlIGZvdW5kIHZhbHVlcyBhcyBhIHN0cmluZy4gSWYgbm8gdmFsdWVzIGFyZSBmb3VuZCwgdGhlIGZ1bmN0aW9uIHdpbGwKICogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGUgZW1wdHkgc3RyaW5nLgogKgogKiBAZXhhbXBsZQogLy8gUmV0dXJucyBhbGwgdmFsdWVzIGZyb20gc3ViZmllbGQgImEiIHdpdGhvdXQgYW55IHNlcGFyYXRvci4KIGZ1bmN0aW9uIGdldFRpdGxlcyggZmllbGQgKSB7CglyZXR1cm4gZmllbGQuZ2V0VmFsdWUoICJhIiApOwp9CgogLy8gUmV0dXJucyBhbGwgdmFsdWVzIGZyb20gc3ViIGZpZWxkICJhIiB3aXRoIGEgY29tbWEgc2VwYXJhdG9yLgogZnVuY3Rpb24gZ2V0VGl0bGVzKCBmaWVsZCApIHsKCXJldHVybiBmaWVsZC5nZXRWYWx1ZSggImEiLCAiLCAiICk7Cn0KICoKICogQG1ldGhvZAogKiBAbmFtZSBGaWVsZC5nZXRWYWx1ZQogKiBAbmFtZSBGaWVsZCNnZXRWYWx1ZSAqLwpGaWVsZC5nZXRWYWx1ZSA9IG5ldyBTdHJpbmcoKTsKCi8qKiBJcyB0aGUgZmllbGQgYSBjb250cm9sIGZpZWxkIG9yIG5vdD8uCiAqCiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZmllbGQgaXMgYSBjb250cm9sIGZpZWxkLCBvdGhlcndpc2UgZmFsc2UuCiAqCgogKiBDYWxsIHRoaXMgZnVuY3Rpb24gdG8gZmlndXJlIG91dCBpZiBhIGZpZWxkIGlzIGEgY29udHJvbCBmaWVsZC4KICoKICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgZmllbGQgaXMgYSBjb250cm9sIGZpZWxkLCBmYWxzZSBvdGhlcndpc2UuCiAqIEBtZXRob2QKICogQG5hbWUgRmllbGQuaXNDb250cm9sRmllbGQKICogQG5hbWUgRmllbGQjaXNDb250cm9sRmllbGQgKi8KRmllbGQuaXNDb250cm9sRmllbGQgPSBuZXcgU3RyaW5nKCk7CgovKiogQ2hlY2tzIGlmIGEgbWF0Y2hlciBvbmx5IG1hdGNoZXMgb25lIHN1YmZpZWxkLgogKgogKiBAcGFyYW0ge1JlZ0V4cHxPYmplY3R9IG1hdGNoZXIgQSBSZWdFeHAgdGhhdCBtYXRjaGVzIHRoZSBzdWJmaWVsZCBuYW1lCiAqICAgICAgICAgIG9yIGFuIG9iamVjdCB3aXRoIGEgZnVuY3Rpb24gb2YgdGhlIG5vcm06IGZ1bmN0aW9uIG1hdGNoU3ViRmllbGQoIGZpZWxkLCBzdWJmaWVsZCApLgogKiAgICAgICAgVGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBib29sZWFuIHZhbHVlLgogKgogKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIG9ubHkgb25lIHN1YmZpZWxkIG1hdGNoZXMgbWF0Y2hlciwgRmFsc2Ugb3RoZXJ3aXNlLgogKiBAbWV0aG9kCiAqIEBuYW1lIEZpZWxkLmlzVW5pcXVlCiAqIEBuYW1lIEZpZWxkI2lzVW5pcXVlICovCkZpZWxkLmlzVW5pcXVlID0gbmV3IFN0cmluZygpOwoKLyoqIENoZWNrcyBpZiB0aGUgdmFsdWUgb2Ygb25lIG9yIG1vcmUgc3ViZmllbGRzIG1hdGNoZXMgYSBnaXZlbiB2YWx1ZS4KICoKICogQHBhcmFtIHtSZWdFeHB8U3RyaW5nfE9iamVjdH0gbWF0Y2hlciBBbiBSZWdFeHAgdGhhdCBtYXRjaGVzIHRoZSBzdWIgZmllbGQgbmFtZSBvciBhIHN0cmluZyB0aGF0IG1hdGNoZXMgdGhlIHN1YiBmaWVsZCBuYW1lCiAqICAgICAgICAgIG9yIGFuIG9iamVjdCB3aXRoIGEgZnVuY3Rpb24gb2YgdGhlIG5vcm06IGZ1bmN0aW9uIG1hdGNoU3ViRmllbGQoIGZpZWxkLCBzdWJmaWVsZCApLgogKiAgICAgICAgVGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBib29sZWFuIHZhbHVlLgogKiBAcGFyYW0ge1JlZ0V4cH0gdmFsdWVSZWdFeHAgVGhlIHBhdHRlcm4gdGhhdCB0aGUgdmFsdWUgb2YgdGhlIHN1YmZpZWxkcyBzaG91bGQgbWF0Y2guCiAqCiAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIHZhbHVlIGlzIG1hdGNoZWQsIEZhbHNlIG90aGVyd2lzZS4KICogQG1ldGhvZAogKiBAbmFtZSBGaWVsZC5tYXRjaFZhbHVlCiAqIEBuYW1lIEZpZWxkI21hdGNoVmFsdWUgKi8KRmllbGQubWF0Y2hWYWx1ZSA9IG5ldyBTdHJpbmcoKTsKCi8qKiBSZW1vdmUgYSBzdWJmaWVsZCBmcm9tIGEgZmllbGQuCiAqCiAqIFRoZSBtZXRob2QgZXhpc3RzIGluIHRocmVlIHZlcnNpb25zLCBkZXBlbmRpbmcgb24gdGhlIG51bWJlciBhbmQgdHlwZSBvZiBhcmd1bWVudHMgZ2l2ZW4uCiAqCiAqIElmIGdpdmVuIGEgbnVtZXJpY2FsIGluZGV4LCBpdCByZW1vdmVzIHRoZSBzdWJmaWVsZCBhdCB0aGF0IHBvc2l0aW9uCiAqIGluIHRoZSBmaWVsZHMgaW50ZXJuYWwgcmVwcmVzZW50YXRpb24gb2Ygc3ViZmllbGRzLgogKgogKiBJZiBnaXZlbiBhIG5hbWUsIGl0IHJlbW92ZXMgdGhlIGZpcnN0IHN1YmZpZWxkIGZvdW5kLCB0aGF0IG1hdGNoZXMgdGhlCiAqIGdpdmVuIG5hbWUuCiAqCiAqIElmIGdpdmVuIGEgbmFtZSBhbmQgYW4gaW5kZXggbiwgaXQgcmVtb3ZlcyB0aGUgbid0aCBzdWJmaWVsZCB3aXRoCiAqIHRoZSBnaXZlbiBuYW1lLgogKgogKiBJZiBubyBzdWJmaWVsZCBtYXRjaGVzIHRoZSBwYXJhbWV0ZXJzLCBub3RoaW5nIGhhcHBlbnMuCiAqCiAqICoqTm90ZToqKiBGb3IgdGhlIEMrKyBpbXBsZW1lbnRhdGlvbjogQW55IHJlZmVyZW5jZSB0byBleGlzdGluZwogKiBzdWJmaWVsZHMgb24gdGhpcyByZWNvcmQgbWF5IGJlIGludmFsaWRhdGVkIGJ5IHJlbW92aW5nIGEgc3ViZmllbGQuIFRoaXMKICogaGFzIGEgbnVtYmVyIG9mIHBvdGVudGlhbCBiYWQgY29uc2VxdWVuY2VzLCBtb3N0IG9mIHdoaWNoIGxlYWRzIHRvCiAqIGNyYXNoZXMgb3IgdW5wcmVkaWN0YWJsZSBiZWhhdmlvdXIuIEl0IGlzIGVhc3kgdG8gZmFsbCBpbnRvIHRoZQogKiB0cmFwIG9mIGUuZy4gaXRlcmF0aW5nIGFsbCBzdWJmaWVsZHMgaW4gYSBmaWVsZCwgYW5kIHJlbW92ZSBzb21lIG9mCiAqIHRoZW0uIFRoaXMgaXMgYWxtb3N0IGNlcnRhaW4gdG8gbWFrZSB5b3VyIGFwcGxpY2F0aW9uCiAqIGNyYXNoLiBJbnN0ZWFkLCBjb2xsZWN0IHRoZSBuYW1lcyBvciBpbmRleGVzIG9mIHRoZSBzdWJmaWVsZHMgeW91IHdpc2gKICogdG8gcmVtb3ZlLCB0aGVuIHJlbW92ZSB0aGVtIGFmdGVyIHlvdXIgbWFpbiBpdGVyYXRpb24uCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBzdWJmaWVsZE5hbWUgTmFtZSBvZiBhIHN1YmZpZWxkIHRvIHJlbW92ZQogKiBAcGFyYW0ge251bWJlcn0gW3N1YmZpZWxkTmFtZUluZGV4XSBJbmRleCBvZiBuYW1lZCBzdWJmaWVsZCB0byByZW1vdmUsIHplcm8tYmFzZWQuCiAqIEBleGFtcGxlCiAvLyBSZW1vdmUgdGhlIGZpcnN0IGEgc3ViZmllbGQKIGFGaWVsZC5yZW1vdmUoICJhIiApOwogLy8gUmVtb3ZlIHRoZSBzZWNvbmQgYSBzdWJmaWVsZAogYUZpZWxkLnJlbW92ZSggImEiLCAxICk7CiAqIEBtZXRob2QKICogQG5hbWUgRmllbGQucmVtb3ZlCiAqIEBuYW1lIEZpZWxkI3JlbW92ZSAqLwpGaWVsZC5yZW1vdmUgPSBuZXcgU3RyaW5nKCk7CgovKiogUmVtb3ZlcyBhbGwgc3ViZmllbGRzIHRoYXQgbWF0Y2hlcyBhIG1hdGNoZXIuCiAqCiAqIEBwYXJhbSB7UmVnRXhwfE9iamVjdH0gbWF0Y2hlciBBIFJlZ0V4cCB0aGF0IG1hdGNoZXMgdGhlIHN1YmZpZWxkIG5hbWUKICogICAgICAgICAgb3IgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbiBvZiB0aGUgbm9ybTogZnVuY3Rpb24gbWF0Y2hTdWJGaWVsZCggZmllbGQsIHN1YmZpZWxkICkuCiAqICAgICAgICBUaGUgZnVuY3Rpb24gc2hvdWxkIHJldHVybiBhIGJvb2xlYW4gdmFsdWUuCiAqCiAqIEByZXR1cm4gTm90aGluZy4KICoKICogQG1ldGhvZAogKiBAbmFtZSBGaWVsZC5yZW1vdmVXaXRoTWF0Y2hlcgogKiBAbmFtZSBGaWVsZCNyZW1vdmVXaXRoTWF0Y2hlciAqLwpGaWVsZC5yZW1vdmVXaXRoTWF0Y2hlciA9IG5ldyBTdHJpbmcoKTsKCi8qKiBSZXR1cm5zIHRoZSBudW1iZXIgb2Ygc3ViZmllbGRzIGluIHRoaXMgZmllbGQuCiAqCiAqIFRoaXMgZnVuY3Rpb24gaXMgYSBzaG9ydGN1dCBmb3IgRmllbGQuY291bnQoKS4KICoKICogQHJldHVybiB7bnVtYmVyfSBUaGUgbnVtYmVyIG9mIHN1YmZpZWxkcyBpbiB0aGlzIGZpZWxkLiBHcmVhdGVyIG9yIGVxdWFsIHRvIDAuCiAqCiAqIEBtZXRob2QKICogQG5hbWUgRmllbGQuc2l6ZQogKiBAbmFtZSBGaWVsZCNzaXplICovCkZpZWxkLnNpemUgPSBuZXcgU3RyaW5nKCk7CgovKiogR2V0IGEgcmVmZXJlbmNlIHRvIGEgc3ViZmllbGQgaW4gdGhlIGZpZWxkLgogKgogKiBHaXZlbiB0aGUgaW5kZXggb2YgYSBzdWJmaWVsZCwgb3IgYSBzdWJmaWVsZE5hbWUsIG9yIGEgc3ViZmllbGROYW1lIGFuZCBhbgogKiBpbmRleCwgcmV0dXJuIGEgcmVmZXJlbmNlIHRvIGEgc3ViZmllbGQuCiAqCiAqIFRoaXMgaXMgdGhlIHByaW1hcnkgbWV0aG9kIHRvIGdldCBhY2Nlc3MgdG8gdGhlIHN1YmZpZWxkcyBvZiBhCiAqIGZpZWxkLiBUaGUgbWV0aG9kIGV4aXN0cyBpbiB0aHJlZSB2ZXJzaW9ucywgZGVwZW5kaW5nIG9uIHRoZQogKiBudW1iZXIgYW5kIHR5cGUgb2YgYXJndW1lbnRzIGdpdmVuLgogKgogKiBJZiBnaXZlbiBhIG51bWVyaWNhbCBpbmRleCBvbmx5LCBpdCByZXR1cm5zIHRoZSBzdWJmaWVsZCBhdCB0aGF0IHBvc2l0aW9uCiAqIGluIHRoZSBmaWVsZCdzIGludGVybmFsIHJlcHJlc2VudGF0aW9uIG9mIHN1YmZpZWxkcy4gVGhpcyBpcyBwcm9iYWJseQogKiBvbmx5IHVzZWZ1bCBpbiBjb25qdW5jdGlvbiB3aXRoIGUuZy4gbG9vcGluZyB0aHJvdWdoIGFsbCBzdWJmaWVsZHMgaW4KICogdGhlIGZpZWxkLgogKgogKiBJZiBnaXZlbiBhIG5hbWUsIGl0IHJldHVybnMgdGhlIGZpcnN0IHN1YmZpZWxkIGZvdW5kLCB0aGF0IG1hdGNoZXMgdGhlCiAqIGdpdmVuIG5hbWUuCiAqCiAqIElmIGdpdmVuIGEgbmFtZSBhbmQgYW4gaW5kZXggbiwgaXQgcmV0dXJucyB0aGUgbid0aCBzdWJmaWVsZCB3aXRoCiAqIHRoZSBnaXZlbiBuYW1lLgogKgogKiBOb3RlLCB0aGF0IGlmIHRoZSBzdWJmaWVsZCBpcyBub3QgZm91bmQsIGFuIGVtcHR5IHN1YmZpZWxkIGlzCiAqIHJldHVybmVkLiBUaGlzIHN1YmZpZWxkIGlzIG5vdCBwYXJ0IG9mIHRoZSByZWNvcmQuCiAqCiAqIEBwYXJhbSB7TnVtYmVyfFN0cmluZ30gc3ViZmllbGRJbmRleE9yU3ViZmllbGROYW1lIEluZGV4IG9mIHN1YmZpZWxkIHRvIGZpbmQsIHplcm8tYmFzZWQsIG9yIG5hbWUgb2YgYSBzdWJmaWVsZCB0byBmaW5kLgogKiBAcGFyYW0ge051bWJlcn0gW3N1YmZpZWxkTmFtZUluZGV4XSBJbmRleCBvZiBuYW1lZCBzdWJmaWVsZCB0byBmaW5kLCB6ZXJvLWJhc2VkLiAqT25seSBhbGxvd2VkIGlmIGZpcnN0IGFyZ3VtZW50IGlzIGEgc3ViZmllbGROYW1lLioKICogQHJldHVybiB7U3ViZmllbGR9IEEgcmVmZXJlbmNlIHRvIGEgc3ViZmllbGQsIG9yIGFuIGVtcHR5IHN1YmZpZWxkLCBpZiBub3QgZm91bmQuCiAqIEBleGFtcGxlCiAvL2V4YW1wbGUgcmVjb3JkIGFuZCBmaWVsZAogdmFyIGV4YW1wbGVSZWNvcmQgPSBuZXcgUmVjb3JkOwogdmFyIGV4YW1wbGVGaWVsZCA9IG5ldyBGaWVsZCAoICIyNjAiLCAiMDAiICk7CiBleGFtcGxlRmllbGQuYXBwZW5kICggImEiLCAiS2Fzc2VsIiApOwogZXhhbXBsZUZpZWxkLmFwcGVuZCAoICJiIiwgIkJhcmVucmVpdGVyIiApOwogZXhhbXBsZUZpZWxkLmFwcGVuZCAoICJhIiwgIlN0dXR0Z2FydCIgKTsKIGV4YW1wbGVGaWVsZC5hcHBlbmQgKCAiYiIsICJNZXR6bGVyIiApOwogZXhhbXBsZUZpZWxkLmFwcGVuZCAoICJjIiwgIjE5OTQtIiApOwogZXhhbXBsZVJlY29yZC5hcHBlbmQgKCBleGFtcGxlRmllbGQgKTsKCiAvLyBHZXQgdGhlIHRoaXJkIHN1YmZpZWxkIGluIHRoZSBleGFtcGxlIGZpZWxkCiB2YXIgczEgPSBleGFtcGxlRmllbGQuc3ViZmllbGQoIDIgKTsgLy88LS0gdGhpcyByZWZlcnMgdG8gc3ViZmllbGQgImEiIHdpdGggdGhlIHZhbHVlICJTdHV0dGdhcnQiCgogLy8gQmUgYXdhcmUgaWYgeW91IHVzZSBvbmx5IHRoZSBuYW1lIG9mIHRoZSBzdWJmaWVsZCBhbmQgdGhlcmUgaXMgbW9yZSB0aGFuIG9uZSBvZiB0aGF0IHN1YmZpZWxkCiAvLyB5b3Ugd2lsbCBnZXQgYSByZWZlcmVuY2UgdG8gdGhlIGZpcnN0IHN1YmZpZWxkCiB2YXIgczIgPSBleGFtcGxlRmllbGQuc3ViZmllbGQoICJhIiApOyAvLzwtLSB0aGlzIHJlZmVycyB0byBzdWJmaWVsZCAiYSIgd2l0aCB0aGUgdmFsdWUgIkthc3NlbCIKCiAvLyBHZXQgdGhlIHNlY29uZCAiYiIgc3ViZmllbGQKIHZhciBzMyA9IGV4YW1wbGVGaWVsZC5zdWJmaWVsZCggImIiLCAxICk7ICAvLzwtLSB0aGlzIHJlZmVycyB0byBzdWJmaWVsZCAiYiIgd2l0aCB0aGUgdmFsdWUgIk1ldHpsZXIiCgogLy8gQmUgYXdhcmUgaWYgeW91IHJlZmVyIHRvIGEgc3ViZmllbGQgd2l0aCBuYW1lIGFuZCBpbmRleCB0aGF0IGlzIG5vdCB0aGVyZSB5b3UgZ2V0IGFuIGVtcHR5IHN1YmZpZWxkCiB2YXIgczQgPSBleGFtcGxlRmllbGQuc3ViZmllbGQoICJiIiwgMiApOyAvLyA8LS0gdGhpcyByZWZlcnMgdG8gYW4gZW1wdHkgc3ViZmllbGQsIGJlY2F1c2UgdGhlcmUgYXJlIG9ubHkgdHdvIHN1YmZpZWxkICJiIiBpbiB0aGlzIGZpZWxkCgogLy8gQ29tYmluaW5nIG1ldGhvZCBmaWVsZCBmcm9tIFJlY29yZCBhbmQgbWV0aG9kIHN1YmZpZWxkIGZyb20gRmllbGQKIHZhciBzNSA9IGV4YW1wbGVSZWNvcmQuZmllbGQoICIyNjAiICkuc3ViZmllbGQoICJjIiApOyAvLyA8LS0gdGhpcyByZWZlcnMgdG8gdGhlIGZpcnN0IHN1YmZpZWxkICJjIiBpbiB0aGUgZmlyc3QgZmllbGQgIjI2MCIgaW4gdGhlIGV4YW1wbGUgcmVjb3JkCgogKiBAbWV0aG9kCiAqIEBuYW1lIEZpZWxkLnN1YmZpZWxkCiAqIEBuYW1lIEZpZWxkI3N1YmZpZWxkICovCkZpZWxkLnN1YmZpZWxkID0gbmV3IFN0cmluZygpOwoKLyoqIEdldCBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgRmllbGQuCiAqCiAqIFRoaXMgbWV0aG9kIHJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGZpZWxkLCBpbiBhCiAqIGZvcm1hdCB2ZXJ5IGNsb3NlIHRvIGEgc3RhbmRhcmQgTWFyYyBsaW5lIGZvcm1hdC4KICoKICogSWYgdGhlIGZpZWxkIGlzIGEgY29udHJvbCBmaWVsZCwgaXQgd2lsbCByZXR1cm4gYSBzdHJpbmcKICogY29uc3RydWN0ZWQgZnJvbSBpdHMgbmFtZSBhbmQgaXRzIHZhbHVlLiBJZiB0aGUgZmllbGQgaXMgYSBub3JtYWwKICogZmllbGQsIGl0IHdpbGwgYnVpbGQgYSBzdHJpbmcgZnJvbSBpdHMgbmFtZSwgdGhlIGluZGljYXRvciwgYW5kIHRoZQogKiBjb21iaW5lZCByZXN1bHRzIGZyb20gY2FsbGluZyB0b1N0cmluZyBvbiBhbGwgaXRzIHN1YmZpZWxkcy4KICoKICogTm90ZSB0aGF0IHRoZSBjaGFyYWN0ZXJzICJAIiBhbmQgIlwqIiBhcmUgY29udmVydGVkIHRvICJAQCIgYW5kCiAqICJAXCoiIHJlc3BlY3RpdmVseSwgaW4gdGhlIHJlc3VsdCBmcm9tIHRvU3RyaW5nLgogKgogKiBAcmV0dXJuIHtzdHJpbmd9IEEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBmaWVsZC4KICogQG1ldGhvZAogKiBAbmFtZSBGaWVsZC50b1N0cmluZwogKiBAbmFtZSBGaWVsZCN0b1N0cmluZyAqLwpGaWVsZC50b1N0cmluZyA9IG5ldyBTdHJpbmcoKTsKCgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vIFNVQkZJRUxECi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLyoqIEEgc3ViZmllbGQgaW4gYSBNYXJjIHJlY29yZC4KICoKICogVGhlIFN1YmZpZWxkIGNsYXNzIGlzIGFuIGFic3RyYWN0aW9uIGZvciBhIFN1YmZpZWxkIGluIGEgTWFyYwogKiByZWNvcmQuIEl0IGNvbnRhaW5zIGEgbmFtZSwgdmFsdWUgYW5kIGEgdG9TdHJpbmcgbWV0aG9kLCBhbmQgYXMKICogc3VjaCBpcyBhIHByZXR0eSBzaW1wbGUgYWJzdHJhY3Rpb24uCiAqCiAqIFlvdSBjYW4gY29uc3RydWN0IGEgc3ViZmllbGQgaW5zdGFuY2Ugb25seSBieSBnaXZpbmcgaXQgYSBuYW1lIGFuZAogKiBhIHZhbHVlIGFzIHBhcmFtZXRlcnMgdG8gdGhlIGNvbnN0cnVjdG9yLgogKgogKiBAZXhhbXBsZQogLy8gQ29uc3RydWN0IGEgc3ViZmllbGQKIHZhciBzdWJmaWVsZCA9IG5ldyBTdWJmaWVsZCggImEiLCAiSSBhbSBhIHN1YmZpZWxkIiApOwogKiBAcGFyYW0ge1N0cmluZ30gc3ViZmllbGROYW1lXSBOYW1lIG9mIHRoZSBuZXcgc3ViZmllbGQuCiAqIEBwYXJhbSB7U3RyaW5nfSBzdWJmaWVsZFZhbHVlIFZhbHVlIG9mIHRoZSBuZXcgc3ViZmllbGQKICogQGNvbnN0cnVjdG9yCiAqIEBzZWUgTWFyY0NsYXNzZXMKICogQHNlZSBSZWNvcmQKICogQHNlZSBGaWVsZAogKiBAbmFtZSBTdWJmaWVsZCAqLwovLyBEbyBub3QgcmVtb3ZlIHRoaXMgY29tbWVudAoKLy8gUFJPUEVSVElFUwoKLyoqIFRoZSBuYW1lIG9mIHRoZSBzdWJmaWVsZC4KICoKICogVGhpcyBwcm9wZXJ0eSBob2xkcyB0aGUgbmFtZSBvZiB0aGUgc3ViZmllbGQuCiAqCiAqIEB0eXBlIHtzdHJpbmd9CiAqIEBuYW1lIFN1YmZpZWxkLm5hbWUKICogQG5hbWUgU3ViZmllbGQjbmFtZSAqLwpTdWJmaWVsZC5uYW1lID0gbmV3IFN0cmluZygpOwoKLyoqIFRoZSB2YWx1ZSBvZiB0aGUgc3ViZmllbGQuCiAqCiAqIFRoaXMgcHJvcGVydHkgaG9sZHMgdGhlIHZhbHVlIG9mIHRoZSBzdWJmaWVsZC4KICoKICogQHR5cGUge1N0cmluZ30KICogQG5hbWUgU3ViZmllbGQudmFsdWUKICogQG5hbWUgU3ViZmllbGQjdmFsdWUgKi8KU3ViZmllbGQudmFsdWUgPSBuZXcgU3RyaW5nKCk7CgovLyBNRVRIT0RTCgovKiogR2V0IGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBzdWJmaWVsZC4KICoKICogVGhpcyBtZXRob2QgcmV0dXJucyBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3ViZmllbGQsIGluIGEKICogZm9ybWF0IHZlcnkgY2xvc2UgdG8gYSBzdGFuZGFyZCBNYXJjIGxpbmUgZm9ybWF0LiBUaGlzIG1lYW5zLCB0aGF0CiAqIHRoZSBjaGFyYWN0ZXJzICJAIiBhbmQgIlwqIiBhcmUgY29udmVydGVkIHRvICJAQCIgYW5kICJAXCoiIHJlc3BlY3RpdmVseS4KICoKICogQHJldHVybiB7U3RyaW5nfSBBIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3ViZmllbGQuCiAqIEBtZXRob2QKICogQG5hbWUgU3ViZmllbGQudG9TdHJpbmcKICogQG5hbWUgU3ViZmllbGQjdG9TdHJpbmcgKi8KU3ViZmllbGQudG9TdHJpbmcgPSBuZXcgU3RyaW5nKCk7CgovKioKICogUmV0dXJucyBhIGNsb25lIChjb3B5KSBvZiB0aGlzIFN1YmZpZWxkCiAqCiAqIEByZXR1cm4ge1N1YmZpZWxkfSBUaGUgbmV3IFN1YmZpZWxkIHRoYXQgaXMgYW4gZW50aXJlIGNsb25lIG9mIHRoaXMgc3ViZmllbGQuCiAqCiAqIEBtZXRob2QKICogQG5hbWUgU3ViZmllbGQuY2xvbmUKICogQG5hbWUgU3ViZmllbGQjY2xvbmUgKi8KU3ViZmllbGQuY2xvbmUgPSBuZXcgU3RyaW5nKCk7Cg==", "moduleName": "MarcClasses"}, {"javascript": "LyoqIEBmaWxlIFN5c3RlbSBtb2R1bGUuIFByb3ZpZGVzIFN5c3RlbSBjbGFzcywgdGhhdCBjYW4gYmUgcG9wdWxhdGVkIGJ5IG90aGVyIG1vZHVsZXMuICovCkVYUE9SVEVEX1NZTUJPTFMgPSBbICdTeXN0ZW0nIF07CgovKioKICogUHJvdmlkZXMgYSBuYW1lc3BhY2UgdG8gYWRkIGxvd2xldmVsL3N5c3RlbSBsaWtlIGZ1bmN0aW9uYWxpdHkgdG8uCiAqIAogKiBNZXRob2RzIGFuZCBtb2R1bGVzIHJlbGF0ZWQgdG8gbG93LWxldmVsIHN0dWZmIGlzIGFkZGVkIGludG8gdGhpcwogKiBuYW1lc3BhY2UuIAogKgogKiBUbyBhY3R1YWxseSB1c2UgbW9zdCBvZiB0aGUgZnVuY3Rpb25zIGluIHRoaXMgbmFtZXNwYWNlLCB5b3UgbmVlZAogKiB0byBsb2FkIGFkZGl0aW9uYWwgbW9kdWxlcy4gRS5nLiB0byBiZSBhYmxlIHRvIHVzZSB0aGUgCiAqIHtAbGluayBTeXN0ZW0ucmVhZEZpbGV9IGZ1bmN0aW9uLCB5b3UgbXVzdCB1c2UgdGhlIG1vZHVsZSBgUmVhZEZpbGVgLiB0bwogKiB1c2UgdGhlIHtAbGluayBTeXN0ZW0ucHJpbnR9IGZ1bmN0aW9uIHlvdSBtdXN0IHVzZSB0aGUgbW9kdWxlCiAqIGBQcmludGAuIEZvciBhbGwgZnVuY3Rpb25zLCBpdCBpcyBpbmRpY2F0ZWQgd2hpY2ggbW9kdWxlIHRoZXkgYXJlCiAqIHBhcnQgb2YsIHRoYXQgaXMsIHdoaWNoIG1vZHVsZSB5b3Ugc2hvdWxkIHVzZSB0byBnZXQgYWNjZXNzIHRvIHRoZQogKiBmdW5jdGlvbi4KICogCiAqIEBuYW1lc3BhY2UgCiAqIEBuYW1lIFN5c3RlbSAqLwp2YXIgU3lzdGVtID0gZnVuY3Rpb24oICkgewogICAgdmFyIHRoYXQgPSB7fTsKCiAgICAvKioKICAgICAqIEFycmF5IGNvbnRhaW5pbmcgYXJndW1lbnRzIHBhc3NlZCB0byB0aGUgc3lzdGVtLCBpZiBpbnZva2VkIGludGVyYWN0aXZlbHkuCiAgICAgKiAKICAgICAqIENvbnRhaW5zIGFueSBhcmd1bWVudHMgcGFzc2VkIHRvIHRoZSBzeXN0ZW0sIGlmIHVzZWQgaW50ZXJhY3RpdmVseS4gSXMKICAgICAqIGFuIGVtcHR5IGFycmF5IGlmIG5vdC4gCiAgICAgKgogICAgICogQGV4YW1wbGUKLy8gR2V0IHRoZSBmaXJzdCBhcmd1bWVudCB0byBhIHNjcmlwdCB3aGVuIGNhbGxlZCBpbiBhIHNoZWxsCnVzZSggIlN5c3RlbSIgKTsKaWYgKCBTeXN0ZW0uYXJndW1lbnRzLmxlbmd0aCA+IDAgKSB7CiAgdmFyIGZpcnN0QXJnID0gU3lzdGVtLmFyZ3VtZW50c1swXTsKfQogICAgICoKICAgICAqIEBuYW1lIFN5c3RlbS5hcmd1bWVudHMKICAgICAqIEB0eXBlIHtTdHJpbmdbXX0KICAgICAqIEBwcm9wZXJ0eSAqLwogICAgdGhhdC5hcmd1bWVudHMgPSBbIF07CgogICAgLyoqIAogICAgICogU3RyaW5nIGNvbnRhaW5pbmcgdGhlIG5hbWUgb2YgdGhlIGNhbGxlZCBzY3JpcHQsIGlmIGludm9rZWQgaW50ZXJhY3RpdmVseS4KICAgICAqIAogICAgICogQGV4YW1wbGUKLy8gUHJpbnQgdGhlIG5hbWUgb2YgdGhlIGNhbGxpbmcgc2NyaXB0CnVzZSggIlN5c3RlbSIgKTsKdXNlKCAiUHJpbnQiICk7CnByaW50KCBTeXN0ZW0uc2NyaXB0bmFtZSArICJcbiIgKTsKICAgICAqIAogICAgICogQG5hbWUgU3lzdGVtLnNjcmlwdG5hbWUKICAgICAqIEB0eXBlIHtTdHJpbmd9CiAgICAgKiBAcHJvcGVydHkgKi8KICAgIHRoYXQuc2NyaXB0bmFtZSA9ICIiOwoKICAgIC8qKiBQcm9wZXJ0eSB0byBkZWZpbmUgdGhlIFJoaW5vIHBsYXRmb3JtLgogICAgICogQG5hbWUgU3lzdGVtLnBsYXRmb3JtX3JoaW5vCiAgICAgKiBAdHlwZSB7U3RyaW5nfQogICAgICogQHByb3BlcnR5ICovCiAgICB0aGF0LnBsYXRmb3JtX3JoaW5vID0gIlJoaW5vIjsKCiAgICAvKiogUHJvcGVydHkgdG8gZGVmaW5lIHRoZSBTcGlkZXJNb25rZXkgcGxhdGZvcm0uCiAgICAgKiBAbmFtZSBTeXN0ZW0ucGxhdGZvcm1fc3BpZGVybW9ua2V5CiAgICAgKiBAdHlwZSB7U3RyaW5nfQogICAgICogQHByb3BlcnR5ICovCiAgICB0aGF0LnBsYXRmb3JtX3NwaWRlcm1vbmtleSA9ICJTcGlkZXJNb25rZXkiOwoKICAgIC8qKgogICAgICogR2V0IHRoZSBuYW1lIG9mIHRoZSBwbGF0Zm9ybSB3ZSBhcmUgY3VycmVudGx5IHJ1bm5pbmcgdW5kZXIuCiAgICAgKgogICAgICogVGhpcyByZXR1cm5zIHRoZSBuYW1lIG9mIG91ciBwbGF0Zm9ybSwgb25lIG9mICJSaGlubyIgb3IgIlNwaWRlck1vbmtleSIuCiAgICAgKiBUaGlzIG1ldGhvZCBpcyBtZWFudCBmb3IgdGhlIHZlcnkgcmFyZSBzaXR1YXRpb25zIHdoZXJlIHdlIGhhdmUgdG8gZG8KICAgICAqIHNvbWV0aGluZyBzbGlnaHRseSBkaWZmZXJlbnQgZGVwZW5kaW5nIG9uIHBsYXRmb3JtLCBpbiBvcmRlciB0byAKICAgICAqIHdvcmsgYXJvdW5kIGRpZmZlcmVuY2VzLgogICAgICoKICAgICAqIFVzZSB0aGUgcHJvcGVydGllcyBwbGF0Zm9ybV9yaGlubyBhbmQgcGxhdGZvcm1fc3BpZGVybW9ua2V5IHRvCiAgICAgKiBjaGVjayBhZ2FpbnN0IHRoaXMgcHJvcGVydHkuCiAgICAgKgogICAgICogKipOb3RlOioqIE1vcmUgcGxhdGZvcm1zIG1heSBiZSBhZGRlZCBpbiB0aGUgZnV0dXJlLiBBbHdheXMKICAgICAqIGNoZWNrIGV4cGxpY2l0bHkgZm9yIGEgc3BlY2lmaWMgcGxhdGZvcm0uCgogICAgICogKipOb3RlOioqIE9OTFkgVVNFIFRISVMgTUVUSE9EIEFTIEEgTEFTVCBSRVNPUlQuIFRoZSBwbGF0Zm9ybXMgYmVoYXZlIGFsbW9zdCAKICAgICAqIGV4YWN0bHkgdGhlIHNhbWUsIGFuZCB0aGUgY29kZSBzaG91bGQgbm90IGJlIHNwcmlua2xlZCB3aXRoICJpZiBwbGF0Zm9ybSB0aGVuIi4KICAgICAqIEl0IGlzIHN1c3BlY3RlZCB0aGlzIGlzIG9ubHkgbmVlZGVkIGZvciBFNFggY29kZSB0aGF0IGlzIGJyb2tlbiBhbnl3YXkuCiAgICAgKiBJZiB5b3UgdXNlIHRoaXMgZnVuY3Rpb24sIGF0IGxlYXN0IHdyYXAgaXQgaW4gYSBsaWJyYXJ5L21vZHVsZSBzdWNoIHRoYXQKICAgICAqIHlvdSBjYW4gY2hhbmdlIHRoZSBpbXBsZW1lbnRhdGlvbiBsYXRlciwgd2l0aG91dCBicmVha2luZyB0aGUgaW50ZXJmYWNlLgogICAgICogIAogICAgICogQG5hbWUgU3lzdGVtLnBsYXRmb3JtCiAgICAgKiBAdHlwZSB7U3RyaW5nfQogICAgICogQHByb3BlcnR5ICovCiAgICB0aGF0LnBsYXRmb3JtICA9IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICggKCB0eXBlb2YgUGFja2FnZXMgPT09ICJvYmplY3QiICkgJiYgKCB0eXBlb2YgUGFja2FnZXMuamF2YSA9PT0gIm9iamVjdCIgKSApIHsKICAgICAgICAgICAgcmV0dXJuICJSaGlubyI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuICJTcGlkZXJNb25rZXkiOwogICAgICAgIH0KICAgIH0oKTsgLy8gTm90ZSwgbm90IGEgZnVuY3Rpb24sIGEgdmFsdWUuCgoKICAgIHJldHVybiB0aGF0Owp9KCApOwo=", "moduleName": "System"}, {"javascript": "Ly8gUHVyZSBKYXZhU2NyaXB0IGltcGxlbWVudGF0aW9uIG9mIFJlY29yZCwgRmllbGQgYW5kIFN1YmZpZWxkIGNsYXNzZXMuCi8vIFBsYWNlZCBpbiBqYXZhY29yZSBmb3Igbm93LCB0byBhdm9pZCBjbGFzaGVzIHdpdGggdGhlIEMrKyBpbXBsZW1lbnRhdGlvbi4KCi8vIE5vdGUsIHRoZSBkb2N1bWVudGF0aW9uIG9mIHRoZXNlIGNsYXNzZXMgaXMgdGhlIE1hcmNDbGFzc2VzLnVzZS5qcwovLyBtb2R1bGUsIHN1Y2ggdGhhdCBpdCBjYW4gYmUgc2hhcmVkIGJldHdlZW4gdGhlIEphdmEgYW5kIEMrKwovLyBpbXBsZW1lbnRhdGlvbnMuCgp1c2UoIkxvZyIpOwoKRVhQT1JURURfU1lNQk9MUyA9IFsgIlJlY29yZCIsICJGaWVsZCIsICJTdWJmaWVsZCIgXTsKCi8vIFRoZSBwYXR0ZXJuIHVzZWQgdG8gY3JlYXRlIFJlY29yZCwgRmllbGQgYW5kIFN1YmZpZWxkIG9iamVjdHMgaW4KLy8gdGhpcyBtb2R1bGUgZGlmZmVycyBmcm9tIG1vc3Qgb3RoZXIgbW9kdWxlcyBpbiBEQkMsIGJlY2F1c2UgaXQgaXMgYQovLyB0cnVlIGNvbnN0cnVjdG9yIHRoYXQgd2Ugd2lzaCBmb3IsIHdoaWNoIGNhbiBiZSBjYWxsZWQgbXVsdGlwbGUKLy8gdGltZXMuCgp2YXIgU3ViZmllbGQgPSAoZnVuY3Rpb24gKCkgewogICAgdmFyIFN0YW5kYXJkQ2hhcnNldHMgPSBQYWNrYWdlcy5qYXZhLm5pby5jaGFyc2V0LlN0YW5kYXJkQ2hhcnNldHM7CiAgICB2YXIgU3RyaW5nID0gUGFja2FnZXMuamF2YS5sYW5nLlN0cmluZzsKICAgIHZhciBEYW5NYXJjMkNoYXJzZXQgPSBQYWNrYWdlcy5kay5kYmMubWFyYy5EYW5NYXJjMkNoYXJzZXQ7CiAgICB2YXIgZGFuTWFyYzJDaGFyc2V0ID0gbmV3IERhbk1hcmMyQ2hhcnNldCgpOwogICAgdmFyIHRvRG0yID0gZnVuY3Rpb24gKHMpIHsKICAgICAgICByZXR1cm4gIiIgKyBuZXcgU3RyaW5nKG5ldyBTdHJpbmcocykuZ2V0Qnl0ZXMoZGFuTWFyYzJDaGFyc2V0KSwgU3RhbmRhcmRDaGFyc2V0cy5JU09fODg1OV8xKTsKICAgIH07CgogICAgcmV0dXJuIGZ1bmN0aW9uIChuYW1lYXJnLCB2YWx1ZWFyZykgewogICAgICAgIC8vIGNoZWNraW5nIHRoYXQgd2UgYXJlIGNhbGxlZCB3aXRoIGV4YWN0bHkgdHdvIGFyZ3VtZW50cywgaWYgbm90IHRocm93IGV4Y2VwdGlvbgogICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoICE9IDIpIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoInN1YmZpZWxkIG11c3QgYmUgaW5pdGlhbGl6ZWQgd2l0aCBleGFjdGx5IDIgYXJndW1lbnRzIik7CiAgICAgICAgICAgIC8qIENvbW1lbnRlZCBvdXQsIHBlbmRpbmcgZXhjZXB0aW9uIG1vZHVsZSBpbXBsZW1lbnRhdGlvbi4gIDA4LTA2LTEyLSBNdnMKICAgICAgICAgICAgICogewogICAgICAgICAgICAgKiAgICAgbmFtZTogJ2luaXRpYWxpemF0aW9uRXJyb3InLCAgIAogICAgICAgICAgICAgKiAgICAgbWVzc2FnZTonc3ViZmllbGQgbXVzdCBiZSBpbml0aWFsaXplZCB3aXRoIGV4YWN0bHkgMiBhcmd1bWVudHMnCiAgICAgICAgICAgICAqIH07CQogICAgICAgICAgICAgKi8KICAgICAgICB9CgogICAgICAgIC8vIEVuY2Fwc3VsYXRlIG9iamVjdAogICAgICAgIHZhciB0aGF0ID0gT2JqZWN0LmNyZWF0ZShTdWJmaWVsZC5wcm90b3R5cGUpOwoKICAgICAgICAvLyBQcml2YXRlIHZhbHVlIG9mIG5hbWUgYW5kIHZhbHVlCiAgICAgICAgdmFyIG5hbWUgPSBuYW1lYXJnOwogICAgICAgIHZhciB2YWx1ZSA9IHZhbHVlYXJnOwoKICAgICAgICB0aGF0Ll9fZGVmaW5lR2V0dGVyX18oIm5hbWUiLCBmdW5jdGlvbiAoICkgewogICAgICAgICAgICByZXR1cm4gbmFtZTsKCiAgICAgICAgfSk7CiAgICAgICAgdGhhdC5fX2RlZmluZVNldHRlcl9fKCJuYW1lIiwgZnVuY3Rpb24gKHZhbCkgewogICAgICAgICAgICBuYW1lID0gdmFsOwogICAgICAgIH0pOwoKICAgICAgICB0aGF0Ll9fZGVmaW5lR2V0dGVyX18oInZhbHVlIiwgZnVuY3Rpb24gKCApIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwoKICAgICAgICB9KTsKICAgICAgICB0aGF0Ll9fZGVmaW5lU2V0dGVyX18oInZhbHVlIiwgZnVuY3Rpb24gKHZhbCkgewogICAgICAgICAgICB2YWx1ZSA9IHZhbDsKICAgICAgICB9KTsKCiAgICAgICAgLy8gRnVuY3Rpb24gdGhhdCByZXR1cm5zIGVpdGhlciBuYW1lIG9yIG5hbWUgYW5kIHZhbHVlLgogICAgICAgIC8vIElmIHZhbHVlIGlzIHVuZGVmaW5lZCBvciBlbXB0eSB3aGVuIHRoZSBmdW5jdGlvbiBpcyBjYWxsZWQsIG9ubHkgbmFtZSBpcyByZXR1cm5lZC4KICAgICAgICB0aGF0LnRvU3RyaW5nID0gZnVuY3Rpb24gKCApIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gInVuZGVmaW5lZCIgfHwgdmFsdWUgPT09ICIiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIioiICsgdG9EbTIobmFtZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIioiICsgdG9EbTIobmFtZSkgKyAiICIgKyB0b0RtMih2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHJldHVybiB0aGF0OwogICAgfTsKfSkoKTsKCgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyBGaWVsZCBpbXBsZW1lbnRhdGlvbgovLyBhcnJheSBvZiBzdWJmaWVsZHMKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KdmFyIEZpZWxkID0gZnVuY3Rpb24oIG5hbWVhcmcsIGluZGljYXRvcmFyZyApIHsKCiAgICAvLyBjaGVja2luZyB0aGF0IHdlIGFyZSBjYWxsZWQgd2l0aCBleGFjdGx5IHplcm8gb3IgdHdvIGFyZ3VtZW50cywgaWYgbm90IHRocm93IGV4Y2VwdGlvbgogICAgaWYgKCBhcmd1bWVudHMubGVuZ3RoICE9IDIgJiYgYXJndW1lbnRzLmxlbmd0aCAhPT0gMCApIHsKICAgICAgICB0aHJvdyBFcnJvciggIkZpZWxkIG11c3QgYmUgaW5pdGlhbGl6ZWQgd2l0aCBleGFjdGx5IDAgb3IgMiBhcmd1bWVudHMiICk7CgogICAgICAgIC8qIENvbW1lbnRlZCBvdXQsIHBlbmRpbmcgZXhjZXB0aW9uIG1vZHVsZSBpbXBsZW1lbnRhdGlvbi4gIDA4LTA2LTEyLSBNdnMKCQl7CiAgICAgICAgbmFtZTogJ2luaXRpYWxpemF0aW9uRXJyb3InLAogICAgICAgICAgICAgICAgICBtZXNzYWdlOidGaWVsZCBtdXN0IGJlIGluaXRpYWxpemVkIHdpdGggZXhhY3RseSAwIG9yIDIgYXJndW1lbnRzJwogICAgICAgICAgICAgICAgICB9OyovCiAgICB9CiAgICAvLyBFbmNhcHN1bGF0ZSBvYmplY3QKICAgIHZhciB0aGF0ID0gT2JqZWN0LmNyZWF0ZSggRmllbGQucHJvdG90eXBlICk7CgogICAgdmFyIHN1YmZpZWxkQXJyYXkgPSBbIF07IC8vdXNlZCBmb3Igc3RvcmluZyB0aGUgc3ViZmllbGRzCgogICAgdmFyIGlzQ29udHJvbEZpZWxkQm9vbCA9IGZhbHNlOyAvLyBVc2VkIHRvIGRldGVybWluZSBpZiBmaWVsZCBpcyBhIGNvbnRyb2wgZmllbGQKICAgIHZhciB2YWx1ZSA9ICIiOyAvLyBPbmx5IHZhbGlkIGlmCgogICAgLy8gUHJpdmF0ZSB2YWx1ZSBvZiBuYW1lIGFuZCB2YWx1ZQogICAgdmFyIG5hbWUgPSBuYW1lYXJnOwogICAgdmFyIGluZGljYXRvciA9IGluZGljYXRvcmFyZzsKCiAgICAvKioKICAgICAqIEludGVybmFsIGhlbHBlcgogICAgICovCiAgICB2YXIgX19jcmVhdGVSZWFkT25seVN1YkZpZWxkID0gZnVuY3Rpb24oICkgewogICAgICAgICAgICAgICAgdmFyIHJlcyA9IFN1YmZpZWxkKCIiLCIiKTsKICAgICAgICAgICAgICAgIHJlcy5fX2RlZmluZVNldHRlcl9fKCJuYW1lIixmdW5jdGlvbih2YWwpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvciAoIklsbGVnYWwgb3BlcmF0aW9uIGFzc2lnbWVudCB0byBuYW1lIG9uICdub25FeGlzdGluZycgZmllbGQiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmVzLl9fZGVmaW5lU2V0dGVyX18oICJ2YWx1ZSIsIGZ1bmN0aW9uKCB2YWwgKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IgKCJJbGxlZ2FsIG9wZXJhdGlvbiBhc3NpZ25tZW50IHRvIHZhbHVlIG9uICdub25FeGlzdGluZycgZmllbGQiKQogICAgICAgICAgICAgICAgfSApOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICAgICAgfQoKICAgIHRoYXQuX19kZWZpbmVHZXR0ZXJfXyggIm5hbWUiLCBmdW5jdGlvbiggKSB7CiAgICAgICAgaWYgKCB0eXBlb2YgbmFtZSA9PSAidW5kZWZpbmVkIiApIHsKICAgICAgICAgICAgbmFtZSA9ICIiOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmFtZTsKCiAgICB9ICk7CiAgICB0aGF0Ll9fZGVmaW5lU2V0dGVyX18oICJuYW1lIiwgZnVuY3Rpb24oIHZhbCApIHsKICAgICAgICBuYW1lID0gdmFsOwogICAgfSApOwoKICAgIHRoYXQuX19kZWZpbmVHZXR0ZXJfXyggImluZGljYXRvciIsIGZ1bmN0aW9uKCApIHsKICAgICAgICBpZiAoIGlzQ29udHJvbEZpZWxkQm9vbCApIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoICJJbGxlZ2FsIG9wZXJhdGlvbiBvbiBjb250cm9sIGZpZWxkOiByZWFkaW5nIGluZGljYXRvciBhdHRyaWJ1dGUgaXMgbm90IGFsbG93ZWQiICk7CiAgICAgICAgfQogICAgICAgIGlmICggdHlwZW9mIGluZGljYXRvciA9PSAidW5kZWZpbmVkIiApIHsKICAgICAgICAgICAgaW5kaWNhdG9yID0gIiI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpbmRpY2F0b3I7CgogICAgfSApOwogICAgdGhhdC5fX2RlZmluZVNldHRlcl9fKCAiaW5kaWNhdG9yIiwgZnVuY3Rpb24oIHZhbCApIHsKICAgICAgICBpZiAoIGlzQ29udHJvbEZpZWxkQm9vbCApIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoICJJbGxlZ2FsIG9wZXJhdGlvbiBvbiBjb250cm9sIGZpZWxkOiBzZXR0aW5nIGluZGljYXRvciBhdHRyaWJ1dGUgaXMgbm90IGFsbG93ZWQiICk7CiAgICAgICAgfQogICAgICAgIGluZGljYXRvciA9IHZhbDsKICAgIH0gKTsKCiAgICB0aGF0LmlzQ29udHJvbEZpZWxkID0gZnVuY3Rpb24oICkgewogICAgICAgIHJldHVybiBpc0NvbnRyb2xGaWVsZEJvb2w7CiAgICB9OwoKICAgIC8vIEZpZWxkLnZhbHVlCiAgICAvLyBWYWx1ZSBjYW4gb25seSBiZSByZWFkIG9uIGNvbnRyb2wgZmllbGRzLCBhbmQgb25seSBiZSBzZXQgb24gY29udHJvbCBmaWVsZHMsIG9yIGVtcHR5IG9yZGluYXJ5IGZpZWxkcwogICAgdGhhdC5fX2RlZmluZUdldHRlcl9fKCAidmFsdWUiLCBmdW5jdGlvbiggKSB7CiAgICAgICAgaWYgKCAhaXNDb250cm9sRmllbGRCb29sICkgewogICAgICAgICAgICB0aHJvdyBFcnJvciggIklsbGVnYWwgb3BlcmF0aW9uIG9uIG5vbi1jb250cm9sIGZpZWxkOiByZWFkaW5nIHZhbHVlIGF0dHJpYnV0ZSBpcyBub3QgYWxsb3dlZCIgKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZhbHVlOwoKICAgIH0gKTsKICAgIHRoYXQuX19kZWZpbmVTZXR0ZXJfXyggInZhbHVlIiwgZnVuY3Rpb24oIHZhbCApIHsKICAgICAgICBpZiAoIGlzQ29udHJvbEZpZWxkQm9vbCB8fAogICAgICAgICAgICAoICggdHlwZW9mIGluZGljYXRvciA9PSAidW5kZWZpbmVkIiB8fCBpbmRpY2F0b3IgPT0gIiIgKSAmJgogICAgICAgICAgICAgICAgc3ViZmllbGRBcnJheS5sZW5ndGggPT0gMCApICkgewogICAgICAgICAgICBpc0NvbnRyb2xGaWVsZEJvb2wgPSB0cnVlOwogICAgICAgICAgICB2YWx1ZSA9IHZhbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBFcnJvciggIklsbGVnYWwgb3BlcmF0aW9uIG9uIG5vbi1jb250cm9sIGZpZWxkOiBzZXR0aW5nIHZhbHVlIGF0dHJpYnV0ZSBpcyBub3QgYWxsb3dlZCIgKTsKICAgICAgICB9CiAgICB9ICk7CgogICAgLy8gRmllbGQuYXBwZW5kCiAgICAvLyBGdW5jdGlvbiBmb3IgYXBwZW5kaW5nIG9yIGFkZGluZyBzdWJmaWVsZHMKICAgIC8vIG5hbWVBcmcgaXMgYSBzdWJmaWVsZAogICAgLy8gdmFsdWVBcmcgaXMgdGhlIHZhbHVlIG9mIHRoZSBzdWJmaWVsZCB0byBiZSBhcHBlbmRlZC4KICAgIC8vIHJlcGxhY2VCb29sIGRpY3RhdGVzIHdoZXRlciBhIHN1YmllbGQgc2hvdWxkIGJlIGFwcGVuZGVkIG9yIHJlcGxhY2VkLgogICAgLy8gSWYgcmVwbGFjZUJvb2wgaXMgdHJ1ZSB3ZSBhZGQgdG8gdGhlIGFycmF5IG90aGVyd2lzZSB0aGUgc3ViZmllbGQgaXMgYXBwZW5kZWQgdG8gdGhlIGFycmF5CiAgICB0aGF0LmFwcGVuZCA9IGZ1bmN0aW9uKCBuYW1lQXJnLCB2YWx1ZUFyZywgcmVwbGFjZUJvb2wgKSB7CiAgICAgICAgaWYgKCBpc0NvbnRyb2xGaWVsZEJvb2wgKSB7CiAgICAgICAgICAgIHRocm93IEVycm9yKCAiSWxsZWdhbCBvcGVyYXRpb24gb24gY29udHJvbCBmaWVsZDogY2FsbGluZyBhcHBlbmQgbWV0aG9kIGlzIG5vdCBhbGxvd2VkIiApOwogICAgICAgIH0KCiAgICAgICAgc3dpdGNoICggYXJndW1lbnRzLmxlbmd0aCApIHsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgc3ViZmllbGRBcnJheVsgc3ViZmllbGRBcnJheS5sZW5ndGggXSA9IFN1YmZpZWxkKCBuYW1lQXJnLm5hbWUsIG5hbWVBcmcudmFsdWUgKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgc3ViZmllbGRBcnJheVsgc3ViZmllbGRBcnJheS5sZW5ndGggXSA9IFN1YmZpZWxkKCBuYW1lQXJnLCB2YWx1ZUFyZyApOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBpZiAoIHJlcGxhY2VCb29sICkgewogICAgICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IC0xOwogICAgICAgICAgICAgICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IHN1YmZpZWxkQXJyYXkubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggc3ViZmllbGRBcnJheVsgaSBdLm5hbWUgPT0gbmFtZUFyZyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4ID0gaTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICggaW5kZXggIT0gLTEgKSB7IC8vd2UgZm91bmQgYSBzdWJmaWVsZAogICAgICAgICAgICAgICAgICAgICAgICBzdWJmaWVsZEFycmF5WyBpbmRleCBdID0gU3ViZmllbGQoIG5hbWVBcmcsIHZhbHVlQXJnICk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlQW5kU3RvcmVTdWJmaWVsZCggbmFtZUFyZywgdmFsdWVBcmcgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNyZWF0ZUFuZFN0b3JlU3ViZmllbGQoIG5hbWVBcmcsIHZhbHVlQXJnICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBkZWZhdWx0OgoKICAgICAgICAgICAgICAgIHRocm93IEVycm9yKCAiZnVuY3Rpb24gdGFrZXMgMSwgMiBvciAzIGFyZ3VtZW50cyIgKTsKICAgICAgICAgICAgICAgIC8qIENvbW1lbnRlZCBvdXQsIHBlbmRpbmcgZXhjZXB0aW9uIG1vZHVsZSBpbXBsZW1lbnRhdGlvbi4gIDA4LTA2LTEyLSBNdnMKCQkJewogICAgICAgICAgICBuYW1lOiAiaW52YWxpZEFyZ3VtZW50TnVtYmVyRXJyb3IiLAogICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogImZ1bmN0aW9uIHRha2VzIDEsIDIgb3IgMyBhcmd1bWVudHMiCiAgICAgICAgICAgICAgICAgICAgICB9OyovCiAgICAgICAgfQogICAgfTsKCiAgICAvLyBGaWVsZC5pbnNlcnQKICAgIC8vIEZ1bmN0aW9uIHRoYXQgaW5zZXJ0IGEgc3ViZmllbGQgYXQgYSBnaXZlbiBwb3NpdGlvbiBpLiBUaGUgc3ViZmllbGQgaXMgY3JlYXRlZCBmcm9tIG5hbWUgYW5kCiAgICAvLyB2YWx1ZS4KICAgIHRoYXQuaW5zZXJ0ID0gZnVuY3Rpb24oIGksIG5hbWUsIHZhbHVlICkgewogICAgICAgIGlmICggaXNDb250cm9sRmllbGRCb29sICkgewogICAgICAgICAgICB0aHJvdyBFcnJvciggIklsbGVnYWwgb3BlcmF0aW9uIG9uIGNvbnRyb2wgZmllbGQ6IGNhbGxpbmcgaW5zZXJ0IG1ldGhvZCBpcyBub3QgYWxsb3dlZCIgKTsKICAgICAgICB9CgogICAgICAgIHZhciBzdWJmaWVsZCA9IFN1YmZpZWxkKCBuYW1lLCB2YWx1ZSApOwogICAgICAgIGlmKCBpID09PSAwICkgewogICAgICAgICAgICBzdWJmaWVsZEFycmF5LnVuc2hpZnQoIHN1YmZpZWxkICk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBzdWJmaWVsZEFycmF5LnB1c2goIHVuZGVmaW5lZCApOwogICAgICAgICAgICBmb3IoIHZhciBqID0gaTsgaiA8IHN1YmZpZWxkQXJyYXkubGVuZ3RoIC0gMTsgaisrICkgewogICAgICAgICAgICAgICAgc3ViZmllbGRBcnJheVsgaiArIDEgXSA9IHN1YmZpZWxkQXJyYXlbIGogXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdWJmaWVsZEFycmF5WyBpIF0gPSBzdWJmaWVsZDsKICAgICAgICB9CiAgICB9OwoKICAgIC8vIEZpZWxkLnJlbW92ZQogICAgLy8gRnVuY3Rpb24gdGhhdCByZW1vdmVzIGEgc3ViZmllbGQgZnJvbSB0aGUgYXJyYXlzIG9mIHN1YmZpZWxkLiBDYW4gYmUgY2FsbGVkIHdpdGggZWl0aGVyIG9uZSBvciB0d28gYXJndW1lbnRzCiAgICAvLyBuYW1lQXJnID0gbmFtZSBvZiBzdWJmaWVsZAogICAgLy8gaW5kZXhBcmcgPSBpbmRleCBvZiB0aGUgc3ViZmllbGRzLCBzdGFydHMgd2l0aCAwLgogICAgdGhhdC5yZW1vdmUgPSBmdW5jdGlvbiggbmFtZUFyZywgaW5kZXhBcmcgKSB7CiAgICAgICAgaWYgKCBpc0NvbnRyb2xGaWVsZEJvb2wgKSB7CiAgICAgICAgICAgIHRocm93IEVycm9yKCAiSWxsZWdhbCBvcGVyYXRpb24gb24gY29udHJvbCBmaWVsZDogY2FsbGluZyByZW1vdmUgbWV0aG9kIGlzIG5vdCBhbGxvd2VkIiApOwogICAgICAgIH0KCiAgICAgICAgaWYgKCBhcmd1bWVudHMubGVuZ3RoID09IDEgKSB7IC8vbmFtZSBvZiBpbmRleCBvZiBzdWJmaWVsZAogICAgICAgICAgICBpZiAoIHR5cGVvZiBuYW1lQXJnID09ICJudW1iZXIiICkgewogICAgICAgICAgICAgICAgcmVtb3ZlSW5kZXhPZlN1YmZpZWxkQXJyYXkoIG5hbWVBcmcgKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGlmICggdHlwZW9mIG5hbWVBcmcgPT0gInN0cmluZyIgKSB7CiAgICAgICAgICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBzdWJmaWVsZEFycmF5Lmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICAgICAgICAgIGlmICggc3ViZmllbGRBcnJheVsgaSBdLm5hbWUgPT0gbmFtZUFyZyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlSW5kZXhPZlN1YmZpZWxkQXJyYXkoIGkgKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICggYXJndW1lbnRzLmxlbmd0aCA9PSAyICkgewogICAgICAgICAgICB2YXIgaXRlbUNvdW50ID0gLTE7CiAgICAgICAgICAgIGZvciAoIHZhciB5ID0gMDsgeSA8IHN1YmZpZWxkQXJyYXkubGVuZ3RoOyB5KysgKSB7CiAgICAgICAgICAgICAgICBpZiAoIHN1YmZpZWxkQXJyYXlbIHkgXS5uYW1lID09IG5hbWVBcmcgKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbUNvdW50ID0gaXRlbUNvdW50ICsgMTsKICAgICAgICAgICAgICAgICAgICBpZiAoIGl0ZW1Db3VudCA9PSBpbmRleEFyZyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlSW5kZXhPZlN1YmZpZWxkQXJyYXkoIHkgKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoICJmdW5jdGlvbiB0YWtlcyAxIG9yIDIgYXJndW1lbnRzIiApOwogICAgICAgICAgICAvKiBDb21tZW50ZWQgb3V0LCBwZW5kaW5nIGV4Y2VwdGlvbiBtb2R1bGUgaW1wbGVtZW50YXRpb24uICAwOC0wNi0xMi0gTXZzCgkJCXsKICAgICAgICAgICAgbmFtZToiaW52YWxpZEFyZ3VtZW50TnVtYmVyRXJyb3IiLAogICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiJmdW5jdGlvbiB0YWtlcyAxIG9yIDIgYXJndW1lbnRzIgogICAgICAgICAgICAgICAgICAgICB9OyovCiAgICAgICAgfQogICAgfTsKCiAgICAvLyBGaWVsZDpjb3VudAogICAgLy8gRnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSBudW1iZXIgb2YgaW5zdGFuY2VzIG9mIHN1YmZpZWxkcyBpbiB0aGUgYXJyYXkuCiAgICAvLyB0YWtlcyBvbmUgYXJndW1lbnQgPSBuYW1lIG9mIHN1YmZpZWxkcy4KICAgIHRoYXQuY291bnQgPSBmdW5jdGlvbiggbmFtZUFyZyApIHsKICAgICAgICBpZiAoIGlzQ29udHJvbEZpZWxkQm9vbCApIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoICJJbGxlZ2FsIG9wZXJhdGlvbiBvbiBjb250cm9sIGZpZWxkOiBjYWxsaW5nIGNvdW50IG1ldGhvZCBpcyBub3QgYWxsb3dlZCIgKTsKICAgICAgICB9CgogICAgICAgIGlmICggYXJndW1lbnRzLmxlbmd0aCA9PT0gMCApIHsKICAgICAgICAgICAgcmV0dXJuIHN1YmZpZWxkQXJyYXkubGVuZ3RoOwogICAgICAgIH0gZWxzZSBpZiAoIGFyZ3VtZW50cy5sZW5ndGggPT0gMSApIHsKICAgICAgICAgICAgdmFyIGl0ZW1Db3VudCA9IDA7CiAgICAgICAgICAgIHZhciBpdGVtID0gIiI7CiAgICAgICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IHN1YmZpZWxkQXJyYXkubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgICAgICAgICBpdGVtID0gc3ViZmllbGRBcnJheVsgaSBdOwogICAgICAgICAgICAgICAgaWYgKCBpdGVtLm5hbWUgPT0gbmFtZUFyZyApIHsKICAgICAgICAgICAgICAgICAgICBpdGVtQ291bnQgPSBpdGVtQ291bnQgKyAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBpdGVtQ291bnQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoICJmdW5jdGlvbiB0YWtlcyAwIG9yIDEgYXJndW1lbnQiICk7CiAgICAgICAgICAgIC8qIENvbW1lbnRlZCBvdXQsIHBlbmRpbmcgZXhjZXB0aW9uIG1vZHVsZSBpbXBsZW1lbnRhdGlvbi4gIDA4LTA2LTEyLSBNdnMKCQkJewogICAgICAgICAgICBuYW1lOiJpbnZhbGlkQXJndW1lbnROdW1iZXJFcnJvciIsCiAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ImZ1bmN0aW9uIHRha2VzIDAgb3IgMSBhcmd1bWVudCIKICAgICAgICAgICAgICAgICAgICAgfTsgKi8KICAgICAgICB9CgoKICAgIH07CgovL2phNiAgICAvLyBGaWVsZDpzdWJmaWVsZAogICAgLy8gRnVuY3Rpb24gdGhhdCByZXR1cm5zIGEgc3ViZmllbGQgZnJvbSB0aGUgYXJyYXkKICAgIC8vIFRha2VzIDIgYXJndW1lbnRzLiBGaXJzdCBhcmd1bWVudCBjYW4gYmUgZWl0aGVyIGEgbmFtZSBvZiBhIHN1YmZpZWxkIG9iamVjdCBvciBhIG51bWJlciBvZiBhIHN1YmlmaWVsZCwgd2hpY2ggaXMgemVybyBiYXNlZC4KICAgIC8vIHNlY29uZCBhcmd1bWVudCBpcyBpbmRleCBvZiBzdWJmaWVsZC4gVGhlIGluZGV4IG51bWJlciBkZXRlcm1pbmVzIHdoaWNoIG9jY3VyYW5jZSBvZiB0aGUgc3ViZmllbGQgc2hvdWxkIGJlIHJldHVybmVkLgogICAgLy8gSWYgdGhlIHNlY29uZCBhcmd1bWVudCBpcyBvbWl0dGVkLCB0aGUgYXJndW1lbnQgaXMgY2hlY2tlZCBmb3IgdHlwZS4KICAgIHRoYXQuc3ViZmllbGQgPSBmdW5jdGlvbiggbmFtZUFyZywgaW5kZXhBcmcgKSB7CiAgICAgICAgaWYgKCBpc0NvbnRyb2xGaWVsZEJvb2wgKSB7CiAgICAgICAgICAgIHRocm93IEVycm9yKCAiSWxsZWdhbCBvcGVyYXRpb24gb24gY29udHJvbCBmaWVsZDogY2FsbGluZyBzdWJmaWVsZCBtZXRob2QgaXMgbm90IGFsbG93ZWQiICk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIGFyZ3VtZW50cy5sZW5ndGggPT0gMSApIHsKICAgICAgICAgICAgaWYgKCB0eXBlb2YgbmFtZUFyZyA9PSAibnVtYmVyIiApIHsKICAgICAgICAgICAgICAgIGlmICggbmFtZUFyZyA+PSBzdWJmaWVsZEFycmF5Lmxlbmd0aCApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gU3ViZmllbGQoICIiLCAiIiApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3ViZmllbGRBcnJheVsgbmFtZUFyZyBdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKCB0eXBlb2YgbmFtZUFyZyA9PSAic3RyaW5nIiApIHsKICAgICAgICAgICAgICAgIGZvciAoIHZhciB5ID0gMDsgeSA8IHN1YmZpZWxkQXJyYXkubGVuZ3RoOyB5KysgKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBzdWJmaWVsZEFycmF5WyB5IF07CiAgICAgICAgICAgICAgICAgICAgaWYgKCBpdGVtLm5hbWUgPT0gbmFtZUFyZyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIF9fY3JlYXRlUmVhZE9ubHlTdWJGaWVsZCgpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICggYXJndW1lbnRzLmxlbmd0aCA9PSAyICkgewogICAgICAgICAgICB2YXIgaXRlbUNvdW50ID0gLTE7CiAgICAgICAgICAgIHZhciBpdGVtID0gIiI7CiAgICAgICAgICAgIGZvciAoIHZhciB4ID0gMDsgeCA8IHN1YmZpZWxkQXJyYXkubGVuZ3RoOyB4KysgKSB7CiAgICAgICAgICAgICAgICBpdGVtID0gc3ViZmllbGRBcnJheVsgeCBdOwogICAgICAgICAgICAgICAgaWYgKCBpdGVtLm5hbWUgPT0gbmFtZUFyZyApIHsKICAgICAgICAgICAgICAgICAgICBpdGVtQ291bnQgPSBpdGVtQ291bnQgKyAxOwogICAgICAgICAgICAgICAgICAgIGlmICggaXRlbUNvdW50ID09IGluZGV4QXJnICkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIF9fY3JlYXRlUmVhZE9ubHlTdWJGaWVsZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IEVycm9yKCAiZnVuY3Rpb24gdGFrZXMgMSBvciAyIGFyZ3VtZW50cyIgKTsKICAgICAgICAgICAgLyogQ29tbWVudGVkIG91dCwgcGVuZGluZyBleGNlcHRpb24gbW9kdWxlIGltcGxlbWVudGF0aW9uLiAgMDgtMDYtMTItIE12cwoJCQl7CiAgICAgICAgICAgICAgICBuYW1lIDogImludmFsaWRBcmd1bWVudE51bWJlckVycm9yIiwKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAiZnVuY3Rpb24gdGFrZXMgMSBvciAyIGFyZ3VtZW50cyIKICAgICAgICAgICAgICAgICAgICB9OyovCiAgICAgICAgfQogICAgfTsKCgogICAgLy8gRmllbGQ6dG9TdHJpbmcKICAgIC8vIEZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgY29udGVudHMgb2YgZmllbGQgYXMgYSBzdHJpbmcuCiAgICB0aGF0LnRvU3RyaW5nID0gZnVuY3Rpb24oICkgewogICAgICAgIGlmICggaXNDb250cm9sRmllbGRCb29sICkgewogICAgICAgICAgICByZXR1cm4gbmFtZSArICIgIiArIHZhbHVlLnJlcGxhY2UoIC9AL2csICJAQCIgKS5yZXBsYWNlKCAvXCovZywgIkAqIiApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFRyYXZlcnNlcyB0aGUgc3ViZmllbGRzIGFuZCByZXR1cm4gZWFjaCBhcyBhIHN0cmluZwogICAgICAgICAgICB2YXIgc3ViZmllbGRTdHJpbmcgPSAiICI7CiAgICAgICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IHN1YmZpZWxkQXJyYXkubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgICAgICAgICBzdWJmaWVsZFN0cmluZyA9IHN1YmZpZWxkU3RyaW5nICsgc3ViZmllbGRBcnJheVsgaSBdLnRvU3RyaW5nKCApICsgIiAiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBuYW1lICsgIiAiICsgaW5kaWNhdG9yICsgc3ViZmllbGRTdHJpbmc7CiAgICAgICAgfQogICAgfTsKCgogICAgLy9wcml2YXRlIGhlbHBlcmZ1bmN0aW9ucwoKICAgIC8vIEZ1bmN0aW9uIGZvciBjb3B5aW5nIGEgZmllbGQgYW5kIGFsbCBpdHMgc3ViZmllbGRzLiBOZWVkZWQgdG8gc2F2ZSBjb3BpZXMsIG5vdCByZWZlcmVuY2VzCiAgICB0aGF0Ll9fY29weSA9IGZ1bmN0aW9uKCApIHsKICAgICAgICB2YXIgcmVzID0gbmV3IEZpZWxkKCApOwogICAgICAgIHJlcy5uYW1lID0gbmFtZTsKICAgICAgICByZXMuaXNDb250cm9sRmllbGRCb29sID0gaXNDb250cm9sRmllbGRCb29sOwogICAgICAgIGlmICggaXNDb250cm9sRmllbGRCb29sICkgewogICAgICAgICAgICByZXMudmFsdWUgPSB2YWx1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXMuaW5kaWNhdG9yID0gaW5kaWNhdG9yOwogICAgICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBzdWJmaWVsZEFycmF5Lmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICAgICAgcmVzLmFwcGVuZCggc3ViZmllbGRBcnJheVsgaSBdICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlczsKICAgIH07CgogICAgLy8gRnVuY3Rpb24gdXNlZCBmb3IgY3JlYXRpbmcgYSBzdWJmaWVsZCBpbiB0aGUgc3ViZmllbGQgYXJyYXkKICAgIGZ1bmN0aW9uIGNyZWF0ZUFuZFN0b3JlU3ViZmllbGQoIG5hbWUsIHZhbCApIHsKICAgICAgICBzdWJmaWVsZEFycmF5WyBzdWJmaWVsZEFycmF5Lmxlbmd0aCBdID0gU3ViZmllbGQoIG5hbWUsIHZhbCApOwogICAgfTsKCiAgICAvLyBGdW5jdGlvbiB0aGF0IHJlbW92ZXMgYSBzdWJmaWVsZAogICAgZnVuY3Rpb24gcmVtb3ZlSW5kZXhPZlN1YmZpZWxkQXJyYXkoIGluZGV4QXJnICkgewogICAgICAgIGlmICggaW5kZXhBcmcgPT09IDAgKSB7CiAgICAgICAgICAgIHN1YmZpZWxkQXJyYXkuc3BsaWNlKCAwLCAxICk7CiAgICAgICAgICAgIC8vc3ViZmllbGRBcnJheSA9IHN1YmZpZWxkQXJyYXkuc2xpY2UoIDEgKTsKICAgICAgICB9IGVsc2UgaWYgKCBpbmRleEFyZyA9PSBzdWJmaWVsZEFycmF5Lmxlbmd0aCAtIDEgKSB7CiAgICAgICAgICAgIHN1YmZpZWxkQXJyYXkuc3BsaWNlKCAoIHN1YmZpZWxkQXJyYXkubGVuZ3RoIC0gMSApLCAxICk7CiAgICAgICAgICAgIC8vIHN1YmZpZWxkQXJyYXkgPSBzdWJmaWVsZEFycmF5LnNsaWNlKCAwLCBzdWJmaWVsZEFycmF5Lmxlbmd0aCAtMSApOwogICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgICBzdWJmaWVsZEFycmF5LnNwbGljZSggaW5kZXhBcmcsIDEgKTsKICAgICAgICAgICAgLyogY29tbWVudGVkIG91dCBieSBtdnMsIHJlcGxhY2VkIGJ5IHNwbGljZQogICAgICAgICAgICAgICAgdmFyIHBhcnQxID0gc3ViZmllbGRBcnJheS5zbGljZSggMCwgaW5kZXhBcmcpOwogICAgICAgICAgICAgICAgdmFyIHBhcnQyID0gc3ViZmllbGRBcnJheS5zbGljZSggaW5kZXhBcmcrMSk7CiAgICAgICAgICAgICAgICBzdWJmaWVsZEFycmF5ID0gcGFydDEuY29uY2F0KCBwYXJ0Mik7CiAgICAgICAgICAgICovCiAgICAgICAgfQogICAgfTsKICAgIHJldHVybiB0aGF0Owp9OwoKCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vIFJlY29yZCBpbXBsZW1lbnRhdGlvbgovLyBBcnJheSBvZiBmaWVsZHM6IGZpZWxkQXJyYXkKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KdmFyIFJlY29yZCA9IGZ1bmN0aW9uKCBmaWxlbmFtZUFyZyApIHsKCiAgICBpZiAoIGFyZ3VtZW50cy5sZW5ndGggPT09IDAgKSB7fSBlbHNlIGlmICggYXJndW1lbnRzLmxlbmd0aCA9PSAxICkgewogICAgICAgIHRocm93IEVycm9yKCAiQ2FsbCB0byBmdW5jdGlvbiB0aGF0IGNyZWF0ZXMgYSByZWNvcmQgZnJvbSBhIGZpbGUgaXMgbm90IGltcGxlbWVudGVkIGluIGphdmFzY3JpcHQiICk7CgogICAgICAgIC8qIENvbW1lbnRlZCBvdXQsIHBlbmRpbmcgZXhjZXB0aW9uIG1vZHVsZSBpbXBsZW1lbnRhdGlvbi4gIDA4LTA2LTEyLSBNdnMKCQl7CiAgICAgICAgbmFtZToibm90SW1wbGVtZW50ZWRFcnJvciIsCiAgICAgICAgICAgICAgICAgbWVzc2FnZToiQ2FsbCB0byBmdW5jdGlvbiB0aGF0IGNyZWF0ZXMgYSByZWNvcmQgZnJvbSBhIGZpbGUgaXMgbm90IGltcGxlbWVudGVkIGluIGphdmFzY3JpcHQiCiAgICAgICAgICAgICAgICAgfTsqLwogICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBFcnJvciggIlJlY29yZCBhdHRlbXB0ZWQgY3JlYXRlZCB3aXRoIHRvbyBtYW55IGFyZ3VtZW50cyIgKTsKICAgICAgICAvKiBDb21tZW50ZWQgb3V0LCBwZW5kaW5nIGV4Y2VwdGlvbiBtb2R1bGUgaW1wbGVtZW50YXRpb24uICAwOC0wNi0xMi0gTXZzCgkJewogICAgICAgIG5hbWU6ImludmFsaWRBcmd1bWVudE51bWJlckVycm9yIiwKICAgICAgICAgICAgICAgICBtZXNzYWdlOiJSZWNvcmQgYXR0ZW1wdGVkIGNyZWF0ZWQgd2l0aCB0b28gbWFueSBhcmd1bWVudHMiCiAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICovCiAgICB9CgogICAgLy8gRW5jYXBzdWxhdGUgb2JqZWN0CiAgICB2YXIgdGhhdCA9IE9iamVjdC5jcmVhdGUoIFJlY29yZC5wcm90b3R5cGUgKTsKICAgIHZhciBmaWVsZEFycmF5ID0gWyBdOwoKICAgIC8vIFRoZXNlIGFyZSBmaWVsZHMgZnJvbSB0aGUgaXNvIDI3MDkgaGVhZGVyLgogICAgLy8gUHJpdmF0ZSB2YWx1ZSBvZiBpbXBsZW1lbnRhdGlvbkNvZGVzIGFuZCByZWNvcmRTdGF0dXMKICAgIHZhciBpbXBsZW1lbnRhdGlvbkNvZGVzOwogICAgdmFyIHJlY29yZFN0YXR1cyA9ICJjIjsKICAgIHZhciBmb3JVc2VyU3lzdGVtcyA9ICIgICAiOwoKICAgIC8vIEhlbHBlciBmdW5jdGlvbiwgYWxsb3cgdXMgdG8gY2xlYXIgb3RoZXIgcGxhY2VzLgogICAgdmFyIF9fY2xlYXIgPSBmdW5jdGlvbigpIHsKICAgICAgICBmaWVsZEFycmF5ID0gW107CiAgICAgICAgaW1wbGVtZW50YXRpb25Db2RlcyA9ICIgICAgIjsKICAgICAgICByZWNvcmRTdGF0dXMgPSAiYyI7CiAgICAgICAgZm9yVXNlclN5c3RlbXMgPSAiICAgIjsKICAgIH0KICAgIF9fY2xlYXIoKTsKCiAgICB0aGF0Ll9fZGVmaW5lR2V0dGVyX18oICJpbXBsZW1lbnRhdGlvbkNvZGVzIiwgZnVuY3Rpb24oICkgewogICAgICAgIHJldHVybiBpbXBsZW1lbnRhdGlvbkNvZGVzOwogICAgfSApOwoKICAgIHRoYXQuX19kZWZpbmVTZXR0ZXJfXyggImltcGxlbWVudGF0aW9uQ29kZXMiLCBmdW5jdGlvbiggdmFsICkgewogICAgICAgIGltcGxlbWVudGF0aW9uQ29kZXMgPSB2YWw7CiAgICB9ICk7CgogICAgdGhhdC5fX2RlZmluZUdldHRlcl9fKCAicmVjb3JkU3RhdHVzIiwgZnVuY3Rpb24oICkgewogICAgICAgIHJldHVybiByZWNvcmRTdGF0dXM7CiAgICB9ICk7CgogICAgdGhhdC5fX2RlZmluZVNldHRlcl9fKCAicmVjb3JkU3RhdHVzIiwgZnVuY3Rpb24oIHZhbCApIHsKICAgICAgICByZWNvcmRTdGF0dXMgPSB2YWw7CiAgICB9ICk7CgogICAgdGhhdC5fX2RlZmluZUdldHRlcl9fKCAiZm9yVXNlclN5c3RlbXMiLCBmdW5jdGlvbiggKSB7CiAgICAgICAgcmV0dXJuIGZvclVzZXJTeXN0ZW1zOwogICAgfSApOwoKICAgIHRoYXQuX19kZWZpbmVTZXR0ZXJfXyggImZvclVzZXJTeXN0ZW1zIiwgZnVuY3Rpb24oIHZhbCApIHsKICAgICAgICBmb3JVc2VyU3lzdGVtcyA9IHZhbDsKICAgIH0gKTsKCgogICAgLyoqCiAgICAgKiBpbnRlcm5hbCBoZWxkcGVyCiAgICAgKiBAcmV0dXJucyBSZWNvcmQgb2JqZWN0IHdpdGggb3dlcndyaXR0ZW4gc2V0dGVyIE1ldGhvZHMgdGhhdCB0aHJvd3N7fQogICAgICogQHByaXZhdGUKICAgICAqLwogICAgdmFyIF9fY3JlYXRlUmVhZE9ubHlGaWVsZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgcmVzID0gRmllbGQoIiIsIiIpOwogICAgICAgIHJlcy5fX2RlZmluZVNldHRlcl9fKCJuYW1lIiwgZnVuY3Rpb24oIHZhbHVlICkgewogICAgICAgICAgICB0aHJvdyBFcnJvcigiSWxsZWdhbCBvcGVyYXRpb24gb24gbm9uIGV4aXN0ZW50IGZpZWxkOiBzZXR0aW5nIG5hbWUgYXR0cmlidXRlIGlzIG5vdCBhbGxvd2VkIik7CiAgICAgICAgfSk7CiAgICAgICAgcmVzLl9fZGVmaW5lU2V0dGVyX18oImluZGljYXRvciIsIGZ1bmN0aW9uKCB2YWx1ZSApIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoIklsbGVnYWwgb3BlcmF0aW9uIG9uIG5vbiBleGlzdGVudCBmaWVsZDogc2V0dGluZyBpbmRpY2F0b3IgYXR0cmlidXRlIGlzIG5vdCBhbGxvd2VkIikKICAgICAgICB9KTsKICAgICAgICByZXMuX19kZWZpbmVTZXR0ZXJfXygidmFsdWUiLCBmdW5jdGlvbiggdmFsdWUgKSB7CiAgICAgICAgICAgIHRocm93IEVycm9yKCJJbGxlZ2FsIG9wZXJhdGlvbiBvbiBub24gZXhpc3RlbnQgZmllbGQ6IHNldHRpbmcgdmFsdWUgYXR0cmlidXRlIGlzIG5vdCBhbGxvd2VkIikKICAgICAgICB9KTsKICAgICAgICByZXMuYXBwZW5kID0gZnVuY3Rpb24oICkgewogICAgICAgICAgICB0aHJvdyBFcnJvcigiSWxsZWdhbCBvcGVyYXRpb24gb24gbm9uIGV4aXN0ZW50IGZpZWxkOiBzZXR0aW5nIGFwcGVuZCBhdHRyaWJ1dGUgaXMgbm90IGFsbG93ZWQiKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlczsKICAgIH0KCiAgICAvLyBSZWNvcmQ6bnVtYmVyT2ZGaWVsZHMKICAgIC8vIEZ1bmN0aW9uIHdoaWNoIHJldHVybnMgdGhlIG51bWJlciBvZiBmaWVsZHMgaW4gdGhlIGZpZWxkIGFycmF5CiAgICB0aGF0Lm51bWJlck9mRmllbGRzID0gZnVuY3Rpb24oICkgewogICAgICAgIHJldHVybiBmaWVsZEFycmF5Lmxlbmd0aDsKICAgIH07CgoKICAgIC8vIFJlY29yZDpjb3VudAogICAgLy8gRnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSBnaXZlbiBudW1iZXIgb2YgZmllbGQgb2NjdXJhbmNlcyBpbiB0aGUgZmllbGQgYXJyYXkKICAgIC8vIFRha2VzIG9uZSBhcmd1bWVudCwgbmFtZUFyZyB3aGljaCBpcyB0aGUgZmllbGQgaWQuIAogICAgdGhhdC5jb3VudCA9IGZ1bmN0aW9uKCBuYW1lQXJnICkgewogICAgICAgIGlmICggYXJndW1lbnRzLmxlbmd0aCA9PSAxICkgewogICAgICAgICAgICB2YXIgaXRlbUNvdW50ID0gMDsKICAgICAgICAgICAgdmFyIGl0ZW0gPSAiIjsKICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgZmllbGRBcnJheS5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgICAgIGl0ZW0gPSBmaWVsZEFycmF5WyBpIF07CiAgICAgICAgICAgICAgICBpZiAoIGZpZWxkQXJyYXlbIGkgXS5uYW1lID09IG5hbWVBcmcgKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbUNvdW50ID0gaXRlbUNvdW50ICsgMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gaXRlbUNvdW50OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IEVycm9yKCAiRnVuY3Rpb24gdGFrZXMgb25seSAxIGFyZ3VtZW50IiApOwogICAgICAgICAgICAvKiBDb21tZW50ZWQgb3V0LCBwZW5kaW5nIGV4Y2VwdGlvbiBtb2R1bGUgaW1wbGVtZW50YXRpb24uICAwOC0wNi0xMi0gTXZzCgkJCXsKICAgICAgICAgICAgbmFtZToiaW52YWxpZEFyZ3VtZW50TnVtYmVyRXJyb3IiLAogICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiJGdW5jdGlvbiB0YWtlcyAxIGFyZ3VtZW50IgogICAgICAgICAgICAgICAgICAgICB9OyovCiAgICAgICAgfQoKICAgIH07CgogICAgLy8gUmVjb3JkOmFwcGVuZAogICAgLy8gRnVuY3Rpb24gdGhhdCBlaXRoZXIgYXBwZW5kcyB0byBhbiBleGNpc3RpbmcgZmllbGQgb3IgYWRkcyBhIG5ldyBmaWVsZCB0byB0aGUgZmllbGRBcnJheQogICAgLy8gVGFrZXMgdHdvIGFyZ3VtZW50cwogICAgLy8gRmlyc3QgYXJndW1lbnQgY2FuIGJlIGVpdGhlciBhIGZpZWxkIG9yIHRoZSBuYW1lIG9mIHRoZSBmaWVsZC4gSXRzIGFzc3VtZWQgdG8gYmUgYSBmaWVsZCBpZiBzZWNvbmQgYXJndW1lbnQgaXMgb21pdHRlZC4KICAgIC8vIElmIHRoZXJlIGFyZSB0d28gYXJndW1lbnRzIGl0cyBhc3N1bWVkIGZpcnN0IGFyZ3VtZW50IGlzIGEgbmFtZXN0cmluZyBhbmQgYW4gaW5kaWNhdG9yIHN0cmluZyBvZiB0aGUgZmllbGQgaW4gdGhlIGZpZWxkQXJyYXkuCiAgICB0aGF0LmFwcGVuZCA9IGZ1bmN0aW9uKCBuYW1lQXJnLCBpbmRpY2F0b3JBcmcgKSB7CiAgICAgICAgaWYgKCBhcmd1bWVudHMubGVuZ3RoID09IDEgKSB7IC8vaXRzIGEgZmllbGQgCiAgICAgICAgICAgIGZpZWxkQXJyYXlbIGZpZWxkQXJyYXkubGVuZ3RoIF0gPSBuYW1lQXJnLl9fY29weSggKTsgLy9TdG9yZXMgdGhlIG5ldyBmaWVsZCBpbiB0aGUgZmllbGRhcnJheQogICAgICAgIH0gZWxzZSBpZiAoIGFyZ3VtZW50cy5sZW5ndGggPT0gMiApIHsKICAgICAgICAgICAgZmllbGRBcnJheVsgZmllbGRBcnJheS5sZW5ndGggXSA9IG5ldyBGaWVsZCggbmFtZUFyZywgaW5kaWNhdG9yQXJnICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoICJmdW5jdGlvbiB0YWtlcyAxIG9yIDIgYXJndW1lbnRzIiApOwogICAgICAgICAgICAvKiBDb21tZW50ZWQgb3V0LCBwZW5kaW5nIGV4Y2VwdGlvbiBtb2R1bGUgaW1wbGVtZW50YXRpb24uICAwOC0wNi0xMi0gTXZzCgkJewogICAgICAgICAgICBuYW1lOiJpbnZhbGlkQXJndW1lbnROdW1iZXJFcnJvciIsCiAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ImZ1bmN0aW9uIHRha2VzIDEgb3IgMiBhcmd1bWVudHMiCiAgICAgICAgICAgICAgICAgICAgIH07Ki8KICAgICAgICB9CiAgICB9OwoKICAgIC8vIFJlY29yZDpyZW1vdmUKICAgIC8vIEZ1bmN0aW9uIHRoYXQgcmVtb3ZlcyBhIGZpZWxkIGZyb20gdGhlIHJlY29yZCBpbnN0YW5jZQogICAgLy8gVGFrZXMgdHdvIGFyZ3VtZW50cwogICAgLy8gRmlyc3QgYXJndW1lbnQgY2FuIGJlIGVpdGhlciB0aGUgbmFtZSBvciB0aGUgemVybyBiYXNlZCBJRCBudW1iZXIgb2YgdGhlIGZpZWxkIHRvIHJlbW92ZS4KICAgIC8vIFNlY29uZCBhcmd1bWVudCBpcyBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgaW5kZXggbnVtYmVycyBvZiBmaWVsZHMgaW4gdGhlIGZpZWxkYXJyYXkuCiAgICAvLyBJZiB0aGVyZSBpcyBubyBmaWVsZCBtYXRjaGluZyB0aGUgSUQgb3IgbmFtZSwgbm90aGluZyBoYXBwZW5zIAogICAgdGhhdC5yZW1vdmUgPSBmdW5jdGlvbiggbmFtZUFyZywgaW5kZXhBcmcgKSB7CiAgICAgICAgc3dpdGNoICggYXJndW1lbnRzLmxlbmd0aCApIHsKCiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIGlmICggYXJndW1lbnRzLmxlbmd0aCA9PSAxICYmIHR5cGVvZiBuYW1lQXJnID09ICJudW1iZXIiICkgewogICAgICAgICAgICAgICAgICAgIHJlbW92ZUluZGV4T2ZGaWVsZEFycmF5KCBuYW1lQXJnICk7CiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIGlmICggYXJndW1lbnRzLmxlbmd0aCA9PSAxICYmIHR5cGVvZiBuYW1lQXJnID09ICJzdHJpbmciICkgewogICAgICAgICAgICAgICAgICAgIGZvciAoIHZhciB5ID0gMDsgeSA8IGZpZWxkQXJyYXkubGVuZ3RoOyB5KysgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZmllbGRBcnJheVsgeSBdLm5hbWUgPT0gbmFtZUFyZyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUluZGV4T2ZGaWVsZEFycmF5KCB5ICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgdmFyIGl0ZW1Db3VudCA9IC0xOwogICAgICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgZmllbGRBcnJheS5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIGZpZWxkQXJyYXlbIGkgXS5uYW1lID09IG5hbWVBcmcgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1Db3VudCA9IGl0ZW1Db3VudCArIDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggaXRlbUNvdW50ID09IGluZGV4QXJnICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlSW5kZXhPZkZpZWxkQXJyYXkoIGkgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoICJmdW5jdGlvbiB0YWtlcyAxIG9yIDIgYXJndW1lbnRzIiApOwogICAgICAgICAgICAgICAgLyogQ29tbWVudGVkIG91dCwgcGVuZGluZyBleGNlcHRpb24gbW9kdWxlIGltcGxlbWVudGF0aW9uLiAgMDgtMDYtMTItIE12cwoJCQl7CiAgICAgICAgICAgIG5hbWU6ICJpbnZhbGlkQXJndW1lbnROdW1iZXJFcnJvciIsCiAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAiZnVuY3Rpb24gdGFrZXMgMSBvciAyIGFyZ3VtZW50cyIKCQkJCSAgICAgICAgICAgICAgICAgICAgICB9OyovCiAgICAgICAgfQogICAgfTsKCiAgICAvLyBJcyBpbiB0aGUgZG9jdW1lbnRhdGlvbiwgYnV0IGhhcyBubyB1bml0IHRlc3QuCiAgICB0aGF0LnJlbW92ZUFsbCA9IGZ1bmN0aW9uKCBuYW1lICkgewogICAgICAgIHZhciBudW0gPSB0aGF0LmNvdW50KCBuYW1lICk7CiAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgbnVtOyBpKysgKSB7CiAgICAgICAgICAgIHRoYXQucmVtb3ZlKCBuYW1lICk7CiAgICAgICAgfQogICAgfTsKCiAgICAvLyBSZWNvcmQ6ZmllbGQgICAgICAgICAgU3ViCiAgICAvLyBGdW5jdGlvbiB0aGF0IHJldHVybnMgYSBmaWVsZCBmcm9tIGEgcmVjb3JkCiAgICAvLyBUYWtlcyAyIGFyZ3VtZW50cwogICAgLy8gRmlyc3QgYXJndW1lbnQgY2FuIGJlIGVpdGhlciB0aGUgbmFtZSBvciB0aGUgemVybyBiYXNlZCBJRCBudW1iZXIgb2YgdGhlIGZpZWxkIHRvIHJldHVybiAKICAgIHRoYXQuZmllbGQgPSBmdW5jdGlvbiggbmFtZUFyZywgaW5kZXhBcmcgKSB7CiAgICAgICAgaWYgKCBhcmd1bWVudHMubGVuZ3RoID09IDEgKSB7CiAgICAgICAgICAgIGlmICggdHlwZW9mIG5hbWVBcmcgPT0gIm51bWJlciIgKSB7CiAgICAgICAgICAgICAgICBpZiAoIG5hbWVBcmcgPj0gZmllbGRBcnJheS5sZW5ndGggKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZpZWxkKCAiIiwgIiIgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkQXJyYXlbIG5hbWVBcmcgXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICggdHlwZW9mIG5hbWVBcmcgPT0gInN0cmluZyIgKSB7CiAgICAgICAgICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBmaWVsZEFycmF5Lmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICAgICAgICAgIGlmICggZmllbGRBcnJheVsgaSBdLm5hbWUgPT0gbmFtZUFyZyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkQXJyYXlbIGkgXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gX19jcmVhdGVSZWFkT25seUZpZWxkKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKCBhcmd1bWVudHMubGVuZ3RoID09IDIgKSB7CiAgICAgICAgICAgIHZhciBpdGVtQ291bnQgPSAtMTsKCiAgICAgICAgICAgIHZhciBsZW4gPSBmaWVsZEFycmF5Lmxlbmd0aDsKICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgbGVuOyBpKysgKSB7CiAgICAgICAgICAgICAgICBpZiAoIGZpZWxkQXJyYXlbIGkgXS5uYW1lID09IG5hbWVBcmcgKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbUNvdW50ID0gaXRlbUNvdW50ICsgMTsKICAgICAgICAgICAgICAgICAgICBpZiAoIGl0ZW1Db3VudCA9PSBpbmRleEFyZyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkQXJyYXlbIGkgXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIF9fY3JlYXRlUmVhZE9ubHlGaWVsZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IEVycm9yKCAiRnVuY3Rpb24gZmllbGQgaXMgY2FsbGVkIHdpdGggMSBvciAyIGFyZ3VtZW50cyIgKTsKICAgICAgICAgICAgLyogQ29tbWVudGVkIG91dCwgcGVuZGluZyBleGNlcHRpb24gbW9kdWxlIGltcGxlbWVudGF0aW9uLiAgMDgtMDYtMTItIE12cwoJCXsKICAgICAgICAgICAgbmFtZToiaW52YWxpZEFyZ3VtZW50TnVtYmVyRXJyb3IiLAogICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiJGdW5jdGlvbiBmaWVsZCBpcyBjYWxsZWQgd2l0aCAxIG9yIDIgYXJndW1lbnRzIgogICAgICAgICAgICAgICAgICAgICB9OyAqLwogICAgICAgIH0KICAgIH07CgogICAgLy8gUmVjb3JkOnRvU3RyaW5nCiAgICAvLyBGdW5jdGlvbiB0aGF0IHJldHVybnMgdGhlIGNvbnRlbnRzIG9mIGZpZWxkQXJyYXkgYXMgc3RyaW5ncy4KICAgIC8vIENhbGxzIGZpZWxkLnRvU3RyaW5nIHdoaWNoIGNhbGxzIHN1YmZpZWxkLnRvU3RyaW5nCiAgICB0aGF0LnRvU3RyaW5nID0gZnVuY3Rpb24oICkgewogICAgICAgIHZhciBmaWVsZFN0cmluZyA9ICIiOwogICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IGZpZWxkQXJyYXkubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgICAgIGZpZWxkU3RyaW5nID0gZmllbGRTdHJpbmcgKyBmaWVsZEFycmF5WyBpIF0udG9TdHJpbmcoICkgKyAiXG4iOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmllbGRTdHJpbmc7CiAgICB9OwoKCiAgICAvLyBSZWNvcmQ6ZnJvbVN0cmluZwogICAgdGhhdC5mcm9tU3RyaW5nID0gZnVuY3Rpb24gKHN0cmluZykgewogICAgICAgIHZhciBCeXRlQXJyYXlJbnB1dFN0cmVhbSA9IFBhY2thZ2VzLmphdmEuaW8uQnl0ZUFycmF5SW5wdXRTdHJlYW07CiAgICAgICAgdmFyIERhbk1hcmMyTGluZUZvcm1hdFJlYWRlciA9IFBhY2thZ2VzLmRrLmRiYy5tYXJjLnJlYWRlci5EYW5NYXJjMkxpbmVGb3JtYXRSZWFkZXI7CiAgICAgICAgdmFyIERhbk1hcmMyQ2hhcnNldCA9IFBhY2thZ2VzLmRrLmRiYy5tYXJjLkRhbk1hcmMyQ2hhcnNldDsKICAgICAgICB2YXIgZGFuTWFyYzJDaGFyc2V0ID0gbmV3IERhbk1hcmMyQ2hhcnNldChEYW5NYXJjMkNoYXJzZXQuVmFyaWFudC5MSU5FX0ZPUk1BVCk7CiAgICAgICAgdmFyIERhdGFGaWVsZCA9IFBhY2thZ2VzLmRrLmRiYy5tYXJjLmJpbmRpbmcuRGF0YUZpZWxkOwogICAgICAgIHZhciBTdHJpbmcgPSBQYWNrYWdlcy5qYXZhLmxhbmcuU3RyaW5nOwogICAgICAgIHZhciBTdGFuZGFyZENoYXJzZXRzID0gUGFja2FnZXMuamF2YS5uaW8uY2hhcnNldC5TdGFuZGFyZENoYXJzZXRzOwoKICAgICAgICBfX2NsZWFyKCk7CiAgICAgICAgCiAgICAgICAgdmFyIGlzID0gbmV3IEJ5dGVBcnJheUlucHV0U3RyZWFtKG5ldyBTdHJpbmcoc3RyaW5nKS5nZXRCeXRlcyhTdGFuZGFyZENoYXJzZXRzLklTT184ODU5XzEpKTsKICAgICAgICB2YXIgcmVhZGVyID0gbmV3IERhbk1hcmMyTGluZUZvcm1hdFJlYWRlcihpcywgZGFuTWFyYzJDaGFyc2V0KTsKICAgICAgICB2YXIgbWFyY1JlY29yZCA9IHJlYWRlci5yZWFkKCk7CiAgICAgICAgdmFyIGZpZWxkcyA9IG1hcmNSZWNvcmQuZ2V0RmllbGRzKCkuaXRlcmF0b3IoKTsKICAgICAgICB3aGlsZSAoZmllbGRzLmhhc05leHQoKSkgewogICAgICAgICAgICB2YXIgZmllbGQgPSBmaWVsZHMubmV4dCgpOwogICAgICAgICAgICBpZiAoZmllbGQgaW5zdGFuY2VvZiBEYXRhRmllbGQpIHsKICAgICAgICAgICAgICAgIHZhciBsaW5lID0gbmV3IEZpZWxkKCk7CiAgICAgICAgICAgICAgICBsaW5lLm5hbWUgPSAiIiArIGZpZWxkLmdldFRhZygpOwogICAgICAgICAgICAgICAgbGluZS5pbmRpY2F0b3IgPSAiIiArIGZpZWxkLmdldEluZDEoKSArIGZpZWxkLmdldEluZDIoKTsKICAgICAgICAgICAgICAgIHZhciBzdWJmaWVsZHMgPSBmaWVsZC5nZXRTdWJmaWVsZHMoKS5pdGVyYXRvcigpOwogICAgICAgICAgICAgICAgd2hpbGUoc3ViZmllbGRzLmhhc05leHQoKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBzdWJmaWVsZCA9IHN1YmZpZWxkcy5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgbGluZS5hcHBlbmQobmV3IFN1YmZpZWxkKCIiICsgc3ViZmllbGQuZ2V0Q29kZSgpLCAiIiArIHN1YmZpZWxkLmdldERhdGEoKSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5hcHBlbmQobGluZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIHRoYXQuZGVjb2RlID0gZnVuY3Rpb24gKCBiaW5hcnkgKSB7CiAgICAgICAgdmFyIElzbzI3MDlVbnBhY2tlciA9ICBQYWNrYWdlcy5kay5kYmMubWFyYy5Jc28yNzA5VW5wYWNrZXI7CiAgICAgICAgdmFyIE5vZGUgPSBQYWNrYWdlcy5vcmcudzNjLmRvbS5Ob2RlOwogICAgICAgIHZhciBEYW5NYXJjMkNoYXJzZXQgPSBQYWNrYWdlcy5kay5kYmMubWFyYy5EYW5NYXJjMkNoYXJzZXQ7CiAgICAgICAgdmFyIGRhbk1hcmMyQ2hhcnNldCA9IG5ldyBEYW5NYXJjMkNoYXJzZXQoKTsKICAgICAgICB2YXIgbWFyY3ggPSBJc28yNzA5VW5wYWNrZXIuY3JlYXRlTWFyY1hDaGFuZ2VSZWNvcmQoYmluYXJ5LnRvT3V0cHV0Qnl0ZXMoKSwgZGFuTWFyYzJDaGFyc2V0KTsKCiAgICAgICAgX19jbGVhcigpOwoJCiAgICAgICAgdmFyIGNobGQgPSBtYXJjeC5nZXREb2N1bWVudEVsZW1lbnQoKS5nZXRGaXJzdENoaWxkKCk7CiAgICAgICAgd2hpbGUgKGNobGQgIT09IG51bGwpIHsKICAgICAgICAgICAgaWYgKGNobGQuZ2V0Tm9kZVR5cGUoKSA9PT0gTm9kZS5FTEVNRU5UX05PREUpIHsKICAgICAgICAgICAgICAgIHZhciBuYW1lID0gY2hsZC5nZXRMb2NhbE5hbWUoKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgaWYobmFtZSA9PT0gJ2xlYWRlcicpIHsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZihuYW1lID09PSAnY29udHJvbGZpZWxkJykgewogICAgICAgICAgICAgICAgICAgIHZhciBmaWVsZCA9IG5ldyBGaWVsZCgpOwogICAgICAgICAgICAgICAgICAgIGZpZWxkLm5hbWUgPSAiIiArIGNobGQuZ2V0QXR0cmlidXRlKCd0YWcnKTsKICAgICAgICAgICAgICAgICAgICBmaWVsZC52YWx1ZSA9ICIiICsgY2hsZC5nZXRUZXh0Q29udGVudCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kKGZpZWxkKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmFtZSA9PT0gJ2RhdGFmaWVsZCcpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGQgPSBuZXcgRmllbGQoKTsKICAgICAgICAgICAgICAgICAgICBmaWVsZC5uYW1lID0gIiIgKyBjaGxkLmdldEF0dHJpYnV0ZSgndGFnJyk7CiAgICAgICAgICAgICAgICAgICAgZmllbGQuaW5kaWNhdG9yID0gIiIgKyBjaGxkLmdldEF0dHJpYnV0ZSgnaW5kMScpICsgY2hsZC5nZXRBdHRyaWJ1dGUoJ2luZDInKTsKICAgICAgICAgICAgICAgICAgICB2YXIgc3ViID0gY2hsZC5nZXRGaXJzdENoaWxkKCk7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHN1YiAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3ViLmdldE5vZGVUeXBlKCkgPT09IE5vZGUuRUxFTUVOVF9OT0RFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IHN1Yi5nZXRMb2NhbE5hbWUoKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWUgPT09ICdzdWJmaWVsZCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3ViRmllbGQgPSBuZXcgU3ViZmllbGQoIiIgKyBzdWIuZ2V0QXR0cmlidXRlKCdjb2RlJyksICIiICsgc3ViLmdldFRleHRDb250ZW50KCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkLmFwcGVuZChzdWJGaWVsZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgc3ViID0gc3ViLmdldE5leHRTaWJsaW5nKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kKGZpZWxkKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgTG9nLndhcm4oIlVua25vd24gZWxlbWVudCB0eXBlIGluIHJlY29yZDogIiArIG5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNobGQgPSBjaGxkLmdldE5leHRTaWJsaW5nKCk7CiAgICAgICAgfQogICAgfTsKCiAgICAvLyBwcml2YXRlIGhlbHBlciBmdW5jdGlvbgogICAgLy8gRnVuY3Rpb24gaXMgdXNlZCBmb3IgcmVtb3ZpbmcgYSBmaWVsZCBmcm9tIHRoZSBmaWVsZGFycmF5LgogICAgLy8gVGFrZXMgMSBhcmd1bWVudCB3aGljaCBpcyB0aGUgaW5kZXggbnVtYmVyIG9mIHRoZSBhcnJheSBwb3NpdGlvbiBwZW5kaW5nIHJlbW92YWwKICAgIGZ1bmN0aW9uIHJlbW92ZUluZGV4T2ZGaWVsZEFycmF5KCBpbmRleEFyZyApIHsKICAgICAgICBpZiAoIGluZGV4QXJnID09PSAwICkgewogICAgICAgICAgICBmaWVsZEFycmF5LnNwbGljZSggMCwgMSApOwogICAgICAgIH0gZWxzZSBpZiAoIGluZGV4QXJnID09IGZpZWxkQXJyYXkubGVuZ3RoIC0gMSApIHsKICAgICAgICAgICAgZmllbGRBcnJheS5zcGxpY2UoICggZmllbGRBcnJheS5sZW5ndGggLSAxICksIDEgKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmaWVsZEFycmF5LnNwbGljZSggaW5kZXhBcmcsIDEgKTsKICAgICAgICB9CiAgICB9OwogICAgcmV0dXJuIHRoYXQ7Cn07Cg==", "moduleName": "MarcClassesCore"}, {"javascript": "LyoqIEBmaWxlIEluZnJhc3RydWN0dXJlIHN1cHBvcnQgZm9yIG1hcmMgY2xhc3NlcyAqLwovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovKiEKICAgIFxmaWxlIHRleHRjb2RlYy5qcwogICAgXGJyaWVmIAoqLwovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gICAgICAgICAgICAgICAgICAgICAgRXhwb3J0ZWQgU3ltYm9scwovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKRVhQT1JURURfU1lNQk9MUyA9IFsgJ2dldE1hdGNoRmllbGQnLCAnZ2V0TWF0Y2hTdWJGaWVsZCcsICdNYXRjaEZpZWxkJywgJ01hdGNoU3ViRmllbGQnLAogICAgJ0RCQ01hdGNoRmllbGQnLCAnU3RyaW5nTWF0Y2hGaWVsZCcsICdTdHJpbmdNYXRjaFN1YkZpZWxkJywgJ01hdGNoTWFwJywgJ01hdGNoRnVuYycKXTsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdsb2JhbCBoZWxwIGZ1bmN0aW9ucwovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKLyoqCiAqIENvbnZlcnRzIHRoZSBhcmd1bWVudCB0byBhIE1hdGNoRmllbGQgaW5zdGFuY2UuCiAqIAogKiBAcGFyYW0ge01hdGNoRmllbGR8UmVnRXhwfSBhcmcgQSBNYXRjaEZpZWxkIG9yIGEgcmVndWxhciBleHByZXNzaW9uIG9mIGZpZWxkIG5hbWVzLgogKiAKICogQHJldHVybiB7TWF0Y2hGaWVsZH0gVGhlIE1hdGNoRmllbGQgYWZ0ZXIgYXJnIGlzIGNvbnZlcnRlZCB0byBpdC4KICovCmZ1bmN0aW9uIGdldE1hdGNoRmllbGQoIGFyZyApIHsKICAgIGlmICggYXJnID09IHVuZGVmaW5lZCApIHsKICAgICAgICByZXR1cm4gbmV3IE1hdGNoRmllbGQoICk7CiAgICB9OwoKICAgIGlmICggYXJnIGluc3RhbmNlb2YgUmVnRXhwICkgewogICAgICAgIHJldHVybiBuZXcgTWF0Y2hGaWVsZCggYXJnICk7CiAgICB9OwogICAgLy8gSGFuZGxlIGJvdGggIjAwMCIgYW5kIG5ldyBTdHJpbmcoIjAwMCIpCiAgICBpZiAoIHR5cGVvZiBhcmcgPT09ICJzdHJpbmciICkgewogICAgICAgIHJldHVybiBuZXcgU3RyaW5nTWF0Y2hGaWVsZCggYXJnICk7CiAgICB9OwogICAgaWYgKCBhcmcgaW5zdGFuY2VvZiBTdHJpbmcgKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdNYXRjaEZpZWxkKCBTdHJpbmcoYXJnKSApOwogICAgfTsKCiAgICByZXR1cm4gYXJnOwp9OwoKZnVuY3Rpb24gZ2V0TWF0Y2hTdWJGaWVsZCggYXJnICkgewogICAgaWYgKCBhcmcgPT0gdW5kZWZpbmVkICkgewogICAgICAgIHJldHVybiBuZXcgTWF0Y2hTdWJGaWVsZCggKTsKICAgIH07CiAgICBpZiAoIGFyZyBpbnN0YW5jZW9mIFJlZ0V4cCApIHsKICAgICAgICByZXR1cm4gbmV3IE1hdGNoU3ViRmllbGQoIGFyZyApOwogICAgfTsKICAgIC8vIEhhbmRsZSBib3RoICIwMDAiIGFuZCBuZXcgU3RyaW5nKCIwMDAiKQogICAgaWYgKCB0eXBlb2YgYXJnID09PSAic3RyaW5nIikgewogICAgICAgIHJldHVybiBuZXcgU3RyaW5nTWF0Y2hTdWJGaWVsZCggYXJnICk7CiAgICB9OwogICAgaWYgKCBhcmcgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAgICByZXR1cm4gbmV3IFN0cmluZ01hdGNoU3ViRmllbGQoIFN0cmluZyhhcmcpICk7CiAgICB9OwoKICAgIHJldHVybiBhcmc7Cn07CgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovKiogRGVmaW5lcyBhIG1hdGNoZXIgb2JqZWN0IHRoYXQgY2FuIG1hdGNoIGEgZmllbGQuCiAqIAogKiBUaGlzIG9iamVjdCBpcyBtYWlubHkgdXNlZCB3aXRoIGZvciBpbnN0YW5jZSBSZWNvcmQuZWFjaEZpZWxkIHRvIHNwZWNpZnkgaG93IHRvIAogKiBtYXRjaCBlYWNoIGZpZWxkIHRoYXQgbmVlZHMgdG8gYmUgcHJvY2Vzc2VkLiAKICoKICogQHBhcmFtIHtSZWdFeHB9IGZpZWxkUGF0dGVybiBQYXR0ZXJuIHRvIG1hdGNoIGEgZmllbGQgbmFtZS4KICogQHBhcmFtIHtSZWdFeHB9IGluZGljYXRvclBhdHRlcm4gUGF0dGVybiB0byBtYXRjaCBhIGZpZWxkIGluZGljYXRvci4KICogQHBhcmFtIHtSZWdFeHB9IHN1YkZpZWxkUGF0dGVybiBQYXR0ZXJuIHRvIG1hdGNoIGEgc3RyaW5nIHdpdGggYWxsIHN1YiBmaWVsZCBuYW1lcyAKICogCQkgIGluIHRoZSBmaWVsZC4KICogQHBhcmFtIHtOdW1iZXJ9IG1pbiBNaW5pbXVtIG9jY3VycmVuY2Ugb2YgdGhlIGZpZWxkIHRvIGJlIG1hdGNoZWQuICAgCiAqIEBwYXJhbSB7TnVtYmVyfSBtYXggTWF4aW11bSBvY2N1cnJlbmNlIG9mIHRoZSBmaWVsZCB0byBiZSBtYXRjaGVkLiAgIAogKiBAY29uc3RydWN0b3IKICogQHNlZSBNYXJjQ2xhc3NlcwogKiBAc2VlIFJlY29yZAogKiBAc2VlIEZpZWxkCiAqIEBuYW1lIE1hdGNoRmllbGQgKi8KZnVuY3Rpb24gTWF0Y2hGaWVsZCggZmllbGRQYXR0ZXJuLCBpbmRpY2F0b3JQYXR0ZXJuLCBzdWJGaWVsZFBhdHRlcm4sIG1pbiwgbWF4ICkgewogICAgdGhpcy5maWVsZFBhdHRlcm4gPSBmaWVsZFBhdHRlcm47CiAgICB0aGlzLmluZGljYXRvclBhdHRlcm4gPSBpbmRpY2F0b3JQYXR0ZXJuOwogICAgdGhpcy5zdWJGaWVsZFBhdHRlcm4gPSBzdWJGaWVsZFBhdHRlcm47CiAgICB0aGlzLm1pbiA9IG1pbjsKICAgIHRoaXMubWF4ID0gbWF4OwogICAgaWYgKCB0aGlzLm1heCA9PT0gdW5kZWZpbmVkICkgewogICAgICAgIHRoaXMubWF4ID0gdGhpcy5taW47CiAgICB9OwoKICAgIHRoaXMubWF0Y2hDb3VudGVyID0gbmV3IE9iamVjdDsKfTsKCk1hdGNoRmllbGQucHJvdG90eXBlLm1hdGNoRmllbGQgPSBmdW5jdGlvbiggcmVjb3JkLCBmaWVsZCApIHsKICAgIGlmICggdGhpcy5maWVsZFBhdHRlcm4gIT0gdW5kZWZpbmVkICYmICF0aGlzLmZpZWxkUGF0dGVybi50ZXN0KCBmaWVsZC5uYW1lICkgKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfTsKCiAgICBpZiAoIHRoaXMuaW5kaWNhdG9yUGF0dGVybiAhPSB1bmRlZmluZWQgJiYgIXRoaXMuaW5kaWNhdG9yUGF0dGVybi50ZXN0KCBmaWVsZC5pbmRpY2F0b3IgKSApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9OwoKICAgIGlmICggdGhpcy5zdWJGaWVsZFBhdHRlcm4gIT0gdW5kZWZpbmVkICkgewogICAgICAgIHZhciBzdWJGaWVsZHMgPSAiIjsKICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBmaWVsZC5jb3VudCggKTsgaSsrICkgewogICAgICAgICAgICBzdWJGaWVsZHMgKz0gZmllbGQuc3ViZmllbGQoIGkgKS5uYW1lOwogICAgICAgIH07CgogICAgICAgIGlmICggIXRoaXMuc3ViRmllbGRQYXR0ZXJuLnRlc3QoIHN1YkZpZWxkcyApICkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfTsKICAgIH07CgogICAgdmFyIHYgPSB0aGlzLm1hdGNoQ291bnRlclsgZmllbGQubmFtZSBdOwogICAgaWYgKCB2ID09PSB1bmRlZmluZWQgKSB7CiAgICAgICAgdiA9IDA7CiAgICB9OwogICAgdisrOwogICAgdGhpcy5tYXRjaENvdW50ZXJbIGZpZWxkLm5hbWUgXSA9IHY7CgogICAgcmV0dXJuICggdGhpcy5taW4gPT09IHVuZGVmaW5lZCB8fCB0aGlzLm1pbiA8PSB2ICkgJiYgKCB0aGlzLm1heCA9PT0gdW5kZWZpbmVkIHx8IHYgPD0gdGhpcy5tYXggKTsKfTsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8qIQogICAgXGJyaWVmIAoqLwoKZnVuY3Rpb24gTWF0Y2hTdWJGaWVsZCggbmFtZVBhdHRlcm4sIHZhbHVlUGF0dGVybiApIHsKICAgIHRoaXMubmFtZVBhdHRlcm4gPSBuYW1lUGF0dGVybjsKICAgIHRoaXMudmFsdWVQYXR0ZXJuID0gdmFsdWVQYXR0ZXJuOwp9OwoKTWF0Y2hTdWJGaWVsZC5wcm90b3R5cGUubWF0Y2hTdWJGaWVsZCA9IGZ1bmN0aW9uKCBmaWVsZCwgc3ViRmllbGQgKSB7CiAgICBpZiAoIHRoaXMubmFtZVBhdHRlcm4gIT0gdW5kZWZpbmVkICkgewogICAgICAgIGlmICggIXRoaXMubmFtZVBhdHRlcm4udGVzdCggc3ViRmllbGQubmFtZSApICkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfTsKICAgIH07CgogICAgaWYgKCB0aGlzLnZhbHVlUGF0dGVybiAhPSB1bmRlZmluZWQgKSB7CiAgICAgICAgaWYgKCAhdGhpcy52YWx1ZVBhdHRlcm4udGVzdCggc3ViRmllbGQudmFsdWUgKSApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH07CiAgICB9OwoKICAgIHJldHVybiB0cnVlOwp9OwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLyohCiAgICBcYnJpZWYKKi8KCmZ1bmN0aW9uIERCQ01hdGNoRmllbGQoIGZpZWxkUGF0dGVybiwgc3ViRmllbGRQYXR0ZXJuICkgewogICAgdGhpcy5pbXBsID0gbmV3IE1hdGNoRmllbGQoIGZpZWxkUGF0dGVybiwgdW5kZWZpbmVkLCBzdWJGaWVsZFBhdHRlcm4gKTsKfTsKCkRCQ01hdGNoRmllbGQucHJvdG90eXBlLm1hdGNoRmllbGQgPSBmdW5jdGlvbiggcmVjb3JkLCBmaWVsZCApIHsKICAgIHJldHVybiB0aGlzLmltcGwubWF0Y2hGaWVsZCggcmVjb3JkLCBmaWVsZCApOwp9OwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLyohCiAgICBcYnJpZWYKKi8KCmZ1bmN0aW9uIFN0cmluZ01hdGNoRmllbGQoIGZpZWxkTmFtZSApIHsKICAgIHRoaXMuZmllbGROYW1lICA9IGZpZWxkTmFtZTsKfTsKClN0cmluZ01hdGNoRmllbGQucHJvdG90eXBlLm1hdGNoRmllbGQgPSBmdW5jdGlvbiggcmVjb3JkLCBmaWVsZCApIHsKICAgIHJldHVybiB0aGlzLmZpZWxkTmFtZSA9PT0gZmllbGQubmFtZTsKfTsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8qIQogICAgXGJyaWVmCiovCgpmdW5jdGlvbiBTdHJpbmdNYXRjaFN1YkZpZWxkKCBzdWJGaWVsZE5hbWUgKSB7CiAgICB0aGlzLnN1YkZpZWxkTmFtZSAgPSBzdWJGaWVsZE5hbWU7Cn07CgpTdHJpbmdNYXRjaFN1YkZpZWxkLnByb3RvdHlwZS5tYXRjaFN1YkZpZWxkID0gZnVuY3Rpb24oIGZpZWxkLCBzdWJGaWVsZCApIHsKICAgIHJldHVybiB0aGlzLnN1YkZpZWxkTmFtZSA9PT0gc3ViRmllbGQubmFtZTsKfTsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8qKiBEZWZpbmVzIGFuIG9iamVjdCBmb3IgbWF0Y2hpbmcgZmllbGRzIG9yIHN1YmZpZWxkcyB1c2luZyBhIG1hcC4KICoKICogVGhpcyBvYmplY3QgaXMgbWFpbmx5IHVzZWQgd2l0aCBmb3IgaW5zdGFuY2UgUmVjb3JkLmVhY2hGaWVsZE1hcCB0byBzcGVjaWZ5IGhvdyB0bwogKiBtYXRjaCBlYWNoIGZpZWxkIHRoYXQgbmVlZHMgdG8gYmUgcHJvY2Vzc2VkLgogKgogKiBAY29uc3RydWN0b3IKICogQHNlZSBNYXJjQ2xhc3NlcwogKiBAc2VlIFJlY29yZAogKiBAc2VlIEZpZWxkCiAqIEBuYW1lIE1hdGNoTWFwICovCmZ1bmN0aW9uIE1hdGNoTWFwKCkgewogICAgLy8gdGhpcy5mdW5jdGlvbnMgaXMgYSBtYXAgb2YgZmllbGQgbmFtZSB0byBhcnJheSBvZiBmdW5jdGlvbnMKICAgIHRoaXMuZnVuY3Rpb25zID0gbmV3IE9iamVjdDsKfTsKCi8qKgogKiBNYXAgb25lIG9yIG1vcmUgZmllbGQgbmFtZXMgdG8gZnVuY3Rpb25zCiAqCiAqIE9uZXcgb3IgbW9yZSBmaWVsZCBuYW1lcyBjYW4gYmUgbWFwcGVkIHRvIGEgZnVuY3Rpb24KICoKICogQHBhcmFtIHtzdHJpbmd9IGZpZWxkbmFtZSBvbmUgb3IgbW9yZSBmaWVsZCBuYW1lcyB0byBtYXAgdG8gdGhlIGdpdmVuIGZ1bmN0aW9uCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgUGF0dGVybiB0byBtYXRjaCBhIGZpZWxkIGluZGljYXRvci4KICogbWV0aG9kCiAqIEBzZWUgTWFyY0NsYXNzZXMKICogQHNlZSBSZWNvcmQKICogQHNlZSBGaWVsZAogKiBAbmFtZSBNYXRjaEZpZWxkLnB1dAogKiBAZXhhbXBsZQp2YXIgbWFwID0gbmV3IE1hdGNoTWFwKCk7Cm1hcC5wdXQoIjAwMSIsICIwMDIiLCBmdW5jdGlvbihmaWVsZCkgewogICAgLy8gSGFuZGxlIGZpZWxkIDAwMSBhbmQgMDAyCn0pOwpyZWNvcmQuZWFjaEZpZWxkTWFwKG1hcCkKICogKi8KTWF0Y2hNYXAucHJvdG90eXBlLnB1dCA9IGZ1bmN0aW9uICgpIHsKICAgIC8vIEZ1bmN0aW9uIGlzIGxhc3QgYXJndW1lbnQKICAgIHZhciBmdW5jID0gYXJndW1lbnRzW2FyZ3VtZW50cy5sZW5ndGgtMV07CiAgICB2YXIgX21hcEZ1bmN0aW9uID0gZnVuY3Rpb24odGhpc0Z1bmN0aW9ucywgZk5hbWUsIHRoZUZ1bmN0aW9uKSB7CiAgICAgICAgdmFyIGZpZWxkRnVuY3Rpb25zID0gdGhpc0Z1bmN0aW9uc1tmTmFtZV07CiAgICAgICAgaWYgKGZpZWxkRnVuY3Rpb25zID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgZmllbGRGdW5jdGlvbnMgPSBbXTsKICAgICAgICAgICAgdGhpc0Z1bmN0aW9uc1tmTmFtZV0gPSBmaWVsZEZ1bmN0aW9uczsKICAgICAgICB9CiAgICAgICAgZmllbGRGdW5jdGlvbnMucHVzaCh0aGVGdW5jdGlvbik7CiAgICB9OwogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHsKICAgICAgICB2YXIgZmllbGROYW1lID0gYXJndW1lbnRzWzBdOwogICAgICAgIF9tYXBGdW5jdGlvbih0aGlzLmZ1bmN0aW9ucywgZmllbGROYW1lLCBmdW5jKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGZpZWxkTmFtZXMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCggYXJndW1lbnRzLCAwLCBhcmd1bWVudHMubGVuZ3RoIC0gMSApOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmllbGROYW1lcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgZmllbGROYW1lID0gZmllbGROYW1lc1tpXTsKICAgICAgICAgICAgX21hcEZ1bmN0aW9uKHRoaXMuZnVuY3Rpb25zLCBmaWVsZE5hbWUsIGZ1bmMpOwogICAgICAgIH0KICAgIH0KfTsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8qIQogICAgXGJyaWVmIE9iamVjdCB0aGF0IGNhbiBtYXRjaCBmaWVsZHMgaW4gYSByZWNvcmQgYW5kIGNhbGwgYSBmdW5jdGlvbiBvbiBlYWNoIG9mIHRoZW0uICAgIAoqLwoKZnVuY3Rpb24gTWF0Y2hGdW5jKCBmdW5jTWF0Y2hlciApIHsKICAgIHRoaXMuZnVuY01hdGNoZXIgPSBmdW5jTWF0Y2hlcjsKfTsKCk1hdGNoRnVuYy5wcm90b3R5cGUubWF0Y2hGaWVsZCA9IGZ1bmN0aW9uKCByZWNvcmQsIGZpZWxkICkgewogICAgaWYgKCB0aGlzLmZ1bmNNYXRjaGVyICE9IHVuZGVmaW5lZCApIHsKICAgICAgICByZXR1cm4gdGhpcy5mdW5jTWF0Y2hlciggZmllbGQgKTsKICAgIH07CgogICAgcmV0dXJuIGZhbHNlOwp9OwoKTWF0Y2hGdW5jLnByb3RvdHlwZS5tYXRjaFN1YkZpZWxkID0gZnVuY3Rpb24oIHJlY29yZCwgZmllbGQsIHN1YkZpZWxkICkgewogICAgaWYgKCB0aGlzLmZ1bmNNYXRjaGVyICE9IHVuZGVmaW5lZCApIHsKICAgICAgICByZXR1cm4gdGhpcy5mdW5jTWF0Y2hlciggc3ViRmllbGQgKTsKICAgIH07CgogICAgcmV0dXJuIGZhbHNlOwp9Owo=", "moduleName": "MarcMatchers"}, {"javascript": "CkVYUE9SVEVEX1NZTUJPTFMgPSBbICdOb2RlVHlwZXMnIF07Cgp2YXIgTm9kZVR5cGVzID0gIHsKICAgIEVMRU1FTlRfTk9ERSA6IDEsCiAgICBBVFRSSUJVVEVfTk9ERSA6IDIsCiAgICBURVhUX05PREUgOiAzLAogICAgQ0RBVEFfU0VDVElPTl9OT0RFIDogNCwKICAgIEVOVElUWV9SRUZFUkVOQ0VfTk9ERSA6IDUsCiAgICBFTlRJVFlfTk9ERSA6IDYsCiAgICBQUk9DRVNTSU5HX0lOU1RSVUNUSU9OX05PREUgOiA3LAogICAgQ09NTUVOVF9OT0RFIDogOCwKICAgIERPQ1VNRU5UX05PREUgOiA5LAogICAgRE9DVU1FTlRfVFlQRV9OT0RFIDogMTAsCiAgICBET0NVTUVOVF9GUkFHTUVOVF9OT0RFIDogMTEsCiAgICBOT1RBVElPTl9OT0RFIDogMTIKfTs=", "moduleName": "NodeTypes"}, {"javascript": "LyoqIEBmaWxlIE1hcmNYY2hhbmdlVXRpbCBtb2R1bGUgICovDQoNCg0KRVhQT1JURURfU1lNQk9MUyA9IFsgJ01hcmNYY2hhbmdlVXRpbCcgXTsNCg0KdXNlKCAiTG9nIiApOw0KdXNlKCAiWG1sVXRpbCIgKTsNCg0KDQovKioNCiAqIE1vZHVsZSB0aGF0IGluY2x1ZGVzIGRpZmZlcmVudCBmdW5jdGlvbnMgZm9yIG1vZGlmeWluZyBtYXJjWGNoYW5nZSByZWNvcmRzDQogKg0KICogQHR5cGUge25hbWVzcGFjZX0NCiAqIEBuYW1lc3BhY2UNCiAqLw0KDQp2YXIgTWFyY1hjaGFuZ2VVdGlsID0gZnVuY3Rpb24oKSB7DQoNCiAgICAvKioNCiAgICAgKiBNZXRob2QgdGhhdCByZW1vdmVzIGFsbCBsZXR0ZXIgZmllbGRzIGxpa2UgZDA5IGFuZCBzMTAgZnJvbSBhIG1hcnhDaGFuZ2UgcmVjb3JkDQogICAgICoNCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259DQogICAgICogQHN5bnRheCBNYXJjWGNoYW5nZVV0aWwucmVtb3ZlTGV0dGVyRmllbGRzKCByZWNvcmQgKQ0KICAgICAqIEBwYXJhbSB7RG9jdW1lbnR9IHJlY29yZCB0aGUgbWFyY1hjaGFuZ2UgcmVjb3JkDQogICAgICogQGZ1bmN0aW9uDQogICAgICogQHJldHVybiB7RG9jdW1lbnR9IHRoZSBtYXJjWGNoYW5nZSByZWNvcmQgd2l0aG91dCBsZXR0ZXIgZmllbGRzDQogICAgICogQG5hbWUgTWFyY1hjaGFuZ2VVdGlsLnJlbW92ZUxldHRlckZpZWxkcw0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJlbW92ZUxldHRlckZpZWxkcyggcmVjb3JkICkgew0KDQogICAgICAgIExvZy5pbmZvKCAiRW50ZXJpbmc6IE1hcmNYY2hhbmdlVXRpbC5yZW1vdmVMZXR0ZXJGaWVsZHMgZnVuY3Rpb24iICk7DQoNCiAgICAgICAgdmFyIGVsZW1lbnRzID0gWFBhdGguc2VsZWN0KCAiL21hcmN4OmNvbGxlY3Rpb24vbWFyY3g6cmVjb3JkL21hcmN4OmRhdGFmaWVsZCIsIHJlY29yZCApOw0KDQogICAgICAgIGZvciAoIHZhciBpbmRleCA9IDA7IGluZGV4IDwgZWxlbWVudHMubGVuZ3RoOyBpbmRleCsrICkgew0KDQogICAgICAgICAgICB2YXIgY2hpbGQgPSBlbGVtZW50c1sgaW5kZXggXTsNCg0KICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IFhQYXRoLnNlbGVjdE5vZGUoICJAdGFnIiwgY2hpbGQgKTsNCiAgICAgICAgICAgIGlmICggYXR0cmlidXRlLnZhbHVlLm1hdGNoKCAvW2Etel0vaSApICkgew0KICAgICAgICAgICAgICAgIFhtbFV0aWwuZGVsZXRlTm9kZSggY2hpbGQgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIExvZy5pbmZvKCAiTGVhdmluZzogTWFyY1hjaGFuZ2VVdGlsLnJlbW92ZUxldHRlckZpZWxkcyBmdW5jdGlvbiIgKTsNCiAgICAgICAgcmV0dXJuIHJlY29yZDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBNZXRob2QgdGhhdCBjaGFuZ2VzIHRoZSB2YWx1ZSBvZiAwMDFiIGluIGFsbCBtYXJjeDpyZWNvcmRzIGluIGEgbWFyY3g6Y29sbGVjdGlvbg0KICAgICAqDQogICAgICogQHR5cGUge2Z1bmN0aW9ufQ0KICAgICAqIEBzeW50YXggTWFyY1hjaGFuZ2VVdGlsLmNoYW5nZTAwMWJWYWx1ZSggcmVjb3JkQ29sbGVjdGlvbiApDQogICAgICogQHBhcmFtIHtEb2N1bWVudH0gcmVjb3JkQ29sbGVjdGlvbiB0aGUgbWFyY1hjaGFuZ2UgcmVjb3JkIGNvbGxlY3Rpb24NCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmV3MDAxYlZhbHVlIHRoZSBuZXcgMDAxYiB2YWx1ZQ0KICAgICAqIEBmdW5jdGlvbg0KICAgICAqIEByZXR1cm4ge0RvY3VtZW50fSB0aGUgbWFyY1hjaGFuZ2UgcmVjb3JkIGNvbGxlY3Rpb24gd2l0aCBjb3JyZWN0ZWQgdmFsdWUgaW4gYWxsIDAwMWIgZmllbGRzDQogICAgICogQG5hbWUgTWFyY1hjaGFuZ2VVdGlsLmNoYW5nZTAwMWJWYWx1ZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNoYW5nZTAwMWJWYWx1ZSggcmVjb3JkQ29sbGVjdGlvbiwgbmV3MDAxYlZhbHVlICkgew0KDQogICAgICAgIExvZy5pbmZvKCAiRW50ZXJpbmc6IE1hcmNYY2hhbmdlVXRpbC5jaGFuZ2UwMDFiVmFsdWUgZnVuY3Rpb24iICk7DQoNCiAgICAgICAgdmFyIGZpZWxkczAwMWIgPSBYUGF0aC5zZWxlY3QoICIvbWFyY3g6Y29sbGVjdGlvbi9tYXJjeDpyZWNvcmQvbWFyY3g6ZGF0YWZpZWxkW0B0YWc9JzAwMSddL21hcmN4OnN1YmZpZWxkW0Bjb2RlPSdiJ10iLCByZWNvcmRDb2xsZWN0aW9uICk7DQoNCiAgICAgICAgZm9yICggdmFyIGluZGV4ID0gMDsgaW5kZXggPCBmaWVsZHMwMDFiLmxlbmd0aDsgaW5kZXgrKyApIHsNCiAgICAgICAgICAgIHZhciBjaGlsZCA9IGZpZWxkczAwMWJbIGluZGV4IF07DQogICAgICAgICAgICBYbWxVdGlsLmFwcGVuZFRleHQoIGNoaWxkLCBTdHJpbmcoIG5ldzAwMWJWYWx1ZSApLCB0cnVlICk7DQogICAgICAgIH0NCg0KICAgICAgICBMb2cuaW5mbyggIkxlYXZpbmc6IE1hcmNYY2hhbmdlVXRpbC5jaGFuZ2UwMDFiVmFsdWUgZnVuY3Rpb24iICk7DQogICAgICAgIHJldHVybiByZWNvcmRDb2xsZWN0aW9uOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIE1ldGhvZCB0aGF0IHJlbW92ZXMgdW53YW50ZWQgYXN0ZXJpc2tzIGZyb20gZmllbGQgMDE1LCAwMTYsIDA4MiwgMDgzIGFuZCAyNDUNCiAgICAgKg0KICAgICAqIEB0eXBlIHtmdW5jdGlvbn0NCiAgICAgKiBAc3ludGF4IE1hcmNYY2hhbmdlVXRpbC5yZW1vdmVBc3Rlcmlza3MoIHhtbFJlY29yZCApDQogICAgICogQHBhcmFtIHtEb2N1bWVudH0geG1sUmVjb3JkIFRoZSBvcmlnaW5hbCBkYXRhIHRoYXQgbmVlZHMgbm9ybWFsaXphdGlvbg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbmFtZXNwYWNlXSBUaGUgbmFtZXNwYWNlIG9mIHRoZSBtYXJjIHhtbCByZWNvcmQgLSBkZWZhdWx0IGlzIG14IG1hcmMyMSBzbGltDQogICAgICogQGZ1bmN0aW9uDQogICAgICogQG5hbWUgTWFyY1hjaGFuZ2VVdGlsLnJlbW92ZUFzdGVyaXNrcw0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJlbW92ZUFzdGVyaXNrcyggeG1sUmVjb3JkLCBuYW1lc3BhY2UgKSB7DQoNCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmcgTWFyY1hjaGFuZ2VVdGlsLnJlbW92ZUFzdGVyaXNrcyIgKTsNCiAgICAgICAgaWYgKCB1bmRlZmluZWQgPT09IG5hbWVzcGFjZSApIHsNCiAgICAgICAgICAgIG5hbWVzcGFjZSA9ICJteCI7DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgZmllbGROYW1lQXJyYXkgPSBbICIwMTUiLCAiMDE2IiwgIjA4MiIsICIwODMiLCAiMjQ1IiBdOw0KICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBmaWVsZE5hbWVBcnJheS5sZW5ndGg7IGkrKyApIHsNCiAgICAgICAgICAgIHZhciBwYXRoID0gIi8iICsgbmFtZXNwYWNlICsgIjpyZWNvcmQvIiArIG5hbWVzcGFjZSArICI6ZGF0YWZpZWxkWyBAdGFnPSIgKyBmaWVsZE5hbWVBcnJheVsgaSBdICsgIiBdLyIgKyBuYW1lc3BhY2UgKyAiOnN1YmZpZWxkIjsNCiAgICAgICAgICAgIHZhciBlbGVtZW50cyA9IFhQYXRoLnNlbGVjdCggcGF0aCwgeG1sUmVjb3JkICk7DQogICAgICAgICAgICBmb3IgKCB2YXIgaiA9IDA7IGogPCBlbGVtZW50cy5sZW5ndGg7IGorKyApIHsNCiAgICAgICAgICAgICAgICB2YXIgaW5wdXRUZXh0ID0gWG1sVXRpbC5nZXRUZXh0KCBlbGVtZW50c1sgaiBdICk7DQogICAgICAgICAgICAgICAgZWxlbWVudHNbIGogXS5maXJzdENoaWxkLm5vZGVWYWx1ZSA9IGlucHV0VGV4dC5yZXBsYWNlKCAvXCpcKlwqL2csICIiICkucmVwbGFjZSggLyAgL2csICIgIik7DQogICAgICAgICAgICAgICAgdmFyIG5ld1RleHQgPSBYbWxVdGlsLmdldFRleHQoIGVsZW1lbnRzWyBqIF0gKTsNCiAgICAgICAgICAgICAgICBMb2cuZGVidWcoICJDaGFuZ2VkIHN1YmZpZWxkIHZhbHVlIGZyb20gJyIsIGlucHV0VGV4dCwgIicgdG8gJyIsIG5ld1RleHQsICInLiIgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmcgTWFyY1hjaGFuZ2VVdGlsLnJlbW92ZUFzdGVyaXNrcyIgKTsNCg0KICAgIH0NCg0KICAgIHJldHVybiB7DQogICAgICAgIHJlbW92ZUxldHRlckZpZWxkczogcmVtb3ZlTGV0dGVyRmllbGRzLA0KICAgICAgICBjaGFuZ2UwMDFiVmFsdWU6IGNoYW5nZTAwMWJWYWx1ZSwNCiAgICAgICAgcmVtb3ZlQXN0ZXJpc2tzOiByZW1vdmVBc3Rlcmlza3MNCiAgICB9Ow0KDQoNCn0oKTsNCg0KLy9Vbml0dGVzdHMgYXJlIGluIE1hcmNYY2hhbmdlVXRpbC50ZXN0LmpzDQo=", "moduleName": "MarcXchangeUtil"}, {"javascript": "LyoqIEBmaWxlIE1vZHVsZSB0aGF0IGFkZHMgc3VwcG9ydCBmb3IgeG1sIGNvbnZlcnNpb25zIG9mIFJlY29yZCBvYmplY3RzLiAqLwoKLy8gT25seSB2ZXJ5IGxpbWl0ZWQgaW50ZXJuYWwgZXJyb3IgY2hlY2tpbmcgaXMgcGVyZm9ybWVkLiBCYXNpY2FsbHksIGl0IGlzCi8vIGFzc3VtZWQsIHRoYXQgdGhlIFhNTCBpbnB1dCBpcyBsZWdhbC4gSWYgbm90LCB3ZWlyZCByZXN1bHRzIG1heSBvY2N1ci4KCnVzZSggIlhtbE5hbWVzcGFjZXMiICk7IC8vIFByb3ZpZGVzIFhNTCBuYW1lc3BhY2VzCnVzZSggIlhtbFV0aWwiICk7IC8vIFByb3ZpZGVzIFhNTCBjcmVhdGlvbiBmdW5jdGlvbnMKdXNlKCAiTWFyY0NsYXNzZXMiICk7IC8vIE5lZWQgdGhlIGJhc2ljIHJlY29yZCBjbGFzc2VzLgp1c2UoICJNYXJjIiApOyAvLyBUaGlzIG1vZHVsZSB1c2VzIHRoZSBlYWNoRmllbGQgbWV0aG9kIGZyb20gTWFyYwp1c2UoICJVdGlsIiApOyAvLyBGb3IgZ2V0VHlwZSBzdXBwb3J0CgpFWFBPUlRFRF9TWU1CT0xTID0gWyAiTWFyY1hjaGFuZ2UiIF07CgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKLyoqCiAqIE1vZHVsZSB0byBoYW5kbGUgY29udmVyc2lvbiBmcm9tIGEgbWFyYyByZWNvcmQgcmVwcmVzZW50ZWQgYXMgTWFyY1hjaGFuZ2UgWE1MIHRvIGEKICogSmF2YXNjcmlwdCBNYXJjIFJlY29yZCBPYmplY3QgKGFzIGRlZmluZWQgaW4gdGhlIE1hcmNDbGFzc2VzIG1vZHVsZSkgb3IgdGhlIG90aGVyIHdheSBhcm91bmQuCiAqCiAqIFRoZSBtb2R1bGUgY29udGFpbnMgdHdvIG1ldGhvZHMgbWFyY1hjaGFuZ2VUb01hcmNSZWNvcmQgYW5kIG1hcmNSZWNvcmRUb01hcmNYY2hhbmdlLgogKgogKiBAdHlwZSB7bmFtZXNwYWNlfQogKiBAbmFtZSBNYXJjWGNoYW5nZQogKiBAc2VlIE1hcmNDbGFzc2VzCiAqIEBuYW1lc3BhY2UgKi8KdmFyIE1hcmNYY2hhbmdlID0gZnVuY3Rpb24oKSB7CgogICAgTG9nLmluZm8oICJFbnRlcmluZyBNYXJjWGNoYW5nZSBtb2R1bGUiICk7CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgTWFyY1hjaGFuZ2UgWE1MIHN0cmluZyBvciBvYmplY3QgdG8gYSBKYXZhc2NyaXB0IE1hcmMgUmVjb3JkIE9iamVjdC4KICAgICAqCiAgICAgKiBUaGlzIGZ1bmN0aW9uIHRha2UgYSBzdHJpbmcgd2l0aCBhbiBNYXJjWENoYW5nZSBYTUwgb2JqZWN0LCBhbmQgY29udmVydHMgaXQgdG8gYSBSZWNvcmQgb2JqZWN0LgogICAgICoKICAgICAqICoqTm90ZToqKiBUaGlzIGZ1bmN0aW9uIGF0IHRoZSBtb21lbnQgb25seSBoYW5kbGVzIGlucHV0IGZyb20gZGFuTUFSQzIgcmVjb3JkcyByZXByZXNlbnRlZCBhcwogICAgICogTWFyY1hjaGFuZ2UuIElmIGEgbWFyYzIxIE1hcmNYY2hhbmdlIHJlY29yZCBpcyBwYXNzZWQgdG8gdGhlIGZ1bmN0aW9uLCBjb250cm9sIGZpZWxkcyBhbmQgdGhlIGluZm9ybWF0aW9uCiAgICAgKiBmcm9tIHRoZSBsZWFkZXIgd2lsbCBub3QgYmUgcmVwcmVzZW50ZWQgaW4gdGhlIG91dHB1dCBSZWNvcmQgb2JqZWN0CiAgICAgKiB1c2UgbWFyY1hjaGFuZ2VNMjFUb01hcmNSZWNvcmQgdG8gZG8gdGhpcwogICAgICoKICAgICAqIEB0eXBlIHttZXRob2R9CiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBzeW50YXggTWFyY1hjaGFuZ2UubWFyY1hjaGFuZ2VUb01hcmNSZWNvcmQoIHhtbCApCiAgICAgKiBAcGFyYW0ge3N0cmluZ3xYTUx8dW5kZWZpbmVkfSB4bWwgU3RyaW5nIG9yIFhNTCByZXByZXNlbnRhdGlvbiBvZiBhbiBtYXJjWGNoYW5nZSByZWNvcmQKICAgICAqIEByZXR1cm4ge1JlY29yZH0gSmF2YVNjcmlwdCBNYXJjIE9iamVjdAogICAgICogQHNlZSBSZWNvcmQKICAgICAqIEBleGFtcGxlCiAgICAgKiB4bWwgPSAnPG1hcmN4OnJlY29yZCBmb3JtYXQ9ImRhbk1BUkMyIiB0eXBlPSJCaWJsaW9ncmFwaGljIiB4bWxuczptYXJjeD0iaW5mbzpsYy94bWxucy9tYXJjeGNoYW5nZS12MSI+JysKICAgICAqICc8bWFyY3g6bGVhZGVyPjAwMDAwbiAgICAyMjAwMDAwICAgNDUwMDwvbWFyY3g6bGVhZGVyPicrCiAgICAgKiAnPG1hcmN4OmRhdGFmaWVsZCB0YWc9IjAwMSIgaW5kMT0iMCIgaW5kMj0iMCI+PG1hcmN4OnN1YmZpZWxkIGNvZGU9ImEiPjAgMzk3IDk0MCA3PC9tYXJjeDpzdWJmaWVsZD48bWFyY3g6c3ViZmllbGQgY29kZT0iYiI+ODcwOTcwPC9tYXJjeDpzdWJmaWVsZD48bWFyY3g6c3ViZmllbGQgY29kZT0iYyI+MTk4NTAzMjk8L21hcmN4OnN1YmZpZWxkPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJkIj4xOTg1MDMyOTwvbWFyY3g6c3ViZmllbGQ+PG1hcmN4OnN1YmZpZWxkIGNvZGU9ImYiPmE8L21hcmN4OnN1YmZpZWxkPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJvIj5jPC9tYXJjeDpzdWJmaWVsZD48L21hcmN4OmRhdGFmaWVsZD4nKwogICAgICogJzxtYXJjeDpkYXRhZmllbGQgdGFnPSIwMDQiIGluZDE9IjAiIGluZDI9IjAiPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJyIj5uPC9tYXJjeDpzdWJmaWVsZD48bWFyY3g6c3ViZmllbGQgY29kZT0iYSI+ZTwvbWFyY3g6c3ViZmllbGQ+PC9tYXJjeDpkYXRhZmllbGQ+JysKICAgICAqICc8bWFyY3g6ZGF0YWZpZWxkIHRhZz0iMDA4IiBpbmQxPSIwIiBpbmQyPSIwIj48bWFyY3g6c3ViZmllbGQgY29kZT0idCI+czwvbWFyY3g6c3ViZmllbGQ+PG1hcmN4OnN1YmZpZWxkIGNvZGU9InUiPnU8L21hcmN4OnN1YmZpZWxkPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJhIj4xOTY4PC9tYXJjeDpzdWJmaWVsZD48bWFyY3g6c3ViZmllbGQgY29kZT0iYiI+ZGs8L21hcmN4OnN1YmZpZWxkPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJqIj5wPC9tYXJjeDpzdWJmaWVsZD48bWFyY3g6c3ViZmllbGQgY29kZT0ibCI+ZGFuPC9tYXJjeDpzdWJmaWVsZD48bWFyY3g6c3ViZmllbGQgY29kZT0idiI+MTwvbWFyY3g6c3ViZmllbGQ+PC9tYXJjeDpkYXRhZmllbGQ+JysKICAgICAqICc8bWFyY3g6ZGF0YWZpZWxkIHRhZz0iMDA5IiBpbmQxPSIwIiBpbmQyPSIwIj48bWFyY3g6c3ViZmllbGQgY29kZT0iYSI+YTwvbWFyY3g6c3ViZmllbGQ+PG1hcmN4OnN1YmZpZWxkIGNvZGU9ImciPnh4PC9tYXJjeDpzdWJmaWVsZD48L21hcmN4OmRhdGFmaWVsZD4nKwogICAgICogJzxtYXJjeDpkYXRhZmllbGQgdGFnPSIwMzIiIGluZDE9IjAiIGluZDI9IjAiPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJ4Ij5TRkQxOTcwNzU8L21hcmN4OnN1YmZpZWxkPjwvbWFyY3g6ZGF0YWZpZWxkPicrCiAgICAgKiAnPG1hcmN4OmRhdGFmaWVsZCB0YWc9IjEwMCIgaW5kMT0iMCIgaW5kMj0iMCI+PG1hcmN4OnN1YmZpZWxkIGNvZGU9ImEiPkJyb2J5LUpvaGFuc2VuPC9tYXJjeDpzdWJmaWVsZD48bWFyY3g6c3ViZmllbGQgY29kZT0iaCI+Ui48L21hcmN4OnN1YmZpZWxkPjwvbWFyY3g6ZGF0YWZpZWxkPicrJzxtYXJjeDpkYXRhZmllbGQgdGFnPSIyNDUiIGluZDE9IjAiIGluZDI9IjAiPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJhIj5CbG9kPC9tYXJjeDpzdWJmaWVsZD48L21hcmN4OmRhdGFmaWVsZD4nKwogICAgICogJzxtYXJjeDpkYXRhZmllbGQgdGFnPSIyNTAiIGluZDE9IjAiIGluZDI9IjAiPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJhIj4yLiB1ZGdhdmU8L21hcmN4OnN1YmZpZWxkPjwvbWFyY3g6ZGF0YWZpZWxkPicrCiAgICAgKiAnPG1hcmN4OmRhdGFmaWVsZCB0YWc9IjI2MCIgaW5kMT0iMCIgaW5kMj0iMCI+PG1hcmN4OnN1YmZpZWxkIGNvZGU9ImIiPkd5bGRlbmRhbDwvbWFyY3g6c3ViZmllbGQ+PG1hcmN4OnN1YmZpZWxkIGNvZGU9ImMiPjE5Njg8L21hcmN4OnN1YmZpZWxkPjwvbWFyY3g6ZGF0YWZpZWxkPicrCiAgICAgKiAnPG1hcmN4OmRhdGFmaWVsZCB0YWc9IjQ0MCIgaW5kMT0iMCIgaW5kMj0iMCI+PG1hcmN4OnN1YmZpZWxkIGNvZGU9ImEiPkd5bGRlbmRhbHMgc3BcdTAwZTZ0dGViXHUwMGY4Z2VyPC9tYXJjeDpzdWJmaWVsZD48bWFyY3g6c3ViZmllbGQgY29kZT0idiI+NDE8L21hcmN4OnN1YmZpZWxkPjwvbWFyY3g6ZGF0YWZpZWxkPicrCiAgICAgKiAnPG1hcmN4OmRhdGFmaWVsZCB0YWc9IjUwNSIgaW5kMT0iMCIgaW5kMj0iMCI+PG1hcmN4OnN1YmZpZWxkIGNvZGU9ImEiPkRpZ3RlPC9tYXJjeDpzdWJmaWVsZD48L21hcmN4OmRhdGFmaWVsZD4nKwogICAgICogJzxtYXJjeDpkYXRhZmllbGQgdGFnPSI1MjAiIGluZDE9IjAiIGluZDI9IjAiPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJhIj5PcmlnaW5hbHVkZ2F2ZSAxOTIyPC9tYXJjeDpzdWJmaWVsZD48L21hcmN4OmRhdGFmaWVsZD4nKwogICAgICogJzxtYXJjeDpkYXRhZmllbGQgdGFnPSI2NTIiIGluZDE9IjAiIGluZDI9IjAiPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJtIj5zazwvbWFyY3g6c3ViZmllbGQ+PC9tYXJjeDpkYXRhZmllbGQ+JysKICAgICAqICc8bWFyY3g6ZGF0YWZpZWxkIHRhZz0iOTAwIiBpbmQxPSIwIiBpbmQyPSIwIj48bWFyY3g6c3ViZmllbGQgY29kZT0iYSI+Sm9oYW5zZW48L21hcmN4OnN1YmZpZWxkPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJoIj5SLiBCcm9ieS08L21hcmN4OnN1YmZpZWxkPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJ6Ij4xMDA8L21hcmN4OnN1YmZpZWxkPjwvbWFyY3g6ZGF0YWZpZWxkPicrCiAgICAgKiAnPG1hcmN4OmRhdGFmaWVsZCB0YWc9InMxMCIgaW5kMT0iMCIgaW5kMj0iMCI+PG1hcmN4OnN1YmZpZWxkIGNvZGU9ImEiPkRCQzwvbWFyY3g6c3ViZmllbGQ+PC9tYXJjeDpkYXRhZmllbGQ+PC9tYXJjeDpyZWNvcmQ+JwogICAgIC8vIENyZWF0ZSBhIE1hcmMgUmVjb3JkIG9iamVjdCBmcm9tIGFuIHhtbCBNYXJjWENoYW5nZSBzdHJpbmcuCiAgICAgTWFyY1hjaGFuZ2UubWFyY1hjaGFuZ2VUb01hcmNSZWNvcmQoIHhtbCApCiAgICAgKiBAbmFtZSBNYXJjWGNoYW5nZS5tYXJjWGNoYW5nZVRvTWFyY1JlY29yZAogICAgICoqLwogICAgZnVuY3Rpb24gbWFyY1hjaGFuZ2VUb01hcmNSZWNvcmQoIHhtbCApIHsKCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmcgTWFyY1hjaGFuZ2UubWFyY1hjaGFuZ2VUb01hcmNSZWNvcmQiICk7CgogICAgICAgIC8vQ2hlY2tpbmcgdHlwZSBhbmQgZm9ybWF0IHN0cnVjdHVyZQogICAgICAgIHZhciByZWNvcmQgPSBuZXcgUmVjb3JkKCk7CgogICAgICAgIGlmICggVXRpbC5nZXRUeXBlKCB4bWwgKSA9PT0gJ0FycmF5JyApIHsKICAgICAgICAgICAgTG9nLmVycm9yKCAiTWFyY1hjaGFuZ2UubWFyY1hjaGFuZ2VUb01hcmNSZWNvcmQgY2FsbGVkIHdpdGggQXJyYXkgdHlwZS4iICk7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvciggIk1hcmNYY2hhbmdlLm1hcmNYY2hhbmdlVG9NYXJjUmVjb3JkIGNhbGxlZCB3aXRoIEFycmF5IHR5cGUuIiApOwogICAgICAgIH0gZWxzZSBpZiAoIHhtbCA9PT0gdW5kZWZpbmVkIHx8IHhtbCA9PT0gIiIgKSB7CiAgICAgICAgICAgIExvZy5lcnJvciggIk1hcmNYY2hhbmdlLm1hcmNYY2hhbmdlVG9NYXJjUmVjb3JkIGNhbGxlZCB3aXRoIGVtcHR5IHN0cmluZyIgKTsKICAgICAgICAgICAgcmV0dXJuIHJlY29yZDsKICAgICAgICB9IGVsc2UgaWYgKCBVdGlsLmdldFR5cGUoIHhtbCApID09PSAnc3RyaW5nJyApIHsKICAgICAgICAgICAgeG1sID0gWG1sVXRpbC5mcm9tU3RyaW5nKCB4bWwgKTsKICAgICAgICB9CgogICAgICAgIHZhciByb290OwogICAgICAgIGlmICggWG1sVXRpbC5pc0RvY3VtZW50KCB4bWwgKSApIHsKICAgICAgICAgICAgcm9vdCA9IHhtbC5kb2N1bWVudEVsZW1lbnQ7CiAgICAgICAgfSBlbHNlIGlmICggWG1sVXRpbC5pc0VsZW1lbnQoIHhtbCApICkgewogICAgICAgICAgICByb290ID0geG1sOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJvb3QgPSBYbWxVdGlsLmZyb21TdHJpbmcoIHhtbCApLmRvY3VtZW50RWxlbWVudDsKICAgICAgICB9CgogICAgICAgIExvZy5kZWJ1ZyggIk1hcmNYY2hhbmdlLm1hcmNYY2hhbmdlVG9NYXJjUmVjb3JkLCB4bWw6ICIsIFhtbFV0aWwubG9nWG1sU3RyaW5nKCByb290ICkgKTsKCiAgICAgICAgLy9DaGVja2luZyBuYW1lc3BhY2VzCiAgICAgICAgdmFyIGFjY2VwdGVkTmFtZXNwYWNlVVJJcyA9IFsgWG1sTmFtZXNwYWNlcy5tYXJjeC51cmksIFhtbE5hbWVzcGFjZXMubXgudXJpIF07CiAgICAgICAgaWYgKCAwID4gYWNjZXB0ZWROYW1lc3BhY2VVUklzLmluZGV4T2YoIFN0cmluZyggcm9vdC5uYW1lc3BhY2VVUkkgKSApICkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoICdJbnZhbGlkIG5hbWVzcGFjZSB1cmk6JyArIHJvb3QubmFtZXNwYWNlVVJJICsgJyBpbiAnICsgWG1sVXRpbC50b1htbFN0cmluZyggcm9vdCApICk7CiAgICAgICAgfQogICAgICAgIHZhciByZWMgPSBuZXcgUmVjb3JkKCk7CiAgICAgICAgdmFyIGNobGQgPSByb290LmZpcnN0Q2hpbGQ7CiAgICAgICAgd2hpbGUgKCBjaGxkICE9PSBudWxsICkgewogICAgICAgICAgICBpZiAoIFhtbFV0aWwuaXNFbGVtZW50KCBjaGxkICkgKSB7CiAgICAgICAgICAgICAgICBpZiAoIDAgPiBhY2NlcHRlZE5hbWVzcGFjZVVSSXMuaW5kZXhPZiggU3RyaW5nKCBjaGxkLm5hbWVzcGFjZVVSSSApICkgKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCAnSW52YWxpZCBuYW1lc3BhY2UgdXJpOiAnICsgY2hsZC5uYW1lc3BhY2VVUkkgKyAnIGluICcgKyBYbWxVdGlsLnRvWG1sU3RyaW5nKCBjaGxkICkgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBuYW1lID0gY2hsZC5sb2NhbE5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIGlmICggbmFtZSA9PT0gJ2xlYWRlcicgKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGxlYWRlckNvbnRlbnQgPSBjaGxkLnRleHRDb250ZW50OwogICAgICAgICAgICAgICAgICAgIExvZy5kZWJ1ZyggIkxlYWRlciBmcm9tIGlucHV0IHJlY29yZDogIiwgbGVhZGVyQ29udGVudCApOwogICAgICAgICAgICAgICAgICAgIC8vbiwgYywgYW5kIGQgaXMgdXNlZCAtIG5vdCBhIGFuZCBwICh3aGljaCBtZWFucyAiaW5jcmVhc2UgaW4gZW5jb2RpbmcgbGV2ZWwiCiAgICAgICAgICAgICAgICAgICAgLy8gYW5kIGlzIHRoZXJlZm9yZSB0cmFuc2xhdGVkIHRvIGMpCiAgICAgICAgICAgICAgICAgICAgdmFyIG0yMVJlY29yZFN0YXR1cyA9IGxlYWRlckNvbnRlbnQuc2xpY2UoIDUsIDYgKSAgIC8vVG9kbzogd2h5IGlzIHRoaXMgbTIxUmVjb3JkU3RhdHVzPwogICAgICAgICAgICAgICAgICAgIGlmICggbTIxUmVjb3JkU3RhdHVzLm1hdGNoKCAvW25jZF0vICkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYy5yZWNvcmRTdGF0dXMgPSBtMjFSZWNvcmRTdGF0dXM7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVjLnJlY29yZFN0YXR1cyA9ICJjIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVjLmltcGxlbWVudGF0aW9uQ29kZXMgPSBsZWFkZXJDb250ZW50LnNsaWNlKCA2LCAxMCApOwogICAgICAgICAgICAgICAgICAgIHJlYy5mb3JVc2VyU3lzdGVtcyA9IGxlYWRlckNvbnRlbnQuc2xpY2UoIDE3LCAyMCApOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICggbmFtZSA9PT0gJ2NvbnRyb2xmaWVsZCcgKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZpZWxkID0gbmV3IEZpZWxkKCk7CiAgICAgICAgICAgICAgICAgICAgZmllbGQubmFtZSA9IGNobGQuZ2V0QXR0cmlidXRlKCAndGFnJyApOwogICAgICAgICAgICAgICAgICAgIGZpZWxkLnZhbHVlID0gY2hsZC50ZXh0Q29udGVudDsKICAgICAgICAgICAgICAgICAgICByZWMuYXBwZW5kKCBmaWVsZCApOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICggbmFtZSA9PT0gJ2RhdGFmaWVsZCcgKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZpZWxkID0gbmV3IEZpZWxkKCk7CiAgICAgICAgICAgICAgICAgICAgZmllbGQubmFtZSA9IGNobGQuZ2V0QXR0cmlidXRlKCAndGFnJyApOwogICAgICAgICAgICAgICAgICAgIGZpZWxkLmluZGljYXRvciA9IGNobGQuZ2V0QXR0cmlidXRlKCAnaW5kMScgKSArIGNobGQuZ2V0QXR0cmlidXRlKCAnaW5kMicgKTsKICAgICAgICAgICAgICAgICAgICB2YXIgc3ViID0gY2hsZC5maXJzdENoaWxkOwogICAgICAgICAgICAgICAgICAgIHdoaWxlICggc3ViICE9PSBudWxsICkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIFhtbFV0aWwuaXNFbGVtZW50KCBzdWIgKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggMCA+IGFjY2VwdGVkTmFtZXNwYWNlVVJJcy5pbmRleE9mKCBTdHJpbmcoIHN1Yi5uYW1lc3BhY2VVUkkgKSApICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvciggJ0ludmFsaWQgbmFtZXNwYWNlIHVyaTonICsgc3ViICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3ViTmFtZSA9IHN1Yi5sb2NhbE5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggc3ViTmFtZSA9PT0gJ3N1YmZpZWxkJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3ViRmllbGQgPSBuZXcgU3ViZmllbGQoIHN1Yi5nZXRBdHRyaWJ1dGUoICdjb2RlJyApLCBzdWIudGV4dENvbnRlbnQgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZC5hcHBlbmQoIHN1YkZpZWxkICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgc3ViID0gc3ViLm5leHRTaWJsaW5nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZWMuYXBwZW5kKCBmaWVsZCApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNobGQgPSBjaGxkLm5leHRTaWJsaW5nOwogICAgICAgIH0KICAgICAgICBMb2cuZGVidWcoICJNYXJjIHJlY29yZCBpczogIiwgcmVjLCAiIHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOiAiLCBKU09OLnN0cmluZ2lmeSggcmVjICkgKTsKICAgICAgICByZXR1cm4gcmVjOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCBhIEphdmFzY3JpcHQgTWFyYyBSZWNvcmQgT2JqZWN0IHRvIGEgTWFyY1hjaGFuZ2UgWE1MIG9iamVjdC4KICAgICAqCiAgICAgKiBUaGlzIGZ1bmN0aW9uIGNyZWF0ZXMgYW4gWE1MIG9iamVjdCBpbiBNYXJjWENoYW5nZSBmb3JtYXQsCiAgICAgKiByZXByZXNlbnRpbmcgdGhlIFJlY29yZCBvYmplY3QgcGFzc2VkIHRvIGl0LgogICAgICoKICAgICAqIFRoZSBmb3JtYXQgcGFyYW1ldGVyIGNvbnRyb2xzIGlmIHRoZSBnZW5lcmF0ZWQgTWFyY1hDaGFuZ2UgWE1MCiAgICAgKiByZWZsZWN0cyBhIG5vcm1hbCBEYW5tYXJjMiByZWNvcmQsIG9yIGFuIE1BUkMyMSByZWNvcmQuIFRoaXMKICAgICAqIGluZmx1ZW5jZXMgdGhlIG5hbWVzcGFjZSBvZiB0aGUgWE1MLCBhbmQgaXMgYWxzbyBzZXQgaW4gdGhlCiAgICAgKiBgZm9ybWF0YCBhdHRyaWJ1dGUgb2YgdGhlIHJlc3VsdGluZyBYTUwuCiAgICAgKgogICAgICogVGhlIHR5cGUgcGFyYW1ldGVyIGNvbnRhaW5zIGluZm9ybWF0aW9uIGFib3V0IHRoZSBsZXZlbCBvZiB0aGUgcmVjb3JkCiAgICAgKiB3aGljaCBpcyBzcGVjaWZpY2FsbHkgcmVsZXZhbnQgZm9yIGRhbk1BUkMyIHJlY29yZHMgYXMgYSByZWNvcmQgY2FuIGVpdGhlciBiZQogICAgICogYSBtYWluLCBzZWN0aW9uIG9yIHZvbHVtZSBkZXNjcmlwdGlvbiBvZiBhIHJlY29yZC4KICAgICAqIFRoZSBwb3NzaWJsZSBpbnB1dCBmb3IgdGhlIHR5cGUgcGFyYW1ldGVyIGFyZToKICAgICAqCiAgICAgKiAqICJCaWJsaW9ncmFwaGljIiAoc2luZ2xlIHJlY29yZCBvciBhIG1lcmdlZCB2ZXJzaW9uIG9mIGEgbWFpbitzZWN0aW9uK3ZvbHVtZSByZWNvcmQpCiAgICAgKiAqICJCaWJsaW9ncmFwaGljTWFpbiIgKG1haW4gcmVjb3JkKQogICAgICogKiAiQmlibGlvZ3JhcGhpY1NlY3Rpb24iIChzZWN0aW9uIHJlY29yZCkKICAgICAqICogIkJpYmxpb2dyYXBoaWNWb2x1bWUiICh2b2x1bWUgcmVjb3JkKQogICAgICoKICAgICAqIEB0eXBlIHttZXRob2R9CiAgICAgKiBAbWV0aG9kCiAgICAgKiBAc2VlIFJlY29yZAogICAgICogQHN5bnRheCBNYXJjWGNoYW5nZS5tYXJjUmVjb3JkVG9NYXJjWGNoYW5nZSggcmVjb3JkLCBmb3JtYXQsIHR5cGUgKQogICAgICogQHBhcmFtIHtSZWNvcmR9IHJlY29yZCBBIG1hcmMgcmVjb3JkIG9iamVjdAogICAgICogQHBhcmFtIHtzdHJpbmd9IGZvcm1hdCBtYXJjWGNoYW5nZSBmb3JtYXQgb2YgdGhlIHJlY29yZCwgZWl0aGVyICJNQVJDMjEiIG9yICJkYW5NQVJDMiIuCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZSBtYXJjWGNoYW5nZSB0eXBlIG9mIHRoZSByZWNvcmQsIGVpdGhlciAiQmlibGlvZ3JhcGhpYyIsICJCaWJsaW9ncmFwaGljTWFpbiIsICJCaWJsaW9ncmFwaGljU2VjdGlvbiIgb3IgIkJpYmxpb2dyYXBoaWNWb2x1bWUiLgogICAgICogQHJldHVybiB7WE1MfSBBbiBYTUwgb2JqZWN0IGNvbnRhaW5pbmcgYSBtYXJjWGNoYW5nZSByZWNvcmQKICAgICAqIEBleGFtcGxlCiAgICAgLy8gQ29udmVydCBhbiBNYXJjIGNsYXNzZXMgcmVjb3JkIGluc3RhbmNlIHRvIGFuIFhNTCBpbnN0YW5jZS4KICAgICB2YXIgeCA9IE1hcmNYY2hhbmdlLm1hcmNSZWNvcmRUb01hcmNYY2hhbmdlKCBzb21lX3JlY29yZF9vYmplY3QgKTsKICAgICAqIEBuYW1lIE1hcmNYY2hhbmdlLm1hcmNSZWNvcmRUb01hcmNYY2hhbmdlICovCiAgICBmdW5jdGlvbiBtYXJjUmVjb3JkVG9NYXJjWGNoYW5nZSggcmVjb3JkLCBmb3JtYXQsIHR5cGUgKSB7CiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmc6IE1hcmNYY2hhbmdlLm1hcmNSZWNvcmRUb01hcmNYY2hhbmdlIGZ1bmN0aW9uIiApOwogICAgICAgIExvZy5kZWJ1ZyggIjAgVmFyIHJlY29yZFN0YXR1cyBiYXNlZCBvbiBvcmlnaW5hbCByZWNvcmQ6ICIsIHJlY29yZC5yZWNvcmRTdGF0dXMgKTsKCiAgICAgICAgdmFyIHJlY29yZFN0YXR1czsKICAgICAgICBpZiAoICFyZWNvcmQuZXhpc3RGaWVsZCggIjAwNCIgKSApIHsKICAgICAgICAgICAgLy9uLCBjLCBhbmQgZCBpcyB1c2VkIC0gbm90IGEgYW5kIHAgKHdoaWNoIG1lYW5zICJpbmNyZWFzZSBpbiBlbmNvZGluZyBsZXZlbCIKICAgICAgICAgICAgLy8gYW5kIGlzIHRoZXJlZm9yZSB0cmFuc2xhdGVkIHRvIGMpCiAgICAgICAgICAgIGlmICggcmVjb3JkLnJlY29yZFN0YXR1cy5tYXRjaCggL15bY2RuXSQvICkgKSB7CiAgICAgICAgICAgICAgICByZWNvcmRTdGF0dXMgPSByZWNvcmQucmVjb3JkU3RhdHVzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVjb3JkU3RhdHVzID0gImMiOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVjb3JkU3RhdHVzID0gcmVjb3JkLmZpZWxkKCAiMDA0IiApLnN1YmZpZWxkKCAiciIgKS52YWx1ZTsKICAgICAgICB9CgogICAgICAgIC8vIENob29zZSB0aGUgbmFtZXNwYWNlIGJhc2VkIG9uIHRoZSBmb3JtYXQgcGFyYW1ldGVyLgogICAgICAgIHZhciBuYW1lc3BhY2U7CiAgICAgICAgaWYgKCBmb3JtYXQgPT09ICJNQVJDMjEiICkgewogICAgICAgICAgICBuYW1lc3BhY2UgPSBYbWxOYW1lc3BhY2VzLm14OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5hbWVzcGFjZSA9IFhtbE5hbWVzcGFjZXMubWFyY3g7CiAgICAgICAgfQogICAgICAgIC8vIFRoaXMgd2lsbCBiZSB0aGUgcmVzdWx0IG9mIHRoZSBmdW5jdGlvbi4KICAgICAgICB2YXIgeG1sID0gWG1sVXRpbC5jcmVhdGVEb2N1bWVudCggInJlY29yZCIsIG5hbWVzcGFjZSApOwogICAgICAgIFhtbFV0aWwuc2V0QXR0cmlidXRlKCB4bWwuZG9jdW1lbnRFbGVtZW50LCAiZm9ybWF0IiwgZm9ybWF0ICk7CiAgICAgICAgWG1sVXRpbC5zZXRBdHRyaWJ1dGUoIHhtbC5kb2N1bWVudEVsZW1lbnQsICJ0eXBlIiwgdHlwZSApOwogICAgICAgIGlmICggIiAgICAiID09PSByZWNvcmQuaW1wbGVtZW50YXRpb25Db2RlcyB8fCAiICAgIiA9PT0gcmVjb3JkLmZvclVzZXJTeXN0ZW1zICkgewogICAgICAgICAgICBNYXJjWGNoYW5nZS5zZXRWYWx1ZXNGb3JMZWFkZXIoIHJlY29yZCwgZm9ybWF0ICk7CiAgICAgICAgfQogICAgICAgIHZhciBsZWFkZXIgPSAiMDAwMDAiICsgcmVjb3JkU3RhdHVzICsgcmVjb3JkLmltcGxlbWVudGF0aW9uQ29kZXMgKyAiMjIwMDAwMCIgKyByZWNvcmQuZm9yVXNlclN5c3RlbXMgKyAiNDUwMCI7IC8vMDAwMDBuYW0gYTIyMDAwMDAwYyA0NTAwCiAgICAgICAgdmFyIGVsZW1lbnQgPSBYbWxVdGlsLmFwcGVuZENoaWxkRWxlbWVudCggeG1sLCAibGVhZGVyIiwgbmFtZXNwYWNlLCBsZWFkZXIgKTsKCiAgICAgICAgdmFyIHN1YmZpZWxkOwogICAgICAgIHZhciBpbmQ7CiAgICAgICAgcmVjb3JkLmVhY2hGaWVsZCggLy4vLCBmdW5jdGlvbiggZmllbGQgKSB7CiAgICAgICAgICAgIGlmICggZmllbGQuaXNDb250cm9sRmllbGQoKSApIHsKICAgICAgICAgICAgICAgIC8vIENvbnRyb2wgZmllbGRzIG9ubHkgaGF2ZSBhIG5hbWUgYW5kIGEgdmFsdWUuCiAgICAgICAgICAgICAgICBlbGVtZW50ID0gWG1sVXRpbC5hcHBlbmRDaGlsZEVsZW1lbnQoIHhtbCwgImNvbnRyb2xmaWVsZCIsIG5hbWVzcGFjZSwgZmllbGQudmFsdWUgKTsKICAgICAgICAgICAgICAgIFhtbFV0aWwuc2V0QXR0cmlidXRlKCBlbGVtZW50LCAidGFnIiwgZmllbGQubmFtZSApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gTm9ybWFsIGZpZWxkcyBoYXZlIG5hbWUgaW5kaWNhdG9yIGFuZCBzdWJmaWVsZHMKICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBYbWxVdGlsLmFwcGVuZENoaWxkRWxlbWVudCggeG1sLCAiZGF0YWZpZWxkIiwgbmFtZXNwYWNlICk7CiAgICAgICAgICAgICAgICBYbWxVdGlsLnNldEF0dHJpYnV0ZSggZWxlbWVudCwgInRhZyIsIGZpZWxkLm5hbWUgKTsKICAgICAgICAgICAgICAgIGluZCA9IGZpZWxkLmluZGljYXRvci5jaGFyQXQoIDAgKTsKICAgICAgICAgICAgICAgIGlmICggaW5kID09PSB1bmRlZmluZWQgKSB7CiAgICAgICAgICAgICAgICAgICAgaW5kID0gIiAiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgWG1sVXRpbC5zZXRBdHRyaWJ1dGUoIGVsZW1lbnQsICJpbmQxIiwgaW5kICk7CiAgICAgICAgICAgICAgICBpbmQgPSBmaWVsZC5pbmRpY2F0b3IuY2hhckF0KCAxICk7CiAgICAgICAgICAgICAgICBpZiAoIGluZCA9PT0gdW5kZWZpbmVkICkgewogICAgICAgICAgICAgICAgICAgIGluZCA9ICIgIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIFhtbFV0aWwuc2V0QXR0cmlidXRlKCBlbGVtZW50LCAiaW5kMiIsIGluZCApOwoKICAgICAgICAgICAgICAgIGZpZWxkLmVhY2hTdWJGaWVsZCggLy4vLCBmdW5jdGlvbiggZmllbGQsIHN1YkZpZWxkICkgewogICAgICAgICAgICAgICAgICAgIHN1YmZpZWxkID0gWG1sVXRpbC5hcHBlbmRDaGlsZEVsZW1lbnQoIGVsZW1lbnQsICJzdWJmaWVsZCIsIG5hbWVzcGFjZSwgc3ViRmllbGQudmFsdWUgKTsKICAgICAgICAgICAgICAgICAgICBYbWxVdGlsLnNldEF0dHJpYnV0ZSggc3ViZmllbGQsICJjb2RlIiwgc3ViRmllbGQubmFtZSApOwogICAgICAgICAgICAgICAgfSApOwogICAgICAgICAgICB9CiAgICAgICAgfSApOwoKICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nOiBtYXJjUmVjb3JkVG9NYXJjWGNoYW5nZSBmdW5jdGlvbiIgKTsKCiAgICAgICAgcmV0dXJuIHhtbDsKCiAgICB9CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IHNldCB2YWx1ZXMgZm9yIHRoZSBsZWFkZXIgZm9yIHRoZSBkYW5NYXJjMlJlY29yZCB3aXRoIHJlY29yZFN0YXR1cywgaW1wbGVtZW50YXRpb25Db2RlcyBhbmQgZm9yVXNlclN5c3RlbSBwcm9wZXJ0aWVzLgogICAgICoKICAgICAqIEBmdW5jdGlvbgogICAgICogQHN5bnRheCBNYXJjWGNoYW5nZS5zZXRWYWx1ZXNGb3JMZWFkZXIoIHJlY29yZCwgZm9ybWF0ICkKICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgQSBtYXJjIHJlY29yZCBvYmplY3QKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBmb3JtYXQgbWFyY1hjaGFuZ2UgZm9ybWF0IG9mIHRoZSByZWNvcmQsIGVpdGhlciAiTUFSQzIxIiBvciAiZGFuTUFSQzIiLiAKICAgICAqIEBuYW1lIE0yMVRvRE0yLnNldFZhbHVlc0ZvckxlYWRlcgogICAgICovCiAgICBmdW5jdGlvbiBzZXRWYWx1ZXNGb3JMZWFkZXIoIHJlY29yZCwgZm9ybWF0ICkgewoKICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZyBNYXJjWGNoYW5nZS5zZXRWYWx1ZXNGb3JMZWFkZXIiICk7CiAgICAgICAgaWYgKCAiZGFuTUFSQzIiID09PSBmb3JtYXQgKSB7CiAgICAgICAgICAgIC8vcG9zaXRpb25zIDAwIC0gMDQ6IFJlY29yZCBsZW5ndGgKICAgICAgICAgICAgLy9wb3NpdGlvbiAwNTogUmVjb3JkIHN0YXR1cyBpcyBzZXQgaW4gTWFyY1hjaGFuZ2UubWFyY1JlY29yZFRvTWFyY1hjaGFuZ2UgZnJvbSAwMDRyCiAgICAgICAgICAgIC8vcG9zaXRpb25zIDA2LTA5OgogICAgICAgICAgICB2YXIgaW1wbGVtZW50YXRpb25Db2RlcyA9IFsgIiAiLCAiICIsICIgIiwgIiAiIF07CiAgICAgICAgICAgIC8vIDA2IFR5cGUgb2YgcmVjb3JkIGZyb20gZmlyc3QgMDA5YQogICAgICAgICAgICB2YXIgdmFsdWVGcm9tMDA5YSA9IHJlY29yZC5maWVsZCggIjAwOSIgKS5zdWJmaWVsZCggImEiICkudmFsdWU7CiAgICAgICAgICAgIGltcGxlbWVudGF0aW9uQ29kZXNbIDAgXSA9ICggIiIgIT09IHZhbHVlRnJvbTAwOWEgKSA/IHZhbHVlRnJvbTAwOWEgOiAiICI7CiAgICAgICAgICAgIC8vIDA3IGJpYmxpb2dyYXBoaWMgY2F0ZWdvcnkgYXMgaW4gMDA4dCwKICAgICAgICAgICAgdmFyIHZhbHVlRnJvbTAwOHQgPSByZWNvcmQuZmllbGQoICIwMDgiICkuc3ViZmllbGQoICJ0IiApLnZhbHVlOwogICAgICAgICAgICBpZiAoICIiICE9PSB2YWx1ZUZyb20wMDh0ICkgewogICAgICAgICAgICAgICAgaW1wbGVtZW50YXRpb25Db2Rlc1sgMSBdID0gKCAicyIgPT09IHZhbHVlRnJvbTAwOHQgKSA/ICJtIiA6IHZhbHVlRnJvbTAwOHQ7IC8vaWYgMDA4dCBpcyBzIHVzZSBtLCBvdGhlcndpc2UgdXNlIHZhbHVlIGFzIGlzLgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaW1wbGVtZW50YXRpb25Db2Rlc1sgMSBdID0gKCAiaSIgPT09IHJlY29yZC5maWVsZCggIjAwNCIgKS5zdWJmaWVsZCggImEiICkudmFsdWUgKSA/ICJhIiA6ICJtIjsgLy9pZiAwMDRhIGlzIGkgdXNlIGEsIG90aGVyd2lzZSB1c2UgbQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vMDggdHlwZSBvZiByZWNvcmQgZnJvbSAwMDRhCiAgICAgICAgICAgIHZhciB2YWx1ZUZyb20wMDRhID0gcmVjb3JkLmZpZWxkKCAiMDA0IiApLnN1YmZpZWxkKCAiYSIgKS52YWx1ZTsKICAgICAgICAgICAgaW1wbGVtZW50YXRpb25Db2Rlc1sgMiBdID0gKCAiIiAhPT0gdmFsdWVGcm9tMDA0YSApID8gdmFsdWVGcm9tMDA0YSA6ICIgIjsKICAgICAgICAgICAgcmVjb3JkLmltcGxlbWVudGF0aW9uQ29kZXMgPSBpbXBsZW1lbnRhdGlvbkNvZGVzLmpvaW4oICIiICk7CiAgICAgICAgICAgIC8vIDA5IGJsYW5rCiAgICAgICAgICAgIC8vIDEwIEluZGljYXRvciBjb3VudCA9IDIKICAgICAgICAgICAgLy8gMTEgU3ViZmllbGQgY29kZSBjb3VudCA9IDIKICAgICAgICAgICAgLy8gMTItMTYgQmFzZSBhZGRyZXNzIG9mIGRhdGEKICAgICAgICAgICAgLy9wb3NpdGlvbnMgMTctMTk6IGNvZGUgZm9yIGNhdGFsb2d1aW5nIGxldmVsIGZyb20gMDA4KnYsIHZhbHVlczogKCcwJywnMScsJzMnLCc0JywnNycsJzgnLCc5JykgLSBpZiBtaXNzaW5nIHNldCB0byAnNCcsIHBvcy4gMTgtMTkgYXJlIGJsYW5rCiAgICAgICAgICAgIHZhciBjYXRhbG9ndWluZ0xldmVsID0gcmVjb3JkLmZpZWxkKCAiMDA4IiApLnN1YmZpZWxkKCAidiIgKS52YWx1ZTsKICAgICAgICAgICAgcmVjb3JkLmZvclVzZXJTeXN0ZW1zID0gKCAiIiA9PT0gY2F0YWxvZ3VpbmdMZXZlbCApID8gIjQgICIgOiBjYXRhbG9ndWluZ0xldmVsICsgIiAgIjsKICAgICAgICAgICAgLy8gMjAgTGVuZ3RoIG9mIHRoZSBsZW5ndGgtb2YtZmllbGQgcG9ydGlvbiA9IDQKICAgICAgICAgICAgLy8gMjEgTGVuZ3RoIG9mIHRoZSBzdGFydGluZy1jaGFyYWN0ZXItcG9zaXRpb24gcG9ydGlvbiA9IDUKICAgICAgICAgICAgLy8gMjIgTGVuZ3RoIG9mIHRoZSBpbXBsZW1lbnRhdGlvbi1kZWZpbmVkIHBvcnRpb24gPSAwCiAgICAgICAgICAgIC8vIDIzIFJlc2VydmVkIGZvciBmdXR1cmUgdXNlID0gMAoKICAgICAgICAgICAgTG9nLmRlYnVnKCAiSW5mb3JtYXRpb24gZm9yIHRoZSBsZWFkZXI6XG5kZWZhdWx0IFJlY29yZFN0YXR1czogIiwgcmVjb3JkLnJlY29yZFN0YXR1cywgIlxuSW1wbGVtZW50YXRpb25Db2RlczogJyIsIHJlY29yZC5pbXBsZW1lbnRhdGlvbkNvZGVzLCAiJyIgKwogICAgICAgICAgICAgICAgIlxuRm9yVXNlclN5c3RlbXM6ICciLCByZWNvcmQuZm9yVXNlclN5c3RlbXMgKyAiJyIgKTsKICAgICAgICB9CiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBNYXJjWGNoYW5nZS5zZXRWYWx1ZXNGb3JMZWFkZXIiICk7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICBtYXJjWGNoYW5nZVRvTWFyY1JlY29yZDogbWFyY1hjaGFuZ2VUb01hcmNSZWNvcmQsCiAgICAgICAgbWFyY1hjaGFuZ2VNMjFUb01hcmNSZWNvcmQ6IG1hcmNYY2hhbmdlVG9NYXJjUmVjb3JkLCAvLyB0aGUgZnVuY3Rpb24gbWFyY1hjaGFuZ2VNMjFUb01hcmNSZWNvcmQgaXMgcmVtb3ZlZCBhZnRlciBtZXJnaW5nIGl0IGluIHRvIG1hcmNYY2hhbmdlVG9NYXJjUmVjb3JkCiAgICAgICAgbWFyY1JlY29yZFRvTWFyY1hjaGFuZ2U6IG1hcmNSZWNvcmRUb01hcmNYY2hhbmdlLAogICAgICAgIHNldFZhbHVlc0ZvckxlYWRlcjogc2V0VmFsdWVzRm9yTGVhZGVyCiAgICB9Owp9KCk7CgovL1VuaXR0ZXN0cyBhcmUgaW4gdGhlIE1hcmNYY2hhbmdlLnRlc3QuanMgbW9kdWxlCg==", "moduleName": "MarcXchange"}, {"javascript": "LyoKIFNjcmlwdCB0aWwgZGFubmVsc2UgYWYgYm9nc3RhdGlzdGlrIHRpbCBEYW5tYXJrcyBTdGF0aXN0aWsuCgogQ29weXJpZ2h0IC91MDBBOSAyMDExLCBEYW5zayBCaWJsaW90ZWtzY2VudGVyIGEvcywKIFRlbXBvdmVqIDctMTEsIERLLTI3NTAgQmFsbGVydXAsIERlbm1hcmsuIENWUjogMTUxNDkwNDMKCiBEbTJUb0RzdCBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgogRG0yVG9Ec3QgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiBhbG9uZyB3aXRoIERtMlRvRHN0LiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoqLwoKdXNlKCAiTG9nIiApOwp1c2UoICJNYXJjIiApOwp1c2UoICJEYXRlVXRpbCIgKTsKdXNlKCAiWG1sVXRpbCIgKTsKdXNlKCAiTWFyY1hjaGFuZ2UiICk7CnVzZSggIlJlY29yZFByb2Nlc3NpbmciICk7CgoKRVhQT1JURURfU1lNQk9MUyA9IFsnRG0yVG9Ec3QnXTsKCi8qKgogKiBNb2R1bGUgd2l0aCBmdW5jdGlvbnMgZm9yIHByZXBhcmluZyBhIHJlY29yZCBmcm9tIFJhdyBSZXBvIHRvIERhbm1hcmtzIFN0YXRpc3RpayAoRFNUKSBvdXRwdXQgaW4gZm9ybWF0IGNzdgogKgogKiBAdHlwZSB7bmFtZXNwYWNlfQogKiBAbmFtZXNwYWNlCiAqLwoKdmFyIERtMlRvRHN0ID0gZnVuY3Rpb24oKSB7CiAgICBMb2cuaW5mbyggIkVudGVyaW5nOiBEbTJUb0RzdCBtb2R1bGUiICk7CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IGNyZWF0ZXMgYSBjc3Ygb3V0cHV0IHJlcHJlc2VudGluZyBhIGNvbGxlY3Rpb24gb2YgbWFyYyByZWNvcmRzIGZvciBEYW5tYXJrcyBTdGF0aXN0aWsgKERTVCkKICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IERtMlRvRHN0LmNyZWF0ZUNzdkZvckRzdCAoIGNvbGxlY3Rpb25TdHJpbmcgLCBkYXRlICkKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjb2xsZWN0aW9uU3RyaW5nIFhNTCBjb2xsZWN0aW9uIGNvbnRhaW5pbmcgbWFyY1hjaGFuZ2UgcmVjb3JkcyBhcyBhIHN0cmluZwogICAgICogQHBhcmFtIHtTdHJpbmcgfCB1bmRlZmluZWR9IGRhdGUgZm9yIHVuaXR0ZXN0aW5nCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGEgY3N2IHJlcHJlc2VudGF0aW9uIG9mIGEgbWFyYyByZWNvcmQKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgRG0yVG9Ec3QuY3JlYXRlQ3N2Rm9yRHN0CiAgICAgKi8KCiAgICBmdW5jdGlvbiBjcmVhdGVDc3ZGb3JEc3QgKCBjb2xsZWN0aW9uU3RyaW5nLCBkYXRlICkgewoKICAgICAgICBMb2cuaW5mbyggIkVudGVyaW5nIERtMlRvRHN0LmNyZWF0ZUNzdkZvckRzdCIgKTsKCiAgICAgICAgdmFyIG1hcmNSZWNvcmQgPSBudWxsOwogICAgICAgIHZhciBoZWFkID0gbnVsbDsKCiAgICAgICAgLy8gY29sbGVjdGlvblN0cmluZyBpbnRvIGEgY29sbGVjdGlvbiBhZiB4bWwgcmVjb3JkcwogICAgICAgIHZhciB4bWxSZWNvcmRzID0gWG1sVXRpbC5mcm9tU3RyaW5nKCBjb2xsZWN0aW9uU3RyaW5nICk7CgogICAgICAgIC8vIHNwbGl0IHhtbFJlY29yZHMgaW50byBtYXJjIHJlY29yZCBvYmplY3RzCiAgICAgICAgdmFyIGVsZW1lbnRzID0gWFBhdGguc2VsZWN0KCAnL21hcmN4OmNvbGxlY3Rpb24vbWFyY3g6cmVjb3JkJywgeG1sUmVjb3JkcyApOwogICAgICAgIGZvciAoIHZhciBpbmRleCA9IDA7IGluZGV4IDwgZWxlbWVudHMubGVuZ3RoOyBpbmRleCsrICkgewogICAgICAgICAgICB2YXIgcmVjb3JkID0gZWxlbWVudHNbIGluZGV4IF07CiAgICAgICAgICAgIHZhciBtYXJjUmVjb3JkT2JqZWN0ID0gTWFyY1hjaGFuZ2UubWFyY1hjaGFuZ2VUb01hcmNSZWNvcmQoIHJlY29yZCApOwoKICAgICAgICAgICAgLy8gY2hlY2sgaWYgbWFyY1JlY29yZE9iamVjdCBpcyBtdWx0aWJsZSB2b2x1bWUKICAgICAgICAgICAgdmFyIHJlY29yZFR5cGUgPSBtYXJjUmVjb3JkT2JqZWN0LmZpZWxkKCAnMDA0JyApLnN1YmZpZWxkKCAnYScgKS52YWx1ZTsKICAgICAgICAgICAgaWYgKCAiaCIgPT09IHJlY29yZFR5cGUgKSB7CiAgICAgICAgICAgICAgICBoZWFkID0gbWFyY1JlY29yZE9iamVjdDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1hcmNSZWNvcmQgPSBtYXJjUmVjb3JkT2JqZWN0OwogICAgICAgICAgICB9CgogICAgICAgIH0KCiAgICAgICAgLy8gY2hlY2sgaWYgdmFsaWQgbWFyYyByZWNvcmQKICAgICAgICBpZiAoIG51bGwgPT09IG1hcmNSZWNvcmQgKSB7CiAgICAgICAgICAgIExvZy5pbmZvKCAiTm8gcmVjb3JkIGZvdW5kIGluIHhtbCBjb2xsZWN0aW9uIiApOwogICAgICAgICAgICBSZWNvcmRQcm9jZXNzaW5nLnRlcm1pbmF0ZVByb2Nlc3NpbmdBbmRGYWlsUmVjb3JkKCAiUkVDT1JEIEZBSUxFRDogTm8gcmVjb3JkIGZvdW5kIGluIHhtbCBjb2xsZWN0aW9uIiApOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNzdiA9IGNyZWF0ZUFsbFBvc2l0aW9ucyggbWFyY1JlY29yZCwgaGVhZCwgZGF0ZSApCgogICAgICAgIExvZy5pbmZvKCAiTGVhdmluZyBEbTJUb0RzdC5jcmVhdGVDc3ZGb3JEc3QiICk7CgogICAgICAgIHJldHVybiBjc3Y7CgogICAgfQoKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhbGwgcG9zaXRpb25zIGZvciBhIGNvbW1hIHNlcGFyYXRlZAogICAgICogcmVwcmVzZW50YXRpb24gb2YgYSBtYXJjIHJlY29yZCBmb3IgRGFubWFya3MgU3RhdGlzdGlrIChEU1QpCiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBEbTJUb0RzdC5jcmVhdGVBbGxQb3NpdGlvbnMgKCByZWNvcmQsIGhlYWQgKQogICAgICogQHBhcmFtIHtSZWNvcmR9IHJlY29yZCBBIHNpbmdsZSBvciB2b2x1bWUgcmVjb3JkCiAgICAgKiBAcGFyYW0ge1JlY29yZH0gaGVhZCBBIG1hcmMgcGFyZW50IHJlY29yZAogICAgICogQHBhcmFtIHtTdHJpbmcgfCB1bmRlZmluZWR9IGRhdGUgZm9yIHVuaXR0ZXN0aW5nCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGEgY3N2IHJlcHJlc2VudGF0aW9uIG9mIGEgbWFyYyByZWNvcmQKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgRG0yVG9Ec3QuY3JlYXRlQWxsUG9zaXRpb25zCiAgICAgKi8KCgoKICAgIGZ1bmN0aW9uIGNyZWF0ZUFsbFBvc2l0aW9ucyggcmVjb3JkLCBoZWFkLCBkYXRlICkgewoKICAgICAgICBMb2cuaW5mbyggIlJFQ09SRDogIiArIHJlY29yZCApOwogICAgICAgIExvZy5pbmZvKCAiSEVBRDogIiArIGhlYWQgKTsKICAgICAgICBMb2cuaW5mbyggIkVudGVyaW5nIERtMlRvRHN0LmNyZWF0ZUFsbFBvc2l0aW9ucyIgKTsKCiAgICAgICAgdmFyIHJlY29yZGRhdGEgPSAiIjsKCiAgICAgICAgcmVjb3JkZGF0YSArPSBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjFfMTIoIHJlY29yZCwgaGVhZCApOyAgICAgICAvL0ZhdXN0bnVtbWVyCiAgICAgICAgcmVjb3JkZGF0YSArPSBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjEzXzE2KCByZWNvcmQsIGhlYWQgKTsgICAgICAvL01hdGVyaWFsZWJldGVnbmVsc2UKICAgICAgICByZWNvcmRkYXRhICs9IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMTdfMTgoIHJlY29yZCwgaGVhZCApOyAgICAgIC8vUGVyaW9kaWN1bSBlbGxlciBtb25vZ3JhZmkKICAgICAgICByZWNvcmRkYXRhICs9IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMTlfMjEoIHJlY29yZCwgaGVhZCApOyAgICAvL1VkZ2l2ZWxzZXNsYW5kCiAgICAgICAgcmVjb3JkZGF0YSArPSBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjIyXzIzKCByZWNvcmQsIGhlYWQgKTsgICAgLy9VZGdhdmVrb2RlCiAgICAgICAgcmVjb3JkZGF0YSArPSBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjI0XzI4KCByZWNvcmQsIGhlYWQgKTsgICAgLy9VZGdpdmVsc2VzYWFyIGZvZXJzdCBvcGxhZwogICAgICAgIHJlY29yZGRhdGEgKz0gRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb24yOV8zMCggcmVjb3JkLCBoZWFkICk7ICAgIC8vT3BsYWcKICAgICAgICByZWNvcmRkYXRhICs9IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMzFfMzUoIHJlY29yZCwgaGVhZCApOyAgICAvL1NlbmVzdGUgdWRnaXZlbHNlc2FhciBmb3Igb3BsYWcKICAgICAgICByZWNvcmRkYXRhICs9IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMzZfMzcoIHJlY29yZCwgaGVhZCApOyAgICAvL1NtYWF0cnlrPwogICAgICAgIHJlY29yZGRhdGEgKz0gRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb24zOF8zOSggcmVjb3JkLCBoZWFkICk7ICAgIC8vQm9lcm5lL3Nrb2xla29kZQogICAgICAgIHJlY29yZGRhdGEgKz0gRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb240MF80MyggcmVjb3JkLCBoZWFkICk7ICAgIC8vUHJpbWFlcnQgc3Byb2cKICAgICAgICByZWNvcmRkYXRhICs9IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNDRfNDcoIHJlY29yZCwgaGVhZCApOyAgICAvL0V2dC4gb3JpZ2luYWxzcHJvZwogICAgICAgIHJlY29yZGRhdGEgKz0gRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb240OF80OSggcmVjb3JkLCBoZWFkICk7ICAgIC8vSGFuZGVsc2tvZGUKICAgICAgICByZWNvcmRkYXRhICs9IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNTBfNTEoIHJlY29yZCwgaGVhZCApOyAgICAvL0ZhZy0gZWxsZXIgc2tvZW5saXR0ZXJhdHVyCiAgICAgICAgcmVjb3JkZGF0YSArPSBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjUyXzU0KCByZWNvcmQsIGhlYWQgKTsgICAgLy9FbW5lIGZvciBmYWdsaXR0ZXJhdHVyL3R5cGUgYWYgc2tvZW5saXR0dGVyYXR1cgogICAgICAgIHJlY29yZGRhdGEgKz0gRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb241NV81NiggcmVjb3JkLCBoZWFkICk7ICAgIC8vUG9zdHR5cGUKICAgICAgICByZWNvcmRkYXRhICs9IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNTdfNjgoIHJlY29yZCwgaGVhZCApOyAgICAvL0V2dC4gRmF1c3RudW1tZXIgcMOlIGhvdmVkcG9zdAogICAgICAgIHJlY29yZGRhdGEgKz0gRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb242OV83NSggcmVjb3JkLCBoZWFkICk7ICAgIC8vS2F0YWxvZ3VnZWtvZGUKICAgICAgICByZWNvcmRkYXRhICs9IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNzZfODkoIGRhdGUgKTsgICAgICAgICAgICAgICAgLy9MZXZlcmFuY2V0aWRzcHVua3QKCiAgICAgICAgTG9nLmluZm8oICJMZWF2aW5nIERtMlRvRHN0LmNyZWF0ZUFsbFBvc2l0aW9ucyIgKTsKCiAgICAgICAgcmV0dXJuIHJlY29yZGRhdGE7CgogICAgfQoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgc3RyaW5nIHdpdGggcG9zaXRpb24gMS0xMiBvZiBhIGNvbW1hIHNlcGFyYXRlZAogICAgICogcmVwcmVzZW50YXRpb24gb2YgYSBtYXJjIHJlY29yZCBmaWVsZCAwMDEKICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMV8xMiAoIHJlY29yZCwgaGVhZCApCiAgICAgKiBAcGFyYW0ge1JlY29yZH0gcmVjb3JkIEEgbWFyYyByZWNvcmQgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGEgZmF1c3QgbnVtYmVyIGFzIGEgc3RyaW5nCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMV8xMgogICAgICovCgoKICAgIGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uMV8xMiggcmVjb3JkICkgeyAgICAgIC8vRmF1c3RudW1tZXIKCiAgICAgICAgTG9nLmluZm8oICJFbnRlcmluZyBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjFfMTIiICk7CgogICAgICAgIHZhciBwb3MxXzEyID0gcmVjb3JkLmZpZWxkKCAnMDAxJyApLnN1YmZpZWxkKCAnYScgKS52YWx1ZSArICI7IjsKCiAgICAgICAgTG9nLmluZm8oICJMZWF2aW5nOiBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjFfMTIgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBwb3MxXzEyOwoKICAgIH07CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IGNyZWF0ZXMgYSBzdHJpbmcgd2l0aCBwb3NpdGlvbiAxMy0xNiBvZiBhIGNvbW1hIHNlcGFyYXRlZAogICAgICogcmVwcmVzZW50YXRpb24gb2YgYSBtYXJjIHJlY29yZCBmaWVsZCAwMDkKICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMTNfMTYgKCByZWNvcmQsIGhlYWQgKQogICAgICogQHBhcmFtIHtSZWNvcmR9IHJlY29yZCBBIG1hcmMgcmVjb3JkIG9iamVjdAogICAgICogQHBhcmFtIHtSZWNvcmR9IGhlYWQgYSBtYXJjIGhlYWQgcmVjb3JkIG9iamVjdAogICAgICogQHJldHVybiB7U3RyaW5nfSBjb2RlIGZvciBtYXRlcmlhbCB0eXBlIGFzIGEgc3RyaW5nCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMTNfMTYKICAgICAqLwoKICAgIGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uMTNfMTYoIHJlY29yZCwgaGVhZCApIHsgICAgIC8vTWF0ZXJpYWxlYmV0ZWduZWxzZQoKICAgICAgICBMb2cuaW5mbyggIkVudGVyaW5nIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMTNfMTYiICk7CgogICAgICAgIHZhciBwb3MxM18xNiA9ICJYWFg7IjsKICAgICAgICB2YXIgc3ViZmllbGR2YWx1ZSA9ICIiOwogICAgICAgIHZhciBmb2N1c1JlY29yZDsKICAgICAgICBpZiAoIGhlYWQgIT09IG51bGwgKSB7CiAgICAgICAgICAgIGZvY3VzUmVjb3JkID0gaGVhZDsgICAgICAgICAgICAgICAgICAgICAgICAgLy9JZiB0aGVyZSBpcyBhIG1haW4gcmVjb3JkLCBmaW5kIG1hdGVyaWFsIHR5cGUgaGVyZQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvY3VzUmVjb3JkID0gcmVjb3JkOyAgICAgICAgICAgICAgICAgICAgICAgLy9lbHNlIHVzZSB0aGUgcmVjb3JkIGl0IHNlbGYgdG8gbG9vayBmb3IgbWF0ZXJpYWwgdHlwZQogICAgICAgIH0KICAgICAgICBmb2N1c1JlY29yZC5lYWNoRmllbGQoICIwMDkiLAogICAgICAgICAgICBmdW5jdGlvbiggZmllbGQgKSB7CiAgICAgICAgICAgICAgICBmaWVsZC5lYWNoU3ViRmllbGQoIC9bYWddLywKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiggZmllbGQsIHN1YkZpZWxkICkgewogICAgICAgICAgICAgICAgICAgICAgICBzdWJmaWVsZHZhbHVlICs9IHN1YkZpZWxkLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICApOwogICAgICAgIGlmICggc3ViZmllbGR2YWx1ZS5tYXRjaCggL2F4eC8gKSApIHsKICAgICAgICAgICAgcG9zMTNfMTYgPSAiQVhYOyI7CiAgICAgICAgfSBlbHNlIGlmICggc3ViZmllbGR2YWx1ZS5tYXRjaCggL2F4ZS8gKSApIHsKICAgICAgICAgICAgcG9zMTNfMTYgPSAiQVhFOyI7CiAgICAgICAgfSBlbHNlIGlmICggc3ViZmllbGR2YWx1ZS5tYXRjaCggLyhheHkpfChhdC4pLyApICkgeyAgICAvLyBBZGRlZCAyMDE1MTIxNgogICAgICAgICAgICBwb3MxM18xNiA9ICJBWFk7IjsKICAgICAgICB9IGVsc2UgaWYgKCBzdWJmaWVsZHZhbHVlLm1hdGNoKCAvKHR4ZSl8KHJ4ZSl8KG14ZSkvICkgKSB7CiAgICAgICAgICAgIHBvczEzXzE2ID0gIlRYRTsiOwogICAgICAgIH0gZWxzZSBpZiAoIHN1YmZpZWxkdmFsdWUubWF0Y2goIC8odHQuKXwodHh5KXwobXh5KXwobXRvKS8gKSApIHsKICAgICAgICAgICAgcG9zMTNfMTYgPSAiVFhZOyI7CiAgICAgICAgfQoKICAgICAgICBMb2cuaW5mbyggIkxlYXZpbmc6IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMTNfMTYgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBwb3MxM18xNjsKICAgIH07CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IGNyZWF0ZXMgYSBzdHJpbmcgd2l0aCBwb3NpdGlvbiAxNy0xOCBvZiBhIGNvbW1hIHNlcGFyYXRlZAogICAgICogcmVwcmVzZW50YXRpb24gb2YgYSBtYXJjIHJlY29yZCBmaWVsZCAwMDgKICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMTdfMTggKCByZWNvcmQsIGhlYWQgKQogICAgICogQHBhcmFtIHtSZWNvcmR9IHJlY29yZCBBIG1hcmMgcmVjb3JkIG9iamVjdAogICAgICogQHBhcmFtIHtSZWNvcmR9IGhlYWQgYSBtYXJjIGhlYWQgcmVjb3JkIG9iamVjdAogICAgICogQHJldHVybiB7U3RyaW5nfSBjb2RlIGZvciB0eXBlIG9mIHB1YmxpY2F0aW9uIChzZXJpYWw9cCBvciBtb25vZ3JhcGg9bSkgYXMgYSBzdHJpbmcKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb24xN18xOAogICAgICovCgogICAgZnVuY3Rpb24gY3JlYXRlUG9zaXRpb24xN18xOCggcmVjb3JkLCBoZWFkICkgeyAgICAgLy9QZXJpb2RpY3VtIGVsbGVyIG1vbm9ncmFmaQoKICAgICAgICBMb2cuaW5mbyggIkVudGVyaW5nIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMTdfMTgiICk7CgogICAgICAgIHZhciBwb3MxN18xOCA9ICJYOyI7CiAgICAgICAgdmFyIGJpYkNhdGVnb3J5ID0gcmVjb3JkLmZpZWxkKCAnMDA4JyApLnN1YmZpZWxkKCAndCcgKS52YWx1ZTsKICAgICAgICB2YXIgcGVyaW9kaWN1bVR5cGUgPSByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICdoJyApLnZhbHVlOwoKICAgICAgICBpZiAoIGhlYWQgIT09IG51bGwgKSB7CiAgICAgICAgICAgIHBlcmlvZGljdW1UeXBlID0gaGVhZC5maWVsZCggJzAwOCcgKS5zdWJmaWVsZCggJ2gnICkudmFsdWU7CiAgICAgICAgfQoKICAgICAgICBpZiAoIGJpYkNhdGVnb3J5ID09PSAicCIgJiYgcGVyaW9kaWN1bVR5cGUgIT09ICJtIiApIHsKICAgICAgICAgICAgcG9zMTdfMTggPSAiUDsiOwogICAgICAgIH0KICAgICAgICBpZiAoIGJpYkNhdGVnb3J5ID09PSAibSIgfHwgYmliQ2F0ZWdvcnkgPT09ICJzIiB8fCBwZXJpb2RpY3VtVHlwZSA9PT0gIm0iICkgewogICAgICAgICAgICBwb3MxN18xOCA9ICJNOyI7CiAgICAgICAgfQoKICAgICAgICBMb2cuaW5mbyggIkxlYXZpbmc6IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMTdfMTggZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBwb3MxN18xODsKCiAgICB9OwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgc3RyaW5nIHdpdGggcG9zaXRpb24gMTktMjEgb2YgYSBjb21tYSBzZXBhcmF0ZWQKICAgICAqIHJlcHJlc2VudGF0aW9uIG9mIGEgbWFyYyByZWNvcmQgZmllbGQgMDA4CiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjE5XzIxICggcmVjb3JkLCBoZWFkICkKICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgQSBtYXJjIHJlY29yZCBvYmplY3QKICAgICAqIEBwYXJhbSB7UmVjb3JkfSBoZWFkIGEgbWFyYyBoZWFkIHJlY29yZCBvYmplY3QKICAgICAqIEByZXR1cm4ge1N0cmluZ30gY29kZSBmb3IgcHVibGlzaGluZyBjb3VudHJ5IChESy9VRCkgYXMgYSBzdHJpbmcKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb24xOV8yMQogICAgICovCgogICAgZnVuY3Rpb24gY3JlYXRlUG9zaXRpb24xOV8yMSggcmVjb3JkLCBoZWFkICkgeyAgICAgLy9VZGdpdmVsc2VzbGFuZAoKICAgICAgICBMb2cuaW5mbyggIkVudGVyaW5nIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMTlfMjEiICk7CgogICAgICAgIHZhciBwb3MxOV8yMSA9ICJYWDsiOwoKICAgICAgICB2YXIgY291bnRyeUNvZGUgPSByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICdiJyApLnZhbHVlOwogICAgICAgIGlmICggaGVhZCAhPT0gbnVsbCApIHsKICAgICAgICAgICAgaWYgKCBjb3VudHJ5Q29kZSA9PT0gIiIgKSB7CiAgICAgICAgICAgICAgICBjb3VudHJ5Q29kZSA9IGhlYWQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICdiJyApLnZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICggY291bnRyeUNvZGUgPT09ICJkayIgKSB7CiAgICAgICAgICAgIHBvczE5XzIxID0gIkRLOyI7CiAgICAgICAgfSBlbHNlIGlmICggY291bnRyeUNvZGUgIT09ICIiICkgewogICAgICAgICAgICBwb3MxOV8yMSA9ICJVRDsiOwogICAgICAgIH0KCiAgICAgICAgTG9nLmluZm8oICJMZWF2aW5nOiBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjE5XzIxIGZ1bmN0aW9uIiApOwoKICAgICAgICByZXR1cm4gcG9zMTlfMjE7CgogICAgfTsKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhIHN0cmluZyB3aXRoIHBvc2l0aW9uIDIyLTIzIG9mIGEgY29tbWEgc2VwYXJhdGVkCiAgICAgKiByZXByZXNlbnRhdGlvbiBvZiBhIG1hcmMgcmVjb3JkIGZpZWxkcyAwMDggYW5kIDAwOQogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb24yMl8yMyAoIHJlY29yZCwgaGVhZCApCiAgICAgKiBAcGFyYW0ge1JlY29yZH0gcmVjb3JkIEEgbWFyYyByZWNvcmQgb2JqZWN0CiAgICAgKiBAcGFyYW0ge1JlY29yZH0gaGVhZCBhIG1hcmMgaGVhZCByZWNvcmQgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGNvZGUgZm9yIHR5cGUgb2YgZWRpdGlvbiAoUCxGLFgpIGFzIGEgc3RyaW5nCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMjJfMjMKICAgICAqLwoKICAgIGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uMjJfMjMoIHJlY29yZCwgaGVhZCApIHsgICAgIC8vVWRnYXZla29kZQoKICAgICAgICBMb2cuaW5mbyggIkVudGVyaW5nIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMjJfMjMiICk7CgogICAgICAgIHZhciBwb3MyMl8yMyA9ICJYOyI7CiAgICAgICAgdmFyIG1hdENvZGUgPSAiIjsKICAgICAgICB2YXIgZWRpdGlvbkNvZGUgPSAiIjsKCiAgICAgICAgdmFyIGZvY3VzUmVjb3JkOwogICAgICAgIGlmICggaGVhZCAhPT0gbnVsbCApIHsKICAgICAgICAgICAgZm9jdXNSZWNvcmQgPSBoZWFkOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvY3VzUmVjb3JkID0gcmVjb3JkOwogICAgICAgIH0KCiAgICAgICAgZm9jdXNSZWNvcmQuZWFjaEZpZWxkKCAiMDA5IiwKICAgICAgICAgICAgZnVuY3Rpb24oIGZpZWxkICkgewogICAgICAgICAgICAgICAgZmllbGQuZWFjaFN1YkZpZWxkKCAvW2FnXS8sCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oIGZpZWxkLCBzdWJGaWVsZCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWF0Q29kZSArPSBzdWJGaWVsZC52YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgKTsKCiAgICAgICAgZm9jdXNSZWNvcmQuZWFjaEZpZWxkKCAiMDA4IiwKICAgICAgICAgICAgZnVuY3Rpb24oIGZpZWxkICkgewogICAgICAgICAgICAgICAgaWYgKCBmb2N1c1JlY29yZC5maWVsZCggJzAwOCcgKS5zdWJmaWVsZCggJyYnICkudmFsdWUgIT09ICIiICkgewogICAgICAgICAgICAgICAgICAgIGZpZWxkLmVhY2hTdWJGaWVsZCggIiYiLAogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiggZmllbGQsIHN1YkZpZWxkICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdGlvbkNvZGUgKz0gc3ViRmllbGQudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBmaWVsZC5lYWNoU3ViRmllbGQoICJ1IiwKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oIGZpZWxkLCBzdWJGaWVsZCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRpb25Db2RlICs9IHN1YkZpZWxkLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICk7CgoKLy8gICAgICAgIGlmIChTdHJpbmcoZm9jdXNSZWNvcmQuZmllbGQoJzAwOCcpLnN1YmZpZWxkKCdoJykudmFsdWUpID09PSAibSIpIHsgICAgLy8gS29sbGVrdGl2ZSBzZXJpZXIgc2FldHRlcyB0aWwgImZvZXJzdGUgdWRnYXZlIgovLwkJCQllZGl0aW9uQ29kZSA9ICJmIiA7Ci8vCQl9OwogICAgICAgIGlmICggZWRpdGlvbkNvZGUgPT09ICJmIiApIHsKICAgICAgICAgICAgcG9zMjJfMjMgPSAiRjsiOwogICAgICAgIH0KICAgICAgICBpZiAoIGVkaXRpb25Db2RlID09PSAibyIgKSB7CiAgICAgICAgICAgIGlmICggbWF0Q29kZSA9PT0gImF4eCIgKSB7CiAgICAgICAgICAgICAgICBwb3MyMl8yMyA9ICJGOyI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIG1hdENvZGUgPT09ICJheGUiICkgewogICAgICAgICAgICAgICAgcG9zMjJfMjMgPSAiTzsiOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcG9zMjJfMjMgPSAiWDsiOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICggZWRpdGlvbkNvZGUgPT09ICJ1IiApIHsKICAgICAgICAgICAgcG9zMjJfMjMgPSAiVTsiOwogICAgICAgIH0gZWxzZSBpZiAoIGVkaXRpb25Db2RlID09PSAiYyIgfHwgZWRpdGlvbkNvZGUgPT09ICJkIiApIHsKICAgICAgICAgICAgcG9zMjJfMjMgPSAiUDsiOwogICAgICAgIH0KCiAgICAgICAgTG9nLmluZm8oICJMZWF2aW5nOiBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjIyXzIzIGZ1bmN0aW9uIiApOwoKICAgICAgICByZXR1cm4gcG9zMjJfMjM7CgogICAgfTsKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhIHN0cmluZyB3aXRoIHBvc2l0aW9uIDI0LTI4IG9mIGEgY29tbWEgc2VwYXJhdGVkCiAgICAgKiByZXByZXNlbnRhdGlvbiBvZiBhIG1hcmMgcmVjb3JkIGZpZWxkIDAwOAogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb24yNF8yOCAoIHJlY29yZCwgaGVhZCApCiAgICAgKiBAcGFyYW0ge1JlY29yZH0gcmVjb3JkIEEgbWFyYyByZWNvcmQgb2JqZWN0CiAgICAgKiBAcGFyYW0ge1JlY29yZH0gaGVhZCBhIG1hcmMgaGVhZCByZWNvcmQgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IHB1Ymxpc2hpbmcgeWVhciAoZmlyc3QgaW1wcmVzc2lvbiBmb3IgbW9ub2dyYXBocyBvciBzdGFydCB5ZWFyIGZvciBzZXJpYWxzKSBhcyBhIHN0cmluZwogICAgICogQGZ1bmN0aW9uCiAgICAgKiBAbmFtZSBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjI0XzI4CiAgICAgKi8KCiAgICBmdW5jdGlvbiBjcmVhdGVQb3NpdGlvbjI0XzI4KCByZWNvcmQsIGhlYWQgKSB7ICAgICAvL1VkZ2l2ZWxzZXNhYXIgZm9lcnN0IG9wbGFnL0JlZ3luZGVsc2VzYWFyIGZvciBwZXJpb2RpY3VtCgogICAgICAgIExvZy5pbmZvKCAiRW50ZXJpbmcgRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb24yNF8yOCIgKTsKCiAgICAgICAgdmFyIHBvczI0XzI4ID0gIlhYWFg7IjsKCiAgICAgICAgaWYgKCByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICdhJyApLnZhbHVlICE9PSAiIiApIHsKICAgICAgICAgICAgcG9zMjRfMjggPSByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICdhJyApLnZhbHVlICsgIjsiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICggaGVhZCAhPT0gbnVsbCApIHsKICAgICAgICAgICAgICAgIGlmICggaGVhZC5maWVsZCggJzAwOCcgKS5zdWJmaWVsZCggJ2EnICkudmFsdWUgIT09ICIiICkgewogICAgICAgICAgICAgICAgICAgIHBvczI0XzI4ID0gaGVhZC5maWVsZCggJzAwOCcgKS5zdWJmaWVsZCggJ2EnICkudmFsdWUgKyAiOyI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcG9zMjRfMjggPSBwb3MyNF8yOC5yZXBsYWNlKCAvXD8vZywgIloiICk7ICAgICAgIC8vIEVmdGVyIG9lbnNrZSBmcmEgRFMgZXJzdGF0dGVzIGFsbGUgJz8nIG1lZCAnWicKCiAgICAgICAgTG9nLmluZm8oICJMZWF2aW5nOiBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjI0XzI4IGZ1bmN0aW9uIiApOwoKICAgICAgICByZXR1cm4gcG9zMjRfMjg7CgogICAgfTsKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhIHN0cmluZyB3aXRoIHBvc2l0aW9uIDI5LTMwIG9mIGEgY29tbWEgc2VwYXJhdGVkCiAgICAgKiByZXByZXNlbnRhdGlvbiBvZiBhIG1hcmMgcmVjb3JkIGZpZWxkIDAwOAogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb24yOV8zMCAoIHJlY29yZCwgaGVhZCApCiAgICAgKiBAcGFyYW0ge1JlY29yZH0gcmVjb3JkIEEgbWFyYyByZWNvcmQgb2JqZWN0CiAgICAgKiBAcGFyYW0ge1JlY29yZH0gaGVhZCBhIG1hcmMgaGVhZCByZWNvcmQgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGltcHJlc3Npb24gYXMgYSBzdHJpbmcKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb24yOV8zMAogICAgICovCgogICAgZnVuY3Rpb24gY3JlYXRlUG9zaXRpb24yOV8zMCggcmVjb3JkLCBoZWFkICkgeyAgICAgLy9PcGxhZwoKICAgICAgICBMb2cuaW5mbyggIkVudGVyaW5nIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMjlfMzAiICk7CgogICAgICAgIHZhciBwb3MyOV8zMCA9ICJYOyI7CiAgICAgICAgaWYgKCByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICd1JyApLnZhbHVlID09PSAiciIgKSB7CiAgICAgICAgICAgIHBvczI5XzMwID0gIlI7IjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoIGhlYWQgIT09IG51bGwgKSB7CiAgICAgICAgICAgICAgICBpZiAoIGhlYWQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICd1JyApLnZhbHVlID09PSAiciIgKSB7CiAgICAgICAgICAgICAgICAgICAgcG9zMjlfMzAgPSAiUjsiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBMb2cuaW5mbyggIkxlYXZpbmc6IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMjlfMzAgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBwb3MyOV8zMDsKCiAgICB9OwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgc3RyaW5nIHdpdGggcG9zaXRpb24gMzEtMzUgb2YgYSBjb21tYSBzZXBhcmF0ZWQKICAgICAqIHJlcHJlc2VudGF0aW9uIG9mIGEgbWFyYyByZWNvcmQgZmllbGQgMDA4CiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjMxXzM1ICggcmVjb3JkLCBoZWFkICkKICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgQSBtYXJjIHJlY29yZCBvYmplY3QKICAgICAqIEBwYXJhbSB7UmVjb3JkfSBoZWFkIGEgbWFyYyBoZWFkIHJlY29yZCBvYmplY3QKICAgICAqIEByZXR1cm4ge1N0cmluZ30gbGF0ZXN0IHB1Ymxpc2hpbmcgeWVhciBmb3IgaW1wcmVzc2lvbiBhcyBhIHN0cmluZwogICAgICogQGZ1bmN0aW9uCiAgICAgKiBAbmFtZSBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjMxXzM1CiAgICAgKi8KCiAgICBmdW5jdGlvbiBjcmVhdGVQb3NpdGlvbjMxXzM1KCByZWNvcmQsIGhlYWQgKSB7ICAgICAvL1NlbmVzdGUgdWRnaXZlbHNlc2FhciBmb3Igb3BsYWcKCiAgICAgICAgTG9nLmluZm8oICJFbnRlcmluZyBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjMxXzM1IiApOwoKICAgICAgICB2YXIgcG9zMzFfMzUgPSAiWFhYWDsiOwoKICAgICAgICBpZiAoIHJlY29yZC5maWVsZCggJzAwOCcgKS5zdWJmaWVsZCggJ3UnICkudmFsdWUgPT09ICJyIiAmJiByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICd6JyApLnZhbHVlICE9PSAiIiApIHsKICAgICAgICAgICAgcG9zMzFfMzUgPSByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICd6JyApLnZhbHVlICsgIjsiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICggaGVhZCAhPT0gbnVsbCApIHsKICAgICAgICAgICAgICAgIGlmICggaGVhZC5maWVsZCggJzAwOCcgKS5zdWJmaWVsZCggJ3UnICkudmFsdWUgPT09ICJyIiAmJiBoZWFkLmZpZWxkKCAnMDA4JyApLnN1YmZpZWxkKCAneicgKS52YWx1ZSAhPT0gIiIgKSB7CiAgICAgICAgICAgICAgICAgICAgcG9zMzFfMzUgPSBoZWFkLmZpZWxkKCAnMDA4JyApLnN1YmZpZWxkKCAneicgKS52YWx1ZSArICI7IjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBwb3MzMV8zNSA9IHBvczMxXzM1LnJlcGxhY2UoIC9cPy9nLCAiWiIgKTsgICAgICAgLy8gRWZ0ZXIgb2Vuc2tlIGZyYSBEUyBlcnN0YXR0ZXMgYWxsZSAnPycgbWVkICdaJwoKICAgICAgICBMb2cuaW5mbyggIkxlYXZpbmc6IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMzFfMzUgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBwb3MzMV8zNTsKCiAgICB9OwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgc3RyaW5nIHdpdGggcG9zaXRpb24gMzYtMzcgb2YgYSBjb21tYSBzZXBhcmF0ZWQKICAgICAqIHJlcHJlc2VudGF0aW9uIG9mIGEgbWFyYyByZWNvcmQgZmllbGRzIDAwOCBhbmQgMDA5CiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjM2XzM3ICggcmVjb3JkLCBoZWFkICkKICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgQSBtYXJjIHJlY29yZCBvYmplY3QKICAgICAqIEBwYXJhbSB7UmVjb3JkfSBoZWFkIGEgbWFyYyBoZWFkIHJlY29yZCBvYmplY3QKICAgICAqIEByZXR1cm4ge1N0cmluZ30gY29kZSBmb3IgZXh0ZW50IChzbWFhdHJ5aykgYXMgYSBzdHJpbmcKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb24zNl8zNwogICAgICovCgogICAgZnVuY3Rpb24gY3JlYXRlUG9zaXRpb24zNl8zNyggcmVjb3JkLCBoZWFkICkgeyAgICAgLy9TbWFhdHJ5az8KCiAgICAgICAgTG9nLmluZm8oICJFbnRlcmluZyBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjM2XzM3IiApOwoKICAgICAgICB2YXIgcG9zMzZfMzcgPSAiWDsiOwogICAgICAgIHZhciB0eXBlY29kZSA9ICIiOwogICAgICAgIHZhciBmb2N1c1JlY29yZDsKICAgICAgICBpZiAoIGhlYWQgIT09IG51bGwgKSB7CiAgICAgICAgICAgIGZvY3VzUmVjb3JkID0gaGVhZDsgICAgICAgICAgICAgICAgICAgICAgICAgLy9JZiB0aGVyZSBpcyBhIG1haW4gcmVjb3JkLCBmaW5kIG1hdGVyaWFsIHR5cGUgaGVyZQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvY3VzUmVjb3JkID0gcmVjb3JkOyAgICAgICAgICAgICAgICAgICAgICAgLy9lbHNlIHVzZSB0aGUgcmVjb3JkIGl0c2VsZiB0byBsb29rIGZvciBtYXRlcmlhbCB0eXBlCiAgICAgICAgfQoKICAgICAgICByZWNvcmQuZWFjaEZpZWxkKCAiMDA4IiwKICAgICAgICAgICAgZnVuY3Rpb24oIGZpZWxkICkgewogICAgICAgICAgICAgICAgZmllbGQuZWFjaFN1YkZpZWxkKCAiZCIsCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oIGZpZWxkLCBzdWJGaWVsZCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZWNvZGUgKz0gc3ViRmllbGQudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICk7CgogICAgICAgIGlmICggZm9jdXNSZWNvcmQuZmllbGQoICcwMDknICkuc3ViZmllbGQoICdnJyApLnZhbHVlID09PSAieHgiICkgewogICAgICAgICAgICBpZiAoIHR5cGVjb2RlLm1hdGNoKCAvXHUwMEU1LyApICkgewogICAgICAgICAgICAgICAgcG9zMzZfMzcgPSAiVTsiOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcG9zMzZfMzcgPSAiTzsiOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBMb2cuaW5mbyggIkxlYXZpbmc6IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMzZfMzcgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBwb3MzNl8zNzsKCiAgICB9OwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgc3RyaW5nIHdpdGggcG9zaXRpb24gMzgtMzkgb2YgYSBjb21tYSBzZXBhcmF0ZWQKICAgICAqIHJlcHJlc2VudGF0aW9uIG9mIGEgbWFyYyByZWNvcmQgZmllbGQgMDA4CiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjM4XzM5ICggcmVjb3JkLCBoZWFkICkKICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgQSBtYXJjIHJlY29yZCBvYmplY3QKICAgICAqIEBwYXJhbSB7UmVjb3JkfSBoZWFkIGEgbWFyYyBoZWFkIHJlY29yZCBvYmplY3QKICAgICAqIEByZXR1cm4ge1N0cmluZ30gY29kZSBmb3IgY2hpbGQgb3Igc2Nob29sIG1hdGVyaWFsIGFzIGEgc3RyaW5nCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMzhfMzkKICAgICAqLwoKICAgIGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uMzhfMzkoIHJlY29yZCwgaGVhZCApIHsgICAgIC8vQm9lcm5lL3Nrb2xla29kZQoKICAgICAgICBMb2cuaW5mbyggIkVudGVyaW5nIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMzhfMzkiICk7CgogICAgICAgIHZhciBwb3MzOF8zOSA9ICJYOyI7CiAgICAgICAgaWYgKCByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICdvJyApLnZhbHVlID09PSAiYiIgKSB7CiAgICAgICAgICAgIHBvczM4XzM5ID0gIkI7IjsKICAgICAgICB9CiAgICAgICAgaWYgKCByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICdvJyApLnZhbHVlID09PSAicyIgKSB7CiAgICAgICAgICAgIHBvczM4XzM5ID0gIlM7IjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoIGhlYWQgIT09IG51bGwgKSB7CiAgICAgICAgICAgICAgICBpZiAoIGhlYWQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICdvJyApLnZhbHVlID09PSAiYiIgKSB7CiAgICAgICAgICAgICAgICAgICAgcG9zMzhfMzkgPSAiQjsiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCBoZWFkLmZpZWxkKCAnMDA4JyApLnN1YmZpZWxkKCAnbycgKS52YWx1ZSA9PT0gInMiICkgewogICAgICAgICAgICAgICAgICAgIHBvczM4XzM5ID0gIlM7IjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgTG9nLmluZm8oICJMZWF2aW5nOiBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjM4XzM5IGZ1bmN0aW9uIiApOwoKICAgICAgICByZXR1cm4gcG9zMzhfMzk7CgogICAgfTsKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhIHN0cmluZyB3aXRoIHBvc2l0aW9uIDQwLTQzIG9mIGEgY29tbWEgc2VwYXJhdGVkCiAgICAgKiByZXByZXNlbnRhdGlvbiBvZiBhIG1hcmMgcmVjb3JkIGZpZWxkIDAwOAogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb240MF80MyAoIHJlY29yZCwgaGVhZCApCiAgICAgKiBAcGFyYW0ge1JlY29yZH0gcmVjb3JkIEEgbWFyYyByZWNvcmQgb2JqZWN0CiAgICAgKiBAcGFyYW0ge1JlY29yZH0gaGVhZCBhIG1hcmMgaGVhZCByZWNvcmQgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGNvZGUgZm9yIHByaW1hcnkgbGFuZ3VhZ2UgYXMgYSBzdHJpbmcKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb240MF80MwogICAgICovCgogICAgZnVuY3Rpb24gY3JlYXRlUG9zaXRpb240MF80MyggcmVjb3JkLCBoZWFkICkgeyAgICAgLy9QcmltYWVydCBzcHJvZwoKICAgICAgICBMb2cuaW5mbyggIkVudGVyaW5nIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNDBfNDMiICk7CgogICAgICAgIHZhciBwb3M0MF80MyA9ICJYWFg7IjsKCiAgICAgICAgaWYgKCByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICdsJyApLnZhbHVlICE9PSAiIiApIHsKICAgICAgICAgICAgcG9zNDBfNDMgPSByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICdsJyApLnZhbHVlLnRvVXBwZXJDYXNlKCkgKyAiOyI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKCBoZWFkICE9PSBudWxsICkgewogICAgICAgICAgICAgICAgaWYgKCBoZWFkLmZpZWxkKCAnMDA4JyApLnN1YmZpZWxkKCAnbCcgKS52YWx1ZSAhPT0gIiIgKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCBoZWFkLmZpZWxkKCAnMDA4JyApLnN1YmZpZWxkKCAnbCcgKS52YWx1ZSA9PT0gIm11bCIgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggcmVjb3JkLmZpZWxkKCAnMDQxJyApLnN1YmZpZWxkKCAnYScgKS52YWx1ZSAhPT0gIiIgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3M0MF80MyA9IHJlY29yZC5maWVsZCggJzA0MScgKS5zdWJmaWVsZCggJ2EnICkudmFsdWUudG9VcHBlckNhc2UoKSArICI7IjsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHBvczQwXzQzID0gaGVhZC5maWVsZCggJzAwOCcgKS5zdWJmaWVsZCggJ2wnICkudmFsdWUudG9VcHBlckNhc2UoKSArICI7IjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgcG9zNDBfNDMgPSBoZWFkLmZpZWxkKCAnMDA4JyApLnN1YmZpZWxkKCAnbCcgKS52YWx1ZS50b1VwcGVyQ2FzZSgpICsgIjsiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBMb2cuaW5mbyggIkxlYXZpbmc6IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNDBfNDMgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBwb3M0MF80MzsKCiAgICB9OwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgc3RyaW5nIHdpdGggcG9zaXRpb24gNDQtNDcgb2YgYSBjb21tYSBzZXBhcmF0ZWQKICAgICAqIHJlcHJlc2VudGF0aW9uIG9mIGEgbWFyYyByZWNvcmQgZmllbGQgMDQxCiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjQ0XzQ3ICggcmVjb3JkLCBoZWFkICkKICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgQSBtYXJjIHJlY29yZCBvYmplY3QKICAgICAqIEBwYXJhbSB7UmVjb3JkfSBoZWFkIGEgbWFyYyBoZWFkIHJlY29yZCBvYmplY3QKICAgICAqIEByZXR1cm4ge1N0cmluZ30gY29kZSBmb3Igb3JpZ2luYWwgbGFuZ3VhZ2UgYXMgYSBzdHJpbmcKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb240NF80NwogICAgICovCgogICAgZnVuY3Rpb24gY3JlYXRlUG9zaXRpb240NF80NyggcmVjb3JkLCBoZWFkICkgeyAgICAgLy9FdnQuIG9yaWdpbmFsc3Byb2cKCiAgICAgICAgTG9nLmluZm8oICJFbnRlcmluZyBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjQ0XzQ3IiApOwoKICAgICAgICB2YXIgcG9zNDRfNDcgPSAiWFhYOyI7CgogICAgICAgIGlmICggcmVjb3JkLmZpZWxkKCAnMDQxJyApLnN1YmZpZWxkKCAnYycgKS52YWx1ZSAhPT0gIiIgKSB7CiAgICAgICAgICAgIHBvczQ0XzQ3ID0gcmVjb3JkLmZpZWxkKCAnMDQxJyApLnN1YmZpZWxkKCAnYycgKS52YWx1ZS50b1VwcGVyQ2FzZSgpICsgIjsiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICggaGVhZCAhPT0gbnVsbCApIHsKICAgICAgICAgICAgICAgIGlmICggaGVhZC5maWVsZCggJzA0MScgKS5zdWJmaWVsZCggJ2MnICkudmFsdWUgIT09ICIiICkgewogICAgICAgICAgICAgICAgICAgIHBvczQ0XzQ3ID0gaGVhZC5maWVsZCggJzA0MScgKS5zdWJmaWVsZCggJ2MnICkudmFsdWUudG9VcHBlckNhc2UoKSArICI7IjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgTG9nLmluZm8oICJMZWF2aW5nOiBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjQ0XzQ3IGZ1bmN0aW9uIiApOwoKICAgICAgICByZXR1cm4gcG9zNDRfNDc7CgogICAgfTsKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhIHN0cmluZyB3aXRoIHBvc2l0aW9uIDQ4LTQ5IG9mIGEgY29tbWEgc2VwYXJhdGVkCiAgICAgKiByZXByZXNlbnRhdGlvbiBvZiBhIG1hcmMgcmVjb3JkIGZpZWxkcyAwMDksIDI2MCwgODU2CiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjQ4XzQ5ICggcmVjb3JkLCBoZWFkICkKICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgQSBtYXJjIHJlY29yZCBvYmplY3QKICAgICAqIEBwYXJhbSB7UmVjb3JkfSBoZWFkIGEgbWFyYyBoZWFkIHJlY29yZCBvYmplY3QKICAgICAqIEByZXR1cm4ge1N0cmluZ30gdHJhZGluZyBjb2RlIGFzIGEgc3RyaW5nCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNDhfNDkKICAgICAqLwoKICAgIGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uNDhfNDkoIHJlY29yZCwgaGVhZCApIHsgICAgIC8vSGFuZGVsc2tvZGUKCiAgICAgICAgTG9nLmluZm8oICJFbnRlcmluZyBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjQ4XzQ5IiApOwoKICAgICAgICB2YXIgcG9zNDhfNDkgPSAiWDsiOwogICAgICAgIHZhciBzdWJmaWVsZHZhbHVlMjYwZyA9ICIiOwogICAgICAgIHZhciBzdWJmaWVsZHZhbHVlODU2eSA9ICIiOwoKICAgICAgICByZWNvcmQuZWFjaEZpZWxkKCAiMjYwIiwKICAgICAgICAgICAgZnVuY3Rpb24oIGZpZWxkICkgewogICAgICAgICAgICAgICAgZmllbGQuZWFjaFN1YkZpZWxkKCAiZyIsCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oIGZpZWxkLCBzdWJGaWVsZCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3ViZmllbGR2YWx1ZTI2MGcgKz0gc3ViRmllbGQudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICk7CgogICAgICAgIHJlY29yZC5lYWNoRmllbGQoICI4NTYiLAogICAgICAgICAgICBmdW5jdGlvbiggZmllbGQgKSB7CiAgICAgICAgICAgICAgICBmaWVsZC5lYWNoU3ViRmllbGQoICJ5IiwKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiggZmllbGQsIHN1YkZpZWxkICkgewogICAgICAgICAgICAgICAgICAgICAgICBzdWJmaWVsZHZhbHVlODU2eSArPSBzdWJGaWVsZC52YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgKTsKCiAgICAgICAgaWYgKCByZWNvcmQuZmllbGQoICcwMDknICkuc3ViZmllbGQoICdnJyApLnZhbHVlID09PSAieGUiICkgewovLwkJCWlmICggc3ViZmllbGR2YWx1ZTI2MGcubWF0Y2goIC9bc2FlbGdlcyBwXHUwMEU1IGludGVybmV0dGV0XS8gKSApIHsKICAgICAgICAgICAgaWYgKCBzdWJmaWVsZHZhbHVlMjYwZy5tYXRjaCggL3NcdTAwRTZsZ2VzIHBcdTAwRTUgaW50ZXJuZXQvICkgKSB7CiAgICAgICAgICAgICAgICBwb3M0OF80OSA9ICJOOyI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIHN1YmZpZWxkdmFsdWU4NTZ5Lm1hdGNoKCAvZGdhbmcgdGlsIGtcdTAwZjhiLyApICkgewogICAgICAgICAgICAgICAgcG9zNDhfNDkgPSAiTjsiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8qCQkJZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3M0OF80OSA9ICJYOyI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0qLwogICAgICAgIH0KCiAgICAgICAgaWYgKCByZWNvcmQuZmllbGQoICcwMDknICkuc3ViZmllbGQoICdnJyApLnZhbHVlID09PSAieHgiICkgewogICAgICAgICAgICBpZiAoIHJlY29yZC5maWVsZCggJzI2MCcgKS5zdWJmaWVsZCggJyYnICkudmFsdWUgPT09ICIxIiApIHsKICAgICAgICAgICAgICAgIHBvczQ4XzQ5ID0gIks7IjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHBvczQ4XzQ5ID0gIlU7IjsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICggaGVhZCAhPT0gbnVsbCApIHsKICAgICAgICAgICAgICAgIGlmICggc3ViZmllbGR2YWx1ZTI2MGcubWF0Y2goIC9zXHUwMEU2bGdlcy8gKSApIHsKICAgICAgICAgICAgICAgICAgICBwb3M0OF80OSA9ICJOOyI7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBzdWJmaWVsZHZhbHVlODU2eS5tYXRjaCggL2tcdTAwZjhiLyApICkgewogICAgICAgICAgICAgICAgICAgIHBvczQ4XzQ5ID0gIk47IjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcG9zNDhfNDkgPSAiWDsiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCBoZWFkLmZpZWxkKCAnMDA5JyApLnN1YmZpZWxkKCAnZycgKS52YWx1ZSA9PT0gInh4IiApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIGhlYWQuZmllbGQoICcyNjAnICkuc3ViZmllbGQoICcmJyApLnZhbHVlID09PSAiMSIgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvczQ4XzQ5ID0gIks7IjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBwb3M0OF80OSA9ICJVOyI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBMb2cuaW5mbyggIkxlYXZpbmc6IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNDhfNDkgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBwb3M0OF80OTsKCiAgICB9OwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgc3RyaW5nIHdpdGggcG9zaXRpb24gNTAtNTEgb2YgYSBjb21tYSBzZXBhcmF0ZWQKICAgICAqIHJlcHJlc2VudGF0aW9uIG9mIGEgbWFyYyByZWNvcmQgZmllbGQgNjUyCiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjUwXzUxICggcmVjb3JkLCBoZWFkICkKICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgQSBtYXJjIHJlY29yZCBvYmplY3QKICAgICAqIEBwYXJhbSB7UmVjb3JkfSBoZWFkIGEgbWFyYyBoZWFkIHJlY29yZCBvYmplY3QKICAgICAqIEByZXR1cm4ge1N0cmluZ30gY29kZSBmb3IgZmljdGlvbiBvciBub24tZmljdGlvbiBhcyBhIHN0cmluZwogICAgICogQGZ1bmN0aW9uCiAgICAgKiBAbmFtZSBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjUwXzUxCiAgICAgKi8KCiAgICBmdW5jdGlvbiBjcmVhdGVQb3NpdGlvbjUwXzUxKCByZWNvcmQsIGhlYWQgKSB7ICAgICAvL0ZhZy0gZWxsZXIgc2tvZW5saXR0ZXJhdHVyCgogICAgICAgIExvZy5pbmZvKCAiRW50ZXJpbmcgRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb241MF81MSIgKTsKCiAgICAgICAgdmFyIHBvczUwXzUxID0gIkY7IjsKICAgICAgICB2YXIgZm9jdXNSZWNvcmQ7CiAgICAgICAgaWYgKCBoZWFkICE9PSBudWxsICkgewogICAgICAgICAgICBmb2N1c1JlY29yZCA9IGhlYWQ7ICAgICAgICAgICAgICAgICAgICAgICAgIC8vSWYgdGhlcmUgaXMgYSBtYWluIHJlY29yZCwgZmluZCBmaWN0aW9uIG9yIG5vbi1maWN0aW9uCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9jdXNSZWNvcmQgPSByZWNvcmQ7ICAgICAgICAgICAgICAgICAgICAgICAvL2Vsc2UgdXNlIHRoZSByZWNvcmQgaXQgc2VsZiB0byBsb29rIGZvciBmaWN0aW9uIG9yIG5vbi1maWN0aW9uCiAgICAgICAgfQoKICAgICAgICBmb2N1c1JlY29yZC5lYWNoRmllbGQoICI2NTIiLAogICAgICAgICAgICBmdW5jdGlvbiggZmllbGQgKSB7CiAgICAgICAgICAgICAgICBmaWVsZC5lYWNoU3ViRmllbGQoIC8uLywKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiggZmllbGQsIHN1YkZpZWxkICkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHN1YkZpZWxkLm5hbWUgPT09ICJvIiApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggc3ViRmllbGQudmFsdWUgPT09ICJzayIgfHwgc3ViRmllbGQudmFsdWUubWF0Y2goIC9eOFsyLThdLyApICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvczUwXzUxID0gIlM7IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gKTsKICAgICAgICAgICAgfSApOwoKICAgICAgICBMb2cuaW5mbyggIkxlYXZpbmc6IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNTBfNTEgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBwb3M1MF81MTsKCiAgICB9OwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgc3RyaW5nIHdpdGggcG9zaXRpb24gNTItNTQgb2YgYSBjb21tYSBzZXBhcmF0ZWQKICAgICAqIHJlcHJlc2VudGF0aW9uIG9mIGEgbWFyYyByZWNvcmQgZmllbGQgNjUyCiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjUyXzU0ICggcmVjb3JkLCBoZWFkICkKICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgQSBtYXJjIHJlY29yZCBvYmplY3QKICAgICAqIEBwYXJhbSB7UmVjb3JkfSBoZWFkIGEgbWFyYyBoZWFkIHJlY29yZCBvYmplY3QKICAgICAqIEByZXR1cm4ge1N0cmluZ30gREs1LWNsYXNzaWZpY2F0aW9uIGFzIGEgc3RyaW5nCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNTJfNTQKICAgICAqLwoKICAgIGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uNTJfNTQoIHJlY29yZCwgaGVhZCApIHsgICAgIC8vRW1uZSBmb3IgZmFnbGl0dGVyYXR1ci90eXBlIGFmIHNrb2VubGl0dHRlcmF0dXIKCiAgICAgICAgTG9nLmluZm8oICJFbnRlcmluZyBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjUyXzU0IiApOwoKICAgICAgICB2YXIgcG9zNTJfNTQgPSAiWFg7IjsKICAgICAgICB2YXIgZm9jdXNSZWNvcmQ7CiAgICAgICAgaWYgKCBoZWFkICE9PSBudWxsICkgewogICAgICAgICAgICBmb2N1c1JlY29yZCA9IGhlYWQ7ICAgICAgICAgICAgICAgICAgICAgICAgIC8vSWYgdGhlcmUgaXMgYSBtYWluIHJlY29yZCwgZmluZCBESzUtY2xhc3NpZmljYXRpb24gaGVyZQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvY3VzUmVjb3JkID0gcmVjb3JkOyAgICAgICAgICAgICAgICAgICAgICAgLy9lbHNlIHVzZSB0aGUgcmVjb3JkIGl0c2VsZiB0byBsb29rIGZvciBESzUtY2xhc3NpZmljYXRpb24KICAgICAgICB9CgogICAgICAgIGZvY3VzUmVjb3JkLmVhY2hGaWVsZCggIjY1MiIsCiAgICAgICAgICAgIGZ1bmN0aW9uKCBmaWVsZCApIHsKICAgICAgICAgICAgICAgIGZpZWxkLmVhY2hTdWJGaWVsZCggLy4vLAogICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCBmaWVsZCwgc3ViRmllbGQgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggc3ViRmllbGQubmFtZSA9PT0gIm0iICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRrNUNvZGUgPSBzdWJGaWVsZC52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvczUyXzU0ID0gZGs1Q29kZS5zdWJzdHJpbmcoIDAsIDIgKSArICI7IjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHN1YkZpZWxkLm5hbWUgPT09ICJ6IiApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkazVTdXBwbGVtZW50ID0gc3ViRmllbGQudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGRrNVN1cHBsZW1lbnQgPT09ICIwNDYiIHx8IGRrNVN1cHBsZW1lbnQgPT09ICIyNDYiICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRrNVN1cHBsZW1lbnQgPSAiWDQiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZGs1U3VwcGxlbWVudC5sZW5ndGggPiAyICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvczUyXzU0ID0gZGs1U3VwcGxlbWVudC5zdWJzdHJpbmcoIDEsIDMgKSArICI7IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZGs1U3VwcGxlbWVudC5sZW5ndGggPT09IDIgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zNTJfNTQgPSAiWCIgKyBkazVTdXBwbGVtZW50LnN1YnN0cmluZyggMSwgMiApICsgIjsiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICk7CgogICAgICAgIExvZy5pbmZvKCAiTGVhdmluZzogRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb241Ml81NCBmdW5jdGlvbiIgKTsKCiAgICAgICAgcmV0dXJuIHBvczUyXzU0OwoKICAgIH07CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IGNyZWF0ZXMgYSBzdHJpbmcgd2l0aCBwb3NpdGlvbiA1NS01NiBvZiBhIGNvbW1hIHNlcGFyYXRlZAogICAgICogcmVwcmVzZW50YXRpb24gb2YgYSBtYXJjIHJlY29yZCBmaWVsZCAwMDQKICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNTVfNTYgKCByZWNvcmQsIGhlYWQgKQogICAgICogQHBhcmFtIHtSZWNvcmR9IHJlY29yZCBBIG1hcmMgcmVjb3JkIG9iamVjdAogICAgICogQHJldHVybiB7U3RyaW5nfSBjb2RlIGZvciByZWNvcmQgdHlwZSBhcyBhIHN0cmluZwogICAgICogQGZ1bmN0aW9uCiAgICAgKiBAbmFtZSBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjU1XzU2CiAgICAgKi8KCiAgICBmdW5jdGlvbiBjcmVhdGVQb3NpdGlvbjU1XzU2KCByZWNvcmQgKSB7ICAgICAvL1Bvc3R0eXBlCgogICAgICAgIExvZy5pbmZvKCAiRW50ZXJpbmcgRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb241NV81NiIgKTsKCiAgICAgICAgdmFyIHBvczU1XzU2ID0gIlg7IjsKCiAgICAgICAgaWYgKCByZWNvcmQuZmllbGQoICcwMDQnICkuc3ViZmllbGQoICdhJyApLnZhbHVlID09PSAiZSIgKSB7CiAgICAgICAgICAgIHBvczU1XzU2ID0gIkU7IjsKICAgICAgICB9CiAgICAgICAgaWYgKCByZWNvcmQuZmllbGQoICcwMDQnICkuc3ViZmllbGQoICdhJyApLnZhbHVlID09PSAiYiIgKSB7CiAgICAgICAgICAgIHBvczU1XzU2ID0gIkI7IjsKICAgICAgICB9CgogICAgICAgIExvZy5pbmZvKCAiTGVhdmluZzogRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb241NV81NiBmdW5jdGlvbiIgKTsKCiAgICAgICAgcmV0dXJuIHBvczU1XzU2OwoKICAgIH07CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IGNyZWF0ZXMgYSBzdHJpbmcgd2l0aCBwb3NpdGlvbiA1Ny02OCBvZiBhIGNvbW1hIHNlcGFyYXRlZAogICAgICogcmVwcmVzZW50YXRpb24gb2YgYSBtYXJjIHJlY29yZCBmaWVsZCAwMDEgb2YgcGFyZW50IHJlY29yZAogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb241N182OCAoIHJlY29yZCwgaGVhZCApCiAgICAgKiBAcGFyYW0ge1JlY29yZH0gcmVjb3JkIEEgbWFyYyByZWNvcmQgb2JqZWN0CiAgICAgKiBAcGFyYW0ge1JlY29yZH0gaGVhZCBhIG1hcmMgaGVhZCByZWNvcmQgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGEgZmF1c3QgbnVtYmVyIGFzIGEgc3RyaW5nCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNTdfNjgKICAgICAqLwoKICAgIGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uNTdfNjgoIHJlY29yZCwgaGVhZCApIHsgICAgIC8vRXZ0LiBGYXVzdG51bW1lciBwYWEgaG92ZWRwb3N0CgogICAgICAgIExvZy5pbmZvKCAiRW50ZXJpbmcgRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb241N182OCIgKTsKCiAgICAgICAgdmFyIHBvczU3XzY4ID0gIlhYWFhYWFhYWFhYOyI7CgogICAgICAgIGlmICggaGVhZCAhPT0gbnVsbCApIHsKICAgICAgICAgICAgcG9zNTdfNjggPSBoZWFkLmZpZWxkKCAnMDAxJyApLnN1YmZpZWxkKCAnYScgKS52YWx1ZSArICI7IjsgICAgICAgICAgICAgICAgICAgICAgICAgLy9JZG5vIGZyb20gaGVhZCByZWNvcmQgKGluIERhbmlzaDogSG92ZWRwb3N0KQogICAgICAgIH0KCiAgICAgICAgTG9nLmluZm8oICJMZWF2aW5nOiBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjU3XzY4IGZ1bmN0aW9uIiApOwoKICAgICAgICByZXR1cm4gcG9zNTdfNjg7CgogICAgfTsKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhIHN0cmluZyB3aXRoIHBvc2l0aW9uIDY5LTc1IG9mIGEgY29tbWEgc2VwYXJhdGVkCiAgICAgKiByZXByZXNlbnRhdGlvbiBvZiBhIG1hcmMgcmVjb3JkIGZpZWxkIDAzMgogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb242OV83NSAoIHJlY29yZCwgaGVhZCApCiAgICAgKiBAcGFyYW0ge1JlY29yZH0gcmVjb3JkIEEgbWFyYyByZWNvcmQgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGEgY2F0YWxvZyBjb2RlIGFzIGEgc3RyaW5nCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNjlfNzUKICAgICAqLwoKICAgIGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uNjlfNzUoIHJlY29yZCApIHsgICAgIC8vS2F0YWxvZ3VnZWtvZGUKCiAgICAgICAgTG9nLmluZm8oICJFbnRlcmluZyBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjY5Xzc1IiApOwoKICAgICAgICB2YXIgcG9zNjlfNzUgPSAiWFhYWFhYOyIKCiAgICAgICAgcmVjb3JkLmVhY2hGaWVsZCggIjAzMiIsCiAgICAgICAgICAgIGZ1bmN0aW9uKCBmaWVsZCApIHsKICAgICAgICAgICAgICAgIGZpZWxkLmVhY2hTdWJGaWVsZCggImEiLAogICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCBmaWVsZCwgc3ViRmllbGQgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB3ZWVrY29kZSA9IHN1YkZpZWxkLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHdlZWtjb2RlLm1hdGNoKCAvREJGLyApICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zNjlfNzUgPSB3ZWVrY29kZS5yZXBsYWNlKCAvREJGLywgIiIgKSArICI7IjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICApOwoKICAgICAgICBMb2cuaW5mbyggIkxlYXZpbmc6IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNjlfNzUgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBwb3M2OV83NTsKCiAgICB9OwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgc3RyaW5nIHdpdGggcG9zaXRpb24gNzYtODkgb2YgYSBjb21tYSBzZXBhcmF0ZWQKICAgICAqIHJlcHJlc2VudGF0aW9uIG9mIGEgbWFyYyByZWNvcmQKICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNzZfODkgKCBkYXRlICkKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBkYXRlIGZvciBkZWxpdmVyeQogICAgICogQHJldHVybiB7U3RyaW5nfSBhIGRhdGUgZm9yIGRlbGl2ZXJ5IGFzIGEgc3RyaW5nCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNzZfODkKICAgICAqLwoKICAgIGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uNzZfODkoIGRhdGUgKSB7ICAgICAvL0xldmVyYW5jZXRpZHNwdW5rdAoKICAgICAgICBMb2cuaW5mbyggIkVudGVyaW5nIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNzZfODkiICk7CgogICAgICAgIGlmICggZGF0ZSA9PT0gdW5kZWZpbmVkICkgewogICAgICAgICAgICBkYXRlID0gRGF0ZVV0aWwuanNUb1lZWVltbWRkSEhNTVNTKCBEYXRlVXRpbC5ub3coKSApOwogICAgICAgIH0KICAgICAgICBwb3M3Nl84OSA9IGRhdGU7CgogICAgICAgIExvZy5pbmZvKCAiTGVhdmluZzogRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb243Nl84OSBmdW5jdGlvbiIgKTsKCiAgICAgICAgcmV0dXJuIHBvczc2Xzg5OwoKICAgIH07CgoKICAgIExvZy5pbmZvKCAiTGVhdmluZzogRG0yVG9Ec3QgbW9kdWxlIiApOwoKICAgIHJldHVybiB7CiAgICAgICAgY3JlYXRlQ3N2Rm9yRHN0OiBjcmVhdGVDc3ZGb3JEc3QsCiAgICAgICAgY3JlYXRlQWxsUG9zaXRpb25zOiBjcmVhdGVBbGxQb3NpdGlvbnMsCiAgICAgICAgY3JlYXRlUG9zaXRpb24xXzEyOiBjcmVhdGVQb3NpdGlvbjFfMTIsCiAgICAgICAgY3JlYXRlUG9zaXRpb24xM18xNjogY3JlYXRlUG9zaXRpb24xM18xNiwKICAgICAgICBjcmVhdGVQb3NpdGlvbjE3XzE4OiBjcmVhdGVQb3NpdGlvbjE3XzE4LAogICAgICAgIGNyZWF0ZVBvc2l0aW9uMTlfMjE6IGNyZWF0ZVBvc2l0aW9uMTlfMjEsCiAgICAgICAgY3JlYXRlUG9zaXRpb24yMl8yMzogY3JlYXRlUG9zaXRpb24yMl8yMywKICAgICAgICBjcmVhdGVQb3NpdGlvbjI0XzI4OiBjcmVhdGVQb3NpdGlvbjI0XzI4LAogICAgICAgIGNyZWF0ZVBvc2l0aW9uMjlfMzA6IGNyZWF0ZVBvc2l0aW9uMjlfMzAsCiAgICAgICAgY3JlYXRlUG9zaXRpb24zMV8zNTogY3JlYXRlUG9zaXRpb24zMV8zNSwKICAgICAgICBjcmVhdGVQb3NpdGlvbjM2XzM3OiBjcmVhdGVQb3NpdGlvbjM2XzM3LAogICAgICAgIGNyZWF0ZVBvc2l0aW9uMzhfMzk6IGNyZWF0ZVBvc2l0aW9uMzhfMzksCiAgICAgICAgY3JlYXRlUG9zaXRpb240MF80MzogY3JlYXRlUG9zaXRpb240MF80MywKICAgICAgICBjcmVhdGVQb3NpdGlvbjQ0XzQ3OiBjcmVhdGVQb3NpdGlvbjQ0XzQ3LAogICAgICAgIGNyZWF0ZVBvc2l0aW9uNDhfNDk6IGNyZWF0ZVBvc2l0aW9uNDhfNDksCiAgICAgICAgY3JlYXRlUG9zaXRpb241MF81MTogY3JlYXRlUG9zaXRpb241MF81MSwKICAgICAgICBjcmVhdGVQb3NpdGlvbjUyXzU0OiBjcmVhdGVQb3NpdGlvbjUyXzU0LAogICAgICAgIGNyZWF0ZVBvc2l0aW9uNTVfNTY6IGNyZWF0ZVBvc2l0aW9uNTVfNTYsCiAgICAgICAgY3JlYXRlUG9zaXRpb241N182ODogY3JlYXRlUG9zaXRpb241N182OCwKICAgICAgICBjcmVhdGVQb3NpdGlvbjY5Xzc1OiBjcmVhdGVQb3NpdGlvbjY5Xzc1LAogICAgICAgIGNyZWF0ZVBvc2l0aW9uNzZfODk6IGNyZWF0ZVBvc2l0aW9uNzZfODkKCiAgICB9OwoKfSgpOwoK", "moduleName": "Dm2ToDst"}, {"javascript": "LyoqCiAqIEBmaWxlIEZpbGUgdGhhdCBjb250YWlucyBhIG1vZHVsZSB0byBoYW5kbGUgdmFyaW91cyBkYXRlCiAqIG9wZXJhdGlvbnMsIGNvbnZlcnNpb24gdG8gYW5kIGZyb20gZGlmZmVyZW50CiAqIGZvcm1hdHMvcmVwcmVzZW50YXRpb25zLCBhbmQgaGFuZGxlIGNvbW1vbiBvcGVyYXRpb25zIGluIHJlbGF0aW9uCiAqIHRvIHRpbWV6b25lcywgZXRjLiAqLwoKRVhQT1JURURfU1lNQk9MUyA9IFsgJ0RhdGVVdGlsJyBdOwoKdXNlKCAiRGF0ZVV0aWxDb3JlIiApOwp1c2UoICJMb2ciICk7CnVzZSggIlZhbHVlQ2hlY2siICk7CnVzZSggIlN0cmluZ1V0aWwiICk7CgovKioKICogSGFuZGxlIG9wZXJhdGlvbnMgcmVsYXRlZCB0byBkYXRlIGFuZCB0aW1lLgogKiAKICogTW9kdWxlIHRvIGhhbmRsZSB2YXJpb3VzIGRhdGUgb3BlcmF0aW9ucywgY29udmVyc2lvbiB0byBhbmQgZnJvbQogKiBkaWZmZXJlbnQgZm9ybWF0cy9yZXByZXNlbnRhdGlvbnMsIGFuZCBoYW5kbGUgY29tbW9uIG9wZXJhdGlvbnMgaW4KICogcmVsYXRpb24gdG8gdGltZXpvbmVzLCBldGMuIAogKgogKiBUaGVzZSBtZXRob2RzIGFyZSB2ZXJ5IHVzZWZ1bCB3aGVuIHdhbnRpbmcgZS5nLiB0byBjb252ZXJ0IGJldHdlZW4KICogdmFyaW91cyBub3RhdGlvbnMgZm9yIGRhdGVzLCBhbmQgb3RoZXIgcmVsYXRlZCBvcGVyYXRpb25zLgogKgogKiAqKk5vdGU6KiogSWYgeW91IHdyaXRlIGNvZGUgdGhhdCBzaG91bGQgc3VwcG9ydCBtb2NraW5nLCB5b3Ugc2hvdWxkCiAqIHVzZSB0aGUgbWV0aG9kcyBpbiB0aGlzIG1vZHVsZSB0byBnZXQgdGhlIGN1cnJlbnQgdGltZSwgbm90IHRoZQogKiBidWlsdGluIEphdmFTY3JpcHQgRGF0ZSBjbGFzcy4gQnkgZG9pbmcgdGhhdCwgeW91IGVuc3VyZSB0aGUKICogbW9ja2luZyBzeXN0ZW0gd2lsbCB3b3JrLgogKgogKiAqKk5vdGU6KiogV29ya2luZyB3aXRoIHRpbWUgaW4gY29tcHV0ZXJzeXN0ZW1zIGlzIG1vcmUgdHJpY2t5IHRoYW4KICogb25lIHNob3VsZCB0aGluay4gSWYgeW91IHdpc2ggdG8gdW5kZXJzdGFuZCB0aGUgbmVlZCBmb3Igc29tZSBvZgogKiB0aGUgbWV0aG9kcyBpbiBoZXJlLCBvciBxdWVzdGlvbiB0aGUgbmVlZCBmb3IgdGhlbSwgeW91IHNob3VsZAogKiBwZXJoYXBzIHJlYWQgdGhlIGZvbGxvd2luZyBwYWdlOgogKiA8aHR0cDovL2luZmluaXRldW5kby5jb20vcG9zdC8yNTUwOTM1NDAyMi9tb3JlLWZhbHNlaG9vZHMtcHJvZ3JhbW1lcnMtYmVsaWV2ZS1hYm91dC10aW1lLXdpc2RvbT4uCiAqCiAqICoqTm90ZToqKiBGb3IgaGlzdG9yaWNhbCByZWFzb25zLCB0d28gZGlmZmVyZW50IHN5c3RlbXMgZm9yIG5hbWluZwogKiB0aW1lcGFydHMgYXJlIHVzZWQgaW4gdGhpcyBmaWxlLiBJdCBzaG91bGQgYmUgY2xlYXIgZnJvbSB0aGUKICogZGVzY3JpcHRpb25zIGZvciBlYWNoIGZ1bmN0aW9uIHdoYXQgdGhlIGZ1bmN0aW9uIGRvZXMuIFNvbWUgdGltZQogKiBpbiB0aGUgZnV0dXJlIHdlIG1heSBnZXQgYXJvdW5kIHRvIGNsZWFuaW5nIHVwIHRoZSBuYW1pbmcgYW5kCiAqIHRpbWVzcGVjIGluZm9ybWF0aW9uLgogKgogKiBAbmFtZXNwYWNlIAogKiBAbmFtZSBEYXRlVXRpbCAgKi8KdmFyIERhdGVVdGlsID0gZnVuY3Rpb24oICkgewoKICAgIHZhciB0aGF0ID0ge307CgoKICAgIHRoYXQubW9jayA9IFsgJ25vdycgXTsKCiAgICB2YXIgcGFyc2VJU084NjAxX2Z1bmMgPSBfX0RhdGVVdGlsQ29yZV9wYXJzZUlTTzg2MDE7CiAgICB2YXIgZm9ybWF0SVNPODYwMV9mdW5jID0gX19EYXRlVXRpbENvcmVfZm9ybWF0SVNPODYwMTsKICAgIGRlbGV0ZSB0aGlzLl9fRGF0ZVV0aWxDb3JlX3BhcnNlSVNPODYwMTsKICAgIGRlbGV0ZSB0aGlzLl9fRGF0ZVV0aWxDb3JlX2Zvcm1hdElTTzg2MDE7CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBEYXRlLW9iamVjdCB3aXRoIGFuIGFyYml0cmFyeSB2YWx1ZS4KICAgICAqIAogICAgICogVGhpcyBpcyBzaW1wbHkgYSB3cmFwcGVyIGZvciBgbmV3IERhdGUoMClgLCB1c2VmdWwgd2hlcmUgYSBkYXRlCiAgICAgKiBpcyBuZWVkZWQsIGFuZCB5b3Ugd2FudCB0byBpbml0aWFsaXplIGl0IHRvIHRoZQogICAgICogZXBvY2guIEFmdGVyd2FyZHMsIHlvdSBjYW4gc2V0IHRoZSBpbmRpdmlkdWFsIGZpZWxkcyBvZiB0aGUKICAgICAqIGRhdGUuCiAgICAgKiBAZXhhbXBsZQovLyBUaGlzIGNyZWF0ZXMgYSBuZXcgZGF0ZSBjb3JyZXNwb25kaW5nIHRvIHRoZSBlcG9jaAp2YXIgbXlEYXRlID0gRGF0ZVV0aWwuY3JhZXRlKCk7CiAgICAgKiAKICAgICAqIEBzeW50YXggRGF0ZVV0aWwuY3JlYXRlKCkKICAgICAqIEByZXR1cm4ge0RhdGV9IEEgRGF0ZSBvYmplY3QgaW5pdGlsYWxpemVkIHdpdGggMCAoY29ycmVzcG9uZGluZyB0byBtaWRuaWdodCBKYW51YXJ5IDEsIDE5NzAsIGxvY2FsdGltZSkKICAgICAqIEBuYW1lIERhdGVVdGlsLmNyZWF0ZQogICAgICogQG1ldGhvZCAqLwogICAgdGhhdC5jcmVhdGUgPSBmdW5jdGlvbiggKSB7CiAgICAgICAgaWYgKCBhcmd1bWVudHMubGVuZ3RoID4gMCApIHsKICAgICAgICAgICAgdmFyIG1lc3NzYWdlID0gJ0RhdGVVdGlsLmNyZWF0ZSgpIGRvZXMgbm90IHRha2UgYXJndW1lbnRzJzsKICAgICAgICAgICAgdGhyb3cgewogICAgICAgICAgICAgICAgbmFtZTogJ1BhcmFtZXRlckVycm9yJywKICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2Vfc3RyCiAgICAgICAgICAgIH07CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gbmV3IERhdGUoIDAgKTsKICAgIH07CgoKICAgIC8vIGNyZWF0ZSBhIERhdGUgb2JqZWN0IGZyb20gdGltZSAobXMgc2luY2UgMTk3MCkKICAgIC8vIC4uLiBvciB1c2UgIm5vdyIgd2l0aCBubyBhcmd1bWVudHMKICAgIC8qKgogICAgICogQ3JlYXRlIGEgRGF0ZS1vYmplY3QgYmFzZWQgb24gbWlsbGlzZWNvbmQgb2Zmc2V0IHNpbmNlIGVwb2NoLgogICAgICogCiAgICAgKiBUaGlzIGlzIGEgd3JhcHBlciBmb3IgdGhlICJuZXcgRGF0ZSgpIi1jb25zdHJ1Y3Rpb24gdG8gc3VwcG9ydCBtb2NraW5nCiAgICAgKiBvZiBkYXRlcy4gVGhpcyBmdW5jdGlvbiBzaG91bGQgbm90IG5vcm1hbGx5IGJlIHVzZWQuIFVzZQogICAgICogRGF0ZVV0aWwuY3JlYXRlKCkgYW5kIHNldCB0aW1lIHdpdGggb25lIG9mIHRoZSBtZXRob2RzIGluIERhdGUuIAogICAgICogCiAgICAgKiBAc2VlIERhdGVVdGlsLmNyZWF0ZQogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBEYXRlVXRpbC5yZUNyZWF0ZSggdGltZSApCiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3RpbWU9MF0gbXMgc2luY2UgZXBvY2ggKG1pZG5pZ2h0IEphbnVhcnkgMSwgMTk3MCwgbG9jYWx0aW1lKQogICAgICogQHJldHVybiB7RGF0ZX0gQSBEYXRlIG9iamVjdAogICAgICogQG5hbWUgRGF0ZVV0aWwucmVDcmVhdGUKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgdGhhdC5yZUNyZWF0ZSA9IGZ1bmN0aW9uKCBtcyApIHsKICAgICAgICBMb2cudHJhY2UoICItPkRhdGVVdGlsLnJlQ3JlYXRlKCkiICk7IC8vIEFVVE86OkJVRyM4OTc2CiAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSggKTsKICAgICAgICAvLyBmb3IgdXNlIHdpdGggbW9ja2luZwogICAgICAgIGlmICggdHlwZW9mKCBtcyApICE9ICd1bmRlZmluZWQnICkgewogICAgICAgICAgICBkYXRlLnNldFRpbWUoIG1zICk7CiAgICAgICAgfQogICAgICAgIGRhdGUudGhpc2lzYWRiY2RhdGUgPSB0cnVlOwogICAgICAgIHJldHVybiBkYXRlOwogICAgfTsKCiAgICAvLyBxdWljayBoYWNrOiB3cmFwIGEgIm5ldyBEYXRlKCkiIHRvIGNyZWF0ZSBhIGRhdGUgY29ycmVzcG9uZG5nIHRvICJub3ciCiAgICAvLyBpbXBsZW1lbnRlZCBpbiBjcmVhdGVJbnRlcm5hbCB0byBhdm9pZCBwcm9ibGVtcyB3aXRoIG1vY2tpbmcKICAgIC8qKgogICAgICogQ3JlYXRlIGEgRGF0ZS1vYmplY3QgdGhhdCByZXByZXNlbnRzICJub3ciLgogICAgICogCiAgICAgKiBUaGlzIGlzIGEgd3JhcHBlciBmb3IgdGhlICJuZXcgRGF0ZSgpIi1jb25zdHJ1Y3Rpb24gdG8gc3VwcG9ydCBtb2NraW5nCiAgICAgKiBvZiBkYXRlcy4gSW5zdGVhZCBvZiBgdmFyIG5vdyA9IG5ldyBEYXRlKCk7YCB1c2UgYHZhciBub3cgPQogICAgICogRGF0ZVV0aWwubm93KCk7YC4gCiAgICAgKiAKICAgICAqIEBleGFtcGxlCi8vIFRoZSAnY29ycmVjdCcgd2F5IHRvIGdldCBhIGRhdGUsIGlmIHlvdSB3YW50IHRvIHN1cHBvcnQgbW9ja2luZwp2YXIgbXlEYXRlID0gRGF0ZVV0aWwubm93KCk7CiAgICAgKgogICAgICogQHN5bnRheCBEYXRlVXRpbC5ub3coKQogICAgICogQHJldHVybiB7RGF0ZX0gQSBEYXRlIG9iamVjdAogICAgICogQG5hbWUgRGF0ZVV0aWwubm93CiAgICAgKiBAbWV0aG9kCiAgICAgKi8KICAgIHRoYXQubm93ID0gZnVuY3Rpb24oICkgewogICAgICAgIExvZy50cmFjZSggIi0+RGF0ZVV0aWwubm93KCkiICk7IC8vIEFVVE86OkJVRyM4OTc2CiAgICAgICAgaWYgKCBhcmd1bWVudHMubGVuZ3RoID4gMCApIHsKICAgICAgICAgICAgdmFyIG1lc3NzYWdlID0gJ0RhdGVVdGlsLm5vdygpIGRvZXMgbm90IHRha2UgYXJndW1lbnRzJzsKICAgICAgICAgICAgdGhyb3cgewogICAgICAgICAgICAgICAgbmFtZTogJ1BhcmFtZXRlckVycm9yJywKICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2Vfc3RyCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGF0LnJlQ3JlYXRlKCApOwogICAgfTsKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgcmV0dXJucyBhIG5ldyBkYXRlIHRoYXQgaXMgYSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIGxhdGVyIHRoYW4gdGhlIGRhdGUgZ2l2ZW4uCiAgICAgKgogICAgICogVGhpcyBmdW5jdGlvbiBpcyBtYWRlIGFzIGEgcHJlY2F1dGlvbiB3aGVuIGZpeGluZyB0aGUgc3BlbGxpbmcgbWlzdGFrZSBpbiB0aGUgb3JpZ2luYWwgZnVuY3Rpb24KICAgICAqICh3cm9uZzogbWlsaXNlY29uZHMsIHJpZ2h0OiBtaWxsaXNlY29uZHMpLiBUaGUgb3JpZ2luYWwgZnVuY3Rpb24gYWRkTWlsbGlzZWNvbmRzIHNob3VsZCBiZSB1c2VkLgogICAgICogTFNLIDIwMTYtMDMtMDcKICAgICAqCiAgICAgKi8KICAgIHRoYXQuYWRkTWlsaXNlY29uZHMgPSBmdW5jdGlvbiggZGF0ZSwgbnVtYmVyT2ZNaWxsaXNlY29uZHMgKSB7CiAgICAgICAgcmV0dXJuIERhdGVVdGlsLmFkZE1pbGxpc2Vjb25kcyggZGF0ZSwgbnVtYmVyT2ZNaWxsaXNlY29uZHMgKTsKICAgIH0KCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgcmV0dXJucyBhIG5ldyBkYXRlIHRoYXQgaXMgYSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIGxhdGVyIHRoYW4gdGhlIGRhdGUgZ2l2ZW4uCiAgICAgKiAKICAgICAqIFRoaXMgZnVuY3Rpb24gdGFrZXMgYSBkYXRlIGFuZCBhIG51bWJlciBvZiBtaWxsaXNlY29uZHMsIGFkZHMKICAgICAqIHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHRoZSBkYXRlLCBhbmQgcmV0dXJucyB0aGUgbmV3IGRhdGUuCiAgICAgKiAKICAgICAqICoqTm90ZToqKiBEYXRlIGFyaXRobWV0aWNzIGlzIGhhcmQuIEFsdGhvdWdoIGl0IGlzIHRlbXB0aW5nIHRvCiAgICAgKiBiZWxpZXZlIHRoYXQgaXQgY2FuIGJlIHJlZHVjZWQgdG8gc2ltcGxlIG9mZnNldCBtYW5pcHVsYXRpb24sCiAgICAgKiBhZGRpbmcgYSBmaXhlZCBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHdpbGwgb25seSBkbyB0aGF0LCBhbmQKICAgICAqIHdpbGwgbm90IHRha2UgaXNzdWVzIHN1Y2ggYXMgbGVhcC15ZWFycywgbGVhcC1zZWNvbmRzLAogICAgICogdGltZXpvbmVzIG9yIGNoYW5nZXMgZnJvbSBzdW1tZXIgdG8gbm9ybWFsIHRpbWUgaW50bwogICAgICogYWNjb3VudC4gWW91IGhhdmUgYmVlbiB3YXJuZWQuCiAgICAgKgogICAgICogQGV4YW1wbGUKLy8gQ3JlYXRlIGEgZGF0ZSAxMDAgbWlsbGlzZWNvbmRzIGluIHRoZSBmdXR1cmUKdmFyIG15RnV0dXJlRGF0ZSA9IERhdGVVdGlsLmFkZE1pbGxpc2Vjb25kcyggRGF0ZVV0aWwubm93KCksIDEwMCApOwogICAgICogCiAgICAgKiBAc3ludGF4IERhdGVVdGlsLmFkZE1pbGxpc2Vjb25kcyggZGF0ZSwgbnVtYmVyT2ZNaWxsaXNlY29uZHMgKQogICAgICogQHBhcmFtIHtEYXRlfSBkYXRlIFRoZSBkYXRlIHRvIGFkZCB0aGUgb2Zmc2V0IHRvLgogICAgICogQHBhcmFtIHtudW1iZXJ9IG51bWJlck9mTWlsbGlzZWNvbmRzIE51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gYWRkLgogICAgICogQHJldHVybiB7RGF0ZX0gVGhlIG5ldyBkYXRlLCBvZmZzZXQgZnJvbSB0aGUgaW5wdXQgZGF0ZSB3aXRoIHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHBhc3NlZC4KICAgICAqIEBuYW1lIERhdGVVdGlsLmFkZE1pbGxpc2Vjb25kcwogICAgICogQG1ldGhvZAogICAgICovCiAgICB0aGF0LmFkZE1pbGxpc2Vjb25kcyA9IGZ1bmN0aW9uKCBkYXRlLCBudW1iZXJPZk1pbGxpc2Vjb25kcyApIHsKICAgICAgICBMb2cudHJhY2UoICItPkRhdGVVdGlsLmFkZE1pbGxpc2Vjb25kcyIgKTsgLy8gQVVUTzo6QlVHIzg5NzYKICAgICAgICAvL1ZhbHVlQ2hlY2suY2hlY2soICJudW1iZXJPZk1pbGxpc2Vjb25kcyIsIG51bWJlck9mTWlsbGlzZWNvbmRzICkudHlwZSggIm51bWJlciIgKS5pc0dyZWF0ZXJFcXVhbFRoYW4oIDAgKTsKICAgICAgICB2YXIgZGF0ZV9tcyA9IGRhdGUuZ2V0VGltZSggKTsKICAgICAgICB2YXIgbmV3X2RhdGVfbXMgPSBkYXRlX21zICsgbnVtYmVyT2ZNaWxsaXNlY29uZHM7CiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCBuZXdfZGF0ZV9tcyApOwogICAgfTsKCgogICAgdmFyIG1zX21pbnV0ZSA9IDEwMDAgKiA2MDsKICAgIHZhciBtc19ob3VyID0gbXNfbWludXRlICogNjA7CiAgICB2YXIgbXNfZGF5ID0gbXNfaG91ciAqIDI0OwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCByZXR1cm5zIGEgbmV3IGRhdGUgdGhhdCBpcyBhIG51bWJlciBvZiBtaW51dGVzIGxhdGVyIHRoYW4gdGhlIGRhdGUgZ2l2ZW4uCiAgICAgKiAKICAgICAqIFRoaXMgZnVuY3Rpb24gdGFrZXMgYSBkYXRlIGFzIGEgcGFyYW1ldGVyLCBhZGRzIHRoZSBudW1iZXIgb2YgbWludXRlcwogICAgICogdG8gaXQsIGFuZCByZXR1cm5zIHRoZSBuZXcgZGF0ZS4gCiAgICAgKiAKICAgICAqIFRoaXMgZnVuY3Rpb24gaXMgaW1wbGVtZW50ZWQgYXMgYSBjYWxsIHRvIGFkZE1pbGxpc2Vjb25kcy4KICAgICAqIAogICAgICogKipOb3RlOioqIERhdGUgYXJpdGhtZXRpY3MgaXMgaGFyZC4gQWx0aG91Z2ggaXQgaXMgdGVtcHRpbmcgdG8KICAgICAqIGJlbGlldmUgdGhhdCBpdCBjYW4gYmUgcmVkdWNlZCB0byBzaW1wbGUgb2Zmc2V0IG1hbmlwdWxhdGlvbiwKICAgICAqIGFkZGluZyBhIGZpeGVkIG51bWJlciBvZiBtaW51dGVzIHdpbGwgb25seSBkbyB0aGF0LCBhbmQKICAgICAqIHdpbGwgbm90IHRha2UgaXNzdWVzIHN1Y2ggYXMgbGVhcC15ZWFycywgbGVhcC1zZWNvbmRzLAogICAgICogdGltZXpvbmVzIG9yIGNoYW5nZXMgZnJvbSBzdW1tZXIgdG8gbm9ybWFsIHRpbWUgaW50bwogICAgICogYWNjb3VudC4gWW91IGhhdmUgYmVlbiB3YXJuZWQuCiAgICAgKgogICAgICogQGV4YW1wbGUKLy8gQ3JlYXRlIGEgZGF0ZSAzMCBtaW51dGVzIGluIHRoZSBmdXR1cmUKdmFyIG15RnV0dXJlRGF0ZSA9IERhdGVVdGlsLmFkZE1pbnV0ZXMoIERhdGVVdGlsLm5vdygpLCAzMCApOwogICAgICogCiAgICAgKiBAc3ludGF4IERhdGVVdGlsLmFkZE1pbnV0ZXMoIGRhdGUsIG51bWJlck9mTWludXRlcyApCiAgICAgKiBAcGFyYW0ge0RhdGV9IGRhdGUgVGhlIGRhdGUgdG8gYWRkIHRoZSBvZmZzZXQgdG8uCiAgICAgKiBAcGFyYW0ge251bWJlcn0gbnVtYmVyT2ZNaW51dGVzIE51bWJlciBvZiBtaW51dGVzIHRvIGFkZC4KICAgICAqIEByZXR1cm4ge0RhdGV9IFRoZSBuZXcgZGF0ZSwgb2Zmc2V0IGZyb20gdGhlIGlucHV0IGRhdGUgd2l0aCB0aGUgbnVtYmVyIG9mIG1pbnV0ZXMgcGFzc2VkLgogICAgICogQG5hbWUgRGF0ZVV0aWwuYWRkTWludXRlcwogICAgICogQG1ldGhvZAogICAgICovCiAgICB0aGF0LmFkZE1pbnV0ZXMgPSBmdW5jdGlvbiggZGF0ZSwgbnVtYmVyT2ZNaW51dGVzICkgewogICAgICAgIExvZy50cmFjZSggIi0+RGF0ZVV0aWwuYWRkTWludXRlcyIgKTsgLy8gQVVUTzo6QlVHIzg5NzYKICAgICAgICByZXR1cm4gRGF0ZVV0aWwuYWRkTWlsbGlzZWNvbmRzKCBkYXRlLCBudW1iZXJPZk1pbnV0ZXMgKiBtc19taW51dGUgKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IHJldXJucyBhIG5ldyBkYXRlIHRoYXQgaXMgYSBudW1iZXIgb2Ygc2Vjb25kcyBsYXRlciB0aGFuIHRoZSBkYXRlIGdpdmVuLgogICAgICogCiAgICAgKiBUaGlzIGZ1bmN0aW9uIHRha2VzIGEgZGF0ZSBvYmplY3QsIGFuZCBhIG51bWJlciBvZiBzZWNvbmRzLiBUaGUgbnVtYmVyCiAgICAgKiBvZiBzZWNvbmRzIGlzIGFkZGVkIHRvIHRoZSBkYXRlIG9iamVjdCBhbmQgdGhlIGNvbnN0cnVjdGVkIGRhdGVvYmplY3QKICAgICAqIGlzIHJldHVybmVkLiAKICAgICAqIAogICAgICogVGhpcyBmdW5jdGlvbiBpcyBpbXBsZW1lbnRlZCBhcyBhIGNhbGwgdG8gYWRkTWlsbGlzZWNvbmRzLgogICAgICogCiAgICAgKiAqKk5vdGU6KiogRGF0ZSBhcml0aG1ldGljcyBpcyBoYXJkLiBBbHRob3VnaCBpdCBpcyB0ZW1wdGluZyB0bwogICAgICogYmVsaWV2ZSB0aGF0IGl0IGNhbiBiZSByZWR1Y2VkIHRvIHNpbXBsZSBvZmZzZXQgbWFuaXB1bGF0aW9uLAogICAgICogYWRkaW5nIGEgZml4ZWQgbnVtYmVyIG9mIHNlY29uZHMgd2lsbCBvbmx5IGRvIHRoYXQsIGFuZAogICAgICogd2lsbCBub3QgdGFrZSBpc3N1ZXMgc3VjaCBhcyBsZWFwLXllYXJzLCBsZWFwLXNlY29uZHMsCiAgICAgKiB0aW1lem9uZXMgb3IgY2hhbmdlcyBmcm9tIHN1bW1lciB0byBub3JtYWwgdGltZSBpbnRvCiAgICAgKiBhY2NvdW50LiBZb3UgaGF2ZSBiZWVuIHdhcm5lZC4KICAgICAqCiAgICAgKiBAZXhhbXBsZQovLyBDcmVhdGUgYSBkYXRlIDMwIHNlY29uZHMgaW4gdGhlIGZ1dHVyZQp2YXIgbXlGdXR1cmVEYXRlID0gRGF0ZVV0aWwuYWRkU2Vjb25kKCBEYXRlVXRpbC5ub3coKSwgMzAgKTsKICAgICAqCiAgICAgKiBAc3ludGF4IERhdGVVdGlsLmFkZFNlY29uZHMoIGRhdGUsIG51bWJlck9mU2Vjb25kcyApCiAgICAgKiBAcGFyYW0ge0RhdGV9IGRhdGUgVGhlIGRhdGUgdG8gYWRkIHRoZSBvZmZzZXQgdG8uCiAgICAgKiBAcGFyYW0ge251bWJlcn0gbnVtYmVyT2ZTZWNvbmRzIE51bWJlciBvZiBzZWNvbmRzIHRvIGFkZC4KICAgICAqIEByZXR1cm4ge0RhdGV9IFRoZSBuZXcgZGF0ZSwgb2Zmc2V0IGZyb20gdGhlIGlucHV0IGRhdGUgd2l0aCB0aGUgbnVtYmVyIG9mIHNlY29uZHMgcGFzc2VkLgogICAgICogQG5hbWUgRGF0ZVV0aWwuYWRkU2Vjb25kcwogICAgICogQG1ldGhvZAogICAgICovCiAgICB0aGF0LmFkZFNlY29uZHMgPSBmdW5jdGlvbiggZGF0ZSwgbnVtYmVyT2ZTZWNvbmRzICkgewogICAgICAgIExvZy50cmFjZSggIi0+RGF0ZVV0aWwuYWRkU2Vjb25kcyIgKTsgLy8gQVVUTzo6QlVHIzg5NzYKICAgICAgICByZXR1cm4gRGF0ZVV0aWwuYWRkTWlsbGlzZWNvbmRzKCBkYXRlLCBudW1iZXJPZlNlY29uZHMgKiAxMDAwICk7CiAgICB9OwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCByZXR1cm5zIGEgbmV3IGRhdGUgdGhhdCBpcyBhIG51bWJlciBvZiBkYXlzIGxhdGVyIHRoYW4gdGhlIGRhdGUgZ2l2ZW4uCiAgICAgKiAKICAgICAqIEZ1bmN0aW9uIHRoYXQgdGFrZXMgYSBkYXRlIGFuZCBhIG51bWJlciBvZiBkYXlzLCBhZGRzIHRoZSBkYXlzIHRvIHRoZQogICAgICogZGF0ZSwgYW5kIHJldHVybnMgdGhlIG5ldyBjb25zdHJ1Y3RlZCBkYXRlLiAKICAgICAqCiAgICAgKiBUaGlzIGZ1bmN0aW9uIGlzIGltcGxlbWVudGVkIGFzIGEgY2FsbCB0byBhZGRNaWxsaXNlY29uZHMuCiAgICAgKiAKICAgICAqICoqTm90ZToqKiBEYXRlIGFyaXRobWV0aWNzIGlzIGhhcmQuIEFsdGhvdWdoIGl0IGlzIHRlbXB0aW5nIHRvCiAgICAgKiBiZWxpZXZlIHRoYXQgaXQgY2FuIGJlIHJlZHVjZWQgdG8gc2ltcGxlIG9mZnNldCBtYW5pcHVsYXRpb24sCiAgICAgKiBhZGRpbmcgYSBmaXhlZCBudW1iZXIgb2YgZGF5cyB3aWxsIG9ubHkgZG8gdGhhdCwgYW5kCiAgICAgKiB3aWxsIG5vdCB0YWtlIGlzc3VlcyBzdWNoIGFzIGxlYXAteWVhcnMsIGxlYXAtc2Vjb25kcywKICAgICAqIHRpbWV6b25lcyBvciBjaGFuZ2VzIGZyb20gc3VtbWVyIHRvIG5vcm1hbCB0aW1lIGludG8KICAgICAqIGFjY291bnQuIFlvdSBoYXZlIGJlZW4gd2FybmVkLgogICAgICoKICAgICAqIEBleGFtcGxlCiAgICAvLyBDcmVhdGUgYSBkYXRlIDMgZGF5cyBpbiB0aGUgZnV0dXJlCiAgICB2YXIgbXlGdXR1cmVEYXRlID0gRGF0ZVV0aWwuYWRkRGF5cyggRGF0ZVV0aWwubm93KCksIDMgKTsKICAgICAvLyBDcmVhdGUgYSBkYXRlIDQgZGF5cyBpbiB0aGUgcGFzdAogICAgIHZhciBteVBhc3REYXRlID0gRGF0ZVV0aWwuYWRkRGF5cyggRGF0ZVV0aWwubm93KCksIC00ICk7CiAgICAgKgogICAgICogQHN5bnRheCBEYXRlVXRpbC5hZGREYXlzKCBkYXRlLCBudW1iZXJPZk1pbnV0ZXMgKQogICAgICogQHBhcmFtIHtEYXRlfSBkYXRlIFRoZSBkYXRlIHRvIGFkZCB0aGUgb2Zmc2V0IHRvLgogICAgICogQHBhcmFtIHtudW1iZXJ9IG51bWJlck9mRGF5cyBOdW1iZXIgb2YgZGF5cyB0byBhZGQuCiAgICAgKiBAcmV0dXJuIHtEYXRlfSBUaGUgbmV3IGRhdGUsIG9mZnNldCBmcm9tIHRoZSBpbnB1dCBkYXRlIHdpdGggdGhlIG51bWJlciBvZiBzZWNvbmRzIHBhc3NlZC4KICAgICAqIEBuYW1lIERhdGVVdGlsLmFkZERheXMKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgdGhhdC5hZGREYXlzID0gZnVuY3Rpb24oIGRhdGUsIG51bWJlck9mRGF5cyApIHsKICAgICAgICBMb2cudHJhY2UoICItPkRhdGVVdGlsLmFkZERheXMiICk7IC8vIEFVVE86OkJVRyM4OTc2CiAgICAgICAgcmV0dXJuIERhdGVVdGlsLmFkZE1pbGxpc2Vjb25kcyggZGF0ZSwgbnVtYmVyT2ZEYXlzICogbXNfZGF5ICk7CiAgICB9OwoKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgYWRkcyBhIGdpdmVuIG51bWJlciBvZiBtaW51dGVzIHRvICJub3ciIChhY3R1YWwpLgogICAgICogCiAgICAgKiBUaGlzIGZ1bmN0aW9uIGNyZWF0ZXMgYSBuZXcgZGF0ZSBvYmplY3QsIHVzaW5nIHRoZSBEYXRlVXRpbC5ub3coKQogICAgICogZnVuY3Rpb24sIHRoZW4gYWRkcyB0aGUgZ2l2ZW4gbnVtYmVyIG9mIG1pbnV0ZXMgdG8gaXQsIGFuZCByZXR1cm4gdGhlCiAgICAgKiBjb25zdHJ1Y3RlZCBkYXRlIG9iamVjdC4gCiAgICAgKgogICAgICogVGhpcyBmdW5jdGlvbiBpcyBpbXBsZW1lbnRlZCBhcyBhIGNhbGwgdG8gdGhlIGJ1aWx0aW4KICAgICAqIERhdGUuc2V0TWludXRlcyBmdW5jdGlvbi4KICAgICAqIAogICAgICogKipOb3RlOioqIERhdGUgYXJpdGhtZXRpY3MgaXMgaGFyZC4gQWx0aG91Z2ggaXQgaXMgdGVtcHRpbmcgdG8KICAgICAqIGJlbGlldmUgdGhhdCBpdCBjYW4gYmUgcmVkdWNlZCB0byBzaW1wbGUgb2Zmc2V0IG1hbmlwdWxhdGlvbiwKICAgICAqIGFkZGluZyBhIGZpeGVkIG51bWJlciBvZiBtaW51dGVzIHdpbGwgb25seSBkbyB0aGF0LCBhbmQKICAgICAqIHdpbGwgbm90IHRha2UgaXNzdWVzIHN1Y2ggYXMgbGVhcC15ZWFycywgbGVhcC1zZWNvbmRzLAogICAgICogdGltZXpvbmVzIG9yIGNoYW5nZXMgZnJvbSBzdW1tZXIgdG8gbm9ybWFsIHRpbWUgaW50bwogICAgICogYWNjb3VudC4gWW91IGhhdmUgYmVlbiB3YXJuZWQuCiAgICAgKgovLyBDcmVhdGUgYSBkYXRlIDE1IG1pbnV0ZXMgaW4gdGhlIGZ1dHVyZQp2YXIgbXlGdXR1cmVEYXRlID0gRGF0ZVV0aWwuYWRkTWludXRlc1RvTm93KCAxNSApOwogICAgICoKICAgICAqIEBzeW50YXggRGF0ZVV0aWwuYWRkTWludXRlc1RvTm93KCBudW1iZXJPZk1pbnV0ZXMgKQogICAgICogQHBhcmFtIHtudW1iZXJ9IG51bWJlck9mTWludXRlcyBOdW1iZXIgb2YgbWludXRlcyB0byBhZGQgdG8gbm93LgogICAgICogQHJldHVybiB7RGF0ZX0gVGhlIG5ldyBkYXRlLCBvZmZzZXQgZnJvbSBub3cgd2l0aCB0aGUgbnVtYmVyIG9mIG1pbnV0ZXMgcGFzc2VkLgogICAgICogQG5hbWUgRGF0ZVV0aWwuYWRkTWludXRlc1RvTm93CiAgICAgKiBAbWV0aG9kCiAgICAgKi8KICAgIHRoYXQuYWRkTWludXRlc1RvTm93ID0gZnVuY3Rpb24oIG51bWJlck9mTWludXRlcyApIHsKICAgICAgICBMb2cudHJhY2UoICItPkRhdGVVdGlsLmFkZE1pbnV0ZXNUb05vdygpIiApOyAvLyBBVVRPOjpCVUcjODk3NgogICAgICAgIFZhbHVlQ2hlY2suY2hlY2soICJudW1iZXJPZk1pbnV0ZXMiLCBudW1iZXJPZk1pbnV0ZXMgKS50eXBlKCAibnVtYmVyIiApLmlzR3JlYXRlckVxdWFsVGhhbiggMCApOwogICAgICAgIHZhciBub3cgPSBEYXRlVXRpbC5ub3coICk7CiAgICAgICAgdmFyIG1pbiA9IG5vdy5nZXRNaW51dGVzKCApOwogICAgICAgIG1pbiArPSBudW1iZXJPZk1pbnV0ZXM7CiAgICAgICAgbm93LnNldE1pbnV0ZXMoIG1pbiApOwogICAgICAgIHJldHVybiBub3c7CiAgICB9OwoKCiAgICAvKioKICAgKiBGdW5jdGlvbiB0aGF0IGNvbnZlcnRzIGFuIHhtbCBkYXRlIHN0cmluZyBpbnRvIGEgSmF2YVNjcmlwdCBEYXRlIG9iamVjdC4KICAgKiAKICAgKiBUaGlzIGZ1bmN0aW9uIHRha2VzIGFuIFhNTCBkYXRldGltZSB2YWx1ZSBhbmQgY29udmVydHMgaW50byBhCiAgICogSmF2YVNjcmlwdCBEYXRlIG9iamVjdC4gVGhlIGlucHV0IG11c3QgYmUgYSByZXByZXNlbnRhdGlvbiBmcm9tCiAgICogdGhlIHZhbGlkIHN1YnNldCBvZiBJU084NjAxIHRoYXQgaXMgc3VwcG9ydGVkIGluIHRoZSBYTUwvWFNECiAgICogc3RhbmRhcmQgZm9yIGRhdGV0aW1lIG9iamVjdHMsIGRlc2NyaWJlZCBhdAogICAqIDxodHRwOi8vd3d3LnczLm9yZy9UUi94bWxzY2hlbWEtMi8jaXNvZm9ybWF0cz4KICAgKgogICAqIEludmFsaWQgZGF0ZXMsIHN1Y2ggYXMgMzAuIGZlYnJ1YXJ5IDIwMTMgd2lsbCByZXN1bHQgaW4gYW4KICAgKiBleGNlcHRpb24uCiAgICoKICAgKiAqKk5vdGU6KiogSWYgdGhlIGlucHV0IGRvZXMgbm90IGhhdmUgYSB0aW1lcGFydCwgYSB0aW1lcGFydCBvZgogICAqIDAwOjAwOjAwIGlzIHVzZWQuIEZyYWN0aW9uYWwgc2Vjb25kcyBhcmUgbm90IHN1cHBvcnRlZCwgYW5kIHdpbGwKICAgKiBiZSBtaXNzaW5nIGluIHRoZSByZXN1bHQuIFRoaXMgZnVuY3Rpb24gaGFuZGxlcyB0aW1lem9uZXMgYXMgcGVyCiAgICogdGhlIHNwZWNpZmljYXRpb24uCiAgICoKICAgKiBAZXhhbXBsZQovLyBUaGlzIHdpbGwgY3JlYXRlIGEgZGF0ZSBpbiB0aGUgbG9jYWwgdGltZXpvbmUgb24gMjYvMTAgMjAxMCwgYXQgMDA6MDA6MDAKRGF0ZVV0aWwueG1sVG9KcyggIjIwMTAtMTAtMjZUMDA6MDA6MDAiICk7Ci8vIFRoaXMgd2lsbCBjcmVhdGUgYSBkYXRlIGluIHRoZSB0aW1lem9uZSArMDQ6MTUsIGZvciAxNi80IDIwMTIsIGF0IDEzOjE3OjQ0LgovLyBUaGUgZnJhY3Rpb25hbCBzZWNvbmQgcGFydCB3aWxsIGJlIGRyb3BwZWQuCkRhdGVVdGlsLnhtbFRvSnMoICIyMDEyLTA0LTE2VDEzOjE3OjQ0LjQxOSswNDoxNSIgKQogICAqIAogICAqIEBzZWUgRGF0ZVV0aWwuanNUb1htbAogICAqIEBzeW50YXggRGF0ZVV0aWwueG1sVG9KcyggeG1sRGF0ZSApCiAgICogQHBhcmFtIHtzdHJpbmd9IHhtbERhdGUgU3RyaW5nIGZyb20geG1sIHJlcHJlc2VudGluZyBhIHNwZWNpZmljIGRhdGUvZGF0ZVRpbWUuCiAgICogQHJldHVybiB7RGF0ZX0gSmF2YVNjcmlwdCBEYXRlIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHRpbWVwb2ludAogICAqIEBuYW1lIERhdGVVdGlsLnhtbFRvSnMKICAgKiBAbWV0aG9kCiAgICovCiAgICB0aGF0LnhtbFRvSnMgPSBmdW5jdGlvbiggeG1sRGF0ZSApIHsKICAgICAgICBMb2cudHJhY2UoICItPkRhdGVVdGlsLnhtbFRvSnMoKSIgKTsgLy8gQVVUTzo6QlVHIzg5NzYKICAgICAgICBMb2cuZGVidWcoICJEYXRlVXRpbC54bWxUb0pzKCAnIiArIHhtbERhdGUgKyAiJyApOyIgKTsKICAgICAgICBpZiAoICF4bWxEYXRlIHx8ICIiID09PSB4bWxEYXRlICkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoICJEYXRlVXRpbC54bWxUb0pzOiBVbmFibGUgdG8gcGFyc2UgZW1wdHkgZGF0ZSIgKTsKICAgICAgICB9CiAgICAgICAgLy8gVGVzdCBmb3IgZGF0ZSB3aXRoIG5vIHRpbWVwYXJ0LCBhZGQgdGltZXBhcnQgaWYgbWlzc2luZy4KICAgICAgICBpZiAoIG51bGwgIT0geG1sRGF0ZS5tYXRjaCggL15cZHs0fS1cZHsyfS1cZHsyfSQvICkgKSB7Ly9CdWcgMTAzMTE6IENvbnZlcnRpbmcgZGF0ZSBzdHJpbmcgdG8gZGF0ZVRpbWUgc3RyaW5nCiAgICAgICAgICAgIHhtbERhdGUgPSB4bWxEYXRlICsgIlQwMDowMDowMCI7CiAgICAgICAgfQogICAgICAgIC8vIFJlbW92ZSBmcmFjdGlvbmFsIHNlY29uZHMsIGlmIHByZXNlbnQuCiAgICAgICAgaWYgKCBudWxsICE9IHhtbERhdGUubWF0Y2goIC9eXGR7NH0tXGR7Mn0tXGR7Mn1UXGR7Mn06XGR7Mn06XGR7Mn1cLi8gKSApIHsvL0J1ZyAxNDA1NTogUmVtb3ZpbmcgZnJhY3Rpb25hbCBzZWNvbmRzIGZyb20geG1sRGF0ZQogICAgICAgICAgICAvLyBOZWVkIHRoZSBuZXcgU3RyaW5nIHN0dWZmIHRvIHdvcmsgb24gbGFraWZpcmU/Pz8KICAgICAgICAgICAgeG1sRGF0ZSA9IG5ldyBTdHJpbmcoIHhtbERhdGUgKS5yZXBsYWNlKCAvXC5cZCovLCAiIiApOwogICAgICAgIH0KICAgICAgICBMb2cuZGVidWcoICJ4bWxEYXRlIG5vdzogJyIgKyB4bWxEYXRlICsgIiciICk7CiAgICAgICAgcmV0dXJuIHBhcnNlSVNPODYwMV9mdW5jKCB4bWxEYXRlICk7CiAgICB9OwoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IGNvbnZlcnRzIGEgSmF2YVNjcmlwdCBkYXRlIG9iamVjdCBpbnRvIGFuIFhNTCBkYXRldGltZSBzdHJpbmcuCiAgICAgKiAKICAgICAqIFRoaXMgZnVuY3Rpb24gdGFrZXMgYSBKYXZhU2NyaXB0IERhdGUgb2JqZWN0LCBhbmQgY29udmVydHMgaXQgaW50byBhbgogICAgICogWE1MIGRhdGV0aW1lIHN0cmluZywgd2hpY2ggaXMgYSBzdWJzZXQgb2YgSVNPODYwMSwgZGVmaW5lZCBhdCA8aHR0cDovL3d3dy53My5vcmcvVFIveG1sc2NoZW1hLTIvI2lzb2Zvcm1hdHM+CiAgICAgKgogICAgICogKipOb3RlOioqIFRoZSByZXN1bHRpbmcgc3RyaW5nIGlzIGluIFVUQywgdGhhdCBpcywgaGFzIGEgdGltZXpvbmUgcGFydCBlcXVhbCB0byAiWiIuIE9idmlvdXNseSBpdHMgdGhlIHNhbWUgdGltZXBvaW50LiBGcmFjdGlvbmVsIHNlY29uZHMgYXJlIG5vdCBzdXBwb3J0ZWQuCiAgICAgKiAKICAgICAqIEBleGFtcGxlCi8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGN1cnJlbnQgZGF0ZSBhbmQgdGltZSBpbiBYTUwgZm9ybWF0CnZhciB4bWxEYXRlVGltZSA9IERhdGVVdGlsLmpzVG9YbWwoIERhdGVVdGlsLm5vdygpICk7CiAgICAgKgogICAgICogQHNlZSBEYXRlVXRpbC54bWxUb0pzCiAgICAgKiBAc3ludGF4IERhdGVVdGlsLmpzVG9YbWwoIGpzRGF0ZSApCiAgICAgKiBAcGFyYW0ge0RhdGV9IGpzRGF0ZSBKYXZhU2NyaXB0IERhdGUgb2JqZWN0LgogICAgICogQHJldHVybiB7c3RyaW5nfSBYTUwgZGF0ZSB0aW1lIHN0cmluZyBpbiBVVEMsIHJlcHJlc2VudGluZyB0aGUgdGltZXBvaW50IHBhc3NlZCBpbiBqc0RhdGUuCiAgICAgKiBAbmFtZSBEYXRlVXRpbC5qc1RvWG1sCiAgICAgKiBAbWV0aG9kCiAgICAgKi8KICAgIHRoYXQuanNUb1htbCA9IGZ1bmN0aW9uKCBqc0RhdGUgKSB7CiAgICAgICAgTG9nLnRyYWNlKCAiLT5EYXRlVXRpbC5qc1RvWG1sKCkiICk7IC8vIEFVVE86OkJVRyM4OTc2CiAgICAgICAgVmFsdWVDaGVjay5jaGVjayggImpzRGF0ZSIsIGpzRGF0ZSApLmlzLmluc3RhbmNlT2YoIERhdGUgKTsKICAgICAgICByZXR1cm4gZm9ybWF0SVNPODYwMV9mdW5jKCBqc0RhdGUgKTsKICAgIH07CgogICAgLyoqCiAgICogRnVuY3Rpb24gdGhhdCBjb252ZXJ0cyBhbiBkYW5NQVJDMiBkYXRlIHN0cmluZyBpbnRvIGEgSmF2YVNjcmlwdCBEYXRlIG9iamVjdCAodmlhIElTMDg2MDEpLgogICAqIAogICAqIFRoaXMgZnVuY3Rpb24gdGFrZXMgYSBkYW5NQVJDMiBkYXRhL2RhdGV0aW1lIHZhbHVlIGFuZCBjb252ZXJ0cwogICAqIGludG8gYSBKYXZhU2NyaXB0IERhdGUgb2JqZWN0LiBUaGUgZm9ybWF0IG9mIHRoZSBpbnB1dCBtdXN0IGJlCiAgICogb25lIG9mIFlZWVlNTURELCBZWVlZTU1EREhITU0sIG9yIFlZWVlNTURESEhNTVNTLgogICAqCiAgICogQmVjYXVzZSBhIGNvbnZlcnNpb24gdG8gSVNPODYwMSBpcyBwZXJmb3JtZWQsIGFueSBpbnZhbGlkIGRhdGVzIHdpbGwgYmUgcmVqZWN0ZWQuCiAgICoKICAgKiAqKk5vdGU6KiogSWYgdGhlIGlucHV0IGRvZXMgbm90IGhhdmUgYSB0aW1lcGFydCwgYSB0aW1lcGFydCBvZiAwMDowMDowMCBpcyB1c2VkLgogICAqIAogICAqIEBleGFtcGxlCi8vIFRoaXMgd2lsbCBjcmVhdGUgYSBkYXRlIGluIHRoZSBsb2NhbCB0aW1lem9uZSBvbiAyNi8xMCAyMDEwLCBhdCAwMDowMDowMApEYXRlVXRpbC5kYW5NYXJjVG9KcyggIjIwMTAxMDI2IiApOwogICAqIEBzZWUgRGF0ZVV0aWwueG1sVG9KcwogICAqIEBzeW50YXggRGF0ZVV0aWwuZGFuTWFyY1RvSnMoIG1hcmNEYXRlICkKICAgKiBAcGFyYW0ge1N0cmluZ30gbWFyY0RhdGUgU3RyaW5nIGZyb20gZGFuTUFSQzIgcmVjb3JkIHJlcHJlc2VudGluZyBhIHNwZWNpZmljIGRhdGUvZGF0ZVRpbWUKICAgKiBAcmV0dXJuIHtEYXRlfSBKYXZhU2NyaXB0IERhdGUgb2JqZWN0IHdpdGggYSB2YWxpZCBkYXRlCiAgICogQG5hbWUgRGF0ZVV0aWwuZGFuTWFyY1RvSnMKICAgKiBAbWV0aG9kCiAgICovCiAgICB0aGF0LmRhbk1hcmNUb0pzID0gZnVuY3Rpb24oIG1hcmNEYXRlICkgewogICAgICAgIExvZy50cmFjZSggIi0+RGF0ZVV0aWwuZGFuTWFyY1RvSnMoKSIgKTsgLy8gQVVUTzo6QlVHIzg5NzYKICAgICAgICBMb2cuZGVidWcoICJEYXRlVXRpbC5kYW5NYXJjVG9KcyggJyIgKyBtYXJjRGF0ZSArICInICk7IiApOwogICAgICAgIGlmICggbWFyY0RhdGUgPT09ICIiICkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoICJEYXRlVXRpbC5kYW5NYXJjVG9KczogVW5hYmxlIHRvIHBhcnNlIGVtcHR5IGRhdGUiICk7CiAgICAgICAgfQoKICAgICAgICB2YXIganNEYXRlID0gIiI7CgogICAgICAgIGlmICggbWFyY0RhdGUubGVuZ3RoID09PSA4ICkgewogICAgICAgICAgICBqc0RhdGUgPSBtYXJjRGF0ZS5yZXBsYWNlKCAvKFxkezR9KShcZHsyfSkoXGR7Mn0pLywgIiQxLSQyLSQzIiApICsgIlQwMDowMDowMCI7CiAgICAgICAgfSBlbHNlIGlmICggbWFyY0RhdGUubGVuZ3RoID09PSAxMiApIHsKICAgICAgICAgICAganNEYXRlID0gbWFyY0RhdGUucmVwbGFjZSggLyhcZHs0fSkoXGR7Mn0pKFxkezJ9KShcZHsyfSkoXGR7Mn0pLywgIiQxLSQyLSQzVCQ0OiQ1OjAwIiApOwogICAgICAgIH0gZWxzZSBpZiAoIG1hcmNEYXRlLmxlbmd0aCA9PT0gMTQgKSB7CiAgICAgICAgICAgIGpzRGF0ZSA9IG1hcmNEYXRlLnJlcGxhY2UoIC8oXGR7NH0pKFxkezJ9KShcZHsyfSkoXGR7Mn0pKFxkezJ9KShcZHsyfSkvLCAiJDEtJDItJDNUJDQ6JDU6JDYiICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCAiRGF0ZVV0aWwuZGFuTWFyY1RvSnM6IFVuYWJsZSB0byBwYXJzZSBkYXRlOiAiICsgbWFyY0RhdGUgKTsKICAgICAgICB9CiAgICAgICAgTG9nLmRlYnVnKCAiSmF2YXNjcmlwdCBkYXRlZGF0ZSBub3c6ICciICsganNEYXRlICsgIiciICk7CiAgICAgICAgcmV0dXJuIHBhcnNlSVNPODYwMV9mdW5jKCBqc0RhdGUgKTsKCiAgICB9OwoKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgY29udmVydHMgZGF0ZSBzdHJpbmcgaW4gdGhlIGZvcm1hdCBZWVlZTU1ERCBpbnRvIGEgSmF2YVNjcmlwdCBEYXRlIG9iamVjdC4KICAgICAqIAogICAgICogVGhpcyBmdW5jdGlvbiB0YWtlcyBhbiBpbnB1dCBvbiB0aGUgZm9ybWF0IFlZWVlNTUREIGFuZCBjb252ZXJ0CiAgICAgKiBpdCBpbnRvIGEgSmF2YVNjcmlwdCBEYXRlIG9iamVjdC4gSXQgaXMgaW1wbGVtZW50ZWQgYXMgYSBjYWxsCiAgICAgKiB0byBEYXRlVXRpbC5kYW5NYXJjVG9KcywgYnV0IHRoZSBmb3JtYXQgbGVuZ2h0IGlzIGNoZWNrZWQgcHJpb3IKICAgICAqIHRvIGNhbGxpbmcgdGhpcyBmdW5jdGlvbiwgc28gaXQgaXMgc2xpZ2h0bHkgc3RyaWN0ZXIuCiAgICAgKgogICAgICogKipOb3RlOioqIEEgdGltZXBhcnQgb2YgMDA6MDA6MDAgaXMgYWx3YXlzIHVzZWQuCiAgICAgKiAKICAgKiBAZXhhbXBsZQovLyBUaGlzIHdpbGwgY3JlYXRlIGEgZGF0ZSBpbiB0aGUgbG9jYWwgdGltZXpvbmUgb24gMjYvMTAgMjAxMCwgYXQgMDA6MDA6MDAKRGF0ZVV0aWwuZGFuTWFyY1RvSnMoICIyMDEwMTAyNiIgKTsKICAgICAqIEBzZWUgRGF0ZVV0aWwuZGFuTWFyY1RvSnMKICAgICAqIEBzeW50YXggRGF0ZVV0aWwuWVlZWW1tZGRUb0pzKCB5eXl5bW1tbWRkU3RyaW5nICkKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBZWVlZbW1kZFN0cmluZyBEYXRlIG9uIHRoZSBmb3JtIFlZWVlNTURECiAgICAgKiBAcmV0dXJuIHtEYXRlfSBKYXZhU2NyaXB0IERhdGUgb2JqZWN0IHdpdGggYSB2YWxpZCBkYXRlCiAgICAgKiBAbmFtZSBEYXRlVXRpbC5ZWVlZbW1kZFRvSnMKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgdGhhdC5ZWVlZbW1kZFRvSnMgPSBmdW5jdGlvbiggWVlZWW1tZGRTdHJpbmcgKSB7CiAgICAgICAgTG9nLnRyYWNlKCAiLT5EYXRlVXRpbC5ZWVlZbW1kZFRvSnMoIiArIFlZWVltbWRkU3RyaW5nICsgIikiICk7IC8vIEFVVE86OkJVRyM4OTc2CiAgICAgICAgdmFyIGV4cGVjdGVkTGVuZ3RoID0gODsKICAgICAgICB2YXIgYWN0dWFsTGVuZ3RoID0gWVlZWW1tZGRTdHJpbmcubGVuZ3RoOwogICAgICAgIC8vIHdlIGFyZSBjaGVja2luZyB0aGUgbGVuZ3RoIGJlY2F1c2Ugb3VyIGltcGxlbWVudGF0aW9uIHVzZXMgYSBwYXJzZXIgc3VwcG9ydGluZyBvdGhlciBzdHJpbmcgZm9ybWF0cyB0aGF0IGRpZmZlcnMgaW4gbGVuZ3RoCiAgICAgICAgaWYgKCBhY3R1YWxMZW5ndGggIT09IGV4cGVjdGVkTGVuZ3RoICkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoICJEYXRlVXRpbC5ZWVlZbW1kZFRvSnM6IFVuYWJsZSB0byBwYXJzZTogZXhwZWN0ZWQgc3RyaW5nIHdpdGggbGVuZ3RoICIgKyBleHBlY3RlZExlbmd0aCArICIgYnV0IGhhcyBsZW5ndGggIiArIGFjdHVhbExlbmd0aCApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhhdC5kYW5NYXJjVG9KcyggWVlZWW1tZGRTdHJpbmcgKTsKICAgIH07CgoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IGNvbnZlcnRzIGFuIGpzb24gZGF0ZSBzdHJpbmcgaW50byBhIEphdmFTY3JpcHQgRGF0ZSBvYmplY3QuCiAgICAgKiAKICAgICAqIFBsZWFzZSBub3RlIHRoYXQgdGhlIGpzb24gZm9ybWF0IGZvciBkYXRlcyBpcyBzb21ld2hhdAogICAgICogdW5zcGVjaWZpZWQuICBUaGlzIGZ1bmN0aW9uIHVuZGVyc3RhbmRzIHRoZSBmb3JtYXQgYmVsaWV2ZWQgdG8KICAgICAqIGJlIHVzZWQgaW4gU3BpZGVyTW9ua2V5L0ZpcmVmb3ggSlNPTiBpbXBsZW1lbnRhdGlvbnMsIGJ1dAogICAgICogdGhyb3dzIGF3YXkgYW55IG1pbGxpc2Vjb25kcy9mcmFjdGlvbmFsIHNlY29uZCBpbmZvcm1hdGlvbi4gVGhlCiAgICAgKiBmb3JtYXQgaXMgYXNzdW1lZCB0byBiZSBzb21ldGhpbmcgc2ltaWxhciB0byB0aGUgWE1MIHN1YnNldCBvZgogICAgICogSVNPODYwMSwgYnV0IGFsd2F5cyB1c2luZyBVVEMsIHRoYXQgaXMsIFogZm9yIHRoZSB0aW1lem9uZQogICAgICogaW5mb3JtYXRpb24uCiAgICAgKgogICAgICogSW52YWxpZCBkYXRlcyB3aWxsIGNhdXNlIGFuIGV4Y2VwdGlvbiB0byBiZSB0aHJvd24uCiAgICAgKiAKICAgICAqIEBleGFtcGxlCi8vIFRoaXMgd2lsbCBjcmVhdGUgYSBEYXRlIG9iamVjdCBmb3IgMjYvMTAgMjAxMCwgYXQgMDA6MDA6MDAsIHRpbWV6b25lIFVUQwpEYXRlVXRpbC5qc29uVG9KcyggIjIwMTAtMTAtMjZUMDA6MDA6MDAuMDAwWiIgKTsKICAgICAqIEBzeW50YXggRGF0ZVV0aWwuanNvblRvSnMoIGpzb25EYXRlICkKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBqc29uRGF0ZSBTdHJpbmcgZnJvbSBqc29uIHJlcHJlc2VudGluZyBhIHNwZWNpZmljIGRhdGUvZGF0ZVRpbWUKICAgICAqIEByZXR1cm4ge0RhdGV9IEphdmFTY3JpcHQgRGF0ZSBvYmplY3QKICAgICAqIEBuYW1lIERhdGVVdGlsLmpzb25Ub0pzCiAgICAgKiBAbWV0aG9kCiAgICAgKi8KICAgIHRoYXQuanNvblRvSnMgPSBmdW5jdGlvbigganNvbkRhdGUgKSB7CiAgICAgICAgTG9nLnRyYWNlKCAiLT5EYXRlVXRpbC5qc29uVG9KcygpIiApOyAvLyBBVVRPOjpCVUcjODk3NgogICAgICAgIExvZy5kZWJ1ZyggIkRhdGVVdGlsLmpzb25Ub0pzKCAnIiArIGpzb25EYXRlICsgIicgKTsiICk7CiAgICAgICAgaWYgKCAhanNvbkRhdGUgfHwgIiIgPT09IGpzb25EYXRlICkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoICJEYXRlVXRpbC5qc29uVG9KczogVW5hYmxlIHRvIHBhcnNlIGVtcHR5IGRhdGUiICk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwYXJzZUlTTzg2MDFfZnVuYygganNvbkRhdGUucmVwbGFjZSggL1wuXGR7M31aJC8sICJaIiApICk7CiAgICB9OwoKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8qKgogICAgICogRm9ybWF0cyBhIGRhdGUgdG8gYSBUZXh0RGF0ZSBzdHJpbmcgaW4gbG9jYWwgdGltZSAoIEREL01NLVlZWVkgKS4uCiAgICAgKiAKICAgICAqIFJldHVybnMgYSBzdHJpbmcgZm9ybWF0dGVkIGZvciB1c2UgYXMgYSBUZXh0RGF0ZS4gVGhlIHJlc3VsdGluZyBzdHJpbmcKICAgICAqIGlzIGluIHRoZSBsb2NhbCB0aW1lIG9mIHRoZSBqc0RhdGUgcGFzc2VkLgogICAgICoKICAgICAqIEBleGFtcGxlCi8vIFRoaXMgd2lsbCByZXR1cm4gYSBERC9NTS1ZWVlZIGZvcm1hdHRlZCBzdHJpbmcgb2YgdGhlIGN1cnJlbnQgZGF0ZSBhbmQgdGltZQp2YXIgbXlUZXh0RGF0ZUxvY2FsID0gRGF0ZVV0aWwuanNUb1RleHREYXRlTG9jYWwoIERhdGVVdGlsLm5vdygpICk7CiAgICAgKiAKICAgICAqIEBwYXJhbSB7RGF0ZX0ganNEYXRlIFRoZSBkYXRlIHRvIGZvcm1hdAogICAgICogQHJldHVybiB7c3RyaW5nfSBTdHJpbmcgZm9ybWF0dGVkIGFzIEREL01NLVlZWVkKICAgICAqIEBuYW1lIERhdGVVdGlsLmpzVG9UZXh0RGF0ZUxvY2FsCiAgICAgKiBAbWV0aG9kCiAgICAgKi8KICAgIHRoYXQuanNUb1RleHREYXRlTG9jYWwgPSBmdW5jdGlvbigganNEYXRlICkgewogICAgICAgIHJldHVybiBTdHJpbmdVdGlsLnNwcmludGYoICIlMDJkLyUwMmQtJTA0ZCIsIGpzRGF0ZS5nZXREYXRlKCApLCBqc0RhdGUuZ2V0TW9udGgoICkgKyAxLCBqc0RhdGUuZ2V0RnVsbFllYXIoICkgKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBGb3JtYXRzIGEgZGF0ZSB0byBhbiBJbGwwIGRhdGUgc3RyaW5nIGluIGxvY2FsIHRpbWUgKCBZWVlZTU1ERCApLi4KICAgICAqIAogICAgICogUmV0dXJucyBhIHN0cmluZyBmb3JtYXR0ZWQgZm9yIHVzZSBhcyBhbiBJbGwwIGRhdGUuIFRoZSByZXN1bHRpbmcKICAgICAqIHN0cmluZyBpcyBpbiB0aGUgbG9jYWwgdGltZSBvZiB0aGUganNEYXRlIHBhc3NlZC4KICAgICAqIAogICAgICogQGV4YW1wbGUKLy8gVGhpcyB3aWxsIHJldHVybiBhIElsbDAgZGF0ZSBmb3JtYXR0ZWQgc3RyaW5nIG9mIHRoZSBjdXJyZW50IGRhdGUKdmFyIG15SWxsMERhdGUgPSBEYXRlVXRpbC5qc1RvSWxsMERhdGVMb2NhbCggRGF0ZVV0aWwubm93KCkgKTsKICAgICAqCiAgICAgKiBAc2VlIERhdGVVdGlsLmpzVG9JbGwwVGltZUxvY2FsCiAgICAgKiBAc2VlIERhdGVVdGlsLmpzVG9ZWVlZbW1kZEhITU1TUwogICAgICogQHBhcmFtIHtEYXRlfSBqc0RhdGUgVGhlIGRhdGUgdG8gZm9ybWF0CiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IFN0cmluZyBmb3JtYXR0ZWQgYXMgWVlZWU1NREQKICAgICAqIEBuYW1lIERhdGVVdGlsLmpzVG9JbGwwRGF0ZUxvY2FsCiAgICAgKiBAbWV0aG9kCiAgICAgKi8KICAgIHRoYXQuanNUb0lsbDBEYXRlTG9jYWwgPSBmdW5jdGlvbigganNEYXRlICkgewogICAgICAgIHJldHVybiBTdHJpbmdVdGlsLnNwcmludGYoICIlMDRkJTAyZCUwMmQiLCBqc0RhdGUuZ2V0RnVsbFllYXIoICksIGpzRGF0ZS5nZXRNb250aCggKSArIDEsIGpzRGF0ZS5nZXREYXRlKCApICk7CiAgICB9OwoKICAgIC8qKgogICAgICogRm9ybWF0cyBhIGRhdGUgdG8gYW4gWG1sIGRhdGUgc3RyaW5nIGluIGxvY2FsIHRpbWUgKCBZWVlZLU1NLUREICkuLgogICAgICogCiAgICAgKiBSZXR1cm5zIGEgc3RyaW5nIGZvcm1hdHRlZCBmb3IgdXNlIGFzIGFuIFhtbCBkYXRlLiBUaGUgcmVzdWx0aW5nIHN0cmluZwogICAgICogaXMgaW4gdGhlIGxvY2FsIHRpbWUgb2YgdGhlIGpzRGF0ZSBwYXNzZWQuCiAgICAgKgogICAgICogKipOb3RlOioqIFRoaXMgZnVuY3Rpb24gb25seSBmb3JtYXRzIHRoZSBkYXRlIHBhcnQgb2YgYSBzdGFuZGFyZAogICAgICogWE1MIGRhdGV0aW1lIHN0cmluZywgYW5kIGFzIHN1Y2ggaWdub3JlcyBhbnkgdGltZSBwYXJ0LgogICAgICogCiAgICAgKiBAZXhhbXBsZQovLyBUaGlzIHdpbGwgcmV0dXJuIHRoZSBjdXJyZW50IGRhdGUgb25seSBpbiBYTUwgZm9ybWF0CnZhciB4bWxEYXRlVGltZSA9IERhdGVVdGlsLmpzVG9YbWxEYXRlTG9jYWwoIERhdGVVdGlsLm5vdygpICk7CiAgICAgKgogICAgICogQHNlZSBEYXRlVXRpbC5qc1RvWG1sCiAgICAgKiBAc2VlIERhdGVVdGlsLmpzVG9YbWxUaW1lTG9jYWwKICAgICAqIEBwYXJhbSB7RGF0ZX0ganNEYXRlIFRoZSBkYXRlIHRvIGZvcm1hdC4KICAgICAqIEByZXR1cm4ge3N0cmluZ30gU3RyaW5nIGZvcm1hdHRlZCBhcyBZWVlZLU1NLURELgogICAgICogQG5hbWUgRGF0ZVV0aWwuanNUb1htbERhdGVMb2NhbAogICAgICogQG1ldGhvZAogICAgICovCiAgICB0aGF0LmpzVG9YbWxEYXRlTG9jYWwgPSBmdW5jdGlvbigganNEYXRlICkgewogICAgICAgIHJldHVybiBTdHJpbmdVdGlsLnNwcmludGYoICIlMDRkLSUwMmQtJTAyZCIsIGpzRGF0ZS5nZXRGdWxsWWVhciggKSwganNEYXRlLmdldE1vbnRoKCApICsgMSwganNEYXRlLmdldERhdGUoICkgKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBGb3JtYXRzIGEgZGF0ZSB0byB1c2UgYW4gSWxsMCB0aW1lIHN0cmluZyBpbiBsb2NhbCB0aW1lICggSEhNTVNTICkuLgogICAgICogCiAgICAgKiBSZXR1cm5zIGEgc3RyaW5nIGZvcm1hdHRlZCBmb3IgdXNlIGFzIGFuIElsbDAgdGltZS4gT25seSB0aGUgdGltZQogICAgICogcG9ydGlvbiBvZiB0aGUgcGFzc2VkIGRhdGUgaXMgdXNlZC4gVGhlIHJlc3VsdGluZyBzdHJpbmcgaXMgaW4gdGhlCiAgICAgKiBsb2NhbCB0aW1lIG9mIHRoZSBqc0RhdGUgcGFzc2VkIAogICAgICogCiAgICAgKiBAZXhhbXBsZQovLyBUaGlzIHdpbGwgcmV0dXJuIGEgSWxsMCBkYXRlIGZvcm1hdHRlZCBzdHJpbmcgb2YgdGhlIGN1cnJlbnQgdGltZQp2YXIgbXlJbGwwRGF0ZSA9IERhdGVVdGlsLmpzVG9JbGwwVGltZUxvY2FsKCBEYXRlVXRpbC5ub3coKSApOwogICAgICoKICAgICAqIEBzZWUgRGF0ZVV0aWwuanNUb0lsbDBEYXRlTG9jYWwKICAgICAqIEBzZWUgRGF0ZVV0aWwuanNUb1lZWVltbWRkSEhNTVNTCiAgICAgKiBAcGFyYW0ge0RhdGV9IGpzRGF0ZSBUaGUgZGF0ZSB0byBmb3JtYXQuCiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IFN0cmluZyBmb3JtYXR0ZWQgYXMgSEhNTVNTLgogICAgICogQG5hbWUgRGF0ZVV0aWwuanNUb0lsbDBUaW1lTG9jYWwKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgdGhhdC5qc1RvSWxsMFRpbWVMb2NhbCA9IGZ1bmN0aW9uKCBqc0RhdGUgKSB7CiAgICAgICAgcmV0dXJuIFN0cmluZ1V0aWwuc3ByaW50ZiggIiUwMmQlMDJkJTAyZCIsIGpzRGF0ZS5nZXRIb3VycyggKSwganNEYXRlLmdldE1pbnV0ZXMoICksIGpzRGF0ZS5nZXRTZWNvbmRzKCApICk7CiAgICB9OwoKICAgIC8qKgogICAgICogRm9ybWF0cyBhIGRhdGUgdG8gdXNlIGFuIFhtbCB0aW1lIHN0cmluZyBpbiBsb2NhbCB0aW1lICggSEg6TU06U1MgKS4uCiAgICAgKiAKICAgICAqIFJldHVybnMgYSBzdHJpbmcgZm9ybWF0dGVkIGZvciB1c2UgYXMgYW4gWG1sIHRpbWUuIE9ubHkgdGhlIHRpbWUKICAgICAqIHBvcnRpb24gb2YgdGhlIHBhc3NlZCBkYXRlIGlzIHVzZWQuIFRoZSByZXN1bHRpbmcgc3RyaW5nIGlzIGluIHRoZQogICAgICogbG9jYWwgdGltZSBvZiB0aGUganNEYXRlIHBhc3NlZCAKICAgICAqCiAgICAgKiAqKk5vdGU6KiogVGhpcyBmdW5jdGlvbiBvbmx5IGZvcm1hdHMgdGhlIHRpbWUgcGFydCBvZiBhIHN0YW5kYXJkCiAgICAgKiBYTUwgZGF0ZXRpbWUgc3RyaW5nLCBhbmQgYXMgc3VjaCBpZ25vcmVzIGFueSBkYXRlIHBhcnQuCiAgICAgKiAKICAgICAqIEBleGFtcGxlCi8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGN1cnJlbnQgdGltZSBvbmx5IGluIFhNTCBmb3JtYXQKdmFyIHhtbERhdGVUaW1lID0gRGF0ZVV0aWwuanNUb1htbFRpbWVMb2NhbCggRGF0ZVV0aWwubm93KCkgKTsKICAgICAqCiAgICAgKiBAc2VlIERhdGVVdGlsLmpzVG9YbWwKICAgICAqIEBzZWUgRGF0ZVV0aWwuanNUb1htbERhdGVMb2NhbAogICAgICogQHBhcmFtIHtEYXRlfSBqc0RhdGUgVGhlIGRhdGUgdG8gZm9ybWF0CiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IFN0cmluZyBmb3JtYXR0ZWQgYXMgSEg6TU06U1MKICAgICAqIEBuYW1lIERhdGVVdGlsLmpzVG9YbWxUaW1lTG9jYWwKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgdGhhdC5qc1RvWG1sVGltZUxvY2FsID0gZnVuY3Rpb24oIGpzRGF0ZSApIHsKICAgICAgICByZXR1cm4gU3RyaW5nVXRpbC5zcHJpbnRmKCAiJTAyZDolMDJkOiUwMmQiLCBqc0RhdGUuZ2V0SG91cnMoICksIGpzRGF0ZS5nZXRNaW51dGVzKCApLCBqc0RhdGUuZ2V0U2Vjb25kcyggKSApOwogICAgfTsKCiAgICAvLyBOb3RlIHRvIGZ1dHVyZSBpbXBsZW1lbnRlcnM6CiAgICAvLyBmb3JtYXQgZm9yIHRoZSBmdW5jdGlvbiBuYW1lIGlzIGJhc2VkIG9uIHRoZSBzaGVsbCBkYXRlIGZvcm1hdCAtIHR5cGUgJ21hbiBkYXRlJyBpbiBzaGVsbCBmb3IgZG9jdW1lbnRhdGlvbiAgICAgICAgICAgCiAgICAvKioKICAgICAqIEZvcm1hdHMgYSBkYXRlIHRvIHVzZSBhbiBJbGwwIGRhdGUgYW5kIHRpbWUgc3RyaW5nIGluIGxvY2FsIHRpbWUuCiAgICAgKiAKICAgICAqIFJldHVybnMgYSBzdHJpbmcgZm9ybWF0dGVkIGZvciB1c2UgYXMgYW4gSWxsMCBkYXRlIGFuZCB0aW1lCiAgICAgKiAoWVlZWW1tZGRISE1NU1MpLiBCb3RoIHRoZSBkYXRlIGFuZCB0aW1lIHBvcnRpb24gb2YgdGhlIHBhc3NlZAogICAgICogZGF0ZSBpcyB1c2VkLiBUaGUgcmVzdWx0aW5nIHN0cmluZyBpcyBpbiB0aGUgbG9jYWwgZGF0ZSBhbmQKICAgICAqIHRpbWUgb2YgdGhlIGpzRGF0ZSBwYXNzZWQuCiAgICAgKiAKICAgICAqIEBleGFtcGxlCi8vIFRoaXMgd2lsbCByZXR1cm4gYSBJbGwwIGRhdGUgZm9ybWF0dGVkIHN0cmluZyBvZiB0aGUgY3VycmVudCBkYXRlIGFuZCB0aW1lCnZhciBteUlsbDBEYXRlID0gRGF0ZVV0aWwuanNUb1lZWVltbWRkSEhNTVNTKCBEYXRlVXRpbC5ub3coKSApOwogICAgICoKICAgICAqIEBzZWUgRGF0ZVV0aWwuanNUb0lsbDBEYXRlTG9jYWwKICAgICAqIEBzZWUgRGF0ZVV0aWwuanNUb0lsbDBUaW1lTG9jYWwKICAgICAqIEBwYXJhbSB7RGF0ZX0ganNEYXRlIFRoZSBkYXRlIHRvIGZvcm1hdAogICAgICogQHJldHVybiB7c3RyaW5nfSBTdHJpbmcgZm9ybWF0dGVkIGFzIFlZWVltbWRkSEhNTVNTCiAgICAgKiBAbmFtZSBEYXRlVXRpbC5qc1RvWVlZWW1tZGRISE1NU1MKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgdGhhdC5qc1RvWVlZWW1tZGRISE1NU1MgPSBmdW5jdGlvbigganNEYXRlICkgewogICAgICAgIHJldHVybiBTdHJpbmdVdGlsLnNwcmludGYoICIlMDRkJTAyZCUwMmQlMDJkJTAyZCUwMmQiLCBqc0RhdGUuZ2V0RnVsbFllYXIoICksIGpzRGF0ZS5nZXRNb250aCggKSArIDEsIGpzRGF0ZS5nZXREYXRlKCApLCBqc0RhdGUuZ2V0SG91cnMoICksIGpzRGF0ZS5nZXRNaW51dGVzKCApLCBqc0RhdGUuZ2V0U2Vjb25kcyggKSApOwogICAgfTsKCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgY2xlYW5zIGEgMTQgZGlnaXQgZGF0ZSBzdHJpbmcgKFlZWVltbWRkSEhNTVNTKSB3aXRoIGludmFsaWQgdGltZSBpbiBISE1NU1MuIEludmFsaWQgaG91cnMsIG1pbnV0ZXMsIG9yIHNlY29uZHMgd2lsbCBiZSByZXNldCB0byAwMC4KICAgICAqCiAgICAgKiBAZXhhbXBsZQogICAgIC8vIFRoZSBzdHJpbmcgIjE5NDcxMjI0NjY3Nzg4IiB3aWxsIGJlIHJldHVybmVkIGFzICIxOTQ3MTIyNDAwMDAwMCIuCiAgICAgKiBAc3ludGF4IERhdGVVdGlsLmNsZWFuVGltZUluU3RyaW5nRGF0ZSggWVlZWW1tZGRISE1NU1MgKQogICAgICogQHBhcmFtIHtTdHJpbmd9IFlZWVltbWRkSEhNTVNTIFN0cmluZyByZXByZXNlbnRpbmcgYSBzcGVjaWZpYyBkYXRlVGltZQogICAgICogQHJldHVybiB7U3RyaW5nfSBBIHBvc3NpYmx5IGNsZWFuZXIgZGF0ZSBvciB0aGUgdW5tb2RpZmllZCBkYXRlCiAgICAgKiBAbmFtZSBEYXRlVXRpbC5jbGVhblRpbWVJblN0cmluZ0RhdGUKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgdGhhdC5jbGVhblRpbWVJblN0cmluZ0RhdGUgPSBmdW5jdGlvbiggWVlZWW1tZGRISE1NU1MgKSB7CgogICAgICAgIExvZy5kZWJ1ZyggIkRhdGVVdGlsLmNsZWFuVGltZUluU3RyaW5nRGF0ZSggJyIgKyBZWVlZbW1kZEhITU1TUyArICInICk7IiApOwoKICAgICAgICB2YXIgY2hhbmdlZCA9IGZhbHNlOwogICAgICAgIHZhciBsb2dNZXNzYWdlID0gInJldHVybmluZyB1bmNoYW5nZWQgZGF0ZTogIjsKICAgICAgICBpZiAoIFlZWVltbWRkSEhNTVNTLmxlbmd0aCA9PT0gMTQgKXsKICAgICAgICAgICAgaWYgKCBZWVlZbW1kZEhITU1TUy5zbGljZSggOCwgMTAgKSA+IDIzICl7CiAgICAgICAgICAgICAgICBZWVlZbW1kZEhITU1TUyA9IFlZWVltbWRkSEhNTVNTLnJlcGxhY2UoIC8oXGR7OH0pXGR7Mn0oXGR7NH0pLywgIiQxMDAkMiIgKTsKICAgICAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggWVlZWW1tZGRISE1NU1Muc2xpY2UoIDEwLCAxMiApID4gNTkgKXsKICAgICAgICAgICAgICAgIFlZWVltbWRkSEhNTVNTID0gWVlZWW1tZGRISE1NU1MucmVwbGFjZSggLyhcZHsxMH0pXGR7Mn0oXGR7Mn0pLywgIiQxMDAkMiIgKTsKICAgICAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggWVlZWW1tZGRISE1NU1Muc2xpY2UoIDEyLCAxNCApID4gNTkgKXsKICAgICAgICAgICAgICAgIFlZWVltbWRkSEhNTVNTID0gWVlZWW1tZGRISE1NU1MucmVwbGFjZSggLyhcZHsxMn0pXGR7Mn0vLCAiJDEwMCIgKTsKICAgICAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggY2hhbmdlZCA9PT0gdHJ1ZSApewogICAgICAgICAgICAgICAgbG9nTWVzc2FnZSA9ICJyZXR1cm5pbmcgY2xlYW5lZCBkYXRlOiAiOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIExvZy5kZWJ1ZyggbG9nTWVzc2FnZSwgWVlZWW1tZGRISE1NU1MgKTsKICAgICAgICByZXR1cm4gWVlZWW1tZGRISE1NU1M7CiAgICB9OwoKCiAgICAvKioKICAgICAqIE1ldGhvZCB0aGF0IGNoZWNrcyBpZiBhIHllYXIgaXMgYSBsZWFwIHllYXIuCiAgICAgKgogICAgICogQHR5cGUge21ldGhvZH0KICAgICAqIEBzeW50YXggRGF0ZVV0aWwuY2hlY2tMZWFwWWVhciggeWVhciApCiAgICAgKiBAcGFyYW0ge1N0cmluZ30geWVhciBUaGUgeWVhciB0byBjaGVjawogICAgICogQHJldHVybiB7Qm9vbGVhbn0gVHJ1ZSBpZiB0aGUgeWVhciBpcyBhIGxlYXAgeWVhciwgb3RoZXJ3aXNlIGZhbHNlCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBEYXRlVXRpbC5pc0xlYXBZZWFyCiAgICAgKiBAZXhhbXBsZSBEYXRlVXRpbC5pc0xlYXBZZWFyKCAxOTc2ICk7CiAgICAgKi8KICAgIHRoYXQuaXNMZWFwWWVhciA9IGZ1bmN0aW9uICggeWVhciApIHsKCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmc6IERhbk1hcmMyUHJlcGFyYXRpb24uY2hlY2tMZWFwWWVhciBmdW5jdGlvbiIgKTsKCiAgICAgICAgdmFyIGlzTGVhcFllYXIgPSAoICggeWVhciAlIDQgPT0gMCApICYmICggeWVhciAlIDEwMCAhPSAwICkgKSB8fCAoIHllYXIgJSA0MDAgPT0gMCApOwoKICAgICAgICBMb2cuZGVidWcoICJZZWFyICIsIHllYXIsICIgaXMgbGVhcCB5ZWFyOiAiLCBpc0xlYXBZZWFyICk7CgogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmc6IERhbk1hcmMyUHJlcGFyYXRpb24uY2hlY2tMZWFwWWVhciBmdW5jdGlvbiIgKTsKCiAgICAgICAgcmV0dXJuIGlzTGVhcFllYXI7CgogICAgfTsKCgogICAgLyoqCiAgICAgKiBNZXRob2QgdGhhdCBjb3JyZWN0cyBhIGdpdmVuIGRhdGUgaWYgbmVjZXNzYXJ5LCBlbHNlIHRoZSBtZXRob2QgcmV0dXJucyB0aGUgaW5wdXQgZGF0ZS4KICAgICAqIElmIHRoZSBnaXZlbiBkYXRlIGNhbm5vdCBiZSBjb3JyZWN0ZWQgdGhlIGVtcHR5IHN0cmluZyBpcyByZXR1cm5lZAogICAgICoKICAgICAqQHR5cGUgbWV0aG9kCiAgICAgKkBzeW50YXggRGF0ZVV0aWwuY29ycmVjdERhdGUKICAgICAqQHBhcmFte1N0cmluZ30gZGF0ZSBjb250YWluaW5nIDggZGlnaXRzCiAgICAgKkByZXR1cm57U3RyaW5nfSBkYXRlLCBlbXB0eSBzdHJpbmcgaWYgaXQgd2Fzbid0IHBvc3NpYmxlIHRvIGNvcnJlY3QKICAgICAqQG1ldGhvZAogICAgICpAbmFtZSBEYXRlVXRpbC5jb3JyZWN0RGF0ZQogICAgICpAZXhhbXBsZSBEYXRlVXRpbC5jb3JyZWN0RGF0ZSggJzE5MDcwMjI5JyApCiAgICAgKicxOTA3MDMwMScKICAgICAqCiAgICAgKi8KICAgIHRoYXQuY29ycmVjdERhdGUgPSBmdW5jdGlvbiggZGF0ZSApIHsKICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZyBEYXRlVXRpbC5jb3JyZWN0RGF0ZSBmdW5jdGlvbiIgKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoICEvXlxkezh9JC8udGVzdCggZGF0ZSApICkgewogICAgICAgICAgICAgICAgTG9nLmRlYnVnKCJObyB2YWxpZCBkYXRlIGNvdWxkIGJlIGNyZWF0ZWQgZnJvbTogIisgZGF0ZSApOwogICAgICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciB5ZWFyID0gZGF0ZS5zbGljZSggMCwgNCApOwogICAgICAgICAgICB2YXIgbW9udGggPSBkYXRlLnNsaWNlKCA0LCA2ICk7CiAgICAgICAgICAgIHZhciBkYXkgPSBkYXRlLnNsaWNlKCA2LCA4ICk7CgoKICAgICAgICAgICAgaWYgKCBwYXJzZUludCggbW9udGggKSA+IDEyIHx8IG1vbnRoID09PSAiMDAiKSB7CiAgICAgICAgICAgICAgICBtb250aCA9ICIwMSIKICAgICAgICAgICAgfQogICAgICAgICAgICAvL2NoZWNraW5nIGRheXMgb2YgbW9udGhzIHdpdGggMzEgZGF5cwogICAgICAgICAgICBpZiAoIG1vbnRoID09PSAiMDEiIHx8IG1vbnRoID09PSAiMDMiIHx8IG1vbnRoID09PSAiMDUiIHx8IG1vbnRoID09PSAiMDciIHx8IG1vbnRoID09PSAiMDgiIHx8IG1vbnRoID09PSAiMTAiIHx8IG1vbnRoID09PSAiMTIiICkgewogICAgICAgICAgICAgICAgaWYgKCBwYXJzZUludCggZGF5ICkgPiAzMSB8fCBkYXkgPT09ICIwMCIgKSB7CiAgICAgICAgICAgICAgICAgICAgZGF5ID0gIjAxIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9jaGVja2luZyBmZWJydWFyeQogICAgICAgICAgICB9IGVsc2UgaWYgKCBtb250aCA9PT0gIjAyIiApIHsKICAgICAgICAgICAgICAgIGlmICggcGFyc2VJbnQoIGRheSApID4gMjggKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCAiMjkiID09PSBkYXkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggRGF0ZVV0aWwuaXNMZWFwWWVhciggeWVhciApICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cuZGVidWcoICJDb3JyZWN0aW5nICIrIGRhdGUgKyIgdG8iICsgeWVhciArICIwMzAxIGFzIGdpdmVuIHllYXIgaXMgbm8gbGVhcCB5ZWFyIiApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHllYXIgKyAiMDMwMSI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBkYXkgPSAiMDEiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vY2hlY2tpbmcgbW9udGhzIHdpdGggMzAgZGF5cwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKCBwYXJzZUludCggZGF5ICkgPiAzMCB8fCBkYXkgPT09ICIwMCIgKSB7CiAgICAgICAgICAgICAgICAgICAgZGF5ID0gIjAxIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGNvcnJlY3RlZERhdGUgPSB5ZWFyICsgbW9udGggKyBkYXk7CiAgICAgICAgICAgIGlmICggZGF0ZSAhPT0gY29ycmVjdGVkRGF0ZSApewogICAgICAgICAgICAgICAgTG9nLmRlYnVnKCAiQ29ycmVjdGVkICIrIGRhdGUgKyAiIHRvICIrIGNvcnJlY3RlZERhdGUgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gY29ycmVjdGVkRGF0ZQoKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIERhdGVVdGlsLmNvcnJlY3REYXRlIGZ1bmN0aW9uIiApOwogICAgICAgIH0KCiAgICB9OwoKICAgIC8qKgogICAgICogTWV0aG9kIHRoYXQgYWRkcyB0aGUgY2VudHVyeSAoMTkgb3IgMjApIHRvIGEgZGF0ZSBzdHJpbmcgaWYgbWlzc2luZy4KICAgICAqCiAgICAgKiBAdHlwZSB7bWV0aG9kfQogICAgICogQHN5bnRheCBNYXJjUmVjb3JkLmFkZE1pc3NpbmdDZW50dXJ5VG82RGlnaXREYXRlKCBkYXRlU3RyaW5nICkKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBkYXRlU3RyaW5nIGEgc3RyaW5nIHdpdGggNiBkaWdpdHMgcmVwcmVzZW50aW5nIGEgZGF0ZQogICAgICogQHJldHVybiB7T2JqZWN0fSBUaGUgdXBkYXRlZCBkYXRlIG9yIGFuIGVtcHR5IHN0cmluZyBpZiB0aGUgZGF0ZSBjb3VsZCBub3QgYmUgdmFsaWRhdGVkCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBEYXRlVXRpbC5hZGRNaXNzaW5nQ2VudHVyeVRvNkRpZ2l0RGF0ZQogICAgICovCiAgICB0aGF0LmFkZE1pc3NpbmdDZW50dXJ5VG82RGlnaXREYXRlID0gZnVuY3Rpb24gKCBkYXRlU3RyaW5nICkgewoKICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZzogRGF0ZVV0aWwuYWRkTWlzc2luZ0NlbnR1cnlUbzZEaWdpdERhdGUgZnVuY3Rpb24iICk7CgogICAgICAgIHZhciBuZXdEYXRlID0gIiI7CiAgICAgICAgaWYgKCBkYXRlU3RyaW5nLm1hdGNoKCAvXlxkezZ9JC8gKSApIHsKICAgICAgICAgICAgaWYgKCBkYXRlU3RyaW5nLm1hdGNoKCAvXlswLTFdWzAtOV17NX0vICkgKSB7CiAgICAgICAgICAgICAgICBuZXdEYXRlID0gZGF0ZVN0cmluZy5yZXBsYWNlKCAvXihbMC0xXVswLTldezV9KS8sICIyMCQxIiApOwogICAgICAgICAgICB9IGVsc2UgaWYgKCBkYXRlU3RyaW5nLm1hdGNoKCAvXlsyLTldWzAtOV17NX0vICkgKSB7CiAgICAgICAgICAgICAgICBuZXdEYXRlID0gZGF0ZVN0cmluZy5yZXBsYWNlKCAvXihbMi05XVswLTldezV9KS8sICIxOSQxIiApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIExvZy5kZWJ1ZyggIk5ldyBkYXRlIGlzOiAiLCBuZXdEYXRlLCAiLiIgKTsKICAgICAgICAgICAgbmV3RGF0ZSA9IERhdGVVdGlsLmNvcnJlY3REYXRlKCBuZXdEYXRlICk7CiAgICAgICAgICAgIGlmICggIiIgPT09IG5ld0RhdGUgKXsKICAgICAgICAgICAgICAgIExvZy53YXJuKCAiVGhlIGNvcnJlY3RlZCBkYXRlIGNvdWxkIG5vdCBiZSB2YWxpZGF0ZWQuIiApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIExvZy5kZWJ1ZyggIkNvcnJlY3RlZCBkYXRlIGlzOiAiLCBuZXdEYXRlLCAiLiIgKTsKCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgTG9nLndhcm4oICJUaGUgZGF0ZSB3YXMgbm90IDYgZGlnaXRzLiIgKTsKICAgICAgICB9CgogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmc6IERhdGVVdGlsLmFkZE1pc3NpbmdDZW50dXJ5VG82RGlnaXREYXRlIGZ1bmN0aW9uIiApOwoKICAgICAgICByZXR1cm4gbmV3RGF0ZTsKCiAgICB9OwoKICAgIC8qKgogICAgICogTWV0aG9kIHRoYXQgcmV0dXJucyB0aGUgSVNPIDg2MDEgd2VlayBudW1iZXIgb2YgdGhlIGRhdGUKICAgICAqIENvZGUgZnJvbSBjb21tZW50IHJlcGx5IGluIAogICAgICogaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNjExNzgxNC9nZXQtd2Vlay1vZi15ZWFyLWluLWphdmFzY3JpcHQtbGlrZS1pbi1waHAKICAgICAqIEB0eXBlIHttZXRob2R9CiAgICAgKiBAc3ludGF4IERhdGVVdGlsLmdldFdlZWsoIHllYXIsIG1vbnRoLCBkYXkgKQogICAgICogQHBhcmFtIHtOdW1iZXJ8RGF0ZX0geWVhciBhIHllYXIgYXMgZm91ciBkaWdpdHMKICAgICAqIEBwYXJhbSB7TnVtYmVyfERhdGV9IG1vbnRoIGEgbW9udGggYXMgZGlnaXRzIGZyb20gMS0xMgogICAgICogQHBhcmFtIHtOdW1iZXJ8RGF0ZX0gZGF5IHRoZSBkYXkgb2YgdGhlIG1vbnRoIGFzIGRpZ2l0cyBmcm9tIDEtMzEKICAgICAqIEByZXR1cm4ge051bWJlcn0gdGhlIG51bWJlciBvZiB0aGUgd2VlayBmb3IgdGhlIGdpdmVuIGRhdGUKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIERhdGVVdGlsLmdldFdlZWsKICAgICAqIEBleGFtcGxlCiAgICAgKiAgICAgICBEYXRlVXRpbC5nZXRXZWVrKDIwMTYsIDA2LCAxMSkgLy8yMwogICAgICAgICAgICAgRGF0ZVV0aWwuZ2V0V2VlaygyMDE1LCA5LCAyNikgLy8zOQogICAgICAgICAgICAgRGF0ZVV0aWwuZ2V0V2VlaygyMDE2LCAxLCAxKSAvLzUzCiAgICAgICAgICAgICBEYXRlVXRpbC5nZXRXZWVrKDIwMTYsIDEsIDQpIC8vMQogICAgICAgICAgICAgRGF0ZVV0aWwuZ2V0V2VlayhuZXcgRGF0ZSgyMDE2LCAwLCA0KSkgLy8xCiAgICAgICAgICAgICBEYXRlVXRpbC5nZXRXZWVrKCIxMSBqYW51YXJ5IDIwMTYiKSAvLzIKICAgICAqLwogICAgdGhhdC5nZXRXZWVrID0gZnVuY3Rpb24oIHllYXIsIG1vbnRoLCBkYXkgKSB7CgogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nOiBEYXRlVXRpbC5nZXRXZWVrIGZ1bmN0aW9uIiApOwoKICAgICAgICBmdW5jdGlvbiBzZXJpYWwoIGRheXMgKSB7CiAgICAgICAgICAgIHJldHVybiA4NjQwMDAwMCAqIGRheXM7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkYXRlc2VyaWFsKCB5ZWFyLCBtb250aCwgZGF5ICkgewogICAgICAgICAgICByZXR1cm4gKG5ldyBEYXRlKCB5ZWFyLCBtb250aCAtIDEsIGRheSApLnZhbHVlT2YoKSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB3ZWVrZGF5KCBkYXRlICkgewogICAgICAgICAgICByZXR1cm4gKG5ldyBEYXRlKCBkYXRlICkpLmdldERheSgpICsgMTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHllYXJzZXJpYWwoIGRhdGUgKSB7CiAgICAgICAgICAgIHJldHVybiAobmV3IERhdGUoIGRhdGUgKSkuZ2V0RnVsbFllYXIoKTsKICAgICAgICB9CgogICAgICAgIHZhciBkYXRlID0geWVhciBpbnN0YW5jZW9mIERhdGUgPyB5ZWFyLnZhbHVlT2YoKSA6IHR5cGVvZiB5ZWFyID09PSAic3RyaW5nIiA/IG5ldyBEYXRlKCB5ZWFyICkudmFsdWVPZigpIDogZGF0ZXNlcmlhbCggeWVhciwgbW9udGgsIGRheSApLAogICAgICAgICAgICBkYXRlMiA9IGRhdGVzZXJpYWwoIHllYXJzZXJpYWwoIGRhdGUgLSBzZXJpYWwoIHdlZWtkYXkoIGRhdGUgLSBzZXJpYWwoIDEgKSApICkgKyBzZXJpYWwoIDQgKSApLCAxLCAzICk7CgogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmc6IERhdGVVdGlsLmdldFdlZWsgZnVuY3Rpb24iICk7CiAgICAgICAgcmV0dXJuIH5+KChkYXRlIC0gZGF0ZTIgKyBzZXJpYWwoIHdlZWtkYXkoIGRhdGUyICkgKyA1ICkpIC8gc2VyaWFsKCA3ICkpOwoKICAgIH07CgoKICAgIHJldHVybiB0aGF0Owp9KCApOyAvLyBOb3RlIHRoZSAoKQoK", "moduleName": "DateUtil"}, {"javascript": "RVhQT1JURURfU1lNQk9MUyA9IFsgJ19fRGF0ZVV0aWxDb3JlX3BhcnNlSVNPODYwMScsICdfX0RhdGVVdGlsQ29yZV9mb3JtYXRJU084NjAxJyBdOwoKdXNlKCAiU3RyaW5nVXRpbCIgKTsKdXNlKCAiTG9nIiApOwoKLyogQGJyaWVmIENyZWF0ZSBhIEphdmFTY3JpcHQgRGF0ZSBvYmplY3QgZnJvbSBhbiBJU084NjAxIHN0cmluZwogKiBAcGFyYW0gcyBUaGUgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBkYXRldGltZQogKiBAcmV0dXJucyBBIEphdmFTY3JpcHQgRGF0ZSBvYmplY3QKICoKICogVGhlIHN0cmluZyBmb3JtYXQgbXVzdCBiZSBZWVlZLU1NLUREVGhoOm1tOnNzKFopIG9yIGVtcHR5LgogKiBOb3Qgb24gYWJvdmUgZm9ybWF0LCB3aWxsIHRocm93LgogKgogKiBSZWdhcmRsZXNzIG9mIHRoZSBuYW1lLCBvbmx5IGEgbGltaXRlZCBzdWJzZXQgb2YgSVMwODYwMSBpcwogKiBhY3R1YWxseSBwYXJzZWQhICovCnZhciBfX0RhdGVVdGlsQ29yZV9wYXJzZUlTTzg2MDEgPSBmdW5jdGlvbiggaXNvODYwMSApIHsKICAgIExvZy5kZWJ1ZyggIkVudGVyaW5nIF9fRGF0ZVV0aWxDb3JlX3BhcnNlSVNPODYwMSAiICsgaXNvODYwMSApOwogICAgdmFyIG1hdGNoZWQgPSBfX0RhdGVVdGlsQ29yZV9wYXJzZUlTTzg2MDEucmVnVVRDLmV4ZWMoIGlzbzg2MDEgKTsKCiAgICBpZiAoIG1hdGNoZWQgKSB7CiAgICAgICAgdmFyIHJlcyA9IG5ldyBEYXRlKCAxOTcwLCAxLCAxLCAxMiwgMCwgMCwgMCApOwogICAgICAgIGlmICggbWF0Y2hlZC5sZW5ndGggPiA3ICYmIG1hdGNoZWRbIDcgXSA9PSAiWiIgKSB7CiAgICAgICAgICAgIExvZy5kZWJ1ZyggIk1hdGNoZWQgYXMgc3RyaW5nIHdpdGggWlVMVSB0aW1lem9uZSBpbmZvcm1hdGlvbiIgKTsKICAgICAgICAgICAgcmVzLnNldFVUQ0Z1bGxZZWFyKCBwYXJzZUludCggbWF0Y2hlZFsgMSBdLCAxMCApLCBwYXJzZUludCggbWF0Y2hlZFsgMiBdLCAxMCApIC0gMSwgcGFyc2VJbnQoIG1hdGNoZWRbIDMgXSwgMTAgKSApOwogICAgICAgICAgICByZXMuc2V0VVRDSG91cnMoIHBhcnNlSW50KCBtYXRjaGVkWyA0IF0sIDEwICksIHBhcnNlSW50KCBtYXRjaGVkWyA1IF0sIDEwICksIHBhcnNlSW50KCBtYXRjaGVkWyA2IF0sIDEwICksIDAgKTsKICAgICAgICAgICAgLy8gQ2hlY2sgbm8gImlsbGVnYWwiIHZhbHVlcwogICAgICAgICAgICBpZiAoIHJlcy5nZXRVVENGdWxsWWVhciggKSAhPSBwYXJzZUludCggbWF0Y2hlZFsgMSBdLCAxMCApIHx8CiAgICAgICAgICAgICAgICByZXMuZ2V0VVRDTW9udGgoICkgIT0gcGFyc2VJbnQoIG1hdGNoZWRbIDIgXSwgMTAgKSAtIDEgfHwKICAgICAgICAgICAgICAgIHJlcy5nZXRVVENEYXRlKCApICE9IHBhcnNlSW50KCBtYXRjaGVkWyAzIF0sIDEwICkgfHwKICAgICAgICAgICAgICAgIHJlcy5nZXRVVENIb3VycyggKSAhPSBwYXJzZUludCggbWF0Y2hlZFsgNCBdLCAxMCApIHx8CiAgICAgICAgICAgICAgICByZXMuZ2V0VVRDTWludXRlcyggKSAhPSBwYXJzZUludCggbWF0Y2hlZFsgNSBdLCAxMCApIHx8CiAgICAgICAgICAgICAgICByZXMuZ2V0VVRDU2Vjb25kcyggKSAhPSBwYXJzZUludCggbWF0Y2hlZFsgNiBdLCAxMCApICkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCBTdHJpbmdVdGlsLnNwcmludGYoICJVbmFibGUgdG8gdW5kZXJzdGFuZCBkYXRlIHNwZWNpZmllZCBhczogJyVzJyAoSW52YWxpZCBkYXRlIGFmdGVyIFpVTFUgLSByZWdleHAgbWF0Y2g/KS4iLAogICAgICAgICAgICAgICAgICAgICAgICBpc284NjAxICkgKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIExvZy5kZWJ1ZyggIk1hdGNoZWQgYXMgc3RyaW5nIHdpdGggbm8gdGltZXpvbmUgaW5mb3JtYXRpb24iICk7CiAgICAgICAgICAgIHJlcy5zZXRGdWxsWWVhciggcGFyc2VJbnQoIG1hdGNoZWRbIDEgXSwgMTAgKSwgcGFyc2VJbnQoIG1hdGNoZWRbIDIgXSwgMTAgKSAtIDEsIHBhcnNlSW50KCBtYXRjaGVkWyAzIF0sIDEwICkgKTsKICAgICAgICAgICAgcmVzLnNldEhvdXJzKCBwYXJzZUludCggbWF0Y2hlZFsgNCBdLCAxMCApLCBwYXJzZUludCggbWF0Y2hlZFsgNSBdLCAxMCApLCBwYXJzZUludCggbWF0Y2hlZFsgNiBdLCAxMCApLCAwICk7CiAgICAgICAgICAgIC8vIENoZWNrIG5vICJpbGxlZ2FsIiB2YWx1ZXMKICAgICAgICAgICAgaWYgKCByZXMuZ2V0RnVsbFllYXIoICkgIT0gcGFyc2VJbnQoIG1hdGNoZWRbIDEgXSwgMTAgKSB8fAogICAgICAgICAgICAgICAgcmVzLmdldE1vbnRoKCApICE9IHBhcnNlSW50KCBtYXRjaGVkWyAyIF0sIDEwICkgLSAxIHx8CiAgICAgICAgICAgICAgICByZXMuZ2V0RGF0ZSggKSAhPSBwYXJzZUludCggbWF0Y2hlZFsgMyBdLCAxMCApIHx8CiAgICAgICAgICAgICAgICByZXMuZ2V0SG91cnMoICkgIT0gcGFyc2VJbnQoIG1hdGNoZWRbIDQgXSwgMTAgKSB8fAogICAgICAgICAgICAgICAgcmVzLmdldE1pbnV0ZXMoICkgIT0gcGFyc2VJbnQoIG1hdGNoZWRbIDUgXSwgMTAgKSB8fAogICAgICAgICAgICAgICAgcmVzLmdldFNlY29uZHMoICkgIT0gcGFyc2VJbnQoIG1hdGNoZWRbIDYgXSwgMTAgKSApIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvciggU3RyaW5nVXRpbC5zcHJpbnRmKCAiVW5hYmxlIHRvIHVuZGVyc3RhbmQgZGF0ZSBzcGVjaWZpZWQgYXM6ICclcycgKEludmFsaWQgZGF0ZSBhZnRlciBubyBUWiAtIHJlZ2V4cCBtYXRjaD8pLiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGlzbzg2MDEgKSApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIExvZy5kZWJ1ZyggIlJldHVybmluZzogIiArIHJlcy50b1VUQ1N0cmluZyggKSApOwogICAgICAgIHJldHVybiByZXM7CiAgICB9IGVsc2UgewogICAgICAgIG1hdGNoZWQgPSBfX0RhdGVVdGlsQ29yZV9wYXJzZUlTTzg2MDEucmVnVFouZXhlYyggaXNvODYwMSApOwogICAgICAgIGlmICggbWF0Y2hlZCApIHsKICAgICAgICAgICAgTG9nLmRlYnVnKCAiTWF0Y2hlZCBhcyBzdHJpbmcgd2l0aCBub3JtYWwgdGltZXpvbmUgaW5mb3JtYXRpb24iICk7CiAgICAgICAgICAgIHZhciByZXMgPSBfX0RhdGVVdGlsQ29yZV9wYXJzZUlTTzg2MDEoIG1hdGNoZWRbIDEgXSArICJaIiApOwogICAgICAgICAgICBMb2cuZGVidWcoIFN0cmluZ1V0aWwuc3ByaW50ZiggIlBhcnRzOiAnJXMnLCAnJXMnLCAnJXMnIiwKICAgICAgICAgICAgICAgICAgICBtYXRjaGVkWyAyIF0sIG1hdGNoZWRbIDMgXSwgbWF0Y2hlZFsgNCBdICkgKTsKICAgICAgICAgICAgLy8gQWRqdXN0OiBJZiArLCBzdWJzdHJhY3QgdG8gZ2V0ICJyZWFsIiBVVEMuIElmIC0KICAgICAgICAgICAgaWYgKCBtYXRjaGVkWyAyIF0gPT0gIi0iICkgewogICAgICAgICAgICAgICAgcmVzLnNldFVUQ0hvdXJzKCByZXMuZ2V0VVRDSG91cnMoICkgKyBwYXJzZUludCggbWF0Y2hlZFsgMyBdLCAxMCApICk7CiAgICAgICAgICAgICAgICByZXMuc2V0VVRDTWludXRlcyggcmVzLmdldFVUQ01pbnV0ZXMoICkgKyBwYXJzZUludCggbWF0Y2hlZFsgNCBdLCAxMCApICk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXMuc2V0VVRDSG91cnMoIHJlcy5nZXRVVENIb3VycyggKSAtIHBhcnNlSW50KCBtYXRjaGVkWyAzIF0sIDEwICkgKTsKICAgICAgICAgICAgICAgIHJlcy5zZXRVVENNaW51dGVzKCByZXMuZ2V0VVRDTWludXRlcyggKSAtIHBhcnNlSW50KCBtYXRjaGVkWyA0IF0sIDEwICkgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBMb2cuZGVidWcoICJSZXR1cm5pbmc6ICIgKyByZXMudG9VVENTdHJpbmcoICkgKTsKICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICB9CgogICAgfQogICAgTG9nLmRlYnVnKCAiTm8gbWF0Y2ggZm9yIElTTzg2MDEgdmFyaWFudHMgLSB0aHJvd2luZyIgKTsKICAgIHRocm93IEVycm9yKCBTdHJpbmdVdGlsLnNwcmludGYoICJVbmFibGUgdG8gdW5kZXJzdGFuZCBkYXRlIHNwZWNpZmllZCBhczogJyVzJyAoTm8gcmVnZXhwIG1hdGNoKS4iLAogICAgICAgICAgICBpc284NjAxICkgKTsKfTsKX19EYXRlVXRpbENvcmVfcGFyc2VJU084NjAxLnJlZ1VUQyA9IC9eKFxkezR9KS0oXGR7Mn0pLShcZHsyfSlUKFxkezJ9KTooXGR7Mn0pOihcZHsyfSkoWnswLDF9KSQvOwpfX0RhdGVVdGlsQ29yZV9wYXJzZUlTTzg2MDEucmVnVFogPSAvXihcZHs0fS1cZHsyfS1cZHsyfVRcZHsyfTpcZHsyfTpcZHsyfSlccyooWystXSlccyooXGR7MSwyfSk6KFxkezEsMn0pJC87CgovKiogXGJyaWVmIFJldHVybiBhbiBJU084NjAxIFogdGltZSBzdHJpbmcgcmVwIG9mIHRoZSBKYXZhU2NyaXB0IGRhdGUgb2JqZWN0IHBhc3NlZCB0byB0aGUgZnVuY3Rpb24uCiAqCiAqIFRoZSBmb3JtYXQgaXMgWVlZWS1NTS1ERFRoaDptbTpzc1oKICogQHBhcmFtIGR0IFRoZSBKYXZhU2NyaXB0IGluc3RhbmNlIHRvIGNvbnZlcnQuCiAqIEByZXR1cm4gQSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGRhdGV0aW1lIGluIElTTzg2MDEgbGlrZSBub3RhdGlvbiBpbiBVVEMKICoKICogTm90ZSwgaWYgdGhlIGRhdGUgaXMgaW52YWxpZCwgeW91IGdldCBhIGxvdCBvZiBOYU4ncy4uLiBzb3JyeSBhYm91dCB0aGF0LCBzbyBzdWUgbWUhIDotKSAqLwp2YXIgX19EYXRlVXRpbENvcmVfZm9ybWF0SVNPODYwMSA9IGZ1bmN0aW9uKCBkYXRlICkgewogICAgLy8gV2UgZG8gbm90IGhhdmUgcGFydGlhbCBzZWNvbmRzLi4uIHNvLCBubyB0b0lTT1N0cmluZygpLi4uCiAgICByZXR1cm4gU3RyaW5nVXRpbC5zcHJpbnRmKCAiJTA0ZC0lMDJkLSUwMmRUJTAyZDolMDJkOiUwMmRaIiwKICAgICAgICBkYXRlLmdldFVUQ0Z1bGxZZWFyKCApLAogICAgICAgIGRhdGUuZ2V0VVRDTW9udGgoICkgKyAxLAogICAgICAgIGRhdGUuZ2V0VVRDRGF0ZSggKSwKICAgICAgICBkYXRlLmdldFVUQ0hvdXJzKCApLAogICAgICAgIGRhdGUuZ2V0VVRDTWludXRlcyggKSwKICAgICAgICBkYXRlLmdldFVUQ1NlY29uZHMoICkgKTsKfTsK", "moduleName": "DateUtilCore"}, {"javascript": "LyoqIEBmaWxlIFN0cmluZyB1dGlsaXRpZXMgKi8KRVhQT1JURURfU1lNQk9MUyA9IFsgJ1N0cmluZ1V0aWwnIF07CgovKiBTcHJpbnRmIGltcGxlbWVudGF0aW9uIGxpZnRlZCBmcm9tIGh0dHA6Ly93d3cud2VidG9vbGtpdC5pbmZvL2phdmFzY3JpcHQtc3ByaW50Zi5odG1sCiAqIE5vIGxpY2Vuc2UgaW5kaWNhdGVkIC0gYXNzdW1pbmcgcHVibGljIGRvbWFpbgoKICogTW9kaWZlZCB0byBiZSBhIG1vZHVsZSwgdGhlbiBsaW50ZWQsIFVuaXRUZXN0cyBhZGRlZC4KCkphdmFzY3JpcHQgc3ByaW50ZgpTZXZlcmFsIHByb2dyYW1taW5nIGxhbmd1YWdlcyBpbXBsZW1lbnQgYSBzcHJpbnRmIGZ1bmN0aW9uLCB0byBvdXRwdXQgYSBmb3JtYXR0ZWQgc3RyaW5nLiBJdCBvcmlnaW5hdGVkIGZyb20gdGhlIEMgcHJvZ3JhbW1pbmcgbGFuZ3VhZ2UsIHByaW50ZiBmdW5jdGlvbi4gSXRzIGEgc3RyaW5nIG1hbmlwdWxhdGlvbiBmdW5jdGlvbi4KVGhpcyBpcyBsaW1pdGVkIHNwcmludGYgSmF2YXNjcmlwdCBpbXBsZW1lbnRhdGlvbi4gRnVuY3Rpb24gcmV0dXJucyBhIHN0cmluZyBmb3JtYXR0ZWQgYnkgdGhlIHVzdWFsIHByaW50ZiBjb252ZW50aW9ucy4gU2VlIGJlbG93IGZvciBtb3JlIGRldGFpbHMuIFlvdSBtdXN0IHNwZWNpZnkgdGhlIHN0cmluZyBhbmQgaG93IHRvIGZvcm1hdCB0aGUgdmFyaWFibGVzIGluIGl0LiBQb3NzaWJsZSBmb3JtYXQgdmFsdWVzOgogJSUgLSBSZXR1cm5zIGEgcGVyY2VudCBzaWduCiAlYiAtIEJpbmFyeSBudW1iZXIKICVjIC0gVGhlIGNoYXJhY3RlciBhY2NvcmRpbmcgdG8gdGhlIEFTQ0lJIHZhbHVlCiAlZCAtIFNpZ25lZCBkZWNpbWFsIG51bWJlcgogJWYgLSBGbG9hdGluZy1wb2ludCBudW1iZXIKICVvIC0gT2N0YWwgbnVtYmVyCiAlcyAtIFN0cmluZwogJXggLSBIZXhhZGVjaW1hbCBudW1iZXIgKGxvd2VyY2FzZSBsZXR0ZXJzKQogJVggLSBIZXhhZGVjaW1hbCBudW1iZXIgKHVwcGVyY2FzZSBsZXR0ZXJzKQpBZGRpdGlvbmFsIGZvcm1hdCB2YWx1ZXMuIFRoZXNlIGFyZSBwbGFjZWQgYmV0d2VlbiB0aGUgJSBhbmQgdGhlIGxldHRlciAoZXhhbXBsZSAlLjJmKToKCiAKICsgKEZvcmNlcyBib3RoICsgYW5kIC0gaW4gZnJvbnQgb2YgbnVtYmVycy4gQnkgZGVmYXVsdCwgb25seSBuZWdhdGl2ZSBudW1iZXJzIGFyZSBtYXJrZWQpCiAtIChMZWZ0LWp1c3RpZmllcyB0aGUgdmFyaWFibGUgdmFsdWUpCiAwIHplcm8gd2lsbCBiZSB1c2VkIGZvciBwYWRkaW5nIHRoZSByZXN1bHRzIHRvIHRoZSByaWdodCBzdHJpbmcgc2l6ZQogWzAtOV0gKFNwZWNpZmllcyB0aGUgbWluaW11bSB3aWR0aCBoZWxkIG9mIHRvIHRoZSB2YXJpYWJsZSB2YWx1ZSkKIC5bMC05XSAoU3BlY2lmaWVzIHRoZSBudW1iZXIgb2YgZGVjaW1hbCBkaWdpdHMgb3IgbWF4aW11bSBzdHJpbmcgbGVuZ3RoKQoKCiovCgovKioKICogVmFyaW91cyBtZXRob2RzIHRvIG1hbmlwdWxhdGUgc3RyaW5ncy4KICogCiAqIFRoaXMgbmFtZXNwYWNlIGNvbnRhaW4ocykgbWV0aG9kcyB0aGF0IHByb3ZpZGUgc29tZSBzdHJpbmcgbWFuaXB1bGF0aW9uCiAqIG1ldGhvZHMsIHRoYXQgYXJlIG5vdCBwcm92aWRlZCBieSB0aGUgSmF2YVNjcmlwdCBTdHJpbmcgY2xhc3MsIHN1Y2ggYXMKICogc3ByaW50Zi4gCiAqCiAqIEB0eXBlIHtuYW1lc3BhY2V9CiAqIEBuYW1lIFN0cmluZ1V0aWwKICogQG5hbWVzcGFjZSAqLwp2YXIgU3RyaW5nVXRpbCA9IGZ1bmN0aW9uKCApIHsKICAgIHZhciB0aGF0ID0ge307CgogICAgdmFyIGNvbnZlcnQgPSBmdW5jdGlvbiggbWF0Y2gsIG5vc2lnbiApIHsKICAgICAgICBpZiAoIG5vc2lnbiApIHsKICAgICAgICAgICAgbWF0Y2guc2lnbiA9ICcnOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1hdGNoLnNpZ24gPSBtYXRjaC5uZWdhdGl2ZSA/ICctJyA6IG1hdGNoLnNpZ247CiAgICAgICAgfQogICAgICAgIHZhciBsID0gbWF0Y2gubWluIC0gbWF0Y2guYXJndW1lbnQubGVuZ3RoICsgMSAtIG1hdGNoLnNpZ24ubGVuZ3RoOwogICAgICAgIHZhciBwYWQ7CiAgICAgICAgaWYgKCBsIDwgMCApIHsKICAgICAgICAgICAgcGFkID0gWyBdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHBhZCA9IG5ldyBBcnJheSggbCApOwogICAgICAgIH0KICAgICAgICBwYWQgPSBwYWQuam9pbiggbWF0Y2gucGFkICk7CiAgICAgICAgaWYgKCAhbWF0Y2gubGVmdCApIHsKICAgICAgICAgICAgaWYgKCBtYXRjaC5wYWQgPT0gIjAiIHx8IG5vc2lnbiApIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaC5zaWduICsgcGFkICsgbWF0Y2guYXJndW1lbnQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFkICsgbWF0Y2guc2lnbiArIG1hdGNoLmFyZ3VtZW50OwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKCBtYXRjaC5wYWQgPT0gIjAiIHx8IG5vc2lnbiApIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaC5zaWduICsgbWF0Y2guYXJndW1lbnQgKyBwYWQucmVwbGFjZSggLzAvZywgJyAnICk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2guc2lnbiArIG1hdGNoLmFyZ3VtZW50ICsgcGFkOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCiAgICAvKioKICAgICAqIE1ldGhvZCB0aGF0IGNvbnZlcnRzIGRhbmlzaCBjaGFyYWN0ZXJzIHRvIFVSTCBlbmNvZGVkIHZhbHVlcyBmb3IgVVRGLTguCiAgICAgKiAKICAgICAqIEB0eXBlIHttZXRob2R9CiAgICAgKiBAc3ludGF4IFN0cmluZ1V0aWwuY29udmVydERhbmlzaENoYXJzVG9VdGY4VXJsRW5jb2RlZFZhbHVlcyggc3RyICkKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdHIgQSBzdHJpbmcgd2l0aCBhIGRhbmlzaCBjaGFyYWN0ZXIKICAgICAqIEByZXR1cm4ge1N0cmluZ30gQSBzdHJpbmcgd2l0aCBVVEYtOCBVUkwgZW5jb2RlZCB2YWx1ZQogICAgICogQGV4YW1wbGUgU3RyaW5nVXRpbC5jb252ZXJ0RGFuaXNoQ2hhcnNUb1V0ZjhVcmxFbmNvZGVkVmFsdWVzKCAiXHUwMEU2IiApCiAgICAgKiBAbmFtZSBTdHJpbmdVdGlsLmNvbnZlcnREYW5pc2hDaGFyc1RvVXRmOFVybEVuY29kZWRWYWx1ZXMKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgdGhhdC5jb252ZXJ0RGFuaXNoQ2hhcnNUb1V0ZjhVcmxFbmNvZGVkVmFsdWVzID0gZnVuY3Rpb24oIHN0ciApIHsKCiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoIC9cdTAwRTYvZywgIiVDMyVBNiIgKTsgLy9yZXBsYWNpbmcgZGFuaXNoIGFlIHRvIHRvIFVSTC1lbmNvZGVkIHZhbHVlIAogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKCAvXHUwMEY4L2csICIlQzMlQjgiICk7IC8vcmVwbGFjaW5nIGRhbmlzaCBvZSB0byB0byBVUkwtZW5jb2RlZCB2YWx1ZQogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKCAvXHUwMEU1L2csICIlQzMlQTUiICk7IC8vcmVwbGFjaW5nIGRhbmlzaCBhYSB0byB0byBVUkwtZW5jb2RlZCB2YWx1ZQogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKCAvXHUwMEM2L2csICIlQzMlODYiICk7IC8vcmVwbGFjaW5nIGRhbmlzaCBBZSB0byB0byBVUkwtZW5jb2RlZCB2YWx1ZQogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKCAvXHUwMEQ4L2csICIlQzMlOTgiICk7IC8vcmVwbGFjaW5nIGRhbmlzaCBPZSB0byB0byBVUkwtZW5jb2RlZCB2YWx1ZQogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKCAvXHUwMEM1L2csICIlQzMlODUiICk7IC8vcmVwbGFjaW5nIGRhbmlzaCBBYSB0byB0byBVUkwtZW5jb2RlZCB2YWx1ZQoKICAgICAgICByZXR1cm4gc3RyOwoKICAgIH07CgogICAgLyoqCiAgICAgKiBGb3JtYXQgc3RyaW5nIHdpdGggYXJndW1lbnRzLgogICAgICogCiAgICAgKiBJbXBsZW1lbnRhdGlvbiBvZiBzcHJpbnRmIGZvciBKYXZhU2NyaXB0LiBBbGxvd3MgdG8gZm9ybWF0IGEgc3RyaW5nLAogICAgICogYmFzZWQgb24gYSAndGVtcGxhdGUnLCBhbmQgYSBudW1iZXIgb2YgYXJndW1lbnRzLiAKICAgICAqCiAgICAgKiBQb3NzaWJsZSBmb3JtYXQgdmFsdWVzOgogICAgICoKICAgICAqICogJSUgOiBSZXR1cm5zIGEgcGVyY2VudCBzaWduCiAgICAgKiAqICViIDogQmluYXJ5IG51bWJlcgogICAgICogKiAlYyA6IFRoZSBjaGFyYWN0ZXIgYWNjb3JkaW5nIHRvIHRoZSBBU0NJSSB2YWx1ZQogICAgICogKiAlZCA6IFNpZ25lZCBkZWNpbWFsIG51bWJlcgogICAgICogKiAlZiA6IEZsb2F0aW5nLXBvaW50IG51bWJlcgogICAgICogKiAlbyA6IE9jdGFsIG51bWJlcgogICAgICogKiAlcyA6IFN0cmluZwogICAgICogKiAleCA6IEhleGFkZWNpbWFsIG51bWJlciAobG93ZXJjYXNlIGxldHRlcnMpCiAgICAgKiAqICVYIDogSGV4YWRlY2ltYWwgbnVtYmVyICh1cHBlcmNhc2UgbGV0dGVycykKICAgICAqCiAgICAgKiBBZGRpdGlvbmFsIGZvcm1hdCB2YWx1ZXMuIFRoZXNlIGFyZSBwbGFjZWQgYmV0d2VlbiB0aGUgJSBhbmQgdGhlIGxldHRlciAoZXhhbXBsZSAlLjJmKToKICAgICAqCiAgICAgKiAqICsgOiBGb3JjZXMgYm90aCArIGFuZCAtIGluIGZyb250IG9mIG51bWJlcnMuIEJ5IGRlZmF1bHQsIG9ubHkgbmVnYXRpdmUgbnVtYmVycyBhcmUgbWFya2VkCiAgICAgKiAqIC0gOiBMZWZ0LWp1c3RpZmllcyB0aGUgdmFyaWFibGUgdmFsdWUKICAgICAqICogMCA6IHplcm8gd2lsbCBiZSB1c2VkIGZvciBwYWRkaW5nIHRoZSByZXN1bHRzIHRvIHRoZSByaWdodCBzdHJpbmcgc2l6ZQogICAgICogKiBbMC05XSA6IFNwZWNpZmllcyB0aGUgbWluaW11bSB3aWR0aCBoZWxkIG9mIHRvIHRoZSB2YXJpYWJsZSB2YWx1ZQogICAgICogKiAuWzAtOV0gOiBTcGVjaWZpZXMgdGhlIG51bWJlciBvZiBkZWNpbWFsIGRpZ2l0cyBvciBtYXhpbXVtIHN0cmluZyBsZW5ndGgKICAgICAqCiAgICAgKiBGb3JtYXQgdmFsdWVzIGNhbiBiZSByZXBlYXRlZCBhbmQgbWl4ZWQgd2l0aCBub3JtYWwgdGV4dC4gRWFjaCBmb3JtYXQgdmFsdWUgd2lsbCBjb25zdW1lIG9uZSBhZGRpdGlvbmFsIGFyZ3VtZW50LgogICAgICoKICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBpcyBzbG93LiBVc2UgaXQgd2l0aCBjYXV0aW9uLgogICAgICogCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZm9ybWF0IEZvcm1hdHRpbmcgc3RyaW5nLCBzdWNoIGFzICJpbmRleCAlaSBpcyAlcyIKICAgICAqIEBwYXJhbSB7Li4ub2JqZWN0fSB2YWx1ZSBPbmUgb3IgbW9yZSB2YWx1ZXMgdG8gdXNlIGluIHRoZSBzdHJpbmcgZm9ybWF0IHRlbXBsYXRlLiBUaGlzIHdpbGwgYmUgY29udmVydGVkIHRvIGEgc3RyaW5nIGFjY29yZGluZyB0byB0aGUgc3BlY2lmaWNzIG9mIHRoZSB0ZW1wbGF0ZS4KICAgICAqIEByZXR1cm4ge1N0cmluZ30gQSBzdHJpbmcgZm9ybWF0dGVkIGFjY29yZGluZyB0byB0aGUgZm9ybWF0IHNwZWNpZmljYXRpb24uCiAgICAgKiBAZXhhbXBsZSAKLy8gVXNpbmcgdGhlIHNwcmludGYgZnVuY3Rpb24gaW4gYSBKYXZhU2NyaXB0IHNoZWxsLgpqcz4gcHJpbnQoIFN0cmluZ1V0aWwuc3ByaW50ZiggIkRhdGFiYXNlICclLTEwcyc6IE51bWJlciBvZiByZWNvcmRzIGluIGZpbGU6ICUwOGQuIEF2ZXJhZ2Ugc2l6ZTogJS4yZiBsaXRlcnMiLCAiQUJDRCIsIDEwNDMsIDM0LjQ1NiApICk7CkRhdGFiYXNlICdBQkNEICAgICAgJzogTnVtYmVyIG9mIHJlY29yZHMgaW4gZmlsZTogMDAwMDEwNDMuIEF2ZXJhZ2Ugc2l6ZTogMzQuNDYgbGl0ZXJzCiAgICAgKiBAbmFtZSBTdHJpbmdVdGlsLnNwcmludGYKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgdGhhdC5zcHJpbnRmID0gZnVuY3Rpb24oICkgewoKICAgICAgICBpZiAoIHR5cGVvZiBhcmd1bWVudHMgPT0gInVuZGVmaW5lZCIgKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAoIGFyZ3VtZW50cy5sZW5ndGggPCAxICkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKCB0eXBlb2YgYXJndW1lbnRzWyAwIF0gIT0gInN0cmluZyIgKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAoIHR5cGVvZiBSZWdFeHAgPT0gInVuZGVmaW5lZCIgKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgdmFyIHN0cmluZyA9IGFyZ3VtZW50c1sgMCBdOwogICAgICAgIHZhciBleHAgPSBuZXcgUmVnRXhwKCAvKCUoWyVdfChcLSk/KFwrfFx4MjApPygwKT8oXGQrKT8oXC4oXGQpPyk/KFtiY2Rmb3N4WF0pKSkvZyApOwogICAgICAgIHZhciBtYXRjaGVzID0gWyBdOwogICAgICAgIHZhciBzdHJpbmdzID0gWyBdOwogICAgICAgIHZhciBjb252Q291bnQgPSAwOwogICAgICAgIHZhciBzdHJpbmdQb3NTdGFydCA9IDA7CiAgICAgICAgdmFyIHN0cmluZ1Bvc0VuZCA9IDA7CiAgICAgICAgdmFyIG1hdGNoUG9zRW5kID0gMDsKICAgICAgICB2YXIgbmV3U3RyaW5nID0gJyc7CiAgICAgICAgdmFyIG1hdGNoID0gZXhwLmV4ZWMoIHN0cmluZyApOwogICAgICAgIHZhciBzdWJzdGl0dXRpb24gPSB1bmRlZmluZWQ7CiAgICAgICAgd2hpbGUgKCBtYXRjaCApIHsKICAgICAgICAgICAgaWYgKCBtYXRjaFsgOSBdICkgewogICAgICAgICAgICAgICAgY29udkNvdW50ICs9IDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN0cmluZ1Bvc1N0YXJ0ID0gbWF0Y2hQb3NFbmQ7CiAgICAgICAgICAgIHN0cmluZ1Bvc0VuZCA9IGV4cC5sYXN0SW5kZXggLSBtYXRjaFsgMCBdLmxlbmd0aDsKICAgICAgICAgICAgc3RyaW5nc1sgc3RyaW5ncy5sZW5ndGggXSA9IHN0cmluZy5zdWJzdHJpbmcoIHN0cmluZ1Bvc1N0YXJ0LCBzdHJpbmdQb3NFbmQgKTsKCiAgICAgICAgICAgIG1hdGNoUG9zRW5kID0gZXhwLmxhc3RJbmRleDsKICAgICAgICAgICAgbWF0Y2hlc1sgbWF0Y2hlcy5sZW5ndGggXSA9IHsKICAgICAgICAgICAgICAgIG1hdGNoOiBtYXRjaFsgMCBdLAogICAgICAgICAgICAgICAgbGVmdDogbWF0Y2hbIDMgXSA/IHRydWUgOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNpZ246IG1hdGNoWyA0IF0gfHwgJycsCiAgICAgICAgICAgICAgICBwYWQ6IG1hdGNoWyA1IF0gfHwgJyAnLAogICAgICAgICAgICAgICAgbWluOiBtYXRjaFsgNiBdIHx8IDAsCiAgICAgICAgICAgICAgICBwcmVjaXNpb246IG1hdGNoWyA4IF0sCiAgICAgICAgICAgICAgICBjb2RlOiBtYXRjaFsgOSBdIHx8ICclJywKICAgICAgICAgICAgICAgIG5lZ2F0aXZlOiBwYXJzZUludCggYXJndW1lbnRzWyBjb252Q291bnQgXSwgMTAgKSA8IDAgPyB0cnVlIDogZmFsc2UsCiAgICAgICAgICAgICAgICBhcmd1bWVudDogU3RyaW5nKCBhcmd1bWVudHNbIGNvbnZDb3VudCBdICkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgbWF0Y2ggPSBleHAuZXhlYyggc3RyaW5nICk7CiAgICAgICAgfQogICAgICAgIHN0cmluZ3NbIHN0cmluZ3MubGVuZ3RoIF0gPSBzdHJpbmcuc3Vic3RyaW5nKCBtYXRjaFBvc0VuZCApOwoKICAgICAgICBpZiAoIG1hdGNoZXMubGVuZ3RoID09PSAwICkgewogICAgICAgICAgICByZXR1cm4gc3RyaW5nOwogICAgICAgIH0KICAgICAgICBpZiAoICggYXJndW1lbnRzLmxlbmd0aCAtIDEgKSA8IGNvbnZDb3VudCApIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICB2YXIgY29kZSA9IG51bGw7CiAgICAgICAgbWF0Y2ggPSBudWxsOwogICAgICAgIHZhciBpID0gbnVsbDsKCiAgICAgICAgZm9yICggaSA9IDA7IGkgPCBtYXRjaGVzLmxlbmd0aDsgaSsrICkgewoKICAgICAgICAgICAgaWYgKCBtYXRjaGVzWyBpIF0uY29kZSA9PSAnJScgKSB7CiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSAnJSc7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIG1hdGNoZXNbIGkgXS5jb2RlID09ICdiJyApIHsKICAgICAgICAgICAgICAgIG1hdGNoZXNbIGkgXS5hcmd1bWVudCA9IFN0cmluZyggTWF0aC5hYnMoIHBhcnNlSW50KCBtYXRjaGVzWyBpIF0uYXJndW1lbnQsIDEwICkgKS50b1N0cmluZyggMiApICk7CiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSBjb252ZXJ0KCBtYXRjaGVzWyBpIF0sIHRydWUgKTsKICAgICAgICAgICAgfSBlbHNlIGlmICggbWF0Y2hlc1sgaSBdLmNvZGUgPT0gJ2MnICkgewogICAgICAgICAgICAgICAgbWF0Y2hlc1sgaSBdLmFyZ3VtZW50ID0gU3RyaW5nKCBTdHJpbmcuZnJvbUNoYXJDb2RlKCBwYXJzZUludCggTWF0aC5hYnMoIHBhcnNlSW50KCBtYXRjaGVzWyBpIF0uYXJndW1lbnQsIDEwICkgKSwgMTAgKSApICk7CiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSBjb252ZXJ0KCBtYXRjaGVzWyBpIF0sIHRydWUgKTsKICAgICAgICAgICAgfSBlbHNlIGlmICggbWF0Y2hlc1sgaSBdLmNvZGUgPT0gJ2QnICkgewogICAgICAgICAgICAgICAgbWF0Y2hlc1sgaSBdLmFyZ3VtZW50ID0gU3RyaW5nKCBNYXRoLmFicyggcGFyc2VJbnQoIG1hdGNoZXNbIGkgXS5hcmd1bWVudCwgMTAgKSApICk7CiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSBjb252ZXJ0KCBtYXRjaGVzWyBpIF0gKTsKICAgICAgICAgICAgfSBlbHNlIGlmICggbWF0Y2hlc1sgaSBdLmNvZGUgPT0gJ2YnICkgewogICAgICAgICAgICAgICAgbWF0Y2hlc1sgaSBdLmFyZ3VtZW50ID0gU3RyaW5nKCBNYXRoLmFicyggcGFyc2VGbG9hdCggbWF0Y2hlc1sgaSBdLmFyZ3VtZW50ICkgKS50b0ZpeGVkKCBtYXRjaGVzWyBpIF0ucHJlY2lzaW9uID8gbWF0Y2hlc1sgaSBdLnByZWNpc2lvbiA6IDYgKSApOwogICAgICAgICAgICAgICAgc3Vic3RpdHV0aW9uID0gY29udmVydCggbWF0Y2hlc1sgaSBdICk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIG1hdGNoZXNbIGkgXS5jb2RlID09ICdvJyApIHsKICAgICAgICAgICAgICAgIG1hdGNoZXNbIGkgXS5hcmd1bWVudCA9IFN0cmluZyggTWF0aC5hYnMoIHBhcnNlSW50KCBtYXRjaGVzWyBpIF0uYXJndW1lbnQsIDEwICkgKS50b1N0cmluZyggOCApICk7CiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSBjb252ZXJ0KCBtYXRjaGVzWyBpIF0gKTsKICAgICAgICAgICAgfSBlbHNlIGlmICggbWF0Y2hlc1sgaSBdLmNvZGUgPT0gJ3MnICkgewogICAgICAgICAgICAgICAgbWF0Y2hlc1sgaSBdLmFyZ3VtZW50ID0gbWF0Y2hlc1sgaSBdLmFyZ3VtZW50LnN1YnN0cmluZyggMCwgbWF0Y2hlc1sgaSBdLnByZWNpc2lvbiA/IG1hdGNoZXNbIGkgXS5wcmVjaXNpb24gOiBtYXRjaGVzWyBpIF0uYXJndW1lbnQubGVuZ3RoICk7CiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSBjb252ZXJ0KCBtYXRjaGVzWyBpIF0sIHRydWUgKTsKICAgICAgICAgICAgfSBlbHNlIGlmICggbWF0Y2hlc1sgaSBdLmNvZGUgPT0gJ3gnICkgewogICAgICAgICAgICAgICAgbWF0Y2hlc1sgaSBdLmFyZ3VtZW50ID0gU3RyaW5nKCBNYXRoLmFicyggcGFyc2VJbnQoIG1hdGNoZXNbIGkgXS5hcmd1bWVudCwgMTAgKSApLnRvU3RyaW5nKCAxNiApICk7CiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSBjb252ZXJ0KCBtYXRjaGVzWyBpIF0gKTsKICAgICAgICAgICAgfSBlbHNlIGlmICggbWF0Y2hlc1sgaSBdLmNvZGUgPT0gJ1gnICkgewogICAgICAgICAgICAgICAgbWF0Y2hlc1sgaSBdLmFyZ3VtZW50ID0gU3RyaW5nKCBNYXRoLmFicyggcGFyc2VJbnQoIG1hdGNoZXNbIGkgXS5hcmd1bWVudCwgMTAgKSApLnRvU3RyaW5nKCAxNiApICk7CiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSBjb252ZXJ0KCBtYXRjaGVzWyBpIF0gKS50b1VwcGVyQ2FzZSggKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHN1YnN0aXR1dGlvbiA9IG1hdGNoZXNbIGkgXS5tYXRjaDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbmV3U3RyaW5nICs9IHN0cmluZ3NbIGkgXTsKICAgICAgICAgICAgbmV3U3RyaW5nICs9IHN1YnN0aXR1dGlvbjsKCiAgICAgICAgfQogICAgICAgIG5ld1N0cmluZyArPSBzdHJpbmdzWyBpIF07CgogICAgICAgIHJldHVybiBuZXdTdHJpbmc7CgogICAgfTsKCiAgIC8qKgogICAgICogUmV0dXJuIHRoZSBudW1iZXIgb2Ygb2N0ZXRzIG9mIGEgdW5pY29kZSBjaGFyCiAgICAgKiAKICAgICAqIEBzeW50YXggdXRmOExlbmd0aE9mQ2hhciggVW5pY29kZUNoYXIgKQogICAgICogQHBhcmFtIHtOdW1iZXJ9IFVuaWNvZGVDaGFyIENvZGVwb2ludCBmb3IgY2hhcgogICAgICogQHJldHVybiB7TnVtYmVyfSBvY3RldCBsZW5ndGggb2YgVW5pY29kZSBDaGFyIGluIFVURi04CiAgICAgKgogICAgICogSW50ZXJuYWwgSGVscGVyIEZ1bmN0aW9uCiAgICAgKgogICAgICoKICAgICAqIGNvZGUgQmFzZWQgb24gJ21hbiBVVEYtOCcKICAgICAqICAgICAgICAweDAwMDAwMDAwIC0gMHgwMDAwMDA3RjoKICAgICAweHh4eHh4eAogICAgIDB4MDAwMDAwODAgLSAweDAwMDAwN0ZGOgogICAgIDExMHh4eHh4IDEweHh4eHh4CiAgICAgMHgwMDAwMDgwMCAtIDB4MDAwMEZGRkY6CiAgICAgMTExMHh4eHggMTB4eHh4eHggMTB4eHh4eHgKICAgICAweDAwMDEwMDAwIC0gMHgwMDFGRkZGRjoKICAgICAxMTExMHh4eCAxMHh4eHh4eCAxMHh4eHh4eCAxMHh4eHh4eAogICAgIDB4MDAyMDAwMDAgLSAweDAzRkZGRkZGOgogICAgIDExMTExMHh4IDEweHh4eHh4IDEweHh4eHh4IDEweHh4eHh4IDEweHh4eHh4CiAgICAgMHgwNDAwMDAwMCAtIDB4N0ZGRkZGRkY6CiAgICAgMTExMTExMHggMTB4eHh4eHggMTB4eHh4eHggMTB4eHh4eHggMTB4eHh4eHggMTB4eHh4eHgKCiAgICAgKi8KICAgIHZhciB1dGY4TGVuZ3RoT2ZDaGFyID0gZnVuY3Rpb24oIFVuaWNvZGVDaGFyICkgewogICAgICAgIGlmICggVW5pY29kZUNoYXIgPD0gMHg3RiApIHJldHVybiAxOwogICAgICAgIGlmICggVW5pY29kZUNoYXIgPD0gMHg3RkYgKSByZXR1cm4gMjsKICAgICAgICBpZiAoIFVuaWNvZGVDaGFyIDw9IDB4RkZGRiApIHJldHVybiAzOwogICAgICAgIGlmICggVW5pY29kZUNoYXIgPD0gMHgwMDFGRkZGRiApIHJldHVybiA0OwogICAgICAgIGlmICggVW5pY29kZUNoYXIgPD0gMHgwM0ZGRkZGRiApIHJldHVybiA1OwogICAgICAgIC8vaWYoIFVuaWNvZGVDaGFyIDw9IDB4N0ZGRkZGRkYgKQogICAgICAgIHJldHVybiA2OwoKICAgIH07CgogICAgLy90aGlzIGlzIHRvIGJlIGFibGUgdG8gdGVzdCB0aGUgaW50ZXJuYWwgZnVuY3Rpb24gdXRmOExlbmd0aE9mQ2hhcgogICAgdGhhdC5fX3V0ZjhMZW5ndGhPZkNoYXIgPSB1dGY4TGVuZ3RoT2ZDaGFyOwoKCiAgICAvKiBHZXQgQ29ycmVjdCBNdWx0aSBDaGFyIGVuY29kZWVkIFVuaWNvZGVWYWx1ZSBjb2RlIHRha2VuIGZyb20gICAgICAgIAogICAgICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvU3RyaW5nL2NoYXJDb2RlQXQgCiAgICAgKiAKICAgICAqIE5vdGUgcmV0dXJucyBVbmljb2RlIFZhbHVlIGZvciBmaXJzdCBFbnRyeSwgYW5kIGZhbHNlIGZvciBzZWNvbmQgCiAgICAgKi8KCiAgICB2YXIgZml4ZWRDaGFyQ29kZUF0ID0gZnVuY3Rpb24oc3RyLCBpZHgpIHsKICAgICAgICAvLyBleC4gZml4ZWRDaGFyQ29kZUF0KCdcdUQ4MDBcdURDMDAnLCAwKTsgLy8gNjU1MzYKICAgICAgICAvLyBleC4gZml4ZWRDaGFyQ29kZUF0KCdcdUQ4MDBcdURDMDAnLCAxKTsgLy8gZmFsc2UKICAgICAgICBpZHggPSBpZHggfHwgMDsKICAgICAgICB2YXIgY29kZSA9IHN0ci5jaGFyQ29kZUF0KGlkeCk7CiAgICAgICAgdmFyIGhpLCBsb3c7CiAgICAgICAgCiAgICAgICAgLy8gSGlnaCBzdXJyb2dhdGUgKGNvdWxkIGNoYW5nZSBsYXN0IGhleCB0byAweERCN0YgdG8gdHJlYXQgaGlnaAogICAgICAgIC8vIHByaXZhdGUgc3Vycm9nYXRlcyBhcyBzaW5nbGUgY2hhcmFjdGVycykKICAgICAgICBpZiAoMHhEODAwIDw9IGNvZGUgJiYgY29kZSA8PSAweERCRkYpIHsKICAgICAgICAgICAgaGkgPSBjb2RlOwogICAgICAgICAgICBsb3cgPSBzdHIuY2hhckNvZGVBdChpZHggKyAxKTsKICAgICAgICAgICAgaWYgKGlzTmFOKGxvdykpIHsKICAgICAgICAgICAgICAgIHRocm93ICdIaWdoIHN1cnJvZ2F0ZSBub3QgZm9sbG93ZWQgYnkgbG93IHN1cnJvZ2F0ZSBpbiBmaXhlZENoYXJDb2RlQXQoKSc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICgoaGkgLSAweEQ4MDApICogMHg0MDApICsgKGxvdyAtIDB4REMwMCkgKyAweDEwMDAwOwogICAgICAgIH0KICAgICAgICBpZiAoMHhEQzAwIDw9IGNvZGUgJiYgY29kZSA8PSAweERGRkYpIHsgLy8gTG93IHN1cnJvZ2F0ZQogICAgICAgICAgICAvLyBXZSByZXR1cm4gZmFsc2UgdG8gYWxsb3cgbG9vcHMgdG8gc2tpcCB0aGlzIGl0ZXJhdGlvbiBzaW5jZSBzaG91bGQgaGF2ZQogICAgICAgICAgICAvLyBhbHJlYWR5IGhhbmRsZWQgaGlnaCBzdXJyb2dhdGUgYWJvdmUgaW4gdGhlIHByZXZpb3VzIGl0ZXJhdGlvbgogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIC8qaGkgPSBzdHIuY2hhckNvZGVBdChpZHggLSAxKTsKICAgICAgICAgICAgICBsb3cgPSBjb2RlOwogICAgICAgICAgICAgIHJldHVybiAoKGhpIC0gMHhEODAwKSAqIDB4NDAwKSArIChsb3cgLSAweERDMDApICsgMHgxMDAwMDsqLwogICAgICAgIH0KICAgICAgICByZXR1cm4gY29kZTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG51bWJlciBvZiBvY3RldHMgb2YgYSBzdHJpbmcsIHdoZW4gZW5jb2RlZCBhcyBVVEY4LgogICAgICogCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB1c2VkLCBpZiB5b3Ugd2lzaCB0byBrbm93IHRoZSBsZW5naHQgb2YgYSBzdHJpbmcKICAgICAqIGluIG9jdGV0cy9ieXRlcywgaWYgdGhlIHN0cmluZyBpcyBlbmNvZGVkIGluIFVURjguIFRoaXMgaXMKICAgICAqIG1vc3RseSByZWxldmFudCBpZiB5b3UgbmVlZCB0byBwcm9kdWNlIGVuY29kZWQgZmlsZXMgZnJvbQogICAgICogd2l0aGluIEphdmFTY3JpcHQsIHdoaWNoIGlzIHRoZSBjYXNlIGZvciBlLmcuICJhZGRpIiBmaWxlcy4KICAgICAqCiAgICAgKiBAc3ludGF4IHV0ZjhMZW5ndGhPZlN0cmluZyggVW5pY29kZVN0cmluZyApCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gVW5pY29kZVN0cmluZyBBIHN0YW5kYXJkIGphdmFzdHJpbmcKICAgICAqIEByZXR1cm4ge051bWJlcn0gT2N0ZXQgbGVuZ3RoIG9mIFVURjggZW5jb2Rpbmcgb2YgU3RyaW5nCiAgICAgKiBAZXhhbXBsZQovLyBUaGlzIGNhbGwgd2lsbCByZXR1cm4gMjoKU3RyaW5nVXRpbC51dGY4TGVuZ3RoT2ZDaGFyKCAiXHUwMEU2IiApOyAvLyBEYW5pc2ggbGV0dGVyIGFlCi8vIFRoZXJlIGlzIGEgZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZSBudW1iZXIgb2YgY2hhcmFjdGVycywgYW5kIHRoZSB1dGY4IGxlbmd0aDoKdmFyIHRlc3QgPSAiRGVsZmVsdCBcdTAwRTYgZXIgaGVyIjsgLy8gU3RpbGwgRGFuaXNoIGxldHRlciBhZQp0ZXN0Lmxlbmd0aDsgLy8gUmV0dXJucyAxNgpTdHJpbmdVdGlsLnV0ZjhMZW5ndGhPZlN0cmluZyggdGVzdCApOyAvLyBSZXR1cm5zIDE3CiAgICAgKiBAbmFtZSBTdHJpbmdVdGlsLnV0ZjhMZW5ndGhPZlN0cmluZwogICAgICogQG1ldGhvZAogICAgICovCiAgICB0aGF0LnV0ZjhMZW5ndGhPZlN0cmluZyA9IGZ1bmN0aW9uKCBVbmljb2RlU3RyaW5nICkgewogICAgICAgIHZhciBsZW5ndGggPSAwOwogICAgICAgIHZhciBpID0gMDsKICAgICAgICB2YXIgbiA9IFVuaWNvZGVTdHJpbmcubGVuZ3RoOwoKICAgICAgICBmb3IgKCA7IGkgPCBuOyArK2kgKSB7CiAgICAgICAgICAgIHZhciBjaGFyQ29kZSA9IGZpeGVkQ2hhckNvZGVBdCggVW5pY29kZVN0cmluZywgaSApOwogICAgICAgICAgICBpZiggY2hhckNvZGUgKSB7ICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGVuZ3RoICs9IHV0ZjhMZW5ndGhPZkNoYXIoIGNoYXJDb2RlICk7CiAgICAgICAgICAgIH0gLy8gZWxzZSBmaXhlZENoYXJDb2RlIHJldHVybiBmYWxzZSBmb3IgY29kZVBvaW50IGFscmVhZHkgcHJvY2Vzc2VkCiAgICAgICAgfQogICAgICAgIHJldHVybiBsZW5ndGg7CiAgICB9OwoKCiAgICAvKioKICAgICAqIE1ldGhvZCB0aGF0IG5vcm1hbGl6ZXMgZGlhY3JpdGljcy4KICAgICAqIAogICAgICogQHR5cGUge21ldGhvZH0KICAgICAqIEBzeW50YXggU3RyaW5nVXRpbC5ub3JtYWxpemVEaWFjcml0aWNzKCBzdHJpbmcgKQogICAgICogQHBhcmFtIHtTdHJpbmd9IHN0cmluZyBUaGUgc3RyaW5nIHRoYXQgcG9zc2libHkgY29udGFpbnMgZGlhY3JpdGljcwogICAgICogQHJldHVybiB7U3RyaW5nfSB0aGUgbm9ybWFsaXplZCBzdHJpbmcKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFN0cmluZ1V0aWwubm9ybWFsaXplRGlhY3JpdGljcwogICAgICogQGV4YW1wbGUgU3RyaW5nVXRpbC5ub3JtYWxpemVEaWFjcml0aWNzKCAiUmVuXHUwMEU5IiApCiAgICAgKi8KICAgIHRoYXQubm9ybWFsaXplRGlhY3JpdGljcyA9IGZ1bmN0aW9uKCBzdHJpbmcgKSB7CgogICAgICAgIHZhciBkaWFjcml0aWNzTWFwID0gewogICAgICAgICAgICAiXHUwMDQxIjogIkEiLAogICAgICAgICAgICAiXHUyNEI2IjogIkEiLAogICAgICAgICAgICAiXHVGRjIxIjogIkEiLAogICAgICAgICAgICAiXHUwMEMwIjogIkEiLAogICAgICAgICAgICAiXHUwMEMxIjogIkEiLAogICAgICAgICAgICAiXHUwMEMyIjogIkEiLAogICAgICAgICAgICAiXHUxRUE2IjogIkEiLAogICAgICAgICAgICAiXHUxRUE0IjogIkEiLAogICAgICAgICAgICAiXHUxRUFBIjogIkEiLAogICAgICAgICAgICAiXHUxRUE4IjogIkEiLAogICAgICAgICAgICAiXHUwMEMzIjogIkEiLAogICAgICAgICAgICAiXHUwMTAwIjogIkEiLAogICAgICAgICAgICAiXHUwMTAyIjogIkEiLAogICAgICAgICAgICAiXHUxRUIwIjogIkEiLAogICAgICAgICAgICAiXHUxRUFFIjogIkEiLAogICAgICAgICAgICAiXHUxRUI0IjogIkEiLAogICAgICAgICAgICAiXHUxRUIyIjogIkEiLAogICAgICAgICAgICAiXHUwMjI2IjogIkEiLAogICAgICAgICAgICAiXHUwMUUwIjogIkEiLAogICAgICAgICAgICAiXHUwMEM0IjogIkEiLAogICAgICAgICAgICAiXHUwMURFIjogIkEiLAogICAgICAgICAgICAiXHUxRUEyIjogIkEiLAogICAgICAgICAgICAiXHUwMEM1IjogIkEiLAogICAgICAgICAgICAiXHUwMUZBIjogIkEiLAogICAgICAgICAgICAiXHUwMUNEIjogIkEiLAogICAgICAgICAgICAiXHUwMjAwIjogIkEiLAogICAgICAgICAgICAiXHUwMjAyIjogIkEiLAogICAgICAgICAgICAiXHUxRUEwIjogIkEiLAogICAgICAgICAgICAiXHUxRUFDIjogIkEiLAogICAgICAgICAgICAiXHUxRUI2IjogIkEiLAogICAgICAgICAgICAiXHUxRTAwIjogIkEiLAogICAgICAgICAgICAiXHUwMTA0IjogIkEiLAogICAgICAgICAgICAiXHUwMjNBIjogIkEiLAogICAgICAgICAgICAiXHUyQzZGIjogIkEiLAogICAgICAgICAgICAiXHVBNzMyIjogIkFBIiwKICAgICAgICAgICAgIlx1MDBDNiI6ICJBRSIsCiAgICAgICAgICAgICJcdTAxRkMiOiAiQUUiLAogICAgICAgICAgICAiXHUwMUUyIjogIkFFIiwKICAgICAgICAgICAgIlx1QTczNCI6ICJBTyIsCiAgICAgICAgICAgICJcdUE3MzYiOiAiQVUiLAogICAgICAgICAgICAiXHVBNzM4IjogIkFWIiwKICAgICAgICAgICAgIlx1QTczQSI6ICJBViIsCiAgICAgICAgICAgICJcdUE3M0MiOiAiQVkiLAogICAgICAgICAgICAiXHUwMDQyIjogIkIiLAogICAgICAgICAgICAiXHUyNEI3IjogIkIiLAogICAgICAgICAgICAiXHVGRjIyIjogIkIiLAogICAgICAgICAgICAiXHUxRTAyIjogIkIiLAogICAgICAgICAgICAiXHUxRTA0IjogIkIiLAogICAgICAgICAgICAiXHUxRTA2IjogIkIiLAogICAgICAgICAgICAiXHUwMjQzIjogIkIiLAogICAgICAgICAgICAiXHUwMTgyIjogIkIiLAogICAgICAgICAgICAiXHUwMTgxIjogIkIiLAogICAgICAgICAgICAiXHUwMDQzIjogIkMiLAogICAgICAgICAgICAiXHUyNEI4IjogIkMiLAogICAgICAgICAgICAiXHVGRjIzIjogIkMiLAogICAgICAgICAgICAiXHUwMTA2IjogIkMiLAogICAgICAgICAgICAiXHUwMTA4IjogIkMiLAogICAgICAgICAgICAiXHUwMTBBIjogIkMiLAogICAgICAgICAgICAiXHUwMTBDIjogIkMiLAogICAgICAgICAgICAiXHUwMEM3IjogIkMiLAogICAgICAgICAgICAiXHUxRTA4IjogIkMiLAogICAgICAgICAgICAiXHUwMTg3IjogIkMiLAogICAgICAgICAgICAiXHUwMjNCIjogIkMiLAogICAgICAgICAgICAiXHVBNzNFIjogIkMiLAogICAgICAgICAgICAiXHUwMDQ0IjogIkQiLAogICAgICAgICAgICAiXHUyNEI5IjogIkQiLAogICAgICAgICAgICAiXHVGRjI0IjogIkQiLAogICAgICAgICAgICAiXHUxRTBBIjogIkQiLAogICAgICAgICAgICAiXHUwMTBFIjogIkQiLAogICAgICAgICAgICAiXHUxRTBDIjogIkQiLAogICAgICAgICAgICAiXHUxRTEwIjogIkQiLAogICAgICAgICAgICAiXHUxRTEyIjogIkQiLAogICAgICAgICAgICAiXHUxRTBFIjogIkQiLAogICAgICAgICAgICAiXHUwMTEwIjogIkQiLAogICAgICAgICAgICAiXHUwMThCIjogIkQiLAogICAgICAgICAgICAiXHUwMThBIjogIkQiLAogICAgICAgICAgICAiXHUwMTg5IjogIkQiLAogICAgICAgICAgICAiXHVBNzc5IjogIkQiLAogICAgICAgICAgICAiXHUwMUYxIjogIkRaIiwKICAgICAgICAgICAgIlx1MDFDNCI6ICJEWiIsCiAgICAgICAgICAgICJcdTAxRjIiOiAiRHoiLAogICAgICAgICAgICAiXHUwMUM1IjogIkR6IiwKICAgICAgICAgICAgIlx1MDA0NSI6ICJFIiwKICAgICAgICAgICAgIlx1MjRCQSI6ICJFIiwKICAgICAgICAgICAgIlx1RkYyNSI6ICJFIiwKICAgICAgICAgICAgIlx1MDBDOCI6ICJFIiwKICAgICAgICAgICAgIlx1MDBDOSI6ICJFIiwKICAgICAgICAgICAgIlx1MDBDQSI6ICJFIiwKICAgICAgICAgICAgIlx1MUVDMCI6ICJFIiwKICAgICAgICAgICAgIlx1MUVCRSI6ICJFIiwKICAgICAgICAgICAgIlx1MUVDNCI6ICJFIiwKICAgICAgICAgICAgIlx1MUVDMiI6ICJFIiwKICAgICAgICAgICAgIlx1MUVCQyI6ICJFIiwKICAgICAgICAgICAgIlx1MDExMiI6ICJFIiwKICAgICAgICAgICAgIlx1MUUxNCI6ICJFIiwKICAgICAgICAgICAgIlx1MUUxNiI6ICJFIiwKICAgICAgICAgICAgIlx1MDExNCI6ICJFIiwKICAgICAgICAgICAgIlx1MDExNiI6ICJFIiwKICAgICAgICAgICAgIlx1MDBDQiI6ICJFIiwKICAgICAgICAgICAgIlx1MUVCQSI6ICJFIiwKICAgICAgICAgICAgIlx1MDExQSI6ICJFIiwKICAgICAgICAgICAgIlx1MDIwNCI6ICJFIiwKICAgICAgICAgICAgIlx1MDIwNiI6ICJFIiwKICAgICAgICAgICAgIlx1MUVCOCI6ICJFIiwKICAgICAgICAgICAgIlx1MUVDNiI6ICJFIiwKICAgICAgICAgICAgIlx1MDIyOCI6ICJFIiwKICAgICAgICAgICAgIlx1MUUxQyI6ICJFIiwKICAgICAgICAgICAgIlx1MDExOCI6ICJFIiwKICAgICAgICAgICAgIlx1MUUxOCI6ICJFIiwKICAgICAgICAgICAgIlx1MUUxQSI6ICJFIiwKICAgICAgICAgICAgIlx1MDE5MCI6ICJFIiwKICAgICAgICAgICAgIlx1MDE4RSI6ICJFIiwKICAgICAgICAgICAgIlx1MDA0NiI6ICJGIiwKICAgICAgICAgICAgIlx1MjRCQiI6ICJGIiwKICAgICAgICAgICAgIlx1RkYyNiI6ICJGIiwKICAgICAgICAgICAgIlx1MUUxRSI6ICJGIiwKICAgICAgICAgICAgIlx1MDE5MSI6ICJGIiwKICAgICAgICAgICAgIlx1QTc3QiI6ICJGIiwKICAgICAgICAgICAgIlx1MDA0NyI6ICJHIiwKICAgICAgICAgICAgIlx1MjRCQyI6ICJHIiwKICAgICAgICAgICAgIlx1RkYyNyI6ICJHIiwKICAgICAgICAgICAgIlx1MDFGNCI6ICJHIiwKICAgICAgICAgICAgIlx1MDExQyI6ICJHIiwKICAgICAgICAgICAgIlx1MUUyMCI6ICJHIiwKICAgICAgICAgICAgIlx1MDExRSI6ICJHIiwKICAgICAgICAgICAgIlx1MDEyMCI6ICJHIiwKICAgICAgICAgICAgIlx1MDFFNiI6ICJHIiwKICAgICAgICAgICAgIlx1MDEyMiI6ICJHIiwKICAgICAgICAgICAgIlx1MDFFNCI6ICJHIiwKICAgICAgICAgICAgIlx1MDE5MyI6ICJHIiwKICAgICAgICAgICAgIlx1QTdBMCI6ICJHIiwKICAgICAgICAgICAgIlx1QTc3RCI6ICJHIiwKICAgICAgICAgICAgIlx1QTc3RSI6ICJHIiwKICAgICAgICAgICAgIlx1MDA0OCI6ICJIIiwKICAgICAgICAgICAgIlx1MjRCRCI6ICJIIiwKICAgICAgICAgICAgIlx1RkYyOCI6ICJIIiwKICAgICAgICAgICAgIlx1MDEyNCI6ICJIIiwKICAgICAgICAgICAgIlx1MUUyMiI6ICJIIiwKICAgICAgICAgICAgIlx1MUUyNiI6ICJIIiwKICAgICAgICAgICAgIlx1MDIxRSI6ICJIIiwKICAgICAgICAgICAgIlx1MUUyNCI6ICJIIiwKICAgICAgICAgICAgIlx1MUUyOCI6ICJIIiwKICAgICAgICAgICAgIlx1MUUyQSI6ICJIIiwKICAgICAgICAgICAgIlx1MDEyNiI6ICJIIiwKICAgICAgICAgICAgIlx1MkM2NyI6ICJIIiwKICAgICAgICAgICAgIlx1MkM3NSI6ICJIIiwKICAgICAgICAgICAgIlx1QTc4RCI6ICJIIiwKICAgICAgICAgICAgIlx1MDA0OSI6ICJJIiwKICAgICAgICAgICAgIlx1MjRCRSI6ICJJIiwKICAgICAgICAgICAgIlx1RkYyOSI6ICJJIiwKICAgICAgICAgICAgIlx1MDBDQyI6ICJJIiwKICAgICAgICAgICAgIlx1MDBDRCI6ICJJIiwKICAgICAgICAgICAgIlx1MDBDRSI6ICJJIiwKICAgICAgICAgICAgIlx1MDEyOCI6ICJJIiwKICAgICAgICAgICAgIlx1MDEyQSI6ICJJIiwKICAgICAgICAgICAgIlx1MDEyQyI6ICJJIiwKICAgICAgICAgICAgIlx1MDEzMCI6ICJJIiwKICAgICAgICAgICAgIlx1MDBDRiI6ICJJIiwKICAgICAgICAgICAgIlx1MUUyRSI6ICJJIiwKICAgICAgICAgICAgIlx1MUVDOCI6ICJJIiwKICAgICAgICAgICAgIlx1MDFDRiI6ICJJIiwKICAgICAgICAgICAgIlx1MDIwOCI6ICJJIiwKICAgICAgICAgICAgIlx1MDIwQSI6ICJJIiwKICAgICAgICAgICAgIlx1MUVDQSI6ICJJIiwKICAgICAgICAgICAgIlx1MDEyRSI6ICJJIiwKICAgICAgICAgICAgIlx1MUUyQyI6ICJJIiwKICAgICAgICAgICAgIlx1MDE5NyI6ICJJIiwKICAgICAgICAgICAgIlx1MDA0QSI6ICJKIiwKICAgICAgICAgICAgIlx1MjRCRiI6ICJKIiwKICAgICAgICAgICAgIlx1RkYyQSI6ICJKIiwKICAgICAgICAgICAgIlx1MDEzNCI6ICJKIiwKICAgICAgICAgICAgIlx1MDI0OCI6ICJKIiwKICAgICAgICAgICAgIlx1MDA0QiI6ICJLIiwKICAgICAgICAgICAgIlx1MjRDMCI6ICJLIiwKICAgICAgICAgICAgIlx1RkYyQiI6ICJLIiwKICAgICAgICAgICAgIlx1MUUzMCI6ICJLIiwKICAgICAgICAgICAgIlx1MDFFOCI6ICJLIiwKICAgICAgICAgICAgIlx1MUUzMiI6ICJLIiwKICAgICAgICAgICAgIlx1MDEzNiI6ICJLIiwKICAgICAgICAgICAgIlx1MUUzNCI6ICJLIiwKICAgICAgICAgICAgIlx1MDE5OCI6ICJLIiwKICAgICAgICAgICAgIlx1MkM2OSI6ICJLIiwKICAgICAgICAgICAgIlx1QTc0MCI6ICJLIiwKICAgICAgICAgICAgIlx1QTc0MiI6ICJLIiwKICAgICAgICAgICAgIlx1QTc0NCI6ICJLIiwKICAgICAgICAgICAgIlx1QTdBMiI6ICJLIiwKICAgICAgICAgICAgIlx1MDA0QyI6ICJMIiwKICAgICAgICAgICAgIlx1MjRDMSI6ICJMIiwKICAgICAgICAgICAgIlx1RkYyQyI6ICJMIiwKICAgICAgICAgICAgIlx1MDEzRiI6ICJMIiwKICAgICAgICAgICAgIlx1MDEzOSI6ICJMIiwKICAgICAgICAgICAgIlx1MDEzRCI6ICJMIiwKICAgICAgICAgICAgIlx1MUUzNiI6ICJMIiwKICAgICAgICAgICAgIlx1MUUzOCI6ICJMIiwKICAgICAgICAgICAgIlx1MDEzQiI6ICJMIiwKICAgICAgICAgICAgIlx1MUUzQyI6ICJMIiwKICAgICAgICAgICAgIlx1MUUzQSI6ICJMIiwKICAgICAgICAgICAgIlx1MDE0MSI6ICJMIiwKICAgICAgICAgICAgIlx1MDIzRCI6ICJMIiwKICAgICAgICAgICAgIlx1MkM2MiI6ICJMIiwKICAgICAgICAgICAgIlx1MkM2MCI6ICJMIiwKICAgICAgICAgICAgIlx1QTc0OCI6ICJMIiwKICAgICAgICAgICAgIlx1QTc0NiI6ICJMIiwKICAgICAgICAgICAgIlx1QTc4MCI6ICJMIiwKICAgICAgICAgICAgIlx1MDFDNyI6ICJMSiIsCiAgICAgICAgICAgICJcdTAxQzgiOiAiTGoiLAogICAgICAgICAgICAiXHUwMDREIjogIk0iLAogICAgICAgICAgICAiXHUyNEMyIjogIk0iLAogICAgICAgICAgICAiXHVGRjJEIjogIk0iLAogICAgICAgICAgICAiXHUxRTNFIjogIk0iLAogICAgICAgICAgICAiXHUxRTQwIjogIk0iLAogICAgICAgICAgICAiXHUxRTQyIjogIk0iLAogICAgICAgICAgICAiXHUyQzZFIjogIk0iLAogICAgICAgICAgICAiXHUwMTlDIjogIk0iLAogICAgICAgICAgICAiXHUwMDRFIjogIk4iLAogICAgICAgICAgICAiXHUyNEMzIjogIk4iLAogICAgICAgICAgICAiXHVGRjJFIjogIk4iLAogICAgICAgICAgICAiXHUwMUY4IjogIk4iLAogICAgICAgICAgICAiXHUwMTQzIjogIk4iLAogICAgICAgICAgICAiXHUwMEQxIjogIk4iLAogICAgICAgICAgICAiXHUxRTQ0IjogIk4iLAogICAgICAgICAgICAiXHUwMTQ3IjogIk4iLAogICAgICAgICAgICAiXHUxRTQ2IjogIk4iLAogICAgICAgICAgICAiXHUwMTQ1IjogIk4iLAogICAgICAgICAgICAiXHUxRTRBIjogIk4iLAogICAgICAgICAgICAiXHUxRTQ4IjogIk4iLAogICAgICAgICAgICAiXHUwMjIwIjogIk4iLAogICAgICAgICAgICAiXHUwMTlEIjogIk4iLAogICAgICAgICAgICAiXHVBNzkwIjogIk4iLAogICAgICAgICAgICAiXHVBN0E0IjogIk4iLAogICAgICAgICAgICAiXHUwMUNBIjogIk5KIiwKICAgICAgICAgICAgIlx1MDFDQiI6ICJOaiIsCiAgICAgICAgICAgICJcdTAwNEYiOiAiTyIsCiAgICAgICAgICAgICJcdTI0QzQiOiAiTyIsCiAgICAgICAgICAgICJcdUZGMkYiOiAiTyIsCiAgICAgICAgICAgICJcdTAwRDIiOiAiTyIsCiAgICAgICAgICAgICJcdTAwRDMiOiAiTyIsCiAgICAgICAgICAgICJcdTAwRDQiOiAiTyIsCiAgICAgICAgICAgICJcdTFFRDIiOiAiTyIsCiAgICAgICAgICAgICJcdTFFRDAiOiAiTyIsCiAgICAgICAgICAgICJcdTFFRDYiOiAiTyIsCiAgICAgICAgICAgICJcdTFFRDQiOiAiTyIsCiAgICAgICAgICAgICJcdTAwRDUiOiAiTyIsCiAgICAgICAgICAgICJcdTFFNEMiOiAiTyIsCiAgICAgICAgICAgICJcdTAyMkMiOiAiTyIsCiAgICAgICAgICAgICJcdTFFNEUiOiAiTyIsCiAgICAgICAgICAgICJcdTAxNEMiOiAiTyIsCiAgICAgICAgICAgICJcdTFFNTAiOiAiTyIsCiAgICAgICAgICAgICJcdTFFNTIiOiAiTyIsCiAgICAgICAgICAgICJcdTAxNEUiOiAiTyIsCiAgICAgICAgICAgICJcdTAyMkUiOiAiTyIsCiAgICAgICAgICAgICJcdTAyMzAiOiAiTyIsCiAgICAgICAgICAgICJcdTAwRDYiOiAiTyIsCiAgICAgICAgICAgICJcdTAyMkEiOiAiTyIsCiAgICAgICAgICAgICJcdTFFQ0UiOiAiTyIsCiAgICAgICAgICAgICJcdTAxNTAiOiAiTyIsCiAgICAgICAgICAgICJcdTAxRDEiOiAiTyIsCiAgICAgICAgICAgICJcdTAyMEMiOiAiTyIsCiAgICAgICAgICAgICJcdTAyMEUiOiAiTyIsCiAgICAgICAgICAgICJcdTAxQTAiOiAiTyIsCiAgICAgICAgICAgICJcdTFFREMiOiAiTyIsCiAgICAgICAgICAgICJcdTFFREEiOiAiTyIsCiAgICAgICAgICAgICJcdTFFRTAiOiAiTyIsCiAgICAgICAgICAgICJcdTFFREUiOiAiTyIsCiAgICAgICAgICAgICJcdTFFRTIiOiAiTyIsCiAgICAgICAgICAgICJcdTFFQ0MiOiAiTyIsCiAgICAgICAgICAgICJcdTFFRDgiOiAiTyIsCiAgICAgICAgICAgICJcdTAxRUEiOiAiTyIsCiAgICAgICAgICAgICJcdTAxRUMiOiAiTyIsCiAgICAgICAgICAgICJcdTAwRDgiOiAiTyIsCiAgICAgICAgICAgICJcdTAxRkUiOiAiTyIsCiAgICAgICAgICAgICJcdTAxODYiOiAiTyIsCiAgICAgICAgICAgICJcdTAxOUYiOiAiTyIsCiAgICAgICAgICAgICJcdUE3NEEiOiAiTyIsCiAgICAgICAgICAgICJcdUE3NEMiOiAiTyIsCiAgICAgICAgICAgICJcdTAxQTIiOiAiT0kiLAogICAgICAgICAgICAiXHVBNzRFIjogIk9PIiwKICAgICAgICAgICAgIlx1MDIyMiI6ICJPVSIsCiAgICAgICAgICAgICJcdTAwNTAiOiAiUCIsCiAgICAgICAgICAgICJcdTI0QzUiOiAiUCIsCiAgICAgICAgICAgICJcdUZGMzAiOiAiUCIsCiAgICAgICAgICAgICJcdTFFNTQiOiAiUCIsCiAgICAgICAgICAgICJcdTFFNTYiOiAiUCIsCiAgICAgICAgICAgICJcdTAxQTQiOiAiUCIsCiAgICAgICAgICAgICJcdTJDNjMiOiAiUCIsCiAgICAgICAgICAgICJcdUE3NTAiOiAiUCIsCiAgICAgICAgICAgICJcdUE3NTIiOiAiUCIsCiAgICAgICAgICAgICJcdUE3NTQiOiAiUCIsCiAgICAgICAgICAgICJcdTAwNTEiOiAiUSIsCiAgICAgICAgICAgICJcdTI0QzYiOiAiUSIsCiAgICAgICAgICAgICJcdUZGMzEiOiAiUSIsCiAgICAgICAgICAgICJcdUE3NTYiOiAiUSIsCiAgICAgICAgICAgICJcdUE3NTgiOiAiUSIsCiAgICAgICAgICAgICJcdTAyNEEiOiAiUSIsCiAgICAgICAgICAgICJcdTAwNTIiOiAiUiIsCiAgICAgICAgICAgICJcdTI0QzciOiAiUiIsCiAgICAgICAgICAgICJcdUZGMzIiOiAiUiIsCiAgICAgICAgICAgICJcdTAxNTQiOiAiUiIsCiAgICAgICAgICAgICJcdTFFNTgiOiAiUiIsCiAgICAgICAgICAgICJcdTAxNTgiOiAiUiIsCiAgICAgICAgICAgICJcdTAyMTAiOiAiUiIsCiAgICAgICAgICAgICJcdTAyMTIiOiAiUiIsCiAgICAgICAgICAgICJcdTFFNUEiOiAiUiIsCiAgICAgICAgICAgICJcdTFFNUMiOiAiUiIsCiAgICAgICAgICAgICJcdTAxNTYiOiAiUiIsCiAgICAgICAgICAgICJcdTFFNUUiOiAiUiIsCiAgICAgICAgICAgICJcdTAyNEMiOiAiUiIsCiAgICAgICAgICAgICJcdTJDNjQiOiAiUiIsCiAgICAgICAgICAgICJcdUE3NUEiOiAiUiIsCiAgICAgICAgICAgICJcdUE3QTYiOiAiUiIsCiAgICAgICAgICAgICJcdUE3ODIiOiAiUiIsCiAgICAgICAgICAgICJcdTAwNTMiOiAiUyIsCiAgICAgICAgICAgICJcdTI0QzgiOiAiUyIsCiAgICAgICAgICAgICJcdUZGMzMiOiAiUyIsCiAgICAgICAgICAgICJcdTFFOUUiOiAiUyIsCiAgICAgICAgICAgICJcdTAxNUEiOiAiUyIsCiAgICAgICAgICAgICJcdTFFNjQiOiAiUyIsCiAgICAgICAgICAgICJcdTAxNUMiOiAiUyIsCiAgICAgICAgICAgICJcdTFFNjAiOiAiUyIsCiAgICAgICAgICAgICJcdTAxNjAiOiAiUyIsCiAgICAgICAgICAgICJcdTFFNjYiOiAiUyIsCiAgICAgICAgICAgICJcdTFFNjIiOiAiUyIsCiAgICAgICAgICAgICJcdTFFNjgiOiAiUyIsCiAgICAgICAgICAgICJcdTAyMTgiOiAiUyIsCiAgICAgICAgICAgICJcdTAxNUUiOiAiUyIsCiAgICAgICAgICAgICJcdTJDN0UiOiAiUyIsCiAgICAgICAgICAgICJcdUE3QTgiOiAiUyIsCiAgICAgICAgICAgICJcdUE3ODQiOiAiUyIsCiAgICAgICAgICAgICJcdTAwNTQiOiAiVCIsCiAgICAgICAgICAgICJcdTI0QzkiOiAiVCIsCiAgICAgICAgICAgICJcdUZGMzQiOiAiVCIsCiAgICAgICAgICAgICJcdTFFNkEiOiAiVCIsCiAgICAgICAgICAgICJcdTAxNjQiOiAiVCIsCiAgICAgICAgICAgICJcdTFFNkMiOiAiVCIsCiAgICAgICAgICAgICJcdTAyMUEiOiAiVCIsCiAgICAgICAgICAgICJcdTAxNjIiOiAiVCIsCiAgICAgICAgICAgICJcdTFFNzAiOiAiVCIsCiAgICAgICAgICAgICJcdTFFNkUiOiAiVCIsCiAgICAgICAgICAgICJcdTAxNjYiOiAiVCIsCiAgICAgICAgICAgICJcdTAxQUMiOiAiVCIsCiAgICAgICAgICAgICJcdTAxQUUiOiAiVCIsCiAgICAgICAgICAgICJcdTAyM0UiOiAiVCIsCiAgICAgICAgICAgICJcdUE3ODYiOiAiVCIsCiAgICAgICAgICAgICJcdUE3MjgiOiAiVFoiLAogICAgICAgICAgICAiXHUwMDU1IjogIlUiLAogICAgICAgICAgICAiXHUyNENBIjogIlUiLAogICAgICAgICAgICAiXHVGRjM1IjogIlUiLAogICAgICAgICAgICAiXHUwMEQ5IjogIlUiLAogICAgICAgICAgICAiXHUwMERBIjogIlUiLAogICAgICAgICAgICAiXHUwMERCIjogIlUiLAogICAgICAgICAgICAiXHUwMTY4IjogIlUiLAogICAgICAgICAgICAiXHUxRTc4IjogIlUiLAogICAgICAgICAgICAiXHUwMTZBIjogIlUiLAogICAgICAgICAgICAiXHUxRTdBIjogIlUiLAogICAgICAgICAgICAiXHUwMTZDIjogIlUiLAogICAgICAgICAgICAiXHUwMERDIjogIlUiLAogICAgICAgICAgICAiXHUwMURCIjogIlUiLAogICAgICAgICAgICAiXHUwMUQ3IjogIlUiLAogICAgICAgICAgICAiXHUwMUQ1IjogIlUiLAogICAgICAgICAgICAiXHUwMUQ5IjogIlUiLAogICAgICAgICAgICAiXHUxRUU2IjogIlUiLAogICAgICAgICAgICAiXHUwMTZFIjogIlUiLAogICAgICAgICAgICAiXHUwMTcwIjogIlUiLAogICAgICAgICAgICAiXHUwMUQzIjogIlUiLAogICAgICAgICAgICAiXHUwMjE0IjogIlUiLAogICAgICAgICAgICAiXHUwMjE2IjogIlUiLAogICAgICAgICAgICAiXHUwMUFGIjogIlUiLAogICAgICAgICAgICAiXHUxRUVBIjogIlUiLAogICAgICAgICAgICAiXHUxRUU4IjogIlUiLAogICAgICAgICAgICAiXHUxRUVFIjogIlUiLAogICAgICAgICAgICAiXHUxRUVDIjogIlUiLAogICAgICAgICAgICAiXHUxRUYwIjogIlUiLAogICAgICAgICAgICAiXHUxRUU0IjogIlUiLAogICAgICAgICAgICAiXHUxRTcyIjogIlUiLAogICAgICAgICAgICAiXHUwMTcyIjogIlUiLAogICAgICAgICAgICAiXHUxRTc2IjogIlUiLAogICAgICAgICAgICAiXHUxRTc0IjogIlUiLAogICAgICAgICAgICAiXHUwMjQ0IjogIlUiLAogICAgICAgICAgICAiXHUwMDU2IjogIlYiLAogICAgICAgICAgICAiXHUyNENCIjogIlYiLAogICAgICAgICAgICAiXHVGRjM2IjogIlYiLAogICAgICAgICAgICAiXHUxRTdDIjogIlYiLAogICAgICAgICAgICAiXHUxRTdFIjogIlYiLAogICAgICAgICAgICAiXHUwMUIyIjogIlYiLAogICAgICAgICAgICAiXHVBNzVFIjogIlYiLAogICAgICAgICAgICAiXHUwMjQ1IjogIlYiLAogICAgICAgICAgICAiXHVBNzYwIjogIlZZIiwKICAgICAgICAgICAgIlx1MDA1NyI6ICJXIiwKICAgICAgICAgICAgIlx1MjRDQyI6ICJXIiwKICAgICAgICAgICAgIlx1RkYzNyI6ICJXIiwKICAgICAgICAgICAgIlx1MUU4MCI6ICJXIiwKICAgICAgICAgICAgIlx1MUU4MiI6ICJXIiwKICAgICAgICAgICAgIlx1MDE3NCI6ICJXIiwKICAgICAgICAgICAgIlx1MUU4NiI6ICJXIiwKICAgICAgICAgICAgIlx1MUU4NCI6ICJXIiwKICAgICAgICAgICAgIlx1MUU4OCI6ICJXIiwKICAgICAgICAgICAgIlx1MkM3MiI6ICJXIiwKICAgICAgICAgICAgIlx1MDA1OCI6ICJYIiwKICAgICAgICAgICAgIlx1MjRDRCI6ICJYIiwKICAgICAgICAgICAgIlx1RkYzOCI6ICJYIiwKICAgICAgICAgICAgIlx1MUU4QSI6ICJYIiwKICAgICAgICAgICAgIlx1MUU4QyI6ICJYIiwKICAgICAgICAgICAgIlx1MDA1OSI6ICJZIiwKICAgICAgICAgICAgIlx1MjRDRSI6ICJZIiwKICAgICAgICAgICAgIlx1RkYzOSI6ICJZIiwKICAgICAgICAgICAgIlx1MUVGMiI6ICJZIiwKICAgICAgICAgICAgIlx1MDBERCI6ICJZIiwKICAgICAgICAgICAgIlx1MDE3NiI6ICJZIiwKICAgICAgICAgICAgIlx1MUVGOCI6ICJZIiwKICAgICAgICAgICAgIlx1MDIzMiI6ICJZIiwKICAgICAgICAgICAgIlx1MUU4RSI6ICJZIiwKICAgICAgICAgICAgIlx1MDE3OCI6ICJZIiwKICAgICAgICAgICAgIlx1MUVGNiI6ICJZIiwKICAgICAgICAgICAgIlx1MUVGNCI6ICJZIiwKICAgICAgICAgICAgIlx1MDFCMyI6ICJZIiwKICAgICAgICAgICAgIlx1MDI0RSI6ICJZIiwKICAgICAgICAgICAgIlx1MUVGRSI6ICJZIiwKICAgICAgICAgICAgIlx1MDA1QSI6ICJaIiwKICAgICAgICAgICAgIlx1MjRDRiI6ICJaIiwKICAgICAgICAgICAgIlx1RkYzQSI6ICJaIiwKICAgICAgICAgICAgIlx1MDE3OSI6ICJaIiwKICAgICAgICAgICAgIlx1MUU5MCI6ICJaIiwKICAgICAgICAgICAgIlx1MDE3QiI6ICJaIiwKICAgICAgICAgICAgIlx1MDE3RCI6ICJaIiwKICAgICAgICAgICAgIlx1MUU5MiI6ICJaIiwKICAgICAgICAgICAgIlx1MUU5NCI6ICJaIiwKICAgICAgICAgICAgIlx1MDFCNSI6ICJaIiwKICAgICAgICAgICAgIlx1MDIyNCI6ICJaIiwKICAgICAgICAgICAgIlx1MkM3RiI6ICJaIiwKICAgICAgICAgICAgIlx1MkM2QiI6ICJaIiwKICAgICAgICAgICAgIlx1QTc2MiI6ICJaIiwKICAgICAgICAgICAgIlx1MDA2MSI6ICJhIiwKICAgICAgICAgICAgIlx1MjREMCI6ICJhIiwKICAgICAgICAgICAgIlx1RkY0MSI6ICJhIiwKICAgICAgICAgICAgIlx1MUU5QSI6ICJhIiwKICAgICAgICAgICAgIlx1MDBFMCI6ICJhIiwKICAgICAgICAgICAgIlx1MDBFMSI6ICJhIiwKICAgICAgICAgICAgIlx1MDBFMiI6ICJhIiwKICAgICAgICAgICAgIlx1MUVBNyI6ICJhIiwKICAgICAgICAgICAgIlx1MUVBNSI6ICJhIiwKICAgICAgICAgICAgIlx1MUVBQiI6ICJhIiwKICAgICAgICAgICAgIlx1MUVBOSI6ICJhIiwKICAgICAgICAgICAgIlx1MDBFMyI6ICJhIiwKICAgICAgICAgICAgIlx1MDEwMSI6ICJhIiwKICAgICAgICAgICAgIlx1MDEwMyI6ICJhIiwKICAgICAgICAgICAgIlx1MUVCMSI6ICJhIiwKICAgICAgICAgICAgIlx1MUVBRiI6ICJhIiwKICAgICAgICAgICAgIlx1MUVCNSI6ICJhIiwKICAgICAgICAgICAgIlx1MUVCMyI6ICJhIiwKICAgICAgICAgICAgIlx1MDIyNyI6ICJhIiwKICAgICAgICAgICAgIlx1MDFFMSI6ICJhIiwKICAgICAgICAgICAgIlx1MDBFNCI6ICJhIiwKICAgICAgICAgICAgIlx1MDFERiI6ICJhIiwKICAgICAgICAgICAgIlx1MUVBMyI6ICJhIiwKICAgICAgICAgICAgIlx1MDBFNSI6ICJhIiwKICAgICAgICAgICAgIlx1MDFGQiI6ICJhIiwKICAgICAgICAgICAgIlx1MDFDRSI6ICJhIiwKICAgICAgICAgICAgIlx1MDIwMSI6ICJhIiwKICAgICAgICAgICAgIlx1MDIwMyI6ICJhIiwKICAgICAgICAgICAgIlx1MUVBMSI6ICJhIiwKICAgICAgICAgICAgIlx1MUVBRCI6ICJhIiwKICAgICAgICAgICAgIlx1MUVCNyI6ICJhIiwKICAgICAgICAgICAgIlx1MUUwMSI6ICJhIiwKICAgICAgICAgICAgIlx1MDEwNSI6ICJhIiwKICAgICAgICAgICAgIlx1MkM2NSI6ICJhIiwKICAgICAgICAgICAgIlx1MDI1MCI6ICJhIiwKICAgICAgICAgICAgIlx1QTczMyI6ICJhYSIsCiAgICAgICAgICAgICJcdTAwRTYiOiAiYWUiLAogICAgICAgICAgICAiXHUwMUZEIjogImFlIiwKICAgICAgICAgICAgIlx1MDFFMyI6ICJhZSIsCiAgICAgICAgICAgICJcdUE3MzUiOiAiYW8iLAogICAgICAgICAgICAiXHVBNzM3IjogImF1IiwKICAgICAgICAgICAgIlx1QTczOSI6ICJhdiIsCiAgICAgICAgICAgICJcdUE3M0IiOiAiYXYiLAogICAgICAgICAgICAiXHVBNzNEIjogImF5IiwKICAgICAgICAgICAgIlx1MDA2MiI6ICJiIiwKICAgICAgICAgICAgIlx1MjREMSI6ICJiIiwKICAgICAgICAgICAgIlx1RkY0MiI6ICJiIiwKICAgICAgICAgICAgIlx1MUUwMyI6ICJiIiwKICAgICAgICAgICAgIlx1MUUwNSI6ICJiIiwKICAgICAgICAgICAgIlx1MUUwNyI6ICJiIiwKICAgICAgICAgICAgIlx1MDE4MCI6ICJiIiwKICAgICAgICAgICAgIlx1MDE4MyI6ICJiIiwKICAgICAgICAgICAgIlx1MDI1MyI6ICJiIiwKICAgICAgICAgICAgIlx1MDA2MyI6ICJjIiwKICAgICAgICAgICAgIlx1MjREMiI6ICJjIiwKICAgICAgICAgICAgIlx1RkY0MyI6ICJjIiwKICAgICAgICAgICAgIlx1MDEwNyI6ICJjIiwKICAgICAgICAgICAgIlx1MDEwOSI6ICJjIiwKICAgICAgICAgICAgIlx1MDEwQiI6ICJjIiwKICAgICAgICAgICAgIlx1MDEwRCI6ICJjIiwKICAgICAgICAgICAgIlx1MDBFNyI6ICJjIiwKICAgICAgICAgICAgIlx1MUUwOSI6ICJjIiwKICAgICAgICAgICAgIlx1MDE4OCI6ICJjIiwKICAgICAgICAgICAgIlx1MDIzQyI6ICJjIiwKICAgICAgICAgICAgIlx1QTczRiI6ICJjIiwKICAgICAgICAgICAgIlx1MjE4NCI6ICJjIiwKICAgICAgICAgICAgIlx1MDA2NCI6ICJkIiwKICAgICAgICAgICAgIlx1MjREMyI6ICJkIiwKICAgICAgICAgICAgIlx1RkY0NCI6ICJkIiwKICAgICAgICAgICAgIlx1MUUwQiI6ICJkIiwKICAgICAgICAgICAgIlx1MDEwRiI6ICJkIiwKICAgICAgICAgICAgIlx1MUUwRCI6ICJkIiwKICAgICAgICAgICAgIlx1MUUxMSI6ICJkIiwKICAgICAgICAgICAgIlx1MUUxMyI6ICJkIiwKICAgICAgICAgICAgIlx1MUUwRiI6ICJkIiwKICAgICAgICAgICAgIlx1MDExMSI6ICJkIiwKICAgICAgICAgICAgIlx1MDE4QyI6ICJkIiwKICAgICAgICAgICAgIlx1MDI1NiI6ICJkIiwKICAgICAgICAgICAgIlx1MDI1NyI6ICJkIiwKICAgICAgICAgICAgIlx1QTc3QSI6ICJkIiwKICAgICAgICAgICAgIlx1MDFGMyI6ICJkeiIsCiAgICAgICAgICAgICJcdTAxQzYiOiAiZHoiLAogICAgICAgICAgICAiXHUwMDY1IjogImUiLAogICAgICAgICAgICAiXHUyNEQ0IjogImUiLAogICAgICAgICAgICAiXHVGRjQ1IjogImUiLAogICAgICAgICAgICAiXHUwMEU4IjogImUiLAogICAgICAgICAgICAiXHUwMEU5IjogImUiLAogICAgICAgICAgICAiXHUwMEVBIjogImUiLAogICAgICAgICAgICAiXHUxRUMxIjogImUiLAogICAgICAgICAgICAiXHUxRUJGIjogImUiLAogICAgICAgICAgICAiXHUxRUM1IjogImUiLAogICAgICAgICAgICAiXHUxRUMzIjogImUiLAogICAgICAgICAgICAiXHUxRUJEIjogImUiLAogICAgICAgICAgICAiXHUwMTEzIjogImUiLAogICAgICAgICAgICAiXHUxRTE1IjogImUiLAogICAgICAgICAgICAiXHUxRTE3IjogImUiLAogICAgICAgICAgICAiXHUwMTE1IjogImUiLAogICAgICAgICAgICAiXHUwMTE3IjogImUiLAogICAgICAgICAgICAiXHUwMEVCIjogImUiLAogICAgICAgICAgICAiXHUxRUJCIjogImUiLAogICAgICAgICAgICAiXHUwMTFCIjogImUiLAogICAgICAgICAgICAiXHUwMjA1IjogImUiLAogICAgICAgICAgICAiXHUwMjA3IjogImUiLAogICAgICAgICAgICAiXHUxRUI5IjogImUiLAogICAgICAgICAgICAiXHUxRUM3IjogImUiLAogICAgICAgICAgICAiXHUwMjI5IjogImUiLAogICAgICAgICAgICAiXHUxRTFEIjogImUiLAogICAgICAgICAgICAiXHUwMTE5IjogImUiLAogICAgICAgICAgICAiXHUxRTE5IjogImUiLAogICAgICAgICAgICAiXHUxRTFCIjogImUiLAogICAgICAgICAgICAiXHUwMjQ3IjogImUiLAogICAgICAgICAgICAiXHUwMjVCIjogImUiLAogICAgICAgICAgICAiXHUwMUREIjogImUiLAogICAgICAgICAgICAiXHUwMDY2IjogImYiLAogICAgICAgICAgICAiXHUyNEQ1IjogImYiLAogICAgICAgICAgICAiXHVGRjQ2IjogImYiLAogICAgICAgICAgICAiXHUxRTFGIjogImYiLAogICAgICAgICAgICAiXHUwMTkyIjogImYiLAogICAgICAgICAgICAiXHVBNzdDIjogImYiLAogICAgICAgICAgICAiXHUwMDY3IjogImciLAogICAgICAgICAgICAiXHUyNEQ2IjogImciLAogICAgICAgICAgICAiXHVGRjQ3IjogImciLAogICAgICAgICAgICAiXHUwMUY1IjogImciLAogICAgICAgICAgICAiXHUwMTFEIjogImciLAogICAgICAgICAgICAiXHUxRTIxIjogImciLAogICAgICAgICAgICAiXHUwMTFGIjogImciLAogICAgICAgICAgICAiXHUwMTIxIjogImciLAogICAgICAgICAgICAiXHUwMUU3IjogImciLAogICAgICAgICAgICAiXHUwMTIzIjogImciLAogICAgICAgICAgICAiXHUwMUU1IjogImciLAogICAgICAgICAgICAiXHUwMjYwIjogImciLAogICAgICAgICAgICAiXHVBN0ExIjogImciLAogICAgICAgICAgICAiXHUxRDc5IjogImciLAogICAgICAgICAgICAiXHVBNzdGIjogImciLAogICAgICAgICAgICAiXHUwMDY4IjogImgiLAogICAgICAgICAgICAiXHUyNEQ3IjogImgiLAogICAgICAgICAgICAiXHVGRjQ4IjogImgiLAogICAgICAgICAgICAiXHUwMTI1IjogImgiLAogICAgICAgICAgICAiXHUxRTIzIjogImgiLAogICAgICAgICAgICAiXHUxRTI3IjogImgiLAogICAgICAgICAgICAiXHUwMjFGIjogImgiLAogICAgICAgICAgICAiXHUxRTI1IjogImgiLAogICAgICAgICAgICAiXHUxRTI5IjogImgiLAogICAgICAgICAgICAiXHUxRTJCIjogImgiLAogICAgICAgICAgICAiXHUxRTk2IjogImgiLAogICAgICAgICAgICAiXHUwMTI3IjogImgiLAogICAgICAgICAgICAiXHUyQzY4IjogImgiLAogICAgICAgICAgICAiXHUyQzc2IjogImgiLAogICAgICAgICAgICAiXHUwMjY1IjogImgiLAogICAgICAgICAgICAiXHUwMTk1IjogImh2IiwKICAgICAgICAgICAgIlx1MDA2OSI6ICJpIiwKICAgICAgICAgICAgIlx1MjREOCI6ICJpIiwKICAgICAgICAgICAgIlx1RkY0OSI6ICJpIiwKICAgICAgICAgICAgIlx1MDBFQyI6ICJpIiwKICAgICAgICAgICAgIlx1MDBFRCI6ICJpIiwKICAgICAgICAgICAgIlx1MDBFRSI6ICJpIiwKICAgICAgICAgICAgIlx1MDEyOSI6ICJpIiwKICAgICAgICAgICAgIlx1MDEyQiI6ICJpIiwKICAgICAgICAgICAgIlx1MDEyRCI6ICJpIiwKICAgICAgICAgICAgIlx1MDBFRiI6ICJpIiwKICAgICAgICAgICAgIlx1MUUyRiI6ICJpIiwKICAgICAgICAgICAgIlx1MUVDOSI6ICJpIiwKICAgICAgICAgICAgIlx1MDFEMCI6ICJpIiwKICAgICAgICAgICAgIlx1MDIwOSI6ICJpIiwKICAgICAgICAgICAgIlx1MDIwQiI6ICJpIiwKICAgICAgICAgICAgIlx1MUVDQiI6ICJpIiwKICAgICAgICAgICAgIlx1MDEyRiI6ICJpIiwKICAgICAgICAgICAgIlx1MUUyRCI6ICJpIiwKICAgICAgICAgICAgIlx1MDI2OCI6ICJpIiwKICAgICAgICAgICAgIlx1MDEzMSI6ICJpIiwKICAgICAgICAgICAgIlx1MDA2QSI6ICJqIiwKICAgICAgICAgICAgIlx1MjREOSI6ICJqIiwKICAgICAgICAgICAgIlx1RkY0QSI6ICJqIiwKICAgICAgICAgICAgIlx1MDEzNSI6ICJqIiwKICAgICAgICAgICAgIlx1MDFGMCI6ICJqIiwKICAgICAgICAgICAgIlx1MDI0OSI6ICJqIiwKICAgICAgICAgICAgIlx1MDA2QiI6ICJrIiwKICAgICAgICAgICAgIlx1MjREQSI6ICJrIiwKICAgICAgICAgICAgIlx1RkY0QiI6ICJrIiwKICAgICAgICAgICAgIlx1MUUzMSI6ICJrIiwKICAgICAgICAgICAgIlx1MDFFOSI6ICJrIiwKICAgICAgICAgICAgIlx1MUUzMyI6ICJrIiwKICAgICAgICAgICAgIlx1MDEzNyI6ICJrIiwKICAgICAgICAgICAgIlx1MUUzNSI6ICJrIiwKICAgICAgICAgICAgIlx1MDE5OSI6ICJrIiwKICAgICAgICAgICAgIlx1MkM2QSI6ICJrIiwKICAgICAgICAgICAgIlx1QTc0MSI6ICJrIiwKICAgICAgICAgICAgIlx1QTc0MyI6ICJrIiwKICAgICAgICAgICAgIlx1QTc0NSI6ICJrIiwKICAgICAgICAgICAgIlx1QTdBMyI6ICJrIiwKICAgICAgICAgICAgIlx1MDA2QyI6ICJsIiwKICAgICAgICAgICAgIlx1MjREQiI6ICJsIiwKICAgICAgICAgICAgIlx1RkY0QyI6ICJsIiwKICAgICAgICAgICAgIlx1MDE0MCI6ICJsIiwKICAgICAgICAgICAgIlx1MDEzQSI6ICJsIiwKICAgICAgICAgICAgIlx1MDEzRSI6ICJsIiwKICAgICAgICAgICAgIlx1MUUzNyI6ICJsIiwKICAgICAgICAgICAgIlx1MUUzOSI6ICJsIiwKICAgICAgICAgICAgIlx1MDEzQyI6ICJsIiwKICAgICAgICAgICAgIlx1MUUzRCI6ICJsIiwKICAgICAgICAgICAgIlx1MUUzQiI6ICJsIiwKICAgICAgICAgICAgIlx1MDE3RiI6ICJsIiwKICAgICAgICAgICAgIlx1MDE0MiI6ICJsIiwKICAgICAgICAgICAgIlx1MDE5QSI6ICJsIiwKICAgICAgICAgICAgIlx1MDI2QiI6ICJsIiwKICAgICAgICAgICAgIlx1MkM2MSI6ICJsIiwKICAgICAgICAgICAgIlx1QTc0OSI6ICJsIiwKICAgICAgICAgICAgIlx1QTc4MSI6ICJsIiwKICAgICAgICAgICAgIlx1QTc0NyI6ICJsIiwKICAgICAgICAgICAgIlx1MDFDOSI6ICJsaiIsCiAgICAgICAgICAgICJcdTAwNkQiOiAibSIsCiAgICAgICAgICAgICJcdTI0REMiOiAibSIsCiAgICAgICAgICAgICJcdUZGNEQiOiAibSIsCiAgICAgICAgICAgICJcdTFFM0YiOiAibSIsCiAgICAgICAgICAgICJcdTFFNDEiOiAibSIsCiAgICAgICAgICAgICJcdTFFNDMiOiAibSIsCiAgICAgICAgICAgICJcdTAyNzEiOiAibSIsCiAgICAgICAgICAgICJcdTAyNkYiOiAibSIsCiAgICAgICAgICAgICJcdTAwNkUiOiAibiIsCiAgICAgICAgICAgICJcdTI0REQiOiAibiIsCiAgICAgICAgICAgICJcdUZGNEUiOiAibiIsCiAgICAgICAgICAgICJcdTAxRjkiOiAibiIsCiAgICAgICAgICAgICJcdTAxNDQiOiAibiIsCiAgICAgICAgICAgICJcdTAwRjEiOiAibiIsCiAgICAgICAgICAgICJcdTFFNDUiOiAibiIsCiAgICAgICAgICAgICJcdTAxNDgiOiAibiIsCiAgICAgICAgICAgICJcdTFFNDciOiAibiIsCiAgICAgICAgICAgICJcdTAxNDYiOiAibiIsCiAgICAgICAgICAgICJcdTFFNEIiOiAibiIsCiAgICAgICAgICAgICJcdTFFNDkiOiAibiIsCiAgICAgICAgICAgICJcdTAxOUUiOiAibiIsCiAgICAgICAgICAgICJcdTAyNzIiOiAibiIsCiAgICAgICAgICAgICJcdTAxNDkiOiAibiIsCiAgICAgICAgICAgICJcdUE3OTEiOiAibiIsCiAgICAgICAgICAgICJcdUE3QTUiOiAibiIsCiAgICAgICAgICAgICJcdTAxQ0MiOiAibmoiLAogICAgICAgICAgICAiXHUwMDZGIjogIm8iLAogICAgICAgICAgICAiXHUyNERFIjogIm8iLAogICAgICAgICAgICAiXHVGRjRGIjogIm8iLAogICAgICAgICAgICAiXHUwMEYyIjogIm8iLAogICAgICAgICAgICAiXHUwMEYzIjogIm8iLAogICAgICAgICAgICAiXHUwMEY0IjogIm8iLAogICAgICAgICAgICAiXHUxRUQzIjogIm8iLAogICAgICAgICAgICAiXHUxRUQxIjogIm8iLAogICAgICAgICAgICAiXHUxRUQ3IjogIm8iLAogICAgICAgICAgICAiXHUxRUQ1IjogIm8iLAogICAgICAgICAgICAiXHUwMEY1IjogIm8iLAogICAgICAgICAgICAiXHUxRTREIjogIm8iLAogICAgICAgICAgICAiXHUwMjJEIjogIm8iLAogICAgICAgICAgICAiXHUxRTRGIjogIm8iLAogICAgICAgICAgICAiXHUwMTREIjogIm8iLAogICAgICAgICAgICAiXHUxRTUxIjogIm8iLAogICAgICAgICAgICAiXHUxRTUzIjogIm8iLAogICAgICAgICAgICAiXHUwMTRGIjogIm8iLAogICAgICAgICAgICAiXHUwMjJGIjogIm8iLAogICAgICAgICAgICAiXHUwMjMxIjogIm8iLAogICAgICAgICAgICAiXHUwMEY2IjogIm8iLAogICAgICAgICAgICAiXHUwMjJCIjogIm8iLAogICAgICAgICAgICAiXHUxRUNGIjogIm8iLAogICAgICAgICAgICAiXHUwMTUxIjogIm8iLAogICAgICAgICAgICAiXHUwMUQyIjogIm8iLAogICAgICAgICAgICAiXHUwMjBEIjogIm8iLAogICAgICAgICAgICAiXHUwMjBGIjogIm8iLAogICAgICAgICAgICAiXHUwMUExIjogIm8iLAogICAgICAgICAgICAiXHUxRUREIjogIm8iLAogICAgICAgICAgICAiXHUxRURCIjogIm8iLAogICAgICAgICAgICAiXHUxRUUxIjogIm8iLAogICAgICAgICAgICAiXHUxRURGIjogIm8iLAogICAgICAgICAgICAiXHUxRUUzIjogIm8iLAogICAgICAgICAgICAiXHUxRUNEIjogIm8iLAogICAgICAgICAgICAiXHUxRUQ5IjogIm8iLAogICAgICAgICAgICAiXHUwMUVCIjogIm8iLAogICAgICAgICAgICAiXHUwMUVEIjogIm8iLAogICAgICAgICAgICAiXHUwMEY4IjogIm8iLAogICAgICAgICAgICAiXHUwMUZGIjogIm8iLAogICAgICAgICAgICAiXHUwMjU0IjogIm8iLAogICAgICAgICAgICAiXHVBNzRCIjogIm8iLAogICAgICAgICAgICAiXHVBNzREIjogIm8iLAogICAgICAgICAgICAiXHUwMjc1IjogIm8iLAogICAgICAgICAgICAiXHUwMUEzIjogIm9pIiwKICAgICAgICAgICAgIlx1MDIyMyI6ICJvdSIsCiAgICAgICAgICAgICJcdUE3NEYiOiAib28iLAogICAgICAgICAgICAiXHUwMDcwIjogInAiLAogICAgICAgICAgICAiXHUyNERGIjogInAiLAogICAgICAgICAgICAiXHVGRjUwIjogInAiLAogICAgICAgICAgICAiXHUxRTU1IjogInAiLAogICAgICAgICAgICAiXHUxRTU3IjogInAiLAogICAgICAgICAgICAiXHUwMUE1IjogInAiLAogICAgICAgICAgICAiXHUxRDdEIjogInAiLAogICAgICAgICAgICAiXHVBNzUxIjogInAiLAogICAgICAgICAgICAiXHVBNzUzIjogInAiLAogICAgICAgICAgICAiXHVBNzU1IjogInAiLAogICAgICAgICAgICAiXHUwMDcxIjogInEiLAogICAgICAgICAgICAiXHUyNEUwIjogInEiLAogICAgICAgICAgICAiXHVGRjUxIjogInEiLAogICAgICAgICAgICAiXHUwMjRCIjogInEiLAogICAgICAgICAgICAiXHVBNzU3IjogInEiLAogICAgICAgICAgICAiXHVBNzU5IjogInEiLAogICAgICAgICAgICAiXHUwMDcyIjogInIiLAogICAgICAgICAgICAiXHUyNEUxIjogInIiLAogICAgICAgICAgICAiXHVGRjUyIjogInIiLAogICAgICAgICAgICAiXHUwMTU1IjogInIiLAogICAgICAgICAgICAiXHUxRTU5IjogInIiLAogICAgICAgICAgICAiXHUwMTU5IjogInIiLAogICAgICAgICAgICAiXHUwMjExIjogInIiLAogICAgICAgICAgICAiXHUwMjEzIjogInIiLAogICAgICAgICAgICAiXHUxRTVCIjogInIiLAogICAgICAgICAgICAiXHUxRTVEIjogInIiLAogICAgICAgICAgICAiXHUwMTU3IjogInIiLAogICAgICAgICAgICAiXHUxRTVGIjogInIiLAogICAgICAgICAgICAiXHUwMjREIjogInIiLAogICAgICAgICAgICAiXHUwMjdEIjogInIiLAogICAgICAgICAgICAiXHVBNzVCIjogInIiLAogICAgICAgICAgICAiXHVBN0E3IjogInIiLAogICAgICAgICAgICAiXHVBNzgzIjogInIiLAogICAgICAgICAgICAiXHUwMDczIjogInMiLAogICAgICAgICAgICAiXHUyNEUyIjogInMiLAogICAgICAgICAgICAiXHVGRjUzIjogInMiLAogICAgICAgICAgICAiXHUwMERGIjogInMiLAogICAgICAgICAgICAiXHUwMTVCIjogInMiLAogICAgICAgICAgICAiXHUxRTY1IjogInMiLAogICAgICAgICAgICAiXHUwMTVEIjogInMiLAogICAgICAgICAgICAiXHUxRTYxIjogInMiLAogICAgICAgICAgICAiXHUwMTYxIjogInMiLAogICAgICAgICAgICAiXHUxRTY3IjogInMiLAogICAgICAgICAgICAiXHUxRTYzIjogInMiLAogICAgICAgICAgICAiXHUxRTY5IjogInMiLAogICAgICAgICAgICAiXHUwMjE5IjogInMiLAogICAgICAgICAgICAiXHUwMTVGIjogInMiLAogICAgICAgICAgICAiXHUwMjNGIjogInMiLAogICAgICAgICAgICAiXHVBN0E5IjogInMiLAogICAgICAgICAgICAiXHVBNzg1IjogInMiLAogICAgICAgICAgICAiXHUxRTlCIjogInMiLAogICAgICAgICAgICAiXHUwMDc0IjogInQiLAogICAgICAgICAgICAiXHUyNEUzIjogInQiLAogICAgICAgICAgICAiXHVGRjU0IjogInQiLAogICAgICAgICAgICAiXHUxRTZCIjogInQiLAogICAgICAgICAgICAiXHUxRTk3IjogInQiLAogICAgICAgICAgICAiXHUwMTY1IjogInQiLAogICAgICAgICAgICAiXHUxRTZEIjogInQiLAogICAgICAgICAgICAiXHUwMjFCIjogInQiLAogICAgICAgICAgICAiXHUwMTYzIjogInQiLAogICAgICAgICAgICAiXHUxRTcxIjogInQiLAogICAgICAgICAgICAiXHUxRTZGIjogInQiLAogICAgICAgICAgICAiXHUwMTY3IjogInQiLAogICAgICAgICAgICAiXHUwMUFEIjogInQiLAogICAgICAgICAgICAiXHUwMjg4IjogInQiLAogICAgICAgICAgICAiXHUyQzY2IjogInQiLAogICAgICAgICAgICAiXHVBNzg3IjogInQiLAogICAgICAgICAgICAiXHVBNzI5IjogInR6IiwKICAgICAgICAgICAgIlx1MDA3NSI6ICJ1IiwKICAgICAgICAgICAgIlx1MjRFNCI6ICJ1IiwKICAgICAgICAgICAgIlx1RkY1NSI6ICJ1IiwKICAgICAgICAgICAgIlx1MDBGOSI6ICJ1IiwKICAgICAgICAgICAgIlx1MDBGQSI6ICJ1IiwKICAgICAgICAgICAgIlx1MDBGQiI6ICJ1IiwKICAgICAgICAgICAgIlx1MDE2OSI6ICJ1IiwKICAgICAgICAgICAgIlx1MUU3OSI6ICJ1IiwKICAgICAgICAgICAgIlx1MDE2QiI6ICJ1IiwKICAgICAgICAgICAgIlx1MUU3QiI6ICJ1IiwKICAgICAgICAgICAgIlx1MDE2RCI6ICJ1IiwKICAgICAgICAgICAgIlx1MDBGQyI6ICJ1IiwKICAgICAgICAgICAgIlx1MDFEQyI6ICJ1IiwKICAgICAgICAgICAgIlx1MDFEOCI6ICJ1IiwKICAgICAgICAgICAgIlx1MDFENiI6ICJ1IiwKICAgICAgICAgICAgIlx1MDFEQSI6ICJ1IiwKICAgICAgICAgICAgIlx1MUVFNyI6ICJ1IiwKICAgICAgICAgICAgIlx1MDE2RiI6ICJ1IiwKICAgICAgICAgICAgIlx1MDE3MSI6ICJ1IiwKICAgICAgICAgICAgIlx1MDFENCI6ICJ1IiwKICAgICAgICAgICAgIlx1MDIxNSI6ICJ1IiwKICAgICAgICAgICAgIlx1MDIxNyI6ICJ1IiwKICAgICAgICAgICAgIlx1MDFCMCI6ICJ1IiwKICAgICAgICAgICAgIlx1MUVFQiI6ICJ1IiwKICAgICAgICAgICAgIlx1MUVFOSI6ICJ1IiwKICAgICAgICAgICAgIlx1MUVFRiI6ICJ1IiwKICAgICAgICAgICAgIlx1MUVFRCI6ICJ1IiwKICAgICAgICAgICAgIlx1MUVGMSI6ICJ1IiwKICAgICAgICAgICAgIlx1MUVFNSI6ICJ1IiwKICAgICAgICAgICAgIlx1MUU3MyI6ICJ1IiwKICAgICAgICAgICAgIlx1MDE3MyI6ICJ1IiwKICAgICAgICAgICAgIlx1MUU3NyI6ICJ1IiwKICAgICAgICAgICAgIlx1MUU3NSI6ICJ1IiwKICAgICAgICAgICAgIlx1MDI4OSI6ICJ1IiwKICAgICAgICAgICAgIlx1MDA3NiI6ICJ2IiwKICAgICAgICAgICAgIlx1MjRFNSI6ICJ2IiwKICAgICAgICAgICAgIlx1RkY1NiI6ICJ2IiwKICAgICAgICAgICAgIlx1MUU3RCI6ICJ2IiwKICAgICAgICAgICAgIlx1MUU3RiI6ICJ2IiwKICAgICAgICAgICAgIlx1MDI4QiI6ICJ2IiwKICAgICAgICAgICAgIlx1QTc1RiI6ICJ2IiwKICAgICAgICAgICAgIlx1MDI4QyI6ICJ2IiwKICAgICAgICAgICAgIlx1QTc2MSI6ICJ2eSIsCiAgICAgICAgICAgICJcdTAwNzciOiAidyIsCiAgICAgICAgICAgICJcdTI0RTYiOiAidyIsCiAgICAgICAgICAgICJcdUZGNTciOiAidyIsCiAgICAgICAgICAgICJcdTFFODEiOiAidyIsCiAgICAgICAgICAgICJcdTFFODMiOiAidyIsCiAgICAgICAgICAgICJcdTAxNzUiOiAidyIsCiAgICAgICAgICAgICJcdTFFODciOiAidyIsCiAgICAgICAgICAgICJcdTFFODUiOiAidyIsCiAgICAgICAgICAgICJcdTFFOTgiOiAidyIsCiAgICAgICAgICAgICJcdTFFODkiOiAidyIsCiAgICAgICAgICAgICJcdTJDNzMiOiAidyIsCiAgICAgICAgICAgICJcdTAwNzgiOiAieCIsCiAgICAgICAgICAgICJcdTI0RTciOiAieCIsCiAgICAgICAgICAgICJcdUZGNTgiOiAieCIsCiAgICAgICAgICAgICJcdTFFOEIiOiAieCIsCiAgICAgICAgICAgICJcdTFFOEQiOiAieCIsCiAgICAgICAgICAgICJcdTAwNzkiOiAieSIsCiAgICAgICAgICAgICJcdTI0RTgiOiAieSIsCiAgICAgICAgICAgICJcdUZGNTkiOiAieSIsCiAgICAgICAgICAgICJcdTFFRjMiOiAieSIsCiAgICAgICAgICAgICJcdTAwRkQiOiAieSIsCiAgICAgICAgICAgICJcdTAxNzciOiAieSIsCiAgICAgICAgICAgICJcdTFFRjkiOiAieSIsCiAgICAgICAgICAgICJcdTAyMzMiOiAieSIsCiAgICAgICAgICAgICJcdTFFOEYiOiAieSIsCiAgICAgICAgICAgICJcdTAwRkYiOiAieSIsCiAgICAgICAgICAgICJcdTFFRjciOiAieSIsCiAgICAgICAgICAgICJcdTFFOTkiOiAieSIsCiAgICAgICAgICAgICJcdTFFRjUiOiAieSIsCiAgICAgICAgICAgICJcdTAxQjQiOiAieSIsCiAgICAgICAgICAgICJcdTAyNEYiOiAieSIsCiAgICAgICAgICAgICJcdTFFRkYiOiAieSIsCiAgICAgICAgICAgICJcdTAwN0EiOiAieiIsCiAgICAgICAgICAgICJcdTI0RTkiOiAieiIsCiAgICAgICAgICAgICJcdUZGNUEiOiAieiIsCiAgICAgICAgICAgICJcdTAxN0EiOiAieiIsCiAgICAgICAgICAgICJcdTFFOTEiOiAieiIsCiAgICAgICAgICAgICJcdTAxN0MiOiAieiIsCiAgICAgICAgICAgICJcdTAxN0UiOiAieiIsCiAgICAgICAgICAgICJcdTFFOTMiOiAieiIsCiAgICAgICAgICAgICJcdTFFOTUiOiAieiIsCiAgICAgICAgICAgICJcdTAxQjYiOiAieiIsCiAgICAgICAgICAgICJcdTAyMjUiOiAieiIsCiAgICAgICAgICAgICJcdTAyNDAiOiAieiIsCiAgICAgICAgICAgICJcdTJDNkMiOiAieiIsCiAgICAgICAgICAgICJcdUE3NjMiOiAieiIgICAKICAgICAgICB9OwoKICAgICAgICB2YXIgY2hhcmFjdGVycyA9IHN0cmluZy5zcGxpdCggIiIgKTsKICAgIAogICAgICAgIGZvciAoIHZhciBpPTA7IGkgPCBjaGFyYWN0ZXJzLmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICB2YXIgbm9ybWFsaXplZENoYXJhY3RlciA9IGRpYWNyaXRpY3NNYXBbIGNoYXJhY3RlcnNbIGkgXSBdOwogICAgICAgICAgICBpZiAoIHVuZGVmaW5lZCAhPT0gbm9ybWFsaXplZENoYXJhY3RlciApIHsKICAgICAgICAgICAgICAgIGNoYXJhY3RlcnNbIGkgXSA9IG5vcm1hbGl6ZWRDaGFyYWN0ZXI7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBjaGFyYWN0ZXJzLmpvaW4oICIiICk7CgogICAgfTsKCiAgICAvKioKICAgICAqIENvbXByZXNzZXMgYSBzdHJpbmcuCiAgICAgKgogICAgICogUmVwbGFjZXMgYWxsIHdoaXRlc3BhY2Ugc2VxdWVuY2VzIHdpdGggc2luZ2xlIHNwYWNlcy4KICAgICAqIEN1dHMgb2ZmIHN0cmluZyBpZiBsb25nZXIgdGhhbiBhIHNwZWNpZmllZCBsZW5ndGggYW5kIHNldHMgYW4KICAgICAqIGVsbGlwc2lzIHRvIGluZGljYXRlIHRoZSByZW1vdmFsLgogICAgICoKICAgICAqIEBzeW50YXggU3RyaW5nVXRpbC5jb21wcmVzc1RleHQoIHRleHQsIGxlbmd0aCApCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCBhIHN0cmluZyB0byBjb21wcmVzcwogICAgICogQHBhcmFtIHtOdW1iZXJ9IFtsZW5ndGg9MjUwXSBsZW5ndGggdG8gY3V0IHN0cmluZyBvZmYgYXQKICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IHRoZSBjb21wcmVzc2VkIHN0cmluZwogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgU3RyaW5nVXRpbC5jb21wcmVzc1RleHQKICAgICAqLwogICAgdGhhdC5jb21wcmVzc1RleHQgPSBmdW5jdGlvbiggdGV4dCwgbGVuZ3RoICkgewogICAgICAgIGlmICggdW5kZWZpbmVkID09PSBsZW5ndGggKSB7CiAgICAgICAgICAgIGxlbmd0aCA9IDI1MDsKICAgICAgICB9CiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSggL1xzKy9nLCAiICIgKTsKICAgICAgICB2YXIgcHVuY3R1YXRpb24gPSBbICIuIiwgIiwiLCAiPyIsICIhIiwgIi0iLCAiOyIgXTsKICAgICAgICBpZiAoIHRleHQubGVuZ3RoID4gbGVuZ3RoICkgewogICAgICAgICAgICAvLyBzdHJpbmdzIGNhbid0IGVuZCB1cCBzaG9ydGVyIHRoYW4gMjAgY2hhcmFjdGVycwogICAgICAgICAgICBmb3IgKCB2YXIgaSA9IGxlbmd0aDsgaSA+IDIwOyBpLS0gKSB7CiAgICAgICAgICAgICAgICBpZiAoIC0xICE9PSBwdW5jdHVhdGlvbi5pbmRleE9mKCB0ZXh0WyBpIF0gKSApIHsKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5zdWJzdHJpbmcoIDAsIGkgKSArICIgLi4uIjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBpZiBubyBwdW5jdHVhdGlvbiBpcyBmb3VuZCBqdXN0IGN1dCBvZmYKICAgICAgICAvLyBhZGQgNCB0byBhY2NvdW50IGZvciBhIHBvc3NpYmxlIGVsbGlwc2lzIHNldCBlYXJsaWVyCiAgICAgICAgaWYgKCB0ZXh0Lmxlbmd0aCA+IChsZW5ndGggKyA0KSApIHsKICAgICAgICAgICAgdGV4dCA9IHRleHQuc3Vic3RyaW5nKCAwLCBsZW5ndGggKSArICIgLi4uIjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRleHQ7CiAgICB9OwoKCiAgICAvKioKICAgICAqIE1ldGhvZCB0aGF0IHRyYW5zZm9ybXMgb3JkaW5hbHMgdG8gbnVtYmVycy4KICAgICAqCiAgICAgKiBAdHlwZSB7bWV0aG9kfQogICAgICogQHN5bnRheCBTdHJpbmdVdGlsLm9yZGluYWxUb051bWJlciggc3RyaW5nICkKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdHJpbmcgVGhlIHN0cmluZyB0byB0cmFuc2Zvcm0KICAgICAqIEByZXR1cm4ge1N0cmluZ30gdGhlIHN0cmluZyB3aXRoIHRoZSBvcmRpbmFsIHJlcGxhY2VkIGJ5IGEgbnVtYmVyIG9yIHRoZSBvcmlnaW5hbCBzdHJpbmcKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFN0cmluZ1V0aWwub3JkaW5hbFRvTnVtYmVyCiAgICAgKiBAZXhhbXBsZSBTdHJpbmdVdGlsLm9yZGluYWxUb051bWJlciggIlRoaXJkIHNlYXNvbiIgKQogICAgICovCiAgICB0aGF0Lm9yZGluYWxUb051bWJlciA9IGZ1bmN0aW9uKCBzdHJpbmcgKSB7CgogICAgICAgIHZhciB3b3JkTWFwID0gewogICAgICAgICAgICAiZlx1MDBmOHJzdGUiOiAiMS4iLAogICAgICAgICAgICAiZmlyc3QiOiAiMS4iLAogICAgICAgICAgICAiYW5kZW4iOiAiMi4iLAogICAgICAgICAgICAic2Vjb25kIjogIjIuIiwKICAgICAgICAgICAgInRyZWRqZSI6ICIzLiIsCiAgICAgICAgICAgICJ0aGlyZCI6ICIzLiIsCiAgICAgICAgICAgICJmamVyZGUiOiAiNC4iLAogICAgICAgICAgICAiZm91cnRoIjogIjQuIiwKICAgICAgICAgICAgImZlbXRlIjogIjUuIiwKICAgICAgICAgICAgImZpZnRoIjogIjUuIiwKICAgICAgICAgICAgInNqZXR0ZSI6ICI2LiIsCiAgICAgICAgICAgICJzaXh0aCI6ICI2LiIsCiAgICAgICAgICAgICJzeXZlbmRlIjogIjcuIiwKICAgICAgICAgICAgInNldmVudGgiOiAiNy4iLAogICAgICAgICAgICAib3R0ZW5kZSI6ICI4LiIsCiAgICAgICAgICAgICJlaWdodGgiOiAiOC4iLAogICAgICAgICAgICAibmllbmRlIjogIjkuIiwKICAgICAgICAgICAgIm5pbnRoIjogIjkuIiwKICAgICAgICAgICAgInRpZW5kZSI6ICIxMC4iLAogICAgICAgICAgICAidGVudGgiOiAiMTAuIgogICAgICAgIH07CgogICAgICAgIHZhciBpbnB1dFN0cmluZyA9IHN0cmluZy5zcGxpdCggIiAiICk7CiAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgaW5wdXRTdHJpbmcubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgICAgIHZhciBvdXRwdXROdW1iZXJTdHJpbmcgPSB3b3JkTWFwWyBpbnB1dFN0cmluZ1sgaSBdLnRvTG93ZXJDYXNlKCkgXTsKICAgICAgICAgICAgaWYgKCB1bmRlZmluZWQgIT09IG91dHB1dE51bWJlclN0cmluZyApIHsKICAgICAgICAgICAgICAgIHN0cmluZyA9IHN0cmluZy5yZXBsYWNlKCBpbnB1dFN0cmluZ1tpXSwgb3V0cHV0TnVtYmVyU3RyaW5nICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cmluZzsKICAgIH07CgogICAgcmV0dXJuIHRoYXQ7Cgp9KCApOw==", "moduleName": "StringUtil"}, {"javascript": "LyoqIEBmaWxlIE1vZHVsZSB0byBoYW5kbGUgYXJndW1lbnQgY2hlY2tpbmcgaW4gYSBuZWF0ZXIgd2F5LiAqLwoKCkVYUE9SVEVEX1NZTUJPTFMgPSBbICdWYWx1ZUNoZWNrJyBdOwoKLyoqCiAqIEZ1bmN0aW9ucyB0byBjaGVjayBhcmd1bWVudHMgcHJlc2VuY2UgYW5kIHZhbHVlLgogKiAKICogVGhpcyBtb2R1bGUvbmFtZXNwYWNlIHByb3ZpZGVzIGEgbnVtYmVyIG9mIGZ1bmN0aW9ucyB0aGF0IGNhbiBiZSB1c2VkCiAqIHRvIHN5c3RlbWF0aWNhbGx5IGNoZWNrIHRoYXQgcGFyYW1ldGVycy92YXJpYWJsZXMgYXJlIHNldCBhbmQgY2hlY2sKICogdGhhdCB0aGUgdmFsdWVzIGZ1bGxmaWxsIGNlcnRhaW4gY3JpdGVyaWEuIFRoZSBmdW5jdGlvbnMgcHJvdmlkZWQgYXJlCiAqIGNoYWluYWJsZSwgd2hpY2ggbGVhZHMgdG8gZWFzeS10by1yZWFkIGV4cHJlc3Npb25zLiBGb3IgbW9yZQogKiBpbmZvcm1hdGlvbiBhYm91dCB0aGUgYWN0dWFsIGNvbnN0cmFpbnRzLCBzZWUge0BsaW5rIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3R9LgogKiAKICogSWYgYSBjYWxsZXIgcGFzc2VzIHBhcmFtZXRlcnMgdG8gdGhlIGZ1bmN0aW9uIHRoYXQgZG9lcyBub3QgbWF0Y2gKICogdGhlIGNvbnN0cmFpbnRzLCBhIHN1aXRhYmxlIGV4Y2VwdGlvbiB3aWxsIGJlIHRocm93bi4gVGhpcyBlbnN1cmVzCiAqIHRoYXQgeW91IGNhbiB3cml0ZSB0aGUgcmVzdCBvZiB0aGUgZnVuY3Rpb24gd2l0aCB0aGUga25vd2xlZGdlIHRoYXQKICogdGhlIHBhcmFtZXRlcnMgYXJlIHdpdGhpbiB0aGUgdmFsdWVzIHRoZSBmdW5jdGlvbiBjYW4gaGFuZGxlLgogKgogKiBAdHlwZSB7bmFtZXNwYWNlfQogKiBAYm9ycm93cyBWYWx1ZUNoZWNrLmNoZWNrIGFzIGNoZWNrVGhhdCAKICogQGJvcnJvd3MgVmFsdWVDaGVjay5jaGVjayBhcyByZXF1aXJlVGhhdCAKICogQGV4YW1wbGUgCi8vIFNheSB0aGF0IHlvdSB3YW50IHRvIGNoZWNrIHRoZSBhcmd1bWVudHMgZm9vLCBiYXIgYW5kIGJheiB0byBhIGZ1bmN0aW9uLiBZb3Ugd2FudCB0byBjaGVjayB0aGF0Ci8vIAovLyAgIGEpIGZvbyBpcyBhIG5vbi1lbXB0eSBzdHJpbmcsCi8vICAgYikgYmFyIG11c3QgYmUgYSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxMDAgKGluY2x1c2l2ZSksIGFuZAovLyAgIGMpIGJheiBzaG91bGQgYmUgZWl0aGVyIHRoZSBzdHJpbmcgInN1Y2Nlc3MiLCAic3VzcGVuZCIgb3IgdGhlIHN0cmluZyAiZmFpbHVyZSIgCi8vIAovLyAgIFlvdSBjb3VsZCB0aGVuIHdyaXRlIHRoZSBmdW5jdGlvbiBzb21ld2hhdCBsaWtlIHRoaXM6CmZ1bmN0aW9uIG15VGVzdEZ1bmN0aW9uKCBmb28sIGJhciwgYmF6ICkgewogICAgVmFsdWVDaGVjay5jaGVja1RoYXQoICJmb28iLCBmb28gKS5pcy5kZWZpbmVkLmFuZC5oYXMudHlwZSggInN0cmluZyIgKS5hbmQudmFsdWUudGhhdC5pcy5ub3QuZXF1YWxUbyggIiIgKTsKICAgIFZhbHVlQ2hlY2suY2hlY2tUaGF0KCAiYmFyIiwgYmFyICkuaXMuZGVmaW5lZC53aXRoLnR5cGUoICJudW1iZXIiICkuYW5kLmluc2lkZSggMCwgMTAwICk7CiAgICBWYWx1ZUNoZWNrLmNoZWNrVGhhdCggImJheiIsIGJheiApLmlzLmRlZmluZWQuYW5kLmhhcy50eXBlKCAic3RyaW5nIiApLmFuZC5pcy5pbiggWyAic3VjY2VzcyIsICJzdXNwZW5kIiwgImZhaWx1cmUiIF0gKTsKCiAgICAvLyBSZXN0IG9mIGZ1bmN0aW9uCn0KLy8gVGhlIHRlc3RzIGNvdWxkIGFsc28gYmUgd3JpdHRlbiBhIGxvdCBtb3JlIGNvbXBhY3QsIGlmIHlvdSB3aXNoOgpWYWx1ZUNoZWNrLmNoZWNrVGhhdCggImZvbyIsIGZvbyApLmRlZmluZWQudHlwZSggInN0cmluZyIgKS5ub3QuZXF1YWxUbyggIiIgKTsKVmFsdWVDaGVjay5jaGVja1RoYXQoICJiYXIiLCBiYXIgKS5kZWZpbmVkLnR5cGUoICJudW1iZXIiICkuaW5zaWRlKCAwLCAxMDAgKTsKVmFsdWVDaGVjay5jaGVja1RoYXQoICJiYXoiLCBiYXogKS5kZWZpbmVkLnR5cGUoICJzdHJpbmciICkuaW4oIFsgInN1Y2Nlc3MiLCAic3VzcGVuZCIsICJmYWlsdXJlIiBdICk7CiAqIAogKiBAbmFtZXNwYWNlIAogKiBAbmFtZSBWYWx1ZUNoZWNrCiAqLwp2YXIgVmFsdWVDaGVjayA9IGZ1bmN0aW9uKCApIHsKCiAgICB2YXIgdGhhdCA9IHt9OwoKICAgIC8vIFRocm93IGhlbHBlciBmdW5jdGlvbgogICAgdmFyIHRocm93RXJyb3IgPSBmdW5jdGlvbiggbWVzc2FnZSApIHsKICAgICAgICB0aHJvdyBFcnJvciggIlZhbHVlQ2hlY2tFcnJvcjogVGhlIGZvbGxvd2luZyBjaGVjayBmYWlsZWQ6ICIgKyBtZXNzYWdlICk7CiAgICB9OwoKICAgIHZhciBjaGVja3Rocm93TmVlZDFBcmdFcnJvciA9IGZ1bmN0aW9uKCBmdW5jdGlvbk5hbWUsIGxlbmd0aCApIHsKICAgICAgICBpZiAoIGxlbmd0aCAhPSAxICkgewogICAgICAgICAgICB0aHJvd0Vycm9yKCAiRXJyb3IgaW4gY2FsbGluZyBjaGVja09iamVjdC4iICsgZnVuY3Rpb25OYW1lICsgIi4gUmVxdWlyZXMgZXhhY3RseSAxIGFyZ3VtZW50LCBnb3QgIiArIGxlbmd0aCApOwogICAgICAgIH0KICAgIH07CgogICAgdmFyIGNoZWNrdGhyb3dOZWVkMkFyZ3NFcnJvciA9IGZ1bmN0aW9uKCBmdW5jdGlvbk5hbWUsIGxlbmd0aCApIHsKICAgICAgICBpZiAoIGxlbmd0aCAhPSAyICkgewogICAgICAgICAgICB0aHJvd0Vycm9yKCAiRXJyb3IgaW4gY2FsbGluZyBjaGVja09iamVjdC4iICsgZnVuY3Rpb25OYW1lICsgIi4gUmVxdWlyZXMgZXhhY3RseSAyIGFyZ3VtZW50cywgZ290ICIgKyBsZW5ndGggKTsKICAgICAgICB9CiAgICB9OwoKCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gT2JqZWN0LCB0aGF0IGV4cG9zZXMgYWxsIHRoZSBjb25zdHJhaW50cywgZXRjLgogICAgLy8gTk9URTogaWYgbmFtZSBpcyBzZXQgdG8gdW5kZWZpbmVkLCB0aGUgZ2V0dGVycyBkb2VzIG5vdCByZXR1cm4gdGhpcyAtIHRoaXMgaXMgdG8gZmFjaWxpdGF0ZSB0aGUgaW50ZXJhY3RpdmUgaGVscCBzeXN0ZW0uCiAgICAvLyBPbmx5IENoZWNrT2JqZWN0IGNhbiB3b3JrIHdpdGggaGVscCwgbm9ybWFsIG9iamVjdHMgY2FuIG5vdCB3b3JrIHdpdGggaGVscCwgZHVlIHRvIHRoZSB3YXkgZ2V0dGVycyB3b3JrLgogICAgdmFyIGNoZWNrT2JqZWN0ID0gZnVuY3Rpb24oIG5hbWVfLCB2YWx1ZV8gKSB7CiAgICAgICAgdmFyIHRoYXQgPSB7fTsKCiAgICAgICAgLy8gUHJpdmF0ZSBzdHVmZgoKICAgICAgICAvLyBWYXJpYWJsZQogICAgICAgIHZhciB2YWx1ZSA9IHZhbHVlXzsKICAgICAgICB2YXIgbmFtZSA9IG5hbWVfOwogICAgICAgIHZhciBub3RmbGFnID0gZmFsc2U7CgogICAgICAgIC8vIEhlbHBlciBtZXRob2QKICAgICAgICAvLyBEZWZpbmUgb3BlcmF0b3JzCiAgICAgICAgdmFyIG9wZXJhdG9yID0gewogICAgICAgICAgICAvLyB0b2RvOiBVc2UgPT09IG9yIG5vdC4uLiA/Pz8KICAgICAgICAgICAgZXF1YWxpdHk6IGZ1bmN0aW9uKCBhLCBiICkgewogICAgICAgICAgICAgICAgcmV0dXJuIGEgPT0gYjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLy8gaW5lcXVhbGl0eSA6IGZ1bmN0aW9uKCBhLCBiICkgeyByZXR1cm4gISBlcXVhbGl0eSggYSwgYiApOyB9LAogICAgICAgICAgICBncmVhdGVydGhhbjogZnVuY3Rpb24oIGEsIGIgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYSA+IGI7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGxlc3N0aGFuOiBmdW5jdGlvbiggYSwgYiApIHsKICAgICAgICAgICAgICAgIHJldHVybiBhIDwgYjsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgLy8gQW5kIHRoaXMgaXMgZm9yIHRoZSBkZXNjcmlwdGlvbnMuCiAgICAgICAgb3BlcmF0b3IuZXF1YWxpdHkuZGVzYyA9ICI9PSI7CiAgICAgICAgb3BlcmF0b3IuZ3JlYXRlcnRoYW4uZGVzYyA9ICI+IjsKICAgICAgICBvcGVyYXRvci5sZXNzdGhhbi5kZXNjID0gIjwiOwoKICAgICAgICAvLyBDb21wYXIgb3RoZXIgc3R1ZmYgdG8gdmFsdWUsIHVzaW5nIGFuIG9wZXJhdG9yCiAgICAgICAgdmFyIGNvbXBhcmUgPSBmdW5jdGlvbiggb3BlcmF0b3IsIGIgKSB7CiAgICAgICAgICAgIHZhciBjb21wcmVzID0gb3BlcmF0b3IoIHZhbHVlLCBiICk7CiAgICAgICAgICAgIHZhciBub3RzdHJpbmcgPSAibm90ICI7CiAgICAgICAgICAgIGlmICggbm90ZmxhZyApIHsKICAgICAgICAgICAgICAgIGNvbXByZXMgPSAhY29tcHJlczsKICAgICAgICAgICAgICAgIG5vdGZsYWcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIG5vdHN0cmluZyA9ICIiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggY29tcHJlcyApIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGF0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3dFcnJvciggIlZhbHVlIG9mICciICsgbmFtZSArICInIDogJyIgKyB2YWx1ZSArICInIGlzICIgKyBub3RzdHJpbmcgKyBvcGVyYXRvci5kZXNjICsgIiAnIiArIGIgKyAiJyIgKTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIC8vIEhlbHBlciBmdW5jdGlvbiB0byBjcmVhdGUgbGluayB3b3Jrcy4KICAgICAgICAvLyBXb3JkcywgdGhhdCB3ZSB3YW50CiAgICAgICAgLy8gaXMsIGFuZCwgaGFzLCBoYXZlLCB3aXRoLCBvZiwgdmFsdWUsIG11c3QsIGJlCgogICAgICAgIC8qKgogICAgICAgICAqIFNlbGVjdCB0aGUgZmlyc3Qgbm9kZSB0aGF0IG1hdGNoZXMgdGhlIHNwZWNpZmllZCB4cGF0aC4KICAgICAgICAgKgogICAgICAgICAqIEBtZXRob2QKICAgICAgICAgKiBAbmFtZSBYUGF0aC5zZWxlY3ROb2RlCiAgICAgICAgICogQHN5bnRheCBYUGF0aC5zZWxlY3ROb2RlKHhwYXRoLCB4bWxOb2RlKQogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB4cGF0aCBleHByZXNzaW9uIHRvIG1hdGNoCiAgICAgICAgICogQHBhcmFtIHtOb2RlfSB4bWxOb2RlIERvY3VtZW50IHRvIG1hdGNoIHhwYXRoIGluCiAgICAgICAgICogQHJldHVybiB7Tm9kZXx1bmRlZmluZWR9IFRoZSBmaXJzdCBub2RlIHRoYXQgbWF0Y2hlcyB0aGUgcGF0aCBvciB1bmRlZmluZWQgaWYgbm8gbm9kZSBtYXRjaGVzCiAgICAgICAgICogQGV4YW1wbGUKICAgICAgICAgKiBYUGF0aC5zZWxlY3QoIi9yb290L2NoaWxkIiwgZG9jKQogICAgICAgICAqLwoKICAgICAgICAvKioKICAgICAgICAgKiBMaW5rIG9uZSBvciBtb3JlIGNoZWNrL2NvbnN0cmFpbnRzIHRvZ2V0aGVyLgogICAgICAgICAqCiAgICAgICAgICogQG1ldGhvZAogICAgICAgICAqIEBuYW1lIENoZWNrT2JqZWN0SW5zdGFuY2Uue2xpbmtuYW1lfQogICAgICAgICAqIEBzeW50YXggQ2hlY2tPYmplY3RJbnN0YW5jZS57bGlua25hbWV9LnNvbWVDaGVjazsKICAgICAgICAgKiBAcGFyYW0ge3R5cGV9IG9uT2JqZWN0CiAgICAgICAgICogQHBhcmFtIHt0eXBlfSBsaW5rbmFtZQogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2hlY2tPYmplY3QgaW5zdGFuY2Ugc3VpdGFibGUgZm9yIGNoYWluaW5nIGNvbnN0cmFpbnRzCiAgICAgICAgICogQGV4YW1wbGUKICAgICAgICAgKiBWYWx1ZUNoZWNrLmNoZWNrVGhhdCggImZvbyIsIGZvbyApLmlzLm9mLnR5cGUoICJzdHJpbmciICkuYW5kLndpdGgudmFsdWUubm90LmVxdWFsVG8oICJzb21ldGhpbmciICk7CiAgICAgICAgICogVmFsdWVDaGVjay5yZXF1aXJlVGhhdCggImZvbyIsIGZvbyApLm11c3QuYmUub2YudHlwZSggIm51bWJlciIgKS5hbmQuaGF2ZS52YWx1ZS5pbnNpZGUoIDQyLCA3OCApOwogICAgICAgICAqIFZhbHVlQ2hlY2suY2hlY2tUaGF0KCAiZm9vIiwgZm9vICkuaXMuZGVmaW5lZC5hbmQuaGFzLnR5cGUoICJzdHJpbmciICkuYW5kLnRoYXQuaXQuaGFzLnZhbHVlLmluKCBbICJiaWJsb3Rlay5kayIsICJwYWxsZXNnYXZlYm9kIiBdICk7CiAgICAgICAgICogVmFsdWVDaGVjay5yZXF1aXJlVGhhdCggImFkZHJlc3MiLCBmb28gKS5oYXMudHlwZSggInN0cmluZyIgKS5hbmQudGhhdC5pdC5pcy5hbi5lbWFpbC5hZGRyZXNzOwogICAgICAgICAqLwogICAgICAgIHZhciBkZWZpbmVMaW5rID0gZnVuY3Rpb24oIG9uT2JqZWN0LCBsaW5rbmFtZSApIHsKICAgICAgICAgICAgb25PYmplY3QuX19kZWZpbmVHZXR0ZXJfXyggbGlua25hbWUsIGZ1bmN0aW9uKCApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIG5hbWUgPT09IHVuZGVmaW5lZCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9uT2JqZWN0Ll9fbG9va3VwR2V0dGVyX18oIGxpbmtuYW1lICk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9uT2JqZWN0OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gKTsKICAgICAgICB9OwoKICAgICAgICAvLyBQdWJsaWMgc3R1ZmYKICAgICAgICAvLyBEZWZpbmUgYWxsIHRoZSBsaW5rcy4KICAgICAgICAoIGZ1bmN0aW9uKCApIHsKICAgICAgICAgICAgICAgIFsgImlzIiwgImFuZCIsICJoYXMiLCAiaGF2ZSIsICJ3aXRoIiwgIm9mIiwgInZhbHVlIiwgIm11c3QiLCAiYmUiLCAidGhhdCIsICJpdCIsICJkb2VzIiwgImFkZHJlc3MiLCAiYW4iIF0KICAgICAgICAgICAgICAgICAgICAuZm9yRWFjaCggZnVuY3Rpb24oIHYgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmluZUxpbmsoIHRoYXQsIHYgKTsKICAgICAgICAgICAgICAgICAgICB9ICk7CiAgICAgICAgICAgIH0oICkgKTsKCgogICAgICAgIC8vIEhlcmUgY29tZXMgc3R1ZmYgdGhhdCBhY3R1YWxseSBkb2VzIHNvbWV0aGluZy4KICAgICAgICAvKioKICAgICAgICAgKiBUb29nbGUgdGhlIHNlbWFudGljcyBvZiB0aGUgbmV4dCBjaGVjay4KICAgICAgICAgKgogICAgICAgICAqIFRoaXMgZmxhZyB0b29nbGVzIHRoZSBzZW1hbnRpY3Mgb2YgdGhlIG5leHQgY2hlY2svY29uc3RyYWludCwgYW5kIGlzIHByb3ZpZGVkIHRvIGFsbG93IGFuIGV4cHJlc3NpdmUsIGVhc3ktdG8tcmVhZCBzeW50YXguCiAgICAgICAgICogU28sIHdyaXRpbmcgQ2hlY2tPYmplY3RJbnN0YW5jZS5ub3QuZXF1YWxUbyggNDIgKSBpcyBlcXVpdmFsZW50IHRvIHdyaXRpbmcgQ2hlY2tPYmplY3RJbnN0YW5jZS51bmVxdWFsVG8oIDQyICkuCiAgICAgICAgICogTm90ZSwgdGhhdCBmb3IgaW5zaWRlIGFuZCBvdXRzaWRlLCB0aGVyZSBhcmUgc3BlY2lhbCBjb3JuZXJjYXNlIG1lYW5pbmdzIGZvciB3cml0aW5nIG5vdAogICAgICAgICAqIChzZWUgdGhlIGhlbHAgZm9yIHRoZXNlIGNoZWNrcywgZm9yIG1vcmUgaW5mb3JtYXRpb24pLgogICAgICAgICAqCiAgICAgICAgICogQG1ldGhvZAogICAgICAgICAqIEBuYW1lIENoZWNrT2JqZWN0SW5zdGFuY2Uubm90CiAgICAgICAgICogQHN5bnRheCBDaGVja09iamVjdEluc3RhbmNlLm5vdDsKICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IENoZWNrT2JqZWN0IGluc3RhbmNlIHN1aXRhYmxlIGZvciBjaGFpbmluZyBjb25zdHJhaW50cwogICAgICAgICAqIEBleGFtcGxlCiAgICAgICAgICogVmFsdWVDaGVjay5jaGVjayggImZvbyIsIGZvbyApLmlzLm5vdC50eXBlKCAic3RyaW5nIiApLmFuZC52YWx1ZS5pcy5ub3QuaW4oIFsgMjMsIDM0LCA0NSBdICk7CiAgICAgICAgICovCiAgICAgICAgdGhhdC5fX2RlZmluZUdldHRlcl9fKCAibm90IiwgZnVuY3Rpb24oICkgewogICAgICAgICAgICAgICAgLy8gSGFjayB0byBmaXggdGhlIGhlbHAgc3lzdGVtCiAgICAgICAgICAgICAgICBpZiAoIG5hbWUgPT09IHVuZGVmaW5lZCApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fX2xvb2t1cEdldHRlcl9fKCAibm90IiApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBub3RmbGFnID0gIW5vdGZsYWc7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gKTsKCiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyBkZWZpbmVkIGFuZCB1bmRlZmluZWQKCiAgICAgICAgLyoqCiAgICAgICAgICogQ2hlY2sgaWYgdGhlIHZhbHVlIGlzIHVuZGVmaW5lZC4KICAgICAgICAgKgogICAgICAgICAqIFRoaXMgY29uc3RyYWludCByZXF1aXJlcyB0aGF0IHRoZSB2YWx1ZSBpcyB1bmRlZmluZWQuIElmIHRoZSBjb25zdHJhaW50IGlzIG5vdCBmdWxsZmlsbGVkLCBpdCB3aWxsIHRocm93IGFuIGVycm9yLgogICAgICAgICAqCiAgICAgICAgICogQG1ldGhvZAogICAgICAgICAqIEBuYW1lIENoZWNrT2JqZWN0SW5zdGFuY2UudW5kZWZpbmVkCiAgICAgICAgICogQHN5bnRheCBDaGVja09iamVjdEluc3RhbmNlLnVuZGVmaW5lZDsKICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IENoZWNrT2JqZWN0IGluc3RhbmNlIHN1aXRhYmxlIGZvciBjaGFpbmluZyBjb25zdHJhaW50cwogICAgICAgICAqIEBleGFtcGxlCiAgICAgICAgICogVmFsdWVDaGVjay5jaGVjayggImZvbyIsIGZvbyApLmlzLnVuZGVmaW5lZDsKICAgICAgICAgKi8KICAgICAgICB0aGF0Ll9fZGVmaW5lR2V0dGVyX18oICJ1bmRlZmluZWQiLCBmdW5jdGlvbiggKSB7CiAgICAgICAgICAgICAgICAvLyBIYWNrIHRvIGZpeCB0aGUgaGVscCBzeXN0ZW0KICAgICAgICAgICAgICAgIGlmICggbmFtZSA9PT0gdW5kZWZpbmVkICkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9fbG9va3VwR2V0dGVyX18oICJ1bmRlZmluZWQiICk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVxdWFsVG8oIHVuZGVmaW5lZCApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9ICk7CgogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrIGlmIHRoZSB2YWx1ZSBpcyBkZWZpbmVkLgogICAgICAgICAqCiAgICAgICAgICogVGhpcyBjb25zdHJhaW50IHJlcXVpcmVzIHRoYXQgdGhlIHZhbHVlIGlzIGRlZmluZWQuIElmIHRoZSBjb25zdHJhaW50IGlzIG5vdCBmdWxsZmlsbGVkLCBpdCB3aWxsIHRocm93IGFuIGVycm9yLgogICAgICAgICAqCiAgICAgICAgICogQG1ldGhvZAogICAgICAgICAqIEBuYW1lIENoZWNrT2JqZWN0SW5zdGFuY2UuZGVmaW5lZAogICAgICAgICAqIEBzeW50YXggQ2hlY2tPYmplY3RJbnN0YW5jZS5kZWZpbmVkOwogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2hlY2tPYmplY3QgaW5zdGFuY2Ugc3VpdGFibGUgZm9yIGNoYWluaW5nIGNvbnN0cmFpbnRzCiAgICAgICAgICogQGV4YW1wbGUKICAgICAgICAgKiBWYWx1ZUNoZWNrLmNoZWNrKCAiZm9vIiwgZm9vICkuaXMuZGVmaW5lZDsKICAgICAgICAgKiBWYWx1ZUNoZWNrLnJlcXVpcmVUaGF0KCAiZm9vIiwgZm9vICkuaXMuZGVmaW5lZC53aXRoLnR5cGUoICJzdHJpbmciICkuYW5kLnRoYXQuaXQuaXMubm90LmVxdWFsVG8oICIiICk7CiAgICAgICAgICovCiAgICAgICAgdGhhdC5fX2RlZmluZUdldHRlcl9fKCAiZGVmaW5lZCIsIGZ1bmN0aW9uKCApIHsKICAgICAgICAgICAgICAgIC8vIEhhY2sgdG8gZml4IHRoZSBoZWxwIHN5c3RlbQogICAgICAgICAgICAgICAgaWYgKCBuYW1lID09PSB1bmRlZmluZWQgKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19sb29rdXBHZXR0ZXJfXyggImRlZmluZWQiICk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm5vdC51bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gKTsKCiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyB0eXBlCgogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrIGlmIHRoZSB0eXBlIG9mIGEgdGhlIHZhbHVlIG1hdGNoZXMgdHlwZS4KICAgICAgICAgKiAKICAgICAgICAgKiBUaGlzIGNvbnN0cmFpbnQgcmVxdWlyZXMgdGhhdCB0aGUgdHlwZW9mIHRoZSB2YWx1ZSBpcyBlcXVhbCB0byB0aGUgdHlwZQogICAgICAgICAqIHN0cmluZyBwYXNzZWQgYXMgcGFyYW1ldGVyIHRvIHRoZSBjb25zdHJhaW50LiBJZiB0aGUgY29uc3RyYWludCBpcyBub3QKICAgICAgICAgKiBmdWxsZmlsbGVkLCBpdCB3aWxsIHRocm93IGFuIGVycm9yLiAKICAgICAgICAgKiAKICAgICAgICAgKiBAdHlwZSB7Y2hlY2t9CiAgICAgICAgICogQHN5bnRheCBDaGVja09iamVjdEluc3RhbmNlLnR5cGUoIHR5cGUgKTsKICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUaGUgdHlwZSBhcyBhIHN0cmluZyB0byBjaGVjayB0aGUgZW5jYXBzdWxhdGVkIHZhbHVlIGFnYWluc3QKICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IENoZWNrT2JqZWN0IGluc3RhbmNlIHN1aXRhYmxlIGZvciBjaGFpbmluZyBjb25zdHJhaW50cwogICAgICAgICAqIEBleGFtcGxlIFZhbHVlQ2hlY2suY2hlY2soICJmb28iLCBmb28gKS5oYXMudHlwZSggIm51bWJlciIgKTsKICAgICAgICAgKiAgICAgVmFsdWVDaGVjay5jaGVjayggImZvbyIsIGZvbyApLnR5cGUoICJzdHJpbmciICk7CiAgICAgICAgICogQG5hbWUgVmFsdWVDaGVjay5DaGVja09iamVjdC50eXBlCiAgICAgICAgICogQG1ldGhvZAogICAgICAgICAqLwogICAgICAgIHRoYXQudHlwZSA9IGZ1bmN0aW9uKCB0eXBlICkgewogICAgICAgICAgICBjaGVja3Rocm93TmVlZDFBcmdFcnJvciggInR5cGUiLCBhcmd1bWVudHMubGVuZ3RoICk7CiAgICAgICAgICAgIHZhciByZXNjb21wID0gdHlwZW9mIHZhbHVlID09IHR5cGU7CiAgICAgICAgICAgIHZhciBub3RzdHJpbmcxID0gIm5vdCAiOwogICAgICAgICAgICB2YXIgbm90c3RyaW5nMiA9ICIiOwogICAgICAgICAgICBpZiAoIG5vdGZsYWcgKSB7CiAgICAgICAgICAgICAgICBub3RmbGFnID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXNjb21wID0gIXJlc2NvbXA7CiAgICAgICAgICAgICAgICBub3RzdHJpbmcxID0gIiI7CiAgICAgICAgICAgICAgICBub3RzdHJpbmcyID0gIm5vdCAiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggcmVzY29tcCApIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3dFcnJvciggIlZhbHVlICciICsgbmFtZSArICInIGlzICIgKyBub3RzdHJpbmcxICsgIm9mIHR5cGUgJyIgKyB0eXBlICsgIicsIGJ1dCAiICsgbm90c3RyaW5nMiArICJvZiB0eXBlICciICsgdHlwZW9mIHZhbHVlICsgIiciICk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgIC8vIGluc3RhbmNlT2YKICAgICAgICAvKioKICAgICAgICAgKiBDaGVjayBpZiB0aGUgdmFsdWUgaXMgYW4gaW5zdGFuY2Ugb2YgYSB0eXBlLgogICAgICAgICAqIAogICAgICAgICAqIFRoaXMgY29uc3RyYWludCByZXF1aXJlcyB0aGF0IHRoZSB2YWx1ZSBpcyBhbiBpbnN0YW5jZSBvZiB0aGUKICAgICAgICAgKiB0eXBlL2NvbnN0cnVjdG9yIHBhc3NlZCBhcyBwYXJhbWV0ZXIgdG8gdGhlIGNvbnN0cmFpbnQuIElmIHRoZQogICAgICAgICAqIGNvbnN0cmFpbnQgaXMgbm90IGZ1bGxmaWxsZWQsIGl0IHdpbGwgdGhyb3cgYW4gZXJyb3IuIAogICAgICAgICAqIAogICAgICAgICAqIEB0eXBlIHtjaGVja30KICAgICAgICAgKiBAc3ludGF4IENoZWNrT2JqZWN0SW5zdGFuY2UuaW5zdGFuY2VPZiggdHlwZSApOwogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSB0eXBlL2NvbnN0cnVjdG9yIHRvIGNoZWNrIHRoZSBlbmNhcHN1bGF0ZWQgdmFsdWUgYWdhaW5zdAogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2hlY2tPYmplY3QgaW5zdGFuY2Ugc3VpdGFibGUgZm9yIGNoYWluaW5nIGNvbnN0cmFpbnRzCiAgICAgICAgICogQGV4YW1wbGUgVmFsdWVDaGVjay5jaGVjayggInNvbWVkYXRlIiwgc29tZWRhdGUgKS5pcy5hbi5pbnN0YW5jZU9mKCBEYXRlICk7CiAgICAgICAgICogICAgIFZhbHVlQ2hlY2suY2hlY2soICJmb28iLCBmb28gKS5pbnN0YW5jZU9mKCBTdHJpbmcgKTsKICAgICAgICAgKiBAbmFtZSBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0Lmluc3RhbmNlT2YKICAgICAgICAgKiBAbWV0aG9kCiAgICAgICAgICovCiAgICAgICAgdGhhdC5pbnN0YW5jZU9mID0gZnVuY3Rpb24oIHR5cGUgKSB7CiAgICAgICAgICAgIGNoZWNrdGhyb3dOZWVkMUFyZ0Vycm9yKCAidHlwZSIsIGFyZ3VtZW50cy5sZW5ndGggKTsKICAgICAgICAgICAgdmFyIHJlc2NvbXAgPSB2YWx1ZSBpbnN0YW5jZW9mIHR5cGU7CiAgICAgICAgICAgIHZhciBub3RzdHJpbmcxID0gIm5vdCAiOwogICAgICAgICAgICB2YXIgbm90c3RyaW5nMiA9ICIiOwogICAgICAgICAgICBpZiAoIG5vdGZsYWcgKSB7CiAgICAgICAgICAgICAgICBub3RmbGFnID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXNjb21wID0gIXJlc2NvbXA7CiAgICAgICAgICAgICAgICBub3RzdHJpbmcxID0gIiI7CiAgICAgICAgICAgICAgICBub3RzdHJpbmcyID0gIm5vdCAiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggcmVzY29tcCApIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3dFcnJvciggIlZhbHVlICciICsgbmFtZSArICInIGlzICIgKyBub3RzdHJpbmcxICsgIiBpbnN0YW5jZW9mICciICsgdHlwZSArICInIiApOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyBSZWdFeHAgc3VwcG9ydAogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrIGlmIHRoZSB2YWx1ZSBjb250YWlucyBhIHJlZ3VsYXIgZXhwcmVzc2lvbi4KICAgICAgICAgKiAKICAgICAgICAgKiBUaGlzIGNvbnN0cmFpbnQgcmVxdWlyZXMgdGhhdCB0aGUgdmFsdWUsIGNvbnZlcnRlZCB0byBhIHN0cmluZywKICAgICAgICAgKiBjb250YWlucyB0aGUgcmVndWxhciBleHByZXNzaW9uIHBhc3NlZCBhcyBwYXJhbWV0ZXIgdG8gdGhlIGNvbnN0cmFpbnQuCiAgICAgICAgICogSXQgZGlmZmVycyBmcm9tIG1hdGNoIGluIHRoYXQgdGhlIHJlZ3VsYXIgZXhwcmVzc2lvbiBvbmx5IG5lZWRzIHRvCiAgICAgICAgICogbWF0Y2ggc29tZSBwYXJ0IG9mIHRoZSB2YWx1ZSAoYWZ0ZXIgc3RyaW5nIGNvbnZlcnNpb24pLiBJZiB0aGUKICAgICAgICAgKiBjb25zdHJhaW50IGlzIG5vdCBmdWxsZmlsbGVkLCBpdCB3aWxsIHRocm93IGFuIGVycm9yLiAKICAgICAgICAgKiAKICAgICAgICAgKiBAdHlwZSB7Y2hlY2t9CiAgICAgICAgICogQHN5bnRheCBDaGVja09iamVjdEluc3RhbmNlLmNvbnRhaW4oIHJlZ2V4cCApOwogICAgICAgICAqIEBwYXJhbSB7UmVnRXhwfSByZWdleHAgVGhlIHJlZ3VsYXIgZXhwcmVzc2lvbiB0byBjaGVjayB0aGUgZW5jYXBzdWxhdGVkIHZhbHVlIGFnYWluc3QKICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IENoZWNrT2JqZWN0IGluc3RhbmNlIHN1aXRhYmxlIGZvciBjaGFpbmluZyBjb25zdHJhaW50cwogICAgICAgICAqIEBleGFtcGxlIFRoZSBmb2xsb3dpbmcgZXhhbXBsZSB3aWxsIGJlIE9LIGZvciBuYW1lcyBzdWNoIGFzIEJldGgsIGJldGggYW5kIEVsaXphYmV0aAogICAgICAgICAqICAgVmFsdWVDaGVjay5jaGVja1RoYXQoICJuYW1lIiwgbmFtZSApLmlzLm9mLnR5cGUoICJzdHJpbmciICkuYW5kLmNvbnRhaW4oIC9iZXRoL2kgKTsKICAgICAgICAgKiBAbmFtZSBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0LmNvbnRhaW4KICAgICAgICAgKiBAbWV0aG9kCiAgICAgICAgICovCiAgICAgICAgdGhhdC5jb250YWluID0gZnVuY3Rpb24oIHJlZ2V4cCApIHsKICAgICAgICAgICAgY2hlY2t0aHJvd05lZWQxQXJnRXJyb3IoICJlcXVhbFRvIiwgYXJndW1lbnRzLmxlbmd0aCApOwogICAgICAgICAgICB2YXIgdnMgPSB2YWx1ZS50b1N0cmluZyggKTsKICAgICAgICAgICAgdmFyIHJlc2NvbXAgPSAoIC0xICE9IHZzLnNlYXJjaCggcmVnZXhwICkgKTsKICAgICAgICAgICAgdmFyIG5vdHN0cmluZyA9ICJub3QgIjsKICAgICAgICAgICAgaWYgKCBub3RmbGFnICkgewogICAgICAgICAgICAgICAgbm90ZmxhZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmVzY29tcCA9ICFyZXNjb21wOwogICAgICAgICAgICAgICAgbm90c3RyaW5nID0gIiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCByZXNjb21wICkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvd0Vycm9yKCAiVmFsdWUgJyIgKyBuYW1lICsgIicgZG9lcyAiICsgbm90c3RyaW5nICsgIiBjb250YWluICciICsgcmVnZXhwLnRvU3RyaW5nKCApICsgIiciICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrIGlmIHRoZSB2YWx1ZSBtYXRjaGVzIGEgcmVndWxhciBleHByZXNzaW9uLgogICAgICAgICAqIAogICAgICAgICAqIFRoaXMgY29uc3RyYWludCByZXF1aXJlcyB0aGF0IHRoZSB2YWx1ZSwgY29udmVydGVkIHRvIGEgc3RyaW5nLCBtYXRjaGVzCiAgICAgICAgICogdGhlIHJlZ3VsYXIgZXhwcmVzc2lvbiBwYXNzZWQgYXMgcGFyYW1ldGVyIHRvIHRoZSBjb25zdHJhaW50LiBJdAogICAgICAgICAqIGRpZmZlcnMgZnJvbSBjb250YWlucyBpbiB0aGF0IHRoZSByZWd1bGFyIGV4cHJlc3Npb24gbXVzdCBtYXRjaCB0aGUKICAgICAgICAgKiBlbnRpcmUgdmFsdWUgKGFmdGVyIHN0cmluZyBjb252ZXJzaW9uKS4gSWYgdGhlIGNvbnN0cmFpbnQgaXMgbm90CiAgICAgICAgICogZnVsbGZpbGxlZCwgaXQgd2lsbCB0aHJvdyBhbiBlcnJvci4gCiAgICAgICAgICogCiAgICAgICAgICogQHR5cGUge2NoZWNrfQogICAgICAgICAqIEBzeW50YXggQ2hlY2tPYmplY3RJbnN0YW5jZS5tYXRjaCggcmVnZXhwICk7CiAgICAgICAgICogQHBhcmFtIHtSZWdFeHB9IHJlZ2V4cCBUaGUgcmVndWxhciBleHByZXNzaW9uIHRvIGNoZWNrIHRoZSBlbmNhcHN1bGF0ZWQgdmFsdWUgYWdhaW5zdAogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2hlY2tPYmplY3QgaW5zdGFuY2Ugc3VpdGFibGUgZm9yIGNoYWluaW5nIGNvbnN0cmFpbnRzCiAgICAgICAgICogQGV4YW1wbGUgVGhlIGZvbGxvd2luZyBleGFtcGxlIG1hdGNoZXMgb25seSBCZXRoIGFuZCBiZXRoLCBub3QgRWxpemFiZXRoCiAgICAgICAgICogICBWYWx1ZUNoZWNrLmNoZWNrVGhhdCggIm5hbWUiLCBmb28gKS5tYXRjaGVzKCAvYmV0aC9pICk7CiAgICAgICAgICogQG5hbWUgVmFsdWVDaGVjay5DaGVja09iamVjdC5tYXRjaAogICAgICAgICAqIEBtZXRob2QKICAgICAgICAgKi8KICAgICAgICB0aGF0Lm1hdGNoID0gZnVuY3Rpb24oIHJlZ2V4cCApIHsKICAgICAgICAgICAgY2hlY2t0aHJvd05lZWQxQXJnRXJyb3IoICJlcXVhbFRvIiwgYXJndW1lbnRzLmxlbmd0aCApOwogICAgICAgICAgICB2YXIgdnMgPSB2YWx1ZS50b1N0cmluZyggKTsKICAgICAgICAgICAgdmFyIHJlc2NvbXAgPSAoIHZzID09IHZzLm1hdGNoKCByZWdleHAgKVsgMCBdICk7CiAgICAgICAgICAgIHZhciBub3RzdHJpbmcgPSAibm90ICI7CiAgICAgICAgICAgIGlmICggbm90ZmxhZyApIHsKICAgICAgICAgICAgICAgIG5vdGZsYWcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJlc2NvbXAgPSAhcmVzY29tcDsKICAgICAgICAgICAgICAgIG5vdHN0cmluZyA9ICIiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggcmVzY29tcCApIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3dFcnJvciggIlZhbHVlICciICsgbmFtZSArICInIGRvZXMgIiArIG5vdHN0cmluZyArICIgbWF0Y2ggJyIgKyByZWdleHAudG9TdHJpbmcoICkgKyAiJyIgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyBDaGVjayBpZiBpdCBsb29rcyBsaWtlIGFuIGVtYWlsLiBDaGVja2luZyBlbWFpbCBhZGRyZXNzZXMgd2l0aCAKICAgICAgICAvLyByZWd1bGFyIGV4cHJlc3Npb25zIGlzIGNvbXBsaWNhdGVkLCBjaGVjawogICAgICAgIC8vIGh0dHA6Ly93d3cucmVndWxhci1leHByZXNzaW9ucy5pbmZvL2VtYWlsLmh0bWwKICAgICAgICAvKioKICAgICAgICAgKiBDaGVjayBpZiB0aGUgdmFsdWUgbWF5IGlzIGFuIGVtYWlsIGFkZHJlc3MuCiAgICAgICAgICoKICAgICAgICAgKiBUaGlzIGNvbnN0cmFpbnQgcmVxdWlyZXMgdGhhdCB0aGUgdmFsdWUgaXMgb24gYSBmb3JtIHRoYXQgbWF0Y2hlcyBtb3N0IGNvbW1vbiBmb3JtcyBvZiBlbWFpbCBhZGRyZXNzLgogICAgICAgICAqIEl0IGlzIHF1aXRlIHJlbGF4ZWQsIGFuZCBtYXkgYWNjZXB0IHZhbHVlcyB0aGF0IHRydWx5IGFyZSBub3QgZW1haWwgYWRkcmVzcy4KICAgICAgICAgKiBIb3dldmVyLCBpdCBzaG91bGQgZmFpbCBvbiBtb3N0IGludmFsaWQgYWRkcmVzc2VzLgogICAgICAgICAqIElmIHRoZSBjb25zdHJhaW50IGlzIG5vdCBmdWxsZmlsbGVkLCBpdCB3aWxsIHRocm93IGFuIGVycm9yLgogICAgICAgICAqCiAgICAgICAgICogQG1ldGhvZAogICAgICAgICAqIEBuYW1lIENoZWNrT2JqZWN0SW5zdGFuY2UuZW1haWwKICAgICAgICAgKiBAc3ludGF4IENoZWNrT2JqZWN0SW5zdGFuY2UuZW1haWw7CiAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBDaGVja09iamVjdCBpbnN0YW5jZSBzdWl0YWJsZSBmb3IgY2hhaW5pbmcgY29uc3RyYWludHMKICAgICAgICAgKiBAZXhhbXBsZQogICAgICAgICAqIFZhbHVlQ2hlY2sucmVxdWlyZVRoYXQoICJmb28iLCBmb28gKS53aXRoLnR5cGUoICJzdHJpbmciICkuaXMuYW4uZW1haWwuYWRkcmVzcwogICAgICAgICAqLwogICAgICAgIHRoYXQuX19kZWZpbmVHZXR0ZXJfXyggImVtYWlsIiwgZnVuY3Rpb24oICkgewogICAgICAgICAgICAgICAgLy8gSGFjayB0byBmaXggdGhlIGhlbHAgc3lzdGVtCiAgICAgICAgICAgICAgICBpZiAoIG5hbWUgPT09IHVuZGVmaW5lZCApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fX2xvb2t1cEdldHRlcl9fKCAiZW1haWwiICk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnRhaW4oIC9eW15AXStAW15AXStcLlx3ezIsfSQvICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gKTsKCgogICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgLy8gQ2hlY2sgaWYgaXQgbG9va3MgbGlrZSBhbiB1cmwuCiAgICAgICAgLyoqCiAgICAgICAgICogQ2hlY2sgaWYgdGhlIHZhbHVlIG1heSBpcyBhbiB1cmwgYWRkcmVzcwogICAgICAgICAqCiAgICAgICAgICogVGhpcyBjb25zdHJhaW50IHJlcXVpcmVzIHRoYXQgdGhlIHZhbHVlIGlzIG9uIGEgZm9ybSB0aGF0IG1hdGNoZXMgbW9zdCBjb21tb24gZm9ybXMgb2YgdXJsIGFkZHJlc3MuCiAgICAgICAgICogSXQgaXMgcXVpdGUgcmVsYXhlZCwgYW5kIG1heSBhY2NlcHQgdmFsdWVzIHRoYXQgdHJ1bHkgYXJlIG5vdCB1cmwgYWRkcmVzcy4KICAgICAgICAgKiBIb3dldmVyLCBpdCBzaG91bGQgZmFpbCBvbiBtb3N0IGludmFsaWQgYWRkcmVzc2VzLgogICAgICAgICAqIElmIHRoZSBjb25zdHJhaW50IGlzIG5vdCBmdWxsZmlsbGVkLCBpdCB3aWxsIHRocm93IGFuIGVycm9yLgogICAgICAgICAqCiAgICAgICAgICogQG1ldGhvZAogICAgICAgICAqIEBuYW1lIENoZWNrT2JqZWN0SW5zdGFuY2UudXJsCiAgICAgICAgICogQHN5bnRheCBDaGVja09iamVjdEluc3RhbmNlLnVybDsKICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IENoZWNrT2JqZWN0IGluc3RhbmNlIHN1aXRhYmxlIGZvciBjaGFpbmluZyBjb25zdHJhaW50cwogICAgICAgICAqIEBleGFtcGxlCiAgICAgICAgICogVmFsdWVDaGVjay5yZXF1aXJlVGhhdCggImZvbyIsIGZvbyApLndpdGgudHlwZSggInN0cmluZyIgKS5pcy5hbi51cmwKICAgICAgICAgKi8KICAgICAgICB0aGF0Ll9fZGVmaW5lR2V0dGVyX18oICJ1cmwiLCBmdW5jdGlvbiggKSB7CiAgICAgICAgICAgICAgICAvLyBIYWNrIHRvIGZpeCB0aGUgaGVscCBzeXN0ZW0JCQkgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoIG5hbWUgPT09IHVuZGVmaW5lZCApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fX2xvb2t1cEdldHRlcl9fKCAidXJsIiApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb250YWluKCAvXihbXjpcL10rOlwvXC8pPyhbXjpcL10rKSg6XGQrKT8oXC8uKik/JC8gKTsKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIHByb3RvY29sICAgICAgIGhvc3QgICAgICBwb3J0ICAgcGF0aCAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSApOwoKCgogICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgLy8gVmFyaW91cyBjb21wYXJpc29uIG9wZXJhdG9ycwoKICAgICAgICAvKioKICAgICAgICAgKiBDaGVjayBpZiB0aGUgdmFsdWUgaXMgPSBhIHNwZWNpZmljIHZhbHVlLgogICAgICAgICAqIAogICAgICAgICAqIFRoaXMgY29uc3RyYWludCByZXF1aXJlcyB0aGF0IHRoZSB2YWx1ZSBpcyBlcXVhbCB0byB0aGUgdmFsdWUgcGFzc2VkIGFzCiAgICAgICAgICogcGFyYW1ldGVyIHRvIHRoZSBjb25zdHJhaW50LiBJZiB0aGUgY29uc3RyYWludCBpcyBub3QgZnVsbGZpbGxlZCwgaXQKICAgICAgICAgKiB3aWxsIHRocm93IGFuIGVycm9yLiAKICAgICAgICAgKiAKICAgICAgICAgKiBAdHlwZSB7Y2hlY2t9CiAgICAgICAgICogQHN5bnRheCBDaGVja09iamVjdEluc3RhbmNlLmVxdWFsVG8oIHZhbHVlICk7CiAgICAgICAgICogQHBhcmFtIHtBbnl9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjayB0aGUgZW5jYXBzdWxhdGVkIHZhbHVlIGFnYWluc3QKICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IENoZWNrT2JqZWN0IGluc3RhbmNlIHN1aXRhYmxlIGZvciBjaGFpbmluZyBjb25zdHJhaW50cwogICAgICAgICAqIEBleGFtcGxlIFZhbHVlQ2hlY2suY2hlY2tUaGF0KCAiZm9vIiwgZm9vICkuaXMuZGVmaW5lZC53aXRoLnR5cGUoICJudW1iZXIiICkuYW5kLnZhbHVlLnRoYXQuaXMuZXF1YWxUbyggNDIgKTsKICAgICAgICAgKiAgIFZhbHVlQ2hlY2suY2hlY2soICJmb28iLCBmb28gKS50eXBlKCAic3RyaW5nIiApLmVxdWFsVG8oICJrYW5vbmtvbmdlIiApOwogICAgICAgICAqIEBuYW1lIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QuZXF1YWxUbwogICAgICAgICAqIEBtZXRob2QKICAgICAgICAgKi8KICAgICAgICB0aGF0LmVxdWFsVG8gPSBmdW5jdGlvbiggdmFsdWUgKSB7CiAgICAgICAgICAgIGNoZWNrdGhyb3dOZWVkMUFyZ0Vycm9yKCAiZXF1YWxUbyIsIGFyZ3VtZW50cy5sZW5ndGggKTsKICAgICAgICAgICAgcmV0dXJuIGNvbXBhcmUoIG9wZXJhdG9yLmVxdWFsaXR5LCB2YWx1ZSApOwogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrIGlmIHRoZSB2YWx1ZSBpcyAhPSBhIHNwZWNpZmljIHZhbHVlLgogICAgICAgICAqIAogICAgICAgICAqIFRoaXMgY29uc3RyYWludCByZXF1aXJlcyB0aGF0IHRoZSB2YWx1ZSBpcyBub3QgZXF1YWwgdG8gdGhlIHZhbHVlCiAgICAgICAgICogcGFzc2VkIGFzIHBhcmFtZXRlciB0byB0aGUgY29uc3RyYWludC4gSWYgdGhlIGNvbnN0cmFpbnQgaXMgbm90CiAgICAgICAgICogZnVsbGZpbGxlZCwgaXQgd2lsbCB0aHJvdyBhbiBlcnJvci4gCiAgICAgICAgICogCiAgICAgICAgICogQHR5cGUge2NoZWNrfQogICAgICAgICAqIEBzeW50YXggQ2hlY2tPYmplY3RJbnN0YW5jZS51bmVxdWFsVG8oIHZhbHVlICk7CiAgICAgICAgICogQHBhcmFtIHtBbnl9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjayB0aGUgZW5jYXBzdWxhdGVkIHZhbHVlIGFnYWluc3QKICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IENoZWNrT2JqZWN0IGluc3RhbmNlIHN1aXRhYmxlIGZvciBjaGFpbmluZyBjb25zdHJhaW50cwogICAgICAgICAqIEBleGFtcGxlIFZhbHVlQ2hlY2suY2hlY2tUaGF0KCAiZm9vIiwgZm9vICkuaXMuZGVmaW5lZC53aXRoLnR5cGUoICJudW1iZXIiICkuYW5kLnZhbHVlLnRoYXQuaXMudW5lcXVhbFRvKCA0MiApOwogICAgICAgICAqICAgVmFsdWVDaGVjay5jaGVjayggImZvbyIsIGZvbyApLnR5cGUoICJzdHJpbmciICkudW5lcXVhbFRvKCAia2Fub25rb25nZSIgKTsKICAgICAgICAgKiBAbmFtZSBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0LnVuZXF1YWxUbwogICAgICAgICAqIEBtZXRob2QKICAgICAgICAgKi8KICAgICAgICB0aGF0LnVuZXF1YWxUbyA9IGZ1bmN0aW9uKCB2YWx1ZSApIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubm90LmVxdWFsVG8oIHZhbHVlICk7CiAgICAgICAgfTsKCiAgICAgICAgLyoqCiAgICAgICAgICogQ2hlY2sgaWYgdGhlIHZhbHVlIGlzID4gdGhhbiBhIHNwZWNpZmljIHZhbHVlLgogICAgICAgICAqIAogICAgICAgICAqIFRoaXMgY29uc3RyYWludCByZXF1aXJlcyB0aGF0IHRoZSB2YWx1ZSBpcyBncmVhdGVyIHRoYW4gdGhlIHZhbHVlCiAgICAgICAgICogcGFzc2VkIGFzIHBhcmFtZXRlciB0byB0aGUgY29uc3RyYWludC4gSWYgdGhlIGNvbnN0cmFpbnQgaXMgbm90CiAgICAgICAgICogZnVsbGZpbGxlZCwgaXQgd2lsbCB0aHJvdyBhbiBlcnJvci4gCiAgICAgICAgICogCiAgICAgICAgICogQHR5cGUge2NoZWNrfQogICAgICAgICAqIEBzeW50YXggQ2hlY2tPYmplY3RJbnN0YW5jZS5ncmVhdGVyVGhhbiggbWluVmFsdWUgKTsKICAgICAgICAgKiBAcGFyYW0ge0FueX0gbWluVmFsdWUgVGhlIG1pbmltdW0gdmFsdWUgb2YgdGhlIGVuY2Fwc3VsYXRlZCB2YWx1ZQogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2hlY2tPYmplY3QgaW5zdGFuY2Ugc3VpdGFibGUgZm9yIGNoYWluaW5nIGNvbnN0cmFpbnRzCiAgICAgICAgICogQGV4YW1wbGUgVmFsdWVDaGVjay5jaGVja1RoYXQoICJmb28iLCBmb28gKS5pcy5kZWZpbmVkLndpdGgudHlwZSggIm51bWJlciIgKS5hbmQudmFsdWUuZ3JlYXRlclRoYW4oIDEwICk7CiAgICAgICAgICogICBWYWx1ZUNoZWNrLmNoZWNrKCAiZm9vIiwgZm9vICkuZ3JlYXRlclRoYW4oICJrYW5vbmtvbmdlIiApOwogICAgICAgICAqIEBuYW1lIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QuZ3JlYXRlclRoYW4KICAgICAgICAgKiBAbWV0aG9kCiAgICAgICAgICovCiAgICAgICAgdGhhdC5ncmVhdGVyVGhhbiA9IGZ1bmN0aW9uKCBtaW5WYWx1ZSApIHsKICAgICAgICAgICAgY2hlY2t0aHJvd05lZWQxQXJnRXJyb3IoICJncmVhdGVyVGhhbiIsIGFyZ3VtZW50cy5sZW5ndGggKTsKICAgICAgICAgICAgcmV0dXJuIGNvbXBhcmUoIG9wZXJhdG9yLmdyZWF0ZXJ0aGFuLCBtaW5WYWx1ZSApOwogICAgICAgIH07CgoKICAgICAgICAvKioKICAgICAgICAgKiBDaGVjayBpZiB0aGUgdmFsdWUgaXMgPD0gYSBzcGVjaWZpYyB2YWx1ZS4KICAgICAgICAgKiAKICAgICAgICAgKiBUaGlzIGNvbnN0cmFpbnQgcmVxdWlyZXMgdGhhdCB0aGUgdmFsdWUgaXMgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIHRoZQogICAgICAgICAqIHZhbHVlIHBhc3NlZCBhcyBwYXJhbWV0ZXIgdG8gdGhlIGNvbnN0cmFpbnQuIElmIHRoZSBjb25zdHJhaW50IGlzIG5vdAogICAgICAgICAqIGZ1bGxmaWxsZWQsIGl0IHdpbGwgdGhyb3cgYW4gZXJyb3IuIAogICAgICAgICAqIAogICAgICAgICAqIEB0eXBlIHtjaGVja30KICAgICAgICAgKiBAc3ludGF4IENoZWNrT2JqZWN0SW5zdGFuY2UubGVzc0VxdWFsVGhhbiggbWF4VmFsdWUgKTsKICAgICAgICAgKiBAcGFyYW0ge0FueX0gbWF4VmFsdWUgVGhlIG1heGltdW0gdmFsdWUgb2YgdGhlIGVuY2Fwc3VsYXRlZCB2YWx1ZQogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2hlY2tPYmplY3QgaW5zdGFuY2Ugc3VpdGFibGUgZm9yIGNoYWluaW5nIGNvbnN0cmFpbnRzCiAgICAgICAgICogQGV4YW1wbGUgVmFsdWVDaGVjay5jaGVja1RoYXQoICJmb28iLCBmb28gKS5pcy5kZWZpbmVkLndpdGgudHlwZSggIm51bWJlciIgKS5hbmQudmFsdWUubGVzc0VxdWFsVGhhbiggLTEwICk7CiAgICAgICAgICogICBWYWx1ZUNoZWNrLmNoZWNrKCAiZm9vIiwgZm9vICkuaXMuZGVmaW5lZC5sZXNzRXF1YWxUaGFuKCAia2Fub25rb25nZSIgKTsKICAgICAgICAgKiBAbmFtZSBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0Lmxlc3NFcXVhbFRoYW4KICAgICAgICAgKiBAbWV0aG9kCiAgICAgICAgICovCiAgICAgICAgdGhhdC5sZXNzRXF1YWxUaGFuID0gZnVuY3Rpb24oIG1heFZhbHVlICkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ub3QuZ3JlYXRlclRoYW4oIG1heFZhbHVlICk7CiAgICAgICAgfTsKCiAgICAgICAgLyoqCiAgICAgICAgICogQ2hlY2sgaWYgdGhlIHZhbHVlIGlzIDwgdGhhbiBhIHNwZWNpZmljIHZhbHVlLgogICAgICAgICAqIAogICAgICAgICAqIFRoaXMgY29uc3RyYWludCByZXF1aXJlcyB0aGF0IHRoZSB2YWx1ZSBpcyBsZXNzIHRoYW4gdGhlIHZhbHVlIHBhc3NlZAogICAgICAgICAqIGFzIHBhcmFtZXRlciB0byB0aGUgY29uc3RyYWludC4gSWYgdGhlIGNvbnN0cmFpbnQgaXMgbm90IGZ1bGxmaWxsZWQsIGl0CiAgICAgICAgICogd2lsbCB0aHJvdyBhbiBlcnJvci4gCiAgICAgICAgICogCiAgICAgICAgICogQHR5cGUge2NoZWNrfQogICAgICAgICAqIEBzeW50YXggQ2hlY2tPYmplY3RJbnN0YW5jZS5sZXNzVGhhbiggbWF4VmFsdWUgKTsKICAgICAgICAgKiBAcGFyYW0ge0FueX0gbWF4VmFsdWUgVGhlIG1heGltdW0gdmFsdWUgb2YgdGhlIGVuY2Fwc3VsYXRlZCB2YWx1ZQogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2hlY2tPYmplY3QgaW5zdGFuY2Ugc3VpdGFibGUgZm9yIGNoYWluaW5nIGNvbnN0cmFpbnRzCiAgICAgICAgICogQGV4YW1wbGUgVmFsdWVDaGVjay5jaGVja1RoYXQoICJmb28iLCBmb28gKS5pcy5kZWZpbmVkLndpdGgudHlwZSggIm51bWJlciIgKS5hbmQudmFsdWUubGVzc1RoYW4oIC0xMCApOwogICAgICAgICAqICAgVmFsdWVDaGVjay5jaGVjayggImZvbyIsIGZvbyApLnR5cGUoICJzdHJpbmciICkubGVzc1RoYW4oICJrYW5vbmtvbmdlIiApOwogICAgICAgICAqIEBuYW1lIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QubGVzc1RoYW4KICAgICAgICAgKiBAbWV0aG9kCiAgICAgICAgICovCiAgICAgICAgdGhhdC5sZXNzVGhhbiA9IGZ1bmN0aW9uKCBtYXhWYWx1ZSApIHsKICAgICAgICAgICAgY2hlY2t0aHJvd05lZWQxQXJnRXJyb3IoICJsZXNzVGhhbiIsIGFyZ3VtZW50cy5sZW5ndGggKTsKICAgICAgICAgICAgcmV0dXJuIGNvbXBhcmUoIG9wZXJhdG9yLmxlc3N0aGFuLCBtYXhWYWx1ZSApOwogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrIGlmIHRoZSB2YWx1ZSBpcyA+PSBhIHNwZWNpZmljIHZhbHVlLgogICAgICAgICAqIAogICAgICAgICAqIFRoaXMgY29uc3RyYWludCByZXF1aXJlcyB0aGF0IHRoZSB2YWx1ZSBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gdGhlCiAgICAgICAgICogdmFsdWUgcGFzc2VkIGFzIHBhcmFtZXRlciB0byB0aGUgY29uc3RyYWludC4gSWYgdGhlIGNvbnN0cmFpbnQgaXMgbm90CiAgICAgICAgICogZnVsbGZpbGxlZCwgaXQgd2lsbCB0aHJvdyBhbiBlcnJvci4gCiAgICAgICAgICogCiAgICAgICAgICogQHR5cGUge2NoZWNrfQogICAgICAgICAqIEBzeW50YXggQ2hlY2tPYmplY3RJbnN0YW5jZS5ncmVhdGVyRXF1YWxUaGFuKCBtaW5WYWx1ZSApOwogICAgICAgICAqIEBwYXJhbSB7QW55fSBtaW5WYWx1ZSBUaGUgbWluaW11bSB2YWx1ZSBvZiB0aGUgZW5jYXBzdWxhdGVkIHZhbHVlCiAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBDaGVja09iamVjdCBpbnN0YW5jZSBzdWl0YWJsZSBmb3IgY2hhaW5pbmcgY29uc3RyYWludHMKICAgICAgICAgKiBAZXhhbXBsZSBWYWx1ZUNoZWNrLmNoZWNrVGhhdCggImZvbyIsIGZvbyApLmlzLmRlZmluZWQud2l0aC50eXBlKCAibnVtYmVyIiApLmFuZC52YWx1ZS5ncmVhdGVyRXF1YWxUaGFuKCAxMCApOwogICAgICAgICAqICAgVmFsdWVDaGVjay5jaGVjayggImZvbyIsIGZvbyApLmdyZWF0ZXJFcXVhbFRoYW4oICJrYW5vbmtvbmdlIiApOwogICAgICAgICAqIEBuYW1lIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QuZ3JlYXRlckVxdWFsVGhhbgogICAgICAgICAqIEBtZXRob2QKICAgICAgICAgKi8KICAgICAgICB0aGF0LmdyZWF0ZXJFcXVhbFRoYW4gPSBmdW5jdGlvbiggbWluVmFsdWUgKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm5vdC5sZXNzVGhhbiggbWluVmFsdWUgKTsKICAgICAgICB9OwoKICAgICAgICAvKioKICAgICAgICAgKiBDaGVjayBpZiB0aGUgdmFsdWUgaXMgaW5zaWRlIGEgc3BlY2lmaWMgaW50ZXJ2YWwuCiAgICAgICAgICogCiAgICAgICAgICogVGhpcyBjb25zdHJhaW50IHJlcXVpcmVzIHRoYXQgdGhlIHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB0aGUKICAgICAgICAgKiBtaW5WYWx1ZSBwYXNzZWQgYW5kIGxlc3MgdGhhbiBvciBlcXVhbCB0byB0aGUgbWF4VmFsdWUgcGFzc2VkIGFzCiAgICAgICAgICogcGFyYW1ldGVyIHRvIHRoZSBjb25zdHJhaW50LiBJZiB0aGUgY29uc3RyYWludCBpcyBub3QgZnVsbGZpbGxlZCwgaXQKICAgICAgICAgKiB3aWxsIHRocm93IGFuIGVycm9yLiBOb3RlLCB0aGF0IHRoaXMgY29uc3RyYWludCBpcyBpbmNsdXNpdmUsIGV2ZW4gZm9yCiAgICAgICAgICogbm90LiBUaGF0IGlzLCBub3QuaW5zaWRlIHdpbGwgcmV0dXJuIHRoZSBzYW1lIHJlc3VsdCBhcyBvdXRzaWRlLiAKICAgICAgICAgKiAKICAgICAgICAgKiBAdHlwZSB7Y2hlY2t9CiAgICAgICAgICogQHN5bnRheCBDaGVja09iamVjdEluc3RhbmNlLmluc2lkZSggbWluVmFsdWUsIG1heFZhbHVlICk7CiAgICAgICAgICogQHBhcmFtIHtBbnl9IG1pblZhbHVlIFRoZSBtaW5pbXVtIHZhbHVlIG9mIHRoZSBlbmNhcHN1bGF0ZWQgdmFsdWUgKGluY2x1c2l2ZSkKICAgICAgICAgKiBAcGFyYW0ge0FueX0gbWF4VmFsdWUgVGhlIG1heGltdW0gdmFsdWUgb2YgdGhlIGVuY2Fwc3VsYXRlZCB2YWx1ZSAoaW5jbHVzaXZlKQogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2hlY2tPYmplY3QgaW5zdGFuY2Ugc3VpdGFibGUgZm9yIGNoYWluaW5nIGNvbnN0cmFpbnRzCiAgICAgICAgICogQGV4YW1wbGUgVmFsdWVDaGVjay5jaGVja1RoYXQoICJmb28iLCBmb28gKS5pcy5kZWZpbmVkLndpdGgudHlwZSggIm51bWJlciIgKS5hbmQudmFsdWUuaW5zaWRlKCAxMCwgMjAgKTsKICAgICAgICAgKiAgICAgVmFsdWVDaGVjay5jaGVjayggImZvbyIsIGZvbyApLmluc2lkZSggImthbm9ua29uZ2UiLCAibGVvcGFyZCIgKTsKICAgICAgICAgKiBAbmFtZSBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0Lmluc2lkZQogICAgICAgICAqIEBtZXRob2QKICAgICAgICAgKi8KICAgICAgICB0aGF0Lmluc2lkZSA9IGZ1bmN0aW9uKCBtaW5WYWx1ZSwgbWF4VmFsdWUgKSB7CiAgICAgICAgICAgIGNoZWNrdGhyb3dOZWVkMkFyZ3NFcnJvciggImluUmFuZ2UiLCBhcmd1bWVudHMubGVuZ3RoICk7CiAgICAgICAgICAgIGlmICggIW5vdGZsYWcgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ncmVhdGVyRXF1YWxUaGFuKCBtaW5WYWx1ZSApLmxlc3NFcXVhbFRoYW4oIG1heFZhbHVlICk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBOb3QgY2hhbmdlcyB0aGlzIHRvIGFuIG9yLiBDaGVjayBpZiB3ZSBhcmUgb3V0c2lkZS4KICAgICAgICAgICAgICAgIG5vdGZsYWcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhpcyBzdWNjZWRzLCBpdCB3YXMgb3V0c2lkZSB0b3AuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3JlYXRlclRoYW4oIG1heFZhbHVlICk7CiAgICAgICAgICAgICAgICB9IGNhdGNoICggZXJyb3IxICkgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRyeSBpZiBvdXRzaWRlIGJvdHRvbS4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGVzc1RoYW4oIG1pblZhbHVlICk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoIGVycm9yMiApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJvdmlkZSByZWFzb25hYmx5IGVycm9yIG1lc3NhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dFcnJvciggIlZhbHVlICciICsgbmFtZSArICInIDogJyIgKyB2YWx1ZSArICInIGlzIG5vdCBvdXRzaWRlIHJhbmdlICciICsgbWluVmFsdWUgKyAiJywgJyIgKyBtYXhWYWx1ZSArICInIiApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrIGlmIHRoZSB2YWx1ZSBpcyBub3QgaW5zaWRlIGEgc3BlY2lmaWMgaW50ZXJ2YWwuCiAgICAgICAgICogCiAgICAgICAgICogVGhpcyBjb25zdHJhaW50IHJlcXVpcmVzIHRoYXQgdGhlIHZhbHVlIGlzIGVpdGhlciBsZXNzIHRoYW4gdGhlCiAgICAgICAgICogbWluVmFsdWUgcGFzc2VkIG9yIGdyZWF0ZXIgdGhhbiB0aGUgdGhlIG1heFZhbHVlIHBhc3NlZCBhcyBwYXJhbWV0ZXIgdG8KICAgICAgICAgKiB0aGUgY29uc3RyYWludC4gSWYgdGhlIGNvbnN0cmFpbnQgaXMgbm90IGZ1bGxmaWxsZWQsIGl0IHdpbGwgdGhyb3cgYW4KICAgICAgICAgKiBlcnJvci4gTm90ZSwgdGhhdCBjYWxsaW5nIG91dHNpZGUoIGEsIGIgKSBpcyBzZW1hbnRpY2FsbHkgZXF1aXZhbGVudCB0bwogICAgICAgICAqIGNhbGxpbmcgbm90Lmluc2lkZSggYSwgYiApLiAKICAgICAgICAgKiAKICAgICAgICAgKiBAdHlwZSB7Y2hlY2t9CiAgICAgICAgICogQHN5bnRheCBDaGVja09iamVjdEluc3RhbmNlLm91dHNpZGUoIG1pblZhbHVlLCBtYXhWYWx1ZSApOwogICAgICAgICAqIEBwYXJhbSB7QW55fSBtaW5WYWx1ZSBUaGUgbWluaW11bSB2YWx1ZSBvZiB0aGUgaW50ZXJ2YWwgdGhhdCB0aGUgZW5jYXBzdWxhdGVkIHZhbHVlIG11c3Qgbm8gYmUgcGFydCBvZiAoaW5jbHVzaXZlKQogICAgICAgICAqIEBwYXJhbSB7QW55fSBtYXhWYWx1ZSBUaGUgbWF4aW11bSB2YWx1ZSBvZiB0aGUgaW50ZXJ2YWwgdGhhdCB0aGUgZW5jYXBzdWxhdGVkIHZhbHVlIG11c3Qgbm90IGJlIHBhcnQgb2YoaW5jbHVzaXZlKQogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2hlY2tPYmplY3QgaW5zdGFuY2Ugc3VpdGFibGUgZm9yIGNoYWluaW5nIGNvbnN0cmFpbnRzCiAgICAgICAgICogQGV4YW1wbGUgVmFsdWVDaGVjay5jaGVja1RoYXQoICJmb28iLCBmb28gKS5pcy5kZWZpbmVkLndpdGgudHlwZSggIm51bWJlciIgKS5hbmQudmFsdWUub3V0c2lkZSggMTAsIDIwICk7CiAgICAgICAgICogICAgIFZhbHVlQ2hlY2suY2hlY2soICJmb28iLCBmb28gKS5vdXRzaWRlKCAia2Fub25rb25nZSIsICJsZW9wYXJkIiApOwogICAgICAgICAqIEBuYW1lIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3Qub3V0c2lkZQogICAgICAgICAqIEBtZXRob2QKICAgICAgICAgKi8KICAgICAgICB0aGF0Lm91dHNpZGUgPSBmdW5jdGlvbiggbWluVmFsdWUsIG1heFZhbHVlICkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ub3QuaW5zaWRlKCBtaW5WYWx1ZSwgbWF4VmFsdWUgKTsKICAgICAgICB9OwoKCiAgICAgICAgLyoqCiAgICAgICAgICogQ2hlY2sgaWYgdGhlIHZhbHVlIGlzIGlzIG9uZSBvZiBzZXZlcmFsIHNwZWNpZmljIHZhbHVlcy4KICAgICAgICAgKiAKICAgICAgICAgKiBUaGlzIGNvbnN0cmFpbnQgcmVxdWlyZXMgdGhhdCB0aGUgdmFsdWUgaXMgZm91bmQgaW4gdGhlIGFycmF5IHBhc3NlZCBhcwogICAgICAgICAqIHBhcmFtZXRlciB0byB0aGUgY29uc3RyYWludC4gSWYgdGhlIGNvbnN0cmFpbnQgaXMgbm90IGZ1bGxmaWxsZWQsIGl0CiAgICAgICAgICogd2lsbCB0aHJvdyBhbiBlcnJvci4gCiAgICAgICAgICogCiAgICAgICAgICogQHR5cGUge2NoZWNrfQogICAgICAgICAqIEBzeW50YXggQ2hlY2tPYmplY3RJbnN0YW5jZS5vdXRzaWRlKCBsZWdhbFZhbHVlcyApOwogICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IGxlZ2FsVmFsdWVzIEFuIGFycmF5IG9mIGxlZ2FsIHZhbHVlcyBmb3IgdGhlIGVuY2Fwc3VsYXRlZCB2YWx1ZQogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2hlY2tPYmplY3QgaW5zdGFuY2Ugc3VpdGFibGUgZm9yIGNoYWluaW5nIGNvbnN0cmFpbnRzCiAgICAgICAgICogQGV4YW1wbGUgVmFsdWVDaGVjay5jaGVja1RoYXQoICJmb28iLCBmb28gKS5pcy5kZWZpbmVkLndpdGgudHlwZSggIm51bWJlciIgKS5hbmQudmFsdWUuaW4oIFsgMTAsIDE3LCAyMCwgNDIsIDQ1MCBdICk7CiAgICAgICAgICogICAgIFZhbHVlQ2hlY2suY2hlY2soICJmb28iLCBmb28gKS5pbihbICAia2Fub25rb25nZSIsICJzdXBlcmhlbHQiLCAic29mdHdhcmV1ZHZpa2xlciIgXSApOwogICAgICAgICAqIEBuYW1lIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QuaW4KICAgICAgICAgKiBAbWV0aG9kCiAgICAgICAgICovCiAgICAgICAgdGhhdC4gaW4gPSBmdW5jdGlvbiggbGVnYWxWYWx1ZXMgKSB7CiAgICAgICAgICAgIGNoZWNrdGhyb3dOZWVkMUFyZ0Vycm9yKCAiaW4iLCBhcmd1bWVudHMubGVuZ3RoICk7CiAgICAgICAgICAgIHZhciByZXMgPSAoIC0xICE9PSBsZWdhbFZhbHVlcy5pbmRleE9mKCB2YWx1ZSApICk7CiAgICAgICAgICAgIHZhciBub3RzdHJpbmcgPSAibm90ICI7CiAgICAgICAgICAgIGlmICggbm90ZmxhZyApIHsKICAgICAgICAgICAgICAgIHJlcyA9ICFyZXM7CiAgICAgICAgICAgICAgICBub3RzdHJpbmcgPSAiIjsKICAgICAgICAgICAgICAgIG5vdGZsYWcgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoICFyZXMgKSB7CiAgICAgICAgICAgICAgICB0aHJvd0Vycm9yKCAiVmFsdWUgb2YgJyIgKyBuYW1lICsgIicgOiAnIiArIHZhbHVlICsgIicgaXMgIiArIG5vdHN0cmluZyArICJpbiAiICsgbGVnYWxWYWx1ZXMgKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgLy8gRG9jdW1lbnQgaW5zdGFuY2UKCiAgICAgICAgLy8gUmV0dXJuIGl0CiAgICAgICAgcmV0dXJuIHRoYXQ7CiAgICB9OwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vIFRvIG1ha2UgYXZhaWxhYmxlIGZvciBkb2N1bWVudGF0aW9uLCBhIGR1bW15IG9iamVjdAogICAgLy8gVGhpcyBrZWVwcyBuYW1lID09PSB1bmRlZmluZWQsIHdoaWNoIGlzIE5PVCBhbGxvd2VkLCBidXQgaGVyZSB3ZSB1c2UgaXQgdG8gY2hhbmdlIHRoZSBiZWhhdmlvdXIgdG8gYWxsb3cgb25saW5lIGhlbHAuCiAgICAvLyBUcmlja3ksIHRyaWNreSBiZWhhdmlvdXIuLi4gaW5kZWVkIDotKSAoV2lsbCBwcm9iYWJseSBiaXRlIG1lIHNvbWV0aW1lIGluIHRoZSBmdXR1cmUpLgogICAgLyoqCiAgICAgKiBPYmplY3QgdGhhdCBlbmNhcHN1bGF0ZXMgYSB2YWx1ZSwgYW5kIGFsbG93IHRvIHNwZWNpZnkgY29uc3RyYWludHMuCiAgICAgKiAKICAgICAqIEluc3RhbmNlcyBvZiB0aGlzIGtpbmQgb2Ygb2JqZWN0IGhvbGRzIGEgdmFsdWUsIHBhc3NlZCB0byBpdCBkdXJpbmcKICAgICAqIGNvbnN0cnVjdGlvbiwgYW5kIHByb3ZpZGVzIG1ldGhvZHMgdG8gY2hlY2sgY29uc3RyYWludHMgb24gaXQuIEl0IGlzCiAgICAgKiBkZXNpZ25lZCB0byBwcm92aWRlIGFuIGVhc3kgbWVjaGFuaXNtIHRvIGNoZWNrIGUuZy4gdmFsdWVzIHBhc3NlZCB0byBhCiAgICAgKiBmdW5jdGlvbiBvciBzaW1pbGFyLiBZb3Ugc3BlZmljeSBjb25zdHJhaW50cyBieSBjYWxsaW5nIG1ldGhvZHMgb24gdGhlCiAgICAgKiBvYmplY3QgdGhhdCBlbmNhcHN1bGF0ZXMgdGhlIHZhbHVlLiBBbGwgbWV0aG9kcyB0aHJvdyBpZiB0aGUgY29uc3RyYWludAogICAgICogaXMgbm90IGZ1bGxmaWxsZWQsIGFuZCByZXR1cm4gYW4gaW5zdGFuc2Ugb2YgdGhpcyBvYmplY3Qgb3RoZXJ3aXNlLAogICAgICogZW5hYmxpbmcgY2hhaW5pbmcgdGhlIGNvbnN0cmFpbnRzIGFyYml0cmFyZWx5LiBDb25zdHJ1Y3QgaW5zdGFuY2VzIG9mCiAgICAgKiB0aGlzIG9iamVjdCwgYnkgY2FsbGluZyBWYWx1ZUNoZWNrLmNoZWNrKiBtZXRob2RzLiAKICAgICAqCiAgICAgKiAqKlRPRE86KiogTUJEIFNob3VsZCBmaXggdGhlIGNvbnN0cmFpbnRzIGRvY3VtZW50YXRpb24gZm9yIHRoaXMgbW9kdWxlLgogICAgICogCiAgICAgKiBAdHlwZSB7T2JqZWN0fQogICAgICogQGV4YW1wbGUgVmFsdWVDaGVjay5jaGVja1RoYXQoICJmb28iLCBmb28gKS5pcy5kZWZpbmVkLmFuZC5oYXMudHlwZSggInN0cmluZyIgKS5hbmQuaXMubm90LmVxdWFsVG8oICIiICk7CiAgICAgKiBAbmFtZSBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0CiAgICAgKiBAbmFtZXNwYWNlICovCiAgICB0aGF0LkNoZWNrT2JqZWN0ID0gY2hlY2tPYmplY3QoIHVuZGVmaW5lZCwgdW5kZWZpbmVkICk7CgoKICAgIC8qKiBDaGVjayBhIHNwZWNpZmljIHBhcmFtZXRlci92YXJpYWJsZSwgZXZlbiBmb3IgdW5kZWZpbmVkLiAKICAgKgogICAqIFRoaXMgbWV0aG9kIGNvbnN0cnVjdHMgYW4gaW5zdGFuY2Ugb2YgYW4gQ2hlY2tPYmplY3Qgb2JqZWN0LCB3aGljaAogICAqIGNhbiBiZSB1c2VkIHRvIGNoZWNrIGNvbnN0cmFpbnRzIG9uIHRoZSBwYXJhbWV0ZXIvdmFyaWFibGUgcGFzc2VkLiBUaGUKICAgKiBjb25zdHJ1Y3RvciBkaWZmZXJzIGZyb20gdGhlIG90aGVyIGNoZWNrXCogbWV0aG9kcyBpbiB0aGF0IG5vCiAgICogZGVmaW5lZC91bmRlZmluZWQgY2hlY2sgaXMgcGVyZm9ybWVkLiBUaGlzIGFsbG93IGNoZWNraW5nIGUuZy4gdGhhdCB0aGUKICAgKiB2YWx1ZSBpcyB1bmRlZmluZWQgb3Igc29tZSBzcGVjaWZpYyB2YWx1ZS4gVGhlIGludGVudGlvbiBpcyB0aGF0IHlvdQogICAqIGNoYWluIGFkZGl0aW9uYWwgY29uc3RyYWludHMuIFRoZSBzeW50YXggaXMgcXVpdGUgZmxleGlibGUgYW5kIGNhbiBiZQogICAqIHdyaXR0ZW4gdmVyeSByZWFkYWJsZS4gCiAgICogIAogICAqIEBtZXRob2QKICAgKiBAZXhhbXBsZSAKLy8gVGhlIGV4YW1wbGVzIGJlbG93IGlsbHVzdHJhdGVzIHNvbWUgb2YgdGhlIGNoZWNrcyB0aGF0IGlzIHBvc3NpYmx5IHdpdGggdGhpcyBtZXRob2QKVmFsdWVDaGVjay5jaGVja1ZhbHVlKCAiZm9vIiwgZm9vICkuaXMuZGVmaW5lZC5hbmQuaGFzLnR5cGUoICJzdHJpbmciICkuYW5kLnZhbHVlLnRoYXQuaXMubm90LmVxdWFsVG8oICIiICk7ClZhbHVlQ2hlY2suY2hlY2tWYWx1ZSggImZvbyIsIGZvbyApLmlzLmluLiggWyB1bmRlZmluZWQsICJiaWJsaW90ZWtkayIsICJwYWxsZXNnYXZlYm9kIiBdICk7CiAgICogQHN5bnRheCBWYWx1ZUNoZWNrLmNoZWNrVmFsdWUoIHBhcmFtbmFtZSwgcGFyYW12YWx1ZSApOwogICAqIEBwYXJhbSB7c3RyaW5nfSBwYXJhbW5hbWUgVGhlIG5hbWUgb2YgdGhlIHBhcmFtZXRlci92YXJpYWJsZSB0byBjaGVjay4gVXNlZCB0byBjb25zdHJ1Y3QgbWVhbmluZ2Z1bCBlcnJvciByZXBvcnRzCiAgICogQHBhcmFtIHtvYmplY3R9IHBhcmFtdmFsdWUgVGhlIHZhbHVlIG9mIHRoZSBwYXJhbWV0ZXIvdmFyaWFibGUgdG8gY2hlY2suCiAgICogQHJldHVybiB7VmFsdWVDaGVjay5DaGVja09iamVjdH0gQSBDaGVja09iamVjdCBpbnN0YW5jZSwgdGhhdCBjYW4gYmUgdXNlZCB0byBjaGVjayB0aGUgdmFsdWUgZm9yIG1vcmUgY29uc3RyYWludHMKICAgKiBAbmFtZSBWYWx1ZUNoZWNrLmNoZWNrVmFsdWUKICAgKi8KICAgIHRoYXQuY2hlY2tWYWx1ZSA9IGZ1bmN0aW9uKCBwYXJhbW5hbWUsIHBhcmFtdmFsdWUgKSB7CiAgICAgICAgaWYgKCBhcmd1bWVudHMubGVuZ3RoICE9IDIgKSB7CiAgICAgICAgICAgIHRocm93RXJyb3IoICJDaGVja1ZhbHVlIG5lZWRzIGV4YWN0bHkgMiBhcmd1bWVudHMiICk7CiAgICAgICAgfQogICAgICAgIC8vIEFidXNlIGEgdGVtcG9yYXJ5IG9iamVjdCwgdG8gY2hlY2sgcGFyYW1uYW1lCiAgICAgICAgKCBmdW5jdGlvbiggKSB7CiAgICAgICAgICAgICAgICB2YXIgdG1wID0gY2hlY2tPYmplY3QoICJwYXJhbW5hbWUiLCBwYXJhbW5hbWUgKTsKICAgICAgICAgICAgICAgIHRtcC5kZWZpbmVkLnR5cGUoICJzdHJpbmciICkudW5lcXVhbFRvKCAiIiApOwogICAgICAgICAgICB9KCApICk7CiAgICAgICAgLy8gTm93IGNvbnN0cnVjdCB0aGUgcmVhbCBvYmplY3QgYW5kIHJldHVybiBpdC4KICAgICAgICByZXR1cm4gY2hlY2tPYmplY3QoIHBhcmFtbmFtZSwgcGFyYW12YWx1ZSApOwogICAgfTsKCgogICAgLyoqCiAgICAgKiBDaGVjayBhIHNwZWNpZmljIHBhcmFtZXRlci92YXJpYWJsZSwgd2l0aCBpbXBsaWNpdCBjaGVjayBmb3IgdW5kZWZpbmVkLgogICAgICogCiAgICAgKiBUaGlzIGNvbnN0cnVjdG9yIGNvbnN0cnVjdHMgYW4gaW5zdGFuY2Ugb2YgYW4gQ2hlY2tPYmplY3Qgb2JqZWN0LCB3aGljaAogICAgICogY2FuIGJlIHVzZWQgdG8gY2hlY2sgY29uc3RyYWludHMgb24gdGhlIHBhcmFtZXRlci92YXJpYWJsZSBwYXNzZWQuIFRoZQogICAgICogZmlyc3QgY2hlY2sgaXMgaW1wbGljaXQ6IHRoZSB2YWx1ZSBtdXN0IG5vdCBiZSB1bmRlZmluZWQuIFRoZSBpbnRlbnRpb24KICAgICAqIGlzIHRoYXQgeW91IGNoYWluIGFkZGl0aW9uYWwgY29uc3RyYWludHMuIFRoZSBzeW50YXggaXMgcXVpdGUgZmxleGlibGUKICAgICAqIGFuZCBjYW4gYmUgd3JpdHRlbiB2ZXJ5IHJlYWRhYmxlLiBUaGUgdmFyaW91cyBmb3JtcyBkb2VzIHRoZSBzYW1lLCBhbmQKICAgICAqIHlvdSBhcmUgZnJlZSB0byBjaG9vc2Ugd2hpY2hldmVyIGJlc3Qgc3VpdHMgeW91ciBzdHlsZS4gCiAgICAgKgogICAgICogKipOb3RlOioqIFRoZSBmdW5jdGlvbnMgY2hlY2ssIGNoZWNrVGhhdCwgYW5kIHJlcXVpcmVUaGF0IGFyZSBhbGlhc2VzIGZvciB0aGUgc2FtZSBmdW5jdGlvbi4KICAgICAqIAogICAgICogQHN5bnRheCBWYWx1ZUNoZWNrLmNoZWNrKCBwYXJhbW5hbWUsIHBhcmFtdmFsdWUgKTsKICAgICAqICAgVmFsdWVDaGVjay5jaGVja1RoYXQoIHBhcmFtbmFtZSwgcGFyYW12YWx1ZSApOwogICAgICogICBWYWx1ZUNoZWNrLnJlcXVpcmVUaGF0KCBwYXJhbW5hbWUsIHBhcmFtdmFsdWUgKTsKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwYXJhbW5hbWUgVGhlIG5hbWUgb2YgdGhlIHBhcmFtZXRlci92YXJpYWJsZSB0byBjaGVjay4gVXNlZCB0byBjb25zdHJ1Y3QgbWVhbmluZ2Z1bCBlcnJvciByZXBvcnRzCiAgICAgKiBAcGFyYW0ge0FueX0gcGFyYW12YWx1ZSBUaGUgdmFsdWUgb2YgdGhlIHBhcmFtZXRlci92YXJpYWJsZSB0byBjaGVjay4KICAgICAqIEByZXR1cm4ge1ZhbHVlQ2hlY2suQ2hlY2tPYmplY3R9IEEgQ2hlY2tPYmplY3QgaW5zdGFuY2UsIHRoYXQgY2FuIGJlIHVzZWQgdG8gY2hlY2sgdGhlIHZhbHVlIGZvciBtb3JlIGNvbnN0cmFpbnRzCiAgICAgKiBAZXhhbXBsZSBUaGUgZXhhbXBsZXMgYmVsb3cgYXJlIHNlbWFudGljYWxseSBlcXVhbCwgYnV0IHRoZSBmaXJzdCBvbmUgaXMgbW9yZSBleHBsaWNpdCB0aGFuIHRoZSBzZWNvbmQuIFdoaWNoIG9uZSB0byBwcmVmZXIgaXMgYSBtYXR0ZXIgb2YgdGFzdGU6CiAgICAgKiAgIFZhbHVlQ2hlY2suY2hlY2tUaGF0KCAiZm9vIiwgZm9vICkuaGFzLnR5cGUoICJzdHJpbmciICkuYW5kLnRoYXQudmFsdWUuaXMubm90LmVxdWFsVG8oICIiICk7CiAgICAgKiAgIFZhbHVlQ2hlY2suY2hlY2soICJmb28iLCBmb28gKS50eXBlKCAic3RyaW5nIiApLnVuZXF1YWxUbyggIiIgKTsKICAgICAqICAgVmFsdWVDaGVjay5yZXF1aXJlVGhhdCggImZvbyIsIGZvbykudmFsdWUuaGFzLnR5cGUoICJzdHJpbmciICkuYW5kLmlzLm5vdC5lcXVhbFRvKCAiIiApOwogICAgICogQG5hbWUgVmFsdWVDaGVjay5jaGVjawogICAgICogQG1ldGhvZAogICAgICovCiAgICB0aGF0LmNoZWNrID0gZnVuY3Rpb24oIHBhcmFtbmFtZSwgcGFyYW12YWx1ZSApIHsKICAgICAgICBpZiAoIGFyZ3VtZW50cy5sZW5ndGggIT0gMiApIHsKICAgICAgICAgICAgdGhyb3dFcnJvciggIkNoZWNrIG5lZWRzIGV4YWN0bHkgMiBhcmd1bWVudHMiICk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmNoZWNrVmFsdWUoIHBhcmFtbmFtZSwgcGFyYW12YWx1ZSApLmRlZmluZWQ7CiAgICB9CiAgICAvLyBTZXQgdXAgc29tZSBzaG9ydEhhbmRzCiAgICB0aGF0LmNoZWNrVGhhdCA9IHRoYXQuY2hlY2s7CiAgICB0aGF0LnJlcXVpcmVUaGF0ID0gdGhhdC5jaGVjazsKCgogICAgLyoqCiAgICAgKiBDaGVjayBhIHNwZWNpZmljIHBhcmFtZXRlci92YXJpYWJsZSBmb3IgYmVpbmcgdW5kZWZpbmVkLgogICAgICogCiAgICAgKiBUaGlzIGNvbnN0cnVjdG9yIGNvbnN0cnVjdHMgYW4gaW5zdGFuY2Ugb2YgYW4gQ2hlY2tPYmplY3Qgb2JqZWN0LCB0aGF0CiAgICAgKiBkb2VzIGEgc2luZ2xlIHRlc3Qgb24gdGhlIHZhbHVlLCB0aGF0IGl0IGlzIHVuZGVmaW5lZC4gTm90aGluZyBpcwogICAgICogcmV0dXJuZWQuIAogICAgICoKICAgICAqIEBzeW50YXggVmFsdWVDaGVjay5jaGVja1VuZGVmaW5lZCggcGFyYW1uYW1lLCBwYXJhbXZhbHVlICk7CiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcGFyYW1uYW1lIFRoZSBuYW1lIG9mIHRoZSBwYXJhbWV0ZXIvdmFyaWFibGUgdG8gY2hlY2suIFVzZWQgdG8gY29uc3RydWN0IG1lYW5pbmdmdWwgZXJyb3IgcmVwb3J0cwogICAgICogQHBhcmFtIHtBbnl9IHBhcmFtdmFsdWUgVGhlIHZhbHVlIG9mIHRoZSBwYXJhbWV0ZXIvdmFyaWFibGUgdG8gY2hlY2suCiAgICAgKiBAZXhhbXBsZSBWYWx1ZUNoZWNrLmNoZWNrVW5kZWZpbmVkKCAiZm9vIiwgZm9vICk7CiAgICAgKiBAbmFtZSBWYWx1ZUNoZWNrLmNoZWNrVW5kZWZpbmVkCiAgICAgKiBAbWV0aG9kCiAgICAgKi8KICAgIHRoYXQuY2hlY2tVbmRlZmluZWQgPSBmdW5jdGlvbiggcGFyYW1uYW1lLCBwYXJhbXZhbHVlICkgewogICAgICAgIGlmICggYXJndW1lbnRzLmxlbmd0aCAhPSAyICkgewogICAgICAgICAgICB0aHJvd0Vycm9yKCAiQ2hlY2tVbmRlZmluZWQgbmVlZHMgZXhhY3RseSAyIGFyZ3VtZW50cyIgKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5jaGVja1ZhbHVlKCBwYXJhbW5hbWUsIHBhcmFtdmFsdWUgKS51bmRlZmluZWQ7CiAgICB9CgoKICAgIC8vIFJldHVybiB0aGF0CiAgICByZXR1cm4gdGhhdDsKfSggKTsKCgovLyBUT0RPOiBTY3JpcHREb2MgcG9zc2libHkgbWlzc2luZyBAbmFtZSBpbiBvdGhlciBmaWxlIGZvciBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0LmlzCi8vIFRPRE86IFNjcmlwdERvYyBwb3NzaWJseSBtaXNzaW5nIEBuYW1lIGluIG90aGVyIGZpbGUgZm9yIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QuYW5kCi8vIFRPRE86IFNjcmlwdERvYyBwb3NzaWJseSBtaXNzaW5nIEBuYW1lIGluIG90aGVyIGZpbGUgZm9yIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QuaGFzCi8vIFRPRE86IFNjcmlwdERvYyBwb3NzaWJseSBtaXNzaW5nIEBuYW1lIGluIG90aGVyIGZpbGUgZm9yIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QuaGF2ZQovLyBUT0RPOiBTY3JpcHREb2MgcG9zc2libHkgbWlzc2luZyBAbmFtZSBpbiBvdGhlciBmaWxlIGZvciBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0LndpdGgKLy8gVE9ETzogU2NyaXB0RG9jIHBvc3NpYmx5IG1pc3NpbmcgQG5hbWUgaW4gb3RoZXIgZmlsZSBmb3IgVmFsdWVDaGVjay5DaGVja09iamVjdC5vZgovLyBUT0RPOiBTY3JpcHREb2MgcG9zc2libHkgbWlzc2luZyBAbmFtZSBpbiBvdGhlciBmaWxlIGZvciBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0LnZhbHVlCi8vIFRPRE86IFNjcmlwdERvYyBwb3NzaWJseSBtaXNzaW5nIEBuYW1lIGluIG90aGVyIGZpbGUgZm9yIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QubXVzdAovLyBUT0RPOiBTY3JpcHREb2MgcG9zc2libHkgbWlzc2luZyBAbmFtZSBpbiBvdGhlciBmaWxlIGZvciBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0LmJlCi8vIFRPRE86IFNjcmlwdERvYyBwb3NzaWJseSBtaXNzaW5nIEBuYW1lIGluIG90aGVyIGZpbGUgZm9yIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QudGhhdAovLyBUT0RPOiBTY3JpcHREb2MgcG9zc2libHkgbWlzc2luZyBAbmFtZSBpbiBvdGhlciBmaWxlIGZvciBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0Lml0Ci8vIFRPRE86IFNjcmlwdERvYyBwb3NzaWJseSBtaXNzaW5nIEBuYW1lIGluIG90aGVyIGZpbGUgZm9yIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QuZG9lcwovLyBUT0RPOiBTY3JpcHREb2MgcG9zc2libHkgbWlzc2luZyBAbmFtZSBpbiBvdGhlciBmaWxlIGZvciBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0LmFkZHJlc3MKLy8gVE9ETzogU2NyaXB0RG9jIHBvc3NpYmx5IG1pc3NpbmcgQG5hbWUgaW4gb3RoZXIgZmlsZSBmb3IgVmFsdWVDaGVjay5DaGVja09iamVjdC5hbgovLyBUT0RPOiBTY3JpcHREb2MgcG9zc2libHkgbWlzc2luZyBAbmFtZSBpbiBvdGhlciBmaWxlIGZvciBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0Lm5vdAovLyBUT0RPOiBTY3JpcHREb2MgcG9zc2libHkgbWlzc2luZyBAbmFtZSBpbiBvdGhlciBmaWxlIGZvciBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0LnVuZGVmaW5lZAovLyBUT0RPOiBTY3JpcHREb2MgcG9zc2libHkgbWlzc2luZyBAbmFtZSBpbiBvdGhlciBmaWxlIGZvciBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0LmRlZmluZWQKLy8gVE9ETzogU2NyaXB0RG9jIHBvc3NpYmx5IG1pc3NpbmcgQG5hbWUgaW4gb3RoZXIgZmlsZSBmb3IgVmFsdWVDaGVjay5DaGVja09iamVjdC5lbWFpbAovLyBUT0RPOiBTY3JpcHREb2MgcG9zc2libHkgbWlzc2luZyBAbmFtZSBpbiBvdGhlciBmaWxlIGZvciBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0LnVybAo=", "moduleName": "ValueCheck"}, {"javascript": "LyoqIEBmaWxlIFJlY29yZFByb2Nlc3NpbmcgbW9kdWxlICAqLw0KDQoNCkVYUE9SVEVEX1NZTUJPTFMgPSBbICdSZWNvcmRQcm9jZXNzaW5nJyBdOw0KDQp1c2UoICJMb2ciICk7DQoNCg0KLyoqDQogKiBNb2R1bGUgdGhhdCBoYW5kbGVzIHByb2Nlc3NpbmcsIHNraXBwaW5nIGFuZCBmYWlsaW5nIG9mIHJlY29yZHMNCiAqDQogKiBAdHlwZSB7bmFtZXNwYWNlfQ0KICogQG5hbWVzcGFjZQ0KICovDQoNCnZhciBSZWNvcmRQcm9jZXNzaW5nID0gZnVuY3Rpb24oICkgew0KDQogICAgLyoqDQogICAgICogRnVuY3Rpb24gdGhhdCB0ZXJtaW5hdGVzIHRoZSBwcm9jZXNzaW5nIG9mIHRoZSBjdXJyZW50IHJlY29yZCBhbmQgdGhyb3dzIGFuDQogICAgICogZXhjZXB0aW9uIHdpdGggaW5mb3JtYXRpb24gdGhhdCB0aGUgcmVjb3JkIHNob3VsZCBiZSBmYWlsZWQNCiAgICAgKg0KICAgICAqIEB0eXBlIHtmdW5jdGlvbn0NCiAgICAgKiBAc3ludGF4IFJlY29yZFByb2Nlc3NpbmcudGVybWluYXRlUHJvY2Vzc2luZ0FuZEZhaWxSZWNvcmQoIGVycm9yTWVzc2FnZSApDQogICAgICogQHBhcmFtIHtTdHJpbmd9IGVycm9yTWVzc2FnZSB0aGUgZXJyb3IgbWVzc2FnZSB0byB0aHJvdyBpbiBleGNlcHRpb24NCiAgICAgKiBAZnVuY3Rpb24NCiAgICAgKiBAbmFtZSBSZWNvcmRQcm9jZXNzaW5nLnRlcm1pbmF0ZVByb2Nlc3NpbmdBbmRGYWlsUmVjb3JkDQogICAgICovDQogICAgZnVuY3Rpb24gdGVybWluYXRlUHJvY2Vzc2luZ0FuZEZhaWxSZWNvcmQgKCBlcnJvck1lc3NhZ2UgKSB7DQoNCiAgICAgICAgTG9nLmluZm8oICJFbnRlcmluZzogUmVjb3JkUHJvY2Vzc2luZy50ZXJtaW5hdGVQcm9jZXNzaW5nQW5kRmFpbFJlY29yZCBtZXRob2QiICk7DQoNCiAgICAgICAgLy8gU3BlY2lhbCBoYWNrcyBoZXJlLi4gRG9uJ3QgZG8gdGhpcyBhdCBob21lLiBVc2VkIGluIGRhdGFpby1zeXN0ZW0gLSBjaGVjayB3aXRoIGphNw0KICAgICAgICBpZiAoIHR5cGVvZihQYWNrYWdlcykgPT09ICdvYmplY3QnICkgew0KICAgICAgICAgICAgUGFja2FnZXMuZGsuZGJjLmphdmFzY3JpcHQucmVjb3JkcHJvY2Vzc2luZy5GYWlsUmVjb3JkLmRvVGhyb3coIGVycm9yTWVzc2FnZSApOw0KICAgICAgICB9DQogICAgICAgIC8vIEVuZCBvZiBEb24ndCBkbyB0aGlzIGF0IGhvbWUuDQoNCiAgICAgICAgdGhyb3cgew0KICAgICAgICAgICAgbmFtZTogIkZBSUxFRCIsDQogICAgICAgICAgICBtZXNzYWdlOiBlcnJvck1lc3NhZ2UNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEZ1bmN0aW9uIHRoYXQgdGVybWluYXRlcyB0aGUgcHJvY2Vzc2luZyBvZiB0aGUgY3VycmVudCByZWNvcmQgYW5kIHRocm93cyBhbg0KICAgICAqIGV4Y2VwdGlvbiB3aXRoIGluZm9ybWF0aW9uIHRoYXQgdGhlIHJlY29yZCBzaG91bGQgYmUgc2tpcHBlZCAoaWdub3JlZCkNCiAgICAgKg0KICAgICAqIEB0eXBlIHtmdW5jdGlvbn0NCiAgICAgKiBAc3ludGF4IFJlY29yZFByb2Nlc3NpbmcudGVybWluYXRlUHJvY2Vzc2luZ0FuZElnbm9yZSggZXJyb3JNZXNzYWdlICkNCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZXJyb3JNZXNzYWdlIHRoZSBlcnJvciBtZXNzYWdlIHRvIHRocm93IGluIGV4Y2VwdGlvbg0KICAgICAqIEBmdW5jdGlvbg0KICAgICAqIEBuYW1lIFJlY29yZFByb2Nlc3NpbmcudGVybWluYXRlUHJvY2Vzc2luZ0FuZElnbm9yZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHRlcm1pbmF0ZVByb2Nlc3NpbmdBbmRJZ25vcmUgKCBlcnJvck1lc3NhZ2UgKSB7DQoNCiAgICAgICAgTG9nLmluZm8oICJFbnRlcmluZzogUmVjb3JkUHJvY2Vzc2luZy50ZXJtaW5hdGVQcm9jZXNzaW5nQW5kSWdub3JlIG1ldGhvZCIgKTsNCg0KICAgICAgICAvLyBTcGVjaWFsIGhhY2tzIGhlcmUuLiBEb24ndCBkbyB0aGlzIGF0IGhvbWUuIFVzZWQgaW4gZGF0YWlvLXN5c3RlbSAtICBjaGVjayB3aXRoIGphNw0KICAgICAgICBpZiAoIHR5cGVvZihQYWNrYWdlcykgPT09ICdvYmplY3QnICkgew0KICAgICAgICAgICAgUGFja2FnZXMuZGsuZGJjLmphdmFzY3JpcHQucmVjb3JkcHJvY2Vzc2luZy5JZ25vcmVSZWNvcmQuZG9UaHJvdyggZXJyb3JNZXNzYWdlICk7DQogICAgICAgIH0NCiAgICAgICAgLy8gRW5kIG9mIERvbid0IGRvIHRoaXMgYXQgaG9tZS4NCiAgICAgICAgdGhyb3cgew0KICAgICAgICAgICAgbmFtZTogIklHTk9SRSIsDQogICAgICAgICAgICBtZXNzYWdlOiBlcnJvck1lc3NhZ2UNCiAgICAgICAgfQ0KDQoNCiAgICB9DQoNCiAgICByZXR1cm4gew0KICAgICAgICB0ZXJtaW5hdGVQcm9jZXNzaW5nQW5kRmFpbFJlY29yZDogdGVybWluYXRlUHJvY2Vzc2luZ0FuZEZhaWxSZWNvcmQsDQogICAgICAgIHRlcm1pbmF0ZVByb2Nlc3NpbmdBbmRJZ25vcmU6IHRlcm1pbmF0ZVByb2Nlc3NpbmdBbmRJZ25vcmUNCiAgICB9Ow0KDQp9KCApOw0K", "moduleName": "RecordProcessing"}, {"javascript": "LyoqIEBmaWxlIERhbk1hcmMyVXRpbCBtb2R1bGUgICovDQoNCg0KRVhQT1JURURfU1lNQk9MUyA9IFsgJ0Rhbk1hcmMyVXRpbCcgXTsNCg0KdXNlKCAiTG9nIiApOw0KdXNlKCAiTWFyYyIgKTsNCg0KLyoqDQogKiBNb2R1bGUgdGhhdCBpbmNsdWRlcyBkaWZmZXJlbnQgZ2VuZXJpYyBmdW5jdGlvbnMgZm9yIG1vZGlmeWluZyBEYW5NYXJjMiByZWNvcmRzDQogKg0KICogQHR5cGUge25hbWVzcGFjZX0NCiAqIEBuYW1lc3BhY2UNCiAqLw0KDQp2YXIgRGFuTWFyYzJVdGlsID0gZnVuY3Rpb24oKSB7DQoNCiAgICAvKioNCiAgICAgKiBNZXRob2QgdGhhdCByZW1vdmVzIGJsYW5rcyBmcm9tIGZhdXN0IGluIHRoZSBmb2xsb3dpbmcgZmllbGRzDQogICAgICogMDAxYSwgMDAyYWNkLCAwMTFhLCAwMTNhLCAwMTRhLCAwMTZhLCAwMTdhLCAwMThhLCA1MjBuDQogICAgICogT25seSBmaWVsZCA1MjAgaGFzIHN1YmZpZWxkIG4NCiAgICAgKg0KICAgICAqIEB0eXBlIHttZXRob2R9DQogICAgICogQHN5bnRheCBEYW5NYXJjMlV0aWwucmVtb3ZlQmxhbmtzRnJvbUZhdXN0KCByZWNvcmQgKQ0KICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgbWFyYyByZWNvcmQgYXMgUmVjb3JkIG9iamVjdA0KICAgICAqIEByZXR1cm4ge1JlY29yZH0gVGhlIHVwZGF0ZWQgcmVjb3JkDQogICAgICogQG1ldGhvZA0KICAgICAqIEBuYW1lIERhbk1hcmMyVXRpbC5yZW1vdmVCbGFua3NGcm9tRmF1c3QNCiAgICAgKi8NCg0KICAgIGZ1bmN0aW9uIHJlbW92ZUJsYW5rc0Zyb21GYXVzdCggcmVjb3JkICkgew0KDQogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIERhbk1hcmMyVXRpbC5yZW1vdmVCbGFua3NGcm9tRmF1c3QiICk7DQoNCiAgICAgICAgdmFyIG1hcCA9IG5ldyBNYXRjaE1hcCgpOw0KICAgICAgICBtYXAucHV0KCAiMDAxIiwgIjAxMSIsICIwMTMiLCAiMDE0IiwgIjAxNSIsICIwMTYiLCAiMDE3IiwgIjAxOCIsICJmMDciLCBmdW5jdGlvbiggZmllbGQgKSB7DQogICAgICAgICAgICBmaWVsZC5lYWNoU3ViRmllbGQoICJhIiwgZnVuY3Rpb24oIGZpZWxkLCBzdWJmaWVsZCApIHsNCiAgICAgICAgICAgICAgICBzdWJmaWVsZC52YWx1ZSA9IHN1YmZpZWxkLnZhbHVlLnJlcGxhY2UoIC8gL2csICIiICk7DQogICAgICAgICAgICB9ICk7IC8vZW5kIGVhY2hTdWJGaWVsZA0KICAgICAgICB9ICk7DQogICAgICAgIG1hcC5wdXQoICIwMDIiLCBmdW5jdGlvbiggZmllbGQgKSB7DQogICAgICAgICAgICBmaWVsZC5lYWNoU3ViRmllbGQoIC9bYWNkXS8sIGZ1bmN0aW9uKCBmaWVsZCwgc3ViZmllbGQgKSB7DQogICAgICAgICAgICAgICAgc3ViZmllbGQudmFsdWUgPSBzdWJmaWVsZC52YWx1ZS5yZXBsYWNlKCAvIC9nLCAiIiApOw0KICAgICAgICAgICAgfSApOyAvL2VuZCBlYWNoU3ViRmllbGQNCiAgICAgICAgfSApOw0KICAgICAgICBtYXAucHV0KCAiNTIwIiwgZnVuY3Rpb24oIGZpZWxkICkgew0KICAgICAgICAgICAgZmllbGQuZWFjaFN1YkZpZWxkKCAibiIsIGZ1bmN0aW9uKCBmaWVsZCwgc3ViZmllbGQgKSB7DQogICAgICAgICAgICAgICAgc3ViZmllbGQudmFsdWUgPSBzdWJmaWVsZC52YWx1ZS5yZXBsYWNlKCAvIC9nLCAiIiApOw0KICAgICAgICAgICAgfSApOw0KICAgICAgICB9ICk7DQoNCiAgICAgICAgcmVjb3JkLmVhY2hGaWVsZE1hcCggbWFwICk7DQoNCiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBEYW5NYXJjMlV0aWwucmVtb3ZlQmxhbmtzRnJvbUZhdXN0IiApOw0KDQogICAgICAgIHJldHVybiByZWNvcmQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogTWV0aG9kIHRoYXQgcmVuYW1lcyBmaWVsZCBzMTAgdG8gOTk2DQogICAgICoNCiAgICAgKiBAdHlwZSB7bWV0aG9kfQ0KICAgICAqIEBzeW50YXggRGFuTWFyYzJVdGlsLmNvbnZlcnRTMTB0bzk5NiggcmVjb3JkICkNCiAgICAgKiBAcGFyYW0ge1JlY29yZH0gcmVjb3JkIG1hcmMgcmVjb3JkIGFzIFJlY29yZCBvYmplY3QNCiAgICAgKiBAcmV0dXJuIHtSZWNvcmR9IFRoZSB1cGRhdGVkIHJlY29yZA0KICAgICAqIEBtZXRob2QNCiAgICAgKiBAbmFtZSBEYW5NYXJjMlV0aWwuY29udmVydFMxMHRvOTk2DQogICAgICovDQogICAgZnVuY3Rpb24gY29udmVydFMxMHRvOTk2KCByZWNvcmQgKSB7DQoNCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmcgRGFuTWFyYzJVdGlsLmNvbnZlcnRTMTB0bzk5NiIgKTsNCg0KICAgICAgICByZWNvcmQuZWFjaEZpZWxkKCAiczEwIiwgZnVuY3Rpb24oIGZpZWxkICkgew0KICAgICAgICAgICAgZmllbGQubmFtZSA9ICI5OTYiOw0KICAgICAgICB9ICk7DQoNCiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBEYW5NYXJjMlV0aWwuY29udmVydFMxMHRvOTk2IiApOw0KDQogICAgICAgIHJldHVybiByZWNvcmQ7DQogICAgfQ0KDQoNCiAgICAvKioNCiAgICAgKiBNZXRob2QgdGhhdCBzb3J0cyB0aGUgZmllbGRzIG9mIGEgbWFyYyByZWNvcmQgaW4gYXNjZW5kaW5nIG9yZGVyLg0KICAgICAqDQogICAgICogQHR5cGUge21ldGhvZH0NCiAgICAgKiBAc3ludGF4IERhbk1hcmMyVXRpbC5zb3J0RmllbGRzKCByZWNvcmQgKQ0KICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgVGhlIG1hcmMgcmVjb3JkIHRoYXQgbmVlZHMgdG8gYmUgc29ydGVkDQogICAgICogQHJldHVybiB7UmVjb3JkfSBBIG5ldyBtYXJjIHJlY29yZCB3aXRoIHNvcnRlZCBmaWVsZHMNCiAgICAgKiBAbWV0aG9kDQogICAgICogQG5hbWUgRGFuTWFyYzJVdGlsLnNvcnRGaWVsZHMNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBzb3J0RmllbGRzKCByZWNvcmQgKSB7DQoNCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmc6IERhbk1hcmMyVXRpbC5zb3J0RmllbGRzIG1ldGhvZCIgKTsNCg0KICAgICAgICB2YXIgc29ydGVkUmVjb3JkID0gbmV3IFJlY29yZCgpOw0KICAgICAgICBzb3J0ZWRSZWNvcmQucmVjb3JkU3RhdHVzID0gcmVjb3JkLnJlY29yZFN0YXR1czsNCiAgICAgICAgc29ydGVkUmVjb3JkLmZvclVzZXJTeXN0ZW1zID0gcmVjb3JkLmZvclVzZXJTeXN0ZW1zOw0KICAgICAgICBzb3J0ZWRSZWNvcmQuaW1wbGVtZW50YXRpb25Db2RlcyA9IHJlY29yZC5pbXBsZW1lbnRhdGlvbkNvZGVzOw0KDQogICAgICAgIHZhciBmaWVsZHMgPSBbXTsNCg0KICAgICAgICByZWNvcmQuZWFjaEZpZWxkKCAvLi8sIGZ1bmN0aW9uKCBmaWVsZCApIHsNCiAgICAgICAgICAgIGlmICggLTEgPT09IGZpZWxkcy5pbmRleE9mKCBmaWVsZC5uYW1lICkgKSB7DQogICAgICAgICAgICAgICAgZmllbGRzLnB1c2goIGZpZWxkLm5hbWUgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSApOw0KDQogICAgICAgIHZhciBzb3J0ZWRBcnJheSA9IGZpZWxkcy5zb3J0KCk7DQoNCiAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgc29ydGVkQXJyYXkubGVuZ3RoOyBpKysgKSB7DQogICAgICAgICAgICB2YXIgZmllbGROYW1lID0gc29ydGVkQXJyYXlbIGkgXTsNCiAgICAgICAgICAgIHJlY29yZC5lYWNoRmllbGQoIGZpZWxkTmFtZSwgZnVuY3Rpb24oIGZpZWxkICkgew0KICAgICAgICAgICAgICAgIHNvcnRlZFJlY29yZC5hcHBlbmQoIGZpZWxkICk7DQogICAgICAgICAgICB9ICk7DQogICAgICAgIH0NCg0KICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nOiBEYW5NYXJjMlV0aWwuc29ydEZpZWxkcyBtZXRob2QiICk7DQoNCiAgICAgICAgcmV0dXJuIHNvcnRlZFJlY29yZDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBNZXRob2QgdGhhdCBzb3J0cyB0aGUgc3ViZmllbGRzIG9mIHRoZSBpbnB1dEZpZWxkIGluIHRoZSBnaXZlbiBzb3J0T3JkZXIuDQogICAgICogU3ViZmllbGRzIG5vdCBzcGVjaWZpZWQgaW4gc29ydE9yZGVyIGFyZSBhcHBlbmRlZCBpbiB0aGUgZW5kDQogICAgICogLy9UT0RPOiB3ZSBjb3VsZCBjcmVhdGUgYSB0YWJsZSB3aXRoIHNvcnQgb3JkZXIgZm9yIGFsbCBmaWVsZHMsDQogICAgICogIHNvIHdlIGp1c3QgbmVlZCB0byBtYWludGFpbiBzdWJmaWVsZCBvcmRlcnMgaW4gb25lIHBsYWNlLg0KICAgICAqDQogICAgICogQGZ1bmN0aW9uDQogICAgICogQHN5bnRheCBEYW5NYXJjMlV0aWwuc29ydFN1YmZpZWxkcyAoIGlucHV0RmllbGQsIHNvcnRPcmRlciApDQogICAgICogQHBhcmFtIHtGaWVsZH0gaW5wdXRGaWVsZCBUaGUgaW5wdXQgZmllbGQNCiAgICAgKiBAcGFyYW0ge1N0cmluZ1tdfSBzb3J0T3JkZXIgQW4gQXJyYXkgb2Ygc3ViZmllbGQgbmFtZXMgc3BlY2lmeWluZyB0aGUgb3JkZXJpbmcgb2Ygc3ViZmllbGRzDQogICAgICogQHJldHVybiB7RmllbGR9IGEgbmV3IEZpZWxkIHdpdGggdGhlIChzcGVjaWZpZWQpIHN1YmZpZWxkcyBmcm9tIHRoZSBpbnB1dCBmaWVsZCBvcmRlcmVkIGJ5IHRoZSBzcGVjaWZpZWQgc29ydCBvcmRlcg0KICAgICAqIEBuYW1lIERhbk1hcmMyVXRpbC5zb3J0U3ViZmllbGRzDQogICAgICovDQogICAgZnVuY3Rpb24gc29ydFN1YmZpZWxkcyggaW5wdXRGaWVsZCwgc29ydE9yZGVyICkgew0KDQogICAgICAgIExvZy50cmFjZSggJ0VudGVyaW5nIERhbk1hcmMyVXRpbC5zb3J0U3ViZmllbGRzJyApOw0KDQogICAgICAgIHZhciBvdXRwdXRGaWVsZCA9IG5ldyBGaWVsZCggaW5wdXRGaWVsZC5uYW1lLCBpbnB1dEZpZWxkLmluZGljYXRvciApOw0KICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBzb3J0T3JkZXIubGVuZ3RoOyBpKysgKSB7DQogICAgICAgICAgICBpbnB1dEZpZWxkLmVhY2hTdWJGaWVsZCggc29ydE9yZGVyWyBpIF0sIGZ1bmN0aW9uKCBmaWVsZCwgc3ViZmllbGQgKSB7DQogICAgICAgICAgICAgICAgb3V0cHV0RmllbGQuYXBwZW5kKCBzdWJmaWVsZC5uYW1lLCBzdWJmaWVsZC52YWx1ZSApOw0KICAgICAgICAgICAgfSApDQogICAgICAgIH0NCiAgICAgICAgaW5wdXRGaWVsZC5lYWNoU3ViRmllbGQoIC8uLywgZnVuY3Rpb24oIGZpZWxkLCBzdWJmaWVsZCApIHsNCiAgICAgICAgICAgIGlmICggLTEgPT09IHNvcnRPcmRlci5pbmRleE9mKCBzdWJmaWVsZC5uYW1lICkgKSB7DQogICAgICAgICAgICAgICAgb3V0cHV0RmllbGQuYXBwZW5kKCBzdWJmaWVsZC5uYW1lLCBzdWJmaWVsZC52YWx1ZSApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9ICk7DQoNCiAgICAgICAgTG9nLnRyYWNlKCAnTGVhdmluZyBEYW5NYXJjMlV0aWwuc29ydFN1YmZpZWxkcycgKTsNCg0KICAgICAgICByZXR1cm4gb3V0cHV0RmllbGQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogTWV0aG9kIHRoYXQgY3JlYXRlcyBhIHN0cmluZyBjb250YWluaW5nIHRoZSBmdWxsIG5hbWUgb2YgYSBwZXJzb24sDQogICAgICogY29uc2lzdGluZyBvZiBmaXJzdCBuYW1lIGFuZCBsYXN0IG5hbWUuDQogICAgICoNCiAgICAgKiBAdHlwZSB7bWV0aG9kfQ0KICAgICAqIEBzeW50YXggRGFuTWFyYzJVdGlsLmNyZWF0ZVBlcnNvbk5hbWVGcm9tTWFyY0ZpZWxkKCBmaWVsZCApDQogICAgICogQHBhcmFtIHtTdHJpbmd9IGZpZWxkIEEgc3BlY2lmaWMgZmllbGQgaW4gdGhlIG1hcmMgcmVjb3JkDQogICAgICogQHJldHVybiB7U3RyaW5nfSB0aGUgcGVyc29uIG5hbWUgZnJvbSBzdWJmaWVsZCBhIGNvbmNhdGluYXRlZCB3aXRoIHN1YmZpZWxkIGgNCiAgICAgKiBAbWV0aG9kDQogICAgICogQG5hbWUgRGFuTWFyYzJVdGlsLmNyZWF0ZVBlcnNvbk5hbWVGcm9tTWFyY0ZpZWxkDQogICAgICovDQogICAgZnVuY3Rpb24gY3JlYXRlUGVyc29uTmFtZUZyb21NYXJjRmllbGQoIGZpZWxkICkgew0KDQogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nOiBNYXJjUmVjb3JkLmNyZWF0ZVBlcnNvbk5hbWVGcm9tTWFyY0ZpZWxkIG1ldGhvZCIgKTsNCg0KICAgICAgICB2YXIgZmlyc3ROYW1lID0gZmllbGQuZ2V0VmFsdWUoICJoIiApOw0KICAgICAgICB2YXIgbGFzdE5hbWUgPSBmaWVsZC5nZXRWYWx1ZSggImEiICk7DQogICAgICAgIHZhciBmdWxsTmFtZSA9ICIiOw0KDQogICAgICAgIGlmICggIiIgIT09IGZpcnN0TmFtZSApIHsNCiAgICAgICAgICAgIGZ1bGxOYW1lID0gZmlyc3ROYW1lICsgIiAiICsgbGFzdE5hbWU7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBmdWxsTmFtZSA9IGxhc3ROYW1lOw0KICAgICAgICB9DQogICAgICAgIExvZy5kZWJ1ZyggIkNyZWF0ZWQgZnVsbCBuYW1lOiAiLCBmdWxsTmFtZSApOw0KDQogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmc6IE1hcmNSZWNvcmQuY3JlYXRlUGVyc29uTmFtZUZyb21NYXJjRmllbGQgbWV0aG9kIiApOw0KDQogICAgICAgIHJldHVybiBmdWxsTmFtZTsNCg0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhIHN0cmluZyBjb250YWluaW5nIGFsbCB0aGUgc3ViZmllbGQgbmFtZXMgaW4gYSBmaWVsZC4NCiAgICAgKg0KICAgICAqIEB0eXBlIHttZXRob2R9DQogICAgICogQHN5bnRheCBEYW5NYXJjMlV0aWwuZ2V0QWxsU3ViZmllbGROYW1lcyggZmllbGQgKQ0KICAgICAqIEBwYXJhbSB7RmllbGR9IGZpZWxkIEEgc3BlY2lmaWMgZmllbGQgaW4gdGhlIG1hcmMgcmVjb3JkDQogICAgICogQHJldHVybiB7U3RyaW5nfSBhIHN0cmluZyB3aXRoIGFsbCB0aGUgc3ViZmllbGQgbmFtZXMgY29uY2F0aW5hdGVkDQogICAgICogQG1ldGhvZA0KICAgICAqIEBuYW1lIERhbk1hcmMyVXRpbC5nZXRBbGxTdWJmaWVsZE5hbWVzDQogICAgICovDQogICAgZnVuY3Rpb24gZ2V0QWxsU3ViZmllbGROYW1lcyggZmllbGQgKSB7DQoNCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmc6IE1hcmNSZWNvcmQuZ2V0QWxsU3ViZmllbGROYW1lcyBtZXRob2QiICk7DQoNCiAgICAgICAgdmFyIHN1YmZpZWxkTmFtZVN0cmluZyA9ICIiOw0KICAgICAgICBmaWVsZC5lYWNoU3ViRmllbGQoIC8uLywgZnVuY3Rpb24oIGZpZWxkLCBzdWJmaWVsZCApIHsNCiAgICAgICAgICAgIHN1YmZpZWxkTmFtZVN0cmluZyArPSBzdWJmaWVsZC5uYW1lOw0KICAgICAgICB9ICk7DQogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmc6IE1hcmNSZWNvcmQuZ2V0QWxsU3ViZmllbGROYW1lcyBtZXRob2QiICk7DQoNCiAgICAgICAgcmV0dXJuIHN1YmZpZWxkTmFtZVN0cmluZzsNCg0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEZ1bmN0aW9uIHRoYXQgcmVtb3ZlcyBlbXB0eSBzdWJmaWVsZHMgZnJvbSB0aGUgcmVjb3JkLg0KICAgICAqDQogICAgICogQHR5cGUge2Z1bmN0aW9ufQ0KICAgICAqIEBzeW50YXggRGFuTWFyYzJVdGlsLnJlbW92ZUVtcHR5U3ViZmllbGRzKCByZWNvcmQgKQ0KICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgQSBtYXJjIHJlY29yZA0KICAgICAqIEByZXR1cm4ge1JlY29yZH0gVGhlIHVwZGF0ZWQgcmVjb3JkDQogICAgICogQG1ldGhvZA0KICAgICAqIEBuYW1lIERhbk1hcmMyVXRpbC5yZW1vdmVFbXB0eVN1YmZpZWxkcw0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJlbW92ZUVtcHR5U3ViZmllbGRzKCByZWNvcmQgKSB7DQoNCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmc6IERhbk1hcmMyVXRpbC5yZW1vdmVFbXB0eVN1YmZpZWxkcyBmdW5jdGlvbiIgKTsNCg0KICAgICAgICByZWNvcmQuZWFjaEZpZWxkKCAvLi8sIGZ1bmN0aW9uKCBmaWVsZCApIHsNCiAgICAgICAgICAgIGZpZWxkLnJlbW92ZVdpdGhNYXRjaGVyKCB7DQogICAgICAgICAgICAgICAgbWF0Y2hTdWJGaWVsZDogZnVuY3Rpb24oIGZpZWxkLCBzdWJmaWVsZCApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBzdWJmaWVsZC52YWx1ZSA9PT0gIiIgJiYgIXN1YmZpZWxkLm5hbWUubWF0Y2goIC9bMC0xXS8gKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9ICkNCiAgICAgICAgfSApOw0KDQogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmc6IERhbk1hcmMyVXRpbC5yZW1vdmVFbXB0eVN1YmZpZWxkcyBmdW5jdGlvbiIgKTsNCg0KICAgICAgICByZXR1cm4gcmVjb3JkOw0KDQogICAgfQ0KDQogICAgLyoqDQogICAgICogRnVuY3Rpb24gdGhhdCByZW1vdmVzIGVtcHR5IGZpZWxkcyBmcm9tIHRoZSByZWNvcmQuDQogICAgICoNCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259DQogICAgICogQHN5bnRheCBEYW5NYXJjMlV0aWwucmVtb3ZlRW1wdHlGaWVsZHMoIHJlY29yZCApDQogICAgICogQHBhcmFtIHtSZWNvcmR9IHJlY29yZCBBIG1hcmMgcmVjb3JkDQogICAgICogQHJldHVybiB7UmVjb3JkfSBUaGUgdXBkYXRlZCByZWNvcmQNCiAgICAgKiBAbWV0aG9kDQogICAgICogQG5hbWUgRGFuTWFyYzJVdGlsLnJlbW92ZUVtcHR5RmllbGRzDQogICAgICovDQogICAgZnVuY3Rpb24gcmVtb3ZlRW1wdHlGaWVsZHMoIHJlY29yZCApIHsNCg0KICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZzogRGFuTWFyYzJVdGlsLnJlbW92ZUVtcHR5RmllbGRzIGZ1bmN0aW9uIiApOw0KDQogICAgICAgIHZhciBpID0gMDsNCiAgICAgICAgdmFyIHJlbW92ZUFycmF5ID0gW107DQogICAgICAgIHJlY29yZC5lYWNoRmllbGQoIC8uLywgZnVuY3Rpb24oIGZpZWxkICkgew0KICAgICAgICAgICAgaWYgKCBmaWVsZC5zaXplKCkgPCAxICkgew0KICAgICAgICAgICAgICAgIHJlbW92ZUFycmF5LnB1c2goIGkgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGkrKzsNCiAgICAgICAgfSApOw0KICAgICAgICByZW1vdmVBcnJheS5yZXZlcnNlKCk7DQogICAgICAgIGZvciAoIHZhciBqID0gMDsgaiA8IHJlbW92ZUFycmF5Lmxlbmd0aDsgaisrICkgew0KICAgICAgICAgICAgcmVjb3JkLnJlbW92ZSggcmVtb3ZlQXJyYXlbIGogXSApDQogICAgICAgIH0NCg0KICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nOiBEYW5NYXJjMlV0aWwucmVtb3ZlRW1wdHlGaWVsZHMgZnVuY3Rpb24iICk7DQoNCiAgICAgICAgcmV0dXJuIHJlY29yZDsNCg0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEZ1bmN0aW9uIHRoYXQgdW4tZW1iZWRzIHRyYWNrIGZpZWxkcyAoNzk1KS4NCiAgICAgKg0KICAgICAqIEB0eXBlIHtmdW5jdGlvbn0NCiAgICAgKiBAc3ludGF4IERhbk1hcmMyVXRpbC51bkVtYmVkRmllbGRzKCByZWNvcmQgKQ0KICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgYSBtYXJjIHJlY29yZA0KICAgICAqIEByZXR1cm4ge1JlY29yZH0gVGhlIHVwZGF0ZWQgcmVjb3JkDQogICAgICogQG1ldGhvZA0KICAgICAqIEBuYW1lIERhbk1hcmMyVXRpbC51bkVtYmVkRmllbGRzDQogICAgICovDQogICAgZnVuY3Rpb24gdW5FbWJlZEZpZWxkcyggcmVjb3JkICkgew0KDQogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nOiBEYW5NYXJjMlV0aWwudW5FbWJlZEZpZWxkcyBmdW5jdGlvbiIgKTsNCg0KICAgICAgICB2YXIgb2xkRmllbGRzID0gW107DQogICAgICAgIHZhciB0cmFja1JlY29yZCA9IG5ldyBSZWNvcmQoKTsNCiAgICAgICAgdmFyIG5ld0ZpZWxkID0gdW5kZWZpbmVkOw0KICAgICAgICB2YXIgcmVmU3ViZmllbGQgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgcmVjb3JkLmVhY2hGaWVsZCggL2FbMC05XVswLTldLywgZnVuY3Rpb24oIGZpZWxkICkgew0KICAgICAgICAgICAgaWYgKCBmaWVsZC5leGlzdHMoIC9cdTAwZTUvICkgKSB7DQogICAgICAgICAgICAgICAgcmVmU3ViZmllbGQgPSBmaWVsZC5zdWJmaWVsZCggIlx1MDBlNSIgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZpZWxkLmVhY2hTdWJGaWVsZCggLy4vLCBmdW5jdGlvbiggZmllbGQsIHN1YmZpZWxkICkgew0KICAgICAgICAgICAgICAgIGlmICggc3ViZmllbGQubmFtZSA9PSAxICYmIHN1YmZpZWxkLnZhbHVlLm1hdGNoKCAvWzAtOV17NX0vICkgKSB7ICAvL2lzIHRoaXMgYSByaWdodCBtYXRjaD8/DQogICAgICAgICAgICAgICAgICAgIGlmICggbmV3RmllbGQgIT09IHVuZGVmaW5lZCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYWNrUmVjb3JkLmFwcGVuZCggbmV3RmllbGQgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBuZXdGaWVsZCA9IG5ldyBGaWVsZCggc3ViZmllbGQudmFsdWUuc3Vic3RyKCAwLCAzICksICIwMCIgKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCByZWZTdWJmaWVsZCAhPT0gdW5kZWZpbmVkICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3RmllbGQuYXBwZW5kKCByZWZTdWJmaWVsZCApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICggc3ViZmllbGQubmFtZSAhPT0gIlx1MDBlNSIgKSB7DQogICAgICAgICAgICAgICAgICAgIG5ld0ZpZWxkLmFwcGVuZCggc3ViZmllbGQgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9ICk7DQogICAgICAgICAgICBvbGRGaWVsZHMucHVzaCggU3RyaW5nKCBmaWVsZC5uYW1lICkgKTsNCiAgICAgICAgICAgIHRyYWNrUmVjb3JkLmFwcGVuZCggbmV3RmllbGQgKTsNCiAgICAgICAgICAgIG5ld0ZpZWxkID0gdW5kZWZpbmVkOw0KICAgICAgICAgICAgcmVmU3ViZmllbGQgPSB1bmRlZmluZWQ7DQogICAgICAgIH0gKTsNCiAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgb2xkRmllbGRzLmxlbmd0aDsgaSsrICkgew0KICAgICAgICAgICAgcmVjb3JkLnJlbW92ZSggb2xkRmllbGRzWyBpIF0gKTsNCiAgICAgICAgfQ0KICAgICAgICB0cmFja1JlY29yZC5lYWNoRmllbGQoIC8uLywgZnVuY3Rpb24oIGZpZWxkICkgew0KICAgICAgICAgICAgcmVjb3JkLmFwcGVuZCggZmllbGQgKTsNCiAgICAgICAgfSApOw0KDQogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmc6IERhbk1hcmMyVXRpbC51bkVtYmVkRmllbGRzIGZ1bmN0aW9uIiApOw0KDQogICAgICAgIHJldHVybiByZWNvcmQ7DQoNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBGdW5jdGlvbiB0aGF0IHJlc2V0cyBpbmRpY2F0b3JzLCByZW1vdmVzIGJsYW5rcyBmcm9tIGZhdXN0IGFuZCBzb3J0cyB0aGUgZmllbGRzIGluIGEgcmVjb3JkLg0KICAgICAqDQogICAgICogQHR5cGUge2Z1bmN0aW9ufQ0KICAgICAqIEBzeW50YXggRGFuTWFyYzJVdGlsLnRyaW1SZWNvcmQoIHJlY29yZCApDQogICAgICogQHBhcmFtIHtSZWNvcmR9IHJlY29yZCBhIG1hcmMgcmVjb3JkDQogICAgICogQHJldHVybiB7UmVjb3JkfSBUaGUgdXBkYXRlZCByZWNvcmQNCiAgICAgKiBAZnVuY3Rpb24NCiAgICAgKiBAbmFtZSBEYW5NYXJjMlV0aWwudHJpbVJlY29yZA0KICAgICAqLw0KDQogICAgZnVuY3Rpb24gdHJpbVJlY29yZCggcmVjb3JkICkgew0KDQogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nOiBEYW5NYXJjMlV0aWwudHJpbVJlY29yZCBmdW5jdGlvbiIgKTsNCg0KICAgICAgICByZWNvcmQgPSBEYW5NYXJjMlV0aWwuc29ydEZpZWxkcyggcmVjb3JkICk7DQogICAgICAgIHJlY29yZCA9IERhbk1hcmMyVXRpbC5yZW1vdmVCbGFua3NGcm9tRmF1c3QoIHJlY29yZCApOw0KICAgICAgICByZWNvcmQuZWFjaEZpZWxkKCAvLi8sIGZ1bmN0aW9uKCBmaWVsZCApIHsNCiAgICAgICAgICAgIGZpZWxkLmluZGljYXRvciA9ICIwMCI7DQogICAgICAgIH0gKTsNCg0KICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nOiBEYW5NYXJjMlV0aWwudHJpbVJlY29yZCBmdW5jdGlvbiIgKTsNCg0KICAgICAgICByZXR1cm4gcmVjb3JkOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEZ1bmN0aW9uIHRoYXQgcmVwbGFjZXMgb25lIGZvcm0gb2YgYWxwaGFiZXRpemluZyBub3RhdGlvbiB3aXRoIGFub3RoZXIuDQogICAgICoNCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259DQogICAgICogQHN5bnRheCBEYW5NYXJjMlV0aWwucmVwbGFjZU5vbmZpbGluZ05vdGF0aW9uKCByZWNvcmQgKQ0KICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgYSBtYXJjIHJlY29yZA0KICAgICAqIEByZXR1cm4ge1JlY29yZH0gVGhlIHVwZGF0ZWQgcmVjb3JkDQogICAgICogQGZ1bmN0aW9uDQogICAgICogQG5hbWUgRGFuTWFyYzJVdGlsLnJlcGxhY2VOb25maWxpbmdOb3RhdGlvbg0KICAgICAqLw0KDQogICAgZnVuY3Rpb24gcmVwbGFjZU5vbmZpbGluZ05vdGF0aW9uKCByZWNvcmQgKSB7DQoNCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmc6IERhbk1hcmMyVXRpbC5yZXBsYWNlTm9uZmlsaW5nTm90YXRpb24gZnVuY3Rpb24iICk7DQoNCiAgICAgICAgLy9oZWxwZXIgZnVuY3Rpb24NCiAgICAgICAgZnVuY3Rpb24gX19yZXBsYWNlTm9uZmlsaW5nQ2hhcnMoIGZpZWxkICkgew0KICAgICAgICAgICAgZmllbGQuZWFjaFN1YkZpZWxkKCAvLi8sIGZ1bmN0aW9uKCBmaWVsZCwgc3ViZmllbGQgKSB7DQogICAgICAgICAgICAgICAgaWYgKCBzdWJmaWVsZC52YWx1ZS5tYXRjaCggL1x1MDA5OC4qXHUwMDlDL2kgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgc3ViZmllbGQudmFsdWUgPSBzdWJmaWVsZC52YWx1ZS5yZXBsYWNlKCAvXHUwMDk4KC4qKVx1MDA5Qy9pLCAiJDHCpCIgKTsgIC8vIFx1MDBBNA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBtYXAgPSBuZXcgTWF0Y2hNYXAoKTsNCiAgICAgICAgcmVjb3JkLmVhY2hGaWVsZE1hcFdpdGhEZWZhdWx0KCBtYXAsIF9fcmVwbGFjZU5vbmZpbGluZ0NoYXJzLCB7fSApOw0KDQogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmc6IERhbk1hcmMyVXRpbC5yZXBsYWNlTm9uZmlsaW5nTm90YXRpb24gZnVuY3Rpb24iICk7DQoNCiAgICAgICAgcmV0dXJuIHJlY29yZDsNCiAgICB9DQoNCg0KICAgIHJldHVybiB7DQogICAgICAgIHJlbW92ZUJsYW5rc0Zyb21GYXVzdDogcmVtb3ZlQmxhbmtzRnJvbUZhdXN0LA0KICAgICAgICBjb252ZXJ0UzEwdG85OTY6IGNvbnZlcnRTMTB0bzk5NiwNCiAgICAgICAgc29ydEZpZWxkczogc29ydEZpZWxkcywNCiAgICAgICAgc29ydFN1YmZpZWxkczogc29ydFN1YmZpZWxkcywNCiAgICAgICAgZ2V0QWxsU3ViZmllbGROYW1lczogZ2V0QWxsU3ViZmllbGROYW1lcywNCiAgICAgICAgY3JlYXRlUGVyc29uTmFtZUZyb21NYXJjRmllbGQ6IGNyZWF0ZVBlcnNvbk5hbWVGcm9tTWFyY0ZpZWxkLA0KICAgICAgICByZW1vdmVFbXB0eUZpZWxkczogcmVtb3ZlRW1wdHlGaWVsZHMsDQogICAgICAgIHJlbW92ZUVtcHR5U3ViZmllbGRzOiByZW1vdmVFbXB0eVN1YmZpZWxkcywNCiAgICAgICAgdW5FbWJlZEZpZWxkczogdW5FbWJlZEZpZWxkcywNCiAgICAgICAgdHJpbVJlY29yZDogdHJpbVJlY29yZCwNCiAgICAgICAgcmVwbGFjZU5vbmZpbGluZ05vdGF0aW9uOiByZXBsYWNlTm9uZmlsaW5nTm90YXRpb24NCiAgICB9Ow0KDQoNCn0oKTs=", "moduleName": "DanMarc2Util"}], "svnRevision": 126314, "requireCache": null, "invocationMethod": "convertRawRecordToDst", "invocationJavascriptName": "dm2_to_dst.js", "svnProjectForInvocationJavascript": "conversion-flows/bogstat-dm2-to-dst/js"}, "content": {"name": "RR2Dst", "description": "Flow for poster fra RR til Danmarks Statistik (dst)- poster udleveres i csv-format (string)", "javascripts": [{"javascript": "dXNlKCAiTG9nIiApOw0KdXNlKCAiQWRtaW5EYXRhIiApOw0KdXNlKCAiWG1sVXRpbCIgKTsNCnVzZSggIk1hcmNYY2hhbmdlVXRpbCIgKTsNCnVzZSggIk1hcmNYY2hhbmdlIiApOw0KdXNlKCAiRG0yVG9Ec3QiICk7DQp1c2UoICJEYW5NYXJjMlV0aWwiICk7DQoNCi8qKg0KICogRW50cnkgcG9pbnQgZm9yIGNvbnZlcnRpbmcgYSBtYXJjIHJlY29yZCBjb2xsZWN0aW9uIGluIG1hcmNYY2hhbmdlIGZyb20gUmF3UmVjb3JkUmVwbyB0byBjc3YgZ29pbmcgdG8gRFNUDQogKg0KICogQHR5cGUge2Z1bmN0aW9ufQ0KICogQHN5bnRheCBjb252ZXJ0UmF3UmVjb3JkVG9Ec3QoIHhtbENvbGxlY3Rpb24sIHN1cHBEYXRhICkNCiAqIEBwYXJhbSB7U3RyaW5nfSB4bWxDb2xsZWN0aW9uIEEgY29sbGVjdGlvbiB3aXRoIG9uZSBvciBtb3JlIG1hcmMgcmVjb3JkcyBpbiBNYXJjWGNoYW5nZSBmb3JtYXQgZnJvbSBSUiBhcyBhIHN0cmluZw0KICogQHBhcmFtIHtPYmplY3R9IHN1cHBEYXRhIEEgSlNPTiBvYmplY3Qgd2l0aCBpbmZvcm1hdGlvbiBhYm91dCBzdWJtaXR0ZXIgYW5kIGZvcm1hdCBhbmQgY3JlYXRpb24gZGF0ZQ0KICogQHJldHVybiB7U3RyaW5nfSBUaGUgcmVjb3JkIGNvbnZlcnRlZCB0byBjc3YtZm9ybWF0IGZvciBEU1QNCiAqIEBleGFtcGxlDQogY29udmVydFJhd1JlY29yZFRvRHN0KA0KICI8bWFyY3g6Y29sbGVjdGlvbiB4bWxuczptYXJjeD0iaW5mbzpsYy94bWxucy9tYXJjeGNoYW5nZS12MSI+DQogPG1hcmN4OnJlY29yZCBmb3JtYXQ9ImRhbk1BUkMyIiB0eXBlPSJCaWJsaW9ncmFwaGljIj4NCiA8bWFyY3g6bGVhZGVyPjAwMDAwbiAgICAyMjAwMDAwICAgNDUwMDwvbWFyY3g6bGVhZGVyPg0KIDxtYXJjeDpkYXRhZmllbGQgaW5kMT0iMCIgaW5kMj0iMCIgdGFnPSIwMDEiPg0KIDxtYXJjeDpzdWJmaWVsZCBjb2RlPSJhIj40MTczMTkwNzwvbWFyY3g6c3ViZmllbGQ+DQogPC9tYXJjeDpkYXRhZmllbGQ+DQogPC9tYXJjeDpyZWNvcmQ+DQogPC9tYXJjeDpjb2xsZWN0aW9uPiIsDQogeyAic3VibWl0dGVyIiA6ICI4NzA5NzAiLCAiZm9ybWF0IiA6ICJkc3QiICwgY3JlYXRpb25EYXRlOiAiMjAwNTAzMDEifQ0KICkNCg0KICogQG5hbWUgY29udmVydFJhd1JlY29yZFRvRHN0DQogKiovDQoNCg0KZnVuY3Rpb24gY29udmVydFJhd1JlY29yZFRvRHN0KCB4bWxDb2xsZWN0aW9uLCBzdXBwRGF0YSApIHsNCg0KICAgIExvZy5pbmZvKCAiRW50ZXJpbmc6IGNvbnZlcnRSYXdSZWNvcmRUb0RzdCBmdW5jdGlvbiIgKTsNCg0KICAgIHZhciBjc3YgPSBEbTJUb0RzdC5jcmVhdGVDc3ZGb3JEc3QoIHhtbENvbGxlY3Rpb24gKTsNCg0KICAgIExvZy5pbmZvKCAiTGVhdmluZzogY29udmVydFJhd1JlY29yZFRvRHN0IGZ1bmN0aW9uIiApOw0KDQogICAgcmV0dXJuIGNzdjsNCg0KfQ0KDQovLyBBZGRpdGlvbmFsIHRlc3QgZW50cnkgZnVuY3Rpb24NCmZ1bmN0aW9uIHRlc3RDb252ZXJ0UmVjb3JkcyggKSB7DQogICAgdXNlKCJUZXN0Q29udmVydFJlY29yZHNIZWxwZXJzIik7DQogICAgLy8gcGFzcyAgd29ya2VyIGZ1bmN0aW9uIHRvIHRlc3RDb252ZXJ0SnNvbmNzdlJlY29yZA0KICAgIFRlc3RDb252ZXJ0UmVjb3Jkc0hlbHBlcnMudGVzdENvbnZlcnRKc29uQWRkaVJlY29yZCggY29udmVydFJhd1JlY29yZFRvRHN0ICk7DQp9DQoNCmZ1bmN0aW9uIGxvY2FsQWNjdGVzdFJ1bm5lciggYWRkaVJlY29yZCApIHsNCiAgICAvLyBjcmVhdGUgYWRkaVJlYWRlciBhbmQgcGFzcyBpdCB0byByZWFkQWRkaSB0aGF0IHdpbGwgcHJvY2VzcyBpdCB3aXRoIHRoZSBtYWluIHdvcmtlciBmdW5jdGlvbg0KICAgIHVzZSggIkFkZGkiICk7DQogICAgdXNlKCJUZXN0Q29udmVydFJlY29yZHNIZWxwZXJzIik7DQoNCiAgICB2YXIgYWRkaUZpbGVSZWFkZXIgPSBBZGRpLmNyZWF0ZUFkZGlTdHJpbmdSZWFkZXIoIGFkZGlSZWNvcmQgKTsNCg0KICAgIHJldHVybiBUZXN0Q29udmVydFJlY29yZHNIZWxwZXJzLnJlYWRBZGRpKCBhZGRpRmlsZVJlYWRlciwgY29udmVydFJhd1JlY29yZFRvRHN0ICk7DQp9IA0K", "moduleName": ""}, {"javascript": "LyoqIEBmaWxlIE1vZHVsZXNJbmZvIG1vZHVsZS4gR2V0IGluZm9ybWF0aW9uIGFib3V0IGxvYWRlZCBtb2R1bGVzICovCgovLyBXQVJOSU5HOiBJZiB5b3UgYnJlYWsgdGhpcyBmaWxlLCB0aGUgbW9kdWxlIHN5c3RlbSB3aWxsIHN0b3Agd29ya2luZyEgCgovLyBqc2xpYiBkZXBlbmRzIG9uIGFuZCBsb2FkcyB0aGlzIG1vZHVsZS4KLy8gVGhlIGJpbmFyeSB1c2VzIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb25zOgovLyAKLy8gX19Nb2R1bGVzSW5mby5jaGVja0RlcEFscmVhZHlMb2FkZWQKLy8gX19Nb2R1bGVzSW5mby5hZGRQdXNoTW9kdWxlCi8vIF9fTW9kdWxlc0luZm8ucG9wTW9kdWxlTG9hZFN0YWNrCi8vIF9fTW9kdWxlc0luZm8ucmVtb3ZlTW9kdWxlCi8vCi8vIEl0IGlzIGFsc28gdXNlZCBpbmRpcmVjdGx5IGJ5IFVzZS51c2UuanMKLy8gCgovLyBWYXJpb3VzIGZpbGVzIGluIHNjcmlwdHMvKi51c2UuanMgZGVwZW5kcyBvbiB0aGUgaW50ZXJmYWNlIGluIHRoaXMgZmlsZS4KCi8vIE5vdGUsIGZvciB2YXJpb3VzIG1vcmUgb3IgbGVzcyBvYnZpb3VzIHJlYXNvbnMsIHlvdSBjYW4gKm5vdCogdXNlIGFueSBvdGhlciBtb2R1bGVzCi8vIGZyb20gdGhpcyBmaWxlLiBNa2F5PwoKLy8gVGhpcyBpcyBub3QgbWVhbnQgdG8gYmUgZXh0ZXJuYWxseSBleHBvc2VkLgp2YXIgX19Nb2R1bGVzSW5mbyA9IGZ1bmN0aW9uKCApIHsKICAgIHZhciB0aGF0ID0ge307CgogICAgLy8gSGFzaCBmcm9tIG1vZHVsZU5hbWUgdG8gbW9kdWxlSW5mbzogbmFtZSwgdXJsLCBzeW1ib2xzLCBwb3NzaWJseSBvdGhlcnMgYXQgYSBsYXRlciB0aW1lLgogICAgdmFyIF9fbW9kdWxlcyA9IHt9OwoKICAgIC8vIFN0YWNrIG9mIG1vZHVsZXMgdGhhdCBhcmUgY3VycmVudGx5IGJlZWluZyBsb2FkZWQKICAgIHZhciBfX21vZHVsZUxvYWRTdGFjayA9IFsgXTsKCiAgICAvLyBDb3B5IG9mIHNlYXJjaFBhdGhzIGFzIHRoZXkgbG9va2VkLCB3aGVuIHRoZSBNb2R1bGVzSW5mbyBtb2R1bGUgd2FzIGxvYWRlZCwgYnkgdGhlIHVzZSBzeXN0ZW0uCiAgICB2YXIgX19zZWFyY2hQYXRocyA9IFsgXTsKICAgIAogICAgdGhhdC5hZGRTZWFyY2hQYXRoID0gZnVuY3Rpb24oIHBhdGggKSB7CiAgICAgICAgX19zZWFyY2hQYXRocy5wdXNoKCBwYXRoICk7CiAgICB9OwogICAgCiAgICAvLyBSZXR1cm4gcmVmZXJlbmNlIHRvIHRoZSBzZWFyY2hwYXRocyBpbiB1c2Ugd2hlbiB0aGUgbW9kdWxlc0luZm8gbW9kdWxlIHdhcyBsb2FkZWQuCiAgICAvLyBBIGNvcHkgaXMgcmV0dXJuZWQuCiAgICB0aGF0LmdldFNlYXJjaFBhdGhzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIF9fc2VhcmNoUGF0aHMuc2xpY2UoMCk7CiAgICB9CiAgICAKICAgIC8qIERlYnVnIGZ1bmN0aW9uCiAgICB0aGF0LnByaW50X2J1ZmZlciA9ICIiOwogICAgdmFyIG15cHJpbnQgPSBmdW5jdGlvbigpIHsKICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyArK2kgKSB7CiAgICAgICAgICAgIHRoYXQucHJpbnRfYnVmZmVyICs9IGFyZ3VtZW50c1tpXTsKICAgICAgICB9CiAgICB9CiovCiAgICAvLyBUaGlzIGZ1bmN0aW9uIGRvZXMgdHdvIHRoaW5ncy4gRmlyc3QgaXQgY2hlY2tzIGlmIHdlIGFyZSBjdXJyZW50bHkgbG9hZGluZyBhIG1vZHVsZS4KICAgIC8vIElmIHRoYXQgaXMgdGhlIGNhc2UsIHRoZW4gaXQgYXNzdW1lcyB0aGF0IHRoZSBtb2R1bGUgbmVlZCB0byB1c2UgdGhlIG1vZHVsZU5hbWUsIGFuZCBhZGRzIGl0CiAgICAvLyB0byB0aGUgbGlzdCBvZiB1c2VzIGZvciB0aGUgY3VycmVudGx5IGxvYWRpbmcgbW9kdWxlLgogICAgLy8gU2Vjb25kbHksIGl0IGNoZWNrcyBpZiB0aGUgbW9kdWxlIGhhcyBhbHJlYWR5IGJlZW4gbG9hZGVkIGFuZCByZXR1cm5zIHRydWUgb2YgZmFsc2UKICAgIC8vISBcdG9kbyBUaGlzIGlzIGFsbW9zdCBhbHdheXMgY2FsbGVkIG9uY2Ugd2l0aCB0aGUgbW9kdWxlIGl0IHNlbGYsIHdoaWxlIHdlIGFyZSBsb2FkaW5nIGl0LiBJIGFtIG5vdCBzdXJlIHdoeT8KICAgIHRoYXQuY2hlY2tEZXBBbHJlYWR5TG9hZGVkID0gZnVuY3Rpb24oIG1vZHVsZU5hbWUgKSB7CiAgICAgICAgLy8gICAgICAgIG15cHJpbnQoICJjaGVja0RlcEFscmVhZHlMb2FkZWQoICIgKyBtb2R1bGVOYW1lICsgIik7XG4iICk7CiAgICAgICAgaWYgKCB0aGlzLmlzTG9hZGluZ01vZHVsZSggKSApIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnRfbW9kdWxlID0gdGhpcy5jdXJyZW50TG9hZGluZ01vZHVsZSggKTsKICAgICAgICAgICAgaWYgKCBjdXJyZW50X21vZHVsZSAhPT0gbW9kdWxlTmFtZSApIHsgLy8gTm90IHN1cmUgd2h5IHRoaXMgaGFwcGVucy4KICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgIG15cHJpbnQoICIgIGlzTG9hZGluZ01vZHVsZTogIiArIHRoaXMuY3VycmVudExvYWRpbmdNb2R1bGUoKSArICIgaGFzIHVzZXM6ICIgKyBfX21vZHVsZXNbIHRoaXMuY3VycmVudExvYWRpbmdNb2R1bGUoKSBdLnVzZXMgKyAiXG4iICk7CiAgICAgICAgICAgICAgICBpZiAoIC0xID09IF9fbW9kdWxlc1sgdGhpcy5jdXJyZW50TG9hZGluZ01vZHVsZSggKSBdLnVzZXMuaW5kZXhPZiggbW9kdWxlTmFtZSApICkgewogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICBteXByaW50KCAiICAgIHB1c2hpbmcgIiArIHRoaXMuY3VycmVudExvYWRpbmdNb2R1bGUoKSArICIgPT0+ICIgKyBtb2R1bGVOYW1lICsgIlxuIiApOwogICAgICAgICAgICAgICAgICAgIF9fbW9kdWxlc1sgdGhpcy5jdXJyZW50TG9hZGluZ01vZHVsZSggKSBdLnVzZXMucHVzaCggbW9kdWxlTmFtZSApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmhhc01vZHVsZSggbW9kdWxlTmFtZSApOwogICAgfTsKCiAgICB0aGF0Lmhhc01vZHVsZSA9IGZ1bmN0aW9uKCBtb2R1bGVOYW1lICkgewogICAgICAgIHJldHVybiBtb2R1bGVOYW1lIGluIF9fbW9kdWxlczsKICAgIH0KCiAgICB0aGF0LmdldE1vZHVsZSA9IGZ1bmN0aW9uKCBtb2R1bGVOYW1lICkgewogICAgICAgIGlmICggIXRoaXMuaGFzTW9kdWxlKCBtb2R1bGVOYW1lICkgKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvciggImdldE1vZHVsZTogTW9kdWxlICciICsgbW9kdWxlTmFtZSArICInIGlzIG5vdCByZWdpc3RlcmVkIiApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX19tb2R1bGVzWyBtb2R1bGVOYW1lIF07CiAgICB9OwoKICAgIHRoYXQuYWRkUHVzaE1vZHVsZSA9IGZ1bmN0aW9uKCBtb2R1bGVOYW1lLCB1cmwgKSB7CiAgICAgICAgaWYgKCB0aGlzLmhhc01vZHVsZSggbW9kdWxlTmFtZSApICkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoICJhZGRQdXNoTW9kdWxlOiBNb2R1bGUgJyIgKyBtb2R1bGVOYW1lICsgIicgaXMgYWxyZWFkeSByZWdpc3RlcmVkIHdpdGggdXJsOiAnIiArIHRoaXMuZ2V0TW9kdWxlKCBtb2R1bGVOYW1lICkudXJsICsgIiciICk7CiAgICAgICAgfQogICAgICAgIF9fbW9kdWxlc1sgbW9kdWxlTmFtZSBdID0gewogICAgICAgICAgICBuYW1lOiBtb2R1bGVOYW1lLAogICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgc3ltYm9sczogWyBdLAogICAgICAgICAgICB1c2VzOiBbIF0KICAgICAgICB9OwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9fbW9kdWxlTG9hZFN0YWNrLnB1c2goIG1vZHVsZU5hbWUgKTsKICAgICAgICB9IGNhdGNoICggZSApIHsKICAgICAgICAgICAgZGVsZXRlIF9fbW9kdWxlc1sgbW9kdWxlTmFtZSBdOwogICAgICAgICAgICB0aHJvdyBlOwogICAgICAgIH0KICAgIH07CgogICAgLy8gU2V0IHRoZSB1cmwgb24gYSBtb2R1bGUuIFRoaXMgaXMgdXNlZCB0byBzZXQgdGhlIFVSTCBmb3IgYSBtb2R1bGUsIGFmdGVyIGxvYWRpbmcuLi4KICAgIC8vIFVzZSBjYXNlIGlzIHRoZSBNb2R1bGVzSW5mbyB1cmwuLi4KICAgIHRoYXQuc2V0TW9kdWxlVXJsID0gZnVuY3Rpb24oIG1vZHVsZU5hbWUsIHVybCApIHsKICAgICAgICBpZiAoICF0aGlzLmhhc01vZHVsZSggbW9kdWxlTmFtZSApICkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoICJzZXRNb2R1bGVVcmw6IE1vZHVsZSAnIiArIG1vZHVsZU5hbWUgKyAiJyBpcyBub3QgcmVnaXN0ZXJlZCIgKTsKICAgICAgICB9CiAgICAgICAgX19tb2R1bGVzWyBtb2R1bGVOYW1lIF0udXJsID0gdXJsOwogICAgfQoKICAgIHRoYXQucmVtb3ZlTW9kdWxlID0gZnVuY3Rpb24oIG1vZHVsZU5hbWUgKSB7CiAgICAgICAgaWYgKCAhdGhpcy5oYXNNb2R1bGUoIG1vZHVsZU5hbWUgKSApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCAicmVtb3ZlTW9kdWxlOiBNb2R1bGUgJyIgKyBtb2R1bGVOYW1lICsgIicgaXMgbm90IHJlZ2lzdGVyZWQiICk7CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSBfX21vZHVsZXNbIG1vZHVsZU5hbWUgXTsKICAgIH07CgogICAgdGhhdC5wb3BNb2R1bGVMb2FkU3RhY2sgPSBmdW5jdGlvbiggKSB7CiAgICAgICAgcmV0dXJuIF9fbW9kdWxlTG9hZFN0YWNrLnBvcCggKTsKICAgIH07CgogICAgdGhhdC5pc0xvYWRpbmdNb2R1bGUgPSBmdW5jdGlvbiggKSB7CiAgICAgICAgcmV0dXJuIF9fbW9kdWxlTG9hZFN0YWNrLmxlbmd0aCAhPT0gMDsKICAgIH07CgogICAgdGhhdC5jdXJyZW50TG9hZGluZ01vZHVsZSA9IGZ1bmN0aW9uKCApIHsKICAgICAgICBpZiAoICF0aGlzLmlzTG9hZGluZ01vZHVsZSggKSApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCAiY3VycmVudExvYWRNb2R1bGU6IE5vdCBjdXJyZW50bHkgbG9hZGluZyBhIG1vZHVsZSIgKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9fbW9kdWxlTG9hZFN0YWNrWyBfX21vZHVsZUxvYWRTdGFjay5sZW5ndGggLSAxIF07CiAgICB9OwoKICAgIC8vIFRoZSBzeW1ib2xzIGFycmF5IHBhc3NlZCwgaXMgY29waWVkCiAgICB0aGF0LmFkZFN5bWJvbHMgPSBmdW5jdGlvbiggbW9kdWxlTmFtZSwgc3ltYm9scyApIHsKICAgICAgICBpZiAoICF0aGlzLmhhc01vZHVsZSggbW9kdWxlTmFtZSApICkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoICJhZGRTeW1ib2xzOiBNb2R1bGUgJyIgKyBtb2R1bGVOYW1lICsgIicgaXMgbm90IHJlZ2lzdGVyZWQiICk7CiAgICAgICAgfQogICAgICAgIHRoaXMuZ2V0TW9kdWxlKCBtb2R1bGVOYW1lICkuc3ltYm9scyA9IHN5bWJvbHMubWFwKCBmdW5jdGlvbiggeCApIHsKICAgICAgICAgICAgICAgIHJldHVybiB4OwogICAgICAgICAgICB9ICk7CiAgICB9OwoKICAgIHRoYXQubW9kdWxlTmFtZXMgPSBmdW5jdGlvbiggKSB7CiAgICAgICAgdmFyIHJlcyA9IFsgXTsKICAgICAgICBmb3IgKCB2YXIgbSBpbiBfX21vZHVsZXMgKSB7CiAgICAgICAgICAgIGlmICggX19tb2R1bGVzLmhhc093blByb3BlcnR5KCBtICkgKSB7CiAgICAgICAgICAgICAgICByZXMucHVzaCggX19tb2R1bGVzWyBtIF0ubmFtZSApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXM7CiAgICB9OwoKICAgIHRoYXQuc2V0VmVyc2lvbiA9IGZ1bmN0aW9uKCBtb2R1bGVOYW1lLCB2ZXJzaW9uICkgewogICAgICAgIHRoaXMuZ2V0TW9kdWxlKCBtb2R1bGVOYW1lICkudmVyc2lvbiA9IHZlcnNpb247CiAgICB9OwoKICAgIHRoYXQuZ2V0VmVyc2lvbiA9IGZ1bmN0aW9uKCBtb2R1bGVOYW1lICkgewogICAgICAgIHJldHVybiB0aGlzLmdldE1vZHVsZSggbW9kdWxlTmFtZSApLnZlcnNpb247CiAgICB9OwoKICAgIC8vIFRoaXMgaXMgYSBiaXQgc2lsbHksIGl0IGluc2VydHMgaXRzZWxmLCB0aGVuIHJlbHkgb24gdGhlIAogICAgLy8gbW9kdWxlIHN5c3RlbSB0byBjb3JyZWN0IHRoZSB1cmwsIGlmIG5lZWRlZC4gCiAgICAvLyBUaGVyZSBhcmUgaGlzdG9yaWNhbCByZWFzb25zIHdoeSBpdCBlbmRlZCB1cCBsaWtlIHRoaXMKICAgIC8vIFJpZ2h0IG5vdywgaXQgaXMgaGFyZCB0byBjaGFuZ2UsIGJlY2F1c2UgaXQgd2lsbCBicmVhawogICAgLy8gaWYgbm90IGNvb3JkaW5hdGVkLCBzbyBsZWF2ZSBpdCBsaWtlIHRoaXMuCiAgICB0aGF0LmFkZFB1c2hNb2R1bGUoICJNb2R1bGVzSW5mbyIsICJ0aGUgaW5mbyBtb2R1bGUgaXRzZWxmIiApOwogICAgdGhhdC5wb3BNb2R1bGVMb2FkU3RhY2soICk7CgogICAgcmV0dXJuIHRoYXQ7Cn0oICk7CgovLyBBbiBpbnRlcmZhY2UgdGhhdCBjYW4gYmUgcHVibGljYWxseSB1c2VkCi8qKiAKICogTW9kdWxlIHRvIGdldCBpbmZvcm1hdGlvbiBhYm91dCBtb2R1bGVzLgogKgogKiBUaGlzIG5hbWVzcGFjZSBjdXJyZW50bHkgb25seSBzdXBwb3J0cyBhIGNvdXBsZSBvZiBtZXRob2RzLCB0aGF0CiAqIHJldHVybnMgaW5mb3JtYXRpb24gZGVzY3JpYmluZyB3aGVyZSBtb2R1bGVzIHdlcmUgbG9hZGVkIGZyb20uCiAqCiAqIEBuYW1lc3BhY2UgCiAqIEBuYW1lIE1vZHVsZXNJbmZvICovCnZhciBNb2R1bGVzSW5mbyA9IGZ1bmN0aW9uKCApIHsKICAgIHZhciB0aGF0ID0ge307CiAgICB2YXIgbW9kdWxlc19pbmZvID0gX19Nb2R1bGVzSW5mbzsKCiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgd2l0aCBhbiB1cmwgZm9yIGFsbCBsb2FkZWQgbW9kdWxlcy4KICAgICAqIAogICAgICogVGhpcyBtZXRob2QgaXMgbWVhbnQgYXMgYW4gYWlkIGZvciBlLmcuIHNlcnZlciBwcm9ncmFtcywgdGhhdCBjYW4KICAgICAqIHJlcG9ydCwgdXNpbmcgdGhlaXIgbG9nIG9yIHNpbWlsYXIsIHdoZXJlIG1vZHVsZXMgd2hlcmUgbG9hZGVkIGZyb20uCiAgICAgKiAKICAgICAqIEBzeW50YXggTW9kdWxlc0luZm8uZ2V0TW9kdWxlVXJscygpOwogICAgICogQHJldHVybiB7U3RyaW5nfSBBIHN0cmluZyBvZiBtb2R1bGUgbmFtZXMgYW5kIHRoZWlyIGFzc29jaWF0ZWQgdXJscwogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgTW9kdWxlc0luZm8uZ2V0TW9kdWxlVXJscyAqLwogICAgdGhhdC5nZXRNb2R1bGVVcmxzID0gZnVuY3Rpb24oICkgewogICAgICAgIHZhciBrZXlzID0gbW9kdWxlc19pbmZvLm1vZHVsZU5hbWVzKCApLnNvcnQoICk7CiAgICAgICAgdmFyIHJlcyA9ICIiOwogICAgICAgIHZhciBwcmUgPSAiIjsKICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgKytpICkgewogICAgICAgICAgICByZXMgKz0gcHJlICsga2V5c1sgaSBdICsgIiA9PiAiICsgbW9kdWxlc19pbmZvLmdldE1vZHVsZSgga2V5c1sgaSBdICkudXJsOwogICAgICAgICAgICBwcmUgPSAiXG4iOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzOwogICAgfTsKICAgIAogICAgLyoqIFJldHVybnMgYSBzdHJpbmcgd2l0aCB0aGUgdXJsIGZvciBhIHNpbmdsZSwgbmFtZWQgbW9kdWxlLgogICAgICoKICAgICAqIFRoaXMgbWV0aG9kIHJldHVybnMgdGhlIHVybCBvZiBhIHNpbmdsZSBuYW1lIG1vZHVsZSwgb3IgYW4KICAgICAqIGV4Y2VwdGlvbiwgaWYgdGhlIG1vZHVsZSBpcyBub3QgZm91bmQuCiAgICAgKgogICAgICogQHN5bnRheCBNb2R1bGVzSW5mby5nZXRNb2R1bGVVcmwoIG1vZHVsZSApCiAgICAgKiBAcmV0dXJuIFRoZSBVUkwgZm9yIHRoZSBtb2R1bGUKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBUaGUgbmFtZSBvZiB0aGUgbW9kdWxlCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBNb2R1bGVzSW5mby5nZXRNb2R1bGVVcmwgKi8KICAgIHRoYXQuZ2V0TW9kdWxlVXJsID0gZnVuY3Rpb24oIG1vZHVsZSApIHsKICAgICAgICByZXR1cm4gbW9kdWxlc19pbmZvLmdldE1vZHVsZSggbW9kdWxlICkudXJsOwogICAgfQoKICAgIHJldHVybiB0aGF0Owp9KCApOwo=", "moduleName": "ModulesInfo"}, {"javascript": "LyoqIEBmaWxlIENvcmUgdXNlIGZ1bmN0aW9uYWxpdHkgKi8KLy8gV0FSTklORzogSWYgeW91IGJyZWFrIHRoaXMgZmlsZSwgdGhlIG1vZHVsZSBzeXN0ZW0gd2lsbCBzdG9wIHdvcmtpbmchCgovLyBUaGlzIGZpbGUgZGVmaW5lcyB0aGUgZnVuY3Rpb24gYHVzZShtb2R1bGUtbmFtZSwgdmVyc2lvbi1udW1iZXIpYCwKLy8gd2hpY2ggaXMgdXNlZCBmb3IgbG9hZGluZyBtb2R1bGVzLgovLyBUaGUgbW9kdWxlLW5hbWUgaXMgcmVzb2x2ZWQsIGFuZCB0aGUgbW9kdWxlIGlzIGxvYWRlZCwKLy8gaWYgbm90IGFscmVhZHkgYXZhaWxhYmxlLgovLyBUaGUgdmVyc2lvbi1udW1iZXIgaXMgb3B0aW9uYWwgYW5kIGluZGljYXRlcyB3aGljaCB2ZXJzaW9uIG9mCi8vIHRoZSBtb2R1bGUgdGhhdCBpcyByZXF1aXJlZCwgYW5kIHVzZWQgdG8gY2hlY2sgaWYgdGhlIG1vZHVsZQovLyBpcyBjb21wYXRpYmxlIHdpdGggdGhlIGNvZGUuCi8vCi8vIEEgbW9kdWxlIG11c3QgZGVmaW5lIGEgZ2xvYmFsIHZhcmlhYmxlIGBFWFBPUlRFRF9TWU1CT0xTYAovLyB3aGljaCBsaXN0cyB0aGUgZ2xvYmFsIHZhcmlhYmxlIGl0IGV4cG9ydHMuCi8vIFRoZSBvcHRpb25hbCBnbG9iYWwgdmFyaWFibGUgYElHTk9SRURfU1lNQk9MU2AgY2FuIGJlIGFkZGVkLAovLyB3aGljaCBzdXBwcmVzc2VzIHdhcm5pbmdzIGlmIHRob3NlIHN5bWJvbHMgYXJlIHdyaXR0ZW4gdG8uCi8vIEl0IGFsc28gaGFzIHRoZSBvcHRpb24gb2YgYWRkaW5nIGEgdGhyZWUtcGFydCBzdHJpbmcgdmVyc2lvbiBudW1iZXIKLy8gYSBsYTogIjEuNC41NyIgaW4gYSBgVkVSU0lPTmAgdmFyaWFibGUgd2hpY2ggY2FuIGJlIGNoZWNrZWQgZm9yLgovLwovLyBJdCBhbHNvIGVuc3VyZXMgdGhhdCBhIGdpdmVuIG1vZHVsZSBpcyBvbmx5IGxvYWRlZCBvbmNlLAovLyBhbmQgbWFrZXMgc29tZSBjaGVja3Mgb24gdmVyc2lvbiBudW1iZXJzIGFuZCB3aGV0aGVyCi8vIGdsb2JhbCB2YXJpYWJsZXMgYXJlIHdyaXR0ZW4KLy8KLy8gUmVzb2x1dGlvbiBvZiBtb2R1bGUgbmFtZSBpcyBjdXJyZW50bHkgZG9uZSBpbgovLyB0aGUgbmF0aXZlIGVtYmVkZGluZyBjb2RlLgovLwovLyBqc2xpYiBkZXBlbmRzIG9uLCBhbmQgbG9hZHMgdGhpcyBtb2R1bGUuCgp1c2UgPSAoIGZ1bmN0aW9uKCApIHsKCiAgICAgICAgLy8gdGhpcyBvYmplY3QgY29udGFpbnMgYWxsIHZhcmlhYmxlcyBleHBvcnRlZCBmcm9tIG1vZHVsZXMKICAgICAgICAvLyBhbmQgaXMgc3RhdGljLCB2aWEgY2xvc3VyZQogICAgICAgIHZhciBleHBvcnRzID0ge307CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCBuYW1lLCB2ZXJzaW9uICkgewogICAgICAgICAgICB2YXIgZWxlbSwgaTsKCiAgICAgICAgICAgIC8vIHN5bWJvbHMgdGhhdCBhcmUgaWdub3JlZCB3aGVuIGNoZWNraW5nIGZvcgogICAgICAgICAgICAvLyBtb2R1bGUtd3JpdGVzIHRvIHRoZSBnbG9iYWwgc2NvcGUKICAgICAgICAgICAgdmFyIGlnbm9yZSA9IHsKICAgICAgICAgICAgICAgICdFWFBPUlRFRF9TWU1CT0xTJzogdHJ1ZSwKICAgICAgICAgICAgICAgICdJR05PUkVEX1NZTUJPTFMnOiB0cnVlLAogICAgICAgICAgICAgICAgJ1ZFUlNJT04nOiB0cnVlCiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBnbG9iYWwgc2NvcGUKICAgICAgICAgICAgdmFyIGdsb2JhbHMgPSAoIGZ1bmN0aW9uKCApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICAgIH0gKSggKTsKCiAgICAgICAgICAgIC8vIHF1aXQgaWYgbW9kdWxlIGlzIGFscmVhZHkgbG9hZGVkCiAgICAgICAgICAgIGlmICggZ2xvYmFscy5oYXNPd25Qcm9wZXJ0eSggJ19fTW9kdWxlc0luZm8nICkgJiYgX19Nb2R1bGVzSW5mby5jaGVja0RlcEFscmVhZHlMb2FkZWQoIG5hbWUgKSApIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gc2hhbGxvdyBjb3B5IG9mIGdsb2JhbCBzY29wZSwgdXNlZCB0byBjaGVjayBmb3Igd3JpdGVzCiAgICAgICAgICAgIHZhciBvbGRHbG9iYWxzID0ge307CiAgICAgICAgICAgIGZvciAoIGVsZW0gaW4gZ2xvYmFscyApIHsKICAgICAgICAgICAgICAgIGlmICggZ2xvYmFscy5oYXNPd25Qcm9wZXJ0eSggZWxlbSApICkgewogICAgICAgICAgICAgICAgICAgIG9sZEdsb2JhbHNbIGVsZW0gXSA9IGdsb2JhbHNbIGVsZW0gXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbmFtZSByZXNvbHV0aW9uIGlzIGRvbmUgaW4gdGhlIG5hdGl2ZSBmdW5jdGlvbiBgX19idWlsdGluX3VzZWAKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gRm9yIHRoZSBTcGlkZXJNb25rZXkgaW1wbGVtZW50YXRpb24sIHdlIHdhbnQgdG8gcmV0aHJvdyBwb3NzaWJsZSBleGNlcHRpb24KICAgICAgICAgICAgLy8gdG8gZ2V0IGZpbGUgbmFtZSBldGMuIHdpdGggZXJyb3IgYXMgdGhlIG5hdGl2ZSBlcnJvciBkb2Vzbid0IGluY2x1ZGUgdGhhdC4KICAgICAgICAgICAgLy8gV2UgZG8gbm90IGhhdmUgYSBnb29kIHdheSB0byBkZXRlcm1pbmUgb25lIG9yIHRoZSBvdGhlciwgdGhpcyBpcyBraW5kIG9mCiAgICAgICAgICAgIC8vIGhhY2tpc2g6IHJlbHkgb24gUGFja2FnZXMuamF2YSAtIGlmIHByZXNlbnQgYW5kIG9iamVjdCwgdGhpcyBpcyBSaGluby9KYXZhIGJhY2tlbmQKICAgICAgICAgICAgLy8gSWYgbm90LCB0aGlzIGlzIHNwaWRlcm1vbmtleQogICAgICAgICAgICAvLyBOb3RlOiBUaGlzIG1vZHVsZSBjYW4gbm90IHJlbHkgb24gYW55IG90aGVyIG1vZHVsZXMsIGFzIGl0IGlzCiAgICAgICAgICAgIC8vIHRoZSBsb2FkZXIgbW9kdWxlLi4uLiBjYXBpc2g/CiAgICAgICAgICAgIGlmKCB0eXBlb2YoIF9fZW52aXJvbm1lbnQgKSA9PT0gIm9iamVjdCIgKSB7CiAgICAgICAgICAgICAgICAvLyBKU0xpYiB3aXRoIE5hc2hvcm4KICAgICAgICAgICAgICAgIF9fZW52aXJvbm1lbnQudXNlKCBuYW1lICk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoICggdHlwZW9mIFBhY2thZ2VzID09PSAib2JqZWN0IiApICYmICggdHlwZW9mIFBhY2thZ2VzLmphdmEgPT09ICJvYmplY3QiICkgKSB7CiAgICAgICAgICAgICAgICAvLyBSaGluby9KYXZhIHBhdGgKICAgICAgICAgICAgICAgIF9fYnVpbHRpbl91c2UoIG5hbWUgKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIFNwaWRlck1vbmtleS9DL0MrKyBwYXRoCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIF9fYnVpbHRpbl91c2UoIG5hbWUgKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKCBlICkgewogICAgICAgICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gbW9kdWxlcyBtdXN0IGluaXRpYWxpc2UgYW4gRVhQT1JURURfU1lNQk9MUyB2YXJpYWJsZS4KICAgICAgICAgICAgLy8gVGhpcyBpcyBpbnNwaXJlZGUgYnkgbW96aWxsYSdzIG1vZHVsZSBzeXN0ZW0sIHNlZSBhbHNvCiAgICAgICAgICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL0phdmFTY3JpcHRfY29kZV9tb2R1bGVzL1VzaW5nCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIHRoaXMgY29kZSB0aHJvd3MgaWYgdGhlIHZhcmlhYmxlIGlzIG5vdCBkZWZpbmVkCiAgICAgICAgICAgIC8vIG9yIGlmIGl0IGlzIG5vdCBvZiB0aGUgcHJvcGVyIHR5cGUuCiAgICAgICAgICAgIGlmICggIWdsb2JhbHMuaGFzT3duUHJvcGVydHkoICdFWFBPUlRFRF9TWU1CT0xTJyApIHx8IHR5cGVvZiBFWFBPUlRFRF9TWU1CT0xTICE9PSAnb2JqZWN0JyB8fCBFWFBPUlRFRF9TWU1CT0xTLmNvbnN0cnVjdG9yICE9PSBBcnJheSApIHsKICAgICAgICAgICAgICAgIHRocm93ICdVc2UgZXJyb3I6IG1vZHVsZSAiJyArIG5hbWUgKyAnIiBkb2VzIG5vdCBpbml0aWFsaXNlIGFycmF5IEVYUE9SVEVEX1NZTUJPTFMuJzsKICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIC8vIHZlcnNpb24gb2YgdGhlIG1vZHVsZQogICAgICAgICAgICBnbG9iYWxzLlZFUlNJT04gPSBnbG9iYWxzLlZFUlNJT04gfHwgIjAuMC4wIgoKCiAgICAgICAgICAgIC8vIGlmIGB1c2UoLi4uKWAgcmVxdWlyZXMgYSBjZXJ0YWluIHZlcnNpb24sCiAgICAgICAgICAgIC8vIHRlc3QgaWYgdGhlIG1vZHVsZSBzdXBwbGllcyB0aGF0CiAgICAgICAgICAgIC8vIG9yIG90aGVyd2lzZSB0aHJvdyBhbiBlcnJvcgogICAgICAgICAgICBpZiAoIHZlcnNpb24gKSB7CiAgICAgICAgICAgICAgICB2YXIgdmVyc2lvbmVycm9yID0gIlJlcXVlc3RpbmcgdmVyc2lvbiAiICsgdW5ldmFsKCB2ZXJzaW9uICkgKyAiIG9mIG1vZHVsZSAiICsgbmFtZSArICIgd2hpY2ggaXMgdmVyc2lvbiAiICsgdW5ldmFsKCBWRVJTSU9OICk7CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gc3BsaXR2ZXJzaW9uKCB2ICkgewogICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSAoIHR5cGVvZiggdiApID09PSAic3RyaW5nIiApICYmIHYuc3BsaXQoICIuIiApLm1hcCggZnVuY3Rpb24oIHMgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQoIHMsIDEwICkKICAgICAgICAgICAgICAgICAgICAgICAgfSApOwogICAgICAgICAgICAgICAgICAgIGlmICggcmVzdWx0LmNvbnN0cnVjdG9yICE9PSBBcnJheSB8fCByZXN1bHQubGVuZ3RoICE9PSAzIHx8IHJlc3VsdC5qb2luKCAiLiIgKSAhPT0gdiApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgdmVyc2lvbmVycm9yOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIG1vZHVsZXZlcnNpb24gPSBzcGxpdHZlcnNpb24oIFZFUlNJT04gKTsKICAgICAgICAgICAgICAgIHZlcnNpb24gPSBzcGxpdHZlcnNpb24oIHZlcnNpb24gKTsKICAgICAgICAgICAgICAgIGlmICggISggbW9kdWxldmVyc2lvblsgMCBdID09IHZlcnNpb25bIDAgXSAmJiAoIG1vZHVsZXZlcnNpb25bIDEgXSA+IHZlcnNpb25bIDEgXSB8fCAoIG1vZHVsZXZlcnNpb25bIDEgXSA9PT0gdmVyc2lvblsgMSBdICYmIG1vZHVsZXZlcnNpb25bIDIgXSA+PSB2ZXJzaW9uWyAyIF0gKSApICkgKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgdmVyc2lvbmVycm9yOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8qIFRPRE86IHNlZW1zIGxpa2Ugd2UgZG9udCBjaGVjayB2ZXJzaW9uIG51bWJlcgogICAgICAgICAgIGlmIG1vZHVsZSBpcyBhbHJlYWR5IGxvYWRlZC4uLiAqLwogICAgICAgICAgICBfX01vZHVsZXNJbmZvLnNldFZlcnNpb24oIG5hbWUsIFZFUlNJT04gKTsKCiAgICAgICAgICAgIC8vIG1iZDogQWRkIHN5bWJvbHMgdG8gTW9kdWxlc0luZm8KICAgICAgICAgICAgX19Nb2R1bGVzSW5mby5hZGRTeW1ib2xzKCBuYW1lLCBFWFBPUlRFRF9TWU1CT0xTICk7CgogICAgICAgICAgICAvLyBtYmQ6IEkgd29uZGVyIHdoeSB0aGlzIGlzIG5lZWRlZD8KICAgICAgICAgICAgLy8gcmplOiBXaGVuIGxvYWRpbmcgYSBtb2R1bGUsIHdlIGNyZWF0ZSAob3IgY2hhbmdlKSB0aGUgZ2xvYmFsIHZhcmlhYmxlIF9fTW9kdWxlc0luZm8KICAgICAgICAgICAgLy8gcmplOiBhbmQgdGh1cyBpdCBuZWVkcyB0byBleHBvcnRlZCwgb3Igd2Ugd291bGQgZ2V0IGEgd2FybmluZyBmcm9tIHRoZSBtb2R1bGUgc3lzdGVtLgogICAgICAgICAgICAvLyByamU6IENvdWxkIGJlIGhhbmRsZWQgYXMgYSBzcGVjaWFsIGNhc2UgaW4gdGhlIGNvZGUgaW5zdGVhZCwgYnV0IEkgZmluZCBpdCBzaW1wbGVyCiAgICAgICAgICAgIC8vIHJqZToganVzdCB0byBhZGQgaXQgdG8gdGhlIGV4cG9ydGVkIHN5bWJvbHMuCiAgICAgICAgICAgIEVYUE9SVEVEX1NZTUJPTFMucHVzaCggJ19fTW9kdWxlc0luZm8nICk7CgogICAgICAgICAgICAvLyBhcHBlbmQgYElHTk9SRURfU1lNQk9MU2AgdG8gYGlnbm9yZWAgbGlzdAogICAgICAgICAgICBpZiAoIGdsb2JhbHMuaGFzT3duUHJvcGVydHkoICdJR05PUkVEX1NZTUJPTFMnICkgKSB7CiAgICAgICAgICAgICAgICBmb3IgKCBpID0gMDsgaSA8IElHTk9SRURfU1lNQk9MUy5sZW5ndGg7ICsraSApIHsKICAgICAgICAgICAgICAgICAgICBlbGVtID0gSUdOT1JFRF9TWU1CT0xTWyBpIF07CiAgICAgICAgICAgICAgICAgICAgaWdub3JlWyBlbGVtIF0gPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB3YXJuIGlmIGBFWFBPUlRFRF9TWU1CT0xTYCBpcyBub3QgZXhwb3J0ZWQKICAgICAgICAgICAgZm9yICggaSA9IDA7IGkgPCBFWFBPUlRFRF9TWU1CT0xTLmxlbmd0aDsgKytpICkgewogICAgICAgICAgICAgICAgZWxlbSA9IEVYUE9SVEVEX1NZTUJPTFNbIGkgXTsKICAgICAgICAgICAgICAgIGlmICggZ2xvYmFscy5oYXNPd25Qcm9wZXJ0eSggJ3ByaW50JyApICYmICFnbG9iYWxzLmhhc093blByb3BlcnR5KCBlbGVtICkgKSB7CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoICdXYXJuaW5nOiBtb2R1bGUgIicgKyBuYW1lICsgJyIgc2F5cyBpdCBleHBvcnRzIGdsb2JhbCAiJyArIGVsZW0gKyAnIiB3aGljaCBkb2VzIG5vdCBleGlzdFxuJyApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZXhwb3J0c1sgZWxlbSBdID0gZ2xvYmFsc1sgZWxlbSBdOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB3YXJuIGlmIG1vZHVsZSBjcmVhdGVzIG9yIGNoYW5nZXMgZ2xvYmFsIHN5bWJvbAogICAgICAgICAgICAvLyB3aGljaCBpcyBub3QgaW4gYElHTk9SRURfU1lNQk9MU2Agb3IgYEVYUE9SVEVEX1NZTUJPTFNgCiAgICAgICAgICAgIC8vIGFuZCBkZWxldGUgdGhlbSBpZiBjcmVhdGVkCiAgICAgICAgICAgIGZvciAoIGVsZW0gaW4gZ2xvYmFscyApIHsKICAgICAgICAgICAgICAgIGlmICggZ2xvYmFscy5oYXNPd25Qcm9wZXJ0eSggZWxlbSApICkgewoKICAgICAgICAgICAgICAgICAgICBpZiAoIG9sZEdsb2JhbHMuaGFzT3duUHJvcGVydHkoIGVsZW0gKSAmJiBvbGRHbG9iYWxzWyBlbGVtIF0gIT09IGdsb2JhbHNbIGVsZW0gXSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBnbG9iYWxzLmhhc093blByb3BlcnR5KCAncHJpbnQnICkgJiYgIWlnbm9yZVsgZWxlbSBdICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoICdXYXJuaW5nOiBtb2R1bGUgIicgKyBuYW1lICsgJyIgb3ZlcndyaXRlcyBnbG9iYWwgdmFyaWFibGUgJyArIGVsZW0gKyAnXG4nICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICggIWV4cG9ydHMuaGFzT3duUHJvcGVydHkoIGVsZW0gKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBvbGRHbG9iYWxzLmhhc093blByb3BlcnR5KCBlbGVtICkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWxzWyBlbGVtIF0gPSBvbGRHbG9iYWxzWyBlbGVtIF07CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIGdsb2JhbHMuaGFzT3duUHJvcGVydHkoICdwcmludCcgKSAmJiAhaWdub3JlWyBlbGVtIF0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCggJ1dhcm5pbmc6IG1vZHVsZSAiJyArIG5hbWUgKyAnIiBjcmVhdGVzIG5vbi1leHBvcnRlZCBnbG9iYWwgdmFyaWFibGUgJyArIGVsZW0gKyAnXG4nICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICFkZWxldGUgZ2xvYmFsc1sgZWxlbSBdICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbHNbIGVsZW0gXSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gKSggKTsKCi8vIE1vZHVsZXMgdG8gYmUgbG9hZGVkIGp1c3QgYWZ0ZXIgaW5pdGlhbGl6YXRpb24gb2YgbW9kdWxlIHN5c3RlbQp1c2UoICJVc2UuUmVxdWlyZWRNb2R1bGVzIiApOwo=", "moduleName": "Use"}, {"javascript": "LyoqIEBmaWxlIFJlcXVpcmVkIG1vZHVsZXMgKi8KCi8qKiAgCiAqIFRoaXMgaXMgZXhlY3V0ZWQganVzdCBhZnRlciB0aGUgbW9kdWxlIHN5c3RlbSAoVXNlLnVzZS5qcykgaGFzIGJlZW4gaW5pdGlhbGl6ZWQsCiAqIGhlbmNlIG1vZHVsZXMgd2hpY2ggYWx3YXlzIG5lZWQgdG8gYmUgbG9hZGVkIG1heSBiZSBhZGRlZCBoZXJlLgogKi8KdXNlKCAiRVM1IiApOwo=", "moduleName": "Use.RequiredModules"}, {"javascript": "Ly8gRHVtbXkgbW9kdWxlLCBUaGUgSmF2YSBpbXBsZW1lbnRhdGlvbiBzdXBwb3J0cyBtb3N0IG9mIEVTNS4KLy8gVGhpcyBpcyB0byBoYW5kbGUgdGhvc2UgbW9kdWxlcyB0aGF0IGluY2x1ZGVzIEVTNQpFWFBPUlRFRF9TWU1CT0xTPVtdOwo=", "moduleName": "ES5"}, {"javascript": "LyoqIEBmaWxlIEltcGxlbWVudGF0aW9uIG9mIGEgTG9nIG1vZHVsZS4gKi8KLy8gVGhpcyBtb2R1bGUgZGVwZW5kcyBvbiBhIHByb3ZpZGVkIExvZ0NvcmUgbW9kdWxlLCB3aGljaCBtdXN0Ci8vIHByb3ZpZGUgYSBmdW5jdGlvbiBfX0xvZ0NvcmVfbG9nIHRoYXQgdGFrZXMgdHdvIHN0cmluZyBhcmd1bWVudHMKLy8gYSBsZXZlbCwgYW5kIGFuIGFscmVhZHkgZm9ybWF0dGVkIG1lc3NhZy4gCi8vIEEgc2ltcGxlIExvZ0NvcmUgbW9kdWxlIHRoYXQgZG9lcyBsb2dnaW5nIHVzaW5nIFByaW50IHdpbGwgc3VmZmljZSwgb3IKLy8gaW4gbW9zdCBjYXNlcyBhIExvZ0NvcmUgbW9kdWxlIHByb3ZpZGVkIGJ5IHRoZSBlbnZpcm9ubWVudC4KdXNlKCAiTG9nQ29yZSIgKTsKdXNlKCAiTG9kYXNoIiApOyAvLyBGb3IgdGhlICdtYWdpYycgZXhwZXJpbWVudGFsIGZ1bmN0aW9uLgp1c2UoICJHbG9iYWwiICk7CgpFWFBPUlRFRF9TWU1CT0xTID0gWyAnTG9nJyBdOwoKLyoqCiAqIE5hbWVzcGFjZSB0aGF0IGNvbnRhaW5zIGZ1bmN0aW9ucyB0byBMb2cgd2l0aC4KICogCiAqIFRoaXMgbmFtZXNwYWNlIGNvbnRhaW5zIGZ1bmN0aW9ucyB1c2VkIGZvciBsb2dnaW5nLiBFYWNoIGZ1bmN0aW9uCiAqIHJlZmxlY3RzIGEgY2VydGFpbiBsZXZlbCBvZiB1cmdlbmN5IG9mIHRoZSBtZXNzYWdlIHRvIGJlIGxvZ2dlZC4KICogQWxsIGxvZ2dpbmcgbWV0aG9kcyBzdXBwb3J0cyBwYXNzaW5nIGEgdmFyaWFibGUgbnVtYmVyIG9mIGFyZ3VtZW50cy4gSWYgdGhlIGxvZyBzdGF0ZW1lbnQgbGV2ZWwgaXMgZW5hYmxlZAogKiBlYWNoIHBhcmFtZXRlciB3aWxsIGJlIGNvbnZlcnRlZCB0byBhIFN0cmluZyAoYnkgY2FsbGluZyBpdHMgdG9TdHJpbmcgbWV0aG9kKSwgYW5kIHRoZSBzdHJpbmdzIHdpbGwgYmUgY29uY2F0ZW5hdGVkLgogKgogKiAqKkEgbm90ZSBvbiB0aGUgbGV2ZWxzKiogIAogKiAKICogVGhlIGxvZyBsZXZlbHMgYXJlLCBmcm9tIGxvdy91bmltcG9ydGFudCB0byBoaWdoL2ltcG9ydGFudDogYHRyYWNlYCwKICogYGRlYnVnYCwgYGluZm9gLCBgd2FybmAsIGBlcnJvcmAsIGFuZCBgZmF0YWxgLiBUaGV5IGFyZSB1c2VkIHJvdWdobHkgYXMgc3VjaDoKICogCiAqICogYHRyYWNlYDogVmVyeSBkZXRhaWxlZCwgZnVuY3Rpb24gZW50ZXIvZXhpdCwgcGFyYW1ldGVyIGR1bXBzLCB1c3VhbGx5IG9ubHkgdXNlZCBmb3IgdHJhY2luZyBmdW5jdGlvbnMsIGFuZCBzcGVjaWZpYyBidWcgc29sdmluZy4KICogCiAqICogYGRlYnVnYDogRm9yIG9yZGluYXJ5IGRldmVsb3BtZW50LCBwcm9ncmFtIGZsb3csIGR1bXBpbmcgaW1wb3J0YW50IHZhbHVlcywgZXRjLgogKiAKICogKiBgaW5mb2A6IEluZm9ybWF0aW9uIGFib3V0IHRoZSBydW5uaW5nIHByb2dyYW0vc3lzdGVtIG9mIGEgbW9yZSBzdGF0dXMtbGlrZSBjaGFyYWN0ZXIsIGUuZy4gaG93IGZhciB0aGUgcHJvZ3JhbSBpcyBpbiBhIGdpdmVuIHByb2Nlc3MsIHRoYXQgc29tZXRoaW5nIHN0YXJ0ZWQgb3Igc3RvcHBlZCwgb3Igc2ltaWxhci4KICogCiAqICogYHdhcm5gOiBFeHBlY3RhdGlvbnMgdGhlIHByb2dyYW0gaGFkIGFib3V0IGZsb3cgb3IgZGF0YSBoYXMgbm90IGJlZW4gbWV0LCBidXQgdGhlIHByb2dyYW0gaXMgY2FwYWJsZSBvZiBjb250aW51aW5nLiBJdCBtaWdodCBpbmRpY2F0ZSB0aGF0IHRoZSB1c2VyL29wZXJhdG9yIGhhcyB0byBsb29rIGludG8gYW4gaXNzdWUgYW5kIHNvbHZlIGEgcHJvYmxlbS4KICogCiAqICogYGVycm9yYDogQW4gdW5leHBlY3RlZCBzaXR1YXRpb24gdGhhdCB0aGUgcHJvZ3JhbSBpcyB1bmFibGUgdG8gY29ycmVjdGx5IGhhbmRsZSwgaGFzIG9jY3VycmVkLiBUaGUgY3VycmVudCBwcm9jZXNzIGNhbiBub3QgcnVuIHVudGlsIGNvbXBsZXRpb24uIFRoaXMgbWlnaHQgYmUgbWlzc2luZyBkYXRhLCBvciBzaW1pbGFyLiBUaGUgdXNlci9vcGVyYXRvciBtdXN0IGxvb2sgaW50byB0aGUgaXNzdWUsIGFuZCBzb2x2ZSBpdC4KICogCiAqICogYGZhdGFsYDogQXMgZXJyb3IsIGJ1dCB0aGUgcHJvZ3JhbSBpcyB1bmFibGUgdG8gY29udGludWUgYXQgYWxsLCBhbmQgd2lsbCBzaHV0IGRvd24uIChOb3QgdXNlZCBtdWNoIGluIEphdmFTY3JpcHQsIGFuZCBub3Qgc3VwcG9ydGVkIGluIGFsbCBmcmFtZXdvcmtzKS4KICogCiAqICoqQSBub3RlIG9uIHBlcmZvcm1hbmNlKioKICogCiAqIFlvdSBhcmUgZW5jb3VyYWdlZCB0byBwYXNzIG11bHRpcGxlIHZhbHVlcywgaW5zdGVhZCBvZiAKICogdXNpbmcgc3RyaW5nIGNvbmNhdGVuYXRpb24gaW4gdGhlIGNhbGwgdG8gdGhlIGxvZ2dpbmcgbWV0aG9kLAogKiAgYXMgdGhlIGxvZyBtb2R1bGUgd2lsbCBza2lwIHRoZSB0b1N0cmluZyBjb252ZXJzaW9uIHByb2Nlc3MgYW5kIGNvbmNhdGVuYXRpb24sIHVudGlsIGl0IGRldGVybWluZXMgdGhhdCBpdCBuZWVkcwogKiB0byBwZXJmb3JtIHRoZSBhY3R1YWwgbG9nZ2luZy4gU2VlIHRoZSBleGFtcGxlLgogKiAKICogV2hlbiBsb2dnaW5nIHhtbCB2YXJpYWJsZXMgZm9yIGxldmVscyB0aGF0IG1pZ2h0IGJlIG9mdGVuIGJlIG9mZiAodHJhY2UsIGRlYnVnLCBpbmZvKSB5b3Ugc2hvdWxkIGNvbnNpZGVyIHVzaW5nCiAqICB7QGxpbmsgWG1sVXRpbC5sb2dYbWxTdHJpbmd9LCBpbnN0ZWFkIG9mIGNhbGxpbmcgdGhlIHhtbCBpbnN0YW5jZXMgdG9YbWxTdHJpbmcgbWV0aG9kLiBUaGlzIGVuc3VyZXMgdGhlIGJlc3QgcGVyZm9ybWFuY2UuCiAqIAogKiBAZXhhbXBsZQovLyBXaGVuIGxvZ2dpbmcsIHVzZSBtdWx0aXBsZSBwYXJhbWV0ZXJzIHRoYXQgc3VwcG9ydHMgdG9TdHJpbmcsIGluc3RlYWQgb2Ygc3RyaW5nIGNvbmNhdGVuYXRpb24uCi8vIEUuZy4gZG8gdGhpczoKTG9nLmRlYnVnKCAiVmFsdWUgb2YgZm9vLmJhcjogIiwgZm9vLmJhciwgIiwgdmFsdWUgb2YgZm9vLmZvbzogIiwgZm9vLmZvbyApOwovLyBJbnN0ZWFkIG9mIHRoaXM6CkxvZy5kZWJ1ZyggIlZhbHVlIG9mIGZvby5iYXI6ICIgKyBmb28uYmFyICsgIiwgdmFsdWUgb2YgZm9vLmZvbzogIiArIGZvby5mb28gKTsKICogCiAqIEBuYW1lc3BhY2UKICogQG5hbWUgTG9nCiAqLwp2YXIgTG9nID0gZnVuY3Rpb24oICkgewoKICAgIC8vIFN0b3JlIGEgY29weSB0byB0aGUgZnVuY3Rpb24gZnJvbSBMb2dDb3JlIC0gdGhlbiByZW1vdmUgaXQgZnJvbSB0aGUgZ2xvYmFsIHNjb3BlLgogICAgdmFyIExvZ0NvcmVfbG9nID0gX19Mb2dDb3JlX2xvZzsKICAgIGRlbGV0ZSB0aGlzLl9fTG9nQ29yZV9sb2c7CgogICAgLy8gUG9pbnRlciB0byBmdW5jdGlvbiB0aGF0IGNoZWNrcyBpZiBhIGdpdmVuIGxvZyBsZXZlbCBpcyBlbmFibGVkLiBPcHRpb25hbGx5IHN1cHBsaWVkIGJ5IExvZ0NvcmUuCiAgICB2YXIgTG9nQ29yZV9pc0xldmVsRW5hYmxlZCA9IHVuZGVmaW5lZDsKCiAgICAvLyBUaGUgb2JqZWN0IHRvIHJldHVybi4KICAgIHZhciB0aGF0ID0ge307ICAgIAogICAgCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gSGVscGVyIGZ1bmN0aW9uLgogICAgLy8gQ29sbGVjdCBhbiBhcmd1bWVudHMgb2JqZWN0IHRvIGEgc3RyaW5nLiBOb3RlLCBhcmdzIGlzICpub3QqIGFuIGFycmF5LCBidXQgYW4gaW5zdGFuY2Ugb2YgYW4gYXJndW1lbnRzIG9iamVjdC4KICAgIHZhciBjb2xsZWN0ID0gZnVuY3Rpb24oIGFyZ3MgKSB7CiAgICAgICAgc3dpdGNoKCBhcmdzLmxlbmd0aCApIHsKICAgICAgICBjYXNlIDA6IHJldHVybiAiIjsKICAgICAgICBjYXNlIDE6IHJldHVybiBhcmdzWzBdLnRvU3RyaW5nKCk7CiAgICAgICAgY2FzZSAyOiByZXR1cm4gYXJnc1swXS50b1N0cmluZygpICsgYXJnc1sxXS50b1N0cmluZygpOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHZhciBteXJlcyA9IGFyZ3NbMF07CiAgICAgICAgICAgIGZvciAoIHZhciBpID0gMTsgaSA8IGFyZ3MubGVuZ3RoOyArK2kgKSB7CiAgICAgICAgICAgICAgICBteXJlcyArPSBhcmdzWyBpIF0udG9TdHJpbmcoICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG15cmVzOwogICAgICAgIH07CiAgICB9OwoKICAgIC8vdGhpcyBpcyB0byBiZSBhYmxlIHRvIHRlc3QgdGhlIGludGVybmFsIGZ1bmN0aW9uIGNvbGxlY3QKICAgIHRoYXQuX19jb2xsZWN0ID0gY29sbGVjdDsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gSGVscGVyIGZ1bmN0aW9uLgogICAgLy8gQ29sbGVjdCBhbiBhcmd1bWVudHMgb2JqZWN0IHRvIGEgc3RyaW5nLiBOb3RlLCBhcmdzIGlzICpub3QqIGFuIGFycmF5LgogICAgLy8gVGhpcyB2ZXJzaW9uIGRvZXMgbm90IHRocm93LCBidXQgdHJpZXMgdG8gY29sbGVjdCBhcyBtdWNoIGFzIHBvc3NpYmx5CiAgICB2YXIgc2FmZUNvbGxlY3QgPSBmdW5jdGlvbiggYXJncyApIHsKICAgICAgICB2YXIgbXlyZXMgPSAiIjsKICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgKytpICkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgbXlyZXMgKz0gYXJnc1sgaSBdLnRvU3RyaW5nKCApOwogICAgICAgICAgICB9IGNhdGNoICggZSApIHsKICAgICAgICAgICAgICAgIG15cmVzICs9ICJbaWxsZWdhbC9udWxsL3VuZGVmaW5lZCB2YWx1ZSBhdCBwb3NpdGlvbiAiICsgaSArICJdIjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbXlyZXM7CiAgICB9OwoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBBY3R1YWwgbWV0aG9kcwoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBBY3R1YWwgbWV0aG9kcwogICAgLy8gQ29sbGVjdCB0aGUgYXJncywgdGhlbiBsb2cgdGhlbSB1c2luZyB0aGUgbGV2ZWwuCiAgICAvLyBOb3RlLCBhcmdzIGlzIG5vdCBhbiBhcnJheSwgYnV0IGFuIGluc3RhbmNlIG9mIGFuIGFyZ3VtZW50cyBvYmplY3QuCiAgICB2YXIgbG9nID0gZnVuY3Rpb24oIGxldmVsLCBhcmdzICkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIExvZ0NvcmVfbG9nKCBsZXZlbCwgY29sbGVjdCggYXJncyApICk7CiAgICAgICAgfSBjYXRjaCAoIGVycm9yICkgewogICAgICAgICAgICB2YXIgbXNnID0gIkVycm9yIHdoaWxlIGNhbGxpbmcgZm9ybWF0dGluZyBsb2cuIE9uZSBvciBtb3JlIHZhbHVlcyBwYXNzZWQgdG8gbG9nIHdhcyBwcm9iYWJseSBudWxsIG9yIHVuZGVmaW5lZC4gU3Vic3RpdHV0ZWQgbGluZSBmb2xsb3dzOlxuIjsKICAgICAgICAgICAgbXNnICs9IHNhZmVDb2xsZWN0KCBhcmdzICkgKyAiXG4iOwogICAgICAgICAgICBpZiAoIGVycm9yLnN0YWNrICYmICIiICE9IGVycm9yLnN0YWNrICkgewogICAgICAgICAgICAgICAgbXNnICs9ICJEaXNwbGF5aW5nIHN0YWNrOiAiICsgZXJyb3Iuc3RhY2sucmVwbGFjZSggLyhAW146XFtdKjopL2csICJcbiQxIiApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIExvZ0NvcmVfbG9nKCAid2FybiIsIG1zZyApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfTsKCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBBY3R1YWwgdXNlciBleHBvc2VkIGZ1bmN0aW9ucy9zdHVmZgogICAgCiAgICAvLyBTZXR0aW5nIHVwIGxldmVsIHByb3BlcnRpZXMKICAgIC8qKiAKICAgICAqIEVudW0gZm9yIGxvZyBsZXZlbHMuCiAgICAgKiAKICAgICAqIFVzZSB0aGlzIGVudW0gd2hlbiBjYWxsaW5nIGlzTGV2ZWxFbmFibGVkLgogICAgICogCiAgICAgKiBUaGlzIGVudW0gaGFzIHByb3BlcnRpZXMgYHRyYWNlYCwgYGRlYnVnYCwgYGluZm9gLCBgd2FybmAgYW5kIGBlcnJvcmAuIFVzZSB0aGVtIHdoZW4gY2FsbGluZyBpc0xldmVsRW5hYmxlZC4KICAgICAqIAogICAgICogQHNlZSB7QGxpbmsgTG9nLmlzTGV2ZWxFbmFibGVkfQogICAgICogQGV4YW1wbGUKLy8gQ2hlY2sgaWYgaW5mbyBsZXZlbCBpcyBlbmFibGVkLCB0aGVuIGxvZy4KaWYgKCBMb2cuaXNMZXZlbEVuYWJsZWQoIExvZy5MZXZlbC5pbmZvICkgKSB7CiAgICBMb2cuaW5mbyggIlRoZSByZXN1bHQgb2YgY2FsbGluZyBzbG93X2Z1bmN0aW9uIGlzIDogIiwgc2xvd19mdW5jdGlvbigpICk7Cn0KICAgICAqIAogICAgICogQHJlYWRvbmx5CiAgICAgKiBAZW51bSB7U3RyaW5nfQogICAgICogQG5hbWUgTG9nLkxldmVsCiAgICAgKi8KICAgIHRoYXQuTGV2ZWwgPSB7IAogICAgICAgICAgICAvKiogVGhlIHRyYWNlIGxldmVsICovCiAgICAgICAgICAgIHRyYWNlIDogInRyYWNlIiwgCiAgICAgICAgICAgIC8qKiBUaGUgZGVidWcgbGV2ZWwgKi8KICAgICAgICAgICAgZGVidWcgOiAiZGVidWciLAogICAgICAgICAgICAvKiogVGhlIGluZm8gbGV2ZWwgKi8KICAgICAgICAgICAgaW5mbyAgOiAiaW5mbyIsIAogICAgICAgICAgICAvKiogVGhlIHdhcm4gbGV2ZWwgKi8KICAgICAgICAgICAgd2FybiAgOiAid2FybiIsCiAgICAgICAgICAgIC8qKiBUaGUgZXJyb3IgbGV2ZWwgKi8KICAgICAgICAgICAgZXJyb3IgOiAiZXJyb3IiCiAgICB9OwogICAgCiAgIC8qKgogICAgKiAgQ2hlY2sgaWYgYSBsb2cgbGV2ZWwgaXMgZW5hYmxlZC4KICAgICogIAogICAgKiAgUmV0dXJuIHRydWUgaWYgYSBsb2cgbGV2ZWwgaXMgZW5hYmxlZCwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgKiAgCiAgICAqICBUaGlzIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIHdoZW4gbG9nZ2luZyBvYmplY3RzIHRoYXQgYXJlIGV4cGVuc2l2ZSB0byBldmFsdWF0ZSB3aGVuIHBhc3NpbmcgdG8gdGhlIGxvZyBzeXN0ZW0uCiAgICAqICBCeSBvbmx5IGNvbmRpdGlvbmFsbHkgZXZhbHVhdGluZywgeW91IGNhbiBtYWtlIHRoZSBwcm9ncmFtIGdvIGZhc3Rlciwgd2hpY2ggY2FuIGJlIGhhbmR5IGluIHNvbWUgc2l0dWF0aW9ucy4KICAgICogIAogICAgKiAgKipOb3RlOioqIFlvdSBkbyBub3QgbmVlZCB0aGlzIGluIG1vc3Qgc2l0dWF0aW9ucywgb25seSB3aGVuIHlvdSBuZWVkIHRvIGNhbGwgc2xvdyBmdW5jdGlvbnMsIG9yIHNpbWlsYXIsIGluIGNhc2Ugb2YgbG9nZ2luZy4gVGhlIExvZyBvYmplY3Qgb25seSBjYWxscyB0aGUgdW5kZXJseWluZyBMb2cgZnJhbWV3b3JrLCBpZiBpdCBuZWVkcyB0by4KICAgICogIAogICAgKiAgKipOb3RlOioqIFRoaXMgZnVuY3Rpb25hbGl0eSByZXF1aXJlcyB0aGUgdW5kZXJseWluZyBMb2cgZnJhbWV3b3JrIHRvIHN1cHBvcnQgcmV0cmVpdmluZyB0aGlzIGtpbmQgb2YgaW5mb3JtYXRpb24uCiAgICAqICAKICAgICAqIEBzZWUge0BsaW5rIExvZy5MZXZlbH0KICAgICogIEBleGFtcGxlCi8vIE9ubHkgcGVyZm9ybSBldmFsdWF0aW9uLCBpZiBsb2cgbGV2ZWwgaXMgZW5hYmxlZAppZiAoIExvZy5pc0xldmVsRW5hYmxlZCggTG9nLkxldmVsLmRlYnVnICkgKSB7CiAgICBMb2cuZGVidWcoICJUaGUgcmVzdWx0IG9mIGNhbGxpbmcgc2xvd19mdW5jdGlvbiBpcyA6ICIsIHNsb3dfZnVuY3Rpb24oKSApOwp9CiAgICAqICAKICAgICogIEBleGFtcGxlCi8vIE5vIHJlYXNvbiB0byB1c2UgaW4gb3JkaW5hcnkgY2FzZQovLyBEb24ndCBkbyB0aGlzIG5vcm1hbGx5CmlmICggTG9nLmlzTGV2ZWxFbmFibGVkKCBMb2cuTGV2ZWwuZGVidWcgKSApIHsKICAgIExvZy5kZWJ1ZyggIkkgbmVlZCB0byBsb2cgdGhlIHZhbHVlIG9mIHNvbWV0aGluZyA6Iiwgc29tZV92YWx1ZSApOwp9Ci8vIEluc3RlYWQsIGRvIHRoaXMKTG9nLmRlYnVnKCAiSSBuZWVkIHRvIGxvZyB0aGUgdmFsdWUgb2Ygc29tZXRoaW5nIDoiLCBzb21lX3ZhbHVlICk7CiAgICAqCiAgICAqICBAc3ludGF4IExvZy5pc0xldmVsRW5hYmxlZCggbGV2ZWwgKQogICAgKiAgQHBhcmFtIGxldmVsIFRoZSBsZXZlbCB0byBldmFsdWF0ZS4gVXNlIHRoZSBMZXZlbCBwcm9wZXJ0eSBjb25zdGFudHMuCiAgICAqICBAcmV0dXJuIHtCb29sZWFufSBUcnVlIGlmIHRoZSBsb2cgbGV2ZWwgaXMgZW5hYmxlZCwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgKiAgCiAgICAqICBAbmFtZSBMb2cuaXNMZXZlbEVuYWJsZWQKICAgICogIEBtZXRob2QKICAgICovICAgICAKICAgIHRoYXQuaXNMZXZlbEVuYWJsZWQgPSBmdW5jdGlvbiggbGV2ZWwgKSB7CiAgICAgICAgcmV0dXJuIExvZ0NvcmVfaXNMZXZlbEVuYWJsZWQoIGxldmVsICk7CiAgICB9CiAgICAKICAgIAogICAvKioKICAgKiBMb2cgYSBtZXNzYWdlIGF0IGB0cmFjZWAgbGV2ZWwuCiAgICogCiAgICogVXNlIHRoZSB0cmFjZSBmdW5jdGlvbiB0byBsb2cgdmVyeSBkZXRhaWxlZCBpbmZvcm1hdGlvbiwgc3VjaCBhcwogICAqIGVudGVyaW5nL2xlYXZpbmcgZnVuY3Rpb25zLCB2YWx1ZXMgb2YgcGFyYW1ldGVycywgZXRjLiBNb3N0IG9mdGVuIHVzZWQKICAgKiBhcyBhIGRldGFpbGVkIGRlYnVnIGZhY2lsaXR5IGZvciBhIHNwZWNpZmljIHByb2JsZW0gCiAgICogCiAgICogQHN5bnRheCBMb2cudHJhY2UoIGFyZywgLi4uICkKICAgKiBAcGFyYW0gey4uLk9iamVjdH0gYXJnIFRoZSBhcmd1bWVudChzKSB0byBsb2cuIE11c3QgYmUgY29udmVydGFibGUgdG8gU3RyaW5nCiAgICogQG5hbWUgTG9nLnRyYWNlCiAgICogQG1ldGhvZAogICAqIEBleGFtcGxlCkxvZy50cmFjZSggIkVudGVyaW5nIGZ1bmN0aW9uIGZvbywgd2l0aCBwYXJhbXRlciBiYXI9IiwgYmFyICk7CiAgICovCiAgICB0aGF0LnRyYWNlID0gZnVuY3Rpb24oICkgewoJaWYgKCBMb2dDb3JlX2lzTGV2ZWxFbmFibGVkKCAidHJhY2UiICkgKSB7CiAgICAgICAgICAgIGxvZyggInRyYWNlIiwgYXJndW1lbnRzICk7Cgl9OwogICAgfTsKICAgIC8qKgogICAqIExvZyBhIG1lc3NhZ2UgYXQgYGRlYnVnYCBsZXZlbC4KICAgKiAKICAgKiBVc2UgdGhlIGRlYnVnIGZ1bmN0aW9uIHRvIGxvZyBkZWJ1ZyBpbmZvcm1hdGlvbiwgc3VjaCBhcyB0b3BsZXZlbAogICAqIHByb2dyYW0gZmxvdywgaW1wb3J0YW50IHZhbHVlcyB0aGF0IGluZmx1ZW5jZXMgdGhlIHByb2dyYW0sIGV0Yy4gCiAgICogCiAgICogQHN5bnRheCBMb2cuZGVidWcoIGFyZywgLi4uICkKICAgKiBAcGFyYW0gey4uLk9iamVjdH0gYXJnIFRoZSBhcmd1bWVudChzKSB0byBsb2cuIE11c3QgYmUgY29udmVydGFibGUgdG8gU3RyaW5nCiAgICogQG5hbWUgTG9nLmRlYnVnCiAgICogQG1ldGhvZAogICAqIEBleGFtcGxlCkxvZy5kZWJ1ZyggIlNlcnZpY2UgcmV0dXJuZWQgdGhlIGZvbGxvd2luZyBhbnN3ZXI6ICIsIHNlcnZpY2VBbnN3ZXIgKTsKICAgKi8KICAgIHRoYXQuZGVidWcgPSBmdW5jdGlvbiggKSB7CglpZiAoIExvZ0NvcmVfaXNMZXZlbEVuYWJsZWQoICJkZWJ1ZyIgKSApIHsKICAgICAgICAgICAgbG9nKCAiZGVidWciLCBhcmd1bWVudHMgKTsKCX07CiAgICB9OwogICAgLyoqCiAgICogTG9nIGEgbWVzc2FnZSBhdCBgaW5mb2AgbGV2ZWwuCiAgICogCiAgICogVXNlIHRoZSBpbmZvIGZ1bmN0aW9uIHRvIGxvZyBpbmZvcm1hdGlvbiBvZiBhICdzdGF0dXMnIGxpa2UgdHlwZSwgc3VjaAogICAqIGFzIHN0YXRlIGNoYW5nZXMsIGhvdyBmYXIgYSBnaXZlbiBwcm9jZXNzIGhhcyBwcm9ncmVzc2VkLCBldGMuIAogICAqIAogICAqIEBzeW50YXggTG9nLmluZm8oIGFyZywgLi4uICkKICAgKiBAcGFyYW0gey4uLk9iamVjdH0gYXJnIFRoZSBhcmd1bWVudChzKSB0byBsb2cuIE11c3QgYmUgY29udmVydGFibGUgdG8gU3RyaW5nCiAgICogQG5hbWUgTG9nLmluZm8KICAgKiBAbWV0aG9kCiAgICogQGV4YW1wbGUKTG9nLmluZm8oICJUYXNrIHdpdGggdGFza0lkICIsIHRhc2tJZCwgIiBub3cgZG9uZSBhbmQgdW5sb2FkZWQiICk7CiAgICovCiAgICB0aGF0LmluZm8gPSBmdW5jdGlvbiggKSB7CglpZiAoIExvZ0NvcmVfaXNMZXZlbEVuYWJsZWQoICJpbmZvIiApICkgewogICAgICAgICAgICBsb2coICJpbmZvIiwgYXJndW1lbnRzICk7Cgl9OwogICAgfTsKICAgIC8qKgogICAqIExvZyBhIG1lc3NhZ2UgYXQgYHdhcm5gIGxldmVsLgogICAqIAogICAqIFVzZSB0aGUgd2FybiBmdW5jdGlvbiB0byBsb2cgd2FybmluZ3MgYWJvdXQgZXhwZWN0YXRpb25zIHRoYXQgaGF2ZSBub3QKICAgKiBiZWVuIG1ldCwgYnV0IHRoYXQgdGhlIHByb2dyYW0gaXMgc3RpbGwgYWJsZSB0byB3b3JrIGFyb3VuZC4gVGhlCiAgICogcHJvYmxlbSBzaG91bGQgbm90IGhhdmUgYSBiaWcgaW1wYWN0IG9uIHRoZSBwcm9jZXNzLCBidXQgYSB3YXJuaW5nCiAgICogc2hvdWxkIGluZGljYXRlIHRoYXQgdGhlIHVzZXIgbWF5IHdhbnQgdG8gaW52ZXN0aWdhdGUgaWYgdGhlIHdhcm5pbmcgaXMKICAgKiBhIHN5bXB0b20gb2Ygc29tZXRoaW5nIHRoYXQgc2hvdWxkIGJlIGNvcnJlY3RlZC4gCiAgICogCiAgICogQHN5bnRheCBMb2cud2FybiggYXJnLCAuLi4gKQogICAqIEBwYXJhbSB7Li4uT2JqZWN0fSBhcmcgVGhlIGFyZ3VtZW50KHMpIHRvIGxvZy4gTXVzdCBiZSBjb252ZXJ0YWJsZSB0byBTdHJpbmcKICAgKiBAbmFtZSBMb2cud2FybgogICAqIEBtZXRob2QKICAgKiBAZXhhbXBsZQpMb2cud2FybiggIk5vIHJlc3BvbnNlIGZyb20gc2VydmljZSAtIHdpbGwgcmV0cnkgaW4gNSBtaW51dGVzIiApOwogICAqLwogICAgdGhhdC53YXJuID0gZnVuY3Rpb24oICkgewoJaWYgKCBMb2dDb3JlX2lzTGV2ZWxFbmFibGVkKCAid2FybiIgKSApIHsKICAgICAgICAgICAgbG9nKCAid2FybiIsIGFyZ3VtZW50cyApOwoJfTsKICAgIH07CiAgICAvKioKICAgKiBMb2cgYSBtZXNzYWdlIGF0IGBlcnJvcmAgbGV2ZWwuCiAgICogCiAgICogVXNlIHRoZSBlcnJvciBmdW5jdGlvbiB0byBsb2cgZXJyb3JzIGZvciBhIGdpdmVuIHByb2Nlc3MgdGhhdCB0aGUKICAgKiBwcm9ncmFtIGNhbiBub3QgY29ycmVjdC4gQW4gZXJyb3IgaW5kaWNhdGVzIHRoYXQgdGhlIGdpdmVuIHRhc2sgYXQgaGFuZAogICAqIGNhbiBub3QgYmUgY29tcGxldGVkLiBIb3dldmVyLCBvdGhlciB0YXNrcyBtYXkgdmVyeSB3ZWxsIGJlIGFibGUgdG8gYmUKICAgKiBwcm9jZXNzZWQuIFRoZSB1c2VyIHNob3VsZCBkZWZpbml0aXZlbHkgaW52ZXN0aWdhdGUgdGhlIHJlYXNvbiBmb3IgdGhlCiAgICogZXJyb3IgYW5kIGlmIHBvc3NpYmx5IGNvcnJlY3QgaXQuIAogICAqIAogICAqIEBzeW50YXggTG9nLmVycm9yKCBhcmcsIC4uLiApCiAgICogQHBhcmFtIHsuLi5PYmplY3R9IGFyZyBUaGUgYXJndW1lbnQocykgdG8gbG9nLiBNdXN0IGJlIGNvbnZlcnRhYmxlIHRvIFN0cmluZwogICAqIEBuYW1lIExvZy5lcnJvcgogICAqIEBtZXRob2QKICAgKiBAZXhhbXBsZQpMb2cuZXJyb3IoICJFcnJvciB3aGVuIGhhbmRsaW5nIHRhc2s6IHRhc2t0eXBlIHdhcyBlbXB0eS4gVGFzayBjYW4gbm90IGJlIGhhbmRsZWQiICk7CiAgICovCiAgICB0aGF0LmVycm9yID0gZnVuY3Rpb24oICkgewoJaWYgKCBMb2dDb3JlX2lzTGV2ZWxFbmFibGVkKCAiZXJyb3IiICkgKSB7CiAgICAgICAgICAgIGxvZyggImVycm9yIiwgYXJndW1lbnRzICk7Cgl9OwogICAgfTsKCiAgLyoqCiAgICogTG9nIGEgbWVzc2FnZSBhdCBgZmF0YWxgIGxldmVsLgogICAqIAogICAqIFVzZSB0aGUgZmF0YWwgZnVuY3Rpb24gdG8gbG9nIGEgZmF0YWwgcHJvYmxlbSwgdGhhdCBzdG9wcyB0aGUgcHJvZ3JhbQogICAqIGZyb20gYmVpbmcgYWJsZSB0byBwcm9jZWVkIGF0IGFsbCwgb3Igd2l0aG91dCByaXNrIG9mIHNldmVyZQogICAqIHByb2JsZW1zL2NvcnJ1cHRpb24gb2YgZGF0YS4gSXQgaXMgcHJvYmFibHkgbm90IGEgZnVuY3Rpb24gbXVjaCB1c2VkCiAgICogZnJvbSBKYXZhU2NyaXB0LiAKICAgKiAKICAgKiAqKk5vdGU6KiogTm90IGFsbCBsb2cgZnJhbWV3b3JrcyBzdXBwb3J0cyB0aGUgZmF0YWwgbGV2ZWwuIEluIHRoYXQgY2FzZSwgaXQgd2lsbCBiZSBjb252ZXJ0ZWQgdG8gYW4gZXJyb3IgbGV2ZWwuCiAgICogCiAgICogQHN5bnRheCBMb2cuZmF0YWwoIGFyZywgLi4uICkKICAgKiBAcGFyYW0gey4uLk9iamVjdH0gYXJnIFRoZSBhcmd1bWVudChzKSB0byBsb2cuIE11c3QgYmUgY29udmVydGFibGUgdG8gU3RyaW5nCiAgICogQG5hbWUgTG9nLmZhdGFsCiAgICogQG1ldGhvZAogICAqIEBleGFtcGxlCkxvZy5mYXRhbCggIkNvbmZpZ3VyYXRpb24gZXJyb3IgaW4gc29tZW9iamVjdC5zb21ldmFsdWUuIFRoaXMgb3B0aW9uIHdhcyBpbmNvcnJlY3RseSBzZXQuIEFib3J0aW5nIiApOwogICAqLwogICAgdGhhdC5mYXRhbCA9IGZ1bmN0aW9uKCApIHsKCWlmICggTG9nQ29yZV9pc0xldmVsRW5hYmxlZCggImZhdGFsIiApICkgewogICAgICAgICAgICBsb2coICJmYXRhbCIsIGFyZ3VtZW50cyApOwoJfTsKICAgIH07CgogICAgLyoqCiAgICAgKiBMb2cgYSBtZXNzYWdlIGF0IGBtYWdpY2AgbGV2ZWwuCiAgICAgKiAKICAgICAqIFRoZSBtYWdpYyBmdW5jdGlvbiBpcyBhIHNwZWNpYWwgbG9nIGZ1bmN0aW9uLiBJdCBpcyB1c2VkIHRvIGxvZyBhCiAgICAgKiBmdW5jdGlvbiBjYWxsIHdpdGggdGhlIHBhcmFtZXRlcnMsIHdoZXJlIHRoZSBwYXJhbWV0ZXJzIHdpbGwgYmUKICAgICAqICdtYWdpY2FsbHknIGV2YWx1YXRlZCBiZWZvcmUgcHJpbnRlZC4gVGhlIGxldmVsIGlzICdtYWdpYycsIGFuZCB0aGUKICAgICAqIGZlYXR1cmUgaXMgZXhwZXJpbWVudGFsLCBhbmQgbWF5IG5vdCBtYWtlIGl0IHRvIHByb2R1Y3Rpb24uIAogICAgICogCiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgZXhwZXJpbWVudGFsLgogICAgICoKICAgICAqIEBwYXJhbSB7WE1MfSBhcmcgVGhlIGFyZ3VtZW50IHRvIGxvZy4gTXVzdCBiZSBYTUwKICAgICAqIEBuYW1lIExvZy5tYWdpYwogICAgICogQG1ldGhvZAogICAgICovCiAgICB0aGF0Lm1hZ2ljID0gZnVuY3Rpb24oIHhtbCApIHsKICAgICAgICAvLyBUaGlzIGZ1bmN0aW9uIGNoZWNrcyB0aGUgY29udGVzdCAKICAgICAgICBpZiAoIHR5cGVvZiB4bWwgIT09ICJ4bWwiICkgewogICAgICAgICAgICBsb2coICJ3YXJuIiwgIm1hZ2ljIGNhbGxlZCB3aXRoIG5vbiB4bWwgYXJndW1lbnQ6ICIsIHhtbCApOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcGFyYW1Ub1N0cmluZyggKSB7CiAgICAgICAgICAgIHJlcyA9IFsgXTsKICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgKytpICkgewogICAgICAgICAgICAgICAgLy8gU3BlY2lhbGNhc2UgdW5kZWZpbmVkIC0gaWYgc29tZXRoaW5nIHJldHVybnMgdW5kZWZpbmVkCiAgICAgICAgICAgICAgICBpZiAoIGFyZ3VtZW50c1sgaSBdID09PSB1bmRlZmluZWQgKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzLnB1c2goICJ1bmRlZmluZWQiICk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBTcGVjaWFsY2FzZSBhcnJheXMsIGFzIHRoZWlyIHRvU3RyaW5nIG1ldGhvZCBpcyBhIGJpdCB3YWNreQogICAgICAgICAgICAgICAgaWYgKCBfLmlzQXJyYXkoIGFyZ3VtZW50c1sgaSBdICkgKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzLnB1c2goICJbICIgKyBhcmd1bWVudHNbIGkgXS50b1N0cmluZyggKSArICIgXSIgKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICggdHlwZW9mIGFyZ3VtZW50c1sgaSBdID09PSAic3RyaW5nIiApIHsKICAgICAgICAgICAgICAgICAgICByZXMucHVzaCggJyInICsgYXJndW1lbnRzWyBpIF0udG9TdHJpbmcoICkgKyAnIicgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmVzLnB1c2goIGFyZ3VtZW50c1sgaSBdLnRvU3RyaW5nKCApICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlcy5qb2luKCAiLCAiICk7CiAgICAgICAgfQoKICAgICAgICBjb250ZW50ID0geG1sLnRvU3RyaW5nKCApOwogICAgICAgIC8vIFJlcGxhY2UgdXB0byB0aGUgZmlyc3QgKCB3aXRoIHBhcmFtVG9TdHJpbmcsIGV2YWwgaXQsIGFuZCBwcmludCBpdAogICAgICAgIC8vIGNibzogZmVlbCBmcmVlIHRvIHJlcGxhY2UgdGhpcyB3aXRoIHNvbWV0aGluZyBjbGV2ZXIgdXNpbmcgcmVnZXhwcy4uLgogICAgICAgIGFsbCA9IGNvbnRlbnQuc3BsaXQoICIoIiApOwogICAgICAgIGZ1bmMgPSBhbGwuc2hpZnQoICk7CiAgICAgICAgcmVwbGFjZSA9ICJwYXJhbVRvU3RyaW5nKCIgKyBhbGwuam9pbiggIigiICk7CiAgICAgICAgbmV3YXJncyA9IGV2YWwoIHJlcGxhY2UgKTsKICAgICAgICBjb21wbGV0ZSA9IGZ1bmMgKyAiKCAiICsgbmV3YXJncyArICIgKSI7CiAgICAgICAgbG9nKCAibWFnaWMiLCBbICJGdW5jdGlvbiB3YXMgY2FsbGVkIGxpa2UgdGhpczpcbiIsIGNvbnRlbnQsICJcbkFmdGVyIHBhcmFtZXRlciBldmFsdWF0aW5nOlxuIiwgY29tcGxldGUgXSApOwogICAgfTsKCgogIC8qKgogICAqIFdyYXAgYW4gb2JqZWN0IHNvIGl0IGRvZXMgbm90IHByb2R1Y2UgYSB3YXJuaW5nIGluIHRoZSBsb2cgaWYgdGhlIHZhbHVlIGlzIG51bGwgb3IgdW5kZWZpbmVkLgogICAqCiAgICogTm9ybWFsbHkgbG9nZ2luZyBhbiB1bmRlZmluZWQgb3IgbnVsbCB2YWx1ZSBwcm9kdWNlcyBhIHdhcm5pbmcgaW4gdGhlIGxvZyBmaWxlIGluY2x1ZGluZyBhIHN0YWNrIHRyYWNlCiAgICogZm9yIHRoZSBsb2dnaW5nIHBvc2l0aW9uLiBJZiBhIHZhbHVlIGlzIGFsbG93ZWQgdG8gYmUgdW5kZWZpbmVkLCB0aGlzIHdhcm5pbmcgY2FuIGJlIGF2b2lkZWQgYnkgd3JhcHBpbmcKICAgKiB0aGUgdmFsdWUgaW4gc2FmZVZhbHVlLgogICAqCiAgICogSXQgZG9lcyB0aGlzIGJ5IHdyYXBwaW5nIHRoZSBvYmplY3QgaW4gYSB0ZW1wb3Jhcnkgb2JqZWN0IGltcGxlbWVudGluZyB0b1N0cmluZyB3aXRoIGNoZWNrcyBmb3IgbnVsbC91bmRlZmluZWQKICAgKgogICAqIEBzeW50YXggTG9nLnNhZmVWYWx1ZSh2YWx1ZSkKICAgKiBAcGFyYW0ge09iamVjdHxVbmRlZmluZWR9IHZhbHVlIFRoZSB2YWx1ZSB0byB3cmFwLiBNdXN0IGJlIGNvbnZlcnRhYmxlIHRvIFN0cmluZyBvciBudWxsL3VuZGVmaW5lZAogICAqIEBuYW1lIExvZy5zYWZlVmFsdWUKICAgKiBAbWV0aG9kCiAgICogQGV4YW1wbGUKTG9nLmRlYnVnKCAiVmFsdWUgaXMgIiwgTG9nLnNhZmVWYWx1ZSggdmFsdWUgKSApOwogICAqLwoKICAgIHRoYXQuc2FmZVZhbHVlID0gZnVuY3Rpb24oIHZhbHVlICkgewogICAgICAgIHZhciByZXMgPSB7fTsKICAgICAgICByZXMudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICggdmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgcmV0dXJuICI8dW5kZWZpbmVkPiI7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICBpZiAoIHZhbHVlID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIjxudWxsPiI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUudG9TdHJpbmcoKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgcmV0dXJuIHJlczsKICAgIH07CgogICAgLy8gU2V0dXAgdGhlIHR3byAiYWR2YW5jZWQiIGZ1bmN0aW9ucyBmcm9tIGFib3ZlCiAgICBpZiAoIHRoaXMuX19Mb2dDb3JlX2lzTGV2ZWxFbmFibGVkICkgewoJTG9nQ29yZV9pc0xldmVsRW5hYmxlZCA9IF9fTG9nQ29yZV9pc0xldmVsRW5hYmxlZDsKCWRlbGV0ZSB0aGlzLl9fTG9nQ29yZV9pc0xldmVsRW5hYmxlZDsKICAgIH0gZWxzZSB7CgkvLyBEdW1teSBmdW5jdGlvbiAtIGFsbCBpcyB0cnVlCglMb2dDb3JlX2lzTGV2ZWxFbmFibGVkID0gZnVuY3Rpb24oIGxldmVsICkgeyByZXR1cm4gdHJ1ZTsgfQogICAgICAgIC8vIG1iZDogMjAxMy0xMC0zMQogICAgICAgIC8vIFRoZSBDKysgbG9nZ2luZyBmcmFtZXdvcmsgZG9lcyBub3QsIGFuZCBwcm9iYWJseSB3aWxsIG5vdCwgc3VwcG9ydCBzb21ldGhpbmcKICAgICAgICAvLyBsaWtlIGlzTGV2ZWxFbmFibGVkLCBhbmQgaXQgaXMgYWxzbyBzcGVlZHkgZW5vdWdoIHRvIG5vdCBtYXR0ZXIuCiAgICAgICAgLy8gVGhlIGNoZWNrIHRoZW4gZW5kcyB1cCBhZGRpbmcgYSBsb3Qgb2Ygbm9pc2UgaW50byBzb21lIGFwcGxpY2F0aW9ucywgc3VjaCBhcyAKICAgICAgICAvLyBlc2dhcm90aCwgd2hlcmUgYSB3YXJuaW5nIGlzIGxvZ2dlZCBmb3IgZWFjaCBKYXZhU2NyaXB0IGVudmlyb25tZW50IGNyZWF0ZWQuCiAgICAgICAgLy8gU28sIGl0IGlzIGJlc3Qgbm90IHRvIGRvIHRoaXMgY2hlY2sgdW5kZXIgQysrLgogICAgICAgIC8vIEJ1dCwgaWYgdGhpcyBpcyBKYXZhLCBjaGVjayBpZiB0aGUgcGVyZm9ybWFuY2UgY291bGQgYmUgaW1wcm92ZWQgYnkgCiAgICAgICAgLy8gYWRkaW5nIGEgIm5hdGl2ZSIgX19Mb2dDb3JlX2lzTGV2ZWxFbmFibGVkIGZ1bmN0aW9uLgogICAgICAgIC8vIFRoaXMgY2hlY2sgaXMgYW4gZXhjZXB0aW9uIHRvIHRoZSBydWxlIHRoYXQgd2UgZG8gbm90IGNoZWNrIGZvciBwbGF0Zm9ybXMgaW4gbm9uICpDb3JlIG1vZHVsZXMuCiAgICAgICAgLy8gWW91IGFyZSBub3QgZW50aXRsZWQgdG8gZG8gdGhpcyBvdGhlciBwbGFjZXMuIEZlZWwgZnJlZSB0byBjb21wbGFpbiBhYm91dCB0aGlzIHVuZmFpcm5lc3Mgb2YgbGlmZQogICAgICAgIC8vIG9uIHlvdXIgZmF2b3JpdGUgc29jaWFsIG5ldHdvcmssIG9yIHNvbWV0aGluZywgYXMgbG9uZyBhcyB5b3UgZG9uJ3QgZXhwZWN0IGFueW9uZSB0byBjYXJlLi4uIDstKQogICAgICAgIGlmICggR2xvYmFsLlBhY2thZ2VzICYmIEdsb2JhbC5QYWNrYWdlcy5qYXZhICkgewogICAgICAgICAgICB0aGF0Lndhcm4oICJKYXZhIGludGVycHJlbnRlciBkZXRlY3RlZCwgYW5kIExvZ0NvcmUgbW9kdWxlIGRvZXMgbm90IGV4cG9ydCBfX0xvZ0NvcmVfaXNMZXZlbEVuYWJsZWQgLSBtYXkgaW1wYWN0IGxvZ2dpbmcgcGVyZm9ybWFuY2UiICk7CiAgICAgICAgfSAKICAgIH0KCgogICAgLy8gUmV0dXJuIHRoZSBMb2cgb2JqZWN0CiAgICByZXR1cm4gdGhhdDsKfSggKTsKCg==", "moduleName": "Log"}, {"javascript": "Ly8gTG9nQ29yZSBtb2R1bGUgLSBpbXBsZW1lbnRzIGEgX19Mb2dDb3JlX2xvZyggbGV2ZWwsIGFyZ3MgKSBmdW5jdGlvbgoKLyogSmF2YSBNYXZlbiBkZXBzIG5lZWRlZDoKCiAgICAgICAgICAgICAgICA8IS0tIExPR0dJTkcgLS0+CiAgICAgICAgICAgICAgICA8IS0tIEluIG9yZGVyIHRvIHN1cHBvcnQgZGlmZmVyZW50IGxvZyBmcmFtZXdvcmtzLCB3ZSB1c2UgYSBmYWNhZGUgcGF0dGVybiAKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGxvZ2dpbmcgVGhlIGFjdHVhbCBmYWNhZGUgcGF0dGVybiBpcyBzbGY0aiwgd2hpY2ggaXMgd2hhdCBkYmMtY29tbW9ucyAKICAgICAgICAgICAgICAgICAgICAgICAgaXMgZ29pbmcgdG8gdXNlIHRvby4gRm9yIGFjdHVhbCBsb2dnaW5nIGluIHRoZSBkZXBsb3ltZW50LCB3ZSB1c2UgbG9nNGouIC0tPgogICAgICAgICAgICAgICAgPGRlcGVuZGVuY3k+CiAgICAgICAgICAgICAgICAgICAgICAgIDxncm91cElkPm9yZy5zbGY0ajwvZ3JvdXBJZD4KICAgICAgICAgICAgICAgICAgICAgICAgPGFydGlmYWN0SWQ+c2xmNGotYXBpPC9hcnRpZmFjdElkPgogICAgICAgICAgICAgICAgICAgICAgICA8dmVyc2lvbj4xLjYuMTwvdmVyc2lvbj4KICAgICAgICAgICAgICAgIDwvZGVwZW5kZW5jeT4KICAgICAgICAgICAgICAgIDxkZXBlbmRlbmN5PgogICAgICAgICAgICAgICAgICAgICAgICA8Z3JvdXBJZD5vcmcuc2xmNGo8L2dyb3VwSWQ+CiAgICAgICAgICAgICAgICAgICAgICAgIDxhcnRpZmFjdElkPnNsZjRqLWV4dDwvYXJ0aWZhY3RJZD4KICAgICAgICAgICAgICAgICAgICAgICAgPHZlcnNpb24+MS42LjE8L3ZlcnNpb24+CiAgICAgICAgICAgICAgICA8L2RlcGVuZGVuY3k+IAoqLwoKLyogWW91IG1heSBhbHNvIHdhbnQgdG8gYWN0dWFsbHkgYmluZCB0byBlLmcuIGxvZzRqOgoKICAgICAgICAgICAgICAgIDwhLS0gVGhpcyBvbmUgYmluZHMgdG8gbG9nNGogaW4gdGhlIGRlcGxveW1lbnQuIC0tPgogICAgICAgICAgICAgICAgPGRlcGVuZGVuY3k+CiAgICAgICAgICAgICAgICAgICAgICAgIDxncm91cElkPm9yZy5zbGY0ajwvZ3JvdXBJZD4KICAgICAgICAgICAgICAgICAgICAgICAgPGFydGlmYWN0SWQ+c2xmNGotbG9nNGoxMjwvYXJ0aWZhY3RJZD4KICAgICAgICAgICAgICAgICAgICAgICAgPHZlcnNpb24+MS42LjE8L3ZlcnNpb24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzY29wZT5ydW50aW1lPC9zY29wZT4KICAgICAgICAgICAgICAgIDwvZGVwZW5kZW5jeT4KICAgICAgICAgICAgICAgIDwhLS0gSW4gbG9nIHdlIHRydXN0IDogaHR0cDovL2xvZ2dpbmcuYXBhY2hlLm9yZy9sb2c0ai8gLS0+CiAgICAgICAgICAgICAgICA8ZGVwZW5kZW5jeT4KICAgICAgICAgICAgICAgICAgICAgICAgPGdyb3VwSWQ+bG9nNGo8L2dyb3VwSWQ+CiAgICAgICAgICAgICAgICAgICAgICAgIDxhcnRpZmFjdElkPmxvZzRqPC9hcnRpZmFjdElkPgogICAgICAgICAgICAgICAgICAgICAgICA8dmVyc2lvbj4xLjIuMTY8L3ZlcnNpb24+CiAgICAgICAgICAgICAgICA8L2RlcGVuZGVuY3k+CiAgICAgICAgICAgICAgICA8IS0tIEVORCBMT0dHSU5HIC0tPgoqLwoKCi8vIFdlIGV4cG9ydCB0aGlzIHN5bWJvbCwgd2hpY2ggd2UgZXhwZWN0IHRvIGJlIHVzZWQgZnJvbSBhIExvZyBtb2R1bGUuCkVYUE9SVEVEX1NZTUJPTFMgPSBbICdfX0xvZ0NvcmVfbG9nJywgJ19fTG9nQ29yZV9pc0xldmVsRW5hYmxlZCcgXTsKCi8vIEFjdHVhbCBsb2cgZnVuY3Rpb24KdmFyIF9fTG9nQ29yZV9sb2cgPSBmdW5jdGlvbiggbGV2ZWwsIG1zZyApIHsKICAgIG1zZyA9ICJKUzogIiArIG1zZzsKICAgIC8vIFJoaW5vIHNwZWNpZmljIGJpbmRpbmdzIHV0aWxpemVkLgogICAgc3dpdGNoKCBsZXZlbCApIHsKICAgIGNhc2UgInRyYWNlIiA6IF9fTG9nQ29yZV9sb2cubG9nZ2VyLnRyYWNlKCBtc2cgKTsgYnJlYWs7CiAgICBjYXNlICJkZWJ1ZyIgOiBfX0xvZ0NvcmVfbG9nLmxvZ2dlci5kZWJ1ZyggbXNnICk7IGJyZWFrOwogICAgY2FzZSAiaW5mbyIgIDogX19Mb2dDb3JlX2xvZy5sb2dnZXIuaW5mbyggbXNnICk7IGJyZWFrOwogICAgY2FzZSAid2FybiIgIDogX19Mb2dDb3JlX2xvZy5sb2dnZXIud2FybiggbXNnICk7IGJyZWFrOwogICAgY2FzZSAiZXJyb3IiIDogX19Mb2dDb3JlX2xvZy5sb2dnZXIuZXJyb3IoIG1zZyApOyBicmVhazsKICAgIGNhc2UgImZhdGFsIiA6IF9fTG9nQ29yZV9sb2cubG9nZ2VyLmVycm9yKCAiRkFUQUw6ICIgKyBtc2cgKTsgYnJlYWs7CiAgICBkZWZhdWx0ICAgICAgOiBfX0xvZ0NvcmVfbG9nLmxvZ2dlci5lcnJvciggIlVOS05PV04gTE9HTEVWRUw6ICIgKyBsZXZlbCArICIgOiAiICsgbXNnICk7IGJyZWFrOwogICAgfQp9OwoKLy8gQ2hlY2sgbGV2ZWwgZXhwb3J0Cl9fTG9nQ29yZV9pc0xldmVsRW5hYmxlZCA9IGZ1bmN0aW9uICggbGV2ZWwgKSB7CiAgICBzd2l0Y2ggKCBsZXZlbCApIHsKICAgIGNhc2UgInRyYWNlIiA6IHJldHVybiBfX0xvZ0NvcmVfbG9nLmxvZ2dlci5pc1RyYWNlRW5hYmxlZCgpOwogICAgY2FzZSAiZGVidWciIDogcmV0dXJuIF9fTG9nQ29yZV9sb2cubG9nZ2VyLmlzRGVidWdFbmFibGVkKCk7CiAgICBjYXNlICJpbmZvIiAgOiByZXR1cm4gX19Mb2dDb3JlX2xvZy5sb2dnZXIuaXNJbmZvRW5hYmxlZCgpOwogICAgY2FzZSAid2FybiIgIDogcmV0dXJuIF9fTG9nQ29yZV9sb2cubG9nZ2VyLmlzV2FybkVuYWJsZWQoKTsKICAgIGNhc2UgImVycm9yIiA6IHJldHVybiBfX0xvZ0NvcmVfbG9nLmxvZ2dlci5pc0Vycm9yRW5hYmxlZCgpOwogICAgZGVmYXVsdDogcmV0dXJuIHRydWU7CiAgICB9Owp9CgoKLy8gQXR0YWNoIHRoZSBsb2dnZXIgdmFyaWFibGUgdG8gdGhlIGdsb2JhbCBsb2dnZXIgb25seSBvbmNlLCBub3QgZm9yIGVhY2gKLy8gZnVuY3Rpb24gY2FsbC4KLy8gU29ydCBvZiB0aGUgc3RhdGljIHdheSB0byBkbyBpdC4KCi8vIFRoZSBuZXh0IGxpbmUgY2FuIGJpbmQgKmRpcmVjdGx5KiB0byBsb2c0ai4gSXQgaXMgb25seSBpbmNsdWRlZCBmb3IKLy8gcmVmZXJlbmNlLCBhcwovLyB0aGUgZmFjYWRlIGJlbG93IGlzIHRoZSByZWNvbW1lbmRlZCB3YXkgdG8gZG8gaXQuCi8vIF9fTG9nQ29yZV9sb2cubG9nZ2VyID0gUGFja2FnZXMub3JnLmFwYWNoZS5sb2c0ai5Mb2dnZXIuZ2V0TG9nZ2VyKAovLyAiSmF2YVNjcmlwdC5Mb2dnZXIiICk7CgovLyBCaW5kaW5nIHRvIHRoZSBzbGY0aiBmYWNhZGUuCl9fTG9nQ29yZV9sb2cubG9nZ2VyID0gUGFja2FnZXMub3JnLnNsZjRqLkxvZ2dlckZhY3RvcnkKICAgIC5nZXRMb2dnZXIoICJKYXZhU2NyaXB0LkxvZ2dlciIgKTsK", "moduleName": "LogCore"}, {"javascript": "LyoqIEBmaWxlIFVuZGVyc2NvcmUgbW9kdWxlLCBleHRlcm5hbCBmaWxlICovCkVYUE9SVEVEX1NZTUJPTFMgPSBbIl8iXTsKCnVzZSgiRVM1Iik7CgovKioKICogQGxpY2Vuc2UKICogTG9kYXNoIChDdXN0b20gQnVpbGQpIDxodHRwczovL2xvZGFzaC5jb20vPgogKiBCdWlsZDogYGxvZGFzaCBjYXRlZ29yeT0iYXJyYXksbGFuZyJgCiAqIENvcHlyaWdodCBKUyBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMgPGh0dHBzOi8vanMuZm91bmRhdGlvbi8+CiAqIFJlbGVhc2VkIHVuZGVyIE1JVCBsaWNlbnNlIDxodHRwczovL2xvZGFzaC5jb20vbGljZW5zZT4KICogQmFzZWQgb24gVW5kZXJzY29yZS5qcyAxLjguMyA8aHR0cDovL3VuZGVyc2NvcmVqcy5vcmcvTElDRU5TRT4KICogQ29weXJpZ2h0IEplcmVteSBBc2hrZW5hcywgRG9jdW1lbnRDbG91ZCBhbmQgSW52ZXN0aWdhdGl2ZSBSZXBvcnRlcnMgJiBFZGl0b3JzCiAqLwo7KGZ1bmN0aW9uKCkgewoKICAvKiogVXNlZCBhcyBhIHNhZmUgcmVmZXJlbmNlIGZvciBgdW5kZWZpbmVkYCBpbiBwcmUtRVM1IGVudmlyb25tZW50cy4gKi8KICB2YXIgdW5kZWZpbmVkOwoKICAvKiogVXNlZCBhcyB0aGUgc2VtYW50aWMgdmVyc2lvbiBudW1iZXIuICovCiAgdmFyIFZFUlNJT04gPSAnNC4xNy40JzsKCiAgLyoqIFVzZWQgYXMgdGhlIHNpemUgdG8gZW5hYmxlIGxhcmdlIGFycmF5IG9wdGltaXphdGlvbnMuICovCiAgdmFyIExBUkdFX0FSUkFZX1NJWkUgPSAyMDA7CgogIC8qKiBFcnJvciBtZXNzYWdlIGNvbnN0YW50cy4gKi8KICB2YXIgQ09SRV9FUlJPUl9URVhUID0gJ1Vuc3VwcG9ydGVkIGNvcmUtanMgdXNlLiBUcnkgaHR0cHM6Ly9ucG1zLmlvL3NlYXJjaD9xPXBvbnlmaWxsLicsCiAgICAgIEZVTkNfRVJST1JfVEVYVCA9ICdFeHBlY3RlZCBhIGZ1bmN0aW9uJzsKCiAgLyoqIFVzZWQgdG8gc3RhbmQtaW4gZm9yIGB1bmRlZmluZWRgIGhhc2ggdmFsdWVzLiAqLwogIHZhciBIQVNIX1VOREVGSU5FRCA9ICdfX2xvZGFzaF9oYXNoX3VuZGVmaW5lZF9fJzsKCiAgLyoqIFVzZWQgYXMgdGhlIG1heGltdW0gbWVtb2l6ZSBjYWNoZSBzaXplLiAqLwogIHZhciBNQVhfTUVNT0laRV9TSVpFID0gNTAwOwoKICAvKiogVXNlZCB0byBjb21wb3NlIGJpdG1hc2tzIGZvciBjbG9uaW5nLiAqLwogIHZhciBDTE9ORV9ERUVQX0ZMQUcgPSAxLAogICAgICBDTE9ORV9GTEFUX0ZMQUcgPSAyLAogICAgICBDTE9ORV9TWU1CT0xTX0ZMQUcgPSA0OwoKICAvKiogVXNlZCB0byBjb21wb3NlIGJpdG1hc2tzIGZvciB2YWx1ZSBjb21wYXJpc29ucy4gKi8KICB2YXIgQ09NUEFSRV9QQVJUSUFMX0ZMQUcgPSAxLAogICAgICBDT01QQVJFX1VOT1JERVJFRF9GTEFHID0gMjsKCiAgLyoqIFVzZWQgdG8gZGV0ZWN0IGhvdCBmdW5jdGlvbnMgYnkgbnVtYmVyIG9mIGNhbGxzIHdpdGhpbiBhIHNwYW4gb2YgbWlsbGlzZWNvbmRzLiAqLwogIHZhciBIT1RfQ09VTlQgPSA4MDAsCiAgICAgIEhPVF9TUEFOID0gMTY7CgogIC8qKiBVc2VkIGFzIHJlZmVyZW5jZXMgZm9yIHZhcmlvdXMgYE51bWJlcmAgY29uc3RhbnRzLiAqLwogIHZhciBJTkZJTklUWSA9IDEgLyAwLAogICAgICBNQVhfU0FGRV9JTlRFR0VSID0gOTAwNzE5OTI1NDc0MDk5MSwKICAgICAgTUFYX0lOVEVHRVIgPSAxLjc5NzY5MzEzNDg2MjMxNTdlKzMwOCwKICAgICAgTkFOID0gMCAvIDA7CgogIC8qKiBVc2VkIGFzIHJlZmVyZW5jZXMgZm9yIHRoZSBtYXhpbXVtIGxlbmd0aCBhbmQgaW5kZXggb2YgYW4gYXJyYXkuICovCiAgdmFyIE1BWF9BUlJBWV9MRU5HVEggPSA0Mjk0OTY3Mjk1LAogICAgICBNQVhfQVJSQVlfSU5ERVggPSBNQVhfQVJSQVlfTEVOR1RIIC0gMSwKICAgICAgSEFMRl9NQVhfQVJSQVlfTEVOR1RIID0gTUFYX0FSUkFZX0xFTkdUSCA+Pj4gMTsKCiAgLyoqIGBPYmplY3QjdG9TdHJpbmdgIHJlc3VsdCByZWZlcmVuY2VzLiAqLwogIHZhciBhcmdzVGFnID0gJ1tvYmplY3QgQXJndW1lbnRzXScsCiAgICAgIGFycmF5VGFnID0gJ1tvYmplY3QgQXJyYXldJywKICAgICAgYXN5bmNUYWcgPSAnW29iamVjdCBBc3luY0Z1bmN0aW9uXScsCiAgICAgIGJvb2xUYWcgPSAnW29iamVjdCBCb29sZWFuXScsCiAgICAgIGRhdGVUYWcgPSAnW29iamVjdCBEYXRlXScsCiAgICAgIGRvbUV4Y1RhZyA9ICdbb2JqZWN0IERPTUV4Y2VwdGlvbl0nLAogICAgICBlcnJvclRhZyA9ICdbb2JqZWN0IEVycm9yXScsCiAgICAgIGZ1bmNUYWcgPSAnW29iamVjdCBGdW5jdGlvbl0nLAogICAgICBnZW5UYWcgPSAnW29iamVjdCBHZW5lcmF0b3JGdW5jdGlvbl0nLAogICAgICBtYXBUYWcgPSAnW29iamVjdCBNYXBdJywKICAgICAgbnVtYmVyVGFnID0gJ1tvYmplY3QgTnVtYmVyXScsCiAgICAgIG51bGxUYWcgPSAnW29iamVjdCBOdWxsXScsCiAgICAgIG9iamVjdFRhZyA9ICdbb2JqZWN0IE9iamVjdF0nLAogICAgICBwcm9taXNlVGFnID0gJ1tvYmplY3QgUHJvbWlzZV0nLAogICAgICBwcm94eVRhZyA9ICdbb2JqZWN0IFByb3h5XScsCiAgICAgIHJlZ2V4cFRhZyA9ICdbb2JqZWN0IFJlZ0V4cF0nLAogICAgICBzZXRUYWcgPSAnW29iamVjdCBTZXRdJywKICAgICAgc3RyaW5nVGFnID0gJ1tvYmplY3QgU3RyaW5nXScsCiAgICAgIHN5bWJvbFRhZyA9ICdbb2JqZWN0IFN5bWJvbF0nLAogICAgICB1bmRlZmluZWRUYWcgPSAnW29iamVjdCBVbmRlZmluZWRdJywKICAgICAgd2Vha01hcFRhZyA9ICdbb2JqZWN0IFdlYWtNYXBdJywKICAgICAgd2Vha1NldFRhZyA9ICdbb2JqZWN0IFdlYWtTZXRdJzsKCiAgdmFyIGFycmF5QnVmZmVyVGFnID0gJ1tvYmplY3QgQXJyYXlCdWZmZXJdJywKICAgICAgZGF0YVZpZXdUYWcgPSAnW29iamVjdCBEYXRhVmlld10nLAogICAgICBmbG9hdDMyVGFnID0gJ1tvYmplY3QgRmxvYXQzMkFycmF5XScsCiAgICAgIGZsb2F0NjRUYWcgPSAnW29iamVjdCBGbG9hdDY0QXJyYXldJywKICAgICAgaW50OFRhZyA9ICdbb2JqZWN0IEludDhBcnJheV0nLAogICAgICBpbnQxNlRhZyA9ICdbb2JqZWN0IEludDE2QXJyYXldJywKICAgICAgaW50MzJUYWcgPSAnW29iamVjdCBJbnQzMkFycmF5XScsCiAgICAgIHVpbnQ4VGFnID0gJ1tvYmplY3QgVWludDhBcnJheV0nLAogICAgICB1aW50OENsYW1wZWRUYWcgPSAnW29iamVjdCBVaW50OENsYW1wZWRBcnJheV0nLAogICAgICB1aW50MTZUYWcgPSAnW29iamVjdCBVaW50MTZBcnJheV0nLAogICAgICB1aW50MzJUYWcgPSAnW29iamVjdCBVaW50MzJBcnJheV0nOwoKICAvKiogVXNlZCB0byBtYXRjaCBwcm9wZXJ0eSBuYW1lcyB3aXRoaW4gcHJvcGVydHkgcGF0aHMuICovCiAgdmFyIHJlSXNEZWVwUHJvcCA9IC9cLnxcWyg/OlteW1xdXSp8KFsiJ10pKD86KD8hXDEpW15cXF18XFwuKSo/XDEpXF0vLAogICAgICByZUlzUGxhaW5Qcm9wID0gL15cdyokLywKICAgICAgcmVMZWFkaW5nRG90ID0gL15cLi8sCiAgICAgIHJlUHJvcE5hbWUgPSAvW14uW1xdXSt8XFsoPzooLT9cZCsoPzpcLlxkKyk/KXwoWyInXSkoKD86KD8hXDIpW15cXF18XFwuKSo/KVwyKVxdfCg/PSg/OlwufFxbXF0pKD86XC58XFtcXXwkKSkvZzsKCiAgLyoqCiAgICogVXNlZCB0byBtYXRjaCBgUmVnRXhwYAogICAqIFtzeW50YXggY2hhcmFjdGVyc10oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtcGF0dGVybnMpLgogICAqLwogIHZhciByZVJlZ0V4cENoYXIgPSAvW1xcXiQuKis/KClbXF17fXxdL2c7CgogIC8qKiBVc2VkIHRvIG1hdGNoIGxlYWRpbmcgYW5kIHRyYWlsaW5nIHdoaXRlc3BhY2UuICovCiAgdmFyIHJlVHJpbSA9IC9eXHMrfFxzKyQvZzsKCiAgLyoqIFVzZWQgdG8gbWF0Y2ggYmFja3NsYXNoZXMgaW4gcHJvcGVydHkgcGF0aHMuICovCiAgdmFyIHJlRXNjYXBlQ2hhciA9IC9cXChcXCk/L2c7CgogIC8qKiBVc2VkIHRvIG1hdGNoIGBSZWdFeHBgIGZsYWdzIGZyb20gdGhlaXIgY29lcmNlZCBzdHJpbmcgdmFsdWVzLiAqLwogIHZhciByZUZsYWdzID0gL1x3KiQvOwoKICAvKiogVXNlZCB0byBkZXRlY3QgYmFkIHNpZ25lZCBoZXhhZGVjaW1hbCBzdHJpbmcgdmFsdWVzLiAqLwogIHZhciByZUlzQmFkSGV4ID0gL15bLStdMHhbMC05YS1mXSskL2k7CgogIC8qKiBVc2VkIHRvIGRldGVjdCBiaW5hcnkgc3RyaW5nIHZhbHVlcy4gKi8KICB2YXIgcmVJc0JpbmFyeSA9IC9eMGJbMDFdKyQvaTsKCiAgLyoqIFVzZWQgdG8gZGV0ZWN0IGhvc3QgY29uc3RydWN0b3JzIChTYWZhcmkpLiAqLwogIHZhciByZUlzSG9zdEN0b3IgPSAvXlxbb2JqZWN0IC4rP0NvbnN0cnVjdG9yXF0kLzsKCiAgLyoqIFVzZWQgdG8gZGV0ZWN0IG9jdGFsIHN0cmluZyB2YWx1ZXMuICovCiAgdmFyIHJlSXNPY3RhbCA9IC9eMG9bMC03XSskL2k7CgogIC8qKiBVc2VkIHRvIGRldGVjdCB1bnNpZ25lZCBpbnRlZ2VyIHZhbHVlcy4gKi8KICB2YXIgcmVJc1VpbnQgPSAvXig/OjB8WzEtOV1cZCopJC87CgogIC8qKiBVc2VkIHRvIGNvbXBvc2UgdW5pY29kZSBjaGFyYWN0ZXIgY2xhc3Nlcy4gKi8KICB2YXIgcnNBc3RyYWxSYW5nZSA9ICdcXHVkODAwLVxcdWRmZmYnLAogICAgICByc0NvbWJvTWFya3NSYW5nZSA9ICdcXHUwMzAwLVxcdTAzNmYnLAogICAgICByZUNvbWJvSGFsZk1hcmtzUmFuZ2UgPSAnXFx1ZmUyMC1cXHVmZTJmJywKICAgICAgcnNDb21ib1N5bWJvbHNSYW5nZSA9ICdcXHUyMGQwLVxcdTIwZmYnLAogICAgICByc0NvbWJvUmFuZ2UgPSByc0NvbWJvTWFya3NSYW5nZSArIHJlQ29tYm9IYWxmTWFya3NSYW5nZSArIHJzQ29tYm9TeW1ib2xzUmFuZ2UsCiAgICAgIHJzVmFyUmFuZ2UgPSAnXFx1ZmUwZVxcdWZlMGYnOwoKICAvKiogVXNlZCB0byBjb21wb3NlIHVuaWNvZGUgY2FwdHVyZSBncm91cHMuICovCiAgdmFyIHJzQXN0cmFsID0gJ1snICsgcnNBc3RyYWxSYW5nZSArICddJywKICAgICAgcnNDb21ibyA9ICdbJyArIHJzQ29tYm9SYW5nZSArICddJywKICAgICAgcnNGaXR6ID0gJ1xcdWQ4M2NbXFx1ZGZmYi1cXHVkZmZmXScsCiAgICAgIHJzTW9kaWZpZXIgPSAnKD86JyArIHJzQ29tYm8gKyAnfCcgKyByc0ZpdHogKyAnKScsCiAgICAgIHJzTm9uQXN0cmFsID0gJ1teJyArIHJzQXN0cmFsUmFuZ2UgKyAnXScsCiAgICAgIHJzUmVnaW9uYWwgPSAnKD86XFx1ZDgzY1tcXHVkZGU2LVxcdWRkZmZdKXsyfScsCiAgICAgIHJzU3VyclBhaXIgPSAnW1xcdWQ4MDAtXFx1ZGJmZl1bXFx1ZGMwMC1cXHVkZmZmXScsCiAgICAgIHJzWldKID0gJ1xcdTIwMGQnOwoKICAvKiogVXNlZCB0byBjb21wb3NlIHVuaWNvZGUgcmVnZXhlcy4gKi8KICB2YXIgcmVPcHRNb2QgPSByc01vZGlmaWVyICsgJz8nLAogICAgICByc09wdFZhciA9ICdbJyArIHJzVmFyUmFuZ2UgKyAnXT8nLAogICAgICByc09wdEpvaW4gPSAnKD86JyArIHJzWldKICsgJyg/OicgKyBbcnNOb25Bc3RyYWwsIHJzUmVnaW9uYWwsIHJzU3VyclBhaXJdLmpvaW4oJ3wnKSArICcpJyArIHJzT3B0VmFyICsgcmVPcHRNb2QgKyAnKSonLAogICAgICByc1NlcSA9IHJzT3B0VmFyICsgcmVPcHRNb2QgKyByc09wdEpvaW4sCiAgICAgIHJzU3ltYm9sID0gJyg/OicgKyBbcnNOb25Bc3RyYWwgKyByc0NvbWJvICsgJz8nLCByc0NvbWJvLCByc1JlZ2lvbmFsLCByc1N1cnJQYWlyLCByc0FzdHJhbF0uam9pbignfCcpICsgJyknOwoKICAvKiogVXNlZCB0byBtYXRjaCBbc3RyaW5nIHN5bWJvbHNdKGh0dHBzOi8vbWF0aGlhc2J5bmVucy5iZS9ub3Rlcy9qYXZhc2NyaXB0LXVuaWNvZGUpLiAqLwogIHZhciByZVVuaWNvZGUgPSBSZWdFeHAocnNGaXR6ICsgJyg/PScgKyByc0ZpdHogKyAnKXwnICsgcnNTeW1ib2wgKyByc1NlcSwgJ2cnKTsKCiAgLyoqIFVzZWQgdG8gZGV0ZWN0IHN0cmluZ3Mgd2l0aCBbemVyby13aWR0aCBqb2luZXJzIG9yIGNvZGUgcG9pbnRzIGZyb20gdGhlIGFzdHJhbCBwbGFuZXNdKGh0dHA6Ly9lZXYuZWUvYmxvZy8yMDE1LzA5LzEyL2RhcmstY29ybmVycy1vZi11bmljb2RlLykuICovCiAgdmFyIHJlSGFzVW5pY29kZSA9IFJlZ0V4cCgnWycgKyByc1pXSiArIHJzQXN0cmFsUmFuZ2UgICsgcnNDb21ib1JhbmdlICsgcnNWYXJSYW5nZSArICddJyk7CgogIC8qKiBVc2VkIHRvIGlkZW50aWZ5IGB0b1N0cmluZ1RhZ2AgdmFsdWVzIG9mIHR5cGVkIGFycmF5cy4gKi8KICB2YXIgdHlwZWRBcnJheVRhZ3MgPSB7fTsKICB0eXBlZEFycmF5VGFnc1tmbG9hdDMyVGFnXSA9IHR5cGVkQXJyYXlUYWdzW2Zsb2F0NjRUYWddID0KICB0eXBlZEFycmF5VGFnc1tpbnQ4VGFnXSA9IHR5cGVkQXJyYXlUYWdzW2ludDE2VGFnXSA9CiAgdHlwZWRBcnJheVRhZ3NbaW50MzJUYWddID0gdHlwZWRBcnJheVRhZ3NbdWludDhUYWddID0KICB0eXBlZEFycmF5VGFnc1t1aW50OENsYW1wZWRUYWddID0gdHlwZWRBcnJheVRhZ3NbdWludDE2VGFnXSA9CiAgdHlwZWRBcnJheVRhZ3NbdWludDMyVGFnXSA9IHRydWU7CiAgdHlwZWRBcnJheVRhZ3NbYXJnc1RhZ10gPSB0eXBlZEFycmF5VGFnc1thcnJheVRhZ10gPQogIHR5cGVkQXJyYXlUYWdzW2FycmF5QnVmZmVyVGFnXSA9IHR5cGVkQXJyYXlUYWdzW2Jvb2xUYWddID0KICB0eXBlZEFycmF5VGFnc1tkYXRhVmlld1RhZ10gPSB0eXBlZEFycmF5VGFnc1tkYXRlVGFnXSA9CiAgdHlwZWRBcnJheVRhZ3NbZXJyb3JUYWddID0gdHlwZWRBcnJheVRhZ3NbZnVuY1RhZ10gPQogIHR5cGVkQXJyYXlUYWdzW21hcFRhZ10gPSB0eXBlZEFycmF5VGFnc1tudW1iZXJUYWddID0KICB0eXBlZEFycmF5VGFnc1tvYmplY3RUYWddID0gdHlwZWRBcnJheVRhZ3NbcmVnZXhwVGFnXSA9CiAgdHlwZWRBcnJheVRhZ3Nbc2V0VGFnXSA9IHR5cGVkQXJyYXlUYWdzW3N0cmluZ1RhZ10gPQogIHR5cGVkQXJyYXlUYWdzW3dlYWtNYXBUYWddID0gZmFsc2U7CgogIC8qKiBVc2VkIHRvIGlkZW50aWZ5IGB0b1N0cmluZ1RhZ2AgdmFsdWVzIHN1cHBvcnRlZCBieSBgXy5jbG9uZWAuICovCiAgdmFyIGNsb25lYWJsZVRhZ3MgPSB7fTsKICBjbG9uZWFibGVUYWdzW2FyZ3NUYWddID0gY2xvbmVhYmxlVGFnc1thcnJheVRhZ10gPQogIGNsb25lYWJsZVRhZ3NbYXJyYXlCdWZmZXJUYWddID0gY2xvbmVhYmxlVGFnc1tkYXRhVmlld1RhZ10gPQogIGNsb25lYWJsZVRhZ3NbYm9vbFRhZ10gPSBjbG9uZWFibGVUYWdzW2RhdGVUYWddID0KICBjbG9uZWFibGVUYWdzW2Zsb2F0MzJUYWddID0gY2xvbmVhYmxlVGFnc1tmbG9hdDY0VGFnXSA9CiAgY2xvbmVhYmxlVGFnc1tpbnQ4VGFnXSA9IGNsb25lYWJsZVRhZ3NbaW50MTZUYWddID0KICBjbG9uZWFibGVUYWdzW2ludDMyVGFnXSA9IGNsb25lYWJsZVRhZ3NbbWFwVGFnXSA9CiAgY2xvbmVhYmxlVGFnc1tudW1iZXJUYWddID0gY2xvbmVhYmxlVGFnc1tvYmplY3RUYWddID0KICBjbG9uZWFibGVUYWdzW3JlZ2V4cFRhZ10gPSBjbG9uZWFibGVUYWdzW3NldFRhZ10gPQogIGNsb25lYWJsZVRhZ3Nbc3RyaW5nVGFnXSA9IGNsb25lYWJsZVRhZ3Nbc3ltYm9sVGFnXSA9CiAgY2xvbmVhYmxlVGFnc1t1aW50OFRhZ10gPSBjbG9uZWFibGVUYWdzW3VpbnQ4Q2xhbXBlZFRhZ10gPQogIGNsb25lYWJsZVRhZ3NbdWludDE2VGFnXSA9IGNsb25lYWJsZVRhZ3NbdWludDMyVGFnXSA9IHRydWU7CiAgY2xvbmVhYmxlVGFnc1tlcnJvclRhZ10gPSBjbG9uZWFibGVUYWdzW2Z1bmNUYWddID0KICBjbG9uZWFibGVUYWdzW3dlYWtNYXBUYWddID0gZmFsc2U7CgogIC8qKiBCdWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcyB3aXRob3V0IGEgZGVwZW5kZW5jeSBvbiBgcm9vdGAuICovCiAgdmFyIGZyZWVQYXJzZUludCA9IHBhcnNlSW50OwoKICAvKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYGdsb2JhbGAgZnJvbSBOb2RlLmpzLiAqLwogIHZhciBmcmVlR2xvYmFsID0gdHlwZW9mIGdsb2JhbCA9PSAnb2JqZWN0JyAmJiBnbG9iYWwgJiYgZ2xvYmFsLk9iamVjdCA9PT0gT2JqZWN0ICYmIGdsb2JhbDsKCiAgLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBzZWxmYC4gKi8KICB2YXIgZnJlZVNlbGYgPSB0eXBlb2Ygc2VsZiA9PSAnb2JqZWN0JyAmJiBzZWxmICYmIHNlbGYuT2JqZWN0ID09PSBPYmplY3QgJiYgc2VsZjsKCiAgLyoqIFVzZWQgYXMgYSByZWZlcmVuY2UgdG8gdGhlIGdsb2JhbCBvYmplY3QuICovCiAgdmFyIHJvb3QgPSBmcmVlR2xvYmFsIHx8IGZyZWVTZWxmIHx8IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7CgogIC8qKiBEZXRlY3QgZnJlZSB2YXJpYWJsZSBgZXhwb3J0c2AuICovCiAgdmFyIGZyZWVFeHBvcnRzID0gdHlwZW9mIGV4cG9ydHMgPT0gJ29iamVjdCcgJiYgZXhwb3J0cyAmJiAhZXhwb3J0cy5ub2RlVHlwZSAmJiBleHBvcnRzOwoKICAvKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYG1vZHVsZWAuICovCiAgdmFyIGZyZWVNb2R1bGUgPSBmcmVlRXhwb3J0cyAmJiB0eXBlb2YgbW9kdWxlID09ICdvYmplY3QnICYmIG1vZHVsZSAmJiAhbW9kdWxlLm5vZGVUeXBlICYmIG1vZHVsZTsKCiAgLyoqIERldGVjdCB0aGUgcG9wdWxhciBDb21tb25KUyBleHRlbnNpb24gYG1vZHVsZS5leHBvcnRzYC4gKi8KICB2YXIgbW9kdWxlRXhwb3J0cyA9IGZyZWVNb2R1bGUgJiYgZnJlZU1vZHVsZS5leHBvcnRzID09PSBmcmVlRXhwb3J0czsKCiAgLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBwcm9jZXNzYCBmcm9tIE5vZGUuanMuICovCiAgdmFyIGZyZWVQcm9jZXNzID0gbW9kdWxlRXhwb3J0cyAmJiBmcmVlR2xvYmFsLnByb2Nlc3M7CgogIC8qKiBVc2VkIHRvIGFjY2VzcyBmYXN0ZXIgTm9kZS5qcyBoZWxwZXJzLiAqLwogIHZhciBub2RlVXRpbCA9IChmdW5jdGlvbigpIHsKICAgIHRyeSB7CiAgICAgIHJldHVybiBmcmVlUHJvY2VzcyAmJiBmcmVlUHJvY2Vzcy5iaW5kaW5nICYmIGZyZWVQcm9jZXNzLmJpbmRpbmcoJ3V0aWwnKTsKICAgIH0gY2F0Y2ggKGUpIHt9CiAgfSgpKTsKCiAgLyogTm9kZS5qcyBoZWxwZXIgcmVmZXJlbmNlcy4gKi8KICB2YXIgbm9kZUlzQXJyYXlCdWZmZXIgPSBub2RlVXRpbCAmJiBub2RlVXRpbC5pc0FycmF5QnVmZmVyLAogICAgICBub2RlSXNEYXRlID0gbm9kZVV0aWwgJiYgbm9kZVV0aWwuaXNEYXRlLAogICAgICBub2RlSXNNYXAgPSBub2RlVXRpbCAmJiBub2RlVXRpbC5pc01hcCwKICAgICAgbm9kZUlzUmVnRXhwID0gbm9kZVV0aWwgJiYgbm9kZVV0aWwuaXNSZWdFeHAsCiAgICAgIG5vZGVJc1NldCA9IG5vZGVVdGlsICYmIG5vZGVVdGlsLmlzU2V0LAogICAgICBub2RlSXNUeXBlZEFycmF5ID0gbm9kZVV0aWwgJiYgbm9kZVV0aWwuaXNUeXBlZEFycmF5OwoKICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCiAgLyoqCiAgICogQWRkcyB0aGUga2V5LXZhbHVlIGBwYWlyYCB0byBgbWFwYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG1hcCBUaGUgbWFwIHRvIG1vZGlmeS4KICAgKiBAcGFyYW0ge0FycmF5fSBwYWlyIFRoZSBrZXktdmFsdWUgcGFpciB0byBhZGQuCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgbWFwYC4KICAgKi8KICBmdW5jdGlvbiBhZGRNYXBFbnRyeShtYXAsIHBhaXIpIHsKICAgIC8vIERvbid0IHJldHVybiBgbWFwLnNldGAgYmVjYXVzZSBpdCdzIG5vdCBjaGFpbmFibGUgaW4gSUUgMTEuCiAgICBtYXAuc2V0KHBhaXJbMF0sIHBhaXJbMV0pOwogICAgcmV0dXJuIG1hcDsKICB9CgogIC8qKgogICAqIEFkZHMgYHZhbHVlYCB0byBgc2V0YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IHNldCBUaGUgc2V0IHRvIG1vZGlmeS4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBhZGQuCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgc2V0YC4KICAgKi8KICBmdW5jdGlvbiBhZGRTZXRFbnRyeShzZXQsIHZhbHVlKSB7CiAgICAvLyBEb24ndCByZXR1cm4gYHNldC5hZGRgIGJlY2F1c2UgaXQncyBub3QgY2hhaW5hYmxlIGluIElFIDExLgogICAgc2V0LmFkZCh2YWx1ZSk7CiAgICByZXR1cm4gc2V0OwogIH0KCiAgLyoqCiAgICogQSBmYXN0ZXIgYWx0ZXJuYXRpdmUgdG8gYEZ1bmN0aW9uI2FwcGx5YCwgdGhpcyBmdW5jdGlvbiBpbnZva2VzIGBmdW5jYAogICAqIHdpdGggdGhlIGB0aGlzYCBiaW5kaW5nIG9mIGB0aGlzQXJnYCBhbmQgdGhlIGFyZ3VtZW50cyBvZiBgYXJnc2AuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGludm9rZS4KICAgKiBAcGFyYW0geyp9IHRoaXNBcmcgVGhlIGB0aGlzYCBiaW5kaW5nIG9mIGBmdW5jYC4KICAgKiBAcGFyYW0ge0FycmF5fSBhcmdzIFRoZSBhcmd1bWVudHMgdG8gaW52b2tlIGBmdW5jYCB3aXRoLgogICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSByZXN1bHQgb2YgYGZ1bmNgLgogICAqLwogIGZ1bmN0aW9uIGFwcGx5KGZ1bmMsIHRoaXNBcmcsIGFyZ3MpIHsKICAgIHN3aXRjaCAoYXJncy5sZW5ndGgpIHsKICAgICAgY2FzZSAwOiByZXR1cm4gZnVuYy5jYWxsKHRoaXNBcmcpOwogICAgICBjYXNlIDE6IHJldHVybiBmdW5jLmNhbGwodGhpc0FyZywgYXJnc1swXSk7CiAgICAgIGNhc2UgMjogcmV0dXJuIGZ1bmMuY2FsbCh0aGlzQXJnLCBhcmdzWzBdLCBhcmdzWzFdKTsKICAgICAgY2FzZSAzOiByZXR1cm4gZnVuYy5jYWxsKHRoaXNBcmcsIGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0pOwogICAgfQogICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpc0FyZywgYXJncyk7CiAgfQoKICAvKioKICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8uZm9yRWFjaGAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yCiAgICogaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5XSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGBhcnJheWAuCiAgICovCiAgZnVuY3Rpb24gYXJyYXlFYWNoKGFycmF5LCBpdGVyYXRlZSkgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7CgogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgaWYgKGl0ZXJhdGVlKGFycmF5W2luZGV4XSwgaW5kZXgsIGFycmF5KSA9PT0gZmFsc2UpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGFycmF5OwogIH0KCiAgLyoqCiAgICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBfLmZpbHRlcmAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yCiAgICogaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5XSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWRpY2F0ZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGZpbHRlcmVkIGFycmF5LgogICAqLwogIGZ1bmN0aW9uIGFycmF5RmlsdGVyKGFycmF5LCBwcmVkaWNhdGUpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoLAogICAgICAgIHJlc0luZGV4ID0gMCwKICAgICAgICByZXN1bHQgPSBbXTsKCiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICB2YXIgdmFsdWUgPSBhcnJheVtpbmRleF07CiAgICAgIGlmIChwcmVkaWNhdGUodmFsdWUsIGluZGV4LCBhcnJheSkpIHsKICAgICAgICByZXN1bHRbcmVzSW5kZXgrK10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5pbmNsdWRlc2AgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yCiAgICogc3BlY2lmeWluZyBhbiBpbmRleCB0byBzZWFyY2ggZnJvbS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5XSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0geyp9IHRhcmdldCBUaGUgdmFsdWUgdG8gc2VhcmNoIGZvci4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHRhcmdldGAgaXMgZm91bmQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBhcnJheUluY2x1ZGVzKGFycmF5LCB2YWx1ZSkgewogICAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoOwogICAgcmV0dXJuICEhbGVuZ3RoICYmIGJhc2VJbmRleE9mKGFycmF5LCB2YWx1ZSwgMCkgPiAtMTsKICB9CgogIC8qKgogICAqIFRoaXMgZnVuY3Rpb24gaXMgbGlrZSBgYXJyYXlJbmNsdWRlc2AgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBhIGNvbXBhcmF0b3IuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IFthcnJheV0gVGhlIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHsqfSB0YXJnZXQgVGhlIHZhbHVlIHRvIHNlYXJjaCBmb3IuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY29tcGFyYXRvciBUaGUgY29tcGFyYXRvciBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdGFyZ2V0YCBpcyBmb3VuZCwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGFycmF5SW5jbHVkZXNXaXRoKGFycmF5LCB2YWx1ZSwgY29tcGFyYXRvcikgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7CgogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgaWYgKGNvbXBhcmF0b3IodmFsdWUsIGFycmF5W2luZGV4XSkpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgLyoqCiAgICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBfLm1hcGAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yIGl0ZXJhdGVlCiAgICogc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5XSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgbWFwcGVkIGFycmF5LgogICAqLwogIGZ1bmN0aW9uIGFycmF5TWFwKGFycmF5LCBpdGVyYXRlZSkgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGgsCiAgICAgICAgcmVzdWx0ID0gQXJyYXkobGVuZ3RoKTsKCiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICByZXN1bHRbaW5kZXhdID0gaXRlcmF0ZWUoYXJyYXlbaW5kZXhdLCBpbmRleCwgYXJyYXkpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIEFwcGVuZHMgdGhlIGVsZW1lbnRzIG9mIGB2YWx1ZXNgIHRvIGBhcnJheWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBtb2RpZnkuCiAgICogQHBhcmFtIHtBcnJheX0gdmFsdWVzIFRoZSB2YWx1ZXMgdG8gYXBwZW5kLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBgYXJyYXlgLgogICAqLwogIGZ1bmN0aW9uIGFycmF5UHVzaChhcnJheSwgdmFsdWVzKSB7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICBsZW5ndGggPSB2YWx1ZXMubGVuZ3RoLAogICAgICAgIG9mZnNldCA9IGFycmF5Lmxlbmd0aDsKCiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICBhcnJheVtvZmZzZXQgKyBpbmRleF0gPSB2YWx1ZXNbaW5kZXhdOwogICAgfQogICAgcmV0dXJuIGFycmF5OwogIH0KCiAgLyoqCiAgICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBfLnJlZHVjZWAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yCiAgICogaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5XSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uCiAgICogQHBhcmFtIHsqfSBbYWNjdW11bGF0b3JdIFRoZSBpbml0aWFsIHZhbHVlLgogICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2luaXRBY2N1bV0gU3BlY2lmeSB1c2luZyB0aGUgZmlyc3QgZWxlbWVudCBvZiBgYXJyYXlgIGFzCiAgICogIHRoZSBpbml0aWFsIHZhbHVlLgogICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBhY2N1bXVsYXRlZCB2YWx1ZS4KICAgKi8KICBmdW5jdGlvbiBhcnJheVJlZHVjZShhcnJheSwgaXRlcmF0ZWUsIGFjY3VtdWxhdG9yLCBpbml0QWNjdW0pIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoOwoKICAgIGlmIChpbml0QWNjdW0gJiYgbGVuZ3RoKSB7CiAgICAgIGFjY3VtdWxhdG9yID0gYXJyYXlbKytpbmRleF07CiAgICB9CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICBhY2N1bXVsYXRvciA9IGl0ZXJhdGVlKGFjY3VtdWxhdG9yLCBhcnJheVtpbmRleF0sIGluZGV4LCBhcnJheSk7CiAgICB9CiAgICByZXR1cm4gYWNjdW11bGF0b3I7CiAgfQoKICAvKioKICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8uc29tZWAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yIGl0ZXJhdGVlCiAgICogc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5XSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWRpY2F0ZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBhbnkgZWxlbWVudCBwYXNzZXMgdGhlIHByZWRpY2F0ZSBjaGVjaywKICAgKiAgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGFycmF5U29tZShhcnJheSwgcHJlZGljYXRlKSB7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDsKCiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICBpZiAocHJlZGljYXRlKGFycmF5W2luZGV4XSwgaW5kZXgsIGFycmF5KSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvKioKICAgKiBDb252ZXJ0cyBhbiBBU0NJSSBgc3RyaW5nYCB0byBhbiBhcnJheS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtzdHJpbmd9IHN0cmluZyBUaGUgc3RyaW5nIHRvIGNvbnZlcnQuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBjb252ZXJ0ZWQgYXJyYXkuCiAgICovCiAgZnVuY3Rpb24gYXNjaWlUb0FycmF5KHN0cmluZykgewogICAgcmV0dXJuIHN0cmluZy5zcGxpdCgnJyk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5maW5kSW5kZXhgIGFuZCBgXy5maW5kTGFzdEluZGV4YCB3aXRob3V0CiAgICogc3VwcG9ydCBmb3IgaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uCiAgICogQHBhcmFtIHtudW1iZXJ9IGZyb21JbmRleCBUaGUgaW5kZXggdG8gc2VhcmNoIGZyb20uCiAgICogQHBhcmFtIHtib29sZWFufSBbZnJvbVJpZ2h0XSBTcGVjaWZ5IGl0ZXJhdGluZyBmcm9tIHJpZ2h0IHRvIGxlZnQuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIG1hdGNoZWQgdmFsdWUsIGVsc2UgYC0xYC4KICAgKi8KICBmdW5jdGlvbiBiYXNlRmluZEluZGV4KGFycmF5LCBwcmVkaWNhdGUsIGZyb21JbmRleCwgZnJvbVJpZ2h0KSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoLAogICAgICAgIGluZGV4ID0gZnJvbUluZGV4ICsgKGZyb21SaWdodCA/IDEgOiAtMSk7CgogICAgd2hpbGUgKChmcm9tUmlnaHQgPyBpbmRleC0tIDogKytpbmRleCA8IGxlbmd0aCkpIHsKICAgICAgaWYgKHByZWRpY2F0ZShhcnJheVtpbmRleF0sIGluZGV4LCBhcnJheSkpIHsKICAgICAgICByZXR1cm4gaW5kZXg7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAtMTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmluZGV4T2ZgIHdpdGhvdXQgYGZyb21JbmRleGAgYm91bmRzIGNoZWNrcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2VhcmNoIGZvci4KICAgKiBAcGFyYW0ge251bWJlcn0gZnJvbUluZGV4IFRoZSBpbmRleCB0byBzZWFyY2ggZnJvbS4KICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgbWF0Y2hlZCB2YWx1ZSwgZWxzZSBgLTFgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VJbmRleE9mKGFycmF5LCB2YWx1ZSwgZnJvbUluZGV4KSB7CiAgICByZXR1cm4gdmFsdWUgPT09IHZhbHVlCiAgICAgID8gc3RyaWN0SW5kZXhPZihhcnJheSwgdmFsdWUsIGZyb21JbmRleCkKICAgICAgOiBiYXNlRmluZEluZGV4KGFycmF5LCBiYXNlSXNOYU4sIGZyb21JbmRleCk7CiAgfQoKICAvKioKICAgKiBUaGlzIGZ1bmN0aW9uIGlzIGxpa2UgYGJhc2VJbmRleE9mYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGEgY29tcGFyYXRvci4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2VhcmNoIGZvci4KICAgKiBAcGFyYW0ge251bWJlcn0gZnJvbUluZGV4IFRoZSBpbmRleCB0byBzZWFyY2ggZnJvbS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjb21wYXJhdG9yIFRoZSBjb21wYXJhdG9yIGludm9rZWQgcGVyIGVsZW1lbnQuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIG1hdGNoZWQgdmFsdWUsIGVsc2UgYC0xYC4KICAgKi8KICBmdW5jdGlvbiBiYXNlSW5kZXhPZldpdGgoYXJyYXksIHZhbHVlLCBmcm9tSW5kZXgsIGNvbXBhcmF0b3IpIHsKICAgIHZhciBpbmRleCA9IGZyb21JbmRleCAtIDEsCiAgICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwoKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIGlmIChjb21wYXJhdG9yKGFycmF5W2luZGV4XSwgdmFsdWUpKSB7CiAgICAgICAgcmV0dXJuIGluZGV4OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gLTE7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5pc05hTmAgd2l0aG91dCBzdXBwb3J0IGZvciBudW1iZXIgb2JqZWN0cy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYE5hTmAsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBiYXNlSXNOYU4odmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZSAhPT0gdmFsdWU7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5wcm9wZXJ0eWAgd2l0aG91dCBzdXBwb3J0IGZvciBkZWVwIHBhdGhzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHByb3BlcnR5IHRvIGdldC4KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBhY2Nlc3NvciBmdW5jdGlvbi4KICAgKi8KICBmdW5jdGlvbiBiYXNlUHJvcGVydHkoa2V5KSB7CiAgICByZXR1cm4gZnVuY3Rpb24ob2JqZWN0KSB7CiAgICAgIHJldHVybiBvYmplY3QgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IG9iamVjdFtrZXldOwogICAgfTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnRpbWVzYCB3aXRob3V0IHN1cHBvcnQgZm9yIGl0ZXJhdGVlIHNob3J0aGFuZHMKICAgKiBvciBtYXggYXJyYXkgbGVuZ3RoIGNoZWNrcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtudW1iZXJ9IG4gVGhlIG51bWJlciBvZiB0aW1lcyB0byBpbnZva2UgYGl0ZXJhdGVlYC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcmVzdWx0cy4KICAgKi8KICBmdW5jdGlvbiBiYXNlVGltZXMobiwgaXRlcmF0ZWUpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIHJlc3VsdCA9IEFycmF5KG4pOwoKICAgIHdoaWxlICgrK2luZGV4IDwgbikgewogICAgICByZXN1bHRbaW5kZXhdID0gaXRlcmF0ZWUoaW5kZXgpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnVuYXJ5YCB3aXRob3V0IHN1cHBvcnQgZm9yIHN0b3JpbmcgbWV0YWRhdGEuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGNhcCBhcmd1bWVudHMgZm9yLgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGNhcHBlZCBmdW5jdGlvbi4KICAgKi8KICBmdW5jdGlvbiBiYXNlVW5hcnkoZnVuYykgewogICAgcmV0dXJuIGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiBmdW5jKHZhbHVlKTsKICAgIH07CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy52YWx1ZXNgIGFuZCBgXy52YWx1ZXNJbmAgd2hpY2ggY3JlYXRlcyBhbgogICAqIGFycmF5IG9mIGBvYmplY3RgIHByb3BlcnR5IHZhbHVlcyBjb3JyZXNwb25kaW5nIHRvIHRoZSBwcm9wZXJ0eSBuYW1lcwogICAqIG9mIGBwcm9wc2AuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcGFyYW0ge0FycmF5fSBwcm9wcyBUaGUgcHJvcGVydHkgbmFtZXMgdG8gZ2V0IHZhbHVlcyBmb3IuCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcHJvcGVydHkgdmFsdWVzLgogICAqLwogIGZ1bmN0aW9uIGJhc2VWYWx1ZXMob2JqZWN0LCBwcm9wcykgewogICAgcmV0dXJuIGFycmF5TWFwKHByb3BzLCBmdW5jdGlvbihrZXkpIHsKICAgICAgcmV0dXJuIG9iamVjdFtrZXldOwogICAgfSk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYSBgY2FjaGVgIHZhbHVlIGZvciBga2V5YCBleGlzdHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBjYWNoZSBUaGUgY2FjaGUgdG8gcXVlcnkuCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSBlbnRyeSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYW4gZW50cnkgZm9yIGBrZXlgIGV4aXN0cywgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGNhY2hlSGFzKGNhY2hlLCBrZXkpIHsKICAgIHJldHVybiBjYWNoZS5oYXMoa2V5KTsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIHZhbHVlIGF0IGBrZXlgIG9mIGBvYmplY3RgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gW29iamVjdF0gVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHByb3BlcnR5IHRvIGdldC4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgcHJvcGVydHkgdmFsdWUuCiAgICovCiAgZnVuY3Rpb24gZ2V0VmFsdWUob2JqZWN0LCBrZXkpIHsKICAgIHJldHVybiBvYmplY3QgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IG9iamVjdFtrZXldOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGBzdHJpbmdgIGNvbnRhaW5zIFVuaWNvZGUgc3ltYm9scy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtzdHJpbmd9IHN0cmluZyBUaGUgc3RyaW5nIHRvIGluc3BlY3QuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGEgc3ltYm9sIGlzIGZvdW5kLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gaGFzVW5pY29kZShzdHJpbmcpIHsKICAgIHJldHVybiByZUhhc1VuaWNvZGUudGVzdChzdHJpbmcpOwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYGl0ZXJhdG9yYCB0byBhbiBhcnJheS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IGl0ZXJhdG9yIFRoZSBpdGVyYXRvciB0byBjb252ZXJ0LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgY29udmVydGVkIGFycmF5LgogICAqLwogIGZ1bmN0aW9uIGl0ZXJhdG9yVG9BcnJheShpdGVyYXRvcikgewogICAgdmFyIGRhdGEsCiAgICAgICAgcmVzdWx0ID0gW107CgogICAgd2hpbGUgKCEoZGF0YSA9IGl0ZXJhdG9yLm5leHQoKSkuZG9uZSkgewogICAgICByZXN1bHQucHVzaChkYXRhLnZhbHVlKTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBDb252ZXJ0cyBgbWFwYCB0byBpdHMga2V5LXZhbHVlIHBhaXJzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gbWFwIFRoZSBtYXAgdG8gY29udmVydC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGtleS12YWx1ZSBwYWlycy4KICAgKi8KICBmdW5jdGlvbiBtYXBUb0FycmF5KG1hcCkgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgcmVzdWx0ID0gQXJyYXkobWFwLnNpemUpOwoKICAgIG1hcC5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHsKICAgICAgcmVzdWx0WysraW5kZXhdID0gW2tleSwgdmFsdWVdOwogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhIHVuYXJ5IGZ1bmN0aW9uIHRoYXQgaW52b2tlcyBgZnVuY2Agd2l0aCBpdHMgYXJndW1lbnQgdHJhbnNmb3JtZWQuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIHdyYXAuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gdHJhbnNmb3JtIFRoZSBhcmd1bWVudCB0cmFuc2Zvcm0uCiAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gb3ZlckFyZyhmdW5jLCB0cmFuc2Zvcm0pIHsKICAgIHJldHVybiBmdW5jdGlvbihhcmcpIHsKICAgICAgcmV0dXJuIGZ1bmModHJhbnNmb3JtKGFyZykpOwogICAgfTsKICB9CgogIC8qKgogICAqIENvbnZlcnRzIGBzZXRgIHRvIGFuIGFycmF5IG9mIGl0cyB2YWx1ZXMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBzZXQgVGhlIHNldCB0byBjb252ZXJ0LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgdmFsdWVzLgogICAqLwogIGZ1bmN0aW9uIHNldFRvQXJyYXkoc2V0KSB7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICByZXN1bHQgPSBBcnJheShzZXQuc2l6ZSk7CgogICAgc2V0LmZvckVhY2goZnVuY3Rpb24odmFsdWUpIHsKICAgICAgcmVzdWx0WysraW5kZXhdID0gdmFsdWU7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8uaW5kZXhPZmAgd2hpY2ggcGVyZm9ybXMgc3RyaWN0IGVxdWFsaXR5CiAgICogY29tcGFyaXNvbnMgb2YgdmFsdWVzLCBpLmUuIGA9PT1gLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZWFyY2ggZm9yLgogICAqIEBwYXJhbSB7bnVtYmVyfSBmcm9tSW5kZXggVGhlIGluZGV4IHRvIHNlYXJjaCBmcm9tLgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBtYXRjaGVkIHZhbHVlLCBlbHNlIGAtMWAuCiAgICovCiAgZnVuY3Rpb24gc3RyaWN0SW5kZXhPZihhcnJheSwgdmFsdWUsIGZyb21JbmRleCkgewogICAgdmFyIGluZGV4ID0gZnJvbUluZGV4IC0gMSwKICAgICAgICBsZW5ndGggPSBhcnJheS5sZW5ndGg7CgogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgaWYgKGFycmF5W2luZGV4XSA9PT0gdmFsdWUpIHsKICAgICAgICByZXR1cm4gaW5kZXg7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAtMTsKICB9CgogIC8qKgogICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5sYXN0SW5kZXhPZmAgd2hpY2ggcGVyZm9ybXMgc3RyaWN0IGVxdWFsaXR5CiAgICogY29tcGFyaXNvbnMgb2YgdmFsdWVzLCBpLmUuIGA9PT1gLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZWFyY2ggZm9yLgogICAqIEBwYXJhbSB7bnVtYmVyfSBmcm9tSW5kZXggVGhlIGluZGV4IHRvIHNlYXJjaCBmcm9tLgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBtYXRjaGVkIHZhbHVlLCBlbHNlIGAtMWAuCiAgICovCiAgZnVuY3Rpb24gc3RyaWN0TGFzdEluZGV4T2YoYXJyYXksIHZhbHVlLCBmcm9tSW5kZXgpIHsKICAgIHZhciBpbmRleCA9IGZyb21JbmRleCArIDE7CiAgICB3aGlsZSAoaW5kZXgtLSkgewogICAgICBpZiAoYXJyYXlbaW5kZXhdID09PSB2YWx1ZSkgewogICAgICAgIHJldHVybiBpbmRleDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGluZGV4OwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYHN0cmluZ2AgdG8gYW4gYXJyYXkuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7c3RyaW5nfSBzdHJpbmcgVGhlIHN0cmluZyB0byBjb252ZXJ0LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgY29udmVydGVkIGFycmF5LgogICAqLwogIGZ1bmN0aW9uIHN0cmluZ1RvQXJyYXkoc3RyaW5nKSB7CiAgICByZXR1cm4gaGFzVW5pY29kZShzdHJpbmcpCiAgICAgID8gdW5pY29kZVRvQXJyYXkoc3RyaW5nKQogICAgICA6IGFzY2lpVG9BcnJheShzdHJpbmcpOwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYSBVbmljb2RlIGBzdHJpbmdgIHRvIGFuIGFycmF5LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyaW5nIFRoZSBzdHJpbmcgdG8gY29udmVydC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBhcnJheS4KICAgKi8KICBmdW5jdGlvbiB1bmljb2RlVG9BcnJheShzdHJpbmcpIHsKICAgIHJldHVybiBzdHJpbmcubWF0Y2gocmVVbmljb2RlKSB8fCBbXTsKICB9CgogIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKICAvKiogVXNlZCBmb3IgYnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMuICovCiAgdmFyIGFycmF5UHJvdG8gPSBBcnJheS5wcm90b3R5cGUsCiAgICAgIGZ1bmNQcm90byA9IEZ1bmN0aW9uLnByb3RvdHlwZSwKICAgICAgb2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlOwoKICAvKiogVXNlZCB0byBkZXRlY3Qgb3ZlcnJlYWNoaW5nIGNvcmUtanMgc2hpbXMuICovCiAgdmFyIGNvcmVKc0RhdGEgPSByb290WydfX2NvcmUtanNfc2hhcmVkX18nXTsKCiAgLyoqIFVzZWQgdG8gcmVzb2x2ZSB0aGUgZGVjb21waWxlZCBzb3VyY2Ugb2YgZnVuY3Rpb25zLiAqLwogIHZhciBmdW5jVG9TdHJpbmcgPSBmdW5jUHJvdG8udG9TdHJpbmc7CgogIC8qKiBVc2VkIHRvIGNoZWNrIG9iamVjdHMgZm9yIG93biBwcm9wZXJ0aWVzLiAqLwogIHZhciBoYXNPd25Qcm9wZXJ0eSA9IG9iamVjdFByb3RvLmhhc093blByb3BlcnR5OwoKICAvKiogVXNlZCB0byBkZXRlY3QgbWV0aG9kcyBtYXNxdWVyYWRpbmcgYXMgbmF0aXZlLiAqLwogIHZhciBtYXNrU3JjS2V5ID0gKGZ1bmN0aW9uKCkgewogICAgdmFyIHVpZCA9IC9bXi5dKyQvLmV4ZWMoY29yZUpzRGF0YSAmJiBjb3JlSnNEYXRhLmtleXMgJiYgY29yZUpzRGF0YS5rZXlzLklFX1BST1RPIHx8ICcnKTsKICAgIHJldHVybiB1aWQgPyAoJ1N5bWJvbChzcmMpXzEuJyArIHVpZCkgOiAnJzsKICB9KCkpOwoKICAvKioKICAgKiBVc2VkIHRvIHJlc29sdmUgdGhlCiAgICogW2B0b1N0cmluZ1RhZ2BdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLW9iamVjdC5wcm90b3R5cGUudG9zdHJpbmcpCiAgICogb2YgdmFsdWVzLgogICAqLwogIHZhciBuYXRpdmVPYmplY3RUb1N0cmluZyA9IG9iamVjdFByb3RvLnRvU3RyaW5nOwoKICAvKiogVXNlZCB0byBpbmZlciB0aGUgYE9iamVjdGAgY29uc3RydWN0b3IuICovCiAgdmFyIG9iamVjdEN0b3JTdHJpbmcgPSBmdW5jVG9TdHJpbmcuY2FsbChPYmplY3QpOwoKICAvKiogVXNlZCB0byBkZXRlY3QgaWYgYSBtZXRob2QgaXMgbmF0aXZlLiAqLwogIHZhciByZUlzTmF0aXZlID0gUmVnRXhwKCdeJyArCiAgICBmdW5jVG9TdHJpbmcuY2FsbChoYXNPd25Qcm9wZXJ0eSkucmVwbGFjZShyZVJlZ0V4cENoYXIsICdcXCQmJykKICAgIC5yZXBsYWNlKC9oYXNPd25Qcm9wZXJ0eXwoZnVuY3Rpb24pLio/KD89XFxcKCl8IGZvciAuKz8oPz1cXFxdKS9nLCAnJDEuKj8nKSArICckJwogICk7CgogIC8qKiBCdWlsdC1pbiB2YWx1ZSByZWZlcmVuY2VzLiAqLwogIHZhciBCdWZmZXIgPSBtb2R1bGVFeHBvcnRzID8gcm9vdC5CdWZmZXIgOiB1bmRlZmluZWQsCiAgICAgIFN5bWJvbCA9IHJvb3QuU3ltYm9sLAogICAgICBVaW50OEFycmF5ID0gcm9vdC5VaW50OEFycmF5LAogICAgICBhbGxvY1Vuc2FmZSA9IEJ1ZmZlciA/IEJ1ZmZlci5hbGxvY1Vuc2FmZSA6IHVuZGVmaW5lZCwKICAgICAgZ2V0UHJvdG90eXBlID0gb3ZlckFyZyhPYmplY3QuZ2V0UHJvdG90eXBlT2YsIE9iamVjdCksCiAgICAgIG9iamVjdENyZWF0ZSA9IE9iamVjdC5jcmVhdGUsCiAgICAgIHByb3BlcnR5SXNFbnVtZXJhYmxlID0gb2JqZWN0UHJvdG8ucHJvcGVydHlJc0VudW1lcmFibGUsCiAgICAgIHNwbGljZSA9IGFycmF5UHJvdG8uc3BsaWNlLAogICAgICBzcHJlYWRhYmxlU3ltYm9sID0gU3ltYm9sID8gU3ltYm9sLmlzQ29uY2F0U3ByZWFkYWJsZSA6IHVuZGVmaW5lZCwKICAgICAgc3ltSXRlcmF0b3IgPSBTeW1ib2wgPyBTeW1ib2wuaXRlcmF0b3IgOiB1bmRlZmluZWQsCiAgICAgIHN5bVRvU3RyaW5nVGFnID0gU3ltYm9sID8gU3ltYm9sLnRvU3RyaW5nVGFnIDogdW5kZWZpbmVkOwoKICB2YXIgZGVmaW5lUHJvcGVydHkgPSAoZnVuY3Rpb24oKSB7CiAgICB0cnkgewogICAgICB2YXIgZnVuYyA9IGdldE5hdGl2ZShPYmplY3QsICdkZWZpbmVQcm9wZXJ0eScpOwogICAgICBmdW5jKHt9LCAnJywge30pOwogICAgICByZXR1cm4gZnVuYzsKICAgIH0gY2F0Y2ggKGUpIHt9CiAgfSgpKTsKCiAgLyogQnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMgZm9yIHRob3NlIHdpdGggdGhlIHNhbWUgbmFtZSBhcyBvdGhlciBgbG9kYXNoYCBtZXRob2RzLiAqLwogIHZhciBuYXRpdmVDZWlsID0gTWF0aC5jZWlsLAogICAgICBuYXRpdmVGbG9vciA9IE1hdGguZmxvb3IsCiAgICAgIG5hdGl2ZUdldFN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzLAogICAgICBuYXRpdmVJc0J1ZmZlciA9IEJ1ZmZlciA/IEJ1ZmZlci5pc0J1ZmZlciA6IHVuZGVmaW5lZCwKICAgICAgbmF0aXZlSXNGaW5pdGUgPSByb290LmlzRmluaXRlLAogICAgICBuYXRpdmVKb2luID0gYXJyYXlQcm90by5qb2luLAogICAgICBuYXRpdmVLZXlzID0gb3ZlckFyZyhPYmplY3Qua2V5cywgT2JqZWN0KSwKICAgICAgbmF0aXZlTWF4ID0gTWF0aC5tYXgsCiAgICAgIG5hdGl2ZU1pbiA9IE1hdGgubWluLAogICAgICBuYXRpdmVOb3cgPSBEYXRlLm5vdywKICAgICAgbmF0aXZlUmV2ZXJzZSA9IGFycmF5UHJvdG8ucmV2ZXJzZTsKCiAgLyogQnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMgdGhhdCBhcmUgdmVyaWZpZWQgdG8gYmUgbmF0aXZlLiAqLwogIHZhciBEYXRhVmlldyA9IGdldE5hdGl2ZShyb290LCAnRGF0YVZpZXcnKSwKICAgICAgTWFwID0gZ2V0TmF0aXZlKHJvb3QsICdNYXAnKSwKICAgICAgUHJvbWlzZSA9IGdldE5hdGl2ZShyb290LCAnUHJvbWlzZScpLAogICAgICBTZXQgPSBnZXROYXRpdmUocm9vdCwgJ1NldCcpLAogICAgICBXZWFrTWFwID0gZ2V0TmF0aXZlKHJvb3QsICdXZWFrTWFwJyksCiAgICAgIG5hdGl2ZUNyZWF0ZSA9IGdldE5hdGl2ZShPYmplY3QsICdjcmVhdGUnKTsKCiAgLyoqIFVzZWQgdG8gbG9va3VwIHVubWluaWZpZWQgZnVuY3Rpb24gbmFtZXMuICovCiAgdmFyIHJlYWxOYW1lcyA9IHt9OwoKICAvKiogVXNlZCB0byBkZXRlY3QgbWFwcywgc2V0cywgYW5kIHdlYWttYXBzLiAqLwogIHZhciBkYXRhVmlld0N0b3JTdHJpbmcgPSB0b1NvdXJjZShEYXRhVmlldyksCiAgICAgIG1hcEN0b3JTdHJpbmcgPSB0b1NvdXJjZShNYXApLAogICAgICBwcm9taXNlQ3RvclN0cmluZyA9IHRvU291cmNlKFByb21pc2UpLAogICAgICBzZXRDdG9yU3RyaW5nID0gdG9Tb3VyY2UoU2V0KSwKICAgICAgd2Vha01hcEN0b3JTdHJpbmcgPSB0b1NvdXJjZShXZWFrTWFwKTsKCiAgLyoqIFVzZWQgdG8gY29udmVydCBzeW1ib2xzIHRvIHByaW1pdGl2ZXMgYW5kIHN0cmluZ3MuICovCiAgdmFyIHN5bWJvbFByb3RvID0gU3ltYm9sID8gU3ltYm9sLnByb3RvdHlwZSA6IHVuZGVmaW5lZCwKICAgICAgc3ltYm9sVmFsdWVPZiA9IHN5bWJvbFByb3RvID8gc3ltYm9sUHJvdG8udmFsdWVPZiA6IHVuZGVmaW5lZCwKICAgICAgc3ltYm9sVG9TdHJpbmcgPSBzeW1ib2xQcm90byA/IHN5bWJvbFByb3RvLnRvU3RyaW5nIDogdW5kZWZpbmVkOwoKICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgogIC8qKgogICAqIENyZWF0ZXMgYSBgbG9kYXNoYCBvYmplY3Qgd2hpY2ggd3JhcHMgYHZhbHVlYCB0byBlbmFibGUgaW1wbGljaXQgbWV0aG9kCiAgICogY2hhaW4gc2VxdWVuY2VzLiBNZXRob2RzIHRoYXQgb3BlcmF0ZSBvbiBhbmQgcmV0dXJuIGFycmF5cywgY29sbGVjdGlvbnMsCiAgICogYW5kIGZ1bmN0aW9ucyBjYW4gYmUgY2hhaW5lZCB0b2dldGhlci4gTWV0aG9kcyB0aGF0IHJldHJpZXZlIGEgc2luZ2xlIHZhbHVlCiAgICogb3IgbWF5IHJldHVybiBhIHByaW1pdGl2ZSB2YWx1ZSB3aWxsIGF1dG9tYXRpY2FsbHkgZW5kIHRoZSBjaGFpbiBzZXF1ZW5jZQogICAqIGFuZCByZXR1cm4gdGhlIHVud3JhcHBlZCB2YWx1ZS4gT3RoZXJ3aXNlLCB0aGUgdmFsdWUgbXVzdCBiZSB1bndyYXBwZWQKICAgKiB3aXRoIGBfI3ZhbHVlYC4KICAgKgogICAqIEV4cGxpY2l0IGNoYWluIHNlcXVlbmNlcywgd2hpY2ggbXVzdCBiZSB1bndyYXBwZWQgd2l0aCBgXyN2YWx1ZWAsIG1heSBiZQogICAqIGVuYWJsZWQgdXNpbmcgYF8uY2hhaW5gLgogICAqCiAgICogVGhlIGV4ZWN1dGlvbiBvZiBjaGFpbmVkIG1ldGhvZHMgaXMgbGF6eSwgdGhhdCBpcywgaXQncyBkZWZlcnJlZCB1bnRpbAogICAqIGBfI3ZhbHVlYCBpcyBpbXBsaWNpdGx5IG9yIGV4cGxpY2l0bHkgY2FsbGVkLgogICAqCiAgICogTGF6eSBldmFsdWF0aW9uIGFsbG93cyBzZXZlcmFsIG1ldGhvZHMgdG8gc3VwcG9ydCBzaG9ydGN1dCBmdXNpb24uCiAgICogU2hvcnRjdXQgZnVzaW9uIGlzIGFuIG9wdGltaXphdGlvbiB0byBtZXJnZSBpdGVyYXRlZSBjYWxsczsgdGhpcyBhdm9pZHMKICAgKiB0aGUgY3JlYXRpb24gb2YgaW50ZXJtZWRpYXRlIGFycmF5cyBhbmQgY2FuIGdyZWF0bHkgcmVkdWNlIHRoZSBudW1iZXIgb2YKICAgKiBpdGVyYXRlZSBleGVjdXRpb25zLiBTZWN0aW9ucyBvZiBhIGNoYWluIHNlcXVlbmNlIHF1YWxpZnkgZm9yIHNob3J0Y3V0CiAgICogZnVzaW9uIGlmIHRoZSBzZWN0aW9uIGlzIGFwcGxpZWQgdG8gYW4gYXJyYXkgYW5kIGl0ZXJhdGVlcyBhY2NlcHQgb25seQogICAqIG9uZSBhcmd1bWVudC4gVGhlIGhldXJpc3RpYyBmb3Igd2hldGhlciBhIHNlY3Rpb24gcXVhbGlmaWVzIGZvciBzaG9ydGN1dAogICAqIGZ1c2lvbiBpcyBzdWJqZWN0IHRvIGNoYW5nZS4KICAgKgogICAqIENoYWluaW5nIGlzIHN1cHBvcnRlZCBpbiBjdXN0b20gYnVpbGRzIGFzIGxvbmcgYXMgdGhlIGBfI3ZhbHVlYCBtZXRob2QgaXMKICAgKiBkaXJlY3RseSBvciBpbmRpcmVjdGx5IGluY2x1ZGVkIGluIHRoZSBidWlsZC4KICAgKgogICAqIEluIGFkZGl0aW9uIHRvIGxvZGFzaCBtZXRob2RzLCB3cmFwcGVycyBoYXZlIGBBcnJheWAgYW5kIGBTdHJpbmdgIG1ldGhvZHMuCiAgICoKICAgKiBUaGUgd3JhcHBlciBgQXJyYXlgIG1ldGhvZHMgYXJlOgogICAqIGBjb25jYXRgLCBgam9pbmAsIGBwb3BgLCBgcHVzaGAsIGBzaGlmdGAsIGBzb3J0YCwgYHNwbGljZWAsIGFuZCBgdW5zaGlmdGAKICAgKgogICAqIFRoZSB3cmFwcGVyIGBTdHJpbmdgIG1ldGhvZHMgYXJlOgogICAqIGByZXBsYWNlYCBhbmQgYHNwbGl0YAogICAqCiAgICogVGhlIHdyYXBwZXIgbWV0aG9kcyB0aGF0IHN1cHBvcnQgc2hvcnRjdXQgZnVzaW9uIGFyZToKICAgKiBgYXRgLCBgY29tcGFjdGAsIGBkcm9wYCwgYGRyb3BSaWdodGAsIGBkcm9wV2hpbGVgLCBgZmlsdGVyYCwgYGZpbmRgLAogICAqIGBmaW5kTGFzdGAsIGBoZWFkYCwgYGluaXRpYWxgLCBgbGFzdGAsIGBtYXBgLCBgcmVqZWN0YCwgYHJldmVyc2VgLCBgc2xpY2VgLAogICAqIGB0YWlsYCwgYHRha2VgLCBgdGFrZVJpZ2h0YCwgYHRha2VSaWdodFdoaWxlYCwgYHRha2VXaGlsZWAsIGFuZCBgdG9BcnJheWAKICAgKgogICAqIFRoZSBjaGFpbmFibGUgd3JhcHBlciBtZXRob2RzIGFyZToKICAgKiBgYWZ0ZXJgLCBgYXJ5YCwgYGFzc2lnbmAsIGBhc3NpZ25JbmAsIGBhc3NpZ25JbldpdGhgLCBgYXNzaWduV2l0aGAsIGBhdGAsCiAgICogYGJlZm9yZWAsIGBiaW5kYCwgYGJpbmRBbGxgLCBgYmluZEtleWAsIGBjYXN0QXJyYXlgLCBgY2hhaW5gLCBgY2h1bmtgLAogICAqIGBjb21taXRgLCBgY29tcGFjdGAsIGBjb25jYXRgLCBgY29uZm9ybXNgLCBgY29uc3RhbnRgLCBgY291bnRCeWAsIGBjcmVhdGVgLAogICAqIGBjdXJyeWAsIGBkZWJvdW5jZWAsIGBkZWZhdWx0c2AsIGBkZWZhdWx0c0RlZXBgLCBgZGVmZXJgLCBgZGVsYXlgLAogICAqIGBkaWZmZXJlbmNlYCwgYGRpZmZlcmVuY2VCeWAsIGBkaWZmZXJlbmNlV2l0aGAsIGBkcm9wYCwgYGRyb3BSaWdodGAsCiAgICogYGRyb3BSaWdodFdoaWxlYCwgYGRyb3BXaGlsZWAsIGBleHRlbmRgLCBgZXh0ZW5kV2l0aGAsIGBmaWxsYCwgYGZpbHRlcmAsCiAgICogYGZsYXRNYXBgLCBgZmxhdE1hcERlZXBgLCBgZmxhdE1hcERlcHRoYCwgYGZsYXR0ZW5gLCBgZmxhdHRlbkRlZXBgLAogICAqIGBmbGF0dGVuRGVwdGhgLCBgZmxpcGAsIGBmbG93YCwgYGZsb3dSaWdodGAsIGBmcm9tUGFpcnNgLCBgZnVuY3Rpb25zYCwKICAgKiBgZnVuY3Rpb25zSW5gLCBgZ3JvdXBCeWAsIGBpbml0aWFsYCwgYGludGVyc2VjdGlvbmAsIGBpbnRlcnNlY3Rpb25CeWAsCiAgICogYGludGVyc2VjdGlvbldpdGhgLCBgaW52ZXJ0YCwgYGludmVydEJ5YCwgYGludm9rZU1hcGAsIGBpdGVyYXRlZWAsIGBrZXlCeWAsCiAgICogYGtleXNgLCBga2V5c0luYCwgYG1hcGAsIGBtYXBLZXlzYCwgYG1hcFZhbHVlc2AsIGBtYXRjaGVzYCwgYG1hdGNoZXNQcm9wZXJ0eWAsCiAgICogYG1lbW9pemVgLCBgbWVyZ2VgLCBgbWVyZ2VXaXRoYCwgYG1ldGhvZGAsIGBtZXRob2RPZmAsIGBtaXhpbmAsIGBuZWdhdGVgLAogICAqIGBudGhBcmdgLCBgb21pdGAsIGBvbWl0QnlgLCBgb25jZWAsIGBvcmRlckJ5YCwgYG92ZXJgLCBgb3ZlckFyZ3NgLAogICAqIGBvdmVyRXZlcnlgLCBgb3ZlclNvbWVgLCBgcGFydGlhbGAsIGBwYXJ0aWFsUmlnaHRgLCBgcGFydGl0aW9uYCwgYHBpY2tgLAogICAqIGBwaWNrQnlgLCBgcGxhbnRgLCBgcHJvcGVydHlgLCBgcHJvcGVydHlPZmAsIGBwdWxsYCwgYHB1bGxBbGxgLCBgcHVsbEFsbEJ5YCwKICAgKiBgcHVsbEFsbFdpdGhgLCBgcHVsbEF0YCwgYHB1c2hgLCBgcmFuZ2VgLCBgcmFuZ2VSaWdodGAsIGByZWFyZ2AsIGByZWplY3RgLAogICAqIGByZW1vdmVgLCBgcmVzdGAsIGByZXZlcnNlYCwgYHNhbXBsZVNpemVgLCBgc2V0YCwgYHNldFdpdGhgLCBgc2h1ZmZsZWAsCiAgICogYHNsaWNlYCwgYHNvcnRgLCBgc29ydEJ5YCwgYHNwbGljZWAsIGBzcHJlYWRgLCBgdGFpbGAsIGB0YWtlYCwgYHRha2VSaWdodGAsCiAgICogYHRha2VSaWdodFdoaWxlYCwgYHRha2VXaGlsZWAsIGB0YXBgLCBgdGhyb3R0bGVgLCBgdGhydWAsIGB0b0FycmF5YCwKICAgKiBgdG9QYWlyc2AsIGB0b1BhaXJzSW5gLCBgdG9QYXRoYCwgYHRvUGxhaW5PYmplY3RgLCBgdHJhbnNmb3JtYCwgYHVuYXJ5YCwKICAgKiBgdW5pb25gLCBgdW5pb25CeWAsIGB1bmlvbldpdGhgLCBgdW5pcWAsIGB1bmlxQnlgLCBgdW5pcVdpdGhgLCBgdW5zZXRgLAogICAqIGB1bnNoaWZ0YCwgYHVuemlwYCwgYHVuemlwV2l0aGAsIGB1cGRhdGVgLCBgdXBkYXRlV2l0aGAsIGB2YWx1ZXNgLAogICAqIGB2YWx1ZXNJbmAsIGB3aXRob3V0YCwgYHdyYXBgLCBgeG9yYCwgYHhvckJ5YCwgYHhvcldpdGhgLCBgemlwYCwKICAgKiBgemlwT2JqZWN0YCwgYHppcE9iamVjdERlZXBgLCBhbmQgYHppcFdpdGhgCiAgICoKICAgKiBUaGUgd3JhcHBlciBtZXRob2RzIHRoYXQgYXJlICoqbm90KiogY2hhaW5hYmxlIGJ5IGRlZmF1bHQgYXJlOgogICAqIGBhZGRgLCBgYXR0ZW1wdGAsIGBjYW1lbENhc2VgLCBgY2FwaXRhbGl6ZWAsIGBjZWlsYCwgYGNsYW1wYCwgYGNsb25lYCwKICAgKiBgY2xvbmVEZWVwYCwgYGNsb25lRGVlcFdpdGhgLCBgY2xvbmVXaXRoYCwgYGNvbmZvcm1zVG9gLCBgZGVidXJyYCwKICAgKiBgZGVmYXVsdFRvYCwgYGRpdmlkZWAsIGBlYWNoYCwgYGVhY2hSaWdodGAsIGBlbmRzV2l0aGAsIGBlcWAsIGBlc2NhcGVgLAogICAqIGBlc2NhcGVSZWdFeHBgLCBgZXZlcnlgLCBgZmluZGAsIGBmaW5kSW5kZXhgLCBgZmluZEtleWAsIGBmaW5kTGFzdGAsCiAgICogYGZpbmRMYXN0SW5kZXhgLCBgZmluZExhc3RLZXlgLCBgZmlyc3RgLCBgZmxvb3JgLCBgZm9yRWFjaGAsIGBmb3JFYWNoUmlnaHRgLAogICAqIGBmb3JJbmAsIGBmb3JJblJpZ2h0YCwgYGZvck93bmAsIGBmb3JPd25SaWdodGAsIGBnZXRgLCBgZ3RgLCBgZ3RlYCwgYGhhc2AsCiAgICogYGhhc0luYCwgYGhlYWRgLCBgaWRlbnRpdHlgLCBgaW5jbHVkZXNgLCBgaW5kZXhPZmAsIGBpblJhbmdlYCwgYGludm9rZWAsCiAgICogYGlzQXJndW1lbnRzYCwgYGlzQXJyYXlgLCBgaXNBcnJheUJ1ZmZlcmAsIGBpc0FycmF5TGlrZWAsIGBpc0FycmF5TGlrZU9iamVjdGAsCiAgICogYGlzQm9vbGVhbmAsIGBpc0J1ZmZlcmAsIGBpc0RhdGVgLCBgaXNFbGVtZW50YCwgYGlzRW1wdHlgLCBgaXNFcXVhbGAsCiAgICogYGlzRXF1YWxXaXRoYCwgYGlzRXJyb3JgLCBgaXNGaW5pdGVgLCBgaXNGdW5jdGlvbmAsIGBpc0ludGVnZXJgLCBgaXNMZW5ndGhgLAogICAqIGBpc01hcGAsIGBpc01hdGNoYCwgYGlzTWF0Y2hXaXRoYCwgYGlzTmFOYCwgYGlzTmF0aXZlYCwgYGlzTmlsYCwgYGlzTnVsbGAsCiAgICogYGlzTnVtYmVyYCwgYGlzT2JqZWN0YCwgYGlzT2JqZWN0TGlrZWAsIGBpc1BsYWluT2JqZWN0YCwgYGlzUmVnRXhwYCwKICAgKiBgaXNTYWZlSW50ZWdlcmAsIGBpc1NldGAsIGBpc1N0cmluZ2AsIGBpc1VuZGVmaW5lZGAsIGBpc1R5cGVkQXJyYXlgLAogICAqIGBpc1dlYWtNYXBgLCBgaXNXZWFrU2V0YCwgYGpvaW5gLCBga2ViYWJDYXNlYCwgYGxhc3RgLCBgbGFzdEluZGV4T2ZgLAogICAqIGBsb3dlckNhc2VgLCBgbG93ZXJGaXJzdGAsIGBsdGAsIGBsdGVgLCBgbWF4YCwgYG1heEJ5YCwgYG1lYW5gLCBgbWVhbkJ5YCwKICAgKiBgbWluYCwgYG1pbkJ5YCwgYG11bHRpcGx5YCwgYG5vQ29uZmxpY3RgLCBgbm9vcGAsIGBub3dgLCBgbnRoYCwgYHBhZGAsCiAgICogYHBhZEVuZGAsIGBwYWRTdGFydGAsIGBwYXJzZUludGAsIGBwb3BgLCBgcmFuZG9tYCwgYHJlZHVjZWAsIGByZWR1Y2VSaWdodGAsCiAgICogYHJlcGVhdGAsIGByZXN1bHRgLCBgcm91bmRgLCBgcnVuSW5Db250ZXh0YCwgYHNhbXBsZWAsIGBzaGlmdGAsIGBzaXplYCwKICAgKiBgc25ha2VDYXNlYCwgYHNvbWVgLCBgc29ydGVkSW5kZXhgLCBgc29ydGVkSW5kZXhCeWAsIGBzb3J0ZWRMYXN0SW5kZXhgLAogICAqIGBzb3J0ZWRMYXN0SW5kZXhCeWAsIGBzdGFydENhc2VgLCBgc3RhcnRzV2l0aGAsIGBzdHViQXJyYXlgLCBgc3R1YkZhbHNlYCwKICAgKiBgc3R1Yk9iamVjdGAsIGBzdHViU3RyaW5nYCwgYHN0dWJUcnVlYCwgYHN1YnRyYWN0YCwgYHN1bWAsIGBzdW1CeWAsCiAgICogYHRlbXBsYXRlYCwgYHRpbWVzYCwgYHRvRmluaXRlYCwgYHRvSW50ZWdlcmAsIGB0b0pTT05gLCBgdG9MZW5ndGhgLAogICAqIGB0b0xvd2VyYCwgYHRvTnVtYmVyYCwgYHRvU2FmZUludGVnZXJgLCBgdG9TdHJpbmdgLCBgdG9VcHBlcmAsIGB0cmltYCwKICAgKiBgdHJpbUVuZGAsIGB0cmltU3RhcnRgLCBgdHJ1bmNhdGVgLCBgdW5lc2NhcGVgLCBgdW5pcXVlSWRgLCBgdXBwZXJDYXNlYCwKICAgKiBgdXBwZXJGaXJzdGAsIGB2YWx1ZWAsIGFuZCBgd29yZHNgCiAgICoKICAgKiBAbmFtZSBfCiAgICogQGNvbnN0cnVjdG9yCiAgICogQGNhdGVnb3J5IFNlcQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHdyYXAgaW4gYSBgbG9kYXNoYCBpbnN0YW5jZS4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBuZXcgYGxvZGFzaGAgd3JhcHBlciBpbnN0YW5jZS4KICAgKiBAZXhhbXBsZQogICAqCiAgICogZnVuY3Rpb24gc3F1YXJlKG4pIHsKICAgKiAgIHJldHVybiBuICogbjsKICAgKiB9CiAgICoKICAgKiB2YXIgd3JhcHBlZCA9IF8oWzEsIDIsIDNdKTsKICAgKgogICAqIC8vIFJldHVybnMgYW4gdW53cmFwcGVkIHZhbHVlLgogICAqIHdyYXBwZWQucmVkdWNlKF8uYWRkKTsKICAgKiAvLyA9PiA2CiAgICoKICAgKiAvLyBSZXR1cm5zIGEgd3JhcHBlZCB2YWx1ZS4KICAgKiB2YXIgc3F1YXJlcyA9IHdyYXBwZWQubWFwKHNxdWFyZSk7CiAgICoKICAgKiBfLmlzQXJyYXkoc3F1YXJlcyk7CiAgICogLy8gPT4gZmFsc2UKICAgKgogICAqIF8uaXNBcnJheShzcXVhcmVzLnZhbHVlKCkpOwogICAqIC8vID0+IHRydWUKICAgKi8KICBmdW5jdGlvbiBsb2Rhc2goKSB7CiAgICAvLyBObyBvcGVyYXRpb24gcGVyZm9ybWVkLgogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uY3JlYXRlYCB3aXRob3V0IHN1cHBvcnQgZm9yIGFzc2lnbmluZwogICAqIHByb3BlcnRpZXMgdG8gdGhlIGNyZWF0ZWQgb2JqZWN0LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gcHJvdG8gVGhlIG9iamVjdCB0byBpbmhlcml0IGZyb20uCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbmV3IG9iamVjdC4KICAgKi8KICB2YXIgYmFzZUNyZWF0ZSA9IChmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIG9iamVjdCgpIHt9CiAgICByZXR1cm4gZnVuY3Rpb24ocHJvdG8pIHsKICAgICAgaWYgKCFpc09iamVjdChwcm90bykpIHsKICAgICAgICByZXR1cm4ge307CiAgICAgIH0KICAgICAgaWYgKG9iamVjdENyZWF0ZSkgewogICAgICAgIHJldHVybiBvYmplY3RDcmVhdGUocHJvdG8pOwogICAgICB9CiAgICAgIG9iamVjdC5wcm90b3R5cGUgPSBwcm90bzsKICAgICAgdmFyIHJlc3VsdCA9IG5ldyBvYmplY3Q7CiAgICAgIG9iamVjdC5wcm90b3R5cGUgPSB1bmRlZmluZWQ7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9OwogIH0oKSk7CgogIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCiAgLyoqCiAgICogQ3JlYXRlcyBhIGhhc2ggb2JqZWN0LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAY29uc3RydWN0b3IKICAgKiBAcGFyYW0ge0FycmF5fSBbZW50cmllc10gVGhlIGtleS12YWx1ZSBwYWlycyB0byBjYWNoZS4KICAgKi8KICBmdW5jdGlvbiBIYXNoKGVudHJpZXMpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IGVudHJpZXMgPT0gbnVsbCA/IDAgOiBlbnRyaWVzLmxlbmd0aDsKCiAgICB0aGlzLmNsZWFyKCk7CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICB2YXIgZW50cnkgPSBlbnRyaWVzW2luZGV4XTsKICAgICAgdGhpcy5zZXQoZW50cnlbMF0sIGVudHJ5WzFdKTsKICAgIH0KICB9CgogIC8qKgogICAqIFJlbW92ZXMgYWxsIGtleS12YWx1ZSBlbnRyaWVzIGZyb20gdGhlIGhhc2guCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGNsZWFyCiAgICogQG1lbWJlck9mIEhhc2gKICAgKi8KICBmdW5jdGlvbiBoYXNoQ2xlYXIoKSB7CiAgICB0aGlzLl9fZGF0YV9fID0gbmF0aXZlQ3JlYXRlID8gbmF0aXZlQ3JlYXRlKG51bGwpIDoge307CiAgICB0aGlzLnNpemUgPSAwOwogIH0KCiAgLyoqCiAgICogUmVtb3ZlcyBga2V5YCBhbmQgaXRzIHZhbHVlIGZyb20gdGhlIGhhc2guCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGRlbGV0ZQogICAqIEBtZW1iZXJPZiBIYXNoCiAgICogQHBhcmFtIHtPYmplY3R9IGhhc2ggVGhlIGhhc2ggdG8gbW9kaWZ5LgogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gcmVtb3ZlLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZW50cnkgd2FzIHJlbW92ZWQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBoYXNoRGVsZXRlKGtleSkgewogICAgdmFyIHJlc3VsdCA9IHRoaXMuaGFzKGtleSkgJiYgZGVsZXRlIHRoaXMuX19kYXRhX19ba2V5XTsKICAgIHRoaXMuc2l6ZSAtPSByZXN1bHQgPyAxIDogMDsKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBHZXRzIHRoZSBoYXNoIHZhbHVlIGZvciBga2V5YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgZ2V0CiAgICogQG1lbWJlck9mIEhhc2gKICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIGdldC4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgZW50cnkgdmFsdWUuCiAgICovCiAgZnVuY3Rpb24gaGFzaEdldChrZXkpIHsKICAgIHZhciBkYXRhID0gdGhpcy5fX2RhdGFfXzsKICAgIGlmIChuYXRpdmVDcmVhdGUpIHsKICAgICAgdmFyIHJlc3VsdCA9IGRhdGFba2V5XTsKICAgICAgcmV0dXJuIHJlc3VsdCA9PT0gSEFTSF9VTkRFRklORUQgPyB1bmRlZmluZWQgOiByZXN1bHQ7CiAgICB9CiAgICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbChkYXRhLCBrZXkpID8gZGF0YVtrZXldIDogdW5kZWZpbmVkOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGEgaGFzaCB2YWx1ZSBmb3IgYGtleWAgZXhpc3RzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBoYXMKICAgKiBAbWVtYmVyT2YgSGFzaAogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgZW50cnkgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGFuIGVudHJ5IGZvciBga2V5YCBleGlzdHMsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBoYXNoSGFzKGtleSkgewogICAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fOwogICAgcmV0dXJuIG5hdGl2ZUNyZWF0ZSA/IChkYXRhW2tleV0gIT09IHVuZGVmaW5lZCkgOiBoYXNPd25Qcm9wZXJ0eS5jYWxsKGRhdGEsIGtleSk7CiAgfQoKICAvKioKICAgKiBTZXRzIHRoZSBoYXNoIGBrZXlgIHRvIGB2YWx1ZWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIHNldAogICAqIEBtZW1iZXJPZiBIYXNoCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBzZXQuCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2V0LgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGhhc2ggaW5zdGFuY2UuCiAgICovCiAgZnVuY3Rpb24gaGFzaFNldChrZXksIHZhbHVlKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX187CiAgICB0aGlzLnNpemUgKz0gdGhpcy5oYXMoa2V5KSA/IDAgOiAxOwogICAgZGF0YVtrZXldID0gKG5hdGl2ZUNyZWF0ZSAmJiB2YWx1ZSA9PT0gdW5kZWZpbmVkKSA/IEhBU0hfVU5ERUZJTkVEIDogdmFsdWU7CiAgICByZXR1cm4gdGhpczsKICB9CgogIC8vIEFkZCBtZXRob2RzIHRvIGBIYXNoYC4KICBIYXNoLnByb3RvdHlwZS5jbGVhciA9IGhhc2hDbGVhcjsKICBIYXNoLnByb3RvdHlwZVsnZGVsZXRlJ10gPSBoYXNoRGVsZXRlOwogIEhhc2gucHJvdG90eXBlLmdldCA9IGhhc2hHZXQ7CiAgSGFzaC5wcm90b3R5cGUuaGFzID0gaGFzaEhhczsKICBIYXNoLnByb3RvdHlwZS5zZXQgPSBoYXNoU2V0OwoKICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgogIC8qKgogICAqIENyZWF0ZXMgYW4gbGlzdCBjYWNoZSBvYmplY3QuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBjb25zdHJ1Y3RvcgogICAqIEBwYXJhbSB7QXJyYXl9IFtlbnRyaWVzXSBUaGUga2V5LXZhbHVlIHBhaXJzIHRvIGNhY2hlLgogICAqLwogIGZ1bmN0aW9uIExpc3RDYWNoZShlbnRyaWVzKSB7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICBsZW5ndGggPSBlbnRyaWVzID09IG51bGwgPyAwIDogZW50cmllcy5sZW5ndGg7CgogICAgdGhpcy5jbGVhcigpOwogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgdmFyIGVudHJ5ID0gZW50cmllc1tpbmRleF07CiAgICAgIHRoaXMuc2V0KGVudHJ5WzBdLCBlbnRyeVsxXSk7CiAgICB9CiAgfQoKICAvKioKICAgKiBSZW1vdmVzIGFsbCBrZXktdmFsdWUgZW50cmllcyBmcm9tIHRoZSBsaXN0IGNhY2hlLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBjbGVhcgogICAqIEBtZW1iZXJPZiBMaXN0Q2FjaGUKICAgKi8KICBmdW5jdGlvbiBsaXN0Q2FjaGVDbGVhcigpIHsKICAgIHRoaXMuX19kYXRhX18gPSBbXTsKICAgIHRoaXMuc2l6ZSA9IDA7CiAgfQoKICAvKioKICAgKiBSZW1vdmVzIGBrZXlgIGFuZCBpdHMgdmFsdWUgZnJvbSB0aGUgbGlzdCBjYWNoZS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgZGVsZXRlCiAgICogQG1lbWJlck9mIExpc3RDYWNoZQogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gcmVtb3ZlLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZW50cnkgd2FzIHJlbW92ZWQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBsaXN0Q2FjaGVEZWxldGUoa2V5KSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX18sCiAgICAgICAgaW5kZXggPSBhc3NvY0luZGV4T2YoZGF0YSwga2V5KTsKCiAgICBpZiAoaW5kZXggPCAwKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHZhciBsYXN0SW5kZXggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICBpZiAoaW5kZXggPT0gbGFzdEluZGV4KSB7CiAgICAgIGRhdGEucG9wKCk7CiAgICB9IGVsc2UgewogICAgICBzcGxpY2UuY2FsbChkYXRhLCBpbmRleCwgMSk7CiAgICB9CiAgICAtLXRoaXMuc2l6ZTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogR2V0cyB0aGUgbGlzdCBjYWNoZSB2YWx1ZSBmb3IgYGtleWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGdldAogICAqIEBtZW1iZXJPZiBMaXN0Q2FjaGUKICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIGdldC4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgZW50cnkgdmFsdWUuCiAgICovCiAgZnVuY3Rpb24gbGlzdENhY2hlR2V0KGtleSkgewogICAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fLAogICAgICAgIGluZGV4ID0gYXNzb2NJbmRleE9mKGRhdGEsIGtleSk7CgogICAgcmV0dXJuIGluZGV4IDwgMCA/IHVuZGVmaW5lZCA6IGRhdGFbaW5kZXhdWzFdOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGEgbGlzdCBjYWNoZSB2YWx1ZSBmb3IgYGtleWAgZXhpc3RzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBoYXMKICAgKiBAbWVtYmVyT2YgTGlzdENhY2hlCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSBlbnRyeSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYW4gZW50cnkgZm9yIGBrZXlgIGV4aXN0cywgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGxpc3RDYWNoZUhhcyhrZXkpIHsKICAgIHJldHVybiBhc3NvY0luZGV4T2YodGhpcy5fX2RhdGFfXywga2V5KSA+IC0xOwogIH0KCiAgLyoqCiAgICogU2V0cyB0aGUgbGlzdCBjYWNoZSBga2V5YCB0byBgdmFsdWVgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBzZXQKICAgKiBAbWVtYmVyT2YgTGlzdENhY2hlCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBzZXQuCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2V0LgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGxpc3QgY2FjaGUgaW5zdGFuY2UuCiAgICovCiAgZnVuY3Rpb24gbGlzdENhY2hlU2V0KGtleSwgdmFsdWUpIHsKICAgIHZhciBkYXRhID0gdGhpcy5fX2RhdGFfXywKICAgICAgICBpbmRleCA9IGFzc29jSW5kZXhPZihkYXRhLCBrZXkpOwoKICAgIGlmIChpbmRleCA8IDApIHsKICAgICAgKyt0aGlzLnNpemU7CiAgICAgIGRhdGEucHVzaChba2V5LCB2YWx1ZV0pOwogICAgfSBlbHNlIHsKICAgICAgZGF0YVtpbmRleF1bMV0gPSB2YWx1ZTsKICAgIH0KICAgIHJldHVybiB0aGlzOwogIH0KCiAgLy8gQWRkIG1ldGhvZHMgdG8gYExpc3RDYWNoZWAuCiAgTGlzdENhY2hlLnByb3RvdHlwZS5jbGVhciA9IGxpc3RDYWNoZUNsZWFyOwogIExpc3RDYWNoZS5wcm90b3R5cGVbJ2RlbGV0ZSddID0gbGlzdENhY2hlRGVsZXRlOwogIExpc3RDYWNoZS5wcm90b3R5cGUuZ2V0ID0gbGlzdENhY2hlR2V0OwogIExpc3RDYWNoZS5wcm90b3R5cGUuaGFzID0gbGlzdENhY2hlSGFzOwogIExpc3RDYWNoZS5wcm90b3R5cGUuc2V0ID0gbGlzdENhY2hlU2V0OwoKICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgogIC8qKgogICAqIENyZWF0ZXMgYSBtYXAgY2FjaGUgb2JqZWN0IHRvIHN0b3JlIGtleS12YWx1ZSBwYWlycy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQGNvbnN0cnVjdG9yCiAgICogQHBhcmFtIHtBcnJheX0gW2VudHJpZXNdIFRoZSBrZXktdmFsdWUgcGFpcnMgdG8gY2FjaGUuCiAgICovCiAgZnVuY3Rpb24gTWFwQ2FjaGUoZW50cmllcykgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gZW50cmllcyA9PSBudWxsID8gMCA6IGVudHJpZXMubGVuZ3RoOwoKICAgIHRoaXMuY2xlYXIoKTsKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHZhciBlbnRyeSA9IGVudHJpZXNbaW5kZXhdOwogICAgICB0aGlzLnNldChlbnRyeVswXSwgZW50cnlbMV0pOwogICAgfQogIH0KCiAgLyoqCiAgICogUmVtb3ZlcyBhbGwga2V5LXZhbHVlIGVudHJpZXMgZnJvbSB0aGUgbWFwLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBjbGVhcgogICAqIEBtZW1iZXJPZiBNYXBDYWNoZQogICAqLwogIGZ1bmN0aW9uIG1hcENhY2hlQ2xlYXIoKSB7CiAgICB0aGlzLnNpemUgPSAwOwogICAgdGhpcy5fX2RhdGFfXyA9IHsKICAgICAgJ2hhc2gnOiBuZXcgSGFzaCwKICAgICAgJ21hcCc6IG5ldyAoTWFwIHx8IExpc3RDYWNoZSksCiAgICAgICdzdHJpbmcnOiBuZXcgSGFzaAogICAgfTsKICB9CgogIC8qKgogICAqIFJlbW92ZXMgYGtleWAgYW5kIGl0cyB2YWx1ZSBmcm9tIHRoZSBtYXAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGRlbGV0ZQogICAqIEBtZW1iZXJPZiBNYXBDYWNoZQogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gcmVtb3ZlLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZW50cnkgd2FzIHJlbW92ZWQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBtYXBDYWNoZURlbGV0ZShrZXkpIHsKICAgIHZhciByZXN1bHQgPSBnZXRNYXBEYXRhKHRoaXMsIGtleSlbJ2RlbGV0ZSddKGtleSk7CiAgICB0aGlzLnNpemUgLT0gcmVzdWx0ID8gMSA6IDA7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogR2V0cyB0aGUgbWFwIHZhbHVlIGZvciBga2V5YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgZ2V0CiAgICogQG1lbWJlck9mIE1hcENhY2hlCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBnZXQuCiAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGVudHJ5IHZhbHVlLgogICAqLwogIGZ1bmN0aW9uIG1hcENhY2hlR2V0KGtleSkgewogICAgcmV0dXJuIGdldE1hcERhdGEodGhpcywga2V5KS5nZXQoa2V5KTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBhIG1hcCB2YWx1ZSBmb3IgYGtleWAgZXhpc3RzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBoYXMKICAgKiBAbWVtYmVyT2YgTWFwQ2FjaGUKICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIGVudHJ5IHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBhbiBlbnRyeSBmb3IgYGtleWAgZXhpc3RzLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gbWFwQ2FjaGVIYXMoa2V5KSB7CiAgICByZXR1cm4gZ2V0TWFwRGF0YSh0aGlzLCBrZXkpLmhhcyhrZXkpOwogIH0KCiAgLyoqCiAgICogU2V0cyB0aGUgbWFwIGBrZXlgIHRvIGB2YWx1ZWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIHNldAogICAqIEBtZW1iZXJPZiBNYXBDYWNoZQogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gc2V0LgogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNldC4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBtYXAgY2FjaGUgaW5zdGFuY2UuCiAgICovCiAgZnVuY3Rpb24gbWFwQ2FjaGVTZXQoa2V5LCB2YWx1ZSkgewogICAgdmFyIGRhdGEgPSBnZXRNYXBEYXRhKHRoaXMsIGtleSksCiAgICAgICAgc2l6ZSA9IGRhdGEuc2l6ZTsKCiAgICBkYXRhLnNldChrZXksIHZhbHVlKTsKICAgIHRoaXMuc2l6ZSArPSBkYXRhLnNpemUgPT0gc2l6ZSA/IDAgOiAxOwogICAgcmV0dXJuIHRoaXM7CiAgfQoKICAvLyBBZGQgbWV0aG9kcyB0byBgTWFwQ2FjaGVgLgogIE1hcENhY2hlLnByb3RvdHlwZS5jbGVhciA9IG1hcENhY2hlQ2xlYXI7CiAgTWFwQ2FjaGUucHJvdG90eXBlWydkZWxldGUnXSA9IG1hcENhY2hlRGVsZXRlOwogIE1hcENhY2hlLnByb3RvdHlwZS5nZXQgPSBtYXBDYWNoZUdldDsKICBNYXBDYWNoZS5wcm90b3R5cGUuaGFzID0gbWFwQ2FjaGVIYXM7CiAgTWFwQ2FjaGUucHJvdG90eXBlLnNldCA9IG1hcENhY2hlU2V0OwoKICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgogIC8qKgogICAqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBjYWNoZSBvYmplY3QgdG8gc3RvcmUgdW5pcXVlIHZhbHVlcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQGNvbnN0cnVjdG9yCiAgICogQHBhcmFtIHtBcnJheX0gW3ZhbHVlc10gVGhlIHZhbHVlcyB0byBjYWNoZS4KICAgKi8KICBmdW5jdGlvbiBTZXRDYWNoZSh2YWx1ZXMpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IHZhbHVlcyA9PSBudWxsID8gMCA6IHZhbHVlcy5sZW5ndGg7CgogICAgdGhpcy5fX2RhdGFfXyA9IG5ldyBNYXBDYWNoZTsKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHRoaXMuYWRkKHZhbHVlc1tpbmRleF0pOwogICAgfQogIH0KCiAgLyoqCiAgICogQWRkcyBgdmFsdWVgIHRvIHRoZSBhcnJheSBjYWNoZS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgYWRkCiAgICogQG1lbWJlck9mIFNldENhY2hlCiAgICogQGFsaWFzIHB1c2gKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjYWNoZS4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjYWNoZSBpbnN0YW5jZS4KICAgKi8KICBmdW5jdGlvbiBzZXRDYWNoZUFkZCh2YWx1ZSkgewogICAgdGhpcy5fX2RhdGFfXy5zZXQodmFsdWUsIEhBU0hfVU5ERUZJTkVEKTsKICAgIHJldHVybiB0aGlzOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgaW4gdGhlIGFycmF5IGNhY2hlLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBoYXMKICAgKiBAbWVtYmVyT2YgU2V0Q2FjaGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZWFyY2ggZm9yLgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgZm91bmQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBzZXRDYWNoZUhhcyh2YWx1ZSkgewogICAgcmV0dXJuIHRoaXMuX19kYXRhX18uaGFzKHZhbHVlKTsKICB9CgogIC8vIEFkZCBtZXRob2RzIHRvIGBTZXRDYWNoZWAuCiAgU2V0Q2FjaGUucHJvdG90eXBlLmFkZCA9IFNldENhY2hlLnByb3RvdHlwZS5wdXNoID0gc2V0Q2FjaGVBZGQ7CiAgU2V0Q2FjaGUucHJvdG90eXBlLmhhcyA9IHNldENhY2hlSGFzOwoKICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgogIC8qKgogICAqIENyZWF0ZXMgYSBzdGFjayBjYWNoZSBvYmplY3QgdG8gc3RvcmUga2V5LXZhbHVlIHBhaXJzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAY29uc3RydWN0b3IKICAgKiBAcGFyYW0ge0FycmF5fSBbZW50cmllc10gVGhlIGtleS12YWx1ZSBwYWlycyB0byBjYWNoZS4KICAgKi8KICBmdW5jdGlvbiBTdGFjayhlbnRyaWVzKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX18gPSBuZXcgTGlzdENhY2hlKGVudHJpZXMpOwogICAgdGhpcy5zaXplID0gZGF0YS5zaXplOwogIH0KCiAgLyoqCiAgICogUmVtb3ZlcyBhbGwga2V5LXZhbHVlIGVudHJpZXMgZnJvbSB0aGUgc3RhY2suCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGNsZWFyCiAgICogQG1lbWJlck9mIFN0YWNrCiAgICovCiAgZnVuY3Rpb24gc3RhY2tDbGVhcigpIHsKICAgIHRoaXMuX19kYXRhX18gPSBuZXcgTGlzdENhY2hlOwogICAgdGhpcy5zaXplID0gMDsKICB9CgogIC8qKgogICAqIFJlbW92ZXMgYGtleWAgYW5kIGl0cyB2YWx1ZSBmcm9tIHRoZSBzdGFjay4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgZGVsZXRlCiAgICogQG1lbWJlck9mIFN0YWNrCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byByZW1vdmUuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBlbnRyeSB3YXMgcmVtb3ZlZCwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIHN0YWNrRGVsZXRlKGtleSkgewogICAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fLAogICAgICAgIHJlc3VsdCA9IGRhdGFbJ2RlbGV0ZSddKGtleSk7CgogICAgdGhpcy5zaXplID0gZGF0YS5zaXplOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIHN0YWNrIHZhbHVlIGZvciBga2V5YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgZ2V0CiAgICogQG1lbWJlck9mIFN0YWNrCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBnZXQuCiAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGVudHJ5IHZhbHVlLgogICAqLwogIGZ1bmN0aW9uIHN0YWNrR2V0KGtleSkgewogICAgcmV0dXJuIHRoaXMuX19kYXRhX18uZ2V0KGtleSk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYSBzdGFjayB2YWx1ZSBmb3IgYGtleWAgZXhpc3RzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBoYXMKICAgKiBAbWVtYmVyT2YgU3RhY2sKICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIGVudHJ5IHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBhbiBlbnRyeSBmb3IgYGtleWAgZXhpc3RzLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gc3RhY2tIYXMoa2V5KSB7CiAgICByZXR1cm4gdGhpcy5fX2RhdGFfXy5oYXMoa2V5KTsKICB9CgogIC8qKgogICAqIFNldHMgdGhlIHN0YWNrIGBrZXlgIHRvIGB2YWx1ZWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIHNldAogICAqIEBtZW1iZXJPZiBTdGFjawogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gc2V0LgogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNldC4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBzdGFjayBjYWNoZSBpbnN0YW5jZS4KICAgKi8KICBmdW5jdGlvbiBzdGFja1NldChrZXksIHZhbHVlKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX187CiAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIExpc3RDYWNoZSkgewogICAgICB2YXIgcGFpcnMgPSBkYXRhLl9fZGF0YV9fOwogICAgICBpZiAoIU1hcCB8fCAocGFpcnMubGVuZ3RoIDwgTEFSR0VfQVJSQVlfU0laRSAtIDEpKSB7CiAgICAgICAgcGFpcnMucHVzaChba2V5LCB2YWx1ZV0pOwogICAgICAgIHRoaXMuc2l6ZSA9ICsrZGF0YS5zaXplOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIGRhdGEgPSB0aGlzLl9fZGF0YV9fID0gbmV3IE1hcENhY2hlKHBhaXJzKTsKICAgIH0KICAgIGRhdGEuc2V0KGtleSwgdmFsdWUpOwogICAgdGhpcy5zaXplID0gZGF0YS5zaXplOwogICAgcmV0dXJuIHRoaXM7CiAgfQoKICAvLyBBZGQgbWV0aG9kcyB0byBgU3RhY2tgLgogIFN0YWNrLnByb3RvdHlwZS5jbGVhciA9IHN0YWNrQ2xlYXI7CiAgU3RhY2sucHJvdG90eXBlWydkZWxldGUnXSA9IHN0YWNrRGVsZXRlOwogIFN0YWNrLnByb3RvdHlwZS5nZXQgPSBzdGFja0dldDsKICBTdGFjay5wcm90b3R5cGUuaGFzID0gc3RhY2tIYXM7CiAgU3RhY2sucHJvdG90eXBlLnNldCA9IHN0YWNrU2V0OwoKICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgogIC8qKgogICAqIENyZWF0ZXMgYW4gYXJyYXkgb2YgdGhlIGVudW1lcmFibGUgcHJvcGVydHkgbmFtZXMgb2YgdGhlIGFycmF5LWxpa2UgYHZhbHVlYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcXVlcnkuCiAgICogQHBhcmFtIHtib29sZWFufSBpbmhlcml0ZWQgU3BlY2lmeSByZXR1cm5pbmcgaW5oZXJpdGVkIHByb3BlcnR5IG5hbWVzLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcHJvcGVydHkgbmFtZXMuCiAgICovCiAgZnVuY3Rpb24gYXJyYXlMaWtlS2V5cyh2YWx1ZSwgaW5oZXJpdGVkKSB7CiAgICB2YXIgaXNBcnIgPSBpc0FycmF5KHZhbHVlKSwKICAgICAgICBpc0FyZyA9ICFpc0FyciAmJiBpc0FyZ3VtZW50cyh2YWx1ZSksCiAgICAgICAgaXNCdWZmID0gIWlzQXJyICYmICFpc0FyZyAmJiBpc0J1ZmZlcih2YWx1ZSksCiAgICAgICAgaXNUeXBlID0gIWlzQXJyICYmICFpc0FyZyAmJiAhaXNCdWZmICYmIGlzVHlwZWRBcnJheSh2YWx1ZSksCiAgICAgICAgc2tpcEluZGV4ZXMgPSBpc0FyciB8fCBpc0FyZyB8fCBpc0J1ZmYgfHwgaXNUeXBlLAogICAgICAgIHJlc3VsdCA9IHNraXBJbmRleGVzID8gYmFzZVRpbWVzKHZhbHVlLmxlbmd0aCwgU3RyaW5nKSA6IFtdLAogICAgICAgIGxlbmd0aCA9IHJlc3VsdC5sZW5ndGg7CgogICAgZm9yICh2YXIga2V5IGluIHZhbHVlKSB7CiAgICAgIGlmICgoaW5oZXJpdGVkIHx8IGhhc093blByb3BlcnR5LmNhbGwodmFsdWUsIGtleSkpICYmCiAgICAgICAgICAhKHNraXBJbmRleGVzICYmICgKICAgICAgICAgICAgIC8vIFNhZmFyaSA5IGhhcyBlbnVtZXJhYmxlIGBhcmd1bWVudHMubGVuZ3RoYCBpbiBzdHJpY3QgbW9kZS4KICAgICAgICAgICAgIGtleSA9PSAnbGVuZ3RoJyB8fAogICAgICAgICAgICAgLy8gTm9kZS5qcyAwLjEwIGhhcyBlbnVtZXJhYmxlIG5vbi1pbmRleCBwcm9wZXJ0aWVzIG9uIGJ1ZmZlcnMuCiAgICAgICAgICAgICAoaXNCdWZmICYmIChrZXkgPT0gJ29mZnNldCcgfHwga2V5ID09ICdwYXJlbnQnKSkgfHwKICAgICAgICAgICAgIC8vIFBoYW50b21KUyAyIGhhcyBlbnVtZXJhYmxlIG5vbi1pbmRleCBwcm9wZXJ0aWVzIG9uIHR5cGVkIGFycmF5cy4KICAgICAgICAgICAgIChpc1R5cGUgJiYgKGtleSA9PSAnYnVmZmVyJyB8fCBrZXkgPT0gJ2J5dGVMZW5ndGgnIHx8IGtleSA9PSAnYnl0ZU9mZnNldCcpKSB8fAogICAgICAgICAgICAgLy8gU2tpcCBpbmRleCBwcm9wZXJ0aWVzLgogICAgICAgICAgICAgaXNJbmRleChrZXksIGxlbmd0aCkKICAgICAgICAgICkpKSB7CiAgICAgICAgcmVzdWx0LnB1c2goa2V5KTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIEFzc2lnbnMgYHZhbHVlYCB0byBga2V5YCBvZiBgb2JqZWN0YCBpZiB0aGUgZXhpc3RpbmcgdmFsdWUgaXMgbm90IGVxdWl2YWxlbnQKICAgKiB1c2luZyBbYFNhbWVWYWx1ZVplcm9gXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1zYW1ldmFsdWV6ZXJvKQogICAqIGZvciBlcXVhbGl0eSBjb21wYXJpc29ucy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIG1vZGlmeS4KICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHByb3BlcnR5IHRvIGFzc2lnbi4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBhc3NpZ24uCiAgICovCiAgZnVuY3Rpb24gYXNzaWduVmFsdWUob2JqZWN0LCBrZXksIHZhbHVlKSB7CiAgICB2YXIgb2JqVmFsdWUgPSBvYmplY3Rba2V5XTsKICAgIGlmICghKGhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBrZXkpICYmIGVxKG9ialZhbHVlLCB2YWx1ZSkpIHx8CiAgICAgICAgKHZhbHVlID09PSB1bmRlZmluZWQgJiYgIShrZXkgaW4gb2JqZWN0KSkpIHsKICAgICAgYmFzZUFzc2lnblZhbHVlKG9iamVjdCwga2V5LCB2YWx1ZSk7CiAgICB9CiAgfQoKICAvKioKICAgKiBHZXRzIHRoZSBpbmRleCBhdCB3aGljaCB0aGUgYGtleWAgaXMgZm91bmQgaW4gYGFycmF5YCBvZiBrZXktdmFsdWUgcGFpcnMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7Kn0ga2V5IFRoZSBrZXkgdG8gc2VhcmNoIGZvci4KICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgbWF0Y2hlZCB2YWx1ZSwgZWxzZSBgLTFgLgogICAqLwogIGZ1bmN0aW9uIGFzc29jSW5kZXhPZihhcnJheSwga2V5KSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgd2hpbGUgKGxlbmd0aC0tKSB7CiAgICAgIGlmIChlcShhcnJheVtsZW5ndGhdWzBdLCBrZXkpKSB7CiAgICAgICAgcmV0dXJuIGxlbmd0aDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIC0xOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uYXNzaWduYCB3aXRob3V0IHN1cHBvcnQgZm9yIG11bHRpcGxlIHNvdXJjZXMKICAgKiBvciBgY3VzdG9taXplcmAgZnVuY3Rpb25zLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBkZXN0aW5hdGlvbiBvYmplY3QuCiAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgc291cmNlIG9iamVjdC4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VBc3NpZ24ob2JqZWN0LCBzb3VyY2UpIHsKICAgIHJldHVybiBvYmplY3QgJiYgY29weU9iamVjdChzb3VyY2UsIGtleXMoc291cmNlKSwgb2JqZWN0KTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmFzc2lnbkluYCB3aXRob3V0IHN1cHBvcnQgZm9yIG11bHRpcGxlIHNvdXJjZXMKICAgKiBvciBgY3VzdG9taXplcmAgZnVuY3Rpb25zLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBkZXN0aW5hdGlvbiBvYmplY3QuCiAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgc291cmNlIG9iamVjdC4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VBc3NpZ25JbihvYmplY3QsIHNvdXJjZSkgewogICAgcmV0dXJuIG9iamVjdCAmJiBjb3B5T2JqZWN0KHNvdXJjZSwga2V5c0luKHNvdXJjZSksIG9iamVjdCk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgYXNzaWduVmFsdWVgIGFuZCBgYXNzaWduTWVyZ2VWYWx1ZWAgd2l0aG91dAogICAqIHZhbHVlIGNoZWNrcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIG1vZGlmeS4KICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHByb3BlcnR5IHRvIGFzc2lnbi4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBhc3NpZ24uCiAgICovCiAgZnVuY3Rpb24gYmFzZUFzc2lnblZhbHVlKG9iamVjdCwga2V5LCB2YWx1ZSkgewogICAgaWYgKGtleSA9PSAnX19wcm90b19fJyAmJiBkZWZpbmVQcm9wZXJ0eSkgewogICAgICBkZWZpbmVQcm9wZXJ0eShvYmplY3QsIGtleSwgewogICAgICAgICdjb25maWd1cmFibGUnOiB0cnVlLAogICAgICAgICdlbnVtZXJhYmxlJzogdHJ1ZSwKICAgICAgICAndmFsdWUnOiB2YWx1ZSwKICAgICAgICAnd3JpdGFibGUnOiB0cnVlCiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgb2JqZWN0W2tleV0gPSB2YWx1ZTsKICAgIH0KICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmF0YCB3aXRob3V0IHN1cHBvcnQgZm9yIGluZGl2aWR1YWwgcGF0aHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpdGVyYXRlIG92ZXIuCiAgICogQHBhcmFtIHtzdHJpbmdbXX0gcGF0aHMgVGhlIHByb3BlcnR5IHBhdGhzIHRvIHBpY2suCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBwaWNrZWQgZWxlbWVudHMuCiAgICovCiAgZnVuY3Rpb24gYmFzZUF0KG9iamVjdCwgcGF0aHMpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IHBhdGhzLmxlbmd0aCwKICAgICAgICByZXN1bHQgPSBBcnJheShsZW5ndGgpLAogICAgICAgIHNraXAgPSBvYmplY3QgPT0gbnVsbDsKCiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICByZXN1bHRbaW5kZXhdID0gc2tpcCA/IHVuZGVmaW5lZCA6IGdldChvYmplY3QsIHBhdGhzW2luZGV4XSk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uY2xhbXBgIHdoaWNoIGRvZXNuJ3QgY29lcmNlIGFyZ3VtZW50cy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtudW1iZXJ9IG51bWJlciBUaGUgbnVtYmVyIHRvIGNsYW1wLgogICAqIEBwYXJhbSB7bnVtYmVyfSBbbG93ZXJdIFRoZSBsb3dlciBib3VuZC4KICAgKiBAcGFyYW0ge251bWJlcn0gdXBwZXIgVGhlIHVwcGVyIGJvdW5kLgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGNsYW1wZWQgbnVtYmVyLgogICAqLwogIGZ1bmN0aW9uIGJhc2VDbGFtcChudW1iZXIsIGxvd2VyLCB1cHBlcikgewogICAgaWYgKG51bWJlciA9PT0gbnVtYmVyKSB7CiAgICAgIGlmICh1cHBlciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbnVtYmVyID0gbnVtYmVyIDw9IHVwcGVyID8gbnVtYmVyIDogdXBwZXI7CiAgICAgIH0KICAgICAgaWYgKGxvd2VyICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBudW1iZXIgPSBudW1iZXIgPj0gbG93ZXIgPyBudW1iZXIgOiBsb3dlcjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG51bWJlcjsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmNsb25lYCBhbmQgYF8uY2xvbmVEZWVwYCB3aGljaCB0cmFja3MKICAgKiB0cmF2ZXJzZWQgb2JqZWN0cy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2xvbmUuCiAgICogQHBhcmFtIHtib29sZWFufSBiaXRtYXNrIFRoZSBiaXRtYXNrIGZsYWdzLgogICAqICAxIC0gRGVlcCBjbG9uZQogICAqICAyIC0gRmxhdHRlbiBpbmhlcml0ZWQgcHJvcGVydGllcwogICAqICA0IC0gQ2xvbmUgc3ltYm9scwogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjdXN0b21pemVyXSBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNsb25pbmcuCiAgICogQHBhcmFtIHtzdHJpbmd9IFtrZXldIFRoZSBrZXkgb2YgYHZhbHVlYC4KICAgKiBAcGFyYW0ge09iamVjdH0gW29iamVjdF0gVGhlIHBhcmVudCBvYmplY3Qgb2YgYHZhbHVlYC4KICAgKiBAcGFyYW0ge09iamVjdH0gW3N0YWNrXSBUcmFja3MgdHJhdmVyc2VkIG9iamVjdHMgYW5kIHRoZWlyIGNsb25lIGNvdW50ZXJwYXJ0cy4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgY2xvbmVkIHZhbHVlLgogICAqLwogIGZ1bmN0aW9uIGJhc2VDbG9uZSh2YWx1ZSwgYml0bWFzaywgY3VzdG9taXplciwga2V5LCBvYmplY3QsIHN0YWNrKSB7CiAgICB2YXIgcmVzdWx0LAogICAgICAgIGlzRGVlcCA9IGJpdG1hc2sgJiBDTE9ORV9ERUVQX0ZMQUcsCiAgICAgICAgaXNGbGF0ID0gYml0bWFzayAmIENMT05FX0ZMQVRfRkxBRywKICAgICAgICBpc0Z1bGwgPSBiaXRtYXNrICYgQ0xPTkVfU1lNQk9MU19GTEFHOwoKICAgIGlmIChjdXN0b21pemVyKSB7CiAgICAgIHJlc3VsdCA9IG9iamVjdCA/IGN1c3RvbWl6ZXIodmFsdWUsIGtleSwgb2JqZWN0LCBzdGFjaykgOiBjdXN0b21pemVyKHZhbHVlKTsKICAgIH0KICAgIGlmIChyZXN1bHQgIT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgaWYgKCFpc09iamVjdCh2YWx1ZSkpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogICAgdmFyIGlzQXJyID0gaXNBcnJheSh2YWx1ZSk7CiAgICBpZiAoaXNBcnIpIHsKICAgICAgcmVzdWx0ID0gaW5pdENsb25lQXJyYXkodmFsdWUpOwogICAgICBpZiAoIWlzRGVlcCkgewogICAgICAgIHJldHVybiBjb3B5QXJyYXkodmFsdWUsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHZhciB0YWcgPSBnZXRUYWcodmFsdWUpLAogICAgICAgICAgaXNGdW5jID0gdGFnID09IGZ1bmNUYWcgfHwgdGFnID09IGdlblRhZzsKCiAgICAgIGlmIChpc0J1ZmZlcih2YWx1ZSkpIHsKICAgICAgICByZXR1cm4gY2xvbmVCdWZmZXIodmFsdWUsIGlzRGVlcCk7CiAgICAgIH0KICAgICAgaWYgKHRhZyA9PSBvYmplY3RUYWcgfHwgdGFnID09IGFyZ3NUYWcgfHwgKGlzRnVuYyAmJiAhb2JqZWN0KSkgewogICAgICAgIHJlc3VsdCA9IChpc0ZsYXQgfHwgaXNGdW5jKSA/IHt9IDogaW5pdENsb25lT2JqZWN0KHZhbHVlKTsKICAgICAgICBpZiAoIWlzRGVlcCkgewogICAgICAgICAgcmV0dXJuIGlzRmxhdAogICAgICAgICAgICA/IGNvcHlTeW1ib2xzSW4odmFsdWUsIGJhc2VBc3NpZ25JbihyZXN1bHQsIHZhbHVlKSkKICAgICAgICAgICAgOiBjb3B5U3ltYm9scyh2YWx1ZSwgYmFzZUFzc2lnbihyZXN1bHQsIHZhbHVlKSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmICghY2xvbmVhYmxlVGFnc1t0YWddKSB7CiAgICAgICAgICByZXR1cm4gb2JqZWN0ID8gdmFsdWUgOiB7fTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0ID0gaW5pdENsb25lQnlUYWcodmFsdWUsIHRhZywgYmFzZUNsb25lLCBpc0RlZXApOwogICAgICB9CiAgICB9CiAgICAvLyBDaGVjayBmb3IgY2lyY3VsYXIgcmVmZXJlbmNlcyBhbmQgcmV0dXJuIGl0cyBjb3JyZXNwb25kaW5nIGNsb25lLgogICAgc3RhY2sgfHwgKHN0YWNrID0gbmV3IFN0YWNrKTsKICAgIHZhciBzdGFja2VkID0gc3RhY2suZ2V0KHZhbHVlKTsKICAgIGlmIChzdGFja2VkKSB7CiAgICAgIHJldHVybiBzdGFja2VkOwogICAgfQogICAgc3RhY2suc2V0KHZhbHVlLCByZXN1bHQpOwoKICAgIHZhciBrZXlzRnVuYyA9IGlzRnVsbAogICAgICA/IChpc0ZsYXQgPyBnZXRBbGxLZXlzSW4gOiBnZXRBbGxLZXlzKQogICAgICA6IChpc0ZsYXQgPyBrZXlzSW4gOiBrZXlzKTsKCiAgICB2YXIgcHJvcHMgPSBpc0FyciA/IHVuZGVmaW5lZCA6IGtleXNGdW5jKHZhbHVlKTsKICAgIGFycmF5RWFjaChwcm9wcyB8fCB2YWx1ZSwgZnVuY3Rpb24oc3ViVmFsdWUsIGtleSkgewogICAgICBpZiAocHJvcHMpIHsKICAgICAgICBrZXkgPSBzdWJWYWx1ZTsKICAgICAgICBzdWJWYWx1ZSA9IHZhbHVlW2tleV07CiAgICAgIH0KICAgICAgLy8gUmVjdXJzaXZlbHkgcG9wdWxhdGUgY2xvbmUgKHN1c2NlcHRpYmxlIHRvIGNhbGwgc3RhY2sgbGltaXRzKS4KICAgICAgYXNzaWduVmFsdWUocmVzdWx0LCBrZXksIGJhc2VDbG9uZShzdWJWYWx1ZSwgYml0bWFzaywgY3VzdG9taXplciwga2V5LCB2YWx1ZSwgc3RhY2spKTsKICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmNvbmZvcm1zVG9gIHdoaWNoIGFjY2VwdHMgYHByb3BzYCB0byBjaGVjay4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgb2JqZWN0IG9mIHByb3BlcnR5IHByZWRpY2F0ZXMgdG8gY29uZm9ybSB0by4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYG9iamVjdGAgY29uZm9ybXMsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBiYXNlQ29uZm9ybXNUbyhvYmplY3QsIHNvdXJjZSwgcHJvcHMpIHsKICAgIHZhciBsZW5ndGggPSBwcm9wcy5sZW5ndGg7CiAgICBpZiAob2JqZWN0ID09IG51bGwpIHsKICAgICAgcmV0dXJuICFsZW5ndGg7CiAgICB9CiAgICBvYmplY3QgPSBPYmplY3Qob2JqZWN0KTsKICAgIHdoaWxlIChsZW5ndGgtLSkgewogICAgICB2YXIga2V5ID0gcHJvcHNbbGVuZ3RoXSwKICAgICAgICAgIHByZWRpY2F0ZSA9IHNvdXJjZVtrZXldLAogICAgICAgICAgdmFsdWUgPSBvYmplY3Rba2V5XTsKCiAgICAgIGlmICgodmFsdWUgPT09IHVuZGVmaW5lZCAmJiAhKGtleSBpbiBvYmplY3QpKSB8fCAhcHJlZGljYXRlKHZhbHVlKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBtZXRob2RzIGxpa2UgYF8uZGlmZmVyZW5jZWAgd2l0aG91dCBzdXBwb3J0CiAgICogZm9yIGV4Y2x1ZGluZyBtdWx0aXBsZSBhcnJheXMgb3IgaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHtBcnJheX0gdmFsdWVzIFRoZSB2YWx1ZXMgdG8gZXhjbHVkZS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWVdIFRoZSBpdGVyYXRlZSBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjb21wYXJhdG9yXSBUaGUgY29tcGFyYXRvciBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIGZpbHRlcmVkIHZhbHVlcy4KICAgKi8KICBmdW5jdGlvbiBiYXNlRGlmZmVyZW5jZShhcnJheSwgdmFsdWVzLCBpdGVyYXRlZSwgY29tcGFyYXRvcikgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgaW5jbHVkZXMgPSBhcnJheUluY2x1ZGVzLAogICAgICAgIGlzQ29tbW9uID0gdHJ1ZSwKICAgICAgICBsZW5ndGggPSBhcnJheS5sZW5ndGgsCiAgICAgICAgcmVzdWx0ID0gW10sCiAgICAgICAgdmFsdWVzTGVuZ3RoID0gdmFsdWVzLmxlbmd0aDsKCiAgICBpZiAoIWxlbmd0aCkgewogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgaWYgKGl0ZXJhdGVlKSB7CiAgICAgIHZhbHVlcyA9IGFycmF5TWFwKHZhbHVlcywgYmFzZVVuYXJ5KGl0ZXJhdGVlKSk7CiAgICB9CiAgICBpZiAoY29tcGFyYXRvcikgewogICAgICBpbmNsdWRlcyA9IGFycmF5SW5jbHVkZXNXaXRoOwogICAgICBpc0NvbW1vbiA9IGZhbHNlOwogICAgfQogICAgZWxzZSBpZiAodmFsdWVzLmxlbmd0aCA+PSBMQVJHRV9BUlJBWV9TSVpFKSB7CiAgICAgIGluY2x1ZGVzID0gY2FjaGVIYXM7CiAgICAgIGlzQ29tbW9uID0gZmFsc2U7CiAgICAgIHZhbHVlcyA9IG5ldyBTZXRDYWNoZSh2YWx1ZXMpOwogICAgfQogICAgb3V0ZXI6CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICB2YXIgdmFsdWUgPSBhcnJheVtpbmRleF0sCiAgICAgICAgICBjb21wdXRlZCA9IGl0ZXJhdGVlID09IG51bGwgPyB2YWx1ZSA6IGl0ZXJhdGVlKHZhbHVlKTsKCiAgICAgIHZhbHVlID0gKGNvbXBhcmF0b3IgfHwgdmFsdWUgIT09IDApID8gdmFsdWUgOiAwOwogICAgICBpZiAoaXNDb21tb24gJiYgY29tcHV0ZWQgPT09IGNvbXB1dGVkKSB7CiAgICAgICAgdmFyIHZhbHVlc0luZGV4ID0gdmFsdWVzTGVuZ3RoOwogICAgICAgIHdoaWxlICh2YWx1ZXNJbmRleC0tKSB7CiAgICAgICAgICBpZiAodmFsdWVzW3ZhbHVlc0luZGV4XSA9PT0gY29tcHV0ZWQpIHsKICAgICAgICAgICAgY29udGludWUgb3V0ZXI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlKTsKICAgICAgfQogICAgICBlbHNlIGlmICghaW5jbHVkZXModmFsdWVzLCBjb21wdXRlZCwgY29tcGFyYXRvcikpIHsKICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5maWxsYCB3aXRob3V0IGFuIGl0ZXJhdGVlIGNhbGwgZ3VhcmQuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBmaWxsLgogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGZpbGwgYGFycmF5YCB3aXRoLgogICAqIEBwYXJhbSB7bnVtYmVyfSBbc3RhcnQ9MF0gVGhlIHN0YXJ0IHBvc2l0aW9uLgogICAqIEBwYXJhbSB7bnVtYmVyfSBbZW5kPWFycmF5Lmxlbmd0aF0gVGhlIGVuZCBwb3NpdGlvbi4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC4KICAgKi8KICBmdW5jdGlvbiBiYXNlRmlsbChhcnJheSwgdmFsdWUsIHN0YXJ0LCBlbmQpIHsKICAgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGg7CgogICAgc3RhcnQgPSB0b0ludGVnZXIoc3RhcnQpOwogICAgaWYgKHN0YXJ0IDwgMCkgewogICAgICBzdGFydCA9IC1zdGFydCA+IGxlbmd0aCA/IDAgOiAobGVuZ3RoICsgc3RhcnQpOwogICAgfQogICAgZW5kID0gKGVuZCA9PT0gdW5kZWZpbmVkIHx8IGVuZCA+IGxlbmd0aCkgPyBsZW5ndGggOiB0b0ludGVnZXIoZW5kKTsKICAgIGlmIChlbmQgPCAwKSB7CiAgICAgIGVuZCArPSBsZW5ndGg7CiAgICB9CiAgICBlbmQgPSBzdGFydCA+IGVuZCA/IDAgOiB0b0xlbmd0aChlbmQpOwogICAgd2hpbGUgKHN0YXJ0IDwgZW5kKSB7CiAgICAgIGFycmF5W3N0YXJ0KytdID0gdmFsdWU7CiAgICB9CiAgICByZXR1cm4gYXJyYXk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5mbGF0dGVuYCB3aXRoIHN1cHBvcnQgZm9yIHJlc3RyaWN0aW5nIGZsYXR0ZW5pbmcuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBmbGF0dGVuLgogICAqIEBwYXJhbSB7bnVtYmVyfSBkZXB0aCBUaGUgbWF4aW11bSByZWN1cnNpb24gZGVwdGguCiAgICogQHBhcmFtIHtib29sZWFufSBbcHJlZGljYXRlPWlzRmxhdHRlbmFibGVdIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uCiAgICogQHBhcmFtIHtib29sZWFufSBbaXNTdHJpY3RdIFJlc3RyaWN0IHRvIHZhbHVlcyB0aGF0IHBhc3MgYHByZWRpY2F0ZWAgY2hlY2tzLgogICAqIEBwYXJhbSB7QXJyYXl9IFtyZXN1bHQ9W11dIFRoZSBpbml0aWFsIHJlc3VsdCB2YWx1ZS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBmbGF0dGVuZWQgYXJyYXkuCiAgICovCiAgZnVuY3Rpb24gYmFzZUZsYXR0ZW4oYXJyYXksIGRlcHRoLCBwcmVkaWNhdGUsIGlzU3RyaWN0LCByZXN1bHQpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsKCiAgICBwcmVkaWNhdGUgfHwgKHByZWRpY2F0ZSA9IGlzRmxhdHRlbmFibGUpOwogICAgcmVzdWx0IHx8IChyZXN1bHQgPSBbXSk7CgogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgdmFyIHZhbHVlID0gYXJyYXlbaW5kZXhdOwogICAgICBpZiAoZGVwdGggPiAwICYmIHByZWRpY2F0ZSh2YWx1ZSkpIHsKICAgICAgICBpZiAoZGVwdGggPiAxKSB7CiAgICAgICAgICAvLyBSZWN1cnNpdmVseSBmbGF0dGVuIGFycmF5cyAoc3VzY2VwdGlibGUgdG8gY2FsbCBzdGFjayBsaW1pdHMpLgogICAgICAgICAgYmFzZUZsYXR0ZW4odmFsdWUsIGRlcHRoIC0gMSwgcHJlZGljYXRlLCBpc1N0cmljdCwgcmVzdWx0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXJyYXlQdXNoKHJlc3VsdCwgdmFsdWUpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICghaXNTdHJpY3QpIHsKICAgICAgICByZXN1bHRbcmVzdWx0Lmxlbmd0aF0gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmdldGAgd2l0aG91dCBzdXBwb3J0IGZvciBkZWZhdWx0IHZhbHVlcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7QXJyYXl8c3RyaW5nfSBwYXRoIFRoZSBwYXRoIG9mIHRoZSBwcm9wZXJ0eSB0byBnZXQuCiAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIHJlc29sdmVkIHZhbHVlLgogICAqLwogIGZ1bmN0aW9uIGJhc2VHZXQob2JqZWN0LCBwYXRoKSB7CiAgICBwYXRoID0gY2FzdFBhdGgocGF0aCwgb2JqZWN0KTsKCiAgICB2YXIgaW5kZXggPSAwLAogICAgICAgIGxlbmd0aCA9IHBhdGgubGVuZ3RoOwoKICAgIHdoaWxlIChvYmplY3QgIT0gbnVsbCAmJiBpbmRleCA8IGxlbmd0aCkgewogICAgICBvYmplY3QgPSBvYmplY3RbdG9LZXkocGF0aFtpbmRleCsrXSldOwogICAgfQogICAgcmV0dXJuIChpbmRleCAmJiBpbmRleCA9PSBsZW5ndGgpID8gb2JqZWN0IDogdW5kZWZpbmVkOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYGdldEFsbEtleXNgIGFuZCBgZ2V0QWxsS2V5c0luYCB3aGljaCB1c2VzCiAgICogYGtleXNGdW5jYCBhbmQgYHN5bWJvbHNGdW5jYCB0byBnZXQgdGhlIGVudW1lcmFibGUgcHJvcGVydHkgbmFtZXMgYW5kCiAgICogc3ltYm9scyBvZiBgb2JqZWN0YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGtleXNGdW5jIFRoZSBmdW5jdGlvbiB0byBnZXQgdGhlIGtleXMgb2YgYG9iamVjdGAuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gc3ltYm9sc0Z1bmMgVGhlIGZ1bmN0aW9uIHRvIGdldCB0aGUgc3ltYm9scyBvZiBgb2JqZWN0YC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzIGFuZCBzeW1ib2xzLgogICAqLwogIGZ1bmN0aW9uIGJhc2VHZXRBbGxLZXlzKG9iamVjdCwga2V5c0Z1bmMsIHN5bWJvbHNGdW5jKSB7CiAgICB2YXIgcmVzdWx0ID0ga2V5c0Z1bmMob2JqZWN0KTsKICAgIHJldHVybiBpc0FycmF5KG9iamVjdCkgPyByZXN1bHQgOiBhcnJheVB1c2gocmVzdWx0LCBzeW1ib2xzRnVuYyhvYmplY3QpKTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBnZXRUYWdgIHdpdGhvdXQgZmFsbGJhY2tzIGZvciBidWdneSBlbnZpcm9ubWVudHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHF1ZXJ5LgogICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGB0b1N0cmluZ1RhZ2AuCiAgICovCiAgZnVuY3Rpb24gYmFzZUdldFRhZyh2YWx1ZSkgewogICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWRUYWcgOiBudWxsVGFnOwogICAgfQogICAgcmV0dXJuIChzeW1Ub1N0cmluZ1RhZyAmJiBzeW1Ub1N0cmluZ1RhZyBpbiBPYmplY3QodmFsdWUpKQogICAgICA/IGdldFJhd1RhZyh2YWx1ZSkKICAgICAgOiBvYmplY3RUb1N0cmluZyh2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5ndGAgd2hpY2ggZG9lc24ndCBjb2VyY2UgYXJndW1lbnRzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb21wYXJlLgogICAqIEBwYXJhbSB7Kn0gb3RoZXIgVGhlIG90aGVyIHZhbHVlIHRvIGNvbXBhcmUuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgZ3JlYXRlciB0aGFuIGBvdGhlcmAsCiAgICogIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBiYXNlR3QodmFsdWUsIG90aGVyKSB7CiAgICByZXR1cm4gdmFsdWUgPiBvdGhlcjsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmhhc0luYCB3aXRob3V0IHN1cHBvcnQgZm9yIGRlZXAgcGF0aHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBbb2JqZWN0XSBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7QXJyYXl8c3RyaW5nfSBrZXkgVGhlIGtleSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYGtleWAgZXhpc3RzLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gYmFzZUhhc0luKG9iamVjdCwga2V5KSB7CiAgICByZXR1cm4gb2JqZWN0ICE9IG51bGwgJiYga2V5IGluIE9iamVjdChvYmplY3QpOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgbWV0aG9kcyBsaWtlIGBfLmludGVyc2VjdGlvbmAsIHdpdGhvdXQgc3VwcG9ydAogICAqIGZvciBpdGVyYXRlZSBzaG9ydGhhbmRzLCB0aGF0IGFjY2VwdHMgYW4gYXJyYXkgb2YgYXJyYXlzIHRvIGluc3BlY3QuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5cyBUaGUgYXJyYXlzIHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlXSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY29tcGFyYXRvcl0gVGhlIGNvbXBhcmF0b3IgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBzaGFyZWQgdmFsdWVzLgogICAqLwogIGZ1bmN0aW9uIGJhc2VJbnRlcnNlY3Rpb24oYXJyYXlzLCBpdGVyYXRlZSwgY29tcGFyYXRvcikgewogICAgdmFyIGluY2x1ZGVzID0gY29tcGFyYXRvciA/IGFycmF5SW5jbHVkZXNXaXRoIDogYXJyYXlJbmNsdWRlcywKICAgICAgICBsZW5ndGggPSBhcnJheXNbMF0ubGVuZ3RoLAogICAgICAgIG90aExlbmd0aCA9IGFycmF5cy5sZW5ndGgsCiAgICAgICAgb3RoSW5kZXggPSBvdGhMZW5ndGgsCiAgICAgICAgY2FjaGVzID0gQXJyYXkob3RoTGVuZ3RoKSwKICAgICAgICBtYXhMZW5ndGggPSBJbmZpbml0eSwKICAgICAgICByZXN1bHQgPSBbXTsKCiAgICB3aGlsZSAob3RoSW5kZXgtLSkgewogICAgICB2YXIgYXJyYXkgPSBhcnJheXNbb3RoSW5kZXhdOwogICAgICBpZiAob3RoSW5kZXggJiYgaXRlcmF0ZWUpIHsKICAgICAgICBhcnJheSA9IGFycmF5TWFwKGFycmF5LCBiYXNlVW5hcnkoaXRlcmF0ZWUpKTsKICAgICAgfQogICAgICBtYXhMZW5ndGggPSBuYXRpdmVNaW4oYXJyYXkubGVuZ3RoLCBtYXhMZW5ndGgpOwogICAgICBjYWNoZXNbb3RoSW5kZXhdID0gIWNvbXBhcmF0b3IgJiYgKGl0ZXJhdGVlIHx8IChsZW5ndGggPj0gMTIwICYmIGFycmF5Lmxlbmd0aCA+PSAxMjApKQogICAgICAgID8gbmV3IFNldENhY2hlKG90aEluZGV4ICYmIGFycmF5KQogICAgICAgIDogdW5kZWZpbmVkOwogICAgfQogICAgYXJyYXkgPSBhcnJheXNbMF07CgogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgc2VlbiA9IGNhY2hlc1swXTsKCiAgICBvdXRlcjoKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoICYmIHJlc3VsdC5sZW5ndGggPCBtYXhMZW5ndGgpIHsKICAgICAgdmFyIHZhbHVlID0gYXJyYXlbaW5kZXhdLAogICAgICAgICAgY29tcHV0ZWQgPSBpdGVyYXRlZSA/IGl0ZXJhdGVlKHZhbHVlKSA6IHZhbHVlOwoKICAgICAgdmFsdWUgPSAoY29tcGFyYXRvciB8fCB2YWx1ZSAhPT0gMCkgPyB2YWx1ZSA6IDA7CiAgICAgIGlmICghKHNlZW4KICAgICAgICAgICAgPyBjYWNoZUhhcyhzZWVuLCBjb21wdXRlZCkKICAgICAgICAgICAgOiBpbmNsdWRlcyhyZXN1bHQsIGNvbXB1dGVkLCBjb21wYXJhdG9yKQogICAgICAgICAgKSkgewogICAgICAgIG90aEluZGV4ID0gb3RoTGVuZ3RoOwogICAgICAgIHdoaWxlICgtLW90aEluZGV4KSB7CiAgICAgICAgICB2YXIgY2FjaGUgPSBjYWNoZXNbb3RoSW5kZXhdOwogICAgICAgICAgaWYgKCEoY2FjaGUKICAgICAgICAgICAgICAgID8gY2FjaGVIYXMoY2FjaGUsIGNvbXB1dGVkKQogICAgICAgICAgICAgICAgOiBpbmNsdWRlcyhhcnJheXNbb3RoSW5kZXhdLCBjb21wdXRlZCwgY29tcGFyYXRvcikpCiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgIGNvbnRpbnVlIG91dGVyOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoc2VlbikgewogICAgICAgICAgc2Vlbi5wdXNoKGNvbXB1dGVkKTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uaXNBcmd1bWVudHNgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBgYXJndW1lbnRzYCBvYmplY3QsCiAgICovCiAgZnVuY3Rpb24gYmFzZUlzQXJndW1lbnRzKHZhbHVlKSB7CiAgICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBiYXNlR2V0VGFnKHZhbHVlKSA9PSBhcmdzVGFnOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uaXNBcnJheUJ1ZmZlcmAgd2l0aG91dCBOb2RlLmpzIG9wdGltaXphdGlvbnMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGFuIGFycmF5IGJ1ZmZlciwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VJc0FycmF5QnVmZmVyKHZhbHVlKSB7CiAgICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBiYXNlR2V0VGFnKHZhbHVlKSA9PSBhcnJheUJ1ZmZlclRhZzsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmlzRGF0ZWAgd2l0aG91dCBOb2RlLmpzIG9wdGltaXphdGlvbnMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgZGF0ZSBvYmplY3QsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBiYXNlSXNEYXRlKHZhbHVlKSB7CiAgICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBiYXNlR2V0VGFnKHZhbHVlKSA9PSBkYXRlVGFnOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uaXNFcXVhbGAgd2hpY2ggc3VwcG9ydHMgcGFydGlhbCBjb21wYXJpc29ucwogICAqIGFuZCB0cmFja3MgdHJhdmVyc2VkIG9iamVjdHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbXBhcmUuCiAgICogQHBhcmFtIHsqfSBvdGhlciBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0ge2Jvb2xlYW59IGJpdG1hc2sgVGhlIGJpdG1hc2sgZmxhZ3MuCiAgICogIDEgLSBVbm9yZGVyZWQgY29tcGFyaXNvbgogICAqICAyIC0gUGFydGlhbCBjb21wYXJpc29uCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2N1c3RvbWl6ZXJdIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgY29tcGFyaXNvbnMuCiAgICogQHBhcmFtIHtPYmplY3R9IFtzdGFja10gVHJhY2tzIHRyYXZlcnNlZCBgdmFsdWVgIGFuZCBgb3RoZXJgIG9iamVjdHMuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSB2YWx1ZXMgYXJlIGVxdWl2YWxlbnQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBiYXNlSXNFcXVhbCh2YWx1ZSwgb3RoZXIsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIHN0YWNrKSB7CiAgICBpZiAodmFsdWUgPT09IG90aGVyKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKHZhbHVlID09IG51bGwgfHwgb3RoZXIgPT0gbnVsbCB8fCAoIWlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgIWlzT2JqZWN0TGlrZShvdGhlcikpKSB7CiAgICAgIHJldHVybiB2YWx1ZSAhPT0gdmFsdWUgJiYgb3RoZXIgIT09IG90aGVyOwogICAgfQogICAgcmV0dXJuIGJhc2VJc0VxdWFsRGVlcCh2YWx1ZSwgb3RoZXIsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGJhc2VJc0VxdWFsLCBzdGFjayk7CiAgfQoKICAvKioKICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYGJhc2VJc0VxdWFsYCBmb3IgYXJyYXlzIGFuZCBvYmplY3RzIHdoaWNoIHBlcmZvcm1zCiAgICogZGVlcCBjb21wYXJpc29ucyBhbmQgdHJhY2tzIHRyYXZlcnNlZCBvYmplY3RzIGVuYWJsaW5nIG9iamVjdHMgd2l0aCBjaXJjdWxhcgogICAqIHJlZmVyZW5jZXMgdG8gYmUgY29tcGFyZWQuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBjb21wYXJlLgogICAqIEBwYXJhbSB7T2JqZWN0fSBvdGhlciBUaGUgb3RoZXIgb2JqZWN0IHRvIGNvbXBhcmUuCiAgICogQHBhcmFtIHtudW1iZXJ9IGJpdG1hc2sgVGhlIGJpdG1hc2sgZmxhZ3MuIFNlZSBgYmFzZUlzRXF1YWxgIGZvciBtb3JlIGRldGFpbHMuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY3VzdG9taXplciBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNvbXBhcmlzb25zLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGVxdWFsRnVuYyBUaGUgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGVxdWl2YWxlbnRzIG9mIHZhbHVlcy4KICAgKiBAcGFyYW0ge09iamVjdH0gW3N0YWNrXSBUcmFja3MgdHJhdmVyc2VkIGBvYmplY3RgIGFuZCBgb3RoZXJgIG9iamVjdHMuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBvYmplY3RzIGFyZSBlcXVpdmFsZW50LCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gYmFzZUlzRXF1YWxEZWVwKG9iamVjdCwgb3RoZXIsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGVxdWFsRnVuYywgc3RhY2spIHsKICAgIHZhciBvYmpJc0FyciA9IGlzQXJyYXkob2JqZWN0KSwKICAgICAgICBvdGhJc0FyciA9IGlzQXJyYXkob3RoZXIpLAogICAgICAgIG9ialRhZyA9IG9iaklzQXJyID8gYXJyYXlUYWcgOiBnZXRUYWcob2JqZWN0KSwKICAgICAgICBvdGhUYWcgPSBvdGhJc0FyciA/IGFycmF5VGFnIDogZ2V0VGFnKG90aGVyKTsKCiAgICBvYmpUYWcgPSBvYmpUYWcgPT0gYXJnc1RhZyA/IG9iamVjdFRhZyA6IG9ialRhZzsKICAgIG90aFRhZyA9IG90aFRhZyA9PSBhcmdzVGFnID8gb2JqZWN0VGFnIDogb3RoVGFnOwoKICAgIHZhciBvYmpJc09iaiA9IG9ialRhZyA9PSBvYmplY3RUYWcsCiAgICAgICAgb3RoSXNPYmogPSBvdGhUYWcgPT0gb2JqZWN0VGFnLAogICAgICAgIGlzU2FtZVRhZyA9IG9ialRhZyA9PSBvdGhUYWc7CgogICAgaWYgKGlzU2FtZVRhZyAmJiBpc0J1ZmZlcihvYmplY3QpKSB7CiAgICAgIGlmICghaXNCdWZmZXIob3RoZXIpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIG9iaklzQXJyID0gdHJ1ZTsKICAgICAgb2JqSXNPYmogPSBmYWxzZTsKICAgIH0KICAgIGlmIChpc1NhbWVUYWcgJiYgIW9iaklzT2JqKSB7CiAgICAgIHN0YWNrIHx8IChzdGFjayA9IG5ldyBTdGFjayk7CiAgICAgIHJldHVybiAob2JqSXNBcnIgfHwgaXNUeXBlZEFycmF5KG9iamVjdCkpCiAgICAgICAgPyBlcXVhbEFycmF5cyhvYmplY3QsIG90aGVyLCBiaXRtYXNrLCBjdXN0b21pemVyLCBlcXVhbEZ1bmMsIHN0YWNrKQogICAgICAgIDogZXF1YWxCeVRhZyhvYmplY3QsIG90aGVyLCBvYmpUYWcsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGVxdWFsRnVuYywgc3RhY2spOwogICAgfQogICAgaWYgKCEoYml0bWFzayAmIENPTVBBUkVfUEFSVElBTF9GTEFHKSkgewogICAgICB2YXIgb2JqSXNXcmFwcGVkID0gb2JqSXNPYmogJiYgaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsICdfX3dyYXBwZWRfXycpLAogICAgICAgICAgb3RoSXNXcmFwcGVkID0gb3RoSXNPYmogJiYgaGFzT3duUHJvcGVydHkuY2FsbChvdGhlciwgJ19fd3JhcHBlZF9fJyk7CgogICAgICBpZiAob2JqSXNXcmFwcGVkIHx8IG90aElzV3JhcHBlZCkgewogICAgICAgIHZhciBvYmpVbndyYXBwZWQgPSBvYmpJc1dyYXBwZWQgPyBvYmplY3QudmFsdWUoKSA6IG9iamVjdCwKICAgICAgICAgICAgb3RoVW53cmFwcGVkID0gb3RoSXNXcmFwcGVkID8gb3RoZXIudmFsdWUoKSA6IG90aGVyOwoKICAgICAgICBzdGFjayB8fCAoc3RhY2sgPSBuZXcgU3RhY2spOwogICAgICAgIHJldHVybiBlcXVhbEZ1bmMob2JqVW53cmFwcGVkLCBvdGhVbndyYXBwZWQsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIHN0YWNrKTsKICAgICAgfQogICAgfQogICAgaWYgKCFpc1NhbWVUYWcpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgc3RhY2sgfHwgKHN0YWNrID0gbmV3IFN0YWNrKTsKICAgIHJldHVybiBlcXVhbE9iamVjdHMob2JqZWN0LCBvdGhlciwgYml0bWFzaywgY3VzdG9taXplciwgZXF1YWxGdW5jLCBzdGFjayk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5pc01hcGAgd2l0aG91dCBOb2RlLmpzIG9wdGltaXphdGlvbnMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgbWFwLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gYmFzZUlzTWFwKHZhbHVlKSB7CiAgICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBnZXRUYWcodmFsdWUpID09IG1hcFRhZzsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmlzTWF0Y2hgIHdpdGhvdXQgc3VwcG9ydCBmb3IgaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgb2JqZWN0IG9mIHByb3BlcnR5IHZhbHVlcyB0byBtYXRjaC4KICAgKiBAcGFyYW0ge0FycmF5fSBtYXRjaERhdGEgVGhlIHByb3BlcnR5IG5hbWVzLCB2YWx1ZXMsIGFuZCBjb21wYXJlIGZsYWdzIHRvIG1hdGNoLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjdXN0b21pemVyXSBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNvbXBhcmlzb25zLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgb2JqZWN0YCBpcyBhIG1hdGNoLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gYmFzZUlzTWF0Y2gob2JqZWN0LCBzb3VyY2UsIG1hdGNoRGF0YSwgY3VzdG9taXplcikgewogICAgdmFyIGluZGV4ID0gbWF0Y2hEYXRhLmxlbmd0aCwKICAgICAgICBsZW5ndGggPSBpbmRleCwKICAgICAgICBub0N1c3RvbWl6ZXIgPSAhY3VzdG9taXplcjsKCiAgICBpZiAob2JqZWN0ID09IG51bGwpIHsKICAgICAgcmV0dXJuICFsZW5ndGg7CiAgICB9CiAgICBvYmplY3QgPSBPYmplY3Qob2JqZWN0KTsKICAgIHdoaWxlIChpbmRleC0tKSB7CiAgICAgIHZhciBkYXRhID0gbWF0Y2hEYXRhW2luZGV4XTsKICAgICAgaWYgKChub0N1c3RvbWl6ZXIgJiYgZGF0YVsyXSkKICAgICAgICAgICAgPyBkYXRhWzFdICE9PSBvYmplY3RbZGF0YVswXV0KICAgICAgICAgICAgOiAhKGRhdGFbMF0gaW4gb2JqZWN0KQogICAgICAgICAgKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICBkYXRhID0gbWF0Y2hEYXRhW2luZGV4XTsKICAgICAgdmFyIGtleSA9IGRhdGFbMF0sCiAgICAgICAgICBvYmpWYWx1ZSA9IG9iamVjdFtrZXldLAogICAgICAgICAgc3JjVmFsdWUgPSBkYXRhWzFdOwoKICAgICAgaWYgKG5vQ3VzdG9taXplciAmJiBkYXRhWzJdKSB7CiAgICAgICAgaWYgKG9ialZhbHVlID09PSB1bmRlZmluZWQgJiYgIShrZXkgaW4gb2JqZWN0KSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgc3RhY2sgPSBuZXcgU3RhY2s7CiAgICAgICAgaWYgKGN1c3RvbWl6ZXIpIHsKICAgICAgICAgIHZhciByZXN1bHQgPSBjdXN0b21pemVyKG9ialZhbHVlLCBzcmNWYWx1ZSwga2V5LCBvYmplY3QsIHNvdXJjZSwgc3RhY2spOwogICAgICAgIH0KICAgICAgICBpZiAoIShyZXN1bHQgPT09IHVuZGVmaW5lZAogICAgICAgICAgICAgID8gYmFzZUlzRXF1YWwoc3JjVmFsdWUsIG9ialZhbHVlLCBDT01QQVJFX1BBUlRJQUxfRkxBRyB8IENPTVBBUkVfVU5PUkRFUkVEX0ZMQUcsIGN1c3RvbWl6ZXIsIHN0YWNrKQogICAgICAgICAgICAgIDogcmVzdWx0CiAgICAgICAgICAgICkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uaXNOYXRpdmVgIHdpdGhvdXQgYmFkIHNoaW0gY2hlY2tzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIG5hdGl2ZSBmdW5jdGlvbiwKICAgKiAgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VJc05hdGl2ZSh2YWx1ZSkgewogICAgaWYgKCFpc09iamVjdCh2YWx1ZSkgfHwgaXNNYXNrZWQodmFsdWUpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHZhciBwYXR0ZXJuID0gaXNGdW5jdGlvbih2YWx1ZSkgPyByZUlzTmF0aXZlIDogcmVJc0hvc3RDdG9yOwogICAgcmV0dXJuIHBhdHRlcm4udGVzdCh0b1NvdXJjZSh2YWx1ZSkpOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uaXNSZWdFeHBgIHdpdGhvdXQgTm9kZS5qcyBvcHRpbWl6YXRpb25zLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHJlZ2V4cCwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VJc1JlZ0V4cCh2YWx1ZSkgewogICAgcmV0dXJuIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgYmFzZUdldFRhZyh2YWx1ZSkgPT0gcmVnZXhwVGFnOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uaXNTZXRgIHdpdGhvdXQgTm9kZS5qcyBvcHRpbWl6YXRpb25zLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHNldCwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VJc1NldCh2YWx1ZSkgewogICAgcmV0dXJuIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgZ2V0VGFnKHZhbHVlKSA9PSBzZXRUYWc7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5pc1R5cGVkQXJyYXlgIHdpdGhvdXQgTm9kZS5qcyBvcHRpbWl6YXRpb25zLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHR5cGVkIGFycmF5LCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gYmFzZUlzVHlwZWRBcnJheSh2YWx1ZSkgewogICAgcmV0dXJuIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYKICAgICAgaXNMZW5ndGgodmFsdWUubGVuZ3RoKSAmJiAhIXR5cGVkQXJyYXlUYWdzW2Jhc2VHZXRUYWcodmFsdWUpXTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLml0ZXJhdGVlYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSBbdmFsdWU9Xy5pZGVudGl0eV0gVGhlIHZhbHVlIHRvIGNvbnZlcnQgdG8gYW4gaXRlcmF0ZWUuCiAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBpdGVyYXRlZS4KICAgKi8KICBmdW5jdGlvbiBiYXNlSXRlcmF0ZWUodmFsdWUpIHsKICAgIC8vIERvbid0IHN0b3JlIHRoZSBgdHlwZW9mYCByZXN1bHQgaW4gYSB2YXJpYWJsZSB0byBhdm9pZCBhIEpJVCBidWcgaW4gU2FmYXJpIDkuCiAgICAvLyBTZWUgaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTE1NjAzNCBmb3IgbW9yZSBkZXRhaWxzLgogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnZnVuY3Rpb24nKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgIHJldHVybiBpZGVudGl0eTsKICAgIH0KICAgIGlmICh0eXBlb2YgdmFsdWUgPT0gJ29iamVjdCcpIHsKICAgICAgcmV0dXJuIGlzQXJyYXkodmFsdWUpCiAgICAgICAgPyBiYXNlTWF0Y2hlc1Byb3BlcnR5KHZhbHVlWzBdLCB2YWx1ZVsxXSkKICAgICAgICA6IGJhc2VNYXRjaGVzKHZhbHVlKTsKICAgIH0KICAgIHJldHVybiBwcm9wZXJ0eSh2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5rZXlzYCB3aGljaCBkb2Vzbid0IHRyZWF0IHNwYXJzZSBhcnJheXMgYXMgZGVuc2UuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzLgogICAqLwogIGZ1bmN0aW9uIGJhc2VLZXlzKG9iamVjdCkgewogICAgaWYgKCFpc1Byb3RvdHlwZShvYmplY3QpKSB7CiAgICAgIHJldHVybiBuYXRpdmVLZXlzKG9iamVjdCk7CiAgICB9CiAgICB2YXIgcmVzdWx0ID0gW107CiAgICBmb3IgKHZhciBrZXkgaW4gT2JqZWN0KG9iamVjdCkpIHsKICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBrZXkpICYmIGtleSAhPSAnY29uc3RydWN0b3InKSB7CiAgICAgICAgcmVzdWx0LnB1c2goa2V5KTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmtleXNJbmAgd2hpY2ggZG9lc24ndCB0cmVhdCBzcGFyc2UgYXJyYXlzIGFzIGRlbnNlLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcy4KICAgKi8KICBmdW5jdGlvbiBiYXNlS2V5c0luKG9iamVjdCkgewogICAgaWYgKCFpc09iamVjdChvYmplY3QpKSB7CiAgICAgIHJldHVybiBuYXRpdmVLZXlzSW4ob2JqZWN0KTsKICAgIH0KICAgIHZhciBpc1Byb3RvID0gaXNQcm90b3R5cGUob2JqZWN0KSwKICAgICAgICByZXN1bHQgPSBbXTsKCiAgICBmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSB7CiAgICAgIGlmICghKGtleSA9PSAnY29uc3RydWN0b3InICYmIChpc1Byb3RvIHx8ICFoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwga2V5KSkpKSB7CiAgICAgICAgcmVzdWx0LnB1c2goa2V5KTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmx0YCB3aGljaCBkb2Vzbid0IGNvZXJjZSBhcmd1bWVudHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbXBhcmUuCiAgICogQHBhcmFtIHsqfSBvdGhlciBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBsZXNzIHRoYW4gYG90aGVyYCwKICAgKiAgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VMdCh2YWx1ZSwgb3RoZXIpIHsKICAgIHJldHVybiB2YWx1ZSA8IG90aGVyOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8ubWF0Y2hlc2Agd2hpY2ggZG9lc24ndCBjbG9uZSBgc291cmNlYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgb2JqZWN0IG9mIHByb3BlcnR5IHZhbHVlcyB0byBtYXRjaC4KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBzcGVjIGZ1bmN0aW9uLgogICAqLwogIGZ1bmN0aW9uIGJhc2VNYXRjaGVzKHNvdXJjZSkgewogICAgdmFyIG1hdGNoRGF0YSA9IGdldE1hdGNoRGF0YShzb3VyY2UpOwogICAgaWYgKG1hdGNoRGF0YS5sZW5ndGggPT0gMSAmJiBtYXRjaERhdGFbMF1bMl0pIHsKICAgICAgcmV0dXJuIG1hdGNoZXNTdHJpY3RDb21wYXJhYmxlKG1hdGNoRGF0YVswXVswXSwgbWF0Y2hEYXRhWzBdWzFdKTsKICAgIH0KICAgIHJldHVybiBmdW5jdGlvbihvYmplY3QpIHsKICAgICAgcmV0dXJuIG9iamVjdCA9PT0gc291cmNlIHx8IGJhc2VJc01hdGNoKG9iamVjdCwgc291cmNlLCBtYXRjaERhdGEpOwogICAgfTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLm1hdGNoZXNQcm9wZXJ0eWAgd2hpY2ggZG9lc24ndCBjbG9uZSBgc3JjVmFsdWVgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge3N0cmluZ30gcGF0aCBUaGUgcGF0aCBvZiB0aGUgcHJvcGVydHkgdG8gZ2V0LgogICAqIEBwYXJhbSB7Kn0gc3JjVmFsdWUgVGhlIHZhbHVlIHRvIG1hdGNoLgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IHNwZWMgZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gYmFzZU1hdGNoZXNQcm9wZXJ0eShwYXRoLCBzcmNWYWx1ZSkgewogICAgaWYgKGlzS2V5KHBhdGgpICYmIGlzU3RyaWN0Q29tcGFyYWJsZShzcmNWYWx1ZSkpIHsKICAgICAgcmV0dXJuIG1hdGNoZXNTdHJpY3RDb21wYXJhYmxlKHRvS2V5KHBhdGgpLCBzcmNWYWx1ZSk7CiAgICB9CiAgICByZXR1cm4gZnVuY3Rpb24ob2JqZWN0KSB7CiAgICAgIHZhciBvYmpWYWx1ZSA9IGdldChvYmplY3QsIHBhdGgpOwogICAgICByZXR1cm4gKG9ialZhbHVlID09PSB1bmRlZmluZWQgJiYgb2JqVmFsdWUgPT09IHNyY1ZhbHVlKQogICAgICAgID8gaGFzSW4ob2JqZWN0LCBwYXRoKQogICAgICAgIDogYmFzZUlzRXF1YWwoc3JjVmFsdWUsIG9ialZhbHVlLCBDT01QQVJFX1BBUlRJQUxfRkxBRyB8IENPTVBBUkVfVU5PUkRFUkVEX0ZMQUcpOwogICAgfTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLm50aGAgd2hpY2ggZG9lc24ndCBjb2VyY2UgYXJndW1lbnRzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcXVlcnkuCiAgICogQHBhcmFtIHtudW1iZXJ9IG4gVGhlIGluZGV4IG9mIHRoZSBlbGVtZW50IHRvIHJldHVybi4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgbnRoIGVsZW1lbnQgb2YgYGFycmF5YC4KICAgKi8KICBmdW5jdGlvbiBiYXNlTnRoKGFycmF5LCBuKSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgaWYgKCFsZW5ndGgpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgbiArPSBuIDwgMCA/IGxlbmd0aCA6IDA7CiAgICByZXR1cm4gaXNJbmRleChuLCBsZW5ndGgpID8gYXJyYXlbbl0gOiB1bmRlZmluZWQ7CiAgfQoKICAvKioKICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYGJhc2VQcm9wZXJ0eWAgd2hpY2ggc3VwcG9ydHMgZGVlcCBwYXRocy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggb2YgdGhlIHByb3BlcnR5IHRvIGdldC4KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBhY2Nlc3NvciBmdW5jdGlvbi4KICAgKi8KICBmdW5jdGlvbiBiYXNlUHJvcGVydHlEZWVwKHBhdGgpIHsKICAgIHJldHVybiBmdW5jdGlvbihvYmplY3QpIHsKICAgICAgcmV0dXJuIGJhc2VHZXQob2JqZWN0LCBwYXRoKTsKICAgIH07CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5wdWxsQWxsQnlgIHdpdGhvdXQgc3VwcG9ydCBmb3IgaXRlcmF0ZWUKICAgKiBzaG9ydGhhbmRzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gbW9kaWZ5LgogICAqIEBwYXJhbSB7QXJyYXl9IHZhbHVlcyBUaGUgdmFsdWVzIHRvIHJlbW92ZS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWVdIFRoZSBpdGVyYXRlZSBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjb21wYXJhdG9yXSBUaGUgY29tcGFyYXRvciBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBgYXJyYXlgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VQdWxsQWxsKGFycmF5LCB2YWx1ZXMsIGl0ZXJhdGVlLCBjb21wYXJhdG9yKSB7CiAgICB2YXIgaW5kZXhPZiA9IGNvbXBhcmF0b3IgPyBiYXNlSW5kZXhPZldpdGggOiBiYXNlSW5kZXhPZiwKICAgICAgICBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IHZhbHVlcy5sZW5ndGgsCiAgICAgICAgc2VlbiA9IGFycmF5OwoKICAgIGlmIChhcnJheSA9PT0gdmFsdWVzKSB7CiAgICAgIHZhbHVlcyA9IGNvcHlBcnJheSh2YWx1ZXMpOwogICAgfQogICAgaWYgKGl0ZXJhdGVlKSB7CiAgICAgIHNlZW4gPSBhcnJheU1hcChhcnJheSwgYmFzZVVuYXJ5KGl0ZXJhdGVlKSk7CiAgICB9CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICB2YXIgZnJvbUluZGV4ID0gMCwKICAgICAgICAgIHZhbHVlID0gdmFsdWVzW2luZGV4XSwKICAgICAgICAgIGNvbXB1dGVkID0gaXRlcmF0ZWUgPyBpdGVyYXRlZSh2YWx1ZSkgOiB2YWx1ZTsKCiAgICAgIHdoaWxlICgoZnJvbUluZGV4ID0gaW5kZXhPZihzZWVuLCBjb21wdXRlZCwgZnJvbUluZGV4LCBjb21wYXJhdG9yKSkgPiAtMSkgewogICAgICAgIGlmIChzZWVuICE9PSBhcnJheSkgewogICAgICAgICAgc3BsaWNlLmNhbGwoc2VlbiwgZnJvbUluZGV4LCAxKTsKICAgICAgICB9CiAgICAgICAgc3BsaWNlLmNhbGwoYXJyYXksIGZyb21JbmRleCwgMSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBhcnJheTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnB1bGxBdGAgd2l0aG91dCBzdXBwb3J0IGZvciBpbmRpdmlkdWFsCiAgICogaW5kZXhlcyBvciBjYXB0dXJpbmcgdGhlIHJlbW92ZWQgZWxlbWVudHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBtb2RpZnkuCiAgICogQHBhcmFtIHtudW1iZXJbXX0gaW5kZXhlcyBUaGUgaW5kZXhlcyBvZiBlbGVtZW50cyB0byByZW1vdmUuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGBhcnJheWAuCiAgICovCiAgZnVuY3Rpb24gYmFzZVB1bGxBdChhcnJheSwgaW5kZXhlcykgewogICAgdmFyIGxlbmd0aCA9IGFycmF5ID8gaW5kZXhlcy5sZW5ndGggOiAwLAogICAgICAgIGxhc3RJbmRleCA9IGxlbmd0aCAtIDE7CgogICAgd2hpbGUgKGxlbmd0aC0tKSB7CiAgICAgIHZhciBpbmRleCA9IGluZGV4ZXNbbGVuZ3RoXTsKICAgICAgaWYgKGxlbmd0aCA9PSBsYXN0SW5kZXggfHwgaW5kZXggIT09IHByZXZpb3VzKSB7CiAgICAgICAgdmFyIHByZXZpb3VzID0gaW5kZXg7CiAgICAgICAgaWYgKGlzSW5kZXgoaW5kZXgpKSB7CiAgICAgICAgICBzcGxpY2UuY2FsbChhcnJheSwgaW5kZXgsIDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBiYXNlVW5zZXQoYXJyYXksIGluZGV4KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBhcnJheTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnJlc3RgIHdoaWNoIGRvZXNuJ3QgdmFsaWRhdGUgb3IgY29lcmNlIGFyZ3VtZW50cy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gYXBwbHkgYSByZXN0IHBhcmFtZXRlciB0by4KICAgKiBAcGFyYW0ge251bWJlcn0gW3N0YXJ0PWZ1bmMubGVuZ3RoLTFdIFRoZSBzdGFydCBwb3NpdGlvbiBvZiB0aGUgcmVzdCBwYXJhbWV0ZXIuCiAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gYmFzZVJlc3QoZnVuYywgc3RhcnQpIHsKICAgIHJldHVybiBzZXRUb1N0cmluZyhvdmVyUmVzdChmdW5jLCBzdGFydCwgaWRlbnRpdHkpLCBmdW5jICsgJycpOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uc2V0YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIG1vZGlmeS4KICAgKiBAcGFyYW0ge0FycmF5fHN0cmluZ30gcGF0aCBUaGUgcGF0aCBvZiB0aGUgcHJvcGVydHkgdG8gc2V0LgogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNldC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY3VzdG9taXplcl0gVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBwYXRoIGNyZWF0aW9uLgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuCiAgICovCiAgZnVuY3Rpb24gYmFzZVNldChvYmplY3QsIHBhdGgsIHZhbHVlLCBjdXN0b21pemVyKSB7CiAgICBpZiAoIWlzT2JqZWN0KG9iamVjdCkpIHsKICAgICAgcmV0dXJuIG9iamVjdDsKICAgIH0KICAgIHBhdGggPSBjYXN0UGF0aChwYXRoLCBvYmplY3QpOwoKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IHBhdGgubGVuZ3RoLAogICAgICAgIGxhc3RJbmRleCA9IGxlbmd0aCAtIDEsCiAgICAgICAgbmVzdGVkID0gb2JqZWN0OwoKICAgIHdoaWxlIChuZXN0ZWQgIT0gbnVsbCAmJiArK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHZhciBrZXkgPSB0b0tleShwYXRoW2luZGV4XSksCiAgICAgICAgICBuZXdWYWx1ZSA9IHZhbHVlOwoKICAgICAgaWYgKGluZGV4ICE9IGxhc3RJbmRleCkgewogICAgICAgIHZhciBvYmpWYWx1ZSA9IG5lc3RlZFtrZXldOwogICAgICAgIG5ld1ZhbHVlID0gY3VzdG9taXplciA/IGN1c3RvbWl6ZXIob2JqVmFsdWUsIGtleSwgbmVzdGVkKSA6IHVuZGVmaW5lZDsKICAgICAgICBpZiAobmV3VmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgbmV3VmFsdWUgPSBpc09iamVjdChvYmpWYWx1ZSkKICAgICAgICAgICAgPyBvYmpWYWx1ZQogICAgICAgICAgICA6IChpc0luZGV4KHBhdGhbaW5kZXggKyAxXSkgPyBbXSA6IHt9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgYXNzaWduVmFsdWUobmVzdGVkLCBrZXksIG5ld1ZhbHVlKTsKICAgICAgbmVzdGVkID0gbmVzdGVkW2tleV07CiAgICB9CiAgICByZXR1cm4gb2JqZWN0OwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYHNldFRvU3RyaW5nYCB3aXRob3V0IHN1cHBvcnQgZm9yIGhvdCBsb29wIHNob3J0aW5nLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBtb2RpZnkuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gc3RyaW5nIFRoZSBgdG9TdHJpbmdgIHJlc3VsdC4KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgYGZ1bmNgLgogICAqLwogIHZhciBiYXNlU2V0VG9TdHJpbmcgPSAhZGVmaW5lUHJvcGVydHkgPyBpZGVudGl0eSA6IGZ1bmN0aW9uKGZ1bmMsIHN0cmluZykgewogICAgcmV0dXJuIGRlZmluZVByb3BlcnR5KGZ1bmMsICd0b1N0cmluZycsIHsKICAgICAgJ2NvbmZpZ3VyYWJsZSc6IHRydWUsCiAgICAgICdlbnVtZXJhYmxlJzogZmFsc2UsCiAgICAgICd2YWx1ZSc6IGNvbnN0YW50KHN0cmluZyksCiAgICAgICd3cml0YWJsZSc6IHRydWUKICAgIH0pOwogIH07CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnNsaWNlYCB3aXRob3V0IGFuIGl0ZXJhdGVlIGNhbGwgZ3VhcmQuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBzbGljZS4KICAgKiBAcGFyYW0ge251bWJlcn0gW3N0YXJ0PTBdIFRoZSBzdGFydCBwb3NpdGlvbi4KICAgKiBAcGFyYW0ge251bWJlcn0gW2VuZD1hcnJheS5sZW5ndGhdIFRoZSBlbmQgcG9zaXRpb24uCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VTbGljZShhcnJheSwgc3RhcnQsIGVuZCkgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwoKICAgIGlmIChzdGFydCA8IDApIHsKICAgICAgc3RhcnQgPSAtc3RhcnQgPiBsZW5ndGggPyAwIDogKGxlbmd0aCArIHN0YXJ0KTsKICAgIH0KICAgIGVuZCA9IGVuZCA+IGxlbmd0aCA/IGxlbmd0aCA6IGVuZDsKICAgIGlmIChlbmQgPCAwKSB7CiAgICAgIGVuZCArPSBsZW5ndGg7CiAgICB9CiAgICBsZW5ndGggPSBzdGFydCA+IGVuZCA/IDAgOiAoKGVuZCAtIHN0YXJ0KSA+Pj4gMCk7CiAgICBzdGFydCA+Pj49IDA7CgogICAgdmFyIHJlc3VsdCA9IEFycmF5KGxlbmd0aCk7CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICByZXN1bHRbaW5kZXhdID0gYXJyYXlbaW5kZXggKyBzdGFydF07CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uc29ydGVkSW5kZXhgIGFuZCBgXy5zb3J0ZWRMYXN0SW5kZXhgIHdoaWNoCiAgICogcGVyZm9ybXMgYSBiaW5hcnkgc2VhcmNoIG9mIGBhcnJheWAgdG8gZGV0ZXJtaW5lIHRoZSBpbmRleCBhdCB3aGljaCBgdmFsdWVgCiAgICogc2hvdWxkIGJlIGluc2VydGVkIGludG8gYGFycmF5YCBpbiBvcmRlciB0byBtYWludGFpbiBpdHMgc29ydCBvcmRlci4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIHNvcnRlZCBhcnJheSB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGV2YWx1YXRlLgogICAqIEBwYXJhbSB7Ym9vbGVhbn0gW3JldEhpZ2hlc3RdIFNwZWNpZnkgcmV0dXJuaW5nIHRoZSBoaWdoZXN0IHF1YWxpZmllZCBpbmRleC4KICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBhdCB3aGljaCBgdmFsdWVgIHNob3VsZCBiZSBpbnNlcnRlZAogICAqICBpbnRvIGBhcnJheWAuCiAgICovCiAgZnVuY3Rpb24gYmFzZVNvcnRlZEluZGV4KGFycmF5LCB2YWx1ZSwgcmV0SGlnaGVzdCkgewogICAgdmFyIGxvdyA9IDAsCiAgICAgICAgaGlnaCA9IGFycmF5ID09IG51bGwgPyBsb3cgOiBhcnJheS5sZW5ndGg7CgogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyAmJiB2YWx1ZSA9PT0gdmFsdWUgJiYgaGlnaCA8PSBIQUxGX01BWF9BUlJBWV9MRU5HVEgpIHsKICAgICAgd2hpbGUgKGxvdyA8IGhpZ2gpIHsKICAgICAgICB2YXIgbWlkID0gKGxvdyArIGhpZ2gpID4+PiAxLAogICAgICAgICAgICBjb21wdXRlZCA9IGFycmF5W21pZF07CgogICAgICAgIGlmIChjb21wdXRlZCAhPT0gbnVsbCAmJiAhaXNTeW1ib2woY29tcHV0ZWQpICYmCiAgICAgICAgICAgIChyZXRIaWdoZXN0ID8gKGNvbXB1dGVkIDw9IHZhbHVlKSA6IChjb21wdXRlZCA8IHZhbHVlKSkpIHsKICAgICAgICAgIGxvdyA9IG1pZCArIDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGhpZ2ggPSBtaWQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBoaWdoOwogICAgfQogICAgcmV0dXJuIGJhc2VTb3J0ZWRJbmRleEJ5KGFycmF5LCB2YWx1ZSwgaWRlbnRpdHksIHJldEhpZ2hlc3QpOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uc29ydGVkSW5kZXhCeWAgYW5kIGBfLnNvcnRlZExhc3RJbmRleEJ5YAogICAqIHdoaWNoIGludm9rZXMgYGl0ZXJhdGVlYCBmb3IgYHZhbHVlYCBhbmQgZWFjaCBlbGVtZW50IG9mIGBhcnJheWAgdG8gY29tcHV0ZQogICAqIHRoZWlyIHNvcnQgcmFua2luZy4gVGhlIGl0ZXJhdGVlIGlzIGludm9rZWQgd2l0aCBvbmUgYXJndW1lbnQ7ICh2YWx1ZSkuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBzb3J0ZWQgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBldmFsdWF0ZS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtyZXRIaWdoZXN0XSBTcGVjaWZ5IHJldHVybmluZyB0aGUgaGlnaGVzdCBxdWFsaWZpZWQgaW5kZXguCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggYXQgd2hpY2ggYHZhbHVlYCBzaG91bGQgYmUgaW5zZXJ0ZWQKICAgKiAgaW50byBgYXJyYXlgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VTb3J0ZWRJbmRleEJ5KGFycmF5LCB2YWx1ZSwgaXRlcmF0ZWUsIHJldEhpZ2hlc3QpIHsKICAgIHZhbHVlID0gaXRlcmF0ZWUodmFsdWUpOwoKICAgIHZhciBsb3cgPSAwLAogICAgICAgIGhpZ2ggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aCwKICAgICAgICB2YWxJc05hTiA9IHZhbHVlICE9PSB2YWx1ZSwKICAgICAgICB2YWxJc051bGwgPSB2YWx1ZSA9PT0gbnVsbCwKICAgICAgICB2YWxJc1N5bWJvbCA9IGlzU3ltYm9sKHZhbHVlKSwKICAgICAgICB2YWxJc1VuZGVmaW5lZCA9IHZhbHVlID09PSB1bmRlZmluZWQ7CgogICAgd2hpbGUgKGxvdyA8IGhpZ2gpIHsKICAgICAgdmFyIG1pZCA9IG5hdGl2ZUZsb29yKChsb3cgKyBoaWdoKSAvIDIpLAogICAgICAgICAgY29tcHV0ZWQgPSBpdGVyYXRlZShhcnJheVttaWRdKSwKICAgICAgICAgIG90aElzRGVmaW5lZCA9IGNvbXB1dGVkICE9PSB1bmRlZmluZWQsCiAgICAgICAgICBvdGhJc051bGwgPSBjb21wdXRlZCA9PT0gbnVsbCwKICAgICAgICAgIG90aElzUmVmbGV4aXZlID0gY29tcHV0ZWQgPT09IGNvbXB1dGVkLAogICAgICAgICAgb3RoSXNTeW1ib2wgPSBpc1N5bWJvbChjb21wdXRlZCk7CgogICAgICBpZiAodmFsSXNOYU4pIHsKICAgICAgICB2YXIgc2V0TG93ID0gcmV0SGlnaGVzdCB8fCBvdGhJc1JlZmxleGl2ZTsKICAgICAgfSBlbHNlIGlmICh2YWxJc1VuZGVmaW5lZCkgewogICAgICAgIHNldExvdyA9IG90aElzUmVmbGV4aXZlICYmIChyZXRIaWdoZXN0IHx8IG90aElzRGVmaW5lZCk7CiAgICAgIH0gZWxzZSBpZiAodmFsSXNOdWxsKSB7CiAgICAgICAgc2V0TG93ID0gb3RoSXNSZWZsZXhpdmUgJiYgb3RoSXNEZWZpbmVkICYmIChyZXRIaWdoZXN0IHx8ICFvdGhJc051bGwpOwogICAgICB9IGVsc2UgaWYgKHZhbElzU3ltYm9sKSB7CiAgICAgICAgc2V0TG93ID0gb3RoSXNSZWZsZXhpdmUgJiYgb3RoSXNEZWZpbmVkICYmICFvdGhJc051bGwgJiYgKHJldEhpZ2hlc3QgfHwgIW90aElzU3ltYm9sKTsKICAgICAgfSBlbHNlIGlmIChvdGhJc051bGwgfHwgb3RoSXNTeW1ib2wpIHsKICAgICAgICBzZXRMb3cgPSBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZXRMb3cgPSByZXRIaWdoZXN0ID8gKGNvbXB1dGVkIDw9IHZhbHVlKSA6IChjb21wdXRlZCA8IHZhbHVlKTsKICAgICAgfQogICAgICBpZiAoc2V0TG93KSB7CiAgICAgICAgbG93ID0gbWlkICsgMTsKICAgICAgfSBlbHNlIHsKICAgICAgICBoaWdoID0gbWlkOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbmF0aXZlTWluKGhpZ2gsIE1BWF9BUlJBWV9JTkRFWCk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5zb3J0ZWRVbmlxYCBhbmQgYF8uc29ydGVkVW5pcUJ5YCB3aXRob3V0CiAgICogc3VwcG9ydCBmb3IgaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlXSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBkdXBsaWNhdGUgZnJlZSBhcnJheS4KICAgKi8KICBmdW5jdGlvbiBiYXNlU29ydGVkVW5pcShhcnJheSwgaXRlcmF0ZWUpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IGFycmF5Lmxlbmd0aCwKICAgICAgICByZXNJbmRleCA9IDAsCiAgICAgICAgcmVzdWx0ID0gW107CgogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgdmFyIHZhbHVlID0gYXJyYXlbaW5kZXhdLAogICAgICAgICAgY29tcHV0ZWQgPSBpdGVyYXRlZSA/IGl0ZXJhdGVlKHZhbHVlKSA6IHZhbHVlOwoKICAgICAgaWYgKCFpbmRleCB8fCAhZXEoY29tcHV0ZWQsIHNlZW4pKSB7CiAgICAgICAgdmFyIHNlZW4gPSBjb21wdXRlZDsKICAgICAgICByZXN1bHRbcmVzSW5kZXgrK10gPSB2YWx1ZSA9PT0gMCA/IDAgOiB2YWx1ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnRvU3RyaW5nYCB3aGljaCBkb2Vzbid0IGNvbnZlcnQgbnVsbGlzaAogICAqIHZhbHVlcyB0byBlbXB0eSBzdHJpbmdzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBwcm9jZXNzLgogICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIHN0cmluZy4KICAgKi8KICBmdW5jdGlvbiBiYXNlVG9TdHJpbmcodmFsdWUpIHsKICAgIC8vIEV4aXQgZWFybHkgZm9yIHN0cmluZ3MgdG8gYXZvaWQgYSBwZXJmb3JtYW5jZSBoaXQgaW4gc29tZSBlbnZpcm9ubWVudHMuCiAgICBpZiAodHlwZW9mIHZhbHVlID09ICdzdHJpbmcnKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIGlmIChpc0FycmF5KHZhbHVlKSkgewogICAgICAvLyBSZWN1cnNpdmVseSBjb252ZXJ0IHZhbHVlcyAoc3VzY2VwdGlibGUgdG8gY2FsbCBzdGFjayBsaW1pdHMpLgogICAgICByZXR1cm4gYXJyYXlNYXAodmFsdWUsIGJhc2VUb1N0cmluZykgKyAnJzsKICAgIH0KICAgIGlmIChpc1N5bWJvbCh2YWx1ZSkpIHsKICAgICAgcmV0dXJuIHN5bWJvbFRvU3RyaW5nID8gc3ltYm9sVG9TdHJpbmcuY2FsbCh2YWx1ZSkgOiAnJzsKICAgIH0KICAgIHZhciByZXN1bHQgPSAodmFsdWUgKyAnJyk7CiAgICByZXR1cm4gKHJlc3VsdCA9PSAnMCcgJiYgKDEgLyB2YWx1ZSkgPT0gLUlORklOSVRZKSA/ICctMCcgOiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy51bmlxQnlgIHdpdGhvdXQgc3VwcG9ydCBmb3IgaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlXSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY29tcGFyYXRvcl0gVGhlIGNvbXBhcmF0b3IgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBkdXBsaWNhdGUgZnJlZSBhcnJheS4KICAgKi8KICBmdW5jdGlvbiBiYXNlVW5pcShhcnJheSwgaXRlcmF0ZWUsIGNvbXBhcmF0b3IpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGluY2x1ZGVzID0gYXJyYXlJbmNsdWRlcywKICAgICAgICBsZW5ndGggPSBhcnJheS5sZW5ndGgsCiAgICAgICAgaXNDb21tb24gPSB0cnVlLAogICAgICAgIHJlc3VsdCA9IFtdLAogICAgICAgIHNlZW4gPSByZXN1bHQ7CgogICAgaWYgKGNvbXBhcmF0b3IpIHsKICAgICAgaXNDb21tb24gPSBmYWxzZTsKICAgICAgaW5jbHVkZXMgPSBhcnJheUluY2x1ZGVzV2l0aDsKICAgIH0KICAgIGVsc2UgaWYgKGxlbmd0aCA+PSBMQVJHRV9BUlJBWV9TSVpFKSB7CiAgICAgIHZhciBzZXQgPSBpdGVyYXRlZSA/IG51bGwgOiBjcmVhdGVTZXQoYXJyYXkpOwogICAgICBpZiAoc2V0KSB7CiAgICAgICAgcmV0dXJuIHNldFRvQXJyYXkoc2V0KTsKICAgICAgfQogICAgICBpc0NvbW1vbiA9IGZhbHNlOwogICAgICBpbmNsdWRlcyA9IGNhY2hlSGFzOwogICAgICBzZWVuID0gbmV3IFNldENhY2hlOwogICAgfQogICAgZWxzZSB7CiAgICAgIHNlZW4gPSBpdGVyYXRlZSA/IFtdIDogcmVzdWx0OwogICAgfQogICAgb3V0ZXI6CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICB2YXIgdmFsdWUgPSBhcnJheVtpbmRleF0sCiAgICAgICAgICBjb21wdXRlZCA9IGl0ZXJhdGVlID8gaXRlcmF0ZWUodmFsdWUpIDogdmFsdWU7CgogICAgICB2YWx1ZSA9IChjb21wYXJhdG9yIHx8IHZhbHVlICE9PSAwKSA/IHZhbHVlIDogMDsKICAgICAgaWYgKGlzQ29tbW9uICYmIGNvbXB1dGVkID09PSBjb21wdXRlZCkgewogICAgICAgIHZhciBzZWVuSW5kZXggPSBzZWVuLmxlbmd0aDsKICAgICAgICB3aGlsZSAoc2VlbkluZGV4LS0pIHsKICAgICAgICAgIGlmIChzZWVuW3NlZW5JbmRleF0gPT09IGNvbXB1dGVkKSB7CiAgICAgICAgICAgIGNvbnRpbnVlIG91dGVyOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoaXRlcmF0ZWUpIHsKICAgICAgICAgIHNlZW4ucHVzaChjb21wdXRlZCk7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlKTsKICAgICAgfQogICAgICBlbHNlIGlmICghaW5jbHVkZXMoc2VlbiwgY29tcHV0ZWQsIGNvbXBhcmF0b3IpKSB7CiAgICAgICAgaWYgKHNlZW4gIT09IHJlc3VsdCkgewogICAgICAgICAgc2Vlbi5wdXNoKGNvbXB1dGVkKTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8udW5zZXRgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gbW9kaWZ5LgogICAqIEBwYXJhbSB7QXJyYXl8c3RyaW5nfSBwYXRoIFRoZSBwcm9wZXJ0eSBwYXRoIHRvIHVuc2V0LgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgcHJvcGVydHkgaXMgZGVsZXRlZCwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VVbnNldChvYmplY3QsIHBhdGgpIHsKICAgIHBhdGggPSBjYXN0UGF0aChwYXRoLCBvYmplY3QpOwogICAgb2JqZWN0ID0gcGFyZW50KG9iamVjdCwgcGF0aCk7CiAgICByZXR1cm4gb2JqZWN0ID09IG51bGwgfHwgZGVsZXRlIG9iamVjdFt0b0tleShsYXN0KHBhdGgpKV07CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBtZXRob2RzIGxpa2UgYF8uZHJvcFdoaWxlYCBhbmQgYF8udGFrZVdoaWxlYAogICAqIHdpdGhvdXQgc3VwcG9ydCBmb3IgaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWRpY2F0ZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzRHJvcF0gU3BlY2lmeSBkcm9wcGluZyBlbGVtZW50cyBpbnN0ZWFkIG9mIHRha2luZyB0aGVtLgogICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2Zyb21SaWdodF0gU3BlY2lmeSBpdGVyYXRpbmcgZnJvbSByaWdodCB0byBsZWZ0LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgc2xpY2Ugb2YgYGFycmF5YC4KICAgKi8KICBmdW5jdGlvbiBiYXNlV2hpbGUoYXJyYXksIHByZWRpY2F0ZSwgaXNEcm9wLCBmcm9tUmlnaHQpIHsKICAgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGgsCiAgICAgICAgaW5kZXggPSBmcm9tUmlnaHQgPyBsZW5ndGggOiAtMTsKCiAgICB3aGlsZSAoKGZyb21SaWdodCA/IGluZGV4LS0gOiArK2luZGV4IDwgbGVuZ3RoKSAmJgogICAgICBwcmVkaWNhdGUoYXJyYXlbaW5kZXhdLCBpbmRleCwgYXJyYXkpKSB7fQoKICAgIHJldHVybiBpc0Ryb3AKICAgICAgPyBiYXNlU2xpY2UoYXJyYXksIChmcm9tUmlnaHQgPyAwIDogaW5kZXgpLCAoZnJvbVJpZ2h0ID8gaW5kZXggKyAxIDogbGVuZ3RoKSkKICAgICAgOiBiYXNlU2xpY2UoYXJyYXksIChmcm9tUmlnaHQgPyBpbmRleCArIDEgOiAwKSwgKGZyb21SaWdodCA/IGxlbmd0aCA6IGluZGV4KSk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBtZXRob2RzIGxpa2UgYF8ueG9yYCwgd2l0aG91dCBzdXBwb3J0IGZvcgogICAqIGl0ZXJhdGVlIHNob3J0aGFuZHMsIHRoYXQgYWNjZXB0cyBhbiBhcnJheSBvZiBhcnJheXMgdG8gaW5zcGVjdC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXlzIFRoZSBhcnJheXMgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWVdIFRoZSBpdGVyYXRlZSBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjb21wYXJhdG9yXSBUaGUgY29tcGFyYXRvciBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIHZhbHVlcy4KICAgKi8KICBmdW5jdGlvbiBiYXNlWG9yKGFycmF5cywgaXRlcmF0ZWUsIGNvbXBhcmF0b3IpIHsKICAgIHZhciBsZW5ndGggPSBhcnJheXMubGVuZ3RoOwogICAgaWYgKGxlbmd0aCA8IDIpIHsKICAgICAgcmV0dXJuIGxlbmd0aCA/IGJhc2VVbmlxKGFycmF5c1swXSkgOiBbXTsKICAgIH0KICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIHJlc3VsdCA9IEFycmF5KGxlbmd0aCk7CgogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgdmFyIGFycmF5ID0gYXJyYXlzW2luZGV4XSwKICAgICAgICAgIG90aEluZGV4ID0gLTE7CgogICAgICB3aGlsZSAoKytvdGhJbmRleCA8IGxlbmd0aCkgewogICAgICAgIGlmIChvdGhJbmRleCAhPSBpbmRleCkgewogICAgICAgICAgcmVzdWx0W2luZGV4XSA9IGJhc2VEaWZmZXJlbmNlKHJlc3VsdFtpbmRleF0gfHwgYXJyYXksIGFycmF5c1tvdGhJbmRleF0sIGl0ZXJhdGVlLCBjb21wYXJhdG9yKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBiYXNlVW5pcShiYXNlRmxhdHRlbihyZXN1bHQsIDEpLCBpdGVyYXRlZSwgY29tcGFyYXRvcik7CiAgfQoKICAvKioKICAgKiBUaGlzIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uemlwT2JqZWN0YCB3aGljaCBhc3NpZ25zIHZhbHVlcyB1c2luZyBgYXNzaWduRnVuY2AuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IHByb3BzIFRoZSBwcm9wZXJ0eSBpZGVudGlmaWVycy4KICAgKiBAcGFyYW0ge0FycmF5fSB2YWx1ZXMgVGhlIHByb3BlcnR5IHZhbHVlcy4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBhc3NpZ25GdW5jIFRoZSBmdW5jdGlvbiB0byBhc3NpZ24gdmFsdWVzLgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyBvYmplY3QuCiAgICovCiAgZnVuY3Rpb24gYmFzZVppcE9iamVjdChwcm9wcywgdmFsdWVzLCBhc3NpZ25GdW5jKSB7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICBsZW5ndGggPSBwcm9wcy5sZW5ndGgsCiAgICAgICAgdmFsc0xlbmd0aCA9IHZhbHVlcy5sZW5ndGgsCiAgICAgICAgcmVzdWx0ID0ge307CgogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgdmFyIHZhbHVlID0gaW5kZXggPCB2YWxzTGVuZ3RoID8gdmFsdWVzW2luZGV4XSA6IHVuZGVmaW5lZDsKICAgICAgYXNzaWduRnVuYyhyZXN1bHQsIHByb3BzW2luZGV4XSwgdmFsdWUpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIENhc3RzIGB2YWx1ZWAgdG8gYW4gZW1wdHkgYXJyYXkgaWYgaXQncyBub3QgYW4gYXJyYXkgbGlrZSBvYmplY3QuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGluc3BlY3QuCiAgICogQHJldHVybnMge0FycmF5fE9iamVjdH0gUmV0dXJucyB0aGUgY2FzdCBhcnJheS1saWtlIG9iamVjdC4KICAgKi8KICBmdW5jdGlvbiBjYXN0QXJyYXlMaWtlT2JqZWN0KHZhbHVlKSB7CiAgICByZXR1cm4gaXNBcnJheUxpa2VPYmplY3QodmFsdWUpID8gdmFsdWUgOiBbXTsKICB9CgogIC8qKgogICAqIENhc3RzIGB2YWx1ZWAgdG8gYSBwYXRoIGFycmF5IGlmIGl0J3Mgbm90IG9uZS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0ge09iamVjdH0gW29iamVjdF0gVGhlIG9iamVjdCB0byBxdWVyeSBrZXlzIG9uLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgY2FzdCBwcm9wZXJ0eSBwYXRoIGFycmF5LgogICAqLwogIGZ1bmN0aW9uIGNhc3RQYXRoKHZhbHVlLCBvYmplY3QpIHsKICAgIGlmIChpc0FycmF5KHZhbHVlKSkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICByZXR1cm4gaXNLZXkodmFsdWUsIG9iamVjdCkgPyBbdmFsdWVdIDogc3RyaW5nVG9QYXRoKHRvU3RyaW5nKHZhbHVlKSk7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgY2xvbmUgb2YgIGBidWZmZXJgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0J1ZmZlcn0gYnVmZmVyIFRoZSBidWZmZXIgdG8gY2xvbmUuCiAgICogQHBhcmFtIHtib29sZWFufSBbaXNEZWVwXSBTcGVjaWZ5IGEgZGVlcCBjbG9uZS4KICAgKiBAcmV0dXJucyB7QnVmZmVyfSBSZXR1cm5zIHRoZSBjbG9uZWQgYnVmZmVyLgogICAqLwogIGZ1bmN0aW9uIGNsb25lQnVmZmVyKGJ1ZmZlciwgaXNEZWVwKSB7CiAgICBpZiAoaXNEZWVwKSB7CiAgICAgIHJldHVybiBidWZmZXIuc2xpY2UoKTsKICAgIH0KICAgIHZhciBsZW5ndGggPSBidWZmZXIubGVuZ3RoLAogICAgICAgIHJlc3VsdCA9IGFsbG9jVW5zYWZlID8gYWxsb2NVbnNhZmUobGVuZ3RoKSA6IG5ldyBidWZmZXIuY29uc3RydWN0b3IobGVuZ3RoKTsKCiAgICBidWZmZXIuY29weShyZXN1bHQpOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBjbG9uZSBvZiBgYXJyYXlCdWZmZXJgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0FycmF5QnVmZmVyfSBhcnJheUJ1ZmZlciBUaGUgYXJyYXkgYnVmZmVyIHRvIGNsb25lLgogICAqIEByZXR1cm5zIHtBcnJheUJ1ZmZlcn0gUmV0dXJucyB0aGUgY2xvbmVkIGFycmF5IGJ1ZmZlci4KICAgKi8KICBmdW5jdGlvbiBjbG9uZUFycmF5QnVmZmVyKGFycmF5QnVmZmVyKSB7CiAgICB2YXIgcmVzdWx0ID0gbmV3IGFycmF5QnVmZmVyLmNvbnN0cnVjdG9yKGFycmF5QnVmZmVyLmJ5dGVMZW5ndGgpOwogICAgbmV3IFVpbnQ4QXJyYXkocmVzdWx0KS5zZXQobmV3IFVpbnQ4QXJyYXkoYXJyYXlCdWZmZXIpKTsKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgY2xvbmUgb2YgYGRhdGFWaWV3YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFWaWV3IFRoZSBkYXRhIHZpZXcgdG8gY2xvbmUuCiAgICogQHBhcmFtIHtib29sZWFufSBbaXNEZWVwXSBTcGVjaWZ5IGEgZGVlcCBjbG9uZS4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjbG9uZWQgZGF0YSB2aWV3LgogICAqLwogIGZ1bmN0aW9uIGNsb25lRGF0YVZpZXcoZGF0YVZpZXcsIGlzRGVlcCkgewogICAgdmFyIGJ1ZmZlciA9IGlzRGVlcCA/IGNsb25lQXJyYXlCdWZmZXIoZGF0YVZpZXcuYnVmZmVyKSA6IGRhdGFWaWV3LmJ1ZmZlcjsKICAgIHJldHVybiBuZXcgZGF0YVZpZXcuY29uc3RydWN0b3IoYnVmZmVyLCBkYXRhVmlldy5ieXRlT2Zmc2V0LCBkYXRhVmlldy5ieXRlTGVuZ3RoKTsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBjbG9uZSBvZiBgbWFwYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG1hcCBUaGUgbWFwIHRvIGNsb25lLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGNsb25lRnVuYyBUaGUgZnVuY3Rpb24gdG8gY2xvbmUgdmFsdWVzLgogICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzRGVlcF0gU3BlY2lmeSBhIGRlZXAgY2xvbmUuCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY2xvbmVkIG1hcC4KICAgKi8KICBmdW5jdGlvbiBjbG9uZU1hcChtYXAsIGlzRGVlcCwgY2xvbmVGdW5jKSB7CiAgICB2YXIgYXJyYXkgPSBpc0RlZXAgPyBjbG9uZUZ1bmMobWFwVG9BcnJheShtYXApLCBDTE9ORV9ERUVQX0ZMQUcpIDogbWFwVG9BcnJheShtYXApOwogICAgcmV0dXJuIGFycmF5UmVkdWNlKGFycmF5LCBhZGRNYXBFbnRyeSwgbmV3IG1hcC5jb25zdHJ1Y3Rvcik7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgY2xvbmUgb2YgYHJlZ2V4cGAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSByZWdleHAgVGhlIHJlZ2V4cCB0byBjbG9uZS4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjbG9uZWQgcmVnZXhwLgogICAqLwogIGZ1bmN0aW9uIGNsb25lUmVnRXhwKHJlZ2V4cCkgewogICAgdmFyIHJlc3VsdCA9IG5ldyByZWdleHAuY29uc3RydWN0b3IocmVnZXhwLnNvdXJjZSwgcmVGbGFncy5leGVjKHJlZ2V4cCkpOwogICAgcmVzdWx0Lmxhc3RJbmRleCA9IHJlZ2V4cC5sYXN0SW5kZXg7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhIGNsb25lIG9mIGBzZXRgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gc2V0IFRoZSBzZXQgdG8gY2xvbmUuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2xvbmVGdW5jIFRoZSBmdW5jdGlvbiB0byBjbG9uZSB2YWx1ZXMuCiAgICogQHBhcmFtIHtib29sZWFufSBbaXNEZWVwXSBTcGVjaWZ5IGEgZGVlcCBjbG9uZS4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjbG9uZWQgc2V0LgogICAqLwogIGZ1bmN0aW9uIGNsb25lU2V0KHNldCwgaXNEZWVwLCBjbG9uZUZ1bmMpIHsKICAgIHZhciBhcnJheSA9IGlzRGVlcCA/IGNsb25lRnVuYyhzZXRUb0FycmF5KHNldCksIENMT05FX0RFRVBfRkxBRykgOiBzZXRUb0FycmF5KHNldCk7CiAgICByZXR1cm4gYXJyYXlSZWR1Y2UoYXJyYXksIGFkZFNldEVudHJ5LCBuZXcgc2V0LmNvbnN0cnVjdG9yKTsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBjbG9uZSBvZiB0aGUgYHN5bWJvbGAgb2JqZWN0LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gc3ltYm9sIFRoZSBzeW1ib2wgb2JqZWN0IHRvIGNsb25lLgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGNsb25lZCBzeW1ib2wgb2JqZWN0LgogICAqLwogIGZ1bmN0aW9uIGNsb25lU3ltYm9sKHN5bWJvbCkgewogICAgcmV0dXJuIHN5bWJvbFZhbHVlT2YgPyBPYmplY3Qoc3ltYm9sVmFsdWVPZi5jYWxsKHN5bWJvbCkpIDoge307CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgY2xvbmUgb2YgYHR5cGVkQXJyYXlgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gdHlwZWRBcnJheSBUaGUgdHlwZWQgYXJyYXkgdG8gY2xvbmUuCiAgICogQHBhcmFtIHtib29sZWFufSBbaXNEZWVwXSBTcGVjaWZ5IGEgZGVlcCBjbG9uZS4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjbG9uZWQgdHlwZWQgYXJyYXkuCiAgICovCiAgZnVuY3Rpb24gY2xvbmVUeXBlZEFycmF5KHR5cGVkQXJyYXksIGlzRGVlcCkgewogICAgdmFyIGJ1ZmZlciA9IGlzRGVlcCA/IGNsb25lQXJyYXlCdWZmZXIodHlwZWRBcnJheS5idWZmZXIpIDogdHlwZWRBcnJheS5idWZmZXI7CiAgICByZXR1cm4gbmV3IHR5cGVkQXJyYXkuY29uc3RydWN0b3IoYnVmZmVyLCB0eXBlZEFycmF5LmJ5dGVPZmZzZXQsIHR5cGVkQXJyYXkubGVuZ3RoKTsKICB9CgogIC8qKgogICAqIENvbXBhcmVzIHZhbHVlcyB0byBzb3J0IHRoZW0gaW4gYXNjZW5kaW5nIG9yZGVyLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb21wYXJlLgogICAqIEBwYXJhbSB7Kn0gb3RoZXIgVGhlIG90aGVyIHZhbHVlIHRvIGNvbXBhcmUuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgc29ydCBvcmRlciBpbmRpY2F0b3IgZm9yIGB2YWx1ZWAuCiAgICovCiAgZnVuY3Rpb24gY29tcGFyZUFzY2VuZGluZyh2YWx1ZSwgb3RoZXIpIHsKICAgIGlmICh2YWx1ZSAhPT0gb3RoZXIpIHsKICAgICAgdmFyIHZhbElzRGVmaW5lZCA9IHZhbHVlICE9PSB1bmRlZmluZWQsCiAgICAgICAgICB2YWxJc051bGwgPSB2YWx1ZSA9PT0gbnVsbCwKICAgICAgICAgIHZhbElzUmVmbGV4aXZlID0gdmFsdWUgPT09IHZhbHVlLAogICAgICAgICAgdmFsSXNTeW1ib2wgPSBpc1N5bWJvbCh2YWx1ZSk7CgogICAgICB2YXIgb3RoSXNEZWZpbmVkID0gb3RoZXIgIT09IHVuZGVmaW5lZCwKICAgICAgICAgIG90aElzTnVsbCA9IG90aGVyID09PSBudWxsLAogICAgICAgICAgb3RoSXNSZWZsZXhpdmUgPSBvdGhlciA9PT0gb3RoZXIsCiAgICAgICAgICBvdGhJc1N5bWJvbCA9IGlzU3ltYm9sKG90aGVyKTsKCiAgICAgIGlmICgoIW90aElzTnVsbCAmJiAhb3RoSXNTeW1ib2wgJiYgIXZhbElzU3ltYm9sICYmIHZhbHVlID4gb3RoZXIpIHx8CiAgICAgICAgICAodmFsSXNTeW1ib2wgJiYgb3RoSXNEZWZpbmVkICYmIG90aElzUmVmbGV4aXZlICYmICFvdGhJc051bGwgJiYgIW90aElzU3ltYm9sKSB8fAogICAgICAgICAgKHZhbElzTnVsbCAmJiBvdGhJc0RlZmluZWQgJiYgb3RoSXNSZWZsZXhpdmUpIHx8CiAgICAgICAgICAoIXZhbElzRGVmaW5lZCAmJiBvdGhJc1JlZmxleGl2ZSkgfHwKICAgICAgICAgICF2YWxJc1JlZmxleGl2ZSkgewogICAgICAgIHJldHVybiAxOwogICAgICB9CiAgICAgIGlmICgoIXZhbElzTnVsbCAmJiAhdmFsSXNTeW1ib2wgJiYgIW90aElzU3ltYm9sICYmIHZhbHVlIDwgb3RoZXIpIHx8CiAgICAgICAgICAob3RoSXNTeW1ib2wgJiYgdmFsSXNEZWZpbmVkICYmIHZhbElzUmVmbGV4aXZlICYmICF2YWxJc051bGwgJiYgIXZhbElzU3ltYm9sKSB8fAogICAgICAgICAgKG90aElzTnVsbCAmJiB2YWxJc0RlZmluZWQgJiYgdmFsSXNSZWZsZXhpdmUpIHx8CiAgICAgICAgICAoIW90aElzRGVmaW5lZCAmJiB2YWxJc1JlZmxleGl2ZSkgfHwKICAgICAgICAgICFvdGhJc1JlZmxleGl2ZSkgewogICAgICAgIHJldHVybiAtMTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIDA7CiAgfQoKICAvKioKICAgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiBgc291cmNlYCB0byBgYXJyYXlgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0FycmF5fSBzb3VyY2UgVGhlIGFycmF5IHRvIGNvcHkgdmFsdWVzIGZyb20uCiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5PVtdXSBUaGUgYXJyYXkgdG8gY29weSB2YWx1ZXMgdG8uCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGBhcnJheWAuCiAgICovCiAgZnVuY3Rpb24gY29weUFycmF5KHNvdXJjZSwgYXJyYXkpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IHNvdXJjZS5sZW5ndGg7CgogICAgYXJyYXkgfHwgKGFycmF5ID0gQXJyYXkobGVuZ3RoKSk7CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICBhcnJheVtpbmRleF0gPSBzb3VyY2VbaW5kZXhdOwogICAgfQogICAgcmV0dXJuIGFycmF5OwogIH0KCiAgLyoqCiAgICogQ29waWVzIHByb3BlcnRpZXMgb2YgYHNvdXJjZWAgdG8gYG9iamVjdGAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBzb3VyY2UgVGhlIG9iamVjdCB0byBjb3B5IHByb3BlcnRpZXMgZnJvbS4KICAgKiBAcGFyYW0ge0FycmF5fSBwcm9wcyBUaGUgcHJvcGVydHkgaWRlbnRpZmllcnMgdG8gY29weS4KICAgKiBAcGFyYW0ge09iamVjdH0gW29iamVjdD17fV0gVGhlIG9iamVjdCB0byBjb3B5IHByb3BlcnRpZXMgdG8uCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2N1c3RvbWl6ZXJdIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgY29waWVkIHZhbHVlcy4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLgogICAqLwogIGZ1bmN0aW9uIGNvcHlPYmplY3Qoc291cmNlLCBwcm9wcywgb2JqZWN0LCBjdXN0b21pemVyKSB7CiAgICB2YXIgaXNOZXcgPSAhb2JqZWN0OwogICAgb2JqZWN0IHx8IChvYmplY3QgPSB7fSk7CgogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gcHJvcHMubGVuZ3RoOwoKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHZhciBrZXkgPSBwcm9wc1tpbmRleF07CgogICAgICB2YXIgbmV3VmFsdWUgPSBjdXN0b21pemVyCiAgICAgICAgPyBjdXN0b21pemVyKG9iamVjdFtrZXldLCBzb3VyY2Vba2V5XSwga2V5LCBvYmplY3QsIHNvdXJjZSkKICAgICAgICA6IHVuZGVmaW5lZDsKCiAgICAgIGlmIChuZXdWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbmV3VmFsdWUgPSBzb3VyY2Vba2V5XTsKICAgICAgfQogICAgICBpZiAoaXNOZXcpIHsKICAgICAgICBiYXNlQXNzaWduVmFsdWUob2JqZWN0LCBrZXksIG5ld1ZhbHVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhc3NpZ25WYWx1ZShvYmplY3QsIGtleSwgbmV3VmFsdWUpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gb2JqZWN0OwogIH0KCiAgLyoqCiAgICogQ29waWVzIG93biBzeW1ib2xzIG9mIGBzb3VyY2VgIHRvIGBvYmplY3RgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFRoZSBvYmplY3QgdG8gY29weSBzeW1ib2xzIGZyb20uCiAgICogQHBhcmFtIHtPYmplY3R9IFtvYmplY3Q9e31dIFRoZSBvYmplY3QgdG8gY29weSBzeW1ib2xzIHRvLgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuCiAgICovCiAgZnVuY3Rpb24gY29weVN5bWJvbHMoc291cmNlLCBvYmplY3QpIHsKICAgIHJldHVybiBjb3B5T2JqZWN0KHNvdXJjZSwgZ2V0U3ltYm9scyhzb3VyY2UpLCBvYmplY3QpOwogIH0KCiAgLyoqCiAgICogQ29waWVzIG93biBhbmQgaW5oZXJpdGVkIHN5bWJvbHMgb2YgYHNvdXJjZWAgdG8gYG9iamVjdGAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBzb3VyY2UgVGhlIG9iamVjdCB0byBjb3B5IHN5bWJvbHMgZnJvbS4KICAgKiBAcGFyYW0ge09iamVjdH0gW29iamVjdD17fV0gVGhlIG9iamVjdCB0byBjb3B5IHN5bWJvbHMgdG8uCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgb2JqZWN0YC4KICAgKi8KICBmdW5jdGlvbiBjb3B5U3ltYm9sc0luKHNvdXJjZSwgb2JqZWN0KSB7CiAgICByZXR1cm4gY29weU9iamVjdChzb3VyY2UsIGdldFN5bWJvbHNJbihzb3VyY2UpLCBvYmplY3QpOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgcGVyZm9ybXMgYSByZWxhdGlvbmFsIG9wZXJhdGlvbiBvbiB0d28gdmFsdWVzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvcGVyYXRvciBUaGUgZnVuY3Rpb24gdG8gcGVyZm9ybSB0aGUgb3BlcmF0aW9uLgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IHJlbGF0aW9uYWwgb3BlcmF0aW9uIGZ1bmN0aW9uLgogICAqLwogIGZ1bmN0aW9uIGNyZWF0ZVJlbGF0aW9uYWxPcGVyYXRpb24ob3BlcmF0b3IpIHsKICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSwgb3RoZXIpIHsKICAgICAgaWYgKCEodHlwZW9mIHZhbHVlID09ICdzdHJpbmcnICYmIHR5cGVvZiBvdGhlciA9PSAnc3RyaW5nJykpIHsKICAgICAgICB2YWx1ZSA9IHRvTnVtYmVyKHZhbHVlKTsKICAgICAgICBvdGhlciA9IHRvTnVtYmVyKG90aGVyKTsKICAgICAgfQogICAgICByZXR1cm4gb3BlcmF0b3IodmFsdWUsIG90aGVyKTsKICAgIH07CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgc2V0IG9iamVjdCBvZiBgdmFsdWVzYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gdmFsdWVzIFRoZSB2YWx1ZXMgdG8gYWRkIHRvIHRoZSBzZXQuCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbmV3IHNldC4KICAgKi8KICB2YXIgY3JlYXRlU2V0ID0gIShTZXQgJiYgKDEgLyBzZXRUb0FycmF5KG5ldyBTZXQoWywtMF0pKVsxXSkgPT0gSU5GSU5JVFkpID8gbm9vcCA6IGZ1bmN0aW9uKHZhbHVlcykgewogICAgcmV0dXJuIG5ldyBTZXQodmFsdWVzKTsKICB9OwoKICAvKioKICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYGJhc2VJc0VxdWFsRGVlcGAgZm9yIGFycmF5cyB3aXRoIHN1cHBvcnQgZm9yCiAgICogcGFydGlhbCBkZWVwIGNvbXBhcmlzb25zLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0ge0FycmF5fSBvdGhlciBUaGUgb3RoZXIgYXJyYXkgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0ge251bWJlcn0gYml0bWFzayBUaGUgYml0bWFzayBmbGFncy4gU2VlIGBiYXNlSXNFcXVhbGAgZm9yIG1vcmUgZGV0YWlscy4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjdXN0b21pemVyIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgY29tcGFyaXNvbnMuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZXF1YWxGdW5jIFRoZSBmdW5jdGlvbiB0byBkZXRlcm1pbmUgZXF1aXZhbGVudHMgb2YgdmFsdWVzLgogICAqIEBwYXJhbSB7T2JqZWN0fSBzdGFjayBUcmFja3MgdHJhdmVyc2VkIGBhcnJheWAgYW5kIGBvdGhlcmAgb2JqZWN0cy4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGFycmF5cyBhcmUgZXF1aXZhbGVudCwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGVxdWFsQXJyYXlzKGFycmF5LCBvdGhlciwgYml0bWFzaywgY3VzdG9taXplciwgZXF1YWxGdW5jLCBzdGFjaykgewogICAgdmFyIGlzUGFydGlhbCA9IGJpdG1hc2sgJiBDT01QQVJFX1BBUlRJQUxfRkxBRywKICAgICAgICBhcnJMZW5ndGggPSBhcnJheS5sZW5ndGgsCiAgICAgICAgb3RoTGVuZ3RoID0gb3RoZXIubGVuZ3RoOwoKICAgIGlmIChhcnJMZW5ndGggIT0gb3RoTGVuZ3RoICYmICEoaXNQYXJ0aWFsICYmIG90aExlbmd0aCA+IGFyckxlbmd0aCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLy8gQXNzdW1lIGN5Y2xpYyB2YWx1ZXMgYXJlIGVxdWFsLgogICAgdmFyIHN0YWNrZWQgPSBzdGFjay5nZXQoYXJyYXkpOwogICAgaWYgKHN0YWNrZWQgJiYgc3RhY2suZ2V0KG90aGVyKSkgewogICAgICByZXR1cm4gc3RhY2tlZCA9PSBvdGhlcjsKICAgIH0KICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIHJlc3VsdCA9IHRydWUsCiAgICAgICAgc2VlbiA9IChiaXRtYXNrICYgQ09NUEFSRV9VTk9SREVSRURfRkxBRykgPyBuZXcgU2V0Q2FjaGUgOiB1bmRlZmluZWQ7CgogICAgc3RhY2suc2V0KGFycmF5LCBvdGhlcik7CiAgICBzdGFjay5zZXQob3RoZXIsIGFycmF5KTsKCiAgICAvLyBJZ25vcmUgbm9uLWluZGV4IHByb3BlcnRpZXMuCiAgICB3aGlsZSAoKytpbmRleCA8IGFyckxlbmd0aCkgewogICAgICB2YXIgYXJyVmFsdWUgPSBhcnJheVtpbmRleF0sCiAgICAgICAgICBvdGhWYWx1ZSA9IG90aGVyW2luZGV4XTsKCiAgICAgIGlmIChjdXN0b21pemVyKSB7CiAgICAgICAgdmFyIGNvbXBhcmVkID0gaXNQYXJ0aWFsCiAgICAgICAgICA/IGN1c3RvbWl6ZXIob3RoVmFsdWUsIGFyclZhbHVlLCBpbmRleCwgb3RoZXIsIGFycmF5LCBzdGFjaykKICAgICAgICAgIDogY3VzdG9taXplcihhcnJWYWx1ZSwgb3RoVmFsdWUsIGluZGV4LCBhcnJheSwgb3RoZXIsIHN0YWNrKTsKICAgICAgfQogICAgICBpZiAoY29tcGFyZWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGlmIChjb21wYXJlZCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHJlc3VsdCA9IGZhbHNlOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIC8vIFJlY3Vyc2l2ZWx5IGNvbXBhcmUgYXJyYXlzIChzdXNjZXB0aWJsZSB0byBjYWxsIHN0YWNrIGxpbWl0cykuCiAgICAgIGlmIChzZWVuKSB7CiAgICAgICAgaWYgKCFhcnJheVNvbWUob3RoZXIsIGZ1bmN0aW9uKG90aFZhbHVlLCBvdGhJbmRleCkgewogICAgICAgICAgICAgIGlmICghY2FjaGVIYXMoc2Vlbiwgb3RoSW5kZXgpICYmCiAgICAgICAgICAgICAgICAgIChhcnJWYWx1ZSA9PT0gb3RoVmFsdWUgfHwgZXF1YWxGdW5jKGFyclZhbHVlLCBvdGhWYWx1ZSwgYml0bWFzaywgY3VzdG9taXplciwgc3RhY2spKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlZW4ucHVzaChvdGhJbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSkgewogICAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoISgKICAgICAgICAgICAgYXJyVmFsdWUgPT09IG90aFZhbHVlIHx8CiAgICAgICAgICAgICAgZXF1YWxGdW5jKGFyclZhbHVlLCBvdGhWYWx1ZSwgYml0bWFzaywgY3VzdG9taXplciwgc3RhY2spCiAgICAgICAgICApKSB7CiAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHN0YWNrWydkZWxldGUnXShhcnJheSk7CiAgICBzdGFja1snZGVsZXRlJ10ob3RoZXIpOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgYmFzZUlzRXF1YWxEZWVwYCBmb3IgY29tcGFyaW5nIG9iamVjdHMgb2YKICAgKiB0aGUgc2FtZSBgdG9TdHJpbmdUYWdgLgogICAqCiAgICogKipOb3RlOioqIFRoaXMgZnVuY3Rpb24gb25seSBzdXBwb3J0cyBjb21wYXJpbmcgdmFsdWVzIHdpdGggdGFncyBvZgogICAqIGBCb29sZWFuYCwgYERhdGVgLCBgRXJyb3JgLCBgTnVtYmVyYCwgYFJlZ0V4cGAsIG9yIGBTdHJpbmdgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0ge09iamVjdH0gb3RoZXIgVGhlIG90aGVyIG9iamVjdCB0byBjb21wYXJlLgogICAqIEBwYXJhbSB7c3RyaW5nfSB0YWcgVGhlIGB0b1N0cmluZ1RhZ2Agb2YgdGhlIG9iamVjdHMgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0ge251bWJlcn0gYml0bWFzayBUaGUgYml0bWFzayBmbGFncy4gU2VlIGBiYXNlSXNFcXVhbGAgZm9yIG1vcmUgZGV0YWlscy4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjdXN0b21pemVyIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgY29tcGFyaXNvbnMuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZXF1YWxGdW5jIFRoZSBmdW5jdGlvbiB0byBkZXRlcm1pbmUgZXF1aXZhbGVudHMgb2YgdmFsdWVzLgogICAqIEBwYXJhbSB7T2JqZWN0fSBzdGFjayBUcmFja3MgdHJhdmVyc2VkIGBvYmplY3RgIGFuZCBgb3RoZXJgIG9iamVjdHMuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBvYmplY3RzIGFyZSBlcXVpdmFsZW50LCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gZXF1YWxCeVRhZyhvYmplY3QsIG90aGVyLCB0YWcsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGVxdWFsRnVuYywgc3RhY2spIHsKICAgIHN3aXRjaCAodGFnKSB7CiAgICAgIGNhc2UgZGF0YVZpZXdUYWc6CiAgICAgICAgaWYgKChvYmplY3QuYnl0ZUxlbmd0aCAhPSBvdGhlci5ieXRlTGVuZ3RoKSB8fAogICAgICAgICAgICAob2JqZWN0LmJ5dGVPZmZzZXQgIT0gb3RoZXIuYnl0ZU9mZnNldCkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgb2JqZWN0ID0gb2JqZWN0LmJ1ZmZlcjsKICAgICAgICBvdGhlciA9IG90aGVyLmJ1ZmZlcjsKCiAgICAgIGNhc2UgYXJyYXlCdWZmZXJUYWc6CiAgICAgICAgaWYgKChvYmplY3QuYnl0ZUxlbmd0aCAhPSBvdGhlci5ieXRlTGVuZ3RoKSB8fAogICAgICAgICAgICAhZXF1YWxGdW5jKG5ldyBVaW50OEFycmF5KG9iamVjdCksIG5ldyBVaW50OEFycmF5KG90aGVyKSkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICBjYXNlIGJvb2xUYWc6CiAgICAgIGNhc2UgZGF0ZVRhZzoKICAgICAgY2FzZSBudW1iZXJUYWc6CiAgICAgICAgLy8gQ29lcmNlIGJvb2xlYW5zIHRvIGAxYCBvciBgMGAgYW5kIGRhdGVzIHRvIG1pbGxpc2Vjb25kcy4KICAgICAgICAvLyBJbnZhbGlkIGRhdGVzIGFyZSBjb2VyY2VkIHRvIGBOYU5gLgogICAgICAgIHJldHVybiBlcSgrb2JqZWN0LCArb3RoZXIpOwoKICAgICAgY2FzZSBlcnJvclRhZzoKICAgICAgICByZXR1cm4gb2JqZWN0Lm5hbWUgPT0gb3RoZXIubmFtZSAmJiBvYmplY3QubWVzc2FnZSA9PSBvdGhlci5tZXNzYWdlOwoKICAgICAgY2FzZSByZWdleHBUYWc6CiAgICAgIGNhc2Ugc3RyaW5nVGFnOgogICAgICAgIC8vIENvZXJjZSByZWdleGVzIHRvIHN0cmluZ3MgYW5kIHRyZWF0IHN0cmluZ3MsIHByaW1pdGl2ZXMgYW5kIG9iamVjdHMsCiAgICAgICAgLy8gYXMgZXF1YWwuIFNlZSBodHRwOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtcmVnZXhwLnByb3RvdHlwZS50b3N0cmluZwogICAgICAgIC8vIGZvciBtb3JlIGRldGFpbHMuCiAgICAgICAgcmV0dXJuIG9iamVjdCA9PSAob3RoZXIgKyAnJyk7CgogICAgICBjYXNlIG1hcFRhZzoKICAgICAgICB2YXIgY29udmVydCA9IG1hcFRvQXJyYXk7CgogICAgICBjYXNlIHNldFRhZzoKICAgICAgICB2YXIgaXNQYXJ0aWFsID0gYml0bWFzayAmIENPTVBBUkVfUEFSVElBTF9GTEFHOwogICAgICAgIGNvbnZlcnQgfHwgKGNvbnZlcnQgPSBzZXRUb0FycmF5KTsKCiAgICAgICAgaWYgKG9iamVjdC5zaXplICE9IG90aGVyLnNpemUgJiYgIWlzUGFydGlhbCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAvLyBBc3N1bWUgY3ljbGljIHZhbHVlcyBhcmUgZXF1YWwuCiAgICAgICAgdmFyIHN0YWNrZWQgPSBzdGFjay5nZXQob2JqZWN0KTsKICAgICAgICBpZiAoc3RhY2tlZCkgewogICAgICAgICAgcmV0dXJuIHN0YWNrZWQgPT0gb3RoZXI7CiAgICAgICAgfQogICAgICAgIGJpdG1hc2sgfD0gQ09NUEFSRV9VTk9SREVSRURfRkxBRzsKCiAgICAgICAgLy8gUmVjdXJzaXZlbHkgY29tcGFyZSBvYmplY3RzIChzdXNjZXB0aWJsZSB0byBjYWxsIHN0YWNrIGxpbWl0cykuCiAgICAgICAgc3RhY2suc2V0KG9iamVjdCwgb3RoZXIpOwogICAgICAgIHZhciByZXN1bHQgPSBlcXVhbEFycmF5cyhjb252ZXJ0KG9iamVjdCksIGNvbnZlcnQob3RoZXIpLCBiaXRtYXNrLCBjdXN0b21pemVyLCBlcXVhbEZ1bmMsIHN0YWNrKTsKICAgICAgICBzdGFja1snZGVsZXRlJ10ob2JqZWN0KTsKICAgICAgICByZXR1cm4gcmVzdWx0OwoKICAgICAgY2FzZSBzeW1ib2xUYWc6CiAgICAgICAgaWYgKHN5bWJvbFZhbHVlT2YpIHsKICAgICAgICAgIHJldHVybiBzeW1ib2xWYWx1ZU9mLmNhbGwob2JqZWN0KSA9PSBzeW1ib2xWYWx1ZU9mLmNhbGwob3RoZXIpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CgogIC8qKgogICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgYmFzZUlzRXF1YWxEZWVwYCBmb3Igb2JqZWN0cyB3aXRoIHN1cHBvcnQgZm9yCiAgICogcGFydGlhbCBkZWVwIGNvbXBhcmlzb25zLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0ge09iamVjdH0gb3RoZXIgVGhlIG90aGVyIG9iamVjdCB0byBjb21wYXJlLgogICAqIEBwYXJhbSB7bnVtYmVyfSBiaXRtYXNrIFRoZSBiaXRtYXNrIGZsYWdzLiBTZWUgYGJhc2VJc0VxdWFsYCBmb3IgbW9yZSBkZXRhaWxzLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGN1c3RvbWl6ZXIgVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBjb21wYXJpc29ucy4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcXVhbEZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGRldGVybWluZSBlcXVpdmFsZW50cyBvZiB2YWx1ZXMuCiAgICogQHBhcmFtIHtPYmplY3R9IHN0YWNrIFRyYWNrcyB0cmF2ZXJzZWQgYG9iamVjdGAgYW5kIGBvdGhlcmAgb2JqZWN0cy4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIG9iamVjdHMgYXJlIGVxdWl2YWxlbnQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBlcXVhbE9iamVjdHMob2JqZWN0LCBvdGhlciwgYml0bWFzaywgY3VzdG9taXplciwgZXF1YWxGdW5jLCBzdGFjaykgewogICAgdmFyIGlzUGFydGlhbCA9IGJpdG1hc2sgJiBDT01QQVJFX1BBUlRJQUxfRkxBRywKICAgICAgICBvYmpQcm9wcyA9IGdldEFsbEtleXMob2JqZWN0KSwKICAgICAgICBvYmpMZW5ndGggPSBvYmpQcm9wcy5sZW5ndGgsCiAgICAgICAgb3RoUHJvcHMgPSBnZXRBbGxLZXlzKG90aGVyKSwKICAgICAgICBvdGhMZW5ndGggPSBvdGhQcm9wcy5sZW5ndGg7CgogICAgaWYgKG9iakxlbmd0aCAhPSBvdGhMZW5ndGggJiYgIWlzUGFydGlhbCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB2YXIgaW5kZXggPSBvYmpMZW5ndGg7CiAgICB3aGlsZSAoaW5kZXgtLSkgewogICAgICB2YXIga2V5ID0gb2JqUHJvcHNbaW5kZXhdOwogICAgICBpZiAoIShpc1BhcnRpYWwgPyBrZXkgaW4gb3RoZXIgOiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG90aGVyLCBrZXkpKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgLy8gQXNzdW1lIGN5Y2xpYyB2YWx1ZXMgYXJlIGVxdWFsLgogICAgdmFyIHN0YWNrZWQgPSBzdGFjay5nZXQob2JqZWN0KTsKICAgIGlmIChzdGFja2VkICYmIHN0YWNrLmdldChvdGhlcikpIHsKICAgICAgcmV0dXJuIHN0YWNrZWQgPT0gb3RoZXI7CiAgICB9CiAgICB2YXIgcmVzdWx0ID0gdHJ1ZTsKICAgIHN0YWNrLnNldChvYmplY3QsIG90aGVyKTsKICAgIHN0YWNrLnNldChvdGhlciwgb2JqZWN0KTsKCiAgICB2YXIgc2tpcEN0b3IgPSBpc1BhcnRpYWw7CiAgICB3aGlsZSAoKytpbmRleCA8IG9iakxlbmd0aCkgewogICAgICBrZXkgPSBvYmpQcm9wc1tpbmRleF07CiAgICAgIHZhciBvYmpWYWx1ZSA9IG9iamVjdFtrZXldLAogICAgICAgICAgb3RoVmFsdWUgPSBvdGhlcltrZXldOwoKICAgICAgaWYgKGN1c3RvbWl6ZXIpIHsKICAgICAgICB2YXIgY29tcGFyZWQgPSBpc1BhcnRpYWwKICAgICAgICAgID8gY3VzdG9taXplcihvdGhWYWx1ZSwgb2JqVmFsdWUsIGtleSwgb3RoZXIsIG9iamVjdCwgc3RhY2spCiAgICAgICAgICA6IGN1c3RvbWl6ZXIob2JqVmFsdWUsIG90aFZhbHVlLCBrZXksIG9iamVjdCwgb3RoZXIsIHN0YWNrKTsKICAgICAgfQogICAgICAvLyBSZWN1cnNpdmVseSBjb21wYXJlIG9iamVjdHMgKHN1c2NlcHRpYmxlIHRvIGNhbGwgc3RhY2sgbGltaXRzKS4KICAgICAgaWYgKCEoY29tcGFyZWQgPT09IHVuZGVmaW5lZAogICAgICAgICAgICA/IChvYmpWYWx1ZSA9PT0gb3RoVmFsdWUgfHwgZXF1YWxGdW5jKG9ialZhbHVlLCBvdGhWYWx1ZSwgYml0bWFzaywgY3VzdG9taXplciwgc3RhY2spKQogICAgICAgICAgICA6IGNvbXBhcmVkCiAgICAgICAgICApKSB7CiAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgc2tpcEN0b3IgfHwgKHNraXBDdG9yID0ga2V5ID09ICdjb25zdHJ1Y3RvcicpOwogICAgfQogICAgaWYgKHJlc3VsdCAmJiAhc2tpcEN0b3IpIHsKICAgICAgdmFyIG9iakN0b3IgPSBvYmplY3QuY29uc3RydWN0b3IsCiAgICAgICAgICBvdGhDdG9yID0gb3RoZXIuY29uc3RydWN0b3I7CgogICAgICAvLyBOb24gYE9iamVjdGAgb2JqZWN0IGluc3RhbmNlcyB3aXRoIGRpZmZlcmVudCBjb25zdHJ1Y3RvcnMgYXJlIG5vdCBlcXVhbC4KICAgICAgaWYgKG9iakN0b3IgIT0gb3RoQ3RvciAmJgogICAgICAgICAgKCdjb25zdHJ1Y3RvcicgaW4gb2JqZWN0ICYmICdjb25zdHJ1Y3RvcicgaW4gb3RoZXIpICYmCiAgICAgICAgICAhKHR5cGVvZiBvYmpDdG9yID09ICdmdW5jdGlvbicgJiYgb2JqQ3RvciBpbnN0YW5jZW9mIG9iakN0b3IgJiYKICAgICAgICAgICAgdHlwZW9mIG90aEN0b3IgPT0gJ2Z1bmN0aW9uJyAmJiBvdGhDdG9yIGluc3RhbmNlb2Ygb3RoQ3RvcikpIHsKICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgfQogICAgfQogICAgc3RhY2tbJ2RlbGV0ZSddKG9iamVjdCk7CiAgICBzdGFja1snZGVsZXRlJ10ob3RoZXIpOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgYmFzZVJlc3RgIHdoaWNoIGZsYXR0ZW5zIHRoZSByZXN0IGFycmF5LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBhcHBseSBhIHJlc3QgcGFyYW1ldGVyIHRvLgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGZ1bmN0aW9uLgogICAqLwogIGZ1bmN0aW9uIGZsYXRSZXN0KGZ1bmMpIHsKICAgIHJldHVybiBzZXRUb1N0cmluZyhvdmVyUmVzdChmdW5jLCB1bmRlZmluZWQsIGZsYXR0ZW4pLCBmdW5jICsgJycpOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiBvd24gZW51bWVyYWJsZSBwcm9wZXJ0eSBuYW1lcyBhbmQgc3ltYm9scyBvZiBgb2JqZWN0YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcHJvcGVydHkgbmFtZXMgYW5kIHN5bWJvbHMuCiAgICovCiAgZnVuY3Rpb24gZ2V0QWxsS2V5cyhvYmplY3QpIHsKICAgIHJldHVybiBiYXNlR2V0QWxsS2V5cyhvYmplY3QsIGtleXMsIGdldFN5bWJvbHMpOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiBvd24gYW5kIGluaGVyaXRlZCBlbnVtZXJhYmxlIHByb3BlcnR5IG5hbWVzIGFuZAogICAqIHN5bWJvbHMgb2YgYG9iamVjdGAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzIGFuZCBzeW1ib2xzLgogICAqLwogIGZ1bmN0aW9uIGdldEFsbEtleXNJbihvYmplY3QpIHsKICAgIHJldHVybiBiYXNlR2V0QWxsS2V5cyhvYmplY3QsIGtleXNJbiwgZ2V0U3ltYm9sc0luKTsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIGFwcHJvcHJpYXRlICJpdGVyYXRlZSIgZnVuY3Rpb24uIElmIGBfLml0ZXJhdGVlYCBpcyBjdXN0b21pemVkLAogICAqIHRoaXMgZnVuY3Rpb24gcmV0dXJucyB0aGUgY3VzdG9tIG1ldGhvZCwgb3RoZXJ3aXNlIGl0IHJldHVybnMgYGJhc2VJdGVyYXRlZWAuCiAgICogSWYgYXJndW1lbnRzIGFyZSBwcm92aWRlZCwgdGhlIGNob3NlbiBmdW5jdGlvbiBpcyBpbnZva2VkIHdpdGggdGhlbSBhbmQKICAgKiBpdHMgcmVzdWx0IGlzIHJldHVybmVkLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IFt2YWx1ZV0gVGhlIHZhbHVlIHRvIGNvbnZlcnQgdG8gYW4gaXRlcmF0ZWUuCiAgICogQHBhcmFtIHtudW1iZXJ9IFthcml0eV0gVGhlIGFyaXR5IG9mIHRoZSBjcmVhdGVkIGl0ZXJhdGVlLgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgY2hvc2VuIGZ1bmN0aW9uIG9yIGl0cyByZXN1bHQuCiAgICovCiAgZnVuY3Rpb24gZ2V0SXRlcmF0ZWUoKSB7CiAgICB2YXIgcmVzdWx0ID0gbG9kYXNoLml0ZXJhdGVlIHx8IGl0ZXJhdGVlOwogICAgcmVzdWx0ID0gcmVzdWx0ID09PSBpdGVyYXRlZSA/IGJhc2VJdGVyYXRlZSA6IHJlc3VsdDsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gcmVzdWx0KGFyZ3VtZW50c1swXSwgYXJndW1lbnRzWzFdKSA6IHJlc3VsdDsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIGRhdGEgZm9yIGBtYXBgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gbWFwIFRoZSBtYXAgdG8gcXVlcnkuCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUgcmVmZXJlbmNlIGtleS4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgbWFwIGRhdGEuCiAgICovCiAgZnVuY3Rpb24gZ2V0TWFwRGF0YShtYXAsIGtleSkgewogICAgdmFyIGRhdGEgPSBtYXAuX19kYXRhX187CiAgICByZXR1cm4gaXNLZXlhYmxlKGtleSkKICAgICAgPyBkYXRhW3R5cGVvZiBrZXkgPT0gJ3N0cmluZycgPyAnc3RyaW5nJyA6ICdoYXNoJ10KICAgICAgOiBkYXRhLm1hcDsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIHByb3BlcnR5IG5hbWVzLCB2YWx1ZXMsIGFuZCBjb21wYXJlIGZsYWdzIG9mIGBvYmplY3RgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBtYXRjaCBkYXRhIG9mIGBvYmplY3RgLgogICAqLwogIGZ1bmN0aW9uIGdldE1hdGNoRGF0YShvYmplY3QpIHsKICAgIHZhciByZXN1bHQgPSBrZXlzKG9iamVjdCksCiAgICAgICAgbGVuZ3RoID0gcmVzdWx0Lmxlbmd0aDsKCiAgICB3aGlsZSAobGVuZ3RoLS0pIHsKICAgICAgdmFyIGtleSA9IHJlc3VsdFtsZW5ndGhdLAogICAgICAgICAgdmFsdWUgPSBvYmplY3Rba2V5XTsKCiAgICAgIHJlc3VsdFtsZW5ndGhdID0gW2tleSwgdmFsdWUsIGlzU3RyaWN0Q29tcGFyYWJsZSh2YWx1ZSldOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIG5hdGl2ZSBmdW5jdGlvbiBhdCBga2V5YCBvZiBgb2JqZWN0YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgbWV0aG9kIHRvIGdldC4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgZnVuY3Rpb24gaWYgaXQncyBuYXRpdmUsIGVsc2UgYHVuZGVmaW5lZGAuCiAgICovCiAgZnVuY3Rpb24gZ2V0TmF0aXZlKG9iamVjdCwga2V5KSB7CiAgICB2YXIgdmFsdWUgPSBnZXRWYWx1ZShvYmplY3QsIGtleSk7CiAgICByZXR1cm4gYmFzZUlzTmF0aXZlKHZhbHVlKSA/IHZhbHVlIDogdW5kZWZpbmVkOwogIH0KCiAgLyoqCiAgICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBiYXNlR2V0VGFnYCB3aGljaCBpZ25vcmVzIGBTeW1ib2wudG9TdHJpbmdUYWdgIHZhbHVlcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcXVlcnkuCiAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgcmF3IGB0b1N0cmluZ1RhZ2AuCiAgICovCiAgZnVuY3Rpb24gZ2V0UmF3VGFnKHZhbHVlKSB7CiAgICB2YXIgaXNPd24gPSBoYXNPd25Qcm9wZXJ0eS5jYWxsKHZhbHVlLCBzeW1Ub1N0cmluZ1RhZyksCiAgICAgICAgdGFnID0gdmFsdWVbc3ltVG9TdHJpbmdUYWddOwoKICAgIHRyeSB7CiAgICAgIHZhbHVlW3N5bVRvU3RyaW5nVGFnXSA9IHVuZGVmaW5lZDsKICAgICAgdmFyIHVubWFza2VkID0gdHJ1ZTsKICAgIH0gY2F0Y2ggKGUpIHt9CgogICAgdmFyIHJlc3VsdCA9IG5hdGl2ZU9iamVjdFRvU3RyaW5nLmNhbGwodmFsdWUpOwogICAgaWYgKHVubWFza2VkKSB7CiAgICAgIGlmIChpc093bikgewogICAgICAgIHZhbHVlW3N5bVRvU3RyaW5nVGFnXSA9IHRhZzsKICAgICAgfSBlbHNlIHsKICAgICAgICBkZWxldGUgdmFsdWVbc3ltVG9TdHJpbmdUYWddOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB0aGUgb3duIGVudW1lcmFibGUgc3ltYm9scyBvZiBgb2JqZWN0YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2Ygc3ltYm9scy4KICAgKi8KICB2YXIgZ2V0U3ltYm9scyA9ICFuYXRpdmVHZXRTeW1ib2xzID8gc3R1YkFycmF5IDogZnVuY3Rpb24ob2JqZWN0KSB7CiAgICBpZiAob2JqZWN0ID09IG51bGwpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfQogICAgb2JqZWN0ID0gT2JqZWN0KG9iamVjdCk7CiAgICByZXR1cm4gYXJyYXlGaWx0ZXIobmF0aXZlR2V0U3ltYm9scyhvYmplY3QpLCBmdW5jdGlvbihzeW1ib2wpIHsKICAgICAgcmV0dXJuIHByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwob2JqZWN0LCBzeW1ib2wpOwogICAgfSk7CiAgfTsKCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB0aGUgb3duIGFuZCBpbmhlcml0ZWQgZW51bWVyYWJsZSBzeW1ib2xzIG9mIGBvYmplY3RgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBzeW1ib2xzLgogICAqLwogIHZhciBnZXRTeW1ib2xzSW4gPSAhbmF0aXZlR2V0U3ltYm9scyA/IHN0dWJBcnJheSA6IGZ1bmN0aW9uKG9iamVjdCkgewogICAgdmFyIHJlc3VsdCA9IFtdOwogICAgd2hpbGUgKG9iamVjdCkgewogICAgICBhcnJheVB1c2gocmVzdWx0LCBnZXRTeW1ib2xzKG9iamVjdCkpOwogICAgICBvYmplY3QgPSBnZXRQcm90b3R5cGUob2JqZWN0KTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgLyoqCiAgICogR2V0cyB0aGUgYHRvU3RyaW5nVGFnYCBvZiBgdmFsdWVgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBxdWVyeS4KICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBgdG9TdHJpbmdUYWdgLgogICAqLwogIHZhciBnZXRUYWcgPSBiYXNlR2V0VGFnOwoKICAvLyBGYWxsYmFjayBmb3IgZGF0YSB2aWV3cywgbWFwcywgc2V0cywgYW5kIHdlYWsgbWFwcyBpbiBJRSAxMSBhbmQgcHJvbWlzZXMgaW4gTm9kZS5qcyA8IDYuCiAgaWYgKChEYXRhVmlldyAmJiBnZXRUYWcobmV3IERhdGFWaWV3KG5ldyBBcnJheUJ1ZmZlcigxKSkpICE9IGRhdGFWaWV3VGFnKSB8fAogICAgICAoTWFwICYmIGdldFRhZyhuZXcgTWFwKSAhPSBtYXBUYWcpIHx8CiAgICAgIChQcm9taXNlICYmIGdldFRhZyhQcm9taXNlLnJlc29sdmUoKSkgIT0gcHJvbWlzZVRhZykgfHwKICAgICAgKFNldCAmJiBnZXRUYWcobmV3IFNldCkgIT0gc2V0VGFnKSB8fAogICAgICAoV2Vha01hcCAmJiBnZXRUYWcobmV3IFdlYWtNYXApICE9IHdlYWtNYXBUYWcpKSB7CiAgICBnZXRUYWcgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICB2YXIgcmVzdWx0ID0gYmFzZUdldFRhZyh2YWx1ZSksCiAgICAgICAgICBDdG9yID0gcmVzdWx0ID09IG9iamVjdFRhZyA/IHZhbHVlLmNvbnN0cnVjdG9yIDogdW5kZWZpbmVkLAogICAgICAgICAgY3RvclN0cmluZyA9IEN0b3IgPyB0b1NvdXJjZShDdG9yKSA6ICcnOwoKICAgICAgaWYgKGN0b3JTdHJpbmcpIHsKICAgICAgICBzd2l0Y2ggKGN0b3JTdHJpbmcpIHsKICAgICAgICAgIGNhc2UgZGF0YVZpZXdDdG9yU3RyaW5nOiByZXR1cm4gZGF0YVZpZXdUYWc7CiAgICAgICAgICBjYXNlIG1hcEN0b3JTdHJpbmc6IHJldHVybiBtYXBUYWc7CiAgICAgICAgICBjYXNlIHByb21pc2VDdG9yU3RyaW5nOiByZXR1cm4gcHJvbWlzZVRhZzsKICAgICAgICAgIGNhc2Ugc2V0Q3RvclN0cmluZzogcmV0dXJuIHNldFRhZzsKICAgICAgICAgIGNhc2Ugd2Vha01hcEN0b3JTdHJpbmc6IHJldHVybiB3ZWFrTWFwVGFnOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgcGF0aGAgZXhpc3RzIG9uIGBvYmplY3RgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuCiAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggdG8gY2hlY2suCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gaGFzRnVuYyBUaGUgZnVuY3Rpb24gdG8gY2hlY2sgcHJvcGVydGllcy4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHBhdGhgIGV4aXN0cywgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGhhc1BhdGgob2JqZWN0LCBwYXRoLCBoYXNGdW5jKSB7CiAgICBwYXRoID0gY2FzdFBhdGgocGF0aCwgb2JqZWN0KTsKCiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICBsZW5ndGggPSBwYXRoLmxlbmd0aCwKICAgICAgICByZXN1bHQgPSBmYWxzZTsKCiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICB2YXIga2V5ID0gdG9LZXkocGF0aFtpbmRleF0pOwogICAgICBpZiAoIShyZXN1bHQgPSBvYmplY3QgIT0gbnVsbCAmJiBoYXNGdW5jKG9iamVjdCwga2V5KSkpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBvYmplY3QgPSBvYmplY3Rba2V5XTsKICAgIH0KICAgIGlmIChyZXN1bHQgfHwgKytpbmRleCAhPSBsZW5ndGgpIHsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIGxlbmd0aCA9IG9iamVjdCA9PSBudWxsID8gMCA6IG9iamVjdC5sZW5ndGg7CiAgICByZXR1cm4gISFsZW5ndGggJiYgaXNMZW5ndGgobGVuZ3RoKSAmJiBpc0luZGV4KGtleSwgbGVuZ3RoKSAmJgogICAgICAoaXNBcnJheShvYmplY3QpIHx8IGlzQXJndW1lbnRzKG9iamVjdCkpOwogIH0KCiAgLyoqCiAgICogSW5pdGlhbGl6ZXMgYW4gYXJyYXkgY2xvbmUuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBjbG9uZS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGluaXRpYWxpemVkIGNsb25lLgogICAqLwogIGZ1bmN0aW9uIGluaXRDbG9uZUFycmF5KGFycmF5KSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoLAogICAgICAgIHJlc3VsdCA9IGFycmF5LmNvbnN0cnVjdG9yKGxlbmd0aCk7CgogICAgLy8gQWRkIHByb3BlcnRpZXMgYXNzaWduZWQgYnkgYFJlZ0V4cCNleGVjYC4KICAgIGlmIChsZW5ndGggJiYgdHlwZW9mIGFycmF5WzBdID09ICdzdHJpbmcnICYmIGhhc093blByb3BlcnR5LmNhbGwoYXJyYXksICdpbmRleCcpKSB7CiAgICAgIHJlc3VsdC5pbmRleCA9IGFycmF5LmluZGV4OwogICAgICByZXN1bHQuaW5wdXQgPSBhcnJheS5pbnB1dDsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBJbml0aWFsaXplcyBhbiBvYmplY3QgY2xvbmUuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBjbG9uZS4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBpbml0aWFsaXplZCBjbG9uZS4KICAgKi8KICBmdW5jdGlvbiBpbml0Q2xvbmVPYmplY3Qob2JqZWN0KSB7CiAgICByZXR1cm4gKHR5cGVvZiBvYmplY3QuY29uc3RydWN0b3IgPT0gJ2Z1bmN0aW9uJyAmJiAhaXNQcm90b3R5cGUob2JqZWN0KSkKICAgICAgPyBiYXNlQ3JlYXRlKGdldFByb3RvdHlwZShvYmplY3QpKQogICAgICA6IHt9OwogIH0KCiAgLyoqCiAgICogSW5pdGlhbGl6ZXMgYW4gb2JqZWN0IGNsb25lIGJhc2VkIG9uIGl0cyBgdG9TdHJpbmdUYWdgLgogICAqCiAgICogKipOb3RlOioqIFRoaXMgZnVuY3Rpb24gb25seSBzdXBwb3J0cyBjbG9uaW5nIHZhbHVlcyB3aXRoIHRhZ3Mgb2YKICAgKiBgQm9vbGVhbmAsIGBEYXRlYCwgYEVycm9yYCwgYE51bWJlcmAsIGBSZWdFeHBgLCBvciBgU3RyaW5nYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGNsb25lLgogICAqIEBwYXJhbSB7c3RyaW5nfSB0YWcgVGhlIGB0b1N0cmluZ1RhZ2Agb2YgdGhlIG9iamVjdCB0byBjbG9uZS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjbG9uZUZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGNsb25lIHZhbHVlcy4KICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc0RlZXBdIFNwZWNpZnkgYSBkZWVwIGNsb25lLgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGluaXRpYWxpemVkIGNsb25lLgogICAqLwogIGZ1bmN0aW9uIGluaXRDbG9uZUJ5VGFnKG9iamVjdCwgdGFnLCBjbG9uZUZ1bmMsIGlzRGVlcCkgewogICAgdmFyIEN0b3IgPSBvYmplY3QuY29uc3RydWN0b3I7CiAgICBzd2l0Y2ggKHRhZykgewogICAgICBjYXNlIGFycmF5QnVmZmVyVGFnOgogICAgICAgIHJldHVybiBjbG9uZUFycmF5QnVmZmVyKG9iamVjdCk7CgogICAgICBjYXNlIGJvb2xUYWc6CiAgICAgIGNhc2UgZGF0ZVRhZzoKICAgICAgICByZXR1cm4gbmV3IEN0b3IoK29iamVjdCk7CgogICAgICBjYXNlIGRhdGFWaWV3VGFnOgogICAgICAgIHJldHVybiBjbG9uZURhdGFWaWV3KG9iamVjdCwgaXNEZWVwKTsKCiAgICAgIGNhc2UgZmxvYXQzMlRhZzogY2FzZSBmbG9hdDY0VGFnOgogICAgICBjYXNlIGludDhUYWc6IGNhc2UgaW50MTZUYWc6IGNhc2UgaW50MzJUYWc6CiAgICAgIGNhc2UgdWludDhUYWc6IGNhc2UgdWludDhDbGFtcGVkVGFnOiBjYXNlIHVpbnQxNlRhZzogY2FzZSB1aW50MzJUYWc6CiAgICAgICAgcmV0dXJuIGNsb25lVHlwZWRBcnJheShvYmplY3QsIGlzRGVlcCk7CgogICAgICBjYXNlIG1hcFRhZzoKICAgICAgICByZXR1cm4gY2xvbmVNYXAob2JqZWN0LCBpc0RlZXAsIGNsb25lRnVuYyk7CgogICAgICBjYXNlIG51bWJlclRhZzoKICAgICAgY2FzZSBzdHJpbmdUYWc6CiAgICAgICAgcmV0dXJuIG5ldyBDdG9yKG9iamVjdCk7CgogICAgICBjYXNlIHJlZ2V4cFRhZzoKICAgICAgICByZXR1cm4gY2xvbmVSZWdFeHAob2JqZWN0KTsKCiAgICAgIGNhc2Ugc2V0VGFnOgogICAgICAgIHJldHVybiBjbG9uZVNldChvYmplY3QsIGlzRGVlcCwgY2xvbmVGdW5jKTsKCiAgICAgIGNhc2Ugc3ltYm9sVGFnOgogICAgICAgIHJldHVybiBjbG9uZVN5bWJvbChvYmplY3QpOwogICAgfQogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSBmbGF0dGVuYWJsZSBgYXJndW1lbnRzYCBvYmplY3Qgb3IgYXJyYXkuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGZsYXR0ZW5hYmxlLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gaXNGbGF0dGVuYWJsZSh2YWx1ZSkgewogICAgcmV0dXJuIGlzQXJyYXkodmFsdWUpIHx8IGlzQXJndW1lbnRzKHZhbHVlKSB8fAogICAgICAhIShzcHJlYWRhYmxlU3ltYm9sICYmIHZhbHVlICYmIHZhbHVlW3NwcmVhZGFibGVTeW1ib2xdKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgdmFsaWQgYXJyYXktbGlrZSBpbmRleC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHBhcmFtIHtudW1iZXJ9IFtsZW5ndGg9TUFYX1NBRkVfSU5URUdFUl0gVGhlIHVwcGVyIGJvdW5kcyBvZiBhIHZhbGlkIGluZGV4LgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgdmFsaWQgaW5kZXgsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBpc0luZGV4KHZhbHVlLCBsZW5ndGgpIHsKICAgIGxlbmd0aCA9IGxlbmd0aCA9PSBudWxsID8gTUFYX1NBRkVfSU5URUdFUiA6IGxlbmd0aDsKICAgIHJldHVybiAhIWxlbmd0aCAmJgogICAgICAodHlwZW9mIHZhbHVlID09ICdudW1iZXInIHx8IHJlSXNVaW50LnRlc3QodmFsdWUpKSAmJgogICAgICAodmFsdWUgPiAtMSAmJiB2YWx1ZSAlIDEgPT0gMCAmJiB2YWx1ZSA8IGxlbmd0aCk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgdGhlIGdpdmVuIGFyZ3VtZW50cyBhcmUgZnJvbSBhbiBpdGVyYXRlZSBjYWxsLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSBwb3RlbnRpYWwgaXRlcmF0ZWUgdmFsdWUgYXJndW1lbnQuCiAgICogQHBhcmFtIHsqfSBpbmRleCBUaGUgcG90ZW50aWFsIGl0ZXJhdGVlIGluZGV4IG9yIGtleSBhcmd1bWVudC4KICAgKiBAcGFyYW0geyp9IG9iamVjdCBUaGUgcG90ZW50aWFsIGl0ZXJhdGVlIG9iamVjdCBhcmd1bWVudC4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGFyZ3VtZW50cyBhcmUgZnJvbSBhbiBpdGVyYXRlZSBjYWxsLAogICAqICBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gaXNJdGVyYXRlZUNhbGwodmFsdWUsIGluZGV4LCBvYmplY3QpIHsKICAgIGlmICghaXNPYmplY3Qob2JqZWN0KSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB2YXIgdHlwZSA9IHR5cGVvZiBpbmRleDsKICAgIGlmICh0eXBlID09ICdudW1iZXInCiAgICAgICAgICA/IChpc0FycmF5TGlrZShvYmplY3QpICYmIGlzSW5kZXgoaW5kZXgsIG9iamVjdC5sZW5ndGgpKQogICAgICAgICAgOiAodHlwZSA9PSAnc3RyaW5nJyAmJiBpbmRleCBpbiBvYmplY3QpCiAgICAgICAgKSB7CiAgICAgIHJldHVybiBlcShvYmplY3RbaW5kZXhdLCB2YWx1ZSk7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIHByb3BlcnR5IG5hbWUgYW5kIG5vdCBhIHByb3BlcnR5IHBhdGguCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEBwYXJhbSB7T2JqZWN0fSBbb2JqZWN0XSBUaGUgb2JqZWN0IHRvIHF1ZXJ5IGtleXMgb24uCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBwcm9wZXJ0eSBuYW1lLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gaXNLZXkodmFsdWUsIG9iamVjdCkgewogICAgaWYgKGlzQXJyYXkodmFsdWUpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHZhciB0eXBlID0gdHlwZW9mIHZhbHVlOwogICAgaWYgKHR5cGUgPT0gJ251bWJlcicgfHwgdHlwZSA9PSAnc3ltYm9sJyB8fCB0eXBlID09ICdib29sZWFuJyB8fAogICAgICAgIHZhbHVlID09IG51bGwgfHwgaXNTeW1ib2wodmFsdWUpKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuIHJlSXNQbGFpblByb3AudGVzdCh2YWx1ZSkgfHwgIXJlSXNEZWVwUHJvcC50ZXN0KHZhbHVlKSB8fAogICAgICAob2JqZWN0ICE9IG51bGwgJiYgdmFsdWUgaW4gT2JqZWN0KG9iamVjdCkpOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgc3VpdGFibGUgZm9yIHVzZSBhcyB1bmlxdWUgb2JqZWN0IGtleS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgc3VpdGFibGUsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBpc0tleWFibGUodmFsdWUpIHsKICAgIHZhciB0eXBlID0gdHlwZW9mIHZhbHVlOwogICAgcmV0dXJuICh0eXBlID09ICdzdHJpbmcnIHx8IHR5cGUgPT0gJ251bWJlcicgfHwgdHlwZSA9PSAnc3ltYm9sJyB8fCB0eXBlID09ICdib29sZWFuJykKICAgICAgPyAodmFsdWUgIT09ICdfX3Byb3RvX18nKQogICAgICA6ICh2YWx1ZSA9PT0gbnVsbCk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYGZ1bmNgIGhhcyBpdHMgc291cmNlIG1hc2tlZC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGBmdW5jYCBpcyBtYXNrZWQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBpc01hc2tlZChmdW5jKSB7CiAgICByZXR1cm4gISFtYXNrU3JjS2V5ICYmIChtYXNrU3JjS2V5IGluIGZ1bmMpOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGBmdW5jYCBpcyBjYXBhYmxlIG9mIGJlaW5nIG1hc2tlZC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGBmdW5jYCBpcyBtYXNrYWJsZSwgZWxzZSBgZmFsc2VgLgogICAqLwogIHZhciBpc01hc2thYmxlID0gY29yZUpzRGF0YSA/IGlzRnVuY3Rpb24gOiBzdHViRmFsc2U7CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGxpa2VseSBhIHByb3RvdHlwZSBvYmplY3QuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgcHJvdG90eXBlLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gaXNQcm90b3R5cGUodmFsdWUpIHsKICAgIHZhciBDdG9yID0gdmFsdWUgJiYgdmFsdWUuY29uc3RydWN0b3IsCiAgICAgICAgcHJvdG8gPSAodHlwZW9mIEN0b3IgPT0gJ2Z1bmN0aW9uJyAmJiBDdG9yLnByb3RvdHlwZSkgfHwgb2JqZWN0UHJvdG87CgogICAgcmV0dXJuIHZhbHVlID09PSBwcm90bzsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIHN1aXRhYmxlIGZvciBzdHJpY3QgZXF1YWxpdHkgY29tcGFyaXNvbnMsIGkuZS4gYD09PWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlmIHN1aXRhYmxlIGZvciBzdHJpY3QKICAgKiAgZXF1YWxpdHkgY29tcGFyaXNvbnMsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBpc1N0cmljdENvbXBhcmFibGUodmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZSA9PT0gdmFsdWUgJiYgIWlzT2JqZWN0KHZhbHVlKTsKICB9CgogIC8qKgogICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgbWF0Y2hlc1Byb3BlcnR5YCBmb3Igc291cmNlIHZhbHVlcyBzdWl0YWJsZQogICAqIGZvciBzdHJpY3QgZXF1YWxpdHkgY29tcGFyaXNvbnMsIGkuZS4gYD09PWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgcHJvcGVydHkgdG8gZ2V0LgogICAqIEBwYXJhbSB7Kn0gc3JjVmFsdWUgVGhlIHZhbHVlIHRvIG1hdGNoLgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IHNwZWMgZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gbWF0Y2hlc1N0cmljdENvbXBhcmFibGUoa2V5LCBzcmNWYWx1ZSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iamVjdCkgewogICAgICBpZiAob2JqZWN0ID09IG51bGwpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuIG9iamVjdFtrZXldID09PSBzcmNWYWx1ZSAmJgogICAgICAgIChzcmNWYWx1ZSAhPT0gdW5kZWZpbmVkIHx8IChrZXkgaW4gT2JqZWN0KG9iamVjdCkpKTsKICAgIH07CiAgfQoKICAvKioKICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8ubWVtb2l6ZWAgd2hpY2ggY2xlYXJzIHRoZSBtZW1vaXplZCBmdW5jdGlvbidzCiAgICogY2FjaGUgd2hlbiBpdCBleGNlZWRzIGBNQVhfTUVNT0laRV9TSVpFYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gaGF2ZSBpdHMgb3V0cHV0IG1lbW9pemVkLgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IG1lbW9pemVkIGZ1bmN0aW9uLgogICAqLwogIGZ1bmN0aW9uIG1lbW9pemVDYXBwZWQoZnVuYykgewogICAgdmFyIHJlc3VsdCA9IG1lbW9pemUoZnVuYywgZnVuY3Rpb24oa2V5KSB7CiAgICAgIGlmIChjYWNoZS5zaXplID09PSBNQVhfTUVNT0laRV9TSVpFKSB7CiAgICAgICAgY2FjaGUuY2xlYXIoKTsKICAgICAgfQogICAgICByZXR1cm4ga2V5OwogICAgfSk7CgogICAgdmFyIGNhY2hlID0gcmVzdWx0LmNhY2hlOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIFRoaXMgZnVuY3Rpb24gaXMgbGlrZQogICAqIFtgT2JqZWN0LmtleXNgXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1vYmplY3Qua2V5cykKICAgKiBleGNlcHQgdGhhdCBpdCBpbmNsdWRlcyBpbmhlcml0ZWQgZW51bWVyYWJsZSBwcm9wZXJ0aWVzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcy4KICAgKi8KICBmdW5jdGlvbiBuYXRpdmVLZXlzSW4ob2JqZWN0KSB7CiAgICB2YXIgcmVzdWx0ID0gW107CiAgICBpZiAob2JqZWN0ICE9IG51bGwpIHsKICAgICAgZm9yICh2YXIga2V5IGluIE9iamVjdChvYmplY3QpKSB7CiAgICAgICAgcmVzdWx0LnB1c2goa2V5KTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIENvbnZlcnRzIGB2YWx1ZWAgdG8gYSBzdHJpbmcgdXNpbmcgYE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmdgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb252ZXJ0LgogICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBzdHJpbmcuCiAgICovCiAgZnVuY3Rpb24gb2JqZWN0VG9TdHJpbmcodmFsdWUpIHsKICAgIHJldHVybiBuYXRpdmVPYmplY3RUb1N0cmluZy5jYWxsKHZhbHVlKTsKICB9CgogIC8qKgogICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgYmFzZVJlc3RgIHdoaWNoIHRyYW5zZm9ybXMgdGhlIHJlc3QgYXJyYXkuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGFwcGx5IGEgcmVzdCBwYXJhbWV0ZXIgdG8uCiAgICogQHBhcmFtIHtudW1iZXJ9IFtzdGFydD1mdW5jLmxlbmd0aC0xXSBUaGUgc3RhcnQgcG9zaXRpb24gb2YgdGhlIHJlc3QgcGFyYW1ldGVyLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IHRyYW5zZm9ybSBUaGUgcmVzdCBhcnJheSB0cmFuc2Zvcm0uCiAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gb3ZlclJlc3QoZnVuYywgc3RhcnQsIHRyYW5zZm9ybSkgewogICAgc3RhcnQgPSBuYXRpdmVNYXgoc3RhcnQgPT09IHVuZGVmaW5lZCA/IChmdW5jLmxlbmd0aCAtIDEpIDogc3RhcnQsIDApOwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cywKICAgICAgICAgIGluZGV4ID0gLTEsCiAgICAgICAgICBsZW5ndGggPSBuYXRpdmVNYXgoYXJncy5sZW5ndGggLSBzdGFydCwgMCksCiAgICAgICAgICBhcnJheSA9IEFycmF5KGxlbmd0aCk7CgogICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICAgIGFycmF5W2luZGV4XSA9IGFyZ3Nbc3RhcnQgKyBpbmRleF07CiAgICAgIH0KICAgICAgaW5kZXggPSAtMTsKICAgICAgdmFyIG90aGVyQXJncyA9IEFycmF5KHN0YXJ0ICsgMSk7CiAgICAgIHdoaWxlICgrK2luZGV4IDwgc3RhcnQpIHsKICAgICAgICBvdGhlckFyZ3NbaW5kZXhdID0gYXJnc1tpbmRleF07CiAgICAgIH0KICAgICAgb3RoZXJBcmdzW3N0YXJ0XSA9IHRyYW5zZm9ybShhcnJheSk7CiAgICAgIHJldHVybiBhcHBseShmdW5jLCB0aGlzLCBvdGhlckFyZ3MpOwogICAgfTsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIHBhcmVudCB2YWx1ZSBhdCBgcGF0aGAgb2YgYG9iamVjdGAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcGFyYW0ge0FycmF5fSBwYXRoIFRoZSBwYXRoIHRvIGdldCB0aGUgcGFyZW50IHZhbHVlIG9mLgogICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBwYXJlbnQgdmFsdWUuCiAgICovCiAgZnVuY3Rpb24gcGFyZW50KG9iamVjdCwgcGF0aCkgewogICAgcmV0dXJuIHBhdGgubGVuZ3RoIDwgMiA/IG9iamVjdCA6IGJhc2VHZXQob2JqZWN0LCBiYXNlU2xpY2UocGF0aCwgMCwgLTEpKTsKICB9CgogIC8qKgogICAqIFNldHMgdGhlIGB0b1N0cmluZ2AgbWV0aG9kIG9mIGBmdW5jYCB0byByZXR1cm4gYHN0cmluZ2AuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIG1vZGlmeS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdHJpbmcgVGhlIGB0b1N0cmluZ2AgcmVzdWx0LgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyBgZnVuY2AuCiAgICovCiAgdmFyIHNldFRvU3RyaW5nID0gc2hvcnRPdXQoYmFzZVNldFRvU3RyaW5nKTsKCiAgLyoqCiAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQnbGwgc2hvcnQgb3V0IGFuZCBpbnZva2UgYGlkZW50aXR5YCBpbnN0ZWFkCiAgICogb2YgYGZ1bmNgIHdoZW4gaXQncyBjYWxsZWQgYEhPVF9DT1VOVGAgb3IgbW9yZSB0aW1lcyBpbiBgSE9UX1NQQU5gCiAgICogbWlsbGlzZWNvbmRzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byByZXN0cmljdC4KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBzaG9ydGFibGUgZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gc2hvcnRPdXQoZnVuYykgewogICAgdmFyIGNvdW50ID0gMCwKICAgICAgICBsYXN0Q2FsbGVkID0gMDsKCiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzdGFtcCA9IG5hdGl2ZU5vdygpLAogICAgICAgICAgcmVtYWluaW5nID0gSE9UX1NQQU4gLSAoc3RhbXAgLSBsYXN0Q2FsbGVkKTsKCiAgICAgIGxhc3RDYWxsZWQgPSBzdGFtcDsKICAgICAgaWYgKHJlbWFpbmluZyA+IDApIHsKICAgICAgICBpZiAoKytjb3VudCA+PSBIT1RfQ09VTlQpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHNbMF07CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNvdW50ID0gMDsKICAgICAgfQogICAgICByZXR1cm4gZnVuYy5hcHBseSh1bmRlZmluZWQsIGFyZ3VtZW50cyk7CiAgICB9OwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYHN0cmluZ2AgdG8gYSBwcm9wZXJ0eSBwYXRoIGFycmF5LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyaW5nIFRoZSBzdHJpbmcgdG8gY29udmVydC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHByb3BlcnR5IHBhdGggYXJyYXkuCiAgICovCiAgdmFyIHN0cmluZ1RvUGF0aCA9IG1lbW9pemVDYXBwZWQoZnVuY3Rpb24oc3RyaW5nKSB7CiAgICB2YXIgcmVzdWx0ID0gW107CiAgICBpZiAocmVMZWFkaW5nRG90LnRlc3Qoc3RyaW5nKSkgewogICAgICByZXN1bHQucHVzaCgnJyk7CiAgICB9CiAgICBzdHJpbmcucmVwbGFjZShyZVByb3BOYW1lLCBmdW5jdGlvbihtYXRjaCwgbnVtYmVyLCBxdW90ZSwgc3RyaW5nKSB7CiAgICAgIHJlc3VsdC5wdXNoKHF1b3RlID8gc3RyaW5nLnJlcGxhY2UocmVFc2NhcGVDaGFyLCAnJDEnKSA6IChudW1iZXIgfHwgbWF0Y2gpKTsKICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9KTsKCiAgLyoqCiAgICogQ29udmVydHMgYHZhbHVlYCB0byBhIHN0cmluZyBrZXkgaWYgaXQncyBub3QgYSBzdHJpbmcgb3Igc3ltYm9sLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBpbnNwZWN0LgogICAqIEByZXR1cm5zIHtzdHJpbmd8c3ltYm9sfSBSZXR1cm5zIHRoZSBrZXkuCiAgICovCiAgZnVuY3Rpb24gdG9LZXkodmFsdWUpIHsKICAgIGlmICh0eXBlb2YgdmFsdWUgPT0gJ3N0cmluZycgfHwgaXNTeW1ib2wodmFsdWUpKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIHZhciByZXN1bHQgPSAodmFsdWUgKyAnJyk7CiAgICByZXR1cm4gKHJlc3VsdCA9PSAnMCcgJiYgKDEgLyB2YWx1ZSkgPT0gLUlORklOSVRZKSA/ICctMCcgOiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBDb252ZXJ0cyBgZnVuY2AgdG8gaXRzIHNvdXJjZSBjb2RlLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBjb252ZXJ0LgogICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIHNvdXJjZSBjb2RlLgogICAqLwogIGZ1bmN0aW9uIHRvU291cmNlKGZ1bmMpIHsKICAgIGlmIChmdW5jICE9IG51bGwpIHsKICAgICAgdHJ5IHsKICAgICAgICByZXR1cm4gZnVuY1RvU3RyaW5nLmNhbGwoZnVuYyk7CiAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIChmdW5jICsgJycpOwogICAgICB9IGNhdGNoIChlKSB7fQogICAgfQogICAgcmV0dXJuICcnOwogIH0KCiAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKICAvKioKICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIGVsZW1lbnRzIHNwbGl0IGludG8gZ3JvdXBzIHRoZSBsZW5ndGggb2YgYHNpemVgLgogICAqIElmIGBhcnJheWAgY2FuJ3QgYmUgc3BsaXQgZXZlbmx5LCB0aGUgZmluYWwgY2h1bmsgd2lsbCBiZSB0aGUgcmVtYWluaW5nCiAgICogZWxlbWVudHMuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMy4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcHJvY2Vzcy4KICAgKiBAcGFyYW0ge251bWJlcn0gW3NpemU9MV0gVGhlIGxlbmd0aCBvZiBlYWNoIGNodW5rCiAgICogQHBhcmFtLSB7T2JqZWN0fSBbZ3VhcmRdIEVuYWJsZXMgdXNlIGFzIGFuIGl0ZXJhdGVlIGZvciBtZXRob2RzIGxpa2UgYF8ubWFwYC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBjaHVua3MuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uY2h1bmsoWydhJywgJ2InLCAnYycsICdkJ10sIDIpOwogICAqIC8vID0+IFtbJ2EnLCAnYiddLCBbJ2MnLCAnZCddXQogICAqCiAgICogXy5jaHVuayhbJ2EnLCAnYicsICdjJywgJ2QnXSwgMyk7CiAgICogLy8gPT4gW1snYScsICdiJywgJ2MnXSwgWydkJ11dCiAgICovCiAgZnVuY3Rpb24gY2h1bmsoYXJyYXksIHNpemUsIGd1YXJkKSB7CiAgICBpZiAoKGd1YXJkID8gaXNJdGVyYXRlZUNhbGwoYXJyYXksIHNpemUsIGd1YXJkKSA6IHNpemUgPT09IHVuZGVmaW5lZCkpIHsKICAgICAgc2l6ZSA9IDE7CiAgICB9IGVsc2UgewogICAgICBzaXplID0gbmF0aXZlTWF4KHRvSW50ZWdlcihzaXplKSwgMCk7CiAgICB9CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7CiAgICBpZiAoIWxlbmd0aCB8fCBzaXplIDwgMSkgewogICAgICByZXR1cm4gW107CiAgICB9CiAgICB2YXIgaW5kZXggPSAwLAogICAgICAgIHJlc0luZGV4ID0gMCwKICAgICAgICByZXN1bHQgPSBBcnJheShuYXRpdmVDZWlsKGxlbmd0aCAvIHNpemUpKTsKCiAgICB3aGlsZSAoaW5kZXggPCBsZW5ndGgpIHsKICAgICAgcmVzdWx0W3Jlc0luZGV4KytdID0gYmFzZVNsaWNlKGFycmF5LCBpbmRleCwgKGluZGV4ICs9IHNpemUpKTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGFuIGFycmF5IHdpdGggYWxsIGZhbHNleSB2YWx1ZXMgcmVtb3ZlZC4gVGhlIHZhbHVlcyBgZmFsc2VgLCBgbnVsbGAsCiAgICogYDBgLCBgIiJgLCBgdW5kZWZpbmVkYCwgYW5kIGBOYU5gIGFyZSBmYWxzZXkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gY29tcGFjdC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBmaWx0ZXJlZCB2YWx1ZXMuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uY29tcGFjdChbMCwgMSwgZmFsc2UsIDIsICcnLCAzXSk7CiAgICogLy8gPT4gWzEsIDIsIDNdCiAgICovCiAgZnVuY3Rpb24gY29tcGFjdChhcnJheSkgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGgsCiAgICAgICAgcmVzSW5kZXggPSAwLAogICAgICAgIHJlc3VsdCA9IFtdOwoKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHZhciB2YWx1ZSA9IGFycmF5W2luZGV4XTsKICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgcmVzdWx0W3Jlc0luZGV4KytdID0gdmFsdWU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgbmV3IGFycmF5IGNvbmNhdGVuYXRpbmcgYGFycmF5YCB3aXRoIGFueSBhZGRpdGlvbmFsIGFycmF5cwogICAqIGFuZC9vciB2YWx1ZXMuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gY29uY2F0ZW5hdGUuCiAgICogQHBhcmFtIHsuLi4qfSBbdmFsdWVzXSBUaGUgdmFsdWVzIHRvIGNvbmNhdGVuYXRlLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGNvbmNhdGVuYXRlZCBhcnJheS4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIGFycmF5ID0gWzFdOwogICAqIHZhciBvdGhlciA9IF8uY29uY2F0KGFycmF5LCAyLCBbM10sIFtbNF1dKTsKICAgKgogICAqIGNvbnNvbGUubG9nKG90aGVyKTsKICAgKiAvLyA9PiBbMSwgMiwgMywgWzRdXQogICAqCiAgICogY29uc29sZS5sb2coYXJyYXkpOwogICAqIC8vID0+IFsxXQogICAqLwogIGZ1bmN0aW9uIGNvbmNhdCgpIHsKICAgIHZhciBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoOwogICAgaWYgKCFsZW5ndGgpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfQogICAgdmFyIGFyZ3MgPSBBcnJheShsZW5ndGggLSAxKSwKICAgICAgICBhcnJheSA9IGFyZ3VtZW50c1swXSwKICAgICAgICBpbmRleCA9IGxlbmd0aDsKCiAgICB3aGlsZSAoaW5kZXgtLSkgewogICAgICBhcmdzW2luZGV4IC0gMV0gPSBhcmd1bWVudHNbaW5kZXhdOwogICAgfQogICAgcmV0dXJuIGFycmF5UHVzaChpc0FycmF5KGFycmF5KSA/IGNvcHlBcnJheShhcnJheSkgOiBbYXJyYXldLCBiYXNlRmxhdHRlbihhcmdzLCAxKSk7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIGBhcnJheWAgdmFsdWVzIG5vdCBpbmNsdWRlZCBpbiB0aGUgb3RoZXIgZ2l2ZW4gYXJyYXlzCiAgICogdXNpbmcgW2BTYW1lVmFsdWVaZXJvYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtc2FtZXZhbHVlemVybykKICAgKiBmb3IgZXF1YWxpdHkgY29tcGFyaXNvbnMuIFRoZSBvcmRlciBhbmQgcmVmZXJlbmNlcyBvZiByZXN1bHQgdmFsdWVzIGFyZQogICAqIGRldGVybWluZWQgYnkgdGhlIGZpcnN0IGFycmF5LgogICAqCiAgICogKipOb3RlOioqIFVubGlrZSBgXy5wdWxsQWxsYCwgdGhpcyBtZXRob2QgcmV0dXJucyBhIG5ldyBhcnJheS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7Li4uQXJyYXl9IFt2YWx1ZXNdIFRoZSB2YWx1ZXMgdG8gZXhjbHVkZS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBmaWx0ZXJlZCB2YWx1ZXMuCiAgICogQHNlZSBfLndpdGhvdXQsIF8ueG9yCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uZGlmZmVyZW5jZShbMiwgMV0sIFsyLCAzXSk7CiAgICogLy8gPT4gWzFdCiAgICovCiAgdmFyIGRpZmZlcmVuY2UgPSBiYXNlUmVzdChmdW5jdGlvbihhcnJheSwgdmFsdWVzKSB7CiAgICByZXR1cm4gaXNBcnJheUxpa2VPYmplY3QoYXJyYXkpCiAgICAgID8gYmFzZURpZmZlcmVuY2UoYXJyYXksIGJhc2VGbGF0dGVuKHZhbHVlcywgMSwgaXNBcnJheUxpa2VPYmplY3QsIHRydWUpKQogICAgICA6IFtdOwogIH0pOwoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmRpZmZlcmVuY2VgIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGl0ZXJhdGVlYCB3aGljaAogICAqIGlzIGludm9rZWQgZm9yIGVhY2ggZWxlbWVudCBvZiBgYXJyYXlgIGFuZCBgdmFsdWVzYCB0byBnZW5lcmF0ZSB0aGUgY3JpdGVyaW9uCiAgICogYnkgd2hpY2ggdGhleSdyZSBjb21wYXJlZC4gVGhlIG9yZGVyIGFuZCByZWZlcmVuY2VzIG9mIHJlc3VsdCB2YWx1ZXMgYXJlCiAgICogZGV0ZXJtaW5lZCBieSB0aGUgZmlyc3QgYXJyYXkuIFRoZSBpdGVyYXRlZSBpcyBpbnZva2VkIHdpdGggb25lIGFyZ3VtZW50OgogICAqICh2YWx1ZSkuCiAgICoKICAgKiAqKk5vdGU6KiogVW5saWtlIGBfLnB1bGxBbGxCeWAsIHRoaXMgbWV0aG9kIHJldHVybnMgYSBuZXcgYXJyYXkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0gey4uLkFycmF5fSBbdmFsdWVzXSBUaGUgdmFsdWVzIHRvIGV4Y2x1ZGUuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBpdGVyYXRlZSBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIGZpbHRlcmVkIHZhbHVlcy4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5kaWZmZXJlbmNlQnkoWzIuMSwgMS4yXSwgWzIuMywgMy40XSwgTWF0aC5mbG9vcik7CiAgICogLy8gPT4gWzEuMl0KICAgKgogICAqIC8vIFRoZSBgXy5wcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLgogICAqIF8uZGlmZmVyZW5jZUJ5KFt7ICd4JzogMiB9LCB7ICd4JzogMSB9XSwgW3sgJ3gnOiAxIH1dLCAneCcpOwogICAqIC8vID0+IFt7ICd4JzogMiB9XQogICAqLwogIHZhciBkaWZmZXJlbmNlQnkgPSBiYXNlUmVzdChmdW5jdGlvbihhcnJheSwgdmFsdWVzKSB7CiAgICB2YXIgaXRlcmF0ZWUgPSBsYXN0KHZhbHVlcyk7CiAgICBpZiAoaXNBcnJheUxpa2VPYmplY3QoaXRlcmF0ZWUpKSB7CiAgICAgIGl0ZXJhdGVlID0gdW5kZWZpbmVkOwogICAgfQogICAgcmV0dXJuIGlzQXJyYXlMaWtlT2JqZWN0KGFycmF5KQogICAgICA/IGJhc2VEaWZmZXJlbmNlKGFycmF5LCBiYXNlRmxhdHRlbih2YWx1ZXMsIDEsIGlzQXJyYXlMaWtlT2JqZWN0LCB0cnVlKSwgZ2V0SXRlcmF0ZWUoaXRlcmF0ZWUsIDIpKQogICAgICA6IFtdOwogIH0pOwoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmRpZmZlcmVuY2VgIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGNvbXBhcmF0b3JgCiAgICogd2hpY2ggaXMgaW52b2tlZCB0byBjb21wYXJlIGVsZW1lbnRzIG9mIGBhcnJheWAgdG8gYHZhbHVlc2AuIFRoZSBvcmRlciBhbmQKICAgKiByZWZlcmVuY2VzIG9mIHJlc3VsdCB2YWx1ZXMgYXJlIGRldGVybWluZWQgYnkgdGhlIGZpcnN0IGFycmF5LiBUaGUgY29tcGFyYXRvcgogICAqIGlzIGludm9rZWQgd2l0aCB0d28gYXJndW1lbnRzOiAoYXJyVmFsLCBvdGhWYWwpLgogICAqCiAgICogKipOb3RlOioqIFVubGlrZSBgXy5wdWxsQWxsV2l0aGAsIHRoaXMgbWV0aG9kIHJldHVybnMgYSBuZXcgYXJyYXkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0gey4uLkFycmF5fSBbdmFsdWVzXSBUaGUgdmFsdWVzIHRvIGV4Y2x1ZGUuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NvbXBhcmF0b3JdIFRoZSBjb21wYXJhdG9yIGludm9rZWQgcGVyIGVsZW1lbnQuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2YgZmlsdGVyZWQgdmFsdWVzLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgb2JqZWN0cyA9IFt7ICd4JzogMSwgJ3knOiAyIH0sIHsgJ3gnOiAyLCAneSc6IDEgfV07CiAgICoKICAgKiBfLmRpZmZlcmVuY2VXaXRoKG9iamVjdHMsIFt7ICd4JzogMSwgJ3knOiAyIH1dLCBfLmlzRXF1YWwpOwogICAqIC8vID0+IFt7ICd4JzogMiwgJ3knOiAxIH1dCiAgICovCiAgdmFyIGRpZmZlcmVuY2VXaXRoID0gYmFzZVJlc3QoZnVuY3Rpb24oYXJyYXksIHZhbHVlcykgewogICAgdmFyIGNvbXBhcmF0b3IgPSBsYXN0KHZhbHVlcyk7CiAgICBpZiAoaXNBcnJheUxpa2VPYmplY3QoY29tcGFyYXRvcikpIHsKICAgICAgY29tcGFyYXRvciA9IHVuZGVmaW5lZDsKICAgIH0KICAgIHJldHVybiBpc0FycmF5TGlrZU9iamVjdChhcnJheSkKICAgICAgPyBiYXNlRGlmZmVyZW5jZShhcnJheSwgYmFzZUZsYXR0ZW4odmFsdWVzLCAxLCBpc0FycmF5TGlrZU9iamVjdCwgdHJ1ZSksIHVuZGVmaW5lZCwgY29tcGFyYXRvcikKICAgICAgOiBbXTsKICB9KTsKCiAgLyoqCiAgICogQ3JlYXRlcyBhIHNsaWNlIG9mIGBhcnJheWAgd2l0aCBgbmAgZWxlbWVudHMgZHJvcHBlZCBmcm9tIHRoZSBiZWdpbm5pbmcuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC41LjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcXVlcnkuCiAgICogQHBhcmFtIHtudW1iZXJ9IFtuPTFdIFRoZSBudW1iZXIgb2YgZWxlbWVudHMgdG8gZHJvcC4KICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gRW5hYmxlcyB1c2UgYXMgYW4gaXRlcmF0ZWUgZm9yIG1ldGhvZHMgbGlrZSBgXy5tYXBgLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgc2xpY2Ugb2YgYGFycmF5YC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5kcm9wKFsxLCAyLCAzXSk7CiAgICogLy8gPT4gWzIsIDNdCiAgICoKICAgKiBfLmRyb3AoWzEsIDIsIDNdLCAyKTsKICAgKiAvLyA9PiBbM10KICAgKgogICAqIF8uZHJvcChbMSwgMiwgM10sIDUpOwogICAqIC8vID0+IFtdCiAgICoKICAgKiBfLmRyb3AoWzEsIDIsIDNdLCAwKTsKICAgKiAvLyA9PiBbMSwgMiwgM10KICAgKi8KICBmdW5jdGlvbiBkcm9wKGFycmF5LCBuLCBndWFyZCkgewogICAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoOwogICAgaWYgKCFsZW5ndGgpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfQogICAgbiA9IChndWFyZCB8fCBuID09PSB1bmRlZmluZWQpID8gMSA6IHRvSW50ZWdlcihuKTsKICAgIHJldHVybiBiYXNlU2xpY2UoYXJyYXksIG4gPCAwID8gMCA6IG4sIGxlbmd0aCk7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgc2xpY2Ugb2YgYGFycmF5YCB3aXRoIGBuYCBlbGVtZW50cyBkcm9wcGVkIGZyb20gdGhlIGVuZC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS4KICAgKiBAcGFyYW0ge251bWJlcn0gW249MV0gVGhlIG51bWJlciBvZiBlbGVtZW50cyB0byBkcm9wLgogICAqIEBwYXJhbS0ge09iamVjdH0gW2d1YXJkXSBFbmFibGVzIHVzZSBhcyBhbiBpdGVyYXRlZSBmb3IgbWV0aG9kcyBsaWtlIGBfLm1hcGAuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmRyb3BSaWdodChbMSwgMiwgM10pOwogICAqIC8vID0+IFsxLCAyXQogICAqCiAgICogXy5kcm9wUmlnaHQoWzEsIDIsIDNdLCAyKTsKICAgKiAvLyA9PiBbMV0KICAgKgogICAqIF8uZHJvcFJpZ2h0KFsxLCAyLCAzXSwgNSk7CiAgICogLy8gPT4gW10KICAgKgogICAqIF8uZHJvcFJpZ2h0KFsxLCAyLCAzXSwgMCk7CiAgICogLy8gPT4gWzEsIDIsIDNdCiAgICovCiAgZnVuY3Rpb24gZHJvcFJpZ2h0KGFycmF5LCBuLCBndWFyZCkgewogICAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoOwogICAgaWYgKCFsZW5ndGgpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfQogICAgbiA9IChndWFyZCB8fCBuID09PSB1bmRlZmluZWQpID8gMSA6IHRvSW50ZWdlcihuKTsKICAgIG4gPSBsZW5ndGggLSBuOwogICAgcmV0dXJuIGJhc2VTbGljZShhcnJheSwgMCwgbiA8IDAgPyAwIDogbik7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgc2xpY2Ugb2YgYGFycmF5YCBleGNsdWRpbmcgZWxlbWVudHMgZHJvcHBlZCBmcm9tIHRoZSBlbmQuCiAgICogRWxlbWVudHMgYXJlIGRyb3BwZWQgdW50aWwgYHByZWRpY2F0ZWAgcmV0dXJucyBmYWxzZXkuIFRoZSBwcmVkaWNhdGUgaXMKICAgKiBpbnZva2VkIHdpdGggdGhyZWUgYXJndW1lbnRzOiAodmFsdWUsIGluZGV4LCBhcnJheSkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMy4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcXVlcnkuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3ByZWRpY2F0ZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgc2xpY2Ugb2YgYGFycmF5YC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIHVzZXJzID0gWwogICAqICAgeyAndXNlcic6ICdiYXJuZXknLCAgJ2FjdGl2ZSc6IHRydWUgfSwKICAgKiAgIHsgJ3VzZXInOiAnZnJlZCcsICAgICdhY3RpdmUnOiBmYWxzZSB9LAogICAqICAgeyAndXNlcic6ICdwZWJibGVzJywgJ2FjdGl2ZSc6IGZhbHNlIH0KICAgKiBdOwogICAqCiAgICogXy5kcm9wUmlnaHRXaGlsZSh1c2VycywgZnVuY3Rpb24obykgeyByZXR1cm4gIW8uYWN0aXZlOyB9KTsKICAgKiAvLyA9PiBvYmplY3RzIGZvciBbJ2Jhcm5leSddCiAgICoKICAgKiAvLyBUaGUgYF8ubWF0Y2hlc2AgaXRlcmF0ZWUgc2hvcnRoYW5kLgogICAqIF8uZHJvcFJpZ2h0V2hpbGUodXNlcnMsIHsgJ3VzZXInOiAncGViYmxlcycsICdhY3RpdmUnOiBmYWxzZSB9KTsKICAgKiAvLyA9PiBvYmplY3RzIGZvciBbJ2Jhcm5leScsICdmcmVkJ10KICAgKgogICAqIC8vIFRoZSBgXy5tYXRjaGVzUHJvcGVydHlgIGl0ZXJhdGVlIHNob3J0aGFuZC4KICAgKiBfLmRyb3BSaWdodFdoaWxlKHVzZXJzLCBbJ2FjdGl2ZScsIGZhbHNlXSk7CiAgICogLy8gPT4gb2JqZWN0cyBmb3IgWydiYXJuZXknXQogICAqCiAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy5kcm9wUmlnaHRXaGlsZSh1c2VycywgJ2FjdGl2ZScpOwogICAqIC8vID0+IG9iamVjdHMgZm9yIFsnYmFybmV5JywgJ2ZyZWQnLCAncGViYmxlcyddCiAgICovCiAgZnVuY3Rpb24gZHJvcFJpZ2h0V2hpbGUoYXJyYXksIHByZWRpY2F0ZSkgewogICAgcmV0dXJuIChhcnJheSAmJiBhcnJheS5sZW5ndGgpCiAgICAgID8gYmFzZVdoaWxlKGFycmF5LCBnZXRJdGVyYXRlZShwcmVkaWNhdGUsIDMpLCB0cnVlLCB0cnVlKQogICAgICA6IFtdOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhIHNsaWNlIG9mIGBhcnJheWAgZXhjbHVkaW5nIGVsZW1lbnRzIGRyb3BwZWQgZnJvbSB0aGUgYmVnaW5uaW5nLgogICAqIEVsZW1lbnRzIGFyZSBkcm9wcGVkIHVudGlsIGBwcmVkaWNhdGVgIHJldHVybnMgZmFsc2V5LiBUaGUgcHJlZGljYXRlIGlzCiAgICogaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czogKHZhbHVlLCBpbmRleCwgYXJyYXkpLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDMuMC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtwcmVkaWNhdGU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHNsaWNlIG9mIGBhcnJheWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciB1c2VycyA9IFsKICAgKiAgIHsgJ3VzZXInOiAnYmFybmV5JywgICdhY3RpdmUnOiBmYWxzZSB9LAogICAqICAgeyAndXNlcic6ICdmcmVkJywgICAgJ2FjdGl2ZSc6IGZhbHNlIH0sCiAgICogICB7ICd1c2VyJzogJ3BlYmJsZXMnLCAnYWN0aXZlJzogdHJ1ZSB9CiAgICogXTsKICAgKgogICAqIF8uZHJvcFdoaWxlKHVzZXJzLCBmdW5jdGlvbihvKSB7IHJldHVybiAhby5hY3RpdmU7IH0pOwogICAqIC8vID0+IG9iamVjdHMgZm9yIFsncGViYmxlcyddCiAgICoKICAgKiAvLyBUaGUgYF8ubWF0Y2hlc2AgaXRlcmF0ZWUgc2hvcnRoYW5kLgogICAqIF8uZHJvcFdoaWxlKHVzZXJzLCB7ICd1c2VyJzogJ2Jhcm5leScsICdhY3RpdmUnOiBmYWxzZSB9KTsKICAgKiAvLyA9PiBvYmplY3RzIGZvciBbJ2ZyZWQnLCAncGViYmxlcyddCiAgICoKICAgKiAvLyBUaGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy5kcm9wV2hpbGUodXNlcnMsIFsnYWN0aXZlJywgZmFsc2VdKTsKICAgKiAvLyA9PiBvYmplY3RzIGZvciBbJ3BlYmJsZXMnXQogICAqCiAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy5kcm9wV2hpbGUodXNlcnMsICdhY3RpdmUnKTsKICAgKiAvLyA9PiBvYmplY3RzIGZvciBbJ2Jhcm5leScsICdmcmVkJywgJ3BlYmJsZXMnXQogICAqLwogIGZ1bmN0aW9uIGRyb3BXaGlsZShhcnJheSwgcHJlZGljYXRlKSB7CiAgICByZXR1cm4gKGFycmF5ICYmIGFycmF5Lmxlbmd0aCkKICAgICAgPyBiYXNlV2hpbGUoYXJyYXksIGdldEl0ZXJhdGVlKHByZWRpY2F0ZSwgMyksIHRydWUpCiAgICAgIDogW107CiAgfQoKICAvKioKICAgKiBGaWxscyBlbGVtZW50cyBvZiBgYXJyYXlgIHdpdGggYHZhbHVlYCBmcm9tIGBzdGFydGAgdXAgdG8sIGJ1dCBub3QKICAgKiBpbmNsdWRpbmcsIGBlbmRgLgogICAqCiAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIG11dGF0ZXMgYGFycmF5YC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjIuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBmaWxsLgogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGZpbGwgYGFycmF5YCB3aXRoLgogICAqIEBwYXJhbSB7bnVtYmVyfSBbc3RhcnQ9MF0gVGhlIHN0YXJ0IHBvc2l0aW9uLgogICAqIEBwYXJhbSB7bnVtYmVyfSBbZW5kPWFycmF5Lmxlbmd0aF0gVGhlIGVuZCBwb3NpdGlvbi4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIGFycmF5ID0gWzEsIDIsIDNdOwogICAqCiAgICogXy5maWxsKGFycmF5LCAnYScpOwogICAqIGNvbnNvbGUubG9nKGFycmF5KTsKICAgKiAvLyA9PiBbJ2EnLCAnYScsICdhJ10KICAgKgogICAqIF8uZmlsbChBcnJheSgzKSwgMik7CiAgICogLy8gPT4gWzIsIDIsIDJdCiAgICoKICAgKiBfLmZpbGwoWzQsIDYsIDgsIDEwXSwgJyonLCAxLCAzKTsKICAgKiAvLyA9PiBbNCwgJyonLCAnKicsIDEwXQogICAqLwogIGZ1bmN0aW9uIGZpbGwoYXJyYXksIHZhbHVlLCBzdGFydCwgZW5kKSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7CiAgICBpZiAoIWxlbmd0aCkgewogICAgICByZXR1cm4gW107CiAgICB9CiAgICBpZiAoc3RhcnQgJiYgdHlwZW9mIHN0YXJ0ICE9ICdudW1iZXInICYmIGlzSXRlcmF0ZWVDYWxsKGFycmF5LCB2YWx1ZSwgc3RhcnQpKSB7CiAgICAgIHN0YXJ0ID0gMDsKICAgICAgZW5kID0gbGVuZ3RoOwogICAgfQogICAgcmV0dXJuIGJhc2VGaWxsKGFycmF5LCB2YWx1ZSwgc3RhcnQsIGVuZCk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmZpbmRgIGV4Y2VwdCB0aGF0IGl0IHJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBmaXJzdAogICAqIGVsZW1lbnQgYHByZWRpY2F0ZWAgcmV0dXJucyB0cnV0aHkgZm9yIGluc3RlYWQgb2YgdGhlIGVsZW1lbnQgaXRzZWxmLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDEuMS4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3ByZWRpY2F0ZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEBwYXJhbSB7bnVtYmVyfSBbZnJvbUluZGV4PTBdIFRoZSBpbmRleCB0byBzZWFyY2ggZnJvbS4KICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgZm91bmQgZWxlbWVudCwgZWxzZSBgLTFgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgdXNlcnMgPSBbCiAgICogICB7ICd1c2VyJzogJ2Jhcm5leScsICAnYWN0aXZlJzogZmFsc2UgfSwKICAgKiAgIHsgJ3VzZXInOiAnZnJlZCcsICAgICdhY3RpdmUnOiBmYWxzZSB9LAogICAqICAgeyAndXNlcic6ICdwZWJibGVzJywgJ2FjdGl2ZSc6IHRydWUgfQogICAqIF07CiAgICoKICAgKiBfLmZpbmRJbmRleCh1c2VycywgZnVuY3Rpb24obykgeyByZXR1cm4gby51c2VyID09ICdiYXJuZXknOyB9KTsKICAgKiAvLyA9PiAwCiAgICoKICAgKiAvLyBUaGUgYF8ubWF0Y2hlc2AgaXRlcmF0ZWUgc2hvcnRoYW5kLgogICAqIF8uZmluZEluZGV4KHVzZXJzLCB7ICd1c2VyJzogJ2ZyZWQnLCAnYWN0aXZlJzogZmFsc2UgfSk7CiAgICogLy8gPT4gMQogICAqCiAgICogLy8gVGhlIGBfLm1hdGNoZXNQcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLgogICAqIF8uZmluZEluZGV4KHVzZXJzLCBbJ2FjdGl2ZScsIGZhbHNlXSk7CiAgICogLy8gPT4gMAogICAqCiAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy5maW5kSW5kZXgodXNlcnMsICdhY3RpdmUnKTsKICAgKiAvLyA9PiAyCiAgICovCiAgZnVuY3Rpb24gZmluZEluZGV4KGFycmF5LCBwcmVkaWNhdGUsIGZyb21JbmRleCkgewogICAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoOwogICAgaWYgKCFsZW5ndGgpIHsKICAgICAgcmV0dXJuIC0xOwogICAgfQogICAgdmFyIGluZGV4ID0gZnJvbUluZGV4ID09IG51bGwgPyAwIDogdG9JbnRlZ2VyKGZyb21JbmRleCk7CiAgICBpZiAoaW5kZXggPCAwKSB7CiAgICAgIGluZGV4ID0gbmF0aXZlTWF4KGxlbmd0aCArIGluZGV4LCAwKTsKICAgIH0KICAgIHJldHVybiBiYXNlRmluZEluZGV4KGFycmF5LCBnZXRJdGVyYXRlZShwcmVkaWNhdGUsIDMpLCBpbmRleCk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmZpbmRJbmRleGAgZXhjZXB0IHRoYXQgaXQgaXRlcmF0ZXMgb3ZlciBlbGVtZW50cwogICAqIG9mIGBjb2xsZWN0aW9uYCBmcm9tIHJpZ2h0IHRvIGxlZnQuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMi4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbcHJlZGljYXRlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uCiAgICogQHBhcmFtIHtudW1iZXJ9IFtmcm9tSW5kZXg9YXJyYXkubGVuZ3RoLTFdIFRoZSBpbmRleCB0byBzZWFyY2ggZnJvbS4KICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgZm91bmQgZWxlbWVudCwgZWxzZSBgLTFgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgdXNlcnMgPSBbCiAgICogICB7ICd1c2VyJzogJ2Jhcm5leScsICAnYWN0aXZlJzogdHJ1ZSB9LAogICAqICAgeyAndXNlcic6ICdmcmVkJywgICAgJ2FjdGl2ZSc6IGZhbHNlIH0sCiAgICogICB7ICd1c2VyJzogJ3BlYmJsZXMnLCAnYWN0aXZlJzogZmFsc2UgfQogICAqIF07CiAgICoKICAgKiBfLmZpbmRMYXN0SW5kZXgodXNlcnMsIGZ1bmN0aW9uKG8pIHsgcmV0dXJuIG8udXNlciA9PSAncGViYmxlcyc7IH0pOwogICAqIC8vID0+IDIKICAgKgogICAqIC8vIFRoZSBgXy5tYXRjaGVzYCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy5maW5kTGFzdEluZGV4KHVzZXJzLCB7ICd1c2VyJzogJ2Jhcm5leScsICdhY3RpdmUnOiB0cnVlIH0pOwogICAqIC8vID0+IDAKICAgKgogICAqIC8vIFRoZSBgXy5tYXRjaGVzUHJvcGVydHlgIGl0ZXJhdGVlIHNob3J0aGFuZC4KICAgKiBfLmZpbmRMYXN0SW5kZXgodXNlcnMsIFsnYWN0aXZlJywgZmFsc2VdKTsKICAgKiAvLyA9PiAyCiAgICoKICAgKiAvLyBUaGUgYF8ucHJvcGVydHlgIGl0ZXJhdGVlIHNob3J0aGFuZC4KICAgKiBfLmZpbmRMYXN0SW5kZXgodXNlcnMsICdhY3RpdmUnKTsKICAgKiAvLyA9PiAwCiAgICovCiAgZnVuY3Rpb24gZmluZExhc3RJbmRleChhcnJheSwgcHJlZGljYXRlLCBmcm9tSW5kZXgpIHsKICAgIHZhciBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDsKICAgIGlmICghbGVuZ3RoKSB7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIHZhciBpbmRleCA9IGxlbmd0aCAtIDE7CiAgICBpZiAoZnJvbUluZGV4ICE9PSB1bmRlZmluZWQpIHsKICAgICAgaW5kZXggPSB0b0ludGVnZXIoZnJvbUluZGV4KTsKICAgICAgaW5kZXggPSBmcm9tSW5kZXggPCAwCiAgICAgICAgPyBuYXRpdmVNYXgobGVuZ3RoICsgaW5kZXgsIDApCiAgICAgICAgOiBuYXRpdmVNaW4oaW5kZXgsIGxlbmd0aCAtIDEpOwogICAgfQogICAgcmV0dXJuIGJhc2VGaW5kSW5kZXgoYXJyYXksIGdldEl0ZXJhdGVlKHByZWRpY2F0ZSwgMyksIGluZGV4LCB0cnVlKTsKICB9CgogIC8qKgogICAqIEZsYXR0ZW5zIGBhcnJheWAgYSBzaW5nbGUgbGV2ZWwgZGVlcC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBmbGF0dGVuLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGZsYXR0ZW5lZCBhcnJheS4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5mbGF0dGVuKFsxLCBbMiwgWzMsIFs0XV0sIDVdXSk7CiAgICogLy8gPT4gWzEsIDIsIFszLCBbNF1dLCA1XQogICAqLwogIGZ1bmN0aW9uIGZsYXR0ZW4oYXJyYXkpIHsKICAgIHZhciBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDsKICAgIHJldHVybiBsZW5ndGggPyBiYXNlRmxhdHRlbihhcnJheSwgMSkgOiBbXTsKICB9CgogIC8qKgogICAqIFJlY3Vyc2l2ZWx5IGZsYXR0ZW5zIGBhcnJheWAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMy4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gZmxhdHRlbi4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBmbGF0dGVuZWQgYXJyYXkuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uZmxhdHRlbkRlZXAoWzEsIFsyLCBbMywgWzRdXSwgNV1dKTsKICAgKiAvLyA9PiBbMSwgMiwgMywgNCwgNV0KICAgKi8KICBmdW5jdGlvbiBmbGF0dGVuRGVlcChhcnJheSkgewogICAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoOwogICAgcmV0dXJuIGxlbmd0aCA/IGJhc2VGbGF0dGVuKGFycmF5LCBJTkZJTklUWSkgOiBbXTsKICB9CgogIC8qKgogICAqIFJlY3Vyc2l2ZWx5IGZsYXR0ZW4gYGFycmF5YCB1cCB0byBgZGVwdGhgIHRpbWVzLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuNC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGZsYXR0ZW4uCiAgICogQHBhcmFtIHtudW1iZXJ9IFtkZXB0aD0xXSBUaGUgbWF4aW11bSByZWN1cnNpb24gZGVwdGguCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgZmxhdHRlbmVkIGFycmF5LgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgYXJyYXkgPSBbMSwgWzIsIFszLCBbNF1dLCA1XV07CiAgICoKICAgKiBfLmZsYXR0ZW5EZXB0aChhcnJheSwgMSk7CiAgICogLy8gPT4gWzEsIDIsIFszLCBbNF1dLCA1XQogICAqCiAgICogXy5mbGF0dGVuRGVwdGgoYXJyYXksIDIpOwogICAqIC8vID0+IFsxLCAyLCAzLCBbNF0sIDVdCiAgICovCiAgZnVuY3Rpb24gZmxhdHRlbkRlcHRoKGFycmF5LCBkZXB0aCkgewogICAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoOwogICAgaWYgKCFsZW5ndGgpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfQogICAgZGVwdGggPSBkZXB0aCA9PT0gdW5kZWZpbmVkID8gMSA6IHRvSW50ZWdlcihkZXB0aCk7CiAgICByZXR1cm4gYmFzZUZsYXR0ZW4oYXJyYXksIGRlcHRoKTsKICB9CgogIC8qKgogICAqIFRoZSBpbnZlcnNlIG9mIGBfLnRvUGFpcnNgOyB0aGlzIG1ldGhvZCByZXR1cm5zIGFuIG9iamVjdCBjb21wb3NlZAogICAqIGZyb20ga2V5LXZhbHVlIGBwYWlyc2AuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBwYWlycyBUaGUga2V5LXZhbHVlIHBhaXJzLgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyBvYmplY3QuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uZnJvbVBhaXJzKFtbJ2EnLCAxXSwgWydiJywgMl1dKTsKICAgKiAvLyA9PiB7ICdhJzogMSwgJ2InOiAyIH0KICAgKi8KICBmdW5jdGlvbiBmcm9tUGFpcnMocGFpcnMpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IHBhaXJzID09IG51bGwgPyAwIDogcGFpcnMubGVuZ3RoLAogICAgICAgIHJlc3VsdCA9IHt9OwoKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHZhciBwYWlyID0gcGFpcnNbaW5kZXhdOwogICAgICByZXN1bHRbcGFpclswXV0gPSBwYWlyWzFdOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIGZpcnN0IGVsZW1lbnQgb2YgYGFycmF5YC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBhbGlhcyBmaXJzdAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgZmlyc3QgZWxlbWVudCBvZiBgYXJyYXlgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmhlYWQoWzEsIDIsIDNdKTsKICAgKiAvLyA9PiAxCiAgICoKICAgKiBfLmhlYWQoW10pOwogICAqIC8vID0+IHVuZGVmaW5lZAogICAqLwogIGZ1bmN0aW9uIGhlYWQoYXJyYXkpIHsKICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKSA/IGFycmF5WzBdIDogdW5kZWZpbmVkOwogIH0KCiAgLyoqCiAgICogR2V0cyB0aGUgaW5kZXggYXQgd2hpY2ggdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgYHZhbHVlYCBpcyBmb3VuZCBpbiBgYXJyYXlgCiAgICogdXNpbmcgW2BTYW1lVmFsdWVaZXJvYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtc2FtZXZhbHVlemVybykKICAgKiBmb3IgZXF1YWxpdHkgY29tcGFyaXNvbnMuIElmIGBmcm9tSW5kZXhgIGlzIG5lZ2F0aXZlLCBpdCdzIHVzZWQgYXMgdGhlCiAgICogb2Zmc2V0IGZyb20gdGhlIGVuZCBvZiBgYXJyYXlgLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDAuMS4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2VhcmNoIGZvci4KICAgKiBAcGFyYW0ge251bWJlcn0gW2Zyb21JbmRleD0wXSBUaGUgaW5kZXggdG8gc2VhcmNoIGZyb20uCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIG1hdGNoZWQgdmFsdWUsIGVsc2UgYC0xYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pbmRleE9mKFsxLCAyLCAxLCAyXSwgMik7CiAgICogLy8gPT4gMQogICAqCiAgICogLy8gU2VhcmNoIGZyb20gdGhlIGBmcm9tSW5kZXhgLgogICAqIF8uaW5kZXhPZihbMSwgMiwgMSwgMl0sIDIsIDIpOwogICAqIC8vID0+IDMKICAgKi8KICBmdW5jdGlvbiBpbmRleE9mKGFycmF5LCB2YWx1ZSwgZnJvbUluZGV4KSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7CiAgICBpZiAoIWxlbmd0aCkgewogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICB2YXIgaW5kZXggPSBmcm9tSW5kZXggPT0gbnVsbCA/IDAgOiB0b0ludGVnZXIoZnJvbUluZGV4KTsKICAgIGlmIChpbmRleCA8IDApIHsKICAgICAgaW5kZXggPSBuYXRpdmVNYXgobGVuZ3RoICsgaW5kZXgsIDApOwogICAgfQogICAgcmV0dXJuIGJhc2VJbmRleE9mKGFycmF5LCB2YWx1ZSwgaW5kZXgpOwogIH0KCiAgLyoqCiAgICogR2V0cyBhbGwgYnV0IHRoZSBsYXN0IGVsZW1lbnQgb2YgYGFycmF5YC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHNsaWNlIG9mIGBhcnJheWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaW5pdGlhbChbMSwgMiwgM10pOwogICAqIC8vID0+IFsxLCAyXQogICAqLwogIGZ1bmN0aW9uIGluaXRpYWwoYXJyYXkpIHsKICAgIHZhciBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDsKICAgIHJldHVybiBsZW5ndGggPyBiYXNlU2xpY2UoYXJyYXksIDAsIC0xKSA6IFtdOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB1bmlxdWUgdmFsdWVzIHRoYXQgYXJlIGluY2x1ZGVkIGluIGFsbCBnaXZlbiBhcnJheXMKICAgKiB1c2luZyBbYFNhbWVWYWx1ZVplcm9gXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1zYW1ldmFsdWV6ZXJvKQogICAqIGZvciBlcXVhbGl0eSBjb21wYXJpc29ucy4gVGhlIG9yZGVyIGFuZCByZWZlcmVuY2VzIG9mIHJlc3VsdCB2YWx1ZXMgYXJlCiAgICogZGV0ZXJtaW5lZCBieSB0aGUgZmlyc3QgYXJyYXkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0gey4uLkFycmF5fSBbYXJyYXlzXSBUaGUgYXJyYXlzIHRvIGluc3BlY3QuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2YgaW50ZXJzZWN0aW5nIHZhbHVlcy4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pbnRlcnNlY3Rpb24oWzIsIDFdLCBbMiwgM10pOwogICAqIC8vID0+IFsyXQogICAqLwogIHZhciBpbnRlcnNlY3Rpb24gPSBiYXNlUmVzdChmdW5jdGlvbihhcnJheXMpIHsKICAgIHZhciBtYXBwZWQgPSBhcnJheU1hcChhcnJheXMsIGNhc3RBcnJheUxpa2VPYmplY3QpOwogICAgcmV0dXJuIChtYXBwZWQubGVuZ3RoICYmIG1hcHBlZFswXSA9PT0gYXJyYXlzWzBdKQogICAgICA/IGJhc2VJbnRlcnNlY3Rpb24obWFwcGVkKQogICAgICA6IFtdOwogIH0pOwoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmludGVyc2VjdGlvbmAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgaXRlcmF0ZWVgCiAgICogd2hpY2ggaXMgaW52b2tlZCBmb3IgZWFjaCBlbGVtZW50IG9mIGVhY2ggYGFycmF5c2AgdG8gZ2VuZXJhdGUgdGhlIGNyaXRlcmlvbgogICAqIGJ5IHdoaWNoIHRoZXkncmUgY29tcGFyZWQuIFRoZSBvcmRlciBhbmQgcmVmZXJlbmNlcyBvZiByZXN1bHQgdmFsdWVzIGFyZQogICAqIGRldGVybWluZWQgYnkgdGhlIGZpcnN0IGFycmF5LiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZCB3aXRoIG9uZSBhcmd1bWVudDoKICAgKiAodmFsdWUpLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHsuLi5BcnJheX0gW2FycmF5c10gVGhlIGFycmF5cyB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBpbnRlcnNlY3RpbmcgdmFsdWVzLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmludGVyc2VjdGlvbkJ5KFsyLjEsIDEuMl0sIFsyLjMsIDMuNF0sIE1hdGguZmxvb3IpOwogICAqIC8vID0+IFsyLjFdCiAgICoKICAgKiAvLyBUaGUgYF8ucHJvcGVydHlgIGl0ZXJhdGVlIHNob3J0aGFuZC4KICAgKiBfLmludGVyc2VjdGlvbkJ5KFt7ICd4JzogMSB9XSwgW3sgJ3gnOiAyIH0sIHsgJ3gnOiAxIH1dLCAneCcpOwogICAqIC8vID0+IFt7ICd4JzogMSB9XQogICAqLwogIHZhciBpbnRlcnNlY3Rpb25CeSA9IGJhc2VSZXN0KGZ1bmN0aW9uKGFycmF5cykgewogICAgdmFyIGl0ZXJhdGVlID0gbGFzdChhcnJheXMpLAogICAgICAgIG1hcHBlZCA9IGFycmF5TWFwKGFycmF5cywgY2FzdEFycmF5TGlrZU9iamVjdCk7CgogICAgaWYgKGl0ZXJhdGVlID09PSBsYXN0KG1hcHBlZCkpIHsKICAgICAgaXRlcmF0ZWUgPSB1bmRlZmluZWQ7CiAgICB9IGVsc2UgewogICAgICBtYXBwZWQucG9wKCk7CiAgICB9CiAgICByZXR1cm4gKG1hcHBlZC5sZW5ndGggJiYgbWFwcGVkWzBdID09PSBhcnJheXNbMF0pCiAgICAgID8gYmFzZUludGVyc2VjdGlvbihtYXBwZWQsIGdldEl0ZXJhdGVlKGl0ZXJhdGVlLCAyKSkKICAgICAgOiBbXTsKICB9KTsKCiAgLyoqCiAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5pbnRlcnNlY3Rpb25gIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGNvbXBhcmF0b3JgCiAgICogd2hpY2ggaXMgaW52b2tlZCB0byBjb21wYXJlIGVsZW1lbnRzIG9mIGBhcnJheXNgLiBUaGUgb3JkZXIgYW5kIHJlZmVyZW5jZXMKICAgKiBvZiByZXN1bHQgdmFsdWVzIGFyZSBkZXRlcm1pbmVkIGJ5IHRoZSBmaXJzdCBhcnJheS4gVGhlIGNvbXBhcmF0b3IgaXMKICAgKiBpbnZva2VkIHdpdGggdHdvIGFyZ3VtZW50czogKGFyclZhbCwgb3RoVmFsKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7Li4uQXJyYXl9IFthcnJheXNdIFRoZSBhcnJheXMgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY29tcGFyYXRvcl0gVGhlIGNvbXBhcmF0b3IgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBpbnRlcnNlY3RpbmcgdmFsdWVzLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgb2JqZWN0cyA9IFt7ICd4JzogMSwgJ3knOiAyIH0sIHsgJ3gnOiAyLCAneSc6IDEgfV07CiAgICogdmFyIG90aGVycyA9IFt7ICd4JzogMSwgJ3knOiAxIH0sIHsgJ3gnOiAxLCAneSc6IDIgfV07CiAgICoKICAgKiBfLmludGVyc2VjdGlvbldpdGgob2JqZWN0cywgb3RoZXJzLCBfLmlzRXF1YWwpOwogICAqIC8vID0+IFt7ICd4JzogMSwgJ3knOiAyIH1dCiAgICovCiAgdmFyIGludGVyc2VjdGlvbldpdGggPSBiYXNlUmVzdChmdW5jdGlvbihhcnJheXMpIHsKICAgIHZhciBjb21wYXJhdG9yID0gbGFzdChhcnJheXMpLAogICAgICAgIG1hcHBlZCA9IGFycmF5TWFwKGFycmF5cywgY2FzdEFycmF5TGlrZU9iamVjdCk7CgogICAgY29tcGFyYXRvciA9IHR5cGVvZiBjb21wYXJhdG9yID09ICdmdW5jdGlvbicgPyBjb21wYXJhdG9yIDogdW5kZWZpbmVkOwogICAgaWYgKGNvbXBhcmF0b3IpIHsKICAgICAgbWFwcGVkLnBvcCgpOwogICAgfQogICAgcmV0dXJuIChtYXBwZWQubGVuZ3RoICYmIG1hcHBlZFswXSA9PT0gYXJyYXlzWzBdKQogICAgICA/IGJhc2VJbnRlcnNlY3Rpb24obWFwcGVkLCB1bmRlZmluZWQsIGNvbXBhcmF0b3IpCiAgICAgIDogW107CiAgfSk7CgogIC8qKgogICAqIENvbnZlcnRzIGFsbCBlbGVtZW50cyBpbiBgYXJyYXlgIGludG8gYSBzdHJpbmcgc2VwYXJhdGVkIGJ5IGBzZXBhcmF0b3JgLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGNvbnZlcnQuCiAgICogQHBhcmFtIHtzdHJpbmd9IFtzZXBhcmF0b3I9JywnXSBUaGUgZWxlbWVudCBzZXBhcmF0b3IuCiAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgam9pbmVkIHN0cmluZy4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5qb2luKFsnYScsICdiJywgJ2MnXSwgJ34nKTsKICAgKiAvLyA9PiAnYX5ifmMnCiAgICovCiAgZnVuY3Rpb24gam9pbihhcnJheSwgc2VwYXJhdG9yKSB7CiAgICByZXR1cm4gYXJyYXkgPT0gbnVsbCA/ICcnIDogbmF0aXZlSm9pbi5jYWxsKGFycmF5LCBzZXBhcmF0b3IpOwogIH0KCiAgLyoqCiAgICogR2V0cyB0aGUgbGFzdCBlbGVtZW50IG9mIGBhcnJheWAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcXVlcnkuCiAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGxhc3QgZWxlbWVudCBvZiBgYXJyYXlgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmxhc3QoWzEsIDIsIDNdKTsKICAgKiAvLyA9PiAzCiAgICovCiAgZnVuY3Rpb24gbGFzdChhcnJheSkgewogICAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoOwogICAgcmV0dXJuIGxlbmd0aCA/IGFycmF5W2xlbmd0aCAtIDFdIDogdW5kZWZpbmVkOwogIH0KCiAgLyoqCiAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5pbmRleE9mYCBleGNlcHQgdGhhdCBpdCBpdGVyYXRlcyBvdmVyIGVsZW1lbnRzIG9mCiAgICogYGFycmF5YCBmcm9tIHJpZ2h0IHRvIGxlZnQuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZWFyY2ggZm9yLgogICAqIEBwYXJhbSB7bnVtYmVyfSBbZnJvbUluZGV4PWFycmF5Lmxlbmd0aC0xXSBUaGUgaW5kZXggdG8gc2VhcmNoIGZyb20uCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIG1hdGNoZWQgdmFsdWUsIGVsc2UgYC0xYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5sYXN0SW5kZXhPZihbMSwgMiwgMSwgMl0sIDIpOwogICAqIC8vID0+IDMKICAgKgogICAqIC8vIFNlYXJjaCBmcm9tIHRoZSBgZnJvbUluZGV4YC4KICAgKiBfLmxhc3RJbmRleE9mKFsxLCAyLCAxLCAyXSwgMiwgMik7CiAgICogLy8gPT4gMQogICAqLwogIGZ1bmN0aW9uIGxhc3RJbmRleE9mKGFycmF5LCB2YWx1ZSwgZnJvbUluZGV4KSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7CiAgICBpZiAoIWxlbmd0aCkgewogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICB2YXIgaW5kZXggPSBsZW5ndGg7CiAgICBpZiAoZnJvbUluZGV4ICE9PSB1bmRlZmluZWQpIHsKICAgICAgaW5kZXggPSB0b0ludGVnZXIoZnJvbUluZGV4KTsKICAgICAgaW5kZXggPSBpbmRleCA8IDAgPyBuYXRpdmVNYXgobGVuZ3RoICsgaW5kZXgsIDApIDogbmF0aXZlTWluKGluZGV4LCBsZW5ndGggLSAxKTsKICAgIH0KICAgIHJldHVybiB2YWx1ZSA9PT0gdmFsdWUKICAgICAgPyBzdHJpY3RMYXN0SW5kZXhPZihhcnJheSwgdmFsdWUsIGluZGV4KQogICAgICA6IGJhc2VGaW5kSW5kZXgoYXJyYXksIGJhc2VJc05hTiwgaW5kZXgsIHRydWUpOwogIH0KCiAgLyoqCiAgICogR2V0cyB0aGUgZWxlbWVudCBhdCBpbmRleCBgbmAgb2YgYGFycmF5YC4gSWYgYG5gIGlzIG5lZ2F0aXZlLCB0aGUgbnRoCiAgICogZWxlbWVudCBmcm9tIHRoZSBlbmQgaXMgcmV0dXJuZWQuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4xMS4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7bnVtYmVyfSBbbj0wXSBUaGUgaW5kZXggb2YgdGhlIGVsZW1lbnQgdG8gcmV0dXJuLgogICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBudGggZWxlbWVudCBvZiBgYXJyYXlgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgYXJyYXkgPSBbJ2EnLCAnYicsICdjJywgJ2QnXTsKICAgKgogICAqIF8ubnRoKGFycmF5LCAxKTsKICAgKiAvLyA9PiAnYicKICAgKgogICAqIF8ubnRoKGFycmF5LCAtMik7CiAgICogLy8gPT4gJ2MnOwogICAqLwogIGZ1bmN0aW9uIG50aChhcnJheSwgbikgewogICAgcmV0dXJuIChhcnJheSAmJiBhcnJheS5sZW5ndGgpID8gYmFzZU50aChhcnJheSwgdG9JbnRlZ2VyKG4pKSA6IHVuZGVmaW5lZDsKICB9CgogIC8qKgogICAqIFJlbW92ZXMgYWxsIGdpdmVuIHZhbHVlcyBmcm9tIGBhcnJheWAgdXNpbmcKICAgKiBbYFNhbWVWYWx1ZVplcm9gXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1zYW1ldmFsdWV6ZXJvKQogICAqIGZvciBlcXVhbGl0eSBjb21wYXJpc29ucy4KICAgKgogICAqICoqTm90ZToqKiBVbmxpa2UgYF8ud2l0aG91dGAsIHRoaXMgbWV0aG9kIG11dGF0ZXMgYGFycmF5YC4gVXNlIGBfLnJlbW92ZWAKICAgKiB0byByZW1vdmUgZWxlbWVudHMgZnJvbSBhbiBhcnJheSBieSBwcmVkaWNhdGUuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMi4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gbW9kaWZ5LgogICAqIEBwYXJhbSB7Li4uKn0gW3ZhbHVlc10gVGhlIHZhbHVlcyB0byByZW1vdmUuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGBhcnJheWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBhcnJheSA9IFsnYScsICdiJywgJ2MnLCAnYScsICdiJywgJ2MnXTsKICAgKgogICAqIF8ucHVsbChhcnJheSwgJ2EnLCAnYycpOwogICAqIGNvbnNvbGUubG9nKGFycmF5KTsKICAgKiAvLyA9PiBbJ2InLCAnYiddCiAgICovCiAgdmFyIHB1bGwgPSBiYXNlUmVzdChwdWxsQWxsKTsKCiAgLyoqCiAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5wdWxsYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGFuIGFycmF5IG9mIHZhbHVlcyB0byByZW1vdmUuCiAgICoKICAgKiAqKk5vdGU6KiogVW5saWtlIGBfLmRpZmZlcmVuY2VgLCB0aGlzIG1ldGhvZCBtdXRhdGVzIGBhcnJheWAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gbW9kaWZ5LgogICAqIEBwYXJhbSB7QXJyYXl9IHZhbHVlcyBUaGUgdmFsdWVzIHRvIHJlbW92ZS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIGFycmF5ID0gWydhJywgJ2InLCAnYycsICdhJywgJ2InLCAnYyddOwogICAqCiAgICogXy5wdWxsQWxsKGFycmF5LCBbJ2EnLCAnYyddKTsKICAgKiBjb25zb2xlLmxvZyhhcnJheSk7CiAgICogLy8gPT4gWydiJywgJ2InXQogICAqLwogIGZ1bmN0aW9uIHB1bGxBbGwoYXJyYXksIHZhbHVlcykgewogICAgcmV0dXJuIChhcnJheSAmJiBhcnJheS5sZW5ndGggJiYgdmFsdWVzICYmIHZhbHVlcy5sZW5ndGgpCiAgICAgID8gYmFzZVB1bGxBbGwoYXJyYXksIHZhbHVlcykKICAgICAgOiBhcnJheTsKICB9CgogIC8qKgogICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8ucHVsbEFsbGAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgaXRlcmF0ZWVgIHdoaWNoIGlzCiAgICogaW52b2tlZCBmb3IgZWFjaCBlbGVtZW50IG9mIGBhcnJheWAgYW5kIGB2YWx1ZXNgIHRvIGdlbmVyYXRlIHRoZSBjcml0ZXJpb24KICAgKiBieSB3aGljaCB0aGV5J3JlIGNvbXBhcmVkLiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZCB3aXRoIG9uZSBhcmd1bWVudDogKHZhbHVlKS4KICAgKgogICAqICoqTm90ZToqKiBVbmxpa2UgYF8uZGlmZmVyZW5jZUJ5YCwgdGhpcyBtZXRob2QgbXV0YXRlcyBgYXJyYXlgLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIG1vZGlmeS4KICAgKiBAcGFyYW0ge0FycmF5fSB2YWx1ZXMgVGhlIHZhbHVlcyB0byByZW1vdmUuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBpdGVyYXRlZSBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBgYXJyYXlgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgYXJyYXkgPSBbeyAneCc6IDEgfSwgeyAneCc6IDIgfSwgeyAneCc6IDMgfSwgeyAneCc6IDEgfV07CiAgICoKICAgKiBfLnB1bGxBbGxCeShhcnJheSwgW3sgJ3gnOiAxIH0sIHsgJ3gnOiAzIH1dLCAneCcpOwogICAqIGNvbnNvbGUubG9nKGFycmF5KTsKICAgKiAvLyA9PiBbeyAneCc6IDIgfV0KICAgKi8KICBmdW5jdGlvbiBwdWxsQWxsQnkoYXJyYXksIHZhbHVlcywgaXRlcmF0ZWUpIHsKICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoICYmIHZhbHVlcyAmJiB2YWx1ZXMubGVuZ3RoKQogICAgICA/IGJhc2VQdWxsQWxsKGFycmF5LCB2YWx1ZXMsIGdldEl0ZXJhdGVlKGl0ZXJhdGVlLCAyKSkKICAgICAgOiBhcnJheTsKICB9CgogIC8qKgogICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8ucHVsbEFsbGAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgY29tcGFyYXRvcmAgd2hpY2gKICAgKiBpcyBpbnZva2VkIHRvIGNvbXBhcmUgZWxlbWVudHMgb2YgYGFycmF5YCB0byBgdmFsdWVzYC4gVGhlIGNvbXBhcmF0b3IgaXMKICAgKiBpbnZva2VkIHdpdGggdHdvIGFyZ3VtZW50czogKGFyclZhbCwgb3RoVmFsKS4KICAgKgogICAqICoqTm90ZToqKiBVbmxpa2UgYF8uZGlmZmVyZW5jZVdpdGhgLCB0aGlzIG1ldGhvZCBtdXRhdGVzIGBhcnJheWAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC42LjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gbW9kaWZ5LgogICAqIEBwYXJhbSB7QXJyYXl9IHZhbHVlcyBUaGUgdmFsdWVzIHRvIHJlbW92ZS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY29tcGFyYXRvcl0gVGhlIGNvbXBhcmF0b3IgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIGFycmF5ID0gW3sgJ3gnOiAxLCAneSc6IDIgfSwgeyAneCc6IDMsICd5JzogNCB9LCB7ICd4JzogNSwgJ3knOiA2IH1dOwogICAqCiAgICogXy5wdWxsQWxsV2l0aChhcnJheSwgW3sgJ3gnOiAzLCAneSc6IDQgfV0sIF8uaXNFcXVhbCk7CiAgICogY29uc29sZS5sb2coYXJyYXkpOwogICAqIC8vID0+IFt7ICd4JzogMSwgJ3knOiAyIH0sIHsgJ3gnOiA1LCAneSc6IDYgfV0KICAgKi8KICBmdW5jdGlvbiBwdWxsQWxsV2l0aChhcnJheSwgdmFsdWVzLCBjb21wYXJhdG9yKSB7CiAgICByZXR1cm4gKGFycmF5ICYmIGFycmF5Lmxlbmd0aCAmJiB2YWx1ZXMgJiYgdmFsdWVzLmxlbmd0aCkKICAgICAgPyBiYXNlUHVsbEFsbChhcnJheSwgdmFsdWVzLCB1bmRlZmluZWQsIGNvbXBhcmF0b3IpCiAgICAgIDogYXJyYXk7CiAgfQoKICAvKioKICAgKiBSZW1vdmVzIGVsZW1lbnRzIGZyb20gYGFycmF5YCBjb3JyZXNwb25kaW5nIHRvIGBpbmRleGVzYCBhbmQgcmV0dXJucyBhbgogICAqIGFycmF5IG9mIHJlbW92ZWQgZWxlbWVudHMuCiAgICoKICAgKiAqKk5vdGU6KiogVW5saWtlIGBfLmF0YCwgdGhpcyBtZXRob2QgbXV0YXRlcyBgYXJyYXlgLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDMuMC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIG1vZGlmeS4KICAgKiBAcGFyYW0gey4uLihudW1iZXJ8bnVtYmVyW10pfSBbaW5kZXhlc10gVGhlIGluZGV4ZXMgb2YgZWxlbWVudHMgdG8gcmVtb3ZlLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIHJlbW92ZWQgZWxlbWVudHMuCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBhcnJheSA9IFsnYScsICdiJywgJ2MnLCAnZCddOwogICAqIHZhciBwdWxsZWQgPSBfLnB1bGxBdChhcnJheSwgWzEsIDNdKTsKICAgKgogICAqIGNvbnNvbGUubG9nKGFycmF5KTsKICAgKiAvLyA9PiBbJ2EnLCAnYyddCiAgICoKICAgKiBjb25zb2xlLmxvZyhwdWxsZWQpOwogICAqIC8vID0+IFsnYicsICdkJ10KICAgKi8KICB2YXIgcHVsbEF0ID0gZmxhdFJlc3QoZnVuY3Rpb24oYXJyYXksIGluZGV4ZXMpIHsKICAgIHZhciBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aCwKICAgICAgICByZXN1bHQgPSBiYXNlQXQoYXJyYXksIGluZGV4ZXMpOwoKICAgIGJhc2VQdWxsQXQoYXJyYXksIGFycmF5TWFwKGluZGV4ZXMsIGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgIHJldHVybiBpc0luZGV4KGluZGV4LCBsZW5ndGgpID8gK2luZGV4IDogaW5kZXg7CiAgICB9KS5zb3J0KGNvbXBhcmVBc2NlbmRpbmcpKTsKCiAgICByZXR1cm4gcmVzdWx0OwogIH0pOwoKICAvKioKICAgKiBSZW1vdmVzIGFsbCBlbGVtZW50cyBmcm9tIGBhcnJheWAgdGhhdCBgcHJlZGljYXRlYCByZXR1cm5zIHRydXRoeSBmb3IKICAgKiBhbmQgcmV0dXJucyBhbiBhcnJheSBvZiB0aGUgcmVtb3ZlZCBlbGVtZW50cy4gVGhlIHByZWRpY2F0ZSBpcyBpbnZva2VkCiAgICogd2l0aCB0aHJlZSBhcmd1bWVudHM6ICh2YWx1ZSwgaW5kZXgsIGFycmF5KS4KICAgKgogICAqICoqTm90ZToqKiBVbmxpa2UgYF8uZmlsdGVyYCwgdGhpcyBtZXRob2QgbXV0YXRlcyBgYXJyYXlgLiBVc2UgYF8ucHVsbGAKICAgKiB0byBwdWxsIGVsZW1lbnRzIGZyb20gYW4gYXJyYXkgYnkgdmFsdWUuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMi4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gbW9kaWZ5LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtwcmVkaWNhdGU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiByZW1vdmVkIGVsZW1lbnRzLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgYXJyYXkgPSBbMSwgMiwgMywgNF07CiAgICogdmFyIGV2ZW5zID0gXy5yZW1vdmUoYXJyYXksIGZ1bmN0aW9uKG4pIHsKICAgKiAgIHJldHVybiBuICUgMiA9PSAwOwogICAqIH0pOwogICAqCiAgICogY29uc29sZS5sb2coYXJyYXkpOwogICAqIC8vID0+IFsxLCAzXQogICAqCiAgICogY29uc29sZS5sb2coZXZlbnMpOwogICAqIC8vID0+IFsyLCA0XQogICAqLwogIGZ1bmN0aW9uIHJlbW92ZShhcnJheSwgcHJlZGljYXRlKSB7CiAgICB2YXIgcmVzdWx0ID0gW107CiAgICBpZiAoIShhcnJheSAmJiBhcnJheS5sZW5ndGgpKSB7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICBpbmRleGVzID0gW10sCiAgICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwoKICAgIHByZWRpY2F0ZSA9IGdldEl0ZXJhdGVlKHByZWRpY2F0ZSwgMyk7CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICB2YXIgdmFsdWUgPSBhcnJheVtpbmRleF07CiAgICAgIGlmIChwcmVkaWNhdGUodmFsdWUsIGluZGV4LCBhcnJheSkpIHsKICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSk7CiAgICAgICAgaW5kZXhlcy5wdXNoKGluZGV4KTsKICAgICAgfQogICAgfQogICAgYmFzZVB1bGxBdChhcnJheSwgaW5kZXhlcyk7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogUmV2ZXJzZXMgYGFycmF5YCBzbyB0aGF0IHRoZSBmaXJzdCBlbGVtZW50IGJlY29tZXMgdGhlIGxhc3QsIHRoZSBzZWNvbmQKICAgKiBlbGVtZW50IGJlY29tZXMgdGhlIHNlY29uZCB0byBsYXN0LCBhbmQgc28gb24uCiAgICoKICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgbXV0YXRlcyBgYXJyYXlgIGFuZCBpcyBiYXNlZCBvbgogICAqIFtgQXJyYXkjcmV2ZXJzZWBdKGh0dHBzOi8vbWRuLmlvL0FycmF5L3JldmVyc2UpLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIG1vZGlmeS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIGFycmF5ID0gWzEsIDIsIDNdOwogICAqCiAgICogXy5yZXZlcnNlKGFycmF5KTsKICAgKiAvLyA9PiBbMywgMiwgMV0KICAgKgogICAqIGNvbnNvbGUubG9nKGFycmF5KTsKICAgKiAvLyA9PiBbMywgMiwgMV0KICAgKi8KICBmdW5jdGlvbiByZXZlcnNlKGFycmF5KSB7CiAgICByZXR1cm4gYXJyYXkgPT0gbnVsbCA/IGFycmF5IDogbmF0aXZlUmV2ZXJzZS5jYWxsKGFycmF5KTsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBzbGljZSBvZiBgYXJyYXlgIGZyb20gYHN0YXJ0YCB1cCB0bywgYnV0IG5vdCBpbmNsdWRpbmcsIGBlbmRgLgogICAqCiAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIHVzZWQgaW5zdGVhZCBvZgogICAqIFtgQXJyYXkjc2xpY2VgXShodHRwczovL21kbi5pby9BcnJheS9zbGljZSkgdG8gZW5zdXJlIGRlbnNlIGFycmF5cyBhcmUKICAgKiByZXR1cm5lZC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBzbGljZS4KICAgKiBAcGFyYW0ge251bWJlcn0gW3N0YXJ0PTBdIFRoZSBzdGFydCBwb3NpdGlvbi4KICAgKiBAcGFyYW0ge251bWJlcn0gW2VuZD1hcnJheS5sZW5ndGhdIFRoZSBlbmQgcG9zaXRpb24uCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLgogICAqLwogIGZ1bmN0aW9uIHNsaWNlKGFycmF5LCBzdGFydCwgZW5kKSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7CiAgICBpZiAoIWxlbmd0aCkgewogICAgICByZXR1cm4gW107CiAgICB9CiAgICBpZiAoZW5kICYmIHR5cGVvZiBlbmQgIT0gJ251bWJlcicgJiYgaXNJdGVyYXRlZUNhbGwoYXJyYXksIHN0YXJ0LCBlbmQpKSB7CiAgICAgIHN0YXJ0ID0gMDsKICAgICAgZW5kID0gbGVuZ3RoOwogICAgfQogICAgZWxzZSB7CiAgICAgIHN0YXJ0ID0gc3RhcnQgPT0gbnVsbCA/IDAgOiB0b0ludGVnZXIoc3RhcnQpOwogICAgICBlbmQgPSBlbmQgPT09IHVuZGVmaW5lZCA/IGxlbmd0aCA6IHRvSW50ZWdlcihlbmQpOwogICAgfQogICAgcmV0dXJuIGJhc2VTbGljZShhcnJheSwgc3RhcnQsIGVuZCk7CiAgfQoKICAvKioKICAgKiBVc2VzIGEgYmluYXJ5IHNlYXJjaCB0byBkZXRlcm1pbmUgdGhlIGxvd2VzdCBpbmRleCBhdCB3aGljaCBgdmFsdWVgCiAgICogc2hvdWxkIGJlIGluc2VydGVkIGludG8gYGFycmF5YCBpbiBvcmRlciB0byBtYWludGFpbiBpdHMgc29ydCBvcmRlci4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBzb3J0ZWQgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBldmFsdWF0ZS4KICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBhdCB3aGljaCBgdmFsdWVgIHNob3VsZCBiZSBpbnNlcnRlZAogICAqICBpbnRvIGBhcnJheWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uc29ydGVkSW5kZXgoWzMwLCA1MF0sIDQwKTsKICAgKiAvLyA9PiAxCiAgICovCiAgZnVuY3Rpb24gc29ydGVkSW5kZXgoYXJyYXksIHZhbHVlKSB7CiAgICByZXR1cm4gYmFzZVNvcnRlZEluZGV4KGFycmF5LCB2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnNvcnRlZEluZGV4YCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGBpdGVyYXRlZWAKICAgKiB3aGljaCBpcyBpbnZva2VkIGZvciBgdmFsdWVgIGFuZCBlYWNoIGVsZW1lbnQgb2YgYGFycmF5YCB0byBjb21wdXRlIHRoZWlyCiAgICogc29ydCByYW5raW5nLiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZCB3aXRoIG9uZSBhcmd1bWVudDogKHZhbHVlKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBzb3J0ZWQgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBldmFsdWF0ZS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGl0ZXJhdGVlIGludm9rZWQgcGVyIGVsZW1lbnQuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggYXQgd2hpY2ggYHZhbHVlYCBzaG91bGQgYmUgaW5zZXJ0ZWQKICAgKiAgaW50byBgYXJyYXlgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgb2JqZWN0cyA9IFt7ICd4JzogNCB9LCB7ICd4JzogNSB9XTsKICAgKgogICAqIF8uc29ydGVkSW5kZXhCeShvYmplY3RzLCB7ICd4JzogNCB9LCBmdW5jdGlvbihvKSB7IHJldHVybiBvLng7IH0pOwogICAqIC8vID0+IDAKICAgKgogICAqIC8vIFRoZSBgXy5wcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLgogICAqIF8uc29ydGVkSW5kZXhCeShvYmplY3RzLCB7ICd4JzogNCB9LCAneCcpOwogICAqIC8vID0+IDAKICAgKi8KICBmdW5jdGlvbiBzb3J0ZWRJbmRleEJ5KGFycmF5LCB2YWx1ZSwgaXRlcmF0ZWUpIHsKICAgIHJldHVybiBiYXNlU29ydGVkSW5kZXhCeShhcnJheSwgdmFsdWUsIGdldEl0ZXJhdGVlKGl0ZXJhdGVlLCAyKSk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmluZGV4T2ZgIGV4Y2VwdCB0aGF0IGl0IHBlcmZvcm1zIGEgYmluYXJ5CiAgICogc2VhcmNoIG9uIGEgc29ydGVkIGBhcnJheWAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZWFyY2ggZm9yLgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBtYXRjaGVkIHZhbHVlLCBlbHNlIGAtMWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uc29ydGVkSW5kZXhPZihbNCwgNSwgNSwgNSwgNl0sIDUpOwogICAqIC8vID0+IDEKICAgKi8KICBmdW5jdGlvbiBzb3J0ZWRJbmRleE9mKGFycmF5LCB2YWx1ZSkgewogICAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoOwogICAgaWYgKGxlbmd0aCkgewogICAgICB2YXIgaW5kZXggPSBiYXNlU29ydGVkSW5kZXgoYXJyYXksIHZhbHVlKTsKICAgICAgaWYgKGluZGV4IDwgbGVuZ3RoICYmIGVxKGFycmF5W2luZGV4XSwgdmFsdWUpKSB7CiAgICAgICAgcmV0dXJuIGluZGV4OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gLTE7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnNvcnRlZEluZGV4YCBleGNlcHQgdGhhdCBpdCByZXR1cm5zIHRoZSBoaWdoZXN0CiAgICogaW5kZXggYXQgd2hpY2ggYHZhbHVlYCBzaG91bGQgYmUgaW5zZXJ0ZWQgaW50byBgYXJyYXlgIGluIG9yZGVyIHRvCiAgICogbWFpbnRhaW4gaXRzIHNvcnQgb3JkZXIuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMy4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgc29ydGVkIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gZXZhbHVhdGUuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggYXQgd2hpY2ggYHZhbHVlYCBzaG91bGQgYmUgaW5zZXJ0ZWQKICAgKiAgaW50byBgYXJyYXlgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnNvcnRlZExhc3RJbmRleChbNCwgNSwgNSwgNSwgNl0sIDUpOwogICAqIC8vID0+IDQKICAgKi8KICBmdW5jdGlvbiBzb3J0ZWRMYXN0SW5kZXgoYXJyYXksIHZhbHVlKSB7CiAgICByZXR1cm4gYmFzZVNvcnRlZEluZGV4KGFycmF5LCB2YWx1ZSwgdHJ1ZSk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnNvcnRlZExhc3RJbmRleGAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgaXRlcmF0ZWVgCiAgICogd2hpY2ggaXMgaW52b2tlZCBmb3IgYHZhbHVlYCBhbmQgZWFjaCBlbGVtZW50IG9mIGBhcnJheWAgdG8gY29tcHV0ZSB0aGVpcgogICAqIHNvcnQgcmFua2luZy4gVGhlIGl0ZXJhdGVlIGlzIGludm9rZWQgd2l0aCBvbmUgYXJndW1lbnQ6ICh2YWx1ZSkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgc29ydGVkIGFycmF5IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gZXZhbHVhdGUuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2l0ZXJhdGVlPV8uaWRlbnRpdHldIFRoZSBpdGVyYXRlZSBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGluZGV4IGF0IHdoaWNoIGB2YWx1ZWAgc2hvdWxkIGJlIGluc2VydGVkCiAgICogIGludG8gYGFycmF5YC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIG9iamVjdHMgPSBbeyAneCc6IDQgfSwgeyAneCc6IDUgfV07CiAgICoKICAgKiBfLnNvcnRlZExhc3RJbmRleEJ5KG9iamVjdHMsIHsgJ3gnOiA0IH0sIGZ1bmN0aW9uKG8pIHsgcmV0dXJuIG8ueDsgfSk7CiAgICogLy8gPT4gMQogICAqCiAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy5zb3J0ZWRMYXN0SW5kZXhCeShvYmplY3RzLCB7ICd4JzogNCB9LCAneCcpOwogICAqIC8vID0+IDEKICAgKi8KICBmdW5jdGlvbiBzb3J0ZWRMYXN0SW5kZXhCeShhcnJheSwgdmFsdWUsIGl0ZXJhdGVlKSB7CiAgICByZXR1cm4gYmFzZVNvcnRlZEluZGV4QnkoYXJyYXksIHZhbHVlLCBnZXRJdGVyYXRlZShpdGVyYXRlZSwgMiksIHRydWUpOwogIH0KCiAgLyoqCiAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5sYXN0SW5kZXhPZmAgZXhjZXB0IHRoYXQgaXQgcGVyZm9ybXMgYSBiaW5hcnkKICAgKiBzZWFyY2ggb24gYSBzb3J0ZWQgYGFycmF5YC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNlYXJjaCBmb3IuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIG1hdGNoZWQgdmFsdWUsIGVsc2UgYC0xYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5zb3J0ZWRMYXN0SW5kZXhPZihbNCwgNSwgNSwgNSwgNl0sIDUpOwogICAqIC8vID0+IDMKICAgKi8KICBmdW5jdGlvbiBzb3J0ZWRMYXN0SW5kZXhPZihhcnJheSwgdmFsdWUpIHsKICAgIHZhciBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDsKICAgIGlmIChsZW5ndGgpIHsKICAgICAgdmFyIGluZGV4ID0gYmFzZVNvcnRlZEluZGV4KGFycmF5LCB2YWx1ZSwgdHJ1ZSkgLSAxOwogICAgICBpZiAoZXEoYXJyYXlbaW5kZXhdLCB2YWx1ZSkpIHsKICAgICAgICByZXR1cm4gaW5kZXg7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAtMTsKICB9CgogIC8qKgogICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8udW5pcWAgZXhjZXB0IHRoYXQgaXQncyBkZXNpZ25lZCBhbmQgb3B0aW1pemVkCiAgICogZm9yIHNvcnRlZCBhcnJheXMuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBkdXBsaWNhdGUgZnJlZSBhcnJheS4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5zb3J0ZWRVbmlxKFsxLCAxLCAyXSk7CiAgICogLy8gPT4gWzEsIDJdCiAgICovCiAgZnVuY3Rpb24gc29ydGVkVW5pcShhcnJheSkgewogICAgcmV0dXJuIChhcnJheSAmJiBhcnJheS5sZW5ndGgpCiAgICAgID8gYmFzZVNvcnRlZFVuaXEoYXJyYXkpCiAgICAgIDogW107CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnVuaXFCeWAgZXhjZXB0IHRoYXQgaXQncyBkZXNpZ25lZCBhbmQgb3B0aW1pemVkCiAgICogZm9yIHNvcnRlZCBhcnJheXMuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWVdIFRoZSBpdGVyYXRlZSBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGR1cGxpY2F0ZSBmcmVlIGFycmF5LgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnNvcnRlZFVuaXFCeShbMS4xLCAxLjIsIDIuMywgMi40XSwgTWF0aC5mbG9vcik7CiAgICogLy8gPT4gWzEuMSwgMi4zXQogICAqLwogIGZ1bmN0aW9uIHNvcnRlZFVuaXFCeShhcnJheSwgaXRlcmF0ZWUpIHsKICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKQogICAgICA/IGJhc2VTb3J0ZWRVbmlxKGFycmF5LCBnZXRJdGVyYXRlZShpdGVyYXRlZSwgMikpCiAgICAgIDogW107CiAgfQoKICAvKioKICAgKiBHZXRzIGFsbCBidXQgdGhlIGZpcnN0IGVsZW1lbnQgb2YgYGFycmF5YC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHNsaWNlIG9mIGBhcnJheWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8udGFpbChbMSwgMiwgM10pOwogICAqIC8vID0+IFsyLCAzXQogICAqLwogIGZ1bmN0aW9uIHRhaWwoYXJyYXkpIHsKICAgIHZhciBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDsKICAgIHJldHVybiBsZW5ndGggPyBiYXNlU2xpY2UoYXJyYXksIDEsIGxlbmd0aCkgOiBbXTsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBzbGljZSBvZiBgYXJyYXlgIHdpdGggYG5gIGVsZW1lbnRzIHRha2VuIGZyb20gdGhlIGJlZ2lubmluZy4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS4KICAgKiBAcGFyYW0ge251bWJlcn0gW249MV0gVGhlIG51bWJlciBvZiBlbGVtZW50cyB0byB0YWtlLgogICAqIEBwYXJhbS0ge09iamVjdH0gW2d1YXJkXSBFbmFibGVzIHVzZSBhcyBhbiBpdGVyYXRlZSBmb3IgbWV0aG9kcyBsaWtlIGBfLm1hcGAuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnRha2UoWzEsIDIsIDNdKTsKICAgKiAvLyA9PiBbMV0KICAgKgogICAqIF8udGFrZShbMSwgMiwgM10sIDIpOwogICAqIC8vID0+IFsxLCAyXQogICAqCiAgICogXy50YWtlKFsxLCAyLCAzXSwgNSk7CiAgICogLy8gPT4gWzEsIDIsIDNdCiAgICoKICAgKiBfLnRha2UoWzEsIDIsIDNdLCAwKTsKICAgKiAvLyA9PiBbXQogICAqLwogIGZ1bmN0aW9uIHRha2UoYXJyYXksIG4sIGd1YXJkKSB7CiAgICBpZiAoIShhcnJheSAmJiBhcnJheS5sZW5ndGgpKSB7CiAgICAgIHJldHVybiBbXTsKICAgIH0KICAgIG4gPSAoZ3VhcmQgfHwgbiA9PT0gdW5kZWZpbmVkKSA/IDEgOiB0b0ludGVnZXIobik7CiAgICByZXR1cm4gYmFzZVNsaWNlKGFycmF5LCAwLCBuIDwgMCA/IDAgOiBuKTsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBzbGljZSBvZiBgYXJyYXlgIHdpdGggYG5gIGVsZW1lbnRzIHRha2VuIGZyb20gdGhlIGVuZC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS4KICAgKiBAcGFyYW0ge251bWJlcn0gW249MV0gVGhlIG51bWJlciBvZiBlbGVtZW50cyB0byB0YWtlLgogICAqIEBwYXJhbS0ge09iamVjdH0gW2d1YXJkXSBFbmFibGVzIHVzZSBhcyBhbiBpdGVyYXRlZSBmb3IgbWV0aG9kcyBsaWtlIGBfLm1hcGAuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnRha2VSaWdodChbMSwgMiwgM10pOwogICAqIC8vID0+IFszXQogICAqCiAgICogXy50YWtlUmlnaHQoWzEsIDIsIDNdLCAyKTsKICAgKiAvLyA9PiBbMiwgM10KICAgKgogICAqIF8udGFrZVJpZ2h0KFsxLCAyLCAzXSwgNSk7CiAgICogLy8gPT4gWzEsIDIsIDNdCiAgICoKICAgKiBfLnRha2VSaWdodChbMSwgMiwgM10sIDApOwogICAqIC8vID0+IFtdCiAgICovCiAgZnVuY3Rpb24gdGFrZVJpZ2h0KGFycmF5LCBuLCBndWFyZCkgewogICAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoOwogICAgaWYgKCFsZW5ndGgpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfQogICAgbiA9IChndWFyZCB8fCBuID09PSB1bmRlZmluZWQpID8gMSA6IHRvSW50ZWdlcihuKTsKICAgIG4gPSBsZW5ndGggLSBuOwogICAgcmV0dXJuIGJhc2VTbGljZShhcnJheSwgbiA8IDAgPyAwIDogbiwgbGVuZ3RoKTsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBzbGljZSBvZiBgYXJyYXlgIHdpdGggZWxlbWVudHMgdGFrZW4gZnJvbSB0aGUgZW5kLiBFbGVtZW50cyBhcmUKICAgKiB0YWtlbiB1bnRpbCBgcHJlZGljYXRlYCByZXR1cm5zIGZhbHNleS4gVGhlIHByZWRpY2F0ZSBpcyBpbnZva2VkIHdpdGgKICAgKiB0aHJlZSBhcmd1bWVudHM6ICh2YWx1ZSwgaW5kZXgsIGFycmF5KS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbcHJlZGljYXRlPV8uaWRlbnRpdHldIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgdXNlcnMgPSBbCiAgICogICB7ICd1c2VyJzogJ2Jhcm5leScsICAnYWN0aXZlJzogdHJ1ZSB9LAogICAqICAgeyAndXNlcic6ICdmcmVkJywgICAgJ2FjdGl2ZSc6IGZhbHNlIH0sCiAgICogICB7ICd1c2VyJzogJ3BlYmJsZXMnLCAnYWN0aXZlJzogZmFsc2UgfQogICAqIF07CiAgICoKICAgKiBfLnRha2VSaWdodFdoaWxlKHVzZXJzLCBmdW5jdGlvbihvKSB7IHJldHVybiAhby5hY3RpdmU7IH0pOwogICAqIC8vID0+IG9iamVjdHMgZm9yIFsnZnJlZCcsICdwZWJibGVzJ10KICAgKgogICAqIC8vIFRoZSBgXy5tYXRjaGVzYCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy50YWtlUmlnaHRXaGlsZSh1c2VycywgeyAndXNlcic6ICdwZWJibGVzJywgJ2FjdGl2ZSc6IGZhbHNlIH0pOwogICAqIC8vID0+IG9iamVjdHMgZm9yIFsncGViYmxlcyddCiAgICoKICAgKiAvLyBUaGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy50YWtlUmlnaHRXaGlsZSh1c2VycywgWydhY3RpdmUnLCBmYWxzZV0pOwogICAqIC8vID0+IG9iamVjdHMgZm9yIFsnZnJlZCcsICdwZWJibGVzJ10KICAgKgogICAqIC8vIFRoZSBgXy5wcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLgogICAqIF8udGFrZVJpZ2h0V2hpbGUodXNlcnMsICdhY3RpdmUnKTsKICAgKiAvLyA9PiBbXQogICAqLwogIGZ1bmN0aW9uIHRha2VSaWdodFdoaWxlKGFycmF5LCBwcmVkaWNhdGUpIHsKICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKQogICAgICA/IGJhc2VXaGlsZShhcnJheSwgZ2V0SXRlcmF0ZWUocHJlZGljYXRlLCAzKSwgZmFsc2UsIHRydWUpCiAgICAgIDogW107CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgc2xpY2Ugb2YgYGFycmF5YCB3aXRoIGVsZW1lbnRzIHRha2VuIGZyb20gdGhlIGJlZ2lubmluZy4gRWxlbWVudHMKICAgKiBhcmUgdGFrZW4gdW50aWwgYHByZWRpY2F0ZWAgcmV0dXJucyBmYWxzZXkuIFRoZSBwcmVkaWNhdGUgaXMgaW52b2tlZCB3aXRoCiAgICogdGhyZWUgYXJndW1lbnRzOiAodmFsdWUsIGluZGV4LCBhcnJheSkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMy4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gcXVlcnkuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3ByZWRpY2F0ZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgc2xpY2Ugb2YgYGFycmF5YC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIHVzZXJzID0gWwogICAqICAgeyAndXNlcic6ICdiYXJuZXknLCAgJ2FjdGl2ZSc6IGZhbHNlIH0sCiAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICAnYWN0aXZlJzogZmFsc2UgfSwKICAgKiAgIHsgJ3VzZXInOiAncGViYmxlcycsICdhY3RpdmUnOiB0cnVlIH0KICAgKiBdOwogICAqCiAgICogXy50YWtlV2hpbGUodXNlcnMsIGZ1bmN0aW9uKG8pIHsgcmV0dXJuICFvLmFjdGl2ZTsgfSk7CiAgICogLy8gPT4gb2JqZWN0cyBmb3IgWydiYXJuZXknLCAnZnJlZCddCiAgICoKICAgKiAvLyBUaGUgYF8ubWF0Y2hlc2AgaXRlcmF0ZWUgc2hvcnRoYW5kLgogICAqIF8udGFrZVdoaWxlKHVzZXJzLCB7ICd1c2VyJzogJ2Jhcm5leScsICdhY3RpdmUnOiBmYWxzZSB9KTsKICAgKiAvLyA9PiBvYmplY3RzIGZvciBbJ2Jhcm5leSddCiAgICoKICAgKiAvLyBUaGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy50YWtlV2hpbGUodXNlcnMsIFsnYWN0aXZlJywgZmFsc2VdKTsKICAgKiAvLyA9PiBvYmplY3RzIGZvciBbJ2Jhcm5leScsICdmcmVkJ10KICAgKgogICAqIC8vIFRoZSBgXy5wcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLgogICAqIF8udGFrZVdoaWxlKHVzZXJzLCAnYWN0aXZlJyk7CiAgICogLy8gPT4gW10KICAgKi8KICBmdW5jdGlvbiB0YWtlV2hpbGUoYXJyYXksIHByZWRpY2F0ZSkgewogICAgcmV0dXJuIChhcnJheSAmJiBhcnJheS5sZW5ndGgpCiAgICAgID8gYmFzZVdoaWxlKGFycmF5LCBnZXRJdGVyYXRlZShwcmVkaWNhdGUsIDMpKQogICAgICA6IFtdOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB1bmlxdWUgdmFsdWVzLCBpbiBvcmRlciwgZnJvbSBhbGwgZ2l2ZW4gYXJyYXlzIHVzaW5nCiAgICogW2BTYW1lVmFsdWVaZXJvYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtc2FtZXZhbHVlemVybykKICAgKiBmb3IgZXF1YWxpdHkgY29tcGFyaXNvbnMuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0gey4uLkFycmF5fSBbYXJyYXlzXSBUaGUgYXJyYXlzIHRvIGluc3BlY3QuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2YgY29tYmluZWQgdmFsdWVzLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnVuaW9uKFsyXSwgWzEsIDJdKTsKICAgKiAvLyA9PiBbMiwgMV0KICAgKi8KICB2YXIgdW5pb24gPSBiYXNlUmVzdChmdW5jdGlvbihhcnJheXMpIHsKICAgIHJldHVybiBiYXNlVW5pcShiYXNlRmxhdHRlbihhcnJheXMsIDEsIGlzQXJyYXlMaWtlT2JqZWN0LCB0cnVlKSk7CiAgfSk7CgogIC8qKgogICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8udW5pb25gIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGl0ZXJhdGVlYCB3aGljaCBpcwogICAqIGludm9rZWQgZm9yIGVhY2ggZWxlbWVudCBvZiBlYWNoIGBhcnJheXNgIHRvIGdlbmVyYXRlIHRoZSBjcml0ZXJpb24gYnkKICAgKiB3aGljaCB1bmlxdWVuZXNzIGlzIGNvbXB1dGVkLiBSZXN1bHQgdmFsdWVzIGFyZSBjaG9zZW4gZnJvbSB0aGUgZmlyc3QKICAgKiBhcnJheSBpbiB3aGljaCB0aGUgdmFsdWUgb2NjdXJzLiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZCB3aXRoIG9uZSBhcmd1bWVudDoKICAgKiAodmFsdWUpLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHsuLi5BcnJheX0gW2FycmF5c10gVGhlIGFycmF5cyB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBjb21iaW5lZCB2YWx1ZXMuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8udW5pb25CeShbMi4xXSwgWzEuMiwgMi4zXSwgTWF0aC5mbG9vcik7CiAgICogLy8gPT4gWzIuMSwgMS4yXQogICAqCiAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy51bmlvbkJ5KFt7ICd4JzogMSB9XSwgW3sgJ3gnOiAyIH0sIHsgJ3gnOiAxIH1dLCAneCcpOwogICAqIC8vID0+IFt7ICd4JzogMSB9LCB7ICd4JzogMiB9XQogICAqLwogIHZhciB1bmlvbkJ5ID0gYmFzZVJlc3QoZnVuY3Rpb24oYXJyYXlzKSB7CiAgICB2YXIgaXRlcmF0ZWUgPSBsYXN0KGFycmF5cyk7CiAgICBpZiAoaXNBcnJheUxpa2VPYmplY3QoaXRlcmF0ZWUpKSB7CiAgICAgIGl0ZXJhdGVlID0gdW5kZWZpbmVkOwogICAgfQogICAgcmV0dXJuIGJhc2VVbmlxKGJhc2VGbGF0dGVuKGFycmF5cywgMSwgaXNBcnJheUxpa2VPYmplY3QsIHRydWUpLCBnZXRJdGVyYXRlZShpdGVyYXRlZSwgMikpOwogIH0pOwoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnVuaW9uYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGBjb21wYXJhdG9yYCB3aGljaAogICAqIGlzIGludm9rZWQgdG8gY29tcGFyZSBlbGVtZW50cyBvZiBgYXJyYXlzYC4gUmVzdWx0IHZhbHVlcyBhcmUgY2hvc2VuIGZyb20KICAgKiB0aGUgZmlyc3QgYXJyYXkgaW4gd2hpY2ggdGhlIHZhbHVlIG9jY3Vycy4gVGhlIGNvbXBhcmF0b3IgaXMgaW52b2tlZAogICAqIHdpdGggdHdvIGFyZ3VtZW50czogKGFyclZhbCwgb3RoVmFsKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7Li4uQXJyYXl9IFthcnJheXNdIFRoZSBhcnJheXMgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY29tcGFyYXRvcl0gVGhlIGNvbXBhcmF0b3IgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBjb21iaW5lZCB2YWx1ZXMuCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBvYmplY3RzID0gW3sgJ3gnOiAxLCAneSc6IDIgfSwgeyAneCc6IDIsICd5JzogMSB9XTsKICAgKiB2YXIgb3RoZXJzID0gW3sgJ3gnOiAxLCAneSc6IDEgfSwgeyAneCc6IDEsICd5JzogMiB9XTsKICAgKgogICAqIF8udW5pb25XaXRoKG9iamVjdHMsIG90aGVycywgXy5pc0VxdWFsKTsKICAgKiAvLyA9PiBbeyAneCc6IDEsICd5JzogMiB9LCB7ICd4JzogMiwgJ3knOiAxIH0sIHsgJ3gnOiAxLCAneSc6IDEgfV0KICAgKi8KICB2YXIgdW5pb25XaXRoID0gYmFzZVJlc3QoZnVuY3Rpb24oYXJyYXlzKSB7CiAgICB2YXIgY29tcGFyYXRvciA9IGxhc3QoYXJyYXlzKTsKICAgIGNvbXBhcmF0b3IgPSB0eXBlb2YgY29tcGFyYXRvciA9PSAnZnVuY3Rpb24nID8gY29tcGFyYXRvciA6IHVuZGVmaW5lZDsKICAgIHJldHVybiBiYXNlVW5pcShiYXNlRmxhdHRlbihhcnJheXMsIDEsIGlzQXJyYXlMaWtlT2JqZWN0LCB0cnVlKSwgdW5kZWZpbmVkLCBjb21wYXJhdG9yKTsKICB9KTsKCiAgLyoqCiAgICogQ3JlYXRlcyBhIGR1cGxpY2F0ZS1mcmVlIHZlcnNpb24gb2YgYW4gYXJyYXksIHVzaW5nCiAgICogW2BTYW1lVmFsdWVaZXJvYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtc2FtZXZhbHVlemVybykKICAgKiBmb3IgZXF1YWxpdHkgY29tcGFyaXNvbnMsIGluIHdoaWNoIG9ubHkgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgZWFjaCBlbGVtZW50CiAgICogaXMga2VwdC4gVGhlIG9yZGVyIG9mIHJlc3VsdCB2YWx1ZXMgaXMgZGV0ZXJtaW5lZCBieSB0aGUgb3JkZXIgdGhleSBvY2N1cgogICAqIGluIHRoZSBhcnJheS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGR1cGxpY2F0ZSBmcmVlIGFycmF5LgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnVuaXEoWzIsIDEsIDJdKTsKICAgKiAvLyA9PiBbMiwgMV0KICAgKi8KICBmdW5jdGlvbiB1bmlxKGFycmF5KSB7CiAgICByZXR1cm4gKGFycmF5ICYmIGFycmF5Lmxlbmd0aCkgPyBiYXNlVW5pcShhcnJheSkgOiBbXTsKICB9CgogIC8qKgogICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8udW5pcWAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgaXRlcmF0ZWVgIHdoaWNoIGlzCiAgICogaW52b2tlZCBmb3IgZWFjaCBlbGVtZW50IGluIGBhcnJheWAgdG8gZ2VuZXJhdGUgdGhlIGNyaXRlcmlvbiBieSB3aGljaAogICAqIHVuaXF1ZW5lc3MgaXMgY29tcHV0ZWQuIFRoZSBvcmRlciBvZiByZXN1bHQgdmFsdWVzIGlzIGRldGVybWluZWQgYnkgdGhlCiAgICogb3JkZXIgdGhleSBvY2N1ciBpbiB0aGUgYXJyYXkuIFRoZSBpdGVyYXRlZSBpcyBpbnZva2VkIHdpdGggb25lIGFyZ3VtZW50OgogICAqICh2YWx1ZSkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGl0ZXJhdGVlIGludm9rZWQgcGVyIGVsZW1lbnQuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgZHVwbGljYXRlIGZyZWUgYXJyYXkuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8udW5pcUJ5KFsyLjEsIDEuMiwgMi4zXSwgTWF0aC5mbG9vcik7CiAgICogLy8gPT4gWzIuMSwgMS4yXQogICAqCiAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy51bmlxQnkoW3sgJ3gnOiAxIH0sIHsgJ3gnOiAyIH0sIHsgJ3gnOiAxIH1dLCAneCcpOwogICAqIC8vID0+IFt7ICd4JzogMSB9LCB7ICd4JzogMiB9XQogICAqLwogIGZ1bmN0aW9uIHVuaXFCeShhcnJheSwgaXRlcmF0ZWUpIHsKICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKSA/IGJhc2VVbmlxKGFycmF5LCBnZXRJdGVyYXRlZShpdGVyYXRlZSwgMikpIDogW107CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnVuaXFgIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGNvbXBhcmF0b3JgIHdoaWNoCiAgICogaXMgaW52b2tlZCB0byBjb21wYXJlIGVsZW1lbnRzIG9mIGBhcnJheWAuIFRoZSBvcmRlciBvZiByZXN1bHQgdmFsdWVzIGlzCiAgICogZGV0ZXJtaW5lZCBieSB0aGUgb3JkZXIgdGhleSBvY2N1ciBpbiB0aGUgYXJyYXkuVGhlIGNvbXBhcmF0b3IgaXMgaW52b2tlZAogICAqIHdpdGggdHdvIGFyZ3VtZW50czogKGFyclZhbCwgb3RoVmFsKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjb21wYXJhdG9yXSBUaGUgY29tcGFyYXRvciBpbnZva2VkIHBlciBlbGVtZW50LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGR1cGxpY2F0ZSBmcmVlIGFycmF5LgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgb2JqZWN0cyA9IFt7ICd4JzogMSwgJ3knOiAyIH0sIHsgJ3gnOiAyLCAneSc6IDEgfSwgeyAneCc6IDEsICd5JzogMiB9XTsKICAgKgogICAqIF8udW5pcVdpdGgob2JqZWN0cywgXy5pc0VxdWFsKTsKICAgKiAvLyA9PiBbeyAneCc6IDEsICd5JzogMiB9LCB7ICd4JzogMiwgJ3knOiAxIH1dCiAgICovCiAgZnVuY3Rpb24gdW5pcVdpdGgoYXJyYXksIGNvbXBhcmF0b3IpIHsKICAgIGNvbXBhcmF0b3IgPSB0eXBlb2YgY29tcGFyYXRvciA9PSAnZnVuY3Rpb24nID8gY29tcGFyYXRvciA6IHVuZGVmaW5lZDsKICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKSA/IGJhc2VVbmlxKGFycmF5LCB1bmRlZmluZWQsIGNvbXBhcmF0b3IpIDogW107CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnppcGAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBhbiBhcnJheSBvZiBncm91cGVkCiAgICogZWxlbWVudHMgYW5kIGNyZWF0ZXMgYW4gYXJyYXkgcmVncm91cGluZyB0aGUgZWxlbWVudHMgdG8gdGhlaXIgcHJlLXppcAogICAqIGNvbmZpZ3VyYXRpb24uCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMS4yLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgb2YgZ3JvdXBlZCBlbGVtZW50cyB0byBwcm9jZXNzLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIHJlZ3JvdXBlZCBlbGVtZW50cy4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIHppcHBlZCA9IF8uemlwKFsnYScsICdiJ10sIFsxLCAyXSwgW3RydWUsIGZhbHNlXSk7CiAgICogLy8gPT4gW1snYScsIDEsIHRydWVdLCBbJ2InLCAyLCBmYWxzZV1dCiAgICoKICAgKiBfLnVuemlwKHppcHBlZCk7CiAgICogLy8gPT4gW1snYScsICdiJ10sIFsxLCAyXSwgW3RydWUsIGZhbHNlXV0KICAgKi8KICBmdW5jdGlvbiB1bnppcChhcnJheSkgewogICAgaWYgKCEoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKSkgewogICAgICByZXR1cm4gW107CiAgICB9CiAgICB2YXIgbGVuZ3RoID0gMDsKICAgIGFycmF5ID0gYXJyYXlGaWx0ZXIoYXJyYXksIGZ1bmN0aW9uKGdyb3VwKSB7CiAgICAgIGlmIChpc0FycmF5TGlrZU9iamVjdChncm91cCkpIHsKICAgICAgICBsZW5ndGggPSBuYXRpdmVNYXgoZ3JvdXAubGVuZ3RoLCBsZW5ndGgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBiYXNlVGltZXMobGVuZ3RoLCBmdW5jdGlvbihpbmRleCkgewogICAgICByZXR1cm4gYXJyYXlNYXAoYXJyYXksIGJhc2VQcm9wZXJ0eShpbmRleCkpOwogICAgfSk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnVuemlwYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGBpdGVyYXRlZWAgdG8gc3BlY2lmeQogICAqIGhvdyByZWdyb3VwZWQgdmFsdWVzIHNob3VsZCBiZSBjb21iaW5lZC4gVGhlIGl0ZXJhdGVlIGlzIGludm9rZWQgd2l0aCB0aGUKICAgKiBlbGVtZW50cyBvZiBlYWNoIGdyb3VwOiAoLi4uZ3JvdXApLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDMuOC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IG9mIGdyb3VwZWQgZWxlbWVudHMgdG8gcHJvY2Vzcy4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIHRvIGNvbWJpbmUKICAgKiAgcmVncm91cGVkIHZhbHVlcy4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiByZWdyb3VwZWQgZWxlbWVudHMuCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciB6aXBwZWQgPSBfLnppcChbMSwgMl0sIFsxMCwgMjBdLCBbMTAwLCAyMDBdKTsKICAgKiAvLyA9PiBbWzEsIDEwLCAxMDBdLCBbMiwgMjAsIDIwMF1dCiAgICoKICAgKiBfLnVuemlwV2l0aCh6aXBwZWQsIF8uYWRkKTsKICAgKiAvLyA9PiBbMywgMzAsIDMwMF0KICAgKi8KICBmdW5jdGlvbiB1bnppcFdpdGgoYXJyYXksIGl0ZXJhdGVlKSB7CiAgICBpZiAoIShhcnJheSAmJiBhcnJheS5sZW5ndGgpKSB7CiAgICAgIHJldHVybiBbXTsKICAgIH0KICAgIHZhciByZXN1bHQgPSB1bnppcChhcnJheSk7CiAgICBpZiAoaXRlcmF0ZWUgPT0gbnVsbCkgewogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgcmV0dXJuIGFycmF5TWFwKHJlc3VsdCwgZnVuY3Rpb24oZ3JvdXApIHsKICAgICAgcmV0dXJuIGFwcGx5KGl0ZXJhdGVlLCB1bmRlZmluZWQsIGdyb3VwKTsKICAgIH0pOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBleGNsdWRpbmcgYWxsIGdpdmVuIHZhbHVlcyB1c2luZwogICAqIFtgU2FtZVZhbHVlWmVyb2BdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLXNhbWV2YWx1ZXplcm8pCiAgICogZm9yIGVxdWFsaXR5IGNvbXBhcmlzb25zLgogICAqCiAgICogKipOb3RlOioqIFVubGlrZSBgXy5wdWxsYCwgdGhpcyBtZXRob2QgcmV0dXJucyBhIG5ldyBhcnJheS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7Li4uKn0gW3ZhbHVlc10gVGhlIHZhbHVlcyB0byBleGNsdWRlLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGFycmF5IG9mIGZpbHRlcmVkIHZhbHVlcy4KICAgKiBAc2VlIF8uZGlmZmVyZW5jZSwgXy54b3IKICAgKiBAZXhhbXBsZQogICAqCiAgICogXy53aXRob3V0KFsyLCAxLCAyLCAzXSwgMSwgMik7CiAgICogLy8gPT4gWzNdCiAgICovCiAgdmFyIHdpdGhvdXQgPSBiYXNlUmVzdChmdW5jdGlvbihhcnJheSwgdmFsdWVzKSB7CiAgICByZXR1cm4gaXNBcnJheUxpa2VPYmplY3QoYXJyYXkpCiAgICAgID8gYmFzZURpZmZlcmVuY2UoYXJyYXksIHZhbHVlcykKICAgICAgOiBbXTsKICB9KTsKCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB1bmlxdWUgdmFsdWVzIHRoYXQgaXMgdGhlCiAgICogW3N5bW1ldHJpYyBkaWZmZXJlbmNlXShodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9TeW1tZXRyaWNfZGlmZmVyZW5jZSkKICAgKiBvZiB0aGUgZ2l2ZW4gYXJyYXlzLiBUaGUgb3JkZXIgb2YgcmVzdWx0IHZhbHVlcyBpcyBkZXRlcm1pbmVkIGJ5IHRoZSBvcmRlcgogICAqIHRoZXkgb2NjdXIgaW4gdGhlIGFycmF5cy4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAyLjQuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7Li4uQXJyYXl9IFthcnJheXNdIFRoZSBhcnJheXMgdG8gaW5zcGVjdC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBmaWx0ZXJlZCB2YWx1ZXMuCiAgICogQHNlZSBfLmRpZmZlcmVuY2UsIF8ud2l0aG91dAogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnhvcihbMiwgMV0sIFsyLCAzXSk7CiAgICogLy8gPT4gWzEsIDNdCiAgICovCiAgdmFyIHhvciA9IGJhc2VSZXN0KGZ1bmN0aW9uKGFycmF5cykgewogICAgcmV0dXJuIGJhc2VYb3IoYXJyYXlGaWx0ZXIoYXJyYXlzLCBpc0FycmF5TGlrZU9iamVjdCkpOwogIH0pOwoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnhvcmAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgaXRlcmF0ZWVgIHdoaWNoIGlzCiAgICogaW52b2tlZCBmb3IgZWFjaCBlbGVtZW50IG9mIGVhY2ggYGFycmF5c2AgdG8gZ2VuZXJhdGUgdGhlIGNyaXRlcmlvbiBieQogICAqIHdoaWNoIGJ5IHdoaWNoIHRoZXkncmUgY29tcGFyZWQuIFRoZSBvcmRlciBvZiByZXN1bHQgdmFsdWVzIGlzIGRldGVybWluZWQKICAgKiBieSB0aGUgb3JkZXIgdGhleSBvY2N1ciBpbiB0aGUgYXJyYXlzLiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZCB3aXRoIG9uZQogICAqIGFyZ3VtZW50OiAodmFsdWUpLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHsuLi5BcnJheX0gW2FycmF5c10gVGhlIGFycmF5cyB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgaXRlcmF0ZWUgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBmaWx0ZXJlZCB2YWx1ZXMuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8ueG9yQnkoWzIuMSwgMS4yXSwgWzIuMywgMy40XSwgTWF0aC5mbG9vcik7CiAgICogLy8gPT4gWzEuMiwgMy40XQogICAqCiAgICogLy8gVGhlIGBfLnByb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy54b3JCeShbeyAneCc6IDEgfV0sIFt7ICd4JzogMiB9LCB7ICd4JzogMSB9XSwgJ3gnKTsKICAgKiAvLyA9PiBbeyAneCc6IDIgfV0KICAgKi8KICB2YXIgeG9yQnkgPSBiYXNlUmVzdChmdW5jdGlvbihhcnJheXMpIHsKICAgIHZhciBpdGVyYXRlZSA9IGxhc3QoYXJyYXlzKTsKICAgIGlmIChpc0FycmF5TGlrZU9iamVjdChpdGVyYXRlZSkpIHsKICAgICAgaXRlcmF0ZWUgPSB1bmRlZmluZWQ7CiAgICB9CiAgICByZXR1cm4gYmFzZVhvcihhcnJheUZpbHRlcihhcnJheXMsIGlzQXJyYXlMaWtlT2JqZWN0KSwgZ2V0SXRlcmF0ZWUoaXRlcmF0ZWUsIDIpKTsKICB9KTsKCiAgLyoqCiAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy54b3JgIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGNvbXBhcmF0b3JgIHdoaWNoIGlzCiAgICogaW52b2tlZCB0byBjb21wYXJlIGVsZW1lbnRzIG9mIGBhcnJheXNgLiBUaGUgb3JkZXIgb2YgcmVzdWx0IHZhbHVlcyBpcwogICAqIGRldGVybWluZWQgYnkgdGhlIG9yZGVyIHRoZXkgb2NjdXIgaW4gdGhlIGFycmF5cy4gVGhlIGNvbXBhcmF0b3IgaXMgaW52b2tlZAogICAqIHdpdGggdHdvIGFyZ3VtZW50czogKGFyclZhbCwgb3RoVmFsKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7Li4uQXJyYXl9IFthcnJheXNdIFRoZSBhcnJheXMgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY29tcGFyYXRvcl0gVGhlIGNvbXBhcmF0b3IgaW52b2tlZCBwZXIgZWxlbWVudC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBhcnJheSBvZiBmaWx0ZXJlZCB2YWx1ZXMuCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBvYmplY3RzID0gW3sgJ3gnOiAxLCAneSc6IDIgfSwgeyAneCc6IDIsICd5JzogMSB9XTsKICAgKiB2YXIgb3RoZXJzID0gW3sgJ3gnOiAxLCAneSc6IDEgfSwgeyAneCc6IDEsICd5JzogMiB9XTsKICAgKgogICAqIF8ueG9yV2l0aChvYmplY3RzLCBvdGhlcnMsIF8uaXNFcXVhbCk7CiAgICogLy8gPT4gW3sgJ3gnOiAyLCAneSc6IDEgfSwgeyAneCc6IDEsICd5JzogMSB9XQogICAqLwogIHZhciB4b3JXaXRoID0gYmFzZVJlc3QoZnVuY3Rpb24oYXJyYXlzKSB7CiAgICB2YXIgY29tcGFyYXRvciA9IGxhc3QoYXJyYXlzKTsKICAgIGNvbXBhcmF0b3IgPSB0eXBlb2YgY29tcGFyYXRvciA9PSAnZnVuY3Rpb24nID8gY29tcGFyYXRvciA6IHVuZGVmaW5lZDsKICAgIHJldHVybiBiYXNlWG9yKGFycmF5RmlsdGVyKGFycmF5cywgaXNBcnJheUxpa2VPYmplY3QpLCB1bmRlZmluZWQsIGNvbXBhcmF0b3IpOwogIH0pOwoKICAvKioKICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIGdyb3VwZWQgZWxlbWVudHMsIHRoZSBmaXJzdCBvZiB3aGljaCBjb250YWlucyB0aGUKICAgKiBmaXJzdCBlbGVtZW50cyBvZiB0aGUgZ2l2ZW4gYXJyYXlzLCB0aGUgc2Vjb25kIG9mIHdoaWNoIGNvbnRhaW5zIHRoZQogICAqIHNlY29uZCBlbGVtZW50cyBvZiB0aGUgZ2l2ZW4gYXJyYXlzLCBhbmQgc28gb24uCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0gey4uLkFycmF5fSBbYXJyYXlzXSBUaGUgYXJyYXlzIHRvIHByb2Nlc3MuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2YgZ3JvdXBlZCBlbGVtZW50cy4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy56aXAoWydhJywgJ2InXSwgWzEsIDJdLCBbdHJ1ZSwgZmFsc2VdKTsKICAgKiAvLyA9PiBbWydhJywgMSwgdHJ1ZV0sIFsnYicsIDIsIGZhbHNlXV0KICAgKi8KICB2YXIgemlwID0gYmFzZVJlc3QodW56aXApOwoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmZyb21QYWlyc2AgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyB0d28gYXJyYXlzLAogICAqIG9uZSBvZiBwcm9wZXJ0eSBpZGVudGlmaWVycyBhbmQgb25lIG9mIGNvcnJlc3BvbmRpbmcgdmFsdWVzLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDAuNC4wCiAgICogQGNhdGVnb3J5IEFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gW3Byb3BzPVtdXSBUaGUgcHJvcGVydHkgaWRlbnRpZmllcnMuCiAgICogQHBhcmFtIHtBcnJheX0gW3ZhbHVlcz1bXV0gVGhlIHByb3BlcnR5IHZhbHVlcy4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBuZXcgb2JqZWN0LgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnppcE9iamVjdChbJ2EnLCAnYiddLCBbMSwgMl0pOwogICAqIC8vID0+IHsgJ2EnOiAxLCAnYic6IDIgfQogICAqLwogIGZ1bmN0aW9uIHppcE9iamVjdChwcm9wcywgdmFsdWVzKSB7CiAgICByZXR1cm4gYmFzZVppcE9iamVjdChwcm9wcyB8fCBbXSwgdmFsdWVzIHx8IFtdLCBhc3NpZ25WYWx1ZSk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLnppcE9iamVjdGAgZXhjZXB0IHRoYXQgaXQgc3VwcG9ydHMgcHJvcGVydHkgcGF0aHMuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4xLjAKICAgKiBAY2F0ZWdvcnkgQXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBbcHJvcHM9W11dIFRoZSBwcm9wZXJ0eSBpZGVudGlmaWVycy4KICAgKiBAcGFyYW0ge0FycmF5fSBbdmFsdWVzPVtdXSBUaGUgcHJvcGVydHkgdmFsdWVzLgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyBvYmplY3QuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uemlwT2JqZWN0RGVlcChbJ2EuYlswXS5jJywgJ2EuYlsxXS5kJ10sIFsxLCAyXSk7CiAgICogLy8gPT4geyAnYSc6IHsgJ2InOiBbeyAnYyc6IDEgfSwgeyAnZCc6IDIgfV0gfSB9CiAgICovCiAgZnVuY3Rpb24gemlwT2JqZWN0RGVlcChwcm9wcywgdmFsdWVzKSB7CiAgICByZXR1cm4gYmFzZVppcE9iamVjdChwcm9wcyB8fCBbXSwgdmFsdWVzIHx8IFtdLCBiYXNlU2V0KTsKICB9CgogIC8qKgogICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uemlwYCBleGNlcHQgdGhhdCBpdCBhY2NlcHRzIGBpdGVyYXRlZWAgdG8gc3BlY2lmeQogICAqIGhvdyBncm91cGVkIHZhbHVlcyBzaG91bGQgYmUgY29tYmluZWQuIFRoZSBpdGVyYXRlZSBpcyBpbnZva2VkIHdpdGggdGhlCiAgICogZWxlbWVudHMgb2YgZWFjaCBncm91cDogKC4uLmdyb3VwKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjguMAogICAqIEBjYXRlZ29yeSBBcnJheQogICAqIEBwYXJhbSB7Li4uQXJyYXl9IFthcnJheXNdIFRoZSBhcnJheXMgdG8gcHJvY2Vzcy4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbaXRlcmF0ZWU9Xy5pZGVudGl0eV0gVGhlIGZ1bmN0aW9uIHRvIGNvbWJpbmUKICAgKiAgZ3JvdXBlZCB2YWx1ZXMuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgYXJyYXkgb2YgZ3JvdXBlZCBlbGVtZW50cy4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy56aXBXaXRoKFsxLCAyXSwgWzEwLCAyMF0sIFsxMDAsIDIwMF0sIGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgKiAgIHJldHVybiBhICsgYiArIGM7CiAgICogfSk7CiAgICogLy8gPT4gWzExMSwgMjIyXQogICAqLwogIHZhciB6aXBXaXRoID0gYmFzZVJlc3QoZnVuY3Rpb24oYXJyYXlzKSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXlzLmxlbmd0aCwKICAgICAgICBpdGVyYXRlZSA9IGxlbmd0aCA+IDEgPyBhcnJheXNbbGVuZ3RoIC0gMV0gOiB1bmRlZmluZWQ7CgogICAgaXRlcmF0ZWUgPSB0eXBlb2YgaXRlcmF0ZWUgPT0gJ2Z1bmN0aW9uJyA/IChhcnJheXMucG9wKCksIGl0ZXJhdGVlKSA6IHVuZGVmaW5lZDsKICAgIHJldHVybiB1bnppcFdpdGgoYXJyYXlzLCBpdGVyYXRlZSk7CiAgfSk7CgogIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCiAgLyoqCiAgICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgbWVtb2l6ZXMgdGhlIHJlc3VsdCBvZiBgZnVuY2AuIElmIGByZXNvbHZlcmAgaXMKICAgKiBwcm92aWRlZCwgaXQgZGV0ZXJtaW5lcyB0aGUgY2FjaGUga2V5IGZvciBzdG9yaW5nIHRoZSByZXN1bHQgYmFzZWQgb24gdGhlCiAgICogYXJndW1lbnRzIHByb3ZpZGVkIHRvIHRoZSBtZW1vaXplZCBmdW5jdGlvbi4gQnkgZGVmYXVsdCwgdGhlIGZpcnN0IGFyZ3VtZW50CiAgICogcHJvdmlkZWQgdG8gdGhlIG1lbW9pemVkIGZ1bmN0aW9uIGlzIHVzZWQgYXMgdGhlIG1hcCBjYWNoZSBrZXkuIFRoZSBgZnVuY2AKICAgKiBpcyBpbnZva2VkIHdpdGggdGhlIGB0aGlzYCBiaW5kaW5nIG9mIHRoZSBtZW1vaXplZCBmdW5jdGlvbi4KICAgKgogICAqICoqTm90ZToqKiBUaGUgY2FjaGUgaXMgZXhwb3NlZCBhcyB0aGUgYGNhY2hlYCBwcm9wZXJ0eSBvbiB0aGUgbWVtb2l6ZWQKICAgKiBmdW5jdGlvbi4gSXRzIGNyZWF0aW9uIG1heSBiZSBjdXN0b21pemVkIGJ5IHJlcGxhY2luZyB0aGUgYF8ubWVtb2l6ZS5DYWNoZWAKICAgKiBjb25zdHJ1Y3RvciB3aXRoIG9uZSB3aG9zZSBpbnN0YW5jZXMgaW1wbGVtZW50IHRoZQogICAqIFtgTWFwYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtcHJvcGVydGllcy1vZi10aGUtbWFwLXByb3RvdHlwZS1vYmplY3QpCiAgICogbWV0aG9kIGludGVyZmFjZSBvZiBgY2xlYXJgLCBgZGVsZXRlYCwgYGdldGAsIGBoYXNgLCBhbmQgYHNldGAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb24KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBoYXZlIGl0cyBvdXRwdXQgbWVtb2l6ZWQuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3Jlc29sdmVyXSBUaGUgZnVuY3Rpb24gdG8gcmVzb2x2ZSB0aGUgY2FjaGUga2V5LgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IG1lbW9pemVkIGZ1bmN0aW9uLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgb2JqZWN0ID0geyAnYSc6IDEsICdiJzogMiB9OwogICAqIHZhciBvdGhlciA9IHsgJ2MnOiAzLCAnZCc6IDQgfTsKICAgKgogICAqIHZhciB2YWx1ZXMgPSBfLm1lbW9pemUoXy52YWx1ZXMpOwogICAqIHZhbHVlcyhvYmplY3QpOwogICAqIC8vID0+IFsxLCAyXQogICAqCiAgICogdmFsdWVzKG90aGVyKTsKICAgKiAvLyA9PiBbMywgNF0KICAgKgogICAqIG9iamVjdC5hID0gMjsKICAgKiB2YWx1ZXMob2JqZWN0KTsKICAgKiAvLyA9PiBbMSwgMl0KICAgKgogICAqIC8vIE1vZGlmeSB0aGUgcmVzdWx0IGNhY2hlLgogICAqIHZhbHVlcy5jYWNoZS5zZXQob2JqZWN0LCBbJ2EnLCAnYiddKTsKICAgKiB2YWx1ZXMob2JqZWN0KTsKICAgKiAvLyA9PiBbJ2EnLCAnYiddCiAgICoKICAgKiAvLyBSZXBsYWNlIGBfLm1lbW9pemUuQ2FjaGVgLgogICAqIF8ubWVtb2l6ZS5DYWNoZSA9IFdlYWtNYXA7CiAgICovCiAgZnVuY3Rpb24gbWVtb2l6ZShmdW5jLCByZXNvbHZlcikgewogICAgaWYgKHR5cGVvZiBmdW5jICE9ICdmdW5jdGlvbicgfHwgKHJlc29sdmVyICE9IG51bGwgJiYgdHlwZW9mIHJlc29sdmVyICE9ICdmdW5jdGlvbicpKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoRlVOQ19FUlJPUl9URVhUKTsKICAgIH0KICAgIHZhciBtZW1vaXplZCA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cywKICAgICAgICAgIGtleSA9IHJlc29sdmVyID8gcmVzb2x2ZXIuYXBwbHkodGhpcywgYXJncykgOiBhcmdzWzBdLAogICAgICAgICAgY2FjaGUgPSBtZW1vaXplZC5jYWNoZTsKCiAgICAgIGlmIChjYWNoZS5oYXMoa2V5KSkgewogICAgICAgIHJldHVybiBjYWNoZS5nZXQoa2V5KTsKICAgICAgfQogICAgICB2YXIgcmVzdWx0ID0gZnVuYy5hcHBseSh0aGlzLCBhcmdzKTsKICAgICAgbWVtb2l6ZWQuY2FjaGUgPSBjYWNoZS5zZXQoa2V5LCByZXN1bHQpIHx8IGNhY2hlOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICAgIG1lbW9pemVkLmNhY2hlID0gbmV3IChtZW1vaXplLkNhY2hlIHx8IE1hcENhY2hlKTsKICAgIHJldHVybiBtZW1vaXplZDsKICB9CgogIC8vIEV4cG9zZSBgTWFwQ2FjaGVgLgogIG1lbW9pemUuQ2FjaGUgPSBNYXBDYWNoZTsKCiAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKICAvKioKICAgKiBDYXN0cyBgdmFsdWVgIGFzIGFuIGFycmF5IGlmIGl0J3Mgbm90IG9uZS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjQuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gaW5zcGVjdC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGNhc3QgYXJyYXkuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uY2FzdEFycmF5KDEpOwogICAqIC8vID0+IFsxXQogICAqCiAgICogXy5jYXN0QXJyYXkoeyAnYSc6IDEgfSk7CiAgICogLy8gPT4gW3sgJ2EnOiAxIH1dCiAgICoKICAgKiBfLmNhc3RBcnJheSgnYWJjJyk7CiAgICogLy8gPT4gWydhYmMnXQogICAqCiAgICogXy5jYXN0QXJyYXkobnVsbCk7CiAgICogLy8gPT4gW251bGxdCiAgICoKICAgKiBfLmNhc3RBcnJheSh1bmRlZmluZWQpOwogICAqIC8vID0+IFt1bmRlZmluZWRdCiAgICoKICAgKiBfLmNhc3RBcnJheSgpOwogICAqIC8vID0+IFtdCiAgICoKICAgKiB2YXIgYXJyYXkgPSBbMSwgMiwgM107CiAgICogY29uc29sZS5sb2coXy5jYXN0QXJyYXkoYXJyYXkpID09PSBhcnJheSk7CiAgICogLy8gPT4gdHJ1ZQogICAqLwogIGZ1bmN0aW9uIGNhc3RBcnJheSgpIHsKICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgewogICAgICByZXR1cm4gW107CiAgICB9CiAgICB2YXIgdmFsdWUgPSBhcmd1bWVudHNbMF07CiAgICByZXR1cm4gaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZSA6IFt2YWx1ZV07CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgc2hhbGxvdyBjbG9uZSBvZiBgdmFsdWVgLgogICAqCiAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIGxvb3NlbHkgYmFzZWQgb24gdGhlCiAgICogW3N0cnVjdHVyZWQgY2xvbmUgYWxnb3JpdGhtXShodHRwczovL21kbi5pby9TdHJ1Y3R1cmVkX2Nsb25lX2FsZ29yaXRobSkKICAgKiBhbmQgc3VwcG9ydHMgY2xvbmluZyBhcnJheXMsIGFycmF5IGJ1ZmZlcnMsIGJvb2xlYW5zLCBkYXRlIG9iamVjdHMsIG1hcHMsCiAgICogbnVtYmVycywgYE9iamVjdGAgb2JqZWN0cywgcmVnZXhlcywgc2V0cywgc3RyaW5ncywgc3ltYm9scywgYW5kIHR5cGVkCiAgICogYXJyYXlzLiBUaGUgb3duIGVudW1lcmFibGUgcHJvcGVydGllcyBvZiBgYXJndW1lbnRzYCBvYmplY3RzIGFyZSBjbG9uZWQKICAgKiBhcyBwbGFpbiBvYmplY3RzLiBBbiBlbXB0eSBvYmplY3QgaXMgcmV0dXJuZWQgZm9yIHVuY2xvbmVhYmxlIHZhbHVlcyBzdWNoCiAgICogYXMgZXJyb3Igb2JqZWN0cywgZnVuY3Rpb25zLCBET00gbm9kZXMsIGFuZCBXZWFrTWFwcy4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2xvbmUuCiAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGNsb25lZCB2YWx1ZS4KICAgKiBAc2VlIF8uY2xvbmVEZWVwCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBvYmplY3RzID0gW3sgJ2EnOiAxIH0sIHsgJ2InOiAyIH1dOwogICAqCiAgICogdmFyIHNoYWxsb3cgPSBfLmNsb25lKG9iamVjdHMpOwogICAqIGNvbnNvbGUubG9nKHNoYWxsb3dbMF0gPT09IG9iamVjdHNbMF0pOwogICAqIC8vID0+IHRydWUKICAgKi8KICBmdW5jdGlvbiBjbG9uZSh2YWx1ZSkgewogICAgcmV0dXJuIGJhc2VDbG9uZSh2YWx1ZSwgQ0xPTkVfU1lNQk9MU19GTEFHKTsKICB9CgogIC8qKgogICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uY2xvbmVgIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGN1c3RvbWl6ZXJgIHdoaWNoCiAgICogaXMgaW52b2tlZCB0byBwcm9kdWNlIHRoZSBjbG9uZWQgdmFsdWUuIElmIGBjdXN0b21pemVyYCByZXR1cm5zIGB1bmRlZmluZWRgLAogICAqIGNsb25pbmcgaXMgaGFuZGxlZCBieSB0aGUgbWV0aG9kIGluc3RlYWQuIFRoZSBgY3VzdG9taXplcmAgaXMgaW52b2tlZCB3aXRoCiAgICogdXAgdG8gZm91ciBhcmd1bWVudHM7ICh2YWx1ZSBbLCBpbmRleHxrZXksIG9iamVjdCwgc3RhY2tdKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2xvbmUuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2N1c3RvbWl6ZXJdIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgY2xvbmluZy4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgY2xvbmVkIHZhbHVlLgogICAqIEBzZWUgXy5jbG9uZURlZXBXaXRoCiAgICogQGV4YW1wbGUKICAgKgogICAqIGZ1bmN0aW9uIGN1c3RvbWl6ZXIodmFsdWUpIHsKICAgKiAgIGlmIChfLmlzRWxlbWVudCh2YWx1ZSkpIHsKICAgKiAgICAgcmV0dXJuIHZhbHVlLmNsb25lTm9kZShmYWxzZSk7CiAgICogICB9CiAgICogfQogICAqCiAgICogdmFyIGVsID0gXy5jbG9uZVdpdGgoZG9jdW1lbnQuYm9keSwgY3VzdG9taXplcik7CiAgICoKICAgKiBjb25zb2xlLmxvZyhlbCA9PT0gZG9jdW1lbnQuYm9keSk7CiAgICogLy8gPT4gZmFsc2UKICAgKiBjb25zb2xlLmxvZyhlbC5ub2RlTmFtZSk7CiAgICogLy8gPT4gJ0JPRFknCiAgICogY29uc29sZS5sb2coZWwuY2hpbGROb2Rlcy5sZW5ndGgpOwogICAqIC8vID0+IDAKICAgKi8KICBmdW5jdGlvbiBjbG9uZVdpdGgodmFsdWUsIGN1c3RvbWl6ZXIpIHsKICAgIGN1c3RvbWl6ZXIgPSB0eXBlb2YgY3VzdG9taXplciA9PSAnZnVuY3Rpb24nID8gY3VzdG9taXplciA6IHVuZGVmaW5lZDsKICAgIHJldHVybiBiYXNlQ2xvbmUodmFsdWUsIENMT05FX1NZTUJPTFNfRkxBRywgY3VzdG9taXplcik7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmNsb25lYCBleGNlcHQgdGhhdCBpdCByZWN1cnNpdmVseSBjbG9uZXMgYHZhbHVlYC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAxLjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcmVjdXJzaXZlbHkgY2xvbmUuCiAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGRlZXAgY2xvbmVkIHZhbHVlLgogICAqIEBzZWUgXy5jbG9uZQogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgb2JqZWN0cyA9IFt7ICdhJzogMSB9LCB7ICdiJzogMiB9XTsKICAgKgogICAqIHZhciBkZWVwID0gXy5jbG9uZURlZXAob2JqZWN0cyk7CiAgICogY29uc29sZS5sb2coZGVlcFswXSA9PT0gb2JqZWN0c1swXSk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBjbG9uZURlZXAodmFsdWUpIHsKICAgIHJldHVybiBiYXNlQ2xvbmUodmFsdWUsIENMT05FX0RFRVBfRkxBRyB8IENMT05FX1NZTUJPTFNfRkxBRyk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmNsb25lV2l0aGAgZXhjZXB0IHRoYXQgaXQgcmVjdXJzaXZlbHkgY2xvbmVzIGB2YWx1ZWAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHJlY3Vyc2l2ZWx5IGNsb25lLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjdXN0b21pemVyXSBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNsb25pbmcuCiAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGRlZXAgY2xvbmVkIHZhbHVlLgogICAqIEBzZWUgXy5jbG9uZVdpdGgKICAgKiBAZXhhbXBsZQogICAqCiAgICogZnVuY3Rpb24gY3VzdG9taXplcih2YWx1ZSkgewogICAqICAgaWYgKF8uaXNFbGVtZW50KHZhbHVlKSkgewogICAqICAgICByZXR1cm4gdmFsdWUuY2xvbmVOb2RlKHRydWUpOwogICAqICAgfQogICAqIH0KICAgKgogICAqIHZhciBlbCA9IF8uY2xvbmVEZWVwV2l0aChkb2N1bWVudC5ib2R5LCBjdXN0b21pemVyKTsKICAgKgogICAqIGNvbnNvbGUubG9nKGVsID09PSBkb2N1bWVudC5ib2R5KTsKICAgKiAvLyA9PiBmYWxzZQogICAqIGNvbnNvbGUubG9nKGVsLm5vZGVOYW1lKTsKICAgKiAvLyA9PiAnQk9EWScKICAgKiBjb25zb2xlLmxvZyhlbC5jaGlsZE5vZGVzLmxlbmd0aCk7CiAgICogLy8gPT4gMjAKICAgKi8KICBmdW5jdGlvbiBjbG9uZURlZXBXaXRoKHZhbHVlLCBjdXN0b21pemVyKSB7CiAgICBjdXN0b21pemVyID0gdHlwZW9mIGN1c3RvbWl6ZXIgPT0gJ2Z1bmN0aW9uJyA/IGN1c3RvbWl6ZXIgOiB1bmRlZmluZWQ7CiAgICByZXR1cm4gYmFzZUNsb25lKHZhbHVlLCBDTE9ORV9ERUVQX0ZMQUcgfCBDTE9ORV9TWU1CT0xTX0ZMQUcsIGN1c3RvbWl6ZXIpOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGBvYmplY3RgIGNvbmZvcm1zIHRvIGBzb3VyY2VgIGJ5IGludm9raW5nIHRoZSBwcmVkaWNhdGUKICAgKiBwcm9wZXJ0aWVzIG9mIGBzb3VyY2VgIHdpdGggdGhlIGNvcnJlc3BvbmRpbmcgcHJvcGVydHkgdmFsdWVzIG9mIGBvYmplY3RgLgogICAqCiAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIGVxdWl2YWxlbnQgdG8gYF8uY29uZm9ybXNgIHdoZW4gYHNvdXJjZWAgaXMKICAgKiBwYXJ0aWFsbHkgYXBwbGllZC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjE0LjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7T2JqZWN0fSBzb3VyY2UgVGhlIG9iamVjdCBvZiBwcm9wZXJ0eSBwcmVkaWNhdGVzIHRvIGNvbmZvcm0gdG8uCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGBvYmplY3RgIGNvbmZvcm1zLCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBvYmplY3QgPSB7ICdhJzogMSwgJ2InOiAyIH07CiAgICoKICAgKiBfLmNvbmZvcm1zVG8ob2JqZWN0LCB7ICdiJzogZnVuY3Rpb24obikgeyByZXR1cm4gbiA+IDE7IH0gfSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5jb25mb3Jtc1RvKG9iamVjdCwgeyAnYic6IGZ1bmN0aW9uKG4pIHsgcmV0dXJuIG4gPiAyOyB9IH0pOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gY29uZm9ybXNUbyhvYmplY3QsIHNvdXJjZSkgewogICAgcmV0dXJuIHNvdXJjZSA9PSBudWxsIHx8IGJhc2VDb25mb3Jtc1RvKG9iamVjdCwgc291cmNlLCBrZXlzKHNvdXJjZSkpOwogIH0KCiAgLyoqCiAgICogUGVyZm9ybXMgYQogICAqIFtgU2FtZVZhbHVlWmVyb2BdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLXNhbWV2YWx1ZXplcm8pCiAgICogY29tcGFyaXNvbiBiZXR3ZWVuIHR3byB2YWx1ZXMgdG8gZGV0ZXJtaW5lIGlmIHRoZXkgYXJlIGVxdWl2YWxlbnQuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbXBhcmUuCiAgICogQHBhcmFtIHsqfSBvdGhlciBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIHZhbHVlcyBhcmUgZXF1aXZhbGVudCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgb2JqZWN0ID0geyAnYSc6IDEgfTsKICAgKiB2YXIgb3RoZXIgPSB7ICdhJzogMSB9OwogICAqCiAgICogXy5lcShvYmplY3QsIG9iamVjdCk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5lcShvYmplY3QsIG90aGVyKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5lcSgnYScsICdhJyk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5lcSgnYScsIE9iamVjdCgnYScpKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5lcShOYU4sIE5hTik7CiAgICogLy8gPT4gdHJ1ZQogICAqLwogIGZ1bmN0aW9uIGVxKHZhbHVlLCBvdGhlcikgewogICAgcmV0dXJuIHZhbHVlID09PSBvdGhlciB8fCAodmFsdWUgIT09IHZhbHVlICYmIG90aGVyICE9PSBvdGhlcik7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBncmVhdGVyIHRoYW4gYG90aGVyYC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjkuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0geyp9IG90aGVyIFRoZSBvdGhlciB2YWx1ZSB0byBjb21wYXJlLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGdyZWF0ZXIgdGhhbiBgb3RoZXJgLAogICAqICBlbHNlIGBmYWxzZWAuCiAgICogQHNlZSBfLmx0CiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uZ3QoMywgMSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5ndCgzLCAzKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5ndCgxLCAzKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIHZhciBndCA9IGNyZWF0ZVJlbGF0aW9uYWxPcGVyYXRpb24oYmFzZUd0KTsKCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIGBvdGhlcmAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMy45LjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbXBhcmUuCiAgICogQHBhcmFtIHsqfSBvdGhlciBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8KICAgKiAgYG90aGVyYCwgZWxzZSBgZmFsc2VgLgogICAqIEBzZWUgXy5sdGUKICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5ndGUoMywgMSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5ndGUoMywgMyk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5ndGUoMSwgMyk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICB2YXIgZ3RlID0gY3JlYXRlUmVsYXRpb25hbE9wZXJhdGlvbihmdW5jdGlvbih2YWx1ZSwgb3RoZXIpIHsKICAgIHJldHVybiB2YWx1ZSA+PSBvdGhlcjsKICB9KTsKCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgbGlrZWx5IGFuIGBhcmd1bWVudHNgIG9iamVjdC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYW4gYGFyZ3VtZW50c2Agb2JqZWN0LAogICAqICBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNBcmd1bWVudHMoZnVuY3Rpb24oKSB7IHJldHVybiBhcmd1bWVudHM7IH0oKSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0FyZ3VtZW50cyhbMSwgMiwgM10pOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgdmFyIGlzQXJndW1lbnRzID0gYmFzZUlzQXJndW1lbnRzKGZ1bmN0aW9uKCkgeyByZXR1cm4gYXJndW1lbnRzOyB9KCkpID8gYmFzZUlzQXJndW1lbnRzIDogZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIGhhc093blByb3BlcnR5LmNhbGwodmFsdWUsICdjYWxsZWUnKSAmJgogICAgICAhcHJvcGVydHlJc0VudW1lcmFibGUuY2FsbCh2YWx1ZSwgJ2NhbGxlZScpOwogIH07CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYW4gYEFycmF5YCBvYmplY3QuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGFuIGFycmF5LCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNBcnJheShbMSwgMiwgM10pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNBcnJheShkb2N1bWVudC5ib2R5LmNoaWxkcmVuKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5pc0FycmF5KCdhYmMnKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5pc0FycmF5KF8ubm9vcCk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICB2YXIgaXNBcnJheSA9IEFycmF5LmlzQXJyYXk7CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYW4gYEFycmF5QnVmZmVyYCBvYmplY3QuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4zLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGFuIGFycmF5IGJ1ZmZlciwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzQXJyYXlCdWZmZXIobmV3IEFycmF5QnVmZmVyKDIpKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzQXJyYXlCdWZmZXIobmV3IEFycmF5KDIpKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIHZhciBpc0FycmF5QnVmZmVyID0gbm9kZUlzQXJyYXlCdWZmZXIgPyBiYXNlVW5hcnkobm9kZUlzQXJyYXlCdWZmZXIpIDogYmFzZUlzQXJyYXlCdWZmZXI7CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGFycmF5LWxpa2UuIEEgdmFsdWUgaXMgY29uc2lkZXJlZCBhcnJheS1saWtlIGlmIGl0J3MKICAgKiBub3QgYSBmdW5jdGlvbiBhbmQgaGFzIGEgYHZhbHVlLmxlbmd0aGAgdGhhdCdzIGFuIGludGVnZXIgZ3JlYXRlciB0aGFuIG9yCiAgICogZXF1YWwgdG8gYDBgIGFuZCBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gYE51bWJlci5NQVhfU0FGRV9JTlRFR0VSYC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYXJyYXktbGlrZSwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzQXJyYXlMaWtlKFsxLCAyLCAzXSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0FycmF5TGlrZShkb2N1bWVudC5ib2R5LmNoaWxkcmVuKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzQXJyYXlMaWtlKCdhYmMnKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzQXJyYXlMaWtlKF8ubm9vcCk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc0FycmF5TGlrZSh2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlICE9IG51bGwgJiYgaXNMZW5ndGgodmFsdWUubGVuZ3RoKSAmJiAhaXNGdW5jdGlvbih2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmlzQXJyYXlMaWtlYCBleGNlcHQgdGhhdCBpdCBhbHNvIGNoZWNrcyBpZiBgdmFsdWVgCiAgICogaXMgYW4gb2JqZWN0LgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBhcnJheS1saWtlIG9iamVjdCwKICAgKiAgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzQXJyYXlMaWtlT2JqZWN0KFsxLCAyLCAzXSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0FycmF5TGlrZU9iamVjdChkb2N1bWVudC5ib2R5LmNoaWxkcmVuKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzQXJyYXlMaWtlT2JqZWN0KCdhYmMnKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5pc0FycmF5TGlrZU9iamVjdChfLm5vb3ApOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNBcnJheUxpa2VPYmplY3QodmFsdWUpIHsKICAgIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIGlzQXJyYXlMaWtlKHZhbHVlKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSBib29sZWFuIHByaW1pdGl2ZSBvciBvYmplY3QuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgYm9vbGVhbiwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzQm9vbGVhbihmYWxzZSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0Jvb2xlYW4obnVsbCk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc0Jvb2xlYW4odmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZSA9PT0gdHJ1ZSB8fCB2YWx1ZSA9PT0gZmFsc2UgfHwKICAgICAgKGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgYmFzZUdldFRhZyh2YWx1ZSkgPT0gYm9vbFRhZyk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIGJ1ZmZlci4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjMuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBidWZmZXIsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc0J1ZmZlcihuZXcgQnVmZmVyKDIpKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzQnVmZmVyKG5ldyBVaW50OEFycmF5KDIpKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIHZhciBpc0J1ZmZlciA9IG5hdGl2ZUlzQnVmZmVyIHx8IHN0dWJGYWxzZTsKCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgY2xhc3NpZmllZCBhcyBhIGBEYXRlYCBvYmplY3QuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgZGF0ZSBvYmplY3QsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc0RhdGUobmV3IERhdGUpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNEYXRlKCdNb24gQXByaWwgMjMgMjAxMicpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgdmFyIGlzRGF0ZSA9IG5vZGVJc0RhdGUgPyBiYXNlVW5hcnkobm9kZUlzRGF0ZSkgOiBiYXNlSXNEYXRlOwoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBsaWtlbHkgYSBET00gZWxlbWVudC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBET00gZWxlbWVudCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzRWxlbWVudChkb2N1bWVudC5ib2R5KTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzRWxlbWVudCgnPGJvZHk+Jyk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc0VsZW1lbnQodmFsdWUpIHsKICAgIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIHZhbHVlLm5vZGVUeXBlID09PSAxICYmICFpc1BsYWluT2JqZWN0KHZhbHVlKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGFuIGVtcHR5IG9iamVjdCwgY29sbGVjdGlvbiwgbWFwLCBvciBzZXQuCiAgICoKICAgKiBPYmplY3RzIGFyZSBjb25zaWRlcmVkIGVtcHR5IGlmIHRoZXkgaGF2ZSBubyBvd24gZW51bWVyYWJsZSBzdHJpbmcga2V5ZWQKICAgKiBwcm9wZXJ0aWVzLgogICAqCiAgICogQXJyYXktbGlrZSB2YWx1ZXMgc3VjaCBhcyBgYXJndW1lbnRzYCBvYmplY3RzLCBhcnJheXMsIGJ1ZmZlcnMsIHN0cmluZ3MsIG9yCiAgICogalF1ZXJ5LWxpa2UgY29sbGVjdGlvbnMgYXJlIGNvbnNpZGVyZWQgZW1wdHkgaWYgdGhleSBoYXZlIGEgYGxlbmd0aGAgb2YgYDBgLgogICAqIFNpbWlsYXJseSwgbWFwcyBhbmQgc2V0cyBhcmUgY29uc2lkZXJlZCBlbXB0eSBpZiB0aGV5IGhhdmUgYSBgc2l6ZWAgb2YgYDBgLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDAuMS4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBlbXB0eSwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzRW1wdHkobnVsbCk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0VtcHR5KHRydWUpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNFbXB0eSgxKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzRW1wdHkoWzEsIDIsIDNdKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5pc0VtcHR5KHsgJ2EnOiAxIH0pOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNFbXB0eSh2YWx1ZSkgewogICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBpZiAoaXNBcnJheUxpa2UodmFsdWUpICYmCiAgICAgICAgKGlzQXJyYXkodmFsdWUpIHx8IHR5cGVvZiB2YWx1ZSA9PSAnc3RyaW5nJyB8fCB0eXBlb2YgdmFsdWUuc3BsaWNlID09ICdmdW5jdGlvbicgfHwKICAgICAgICAgIGlzQnVmZmVyKHZhbHVlKSB8fCBpc1R5cGVkQXJyYXkodmFsdWUpIHx8IGlzQXJndW1lbnRzKHZhbHVlKSkpIHsKICAgICAgcmV0dXJuICF2YWx1ZS5sZW5ndGg7CiAgICB9CiAgICB2YXIgdGFnID0gZ2V0VGFnKHZhbHVlKTsKICAgIGlmICh0YWcgPT0gbWFwVGFnIHx8IHRhZyA9PSBzZXRUYWcpIHsKICAgICAgcmV0dXJuICF2YWx1ZS5zaXplOwogICAgfQogICAgaWYgKGlzUHJvdG90eXBlKHZhbHVlKSkgewogICAgICByZXR1cm4gIWJhc2VLZXlzKHZhbHVlKS5sZW5ndGg7CiAgICB9CiAgICBmb3IgKHZhciBrZXkgaW4gdmFsdWUpIHsKICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwodmFsdWUsIGtleSkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogUGVyZm9ybXMgYSBkZWVwIGNvbXBhcmlzb24gYmV0d2VlbiB0d28gdmFsdWVzIHRvIGRldGVybWluZSBpZiB0aGV5IGFyZQogICAqIGVxdWl2YWxlbnQuCiAgICoKICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2Qgc3VwcG9ydHMgY29tcGFyaW5nIGFycmF5cywgYXJyYXkgYnVmZmVycywgYm9vbGVhbnMsCiAgICogZGF0ZSBvYmplY3RzLCBlcnJvciBvYmplY3RzLCBtYXBzLCBudW1iZXJzLCBgT2JqZWN0YCBvYmplY3RzLCByZWdleGVzLAogICAqIHNldHMsIHN0cmluZ3MsIHN5bWJvbHMsIGFuZCB0eXBlZCBhcnJheXMuIGBPYmplY3RgIG9iamVjdHMgYXJlIGNvbXBhcmVkCiAgICogYnkgdGhlaXIgb3duLCBub3QgaW5oZXJpdGVkLCBlbnVtZXJhYmxlIHByb3BlcnRpZXMuIEZ1bmN0aW9ucyBhbmQgRE9NCiAgICogbm9kZXMgYXJlIGNvbXBhcmVkIGJ5IHN0cmljdCBlcXVhbGl0eSwgaS5lLiBgPT09YC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0geyp9IG90aGVyIFRoZSBvdGhlciB2YWx1ZSB0byBjb21wYXJlLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgdmFsdWVzIGFyZSBlcXVpdmFsZW50LCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBvYmplY3QgPSB7ICdhJzogMSB9OwogICAqIHZhciBvdGhlciA9IHsgJ2EnOiAxIH07CiAgICoKICAgKiBfLmlzRXF1YWwob2JqZWN0LCBvdGhlcik7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogb2JqZWN0ID09PSBvdGhlcjsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGlzRXF1YWwodmFsdWUsIG90aGVyKSB7CiAgICByZXR1cm4gYmFzZUlzRXF1YWwodmFsdWUsIG90aGVyKTsKICB9CgogIC8qKgogICAqIFRoaXMgbWV0aG9kIGlzIGxpa2UgYF8uaXNFcXVhbGAgZXhjZXB0IHRoYXQgaXQgYWNjZXB0cyBgY3VzdG9taXplcmAgd2hpY2gKICAgKiBpcyBpbnZva2VkIHRvIGNvbXBhcmUgdmFsdWVzLiBJZiBgY3VzdG9taXplcmAgcmV0dXJucyBgdW5kZWZpbmVkYCwgY29tcGFyaXNvbnMKICAgKiBhcmUgaGFuZGxlZCBieSB0aGUgbWV0aG9kIGluc3RlYWQuIFRoZSBgY3VzdG9taXplcmAgaXMgaW52b2tlZCB3aXRoIHVwIHRvCiAgICogc2l4IGFyZ3VtZW50czogKG9ialZhbHVlLCBvdGhWYWx1ZSBbLCBpbmRleHxrZXksIG9iamVjdCwgb3RoZXIsIHN0YWNrXSkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbXBhcmUuCiAgICogQHBhcmFtIHsqfSBvdGhlciBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY3VzdG9taXplcl0gVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBjb21wYXJpc29ucy4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIHZhbHVlcyBhcmUgZXF1aXZhbGVudCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBmdW5jdGlvbiBpc0dyZWV0aW5nKHZhbHVlKSB7CiAgICogICByZXR1cm4gL15oKD86aXxlbGxvKSQvLnRlc3QodmFsdWUpOwogICAqIH0KICAgKgogICAqIGZ1bmN0aW9uIGN1c3RvbWl6ZXIob2JqVmFsdWUsIG90aFZhbHVlKSB7CiAgICogICBpZiAoaXNHcmVldGluZyhvYmpWYWx1ZSkgJiYgaXNHcmVldGluZyhvdGhWYWx1ZSkpIHsKICAgKiAgICAgcmV0dXJuIHRydWU7CiAgICogICB9CiAgICogfQogICAqCiAgICogdmFyIGFycmF5ID0gWydoZWxsbycsICdnb29kYnllJ107CiAgICogdmFyIG90aGVyID0gWydoaScsICdnb29kYnllJ107CiAgICoKICAgKiBfLmlzRXF1YWxXaXRoKGFycmF5LCBvdGhlciwgY3VzdG9taXplcik7CiAgICogLy8gPT4gdHJ1ZQogICAqLwogIGZ1bmN0aW9uIGlzRXF1YWxXaXRoKHZhbHVlLCBvdGhlciwgY3VzdG9taXplcikgewogICAgY3VzdG9taXplciA9IHR5cGVvZiBjdXN0b21pemVyID09ICdmdW5jdGlvbicgPyBjdXN0b21pemVyIDogdW5kZWZpbmVkOwogICAgdmFyIHJlc3VsdCA9IGN1c3RvbWl6ZXIgPyBjdXN0b21pemVyKHZhbHVlLCBvdGhlcikgOiB1bmRlZmluZWQ7CiAgICByZXR1cm4gcmVzdWx0ID09PSB1bmRlZmluZWQgPyBiYXNlSXNFcXVhbCh2YWx1ZSwgb3RoZXIsIHVuZGVmaW5lZCwgY3VzdG9taXplcikgOiAhIXJlc3VsdDsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGFuIGBFcnJvcmAsIGBFdmFsRXJyb3JgLCBgUmFuZ2VFcnJvcmAsIGBSZWZlcmVuY2VFcnJvcmAsCiAgICogYFN5bnRheEVycm9yYCwgYFR5cGVFcnJvcmAsIG9yIGBVUklFcnJvcmAgb2JqZWN0LgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDMuMC4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBlcnJvciBvYmplY3QsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc0Vycm9yKG5ldyBFcnJvcik7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0Vycm9yKEVycm9yKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGlzRXJyb3IodmFsdWUpIHsKICAgIGlmICghaXNPYmplY3RMaWtlKHZhbHVlKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB2YXIgdGFnID0gYmFzZUdldFRhZyh2YWx1ZSk7CiAgICByZXR1cm4gdGFnID09IGVycm9yVGFnIHx8IHRhZyA9PSBkb21FeGNUYWcgfHwKICAgICAgKHR5cGVvZiB2YWx1ZS5tZXNzYWdlID09ICdzdHJpbmcnICYmIHR5cGVvZiB2YWx1ZS5uYW1lID09ICdzdHJpbmcnICYmICFpc1BsYWluT2JqZWN0KHZhbHVlKSk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIGZpbml0ZSBwcmltaXRpdmUgbnVtYmVyLgogICAqCiAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIGJhc2VkIG9uCiAgICogW2BOdW1iZXIuaXNGaW5pdGVgXShodHRwczovL21kbi5pby9OdW1iZXIvaXNGaW5pdGUpLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDAuMS4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIGZpbml0ZSBudW1iZXIsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc0Zpbml0ZSgzKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzRmluaXRlKE51bWJlci5NSU5fVkFMVUUpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNGaW5pdGUoSW5maW5pdHkpOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmlzRmluaXRlKCczJyk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc0Zpbml0ZSh2YWx1ZSkgewogICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyAmJiBuYXRpdmVJc0Zpbml0ZSh2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGEgYEZ1bmN0aW9uYCBvYmplY3QuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgZnVuY3Rpb24sIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc0Z1bmN0aW9uKF8pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNGdW5jdGlvbigvYWJjLyk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc0Z1bmN0aW9uKHZhbHVlKSB7CiAgICBpZiAoIWlzT2JqZWN0KHZhbHVlKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAvLyBUaGUgdXNlIG9mIGBPYmplY3QjdG9TdHJpbmdgIGF2b2lkcyBpc3N1ZXMgd2l0aCB0aGUgYHR5cGVvZmAgb3BlcmF0b3IKICAgIC8vIGluIFNhZmFyaSA5IHdoaWNoIHJldHVybnMgJ29iamVjdCcgZm9yIHR5cGVkIGFycmF5cyBhbmQgb3RoZXIgY29uc3RydWN0b3JzLgogICAgdmFyIHRhZyA9IGJhc2VHZXRUYWcodmFsdWUpOwogICAgcmV0dXJuIHRhZyA9PSBmdW5jVGFnIHx8IHRhZyA9PSBnZW5UYWcgfHwgdGFnID09IGFzeW5jVGFnIHx8IHRhZyA9PSBwcm94eVRhZzsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGFuIGludGVnZXIuCiAgICoKICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgYmFzZWQgb24KICAgKiBbYE51bWJlci5pc0ludGVnZXJgXShodHRwczovL21kbi5pby9OdW1iZXIvaXNJbnRlZ2VyKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYW4gaW50ZWdlciwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzSW50ZWdlcigzKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzSW50ZWdlcihOdW1iZXIuTUlOX1ZBTFVFKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5pc0ludGVnZXIoSW5maW5pdHkpOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmlzSW50ZWdlcignMycpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNJbnRlZ2VyKHZhbHVlKSB7CiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09ICdudW1iZXInICYmIHZhbHVlID09IHRvSW50ZWdlcih2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIHZhbGlkIGFycmF5LWxpa2UgbGVuZ3RoLgogICAqCiAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIGxvb3NlbHkgYmFzZWQgb24KICAgKiBbYFRvTGVuZ3RoYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtdG9sZW5ndGgpLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHZhbGlkIGxlbmd0aCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzTGVuZ3RoKDMpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNMZW5ndGgoTnVtYmVyLk1JTl9WQUxVRSk7CiAgICogLy8gPT4gZmFsc2UKICAgKgogICAqIF8uaXNMZW5ndGgoSW5maW5pdHkpOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmlzTGVuZ3RoKCczJyk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc0xlbmd0aCh2YWx1ZSkgewogICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyAmJgogICAgICB2YWx1ZSA+IC0xICYmIHZhbHVlICUgMSA9PSAwICYmIHZhbHVlIDw9IE1BWF9TQUZFX0lOVEVHRVI7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyB0aGUKICAgKiBbbGFuZ3VhZ2UgdHlwZV0oaHR0cDovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLWVjbWFzY3JpcHQtbGFuZ3VhZ2UtdHlwZXMpCiAgICogb2YgYE9iamVjdGAuIChlLmcuIGFycmF5cywgZnVuY3Rpb25zLCBvYmplY3RzLCByZWdleGVzLCBgbmV3IE51bWJlcigwKWAsIGFuZCBgbmV3IFN0cmluZygnJylgKQogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDAuMS4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBvYmplY3QsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc09iamVjdCh7fSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc09iamVjdChbMSwgMiwgM10pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNPYmplY3QoXy5ub29wKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzT2JqZWN0KG51bGwpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNPYmplY3QodmFsdWUpIHsKICAgIHZhciB0eXBlID0gdHlwZW9mIHZhbHVlOwogICAgcmV0dXJuIHZhbHVlICE9IG51bGwgJiYgKHR5cGUgPT0gJ29iamVjdCcgfHwgdHlwZSA9PSAnZnVuY3Rpb24nKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIG9iamVjdC1saWtlLiBBIHZhbHVlIGlzIG9iamVjdC1saWtlIGlmIGl0J3Mgbm90IGBudWxsYAogICAqIGFuZCBoYXMgYSBgdHlwZW9mYCByZXN1bHQgb2YgIm9iamVjdCIuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIG9iamVjdC1saWtlLCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNPYmplY3RMaWtlKHt9KTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzT2JqZWN0TGlrZShbMSwgMiwgM10pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNPYmplY3RMaWtlKF8ubm9vcCk7CiAgICogLy8gPT4gZmFsc2UKICAgKgogICAqIF8uaXNPYmplY3RMaWtlKG51bGwpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNPYmplY3RMaWtlKHZhbHVlKSB7CiAgICByZXR1cm4gdmFsdWUgIT0gbnVsbCAmJiB0eXBlb2YgdmFsdWUgPT0gJ29iamVjdCc7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGEgYE1hcGAgb2JqZWN0LgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMy4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIG1hcCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzTWFwKG5ldyBNYXApOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNNYXAobmV3IFdlYWtNYXApOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgdmFyIGlzTWFwID0gbm9kZUlzTWFwID8gYmFzZVVuYXJ5KG5vZGVJc01hcCkgOiBiYXNlSXNNYXA7CgogIC8qKgogICAqIFBlcmZvcm1zIGEgcGFydGlhbCBkZWVwIGNvbXBhcmlzb24gYmV0d2VlbiBgb2JqZWN0YCBhbmQgYHNvdXJjZWAgdG8KICAgKiBkZXRlcm1pbmUgaWYgYG9iamVjdGAgY29udGFpbnMgZXF1aXZhbGVudCBwcm9wZXJ0eSB2YWx1ZXMuCiAgICoKICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgZXF1aXZhbGVudCB0byBgXy5tYXRjaGVzYCB3aGVuIGBzb3VyY2VgIGlzCiAgICogcGFydGlhbGx5IGFwcGxpZWQuCiAgICoKICAgKiBQYXJ0aWFsIGNvbXBhcmlzb25zIHdpbGwgbWF0Y2ggZW1wdHkgYXJyYXkgYW5kIGVtcHR5IG9iamVjdCBgc291cmNlYAogICAqIHZhbHVlcyBhZ2FpbnN0IGFueSBhcnJheSBvciBvYmplY3QgdmFsdWUsIHJlc3BlY3RpdmVseS4gU2VlIGBfLmlzRXF1YWxgCiAgICogZm9yIGEgbGlzdCBvZiBzdXBwb3J0ZWQgdmFsdWUgY29tcGFyaXNvbnMuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMy4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7T2JqZWN0fSBzb3VyY2UgVGhlIG9iamVjdCBvZiBwcm9wZXJ0eSB2YWx1ZXMgdG8gbWF0Y2guCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGBvYmplY3RgIGlzIGEgbWF0Y2gsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIG9iamVjdCA9IHsgJ2EnOiAxLCAnYic6IDIgfTsKICAgKgogICAqIF8uaXNNYXRjaChvYmplY3QsIHsgJ2InOiAyIH0pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNNYXRjaChvYmplY3QsIHsgJ2InOiAxIH0pOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNNYXRjaChvYmplY3QsIHNvdXJjZSkgewogICAgcmV0dXJuIG9iamVjdCA9PT0gc291cmNlIHx8IGJhc2VJc01hdGNoKG9iamVjdCwgc291cmNlLCBnZXRNYXRjaERhdGEoc291cmNlKSk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmlzTWF0Y2hgIGV4Y2VwdCB0aGF0IGl0IGFjY2VwdHMgYGN1c3RvbWl6ZXJgIHdoaWNoCiAgICogaXMgaW52b2tlZCB0byBjb21wYXJlIHZhbHVlcy4gSWYgYGN1c3RvbWl6ZXJgIHJldHVybnMgYHVuZGVmaW5lZGAsIGNvbXBhcmlzb25zCiAgICogYXJlIGhhbmRsZWQgYnkgdGhlIG1ldGhvZCBpbnN0ZWFkLiBUaGUgYGN1c3RvbWl6ZXJgIGlzIGludm9rZWQgd2l0aCBmaXZlCiAgICogYXJndW1lbnRzOiAob2JqVmFsdWUsIHNyY1ZhbHVlLCBpbmRleHxrZXksIG9iamVjdCwgc291cmNlKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGluc3BlY3QuCiAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgb2JqZWN0IG9mIHByb3BlcnR5IHZhbHVlcyB0byBtYXRjaC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY3VzdG9taXplcl0gVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBjb21wYXJpc29ucy4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYG9iamVjdGAgaXMgYSBtYXRjaCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBmdW5jdGlvbiBpc0dyZWV0aW5nKHZhbHVlKSB7CiAgICogICByZXR1cm4gL15oKD86aXxlbGxvKSQvLnRlc3QodmFsdWUpOwogICAqIH0KICAgKgogICAqIGZ1bmN0aW9uIGN1c3RvbWl6ZXIob2JqVmFsdWUsIHNyY1ZhbHVlKSB7CiAgICogICBpZiAoaXNHcmVldGluZyhvYmpWYWx1ZSkgJiYgaXNHcmVldGluZyhzcmNWYWx1ZSkpIHsKICAgKiAgICAgcmV0dXJuIHRydWU7CiAgICogICB9CiAgICogfQogICAqCiAgICogdmFyIG9iamVjdCA9IHsgJ2dyZWV0aW5nJzogJ2hlbGxvJyB9OwogICAqIHZhciBzb3VyY2UgPSB7ICdncmVldGluZyc6ICdoaScgfTsKICAgKgogICAqIF8uaXNNYXRjaFdpdGgob2JqZWN0LCBzb3VyY2UsIGN1c3RvbWl6ZXIpOwogICAqIC8vID0+IHRydWUKICAgKi8KICBmdW5jdGlvbiBpc01hdGNoV2l0aChvYmplY3QsIHNvdXJjZSwgY3VzdG9taXplcikgewogICAgY3VzdG9taXplciA9IHR5cGVvZiBjdXN0b21pemVyID09ICdmdW5jdGlvbicgPyBjdXN0b21pemVyIDogdW5kZWZpbmVkOwogICAgcmV0dXJuIGJhc2VJc01hdGNoKG9iamVjdCwgc291cmNlLCBnZXRNYXRjaERhdGEoc291cmNlKSwgY3VzdG9taXplcik7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBgTmFOYC4KICAgKgogICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBpcyBiYXNlZCBvbgogICAqIFtgTnVtYmVyLmlzTmFOYF0oaHR0cHM6Ly9tZG4uaW8vTnVtYmVyL2lzTmFOKSBhbmQgaXMgbm90IHRoZSBzYW1lIGFzCiAgICogZ2xvYmFsIFtgaXNOYU5gXShodHRwczovL21kbi5pby9pc05hTikgd2hpY2ggcmV0dXJucyBgdHJ1ZWAgZm9yCiAgICogYHVuZGVmaW5lZGAgYW5kIG90aGVyIG5vbi1udW1iZXIgdmFsdWVzLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDAuMS4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBgTmFOYCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzTmFOKE5hTik7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc05hTihuZXcgTnVtYmVyKE5hTikpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIGlzTmFOKHVuZGVmaW5lZCk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc05hTih1bmRlZmluZWQpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNOYU4odmFsdWUpIHsKICAgIC8vIEFuIGBOYU5gIHByaW1pdGl2ZSBpcyB0aGUgb25seSB2YWx1ZSB0aGF0IGlzIG5vdCBlcXVhbCB0byBpdHNlbGYuCiAgICAvLyBQZXJmb3JtIHRoZSBgdG9TdHJpbmdUYWdgIGNoZWNrIGZpcnN0IHRvIGF2b2lkIGVycm9ycyB3aXRoIHNvbWUKICAgIC8vIEFjdGl2ZVggb2JqZWN0cyBpbiBJRS4KICAgIHJldHVybiBpc051bWJlcih2YWx1ZSkgJiYgdmFsdWUgIT0gK3ZhbHVlOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSBwcmlzdGluZSBuYXRpdmUgZnVuY3Rpb24uCiAgICoKICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgY2FuJ3QgcmVsaWFibHkgZGV0ZWN0IG5hdGl2ZSBmdW5jdGlvbnMgaW4gdGhlIHByZXNlbmNlCiAgICogb2YgdGhlIGNvcmUtanMgcGFja2FnZSBiZWNhdXNlIGNvcmUtanMgY2lyY3VtdmVudHMgdGhpcyBraW5kIG9mIGRldGVjdGlvbi4KICAgKiBEZXNwaXRlIG11bHRpcGxlIHJlcXVlc3RzLCB0aGUgY29yZS1qcyBtYWludGFpbmVyIGhhcyBtYWRlIGl0IGNsZWFyOiBhbnkKICAgKiBhdHRlbXB0IHRvIGZpeCB0aGUgZGV0ZWN0aW9uIHdpbGwgYmUgb2JzdHJ1Y3RlZC4gQXMgYSByZXN1bHQsIHdlJ3JlIGxlZnQKICAgKiB3aXRoIGxpdHRsZSBjaG9pY2UgYnV0IHRvIHRocm93IGFuIGVycm9yLiBVbmZvcnR1bmF0ZWx5LCB0aGlzIGFsc28gYWZmZWN0cwogICAqIHBhY2thZ2VzLCBsaWtlIFtiYWJlbC1wb2x5ZmlsbF0oaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvYmFiZWwtcG9seWZpbGwpLAogICAqIHdoaWNoIHJlbHkgb24gY29yZS1qcy4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBuYXRpdmUgZnVuY3Rpb24sCiAgICogIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc05hdGl2ZShBcnJheS5wcm90b3R5cGUucHVzaCk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc05hdGl2ZShfKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGlzTmF0aXZlKHZhbHVlKSB7CiAgICBpZiAoaXNNYXNrYWJsZSh2YWx1ZSkpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKENPUkVfRVJST1JfVEVYVCk7CiAgICB9CiAgICByZXR1cm4gYmFzZUlzTmF0aXZlKHZhbHVlKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGBudWxsYC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYG51bGxgLCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNOdWxsKG51bGwpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNOdWxsKHZvaWQgMCk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc051bGwodmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZSA9PT0gbnVsbDsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGBudWxsYCBvciBgdW5kZWZpbmVkYC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgbnVsbGlzaCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzTmlsKG51bGwpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNOaWwodm9pZCAwKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzTmlsKE5hTik7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc05pbCh2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlID09IG51bGw7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGEgYE51bWJlcmAgcHJpbWl0aXZlIG9yIG9iamVjdC4KICAgKgogICAqICoqTm90ZToqKiBUbyBleGNsdWRlIGBJbmZpbml0eWAsIGAtSW5maW5pdHlgLCBhbmQgYE5hTmAsIHdoaWNoIGFyZQogICAqIGNsYXNzaWZpZWQgYXMgbnVtYmVycywgdXNlIHRoZSBgXy5pc0Zpbml0ZWAgbWV0aG9kLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDAuMS4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIG51bWJlciwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzTnVtYmVyKDMpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNOdW1iZXIoTnVtYmVyLk1JTl9WQUxVRSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc051bWJlcihJbmZpbml0eSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc051bWJlcignMycpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNOdW1iZXIodmFsdWUpIHsKICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ251bWJlcicgfHwKICAgICAgKGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgYmFzZUdldFRhZyh2YWx1ZSkgPT0gbnVtYmVyVGFnKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgcGxhaW4gb2JqZWN0LCB0aGF0IGlzLCBhbiBvYmplY3QgY3JlYXRlZCBieSB0aGUKICAgKiBgT2JqZWN0YCBjb25zdHJ1Y3RvciBvciBvbmUgd2l0aCBhIGBbW1Byb3RvdHlwZV1dYCBvZiBgbnVsbGAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC44LjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgcGxhaW4gb2JqZWN0LCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIGZ1bmN0aW9uIEZvbygpIHsKICAgKiAgIHRoaXMuYSA9IDE7CiAgICogfQogICAqCiAgICogXy5pc1BsYWluT2JqZWN0KG5ldyBGb28pOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmlzUGxhaW5PYmplY3QoWzEsIDIsIDNdKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5pc1BsYWluT2JqZWN0KHsgJ3gnOiAwLCAneSc6IDAgfSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc1BsYWluT2JqZWN0KE9iamVjdC5jcmVhdGUobnVsbCkpOwogICAqIC8vID0+IHRydWUKICAgKi8KICBmdW5jdGlvbiBpc1BsYWluT2JqZWN0KHZhbHVlKSB7CiAgICBpZiAoIWlzT2JqZWN0TGlrZSh2YWx1ZSkgfHwgYmFzZUdldFRhZyh2YWx1ZSkgIT0gb2JqZWN0VGFnKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHZhciBwcm90byA9IGdldFByb3RvdHlwZSh2YWx1ZSk7CiAgICBpZiAocHJvdG8gPT09IG51bGwpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICB2YXIgQ3RvciA9IGhhc093blByb3BlcnR5LmNhbGwocHJvdG8sICdjb25zdHJ1Y3RvcicpICYmIHByb3RvLmNvbnN0cnVjdG9yOwogICAgcmV0dXJuIHR5cGVvZiBDdG9yID09ICdmdW5jdGlvbicgJiYgQ3RvciBpbnN0YW5jZW9mIEN0b3IgJiYKICAgICAgZnVuY1RvU3RyaW5nLmNhbGwoQ3RvcikgPT0gb2JqZWN0Q3RvclN0cmluZzsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSBgUmVnRXhwYCBvYmplY3QuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgcmVnZXhwLCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNSZWdFeHAoL2FiYy8pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNSZWdFeHAoJy9hYmMvJyk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICB2YXIgaXNSZWdFeHAgPSBub2RlSXNSZWdFeHAgPyBiYXNlVW5hcnkobm9kZUlzUmVnRXhwKSA6IGJhc2VJc1JlZ0V4cDsKCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSBzYWZlIGludGVnZXIuIEFuIGludGVnZXIgaXMgc2FmZSBpZiBpdCdzIGFuIElFRUUtNzU0CiAgICogZG91YmxlIHByZWNpc2lvbiBudW1iZXIgd2hpY2ggaXNuJ3QgdGhlIHJlc3VsdCBvZiBhIHJvdW5kZWQgdW5zYWZlIGludGVnZXIuCiAgICoKICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgYmFzZWQgb24KICAgKiBbYE51bWJlci5pc1NhZmVJbnRlZ2VyYF0oaHR0cHM6Ly9tZG4uaW8vTnVtYmVyL2lzU2FmZUludGVnZXIpLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHNhZmUgaW50ZWdlciwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzU2FmZUludGVnZXIoMyk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc1NhZmVJbnRlZ2VyKE51bWJlci5NSU5fVkFMVUUpOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmlzU2FmZUludGVnZXIoSW5maW5pdHkpOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmlzU2FmZUludGVnZXIoJzMnKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGlzU2FmZUludGVnZXIodmFsdWUpIHsKICAgIHJldHVybiBpc0ludGVnZXIodmFsdWUpICYmIHZhbHVlID49IC1NQVhfU0FGRV9JTlRFR0VSICYmIHZhbHVlIDw9IE1BWF9TQUZFX0lOVEVHRVI7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGEgYFNldGAgb2JqZWN0LgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMy4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHNldCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzU2V0KG5ldyBTZXQpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNTZXQobmV3IFdlYWtTZXQpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgdmFyIGlzU2V0ID0gbm9kZUlzU2V0ID8gYmFzZVVuYXJ5KG5vZGVJc1NldCkgOiBiYXNlSXNTZXQ7CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSBgU3RyaW5nYCBwcmltaXRpdmUgb3Igb2JqZWN0LgogICAqCiAgICogQHN0YXRpYwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBtZW1iZXJPZiBfCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHN0cmluZywgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzU3RyaW5nKCdhYmMnKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzU3RyaW5nKDEpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNTdHJpbmcodmFsdWUpIHsKICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ3N0cmluZycgfHwKICAgICAgKCFpc0FycmF5KHZhbHVlKSAmJiBpc09iamVjdExpa2UodmFsdWUpICYmIGJhc2VHZXRUYWcodmFsdWUpID09IHN0cmluZ1RhZyk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGEgYFN5bWJvbGAgcHJpbWl0aXZlIG9yIG9iamVjdC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBzeW1ib2wsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc1N5bWJvbChTeW1ib2wuaXRlcmF0b3IpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNTeW1ib2woJ2FiYycpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNTeW1ib2wodmFsdWUpIHsKICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ3N5bWJvbCcgfHwKICAgICAgKGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgYmFzZUdldFRhZyh2YWx1ZSkgPT0gc3ltYm9sVGFnKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSB0eXBlZCBhcnJheS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSB0eXBlZCBhcnJheSwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzVHlwZWRBcnJheShuZXcgVWludDhBcnJheSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc1R5cGVkQXJyYXkoW10pOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgdmFyIGlzVHlwZWRBcnJheSA9IG5vZGVJc1R5cGVkQXJyYXkgPyBiYXNlVW5hcnkobm9kZUlzVHlwZWRBcnJheSkgOiBiYXNlSXNUeXBlZEFycmF5OwoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBgdW5kZWZpbmVkYC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAc2luY2UgMC4xLjAKICAgKiBAbWVtYmVyT2YgXwogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYHVuZGVmaW5lZGAsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc1VuZGVmaW5lZCh2b2lkIDApOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNVbmRlZmluZWQobnVsbCk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc1VuZGVmaW5lZCh2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQ7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGEgYFdlYWtNYXBgIG9iamVjdC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjMuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSB3ZWFrIG1hcCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzV2Vha01hcChuZXcgV2Vha01hcCk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc1dlYWtNYXAobmV3IE1hcCk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc1dlYWtNYXAodmFsdWUpIHsKICAgIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIGdldFRhZyh2YWx1ZSkgPT0gd2Vha01hcFRhZzsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSBgV2Vha1NldGAgb2JqZWN0LgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMy4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHdlYWsgc2V0LCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNXZWFrU2V0KG5ldyBXZWFrU2V0KTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzV2Vha1NldChuZXcgU2V0KTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGlzV2Vha1NldCh2YWx1ZSkgewogICAgcmV0dXJuIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgYmFzZUdldFRhZyh2YWx1ZSkgPT0gd2Vha1NldFRhZzsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGxlc3MgdGhhbiBgb3RoZXJgLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDMuOS4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb21wYXJlLgogICAqIEBwYXJhbSB7Kn0gb3RoZXIgVGhlIG90aGVyIHZhbHVlIHRvIGNvbXBhcmUuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgbGVzcyB0aGFuIGBvdGhlcmAsCiAgICogIGVsc2UgYGZhbHNlYC4KICAgKiBAc2VlIF8uZ3QKICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5sdCgxLCAzKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmx0KDMsIDMpOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmx0KDMsIDEpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgdmFyIGx0ID0gY3JlYXRlUmVsYXRpb25hbE9wZXJhdGlvbihiYXNlTHQpOwoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gYG90aGVyYC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjkuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0geyp9IG90aGVyIFRoZSBvdGhlciB2YWx1ZSB0byBjb21wYXJlLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGxlc3MgdGhhbiBvciBlcXVhbCB0bwogICAqICBgb3RoZXJgLCBlbHNlIGBmYWxzZWAuCiAgICogQHNlZSBfLmd0ZQogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmx0ZSgxLCAzKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmx0ZSgzLCAzKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmx0ZSgzLCAxKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIHZhciBsdGUgPSBjcmVhdGVSZWxhdGlvbmFsT3BlcmF0aW9uKGZ1bmN0aW9uKHZhbHVlLCBvdGhlcikgewogICAgcmV0dXJuIHZhbHVlIDw9IG90aGVyOwogIH0pOwoKICAvKioKICAgKiBDb252ZXJ0cyBgdmFsdWVgIHRvIGFuIGFycmF5LgogICAqCiAgICogQHN0YXRpYwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBtZW1iZXJPZiBfCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb252ZXJ0LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgY29udmVydGVkIGFycmF5LgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnRvQXJyYXkoeyAnYSc6IDEsICdiJzogMiB9KTsKICAgKiAvLyA9PiBbMSwgMl0KICAgKgogICAqIF8udG9BcnJheSgnYWJjJyk7CiAgICogLy8gPT4gWydhJywgJ2InLCAnYyddCiAgICoKICAgKiBfLnRvQXJyYXkoMSk7CiAgICogLy8gPT4gW10KICAgKgogICAqIF8udG9BcnJheShudWxsKTsKICAgKiAvLyA9PiBbXQogICAqLwogIGZ1bmN0aW9uIHRvQXJyYXkodmFsdWUpIHsKICAgIGlmICghdmFsdWUpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfQogICAgaWYgKGlzQXJyYXlMaWtlKHZhbHVlKSkgewogICAgICByZXR1cm4gaXNTdHJpbmcodmFsdWUpID8gc3RyaW5nVG9BcnJheSh2YWx1ZSkgOiBjb3B5QXJyYXkodmFsdWUpOwogICAgfQogICAgaWYgKHN5bUl0ZXJhdG9yICYmIHZhbHVlW3N5bUl0ZXJhdG9yXSkgewogICAgICByZXR1cm4gaXRlcmF0b3JUb0FycmF5KHZhbHVlW3N5bUl0ZXJhdG9yXSgpKTsKICAgIH0KICAgIHZhciB0YWcgPSBnZXRUYWcodmFsdWUpLAogICAgICAgIGZ1bmMgPSB0YWcgPT0gbWFwVGFnID8gbWFwVG9BcnJheSA6ICh0YWcgPT0gc2V0VGFnID8gc2V0VG9BcnJheSA6IHZhbHVlcyk7CgogICAgcmV0dXJuIGZ1bmModmFsdWUpOwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYHZhbHVlYCB0byBhIGZpbml0ZSBudW1iZXIuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4xMi4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb252ZXJ0LgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBudW1iZXIuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8udG9GaW5pdGUoMy4yKTsKICAgKiAvLyA9PiAzLjIKICAgKgogICAqIF8udG9GaW5pdGUoTnVtYmVyLk1JTl9WQUxVRSk7CiAgICogLy8gPT4gNWUtMzI0CiAgICoKICAgKiBfLnRvRmluaXRlKEluZmluaXR5KTsKICAgKiAvLyA9PiAxLjc5NzY5MzEzNDg2MjMxNTdlKzMwOAogICAqCiAgICogXy50b0Zpbml0ZSgnMy4yJyk7CiAgICogLy8gPT4gMy4yCiAgICovCiAgZnVuY3Rpb24gdG9GaW5pdGUodmFsdWUpIHsKICAgIGlmICghdmFsdWUpIHsKICAgICAgcmV0dXJuIHZhbHVlID09PSAwID8gdmFsdWUgOiAwOwogICAgfQogICAgdmFsdWUgPSB0b051bWJlcih2YWx1ZSk7CiAgICBpZiAodmFsdWUgPT09IElORklOSVRZIHx8IHZhbHVlID09PSAtSU5GSU5JVFkpIHsKICAgICAgdmFyIHNpZ24gPSAodmFsdWUgPCAwID8gLTEgOiAxKTsKICAgICAgcmV0dXJuIHNpZ24gKiBNQVhfSU5URUdFUjsKICAgIH0KICAgIHJldHVybiB2YWx1ZSA9PT0gdmFsdWUgPyB2YWx1ZSA6IDA7CiAgfQoKICAvKioKICAgKiBDb252ZXJ0cyBgdmFsdWVgIHRvIGFuIGludGVnZXIuCiAgICoKICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgbG9vc2VseSBiYXNlZCBvbgogICAqIFtgVG9JbnRlZ2VyYF0oaHR0cDovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLXRvaW50ZWdlcikuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbnZlcnQuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgY29udmVydGVkIGludGVnZXIuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8udG9JbnRlZ2VyKDMuMik7CiAgICogLy8gPT4gMwogICAqCiAgICogXy50b0ludGVnZXIoTnVtYmVyLk1JTl9WQUxVRSk7CiAgICogLy8gPT4gMAogICAqCiAgICogXy50b0ludGVnZXIoSW5maW5pdHkpOwogICAqIC8vID0+IDEuNzk3NjkzMTM0ODYyMzE1N2UrMzA4CiAgICoKICAgKiBfLnRvSW50ZWdlcignMy4yJyk7CiAgICogLy8gPT4gMwogICAqLwogIGZ1bmN0aW9uIHRvSW50ZWdlcih2YWx1ZSkgewogICAgdmFyIHJlc3VsdCA9IHRvRmluaXRlKHZhbHVlKSwKICAgICAgICByZW1haW5kZXIgPSByZXN1bHQgJSAxOwoKICAgIHJldHVybiByZXN1bHQgPT09IHJlc3VsdCA/IChyZW1haW5kZXIgPyByZXN1bHQgLSByZW1haW5kZXIgOiByZXN1bHQpIDogMDsKICB9CgogIC8qKgogICAqIENvbnZlcnRzIGB2YWx1ZWAgdG8gYW4gaW50ZWdlciBzdWl0YWJsZSBmb3IgdXNlIGFzIHRoZSBsZW5ndGggb2YgYW4KICAgKiBhcnJheS1saWtlIG9iamVjdC4KICAgKgogICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBpcyBiYXNlZCBvbgogICAqIFtgVG9MZW5ndGhgXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy10b2xlbmd0aCkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbnZlcnQuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgY29udmVydGVkIGludGVnZXIuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8udG9MZW5ndGgoMy4yKTsKICAgKiAvLyA9PiAzCiAgICoKICAgKiBfLnRvTGVuZ3RoKE51bWJlci5NSU5fVkFMVUUpOwogICAqIC8vID0+IDAKICAgKgogICAqIF8udG9MZW5ndGgoSW5maW5pdHkpOwogICAqIC8vID0+IDQyOTQ5NjcyOTUKICAgKgogICAqIF8udG9MZW5ndGgoJzMuMicpOwogICAqIC8vID0+IDMKICAgKi8KICBmdW5jdGlvbiB0b0xlbmd0aCh2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlID8gYmFzZUNsYW1wKHRvSW50ZWdlcih2YWx1ZSksIDAsIE1BWF9BUlJBWV9MRU5HVEgpIDogMDsKICB9CgogIC8qKgogICAqIENvbnZlcnRzIGB2YWx1ZWAgdG8gYSBudW1iZXIuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHByb2Nlc3MuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgbnVtYmVyLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnRvTnVtYmVyKDMuMik7CiAgICogLy8gPT4gMy4yCiAgICoKICAgKiBfLnRvTnVtYmVyKE51bWJlci5NSU5fVkFMVUUpOwogICAqIC8vID0+IDVlLTMyNAogICAqCiAgICogXy50b051bWJlcihJbmZpbml0eSk7CiAgICogLy8gPT4gSW5maW5pdHkKICAgKgogICAqIF8udG9OdW1iZXIoJzMuMicpOwogICAqIC8vID0+IDMuMgogICAqLwogIGZ1bmN0aW9uIHRvTnVtYmVyKHZhbHVlKSB7CiAgICBpZiAodHlwZW9mIHZhbHVlID09ICdudW1iZXInKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIGlmIChpc1N5bWJvbCh2YWx1ZSkpIHsKICAgICAgcmV0dXJuIE5BTjsKICAgIH0KICAgIGlmIChpc09iamVjdCh2YWx1ZSkpIHsKICAgICAgdmFyIG90aGVyID0gdHlwZW9mIHZhbHVlLnZhbHVlT2YgPT0gJ2Z1bmN0aW9uJyA/IHZhbHVlLnZhbHVlT2YoKSA6IHZhbHVlOwogICAgICB2YWx1ZSA9IGlzT2JqZWN0KG90aGVyKSA/IChvdGhlciArICcnKSA6IG90aGVyOwogICAgfQogICAgaWYgKHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgewogICAgICByZXR1cm4gdmFsdWUgPT09IDAgPyB2YWx1ZSA6ICt2YWx1ZTsKICAgIH0KICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZShyZVRyaW0sICcnKTsKICAgIHZhciBpc0JpbmFyeSA9IHJlSXNCaW5hcnkudGVzdCh2YWx1ZSk7CiAgICByZXR1cm4gKGlzQmluYXJ5IHx8IHJlSXNPY3RhbC50ZXN0KHZhbHVlKSkKICAgICAgPyBmcmVlUGFyc2VJbnQodmFsdWUuc2xpY2UoMiksIGlzQmluYXJ5ID8gMiA6IDgpCiAgICAgIDogKHJlSXNCYWRIZXgudGVzdCh2YWx1ZSkgPyBOQU4gOiArdmFsdWUpOwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYHZhbHVlYCB0byBhIHBsYWluIG9iamVjdCBmbGF0dGVuaW5nIGluaGVyaXRlZCBlbnVtZXJhYmxlIHN0cmluZwogICAqIGtleWVkIHByb3BlcnRpZXMgb2YgYHZhbHVlYCB0byBvd24gcHJvcGVydGllcyBvZiB0aGUgcGxhaW4gb2JqZWN0LgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDMuMC4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb252ZXJ0LgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBwbGFpbiBvYmplY3QuCiAgICogQGV4YW1wbGUKICAgKgogICAqIGZ1bmN0aW9uIEZvbygpIHsKICAgKiAgIHRoaXMuYiA9IDI7CiAgICogfQogICAqCiAgICogRm9vLnByb3RvdHlwZS5jID0gMzsKICAgKgogICAqIF8uYXNzaWduKHsgJ2EnOiAxIH0sIG5ldyBGb28pOwogICAqIC8vID0+IHsgJ2EnOiAxLCAnYic6IDIgfQogICAqCiAgICogXy5hc3NpZ24oeyAnYSc6IDEgfSwgXy50b1BsYWluT2JqZWN0KG5ldyBGb28pKTsKICAgKiAvLyA9PiB7ICdhJzogMSwgJ2InOiAyLCAnYyc6IDMgfQogICAqLwogIGZ1bmN0aW9uIHRvUGxhaW5PYmplY3QodmFsdWUpIHsKICAgIHJldHVybiBjb3B5T2JqZWN0KHZhbHVlLCBrZXlzSW4odmFsdWUpKTsKICB9CgogIC8qKgogICAqIENvbnZlcnRzIGB2YWx1ZWAgdG8gYSBzYWZlIGludGVnZXIuIEEgc2FmZSBpbnRlZ2VyIGNhbiBiZSBjb21wYXJlZCBhbmQKICAgKiByZXByZXNlbnRlZCBjb3JyZWN0bHkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbnZlcnQuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgY29udmVydGVkIGludGVnZXIuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8udG9TYWZlSW50ZWdlcigzLjIpOwogICAqIC8vID0+IDMKICAgKgogICAqIF8udG9TYWZlSW50ZWdlcihOdW1iZXIuTUlOX1ZBTFVFKTsKICAgKiAvLyA9PiAwCiAgICoKICAgKiBfLnRvU2FmZUludGVnZXIoSW5maW5pdHkpOwogICAqIC8vID0+IDkwMDcxOTkyNTQ3NDA5OTEKICAgKgogICAqIF8udG9TYWZlSW50ZWdlcignMy4yJyk7CiAgICogLy8gPT4gMwogICAqLwogIGZ1bmN0aW9uIHRvU2FmZUludGVnZXIodmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZQogICAgICA/IGJhc2VDbGFtcCh0b0ludGVnZXIodmFsdWUpLCAtTUFYX1NBRkVfSU5URUdFUiwgTUFYX1NBRkVfSU5URUdFUikKICAgICAgOiAodmFsdWUgPT09IDAgPyB2YWx1ZSA6IDApOwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYHZhbHVlYCB0byBhIHN0cmluZy4gQW4gZW1wdHkgc3RyaW5nIGlzIHJldHVybmVkIGZvciBgbnVsbGAKICAgKiBhbmQgYHVuZGVmaW5lZGAgdmFsdWVzLiBUaGUgc2lnbiBvZiBgLTBgIGlzIHByZXNlcnZlZC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29udmVydC4KICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBjb252ZXJ0ZWQgc3RyaW5nLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnRvU3RyaW5nKG51bGwpOwogICAqIC8vID0+ICcnCiAgICoKICAgKiBfLnRvU3RyaW5nKC0wKTsKICAgKiAvLyA9PiAnLTAnCiAgICoKICAgKiBfLnRvU3RyaW5nKFsxLCAyLCAzXSk7CiAgICogLy8gPT4gJzEsMiwzJwogICAqLwogIGZ1bmN0aW9uIHRvU3RyaW5nKHZhbHVlKSB7CiAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCA/ICcnIDogYmFzZVRvU3RyaW5nKHZhbHVlKTsKICB9CgogIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCiAgLyoqCiAgICogR2V0cyB0aGUgdmFsdWUgYXQgYHBhdGhgIG9mIGBvYmplY3RgLiBJZiB0aGUgcmVzb2x2ZWQgdmFsdWUgaXMKICAgKiBgdW5kZWZpbmVkYCwgdGhlIGBkZWZhdWx0VmFsdWVgIGlzIHJldHVybmVkIGluIGl0cyBwbGFjZS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjcuMAogICAqIEBjYXRlZ29yeSBPYmplY3QKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuCiAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggb2YgdGhlIHByb3BlcnR5IHRvIGdldC4KICAgKiBAcGFyYW0geyp9IFtkZWZhdWx0VmFsdWVdIFRoZSB2YWx1ZSByZXR1cm5lZCBmb3IgYHVuZGVmaW5lZGAgcmVzb2x2ZWQgdmFsdWVzLgogICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSByZXNvbHZlZCB2YWx1ZS4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIG9iamVjdCA9IHsgJ2EnOiBbeyAnYic6IHsgJ2MnOiAzIH0gfV0gfTsKICAgKgogICAqIF8uZ2V0KG9iamVjdCwgJ2FbMF0uYi5jJyk7CiAgICogLy8gPT4gMwogICAqCiAgICogXy5nZXQob2JqZWN0LCBbJ2EnLCAnMCcsICdiJywgJ2MnXSk7CiAgICogLy8gPT4gMwogICAqCiAgICogXy5nZXQob2JqZWN0LCAnYS5iLmMnLCAnZGVmYXVsdCcpOwogICAqIC8vID0+ICdkZWZhdWx0JwogICAqLwogIGZ1bmN0aW9uIGdldChvYmplY3QsIHBhdGgsIGRlZmF1bHRWYWx1ZSkgewogICAgdmFyIHJlc3VsdCA9IG9iamVjdCA9PSBudWxsID8gdW5kZWZpbmVkIDogYmFzZUdldChvYmplY3QsIHBhdGgpOwogICAgcmV0dXJuIHJlc3VsdCA9PT0gdW5kZWZpbmVkID8gZGVmYXVsdFZhbHVlIDogcmVzdWx0OwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGBwYXRoYCBpcyBhIGRpcmVjdCBvciBpbmhlcml0ZWQgcHJvcGVydHkgb2YgYG9iamVjdGAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgT2JqZWN0CiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7QXJyYXl8c3RyaW5nfSBwYXRoIFRoZSBwYXRoIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgcGF0aGAgZXhpc3RzLCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBvYmplY3QgPSBfLmNyZWF0ZSh7ICdhJzogXy5jcmVhdGUoeyAnYic6IDIgfSkgfSk7CiAgICoKICAgKiBfLmhhc0luKG9iamVjdCwgJ2EnKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmhhc0luKG9iamVjdCwgJ2EuYicpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaGFzSW4ob2JqZWN0LCBbJ2EnLCAnYiddKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmhhc0luKG9iamVjdCwgJ2InKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGhhc0luKG9iamVjdCwgcGF0aCkgewogICAgcmV0dXJuIG9iamVjdCAhPSBudWxsICYmIGhhc1BhdGgob2JqZWN0LCBwYXRoLCBiYXNlSGFzSW4pOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB0aGUgb3duIGVudW1lcmFibGUgcHJvcGVydHkgbmFtZXMgb2YgYG9iamVjdGAuCiAgICoKICAgKiAqKk5vdGU6KiogTm9uLW9iamVjdCB2YWx1ZXMgYXJlIGNvZXJjZWQgdG8gb2JqZWN0cy4gU2VlIHRoZQogICAqIFtFUyBzcGVjXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1vYmplY3Qua2V5cykKICAgKiBmb3IgbW9yZSBkZXRhaWxzLgogICAqCiAgICogQHN0YXRpYwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBtZW1iZXJPZiBfCiAgICogQGNhdGVnb3J5IE9iamVjdAogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBmdW5jdGlvbiBGb28oKSB7CiAgICogICB0aGlzLmEgPSAxOwogICAqICAgdGhpcy5iID0gMjsKICAgKiB9CiAgICoKICAgKiBGb28ucHJvdG90eXBlLmMgPSAzOwogICAqCiAgICogXy5rZXlzKG5ldyBGb28pOwogICAqIC8vID0+IFsnYScsICdiJ10gKGl0ZXJhdGlvbiBvcmRlciBpcyBub3QgZ3VhcmFudGVlZCkKICAgKgogICAqIF8ua2V5cygnaGknKTsKICAgKiAvLyA9PiBbJzAnLCAnMSddCiAgICovCiAgZnVuY3Rpb24ga2V5cyhvYmplY3QpIHsKICAgIHJldHVybiBpc0FycmF5TGlrZShvYmplY3QpID8gYXJyYXlMaWtlS2V5cyhvYmplY3QpIDogYmFzZUtleXMob2JqZWN0KTsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYW4gYXJyYXkgb2YgdGhlIG93biBhbmQgaW5oZXJpdGVkIGVudW1lcmFibGUgcHJvcGVydHkgbmFtZXMgb2YgYG9iamVjdGAuCiAgICoKICAgKiAqKk5vdGU6KiogTm9uLW9iamVjdCB2YWx1ZXMgYXJlIGNvZXJjZWQgdG8gb2JqZWN0cy4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjAuMAogICAqIEBjYXRlZ29yeSBPYmplY3QKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcy4KICAgKiBAZXhhbXBsZQogICAqCiAgICogZnVuY3Rpb24gRm9vKCkgewogICAqICAgdGhpcy5hID0gMTsKICAgKiAgIHRoaXMuYiA9IDI7CiAgICogfQogICAqCiAgICogRm9vLnByb3RvdHlwZS5jID0gMzsKICAgKgogICAqIF8ua2V5c0luKG5ldyBGb28pOwogICAqIC8vID0+IFsnYScsICdiJywgJ2MnXSAoaXRlcmF0aW9uIG9yZGVyIGlzIG5vdCBndWFyYW50ZWVkKQogICAqLwogIGZ1bmN0aW9uIGtleXNJbihvYmplY3QpIHsKICAgIHJldHVybiBpc0FycmF5TGlrZShvYmplY3QpID8gYXJyYXlMaWtlS2V5cyhvYmplY3QsIHRydWUpIDogYmFzZUtleXNJbihvYmplY3QpOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB0aGUgb3duIGVudW1lcmFibGUgc3RyaW5nIGtleWVkIHByb3BlcnR5IHZhbHVlcyBvZiBgb2JqZWN0YC4KICAgKgogICAqICoqTm90ZToqKiBOb24tb2JqZWN0IHZhbHVlcyBhcmUgY29lcmNlZCB0byBvYmplY3RzLgogICAqCiAgICogQHN0YXRpYwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBtZW1iZXJPZiBfCiAgICogQGNhdGVnb3J5IE9iamVjdAogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IHZhbHVlcy4KICAgKiBAZXhhbXBsZQogICAqCiAgICogZnVuY3Rpb24gRm9vKCkgewogICAqICAgdGhpcy5hID0gMTsKICAgKiAgIHRoaXMuYiA9IDI7CiAgICogfQogICAqCiAgICogRm9vLnByb3RvdHlwZS5jID0gMzsKICAgKgogICAqIF8udmFsdWVzKG5ldyBGb28pOwogICAqIC8vID0+IFsxLCAyXSAoaXRlcmF0aW9uIG9yZGVyIGlzIG5vdCBndWFyYW50ZWVkKQogICAqCiAgICogXy52YWx1ZXMoJ2hpJyk7CiAgICogLy8gPT4gWydoJywgJ2knXQogICAqLwogIGZ1bmN0aW9uIHZhbHVlcyhvYmplY3QpIHsKICAgIHJldHVybiBvYmplY3QgPT0gbnVsbCA/IFtdIDogYmFzZVZhbHVlcyhvYmplY3QsIGtleXMob2JqZWN0KSk7CiAgfQoKICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgogIC8qKgogICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgYHZhbHVlYC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAyLjQuMAogICAqIEBjYXRlZ29yeSBVdGlsCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcmV0dXJuIGZyb20gdGhlIG5ldyBmdW5jdGlvbi4KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBjb25zdGFudCBmdW5jdGlvbi4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIG9iamVjdHMgPSBfLnRpbWVzKDIsIF8uY29uc3RhbnQoeyAnYSc6IDEgfSkpOwogICAqCiAgICogY29uc29sZS5sb2cob2JqZWN0cyk7CiAgICogLy8gPT4gW3sgJ2EnOiAxIH0sIHsgJ2EnOiAxIH1dCiAgICoKICAgKiBjb25zb2xlLmxvZyhvYmplY3RzWzBdID09PSBvYmplY3RzWzFdKTsKICAgKiAvLyA9PiB0cnVlCiAgICovCiAgZnVuY3Rpb24gY29uc3RhbnQodmFsdWUpIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfTsKICB9CgogIC8qKgogICAqIFRoaXMgbWV0aG9kIHJldHVybnMgdGhlIGZpcnN0IGFyZ3VtZW50IGl0IHJlY2VpdmVzLgogICAqCiAgICogQHN0YXRpYwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBtZW1iZXJPZiBfCiAgICogQGNhdGVnb3J5IFV0aWwKICAgKiBAcGFyYW0geyp9IHZhbHVlIEFueSB2YWx1ZS4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyBgdmFsdWVgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgb2JqZWN0ID0geyAnYSc6IDEgfTsKICAgKgogICAqIGNvbnNvbGUubG9nKF8uaWRlbnRpdHkob2JqZWN0KSA9PT0gb2JqZWN0KTsKICAgKiAvLyA9PiB0cnVlCiAgICovCiAgZnVuY3Rpb24gaWRlbnRpdHkodmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZTsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IGludm9rZXMgYGZ1bmNgIHdpdGggdGhlIGFyZ3VtZW50cyBvZiB0aGUgY3JlYXRlZAogICAqIGZ1bmN0aW9uLiBJZiBgZnVuY2AgaXMgYSBwcm9wZXJ0eSBuYW1lLCB0aGUgY3JlYXRlZCBmdW5jdGlvbiByZXR1cm5zIHRoZQogICAqIHByb3BlcnR5IHZhbHVlIGZvciBhIGdpdmVuIGVsZW1lbnQuIElmIGBmdW5jYCBpcyBhbiBhcnJheSBvciBvYmplY3QsIHRoZQogICAqIGNyZWF0ZWQgZnVuY3Rpb24gcmV0dXJucyBgdHJ1ZWAgZm9yIGVsZW1lbnRzIHRoYXQgY29udGFpbiB0aGUgZXF1aXZhbGVudAogICAqIHNvdXJjZSBwcm9wZXJ0aWVzLCBvdGhlcndpc2UgaXQgcmV0dXJucyBgZmFsc2VgLgogICAqCiAgICogQHN0YXRpYwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBtZW1iZXJPZiBfCiAgICogQGNhdGVnb3J5IFV0aWwKICAgKiBAcGFyYW0geyp9IFtmdW5jPV8uaWRlbnRpdHldIFRoZSB2YWx1ZSB0byBjb252ZXJ0IHRvIGEgY2FsbGJhY2suCiAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBjYWxsYmFjay4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIHVzZXJzID0gWwogICAqICAgeyAndXNlcic6ICdiYXJuZXknLCAnYWdlJzogMzYsICdhY3RpdmUnOiB0cnVlIH0sCiAgICogICB7ICd1c2VyJzogJ2ZyZWQnLCAgICdhZ2UnOiA0MCwgJ2FjdGl2ZSc6IGZhbHNlIH0KICAgKiBdOwogICAqCiAgICogLy8gVGhlIGBfLm1hdGNoZXNgIGl0ZXJhdGVlIHNob3J0aGFuZC4KICAgKiBfLmZpbHRlcih1c2VycywgXy5pdGVyYXRlZSh7ICd1c2VyJzogJ2Jhcm5leScsICdhY3RpdmUnOiB0cnVlIH0pKTsKICAgKiAvLyA9PiBbeyAndXNlcic6ICdiYXJuZXknLCAnYWdlJzogMzYsICdhY3RpdmUnOiB0cnVlIH1dCiAgICoKICAgKiAvLyBUaGUgYF8ubWF0Y2hlc1Byb3BlcnR5YCBpdGVyYXRlZSBzaG9ydGhhbmQuCiAgICogXy5maWx0ZXIodXNlcnMsIF8uaXRlcmF0ZWUoWyd1c2VyJywgJ2ZyZWQnXSkpOwogICAqIC8vID0+IFt7ICd1c2VyJzogJ2ZyZWQnLCAnYWdlJzogNDAgfV0KICAgKgogICAqIC8vIFRoZSBgXy5wcm9wZXJ0eWAgaXRlcmF0ZWUgc2hvcnRoYW5kLgogICAqIF8ubWFwKHVzZXJzLCBfLml0ZXJhdGVlKCd1c2VyJykpOwogICAqIC8vID0+IFsnYmFybmV5JywgJ2ZyZWQnXQogICAqCiAgICogLy8gQ3JlYXRlIGN1c3RvbSBpdGVyYXRlZSBzaG9ydGhhbmRzLgogICAqIF8uaXRlcmF0ZWUgPSBfLndyYXAoXy5pdGVyYXRlZSwgZnVuY3Rpb24oaXRlcmF0ZWUsIGZ1bmMpIHsKICAgKiAgIHJldHVybiAhXy5pc1JlZ0V4cChmdW5jKSA/IGl0ZXJhdGVlKGZ1bmMpIDogZnVuY3Rpb24oc3RyaW5nKSB7CiAgICogICAgIHJldHVybiBmdW5jLnRlc3Qoc3RyaW5nKTsKICAgKiAgIH07CiAgICogfSk7CiAgICoKICAgKiBfLmZpbHRlcihbJ2FiYycsICdkZWYnXSwgL2VmLyk7CiAgICogLy8gPT4gWydkZWYnXQogICAqLwogIGZ1bmN0aW9uIGl0ZXJhdGVlKGZ1bmMpIHsKICAgIHJldHVybiBiYXNlSXRlcmF0ZWUodHlwZW9mIGZ1bmMgPT0gJ2Z1bmN0aW9uJyA/IGZ1bmMgOiBiYXNlQ2xvbmUoZnVuYywgQ0xPTkVfREVFUF9GTEFHKSk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCByZXR1cm5zIGB1bmRlZmluZWRgLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDIuMy4wCiAgICogQGNhdGVnb3J5IFV0aWwKICAgKiBAZXhhbXBsZQogICAqCiAgICogXy50aW1lcygyLCBfLm5vb3ApOwogICAqIC8vID0+IFt1bmRlZmluZWQsIHVuZGVmaW5lZF0KICAgKi8KICBmdW5jdGlvbiBub29wKCkgewogICAgLy8gTm8gb3BlcmF0aW9uIHBlcmZvcm1lZC4KICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgdGhlIHZhbHVlIGF0IGBwYXRoYCBvZiBhIGdpdmVuIG9iamVjdC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAyLjQuMAogICAqIEBjYXRlZ29yeSBVdGlsCiAgICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggb2YgdGhlIHByb3BlcnR5IHRvIGdldC4KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBhY2Nlc3NvciBmdW5jdGlvbi4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIG9iamVjdHMgPSBbCiAgICogICB7ICdhJzogeyAnYic6IDIgfSB9LAogICAqICAgeyAnYSc6IHsgJ2InOiAxIH0gfQogICAqIF07CiAgICoKICAgKiBfLm1hcChvYmplY3RzLCBfLnByb3BlcnR5KCdhLmInKSk7CiAgICogLy8gPT4gWzIsIDFdCiAgICoKICAgKiBfLm1hcChfLnNvcnRCeShvYmplY3RzLCBfLnByb3BlcnR5KFsnYScsICdiJ10pKSwgJ2EuYicpOwogICAqIC8vID0+IFsxLCAyXQogICAqLwogIGZ1bmN0aW9uIHByb3BlcnR5KHBhdGgpIHsKICAgIHJldHVybiBpc0tleShwYXRoKSA/IGJhc2VQcm9wZXJ0eSh0b0tleShwYXRoKSkgOiBiYXNlUHJvcGVydHlEZWVwKHBhdGgpOwogIH0KCiAgLyoqCiAgICogVGhpcyBtZXRob2QgcmV0dXJucyBhIG5ldyBlbXB0eSBhcnJheS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjEzLjAKICAgKiBAY2F0ZWdvcnkgVXRpbAogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGVtcHR5IGFycmF5LgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgYXJyYXlzID0gXy50aW1lcygyLCBfLnN0dWJBcnJheSk7CiAgICoKICAgKiBjb25zb2xlLmxvZyhhcnJheXMpOwogICAqIC8vID0+IFtbXSwgW11dCiAgICoKICAgKiBjb25zb2xlLmxvZyhhcnJheXNbMF0gPT09IGFycmF5c1sxXSk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBzdHViQXJyYXkoKSB7CiAgICByZXR1cm4gW107CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCByZXR1cm5zIGBmYWxzZWAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4xMy4wCiAgICogQGNhdGVnb3J5IFV0aWwKICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnRpbWVzKDIsIF8uc3R1YkZhbHNlKTsKICAgKiAvLyA9PiBbZmFsc2UsIGZhbHNlXQogICAqLwogIGZ1bmN0aW9uIHN0dWJGYWxzZSgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCiAgLy8gQWRkIG1ldGhvZHMgdGhhdCByZXR1cm4gd3JhcHBlZCB2YWx1ZXMgaW4gY2hhaW4gc2VxdWVuY2VzLgogIGxvZGFzaC5jYXN0QXJyYXkgPSBjYXN0QXJyYXk7CiAgbG9kYXNoLmNodW5rID0gY2h1bms7CiAgbG9kYXNoLmNvbXBhY3QgPSBjb21wYWN0OwogIGxvZGFzaC5jb25jYXQgPSBjb25jYXQ7CiAgbG9kYXNoLmNvbnN0YW50ID0gY29uc3RhbnQ7CiAgbG9kYXNoLmRpZmZlcmVuY2UgPSBkaWZmZXJlbmNlOwogIGxvZGFzaC5kaWZmZXJlbmNlQnkgPSBkaWZmZXJlbmNlQnk7CiAgbG9kYXNoLmRpZmZlcmVuY2VXaXRoID0gZGlmZmVyZW5jZVdpdGg7CiAgbG9kYXNoLmRyb3AgPSBkcm9wOwogIGxvZGFzaC5kcm9wUmlnaHQgPSBkcm9wUmlnaHQ7CiAgbG9kYXNoLmRyb3BSaWdodFdoaWxlID0gZHJvcFJpZ2h0V2hpbGU7CiAgbG9kYXNoLmRyb3BXaGlsZSA9IGRyb3BXaGlsZTsKICBsb2Rhc2guZmlsbCA9IGZpbGw7CiAgbG9kYXNoLmZsYXR0ZW4gPSBmbGF0dGVuOwogIGxvZGFzaC5mbGF0dGVuRGVlcCA9IGZsYXR0ZW5EZWVwOwogIGxvZGFzaC5mbGF0dGVuRGVwdGggPSBmbGF0dGVuRGVwdGg7CiAgbG9kYXNoLmZyb21QYWlycyA9IGZyb21QYWlyczsKICBsb2Rhc2guaW5pdGlhbCA9IGluaXRpYWw7CiAgbG9kYXNoLmludGVyc2VjdGlvbiA9IGludGVyc2VjdGlvbjsKICBsb2Rhc2guaW50ZXJzZWN0aW9uQnkgPSBpbnRlcnNlY3Rpb25CeTsKICBsb2Rhc2guaW50ZXJzZWN0aW9uV2l0aCA9IGludGVyc2VjdGlvbldpdGg7CiAgbG9kYXNoLml0ZXJhdGVlID0gaXRlcmF0ZWU7CiAgbG9kYXNoLmtleXMgPSBrZXlzOwogIGxvZGFzaC5rZXlzSW4gPSBrZXlzSW47CiAgbG9kYXNoLm1lbW9pemUgPSBtZW1vaXplOwogIGxvZGFzaC5wcm9wZXJ0eSA9IHByb3BlcnR5OwogIGxvZGFzaC5wdWxsID0gcHVsbDsKICBsb2Rhc2gucHVsbEFsbCA9IHB1bGxBbGw7CiAgbG9kYXNoLnB1bGxBbGxCeSA9IHB1bGxBbGxCeTsKICBsb2Rhc2gucHVsbEFsbFdpdGggPSBwdWxsQWxsV2l0aDsKICBsb2Rhc2gucHVsbEF0ID0gcHVsbEF0OwogIGxvZGFzaC5yZW1vdmUgPSByZW1vdmU7CiAgbG9kYXNoLnJldmVyc2UgPSByZXZlcnNlOwogIGxvZGFzaC5zbGljZSA9IHNsaWNlOwogIGxvZGFzaC5zb3J0ZWRVbmlxID0gc29ydGVkVW5pcTsKICBsb2Rhc2guc29ydGVkVW5pcUJ5ID0gc29ydGVkVW5pcUJ5OwogIGxvZGFzaC50YWlsID0gdGFpbDsKICBsb2Rhc2gudGFrZSA9IHRha2U7CiAgbG9kYXNoLnRha2VSaWdodCA9IHRha2VSaWdodDsKICBsb2Rhc2gudGFrZVJpZ2h0V2hpbGUgPSB0YWtlUmlnaHRXaGlsZTsKICBsb2Rhc2gudGFrZVdoaWxlID0gdGFrZVdoaWxlOwogIGxvZGFzaC50b0FycmF5ID0gdG9BcnJheTsKICBsb2Rhc2gudG9QbGFpbk9iamVjdCA9IHRvUGxhaW5PYmplY3Q7CiAgbG9kYXNoLnVuaW9uID0gdW5pb247CiAgbG9kYXNoLnVuaW9uQnkgPSB1bmlvbkJ5OwogIGxvZGFzaC51bmlvbldpdGggPSB1bmlvbldpdGg7CiAgbG9kYXNoLnVuaXEgPSB1bmlxOwogIGxvZGFzaC51bmlxQnkgPSB1bmlxQnk7CiAgbG9kYXNoLnVuaXFXaXRoID0gdW5pcVdpdGg7CiAgbG9kYXNoLnVuemlwID0gdW56aXA7CiAgbG9kYXNoLnVuemlwV2l0aCA9IHVuemlwV2l0aDsKICBsb2Rhc2gudmFsdWVzID0gdmFsdWVzOwogIGxvZGFzaC53aXRob3V0ID0gd2l0aG91dDsKICBsb2Rhc2gueG9yID0geG9yOwogIGxvZGFzaC54b3JCeSA9IHhvckJ5OwogIGxvZGFzaC54b3JXaXRoID0geG9yV2l0aDsKICBsb2Rhc2guemlwID0gemlwOwogIGxvZGFzaC56aXBPYmplY3QgPSB6aXBPYmplY3Q7CiAgbG9kYXNoLnppcE9iamVjdERlZXAgPSB6aXBPYmplY3REZWVwOwogIGxvZGFzaC56aXBXaXRoID0gemlwV2l0aDsKCiAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKICAvLyBBZGQgbWV0aG9kcyB0aGF0IHJldHVybiB1bndyYXBwZWQgdmFsdWVzIGluIGNoYWluIHNlcXVlbmNlcy4KICBsb2Rhc2guY2xvbmUgPSBjbG9uZTsKICBsb2Rhc2guY2xvbmVEZWVwID0gY2xvbmVEZWVwOwogIGxvZGFzaC5jbG9uZURlZXBXaXRoID0gY2xvbmVEZWVwV2l0aDsKICBsb2Rhc2guY2xvbmVXaXRoID0gY2xvbmVXaXRoOwogIGxvZGFzaC5jb25mb3Jtc1RvID0gY29uZm9ybXNUbzsKICBsb2Rhc2guZXEgPSBlcTsKICBsb2Rhc2guZmluZEluZGV4ID0gZmluZEluZGV4OwogIGxvZGFzaC5maW5kTGFzdEluZGV4ID0gZmluZExhc3RJbmRleDsKICBsb2Rhc2guZ2V0ID0gZ2V0OwogIGxvZGFzaC5ndCA9IGd0OwogIGxvZGFzaC5ndGUgPSBndGU7CiAgbG9kYXNoLmhhc0luID0gaGFzSW47CiAgbG9kYXNoLmhlYWQgPSBoZWFkOwogIGxvZGFzaC5pZGVudGl0eSA9IGlkZW50aXR5OwogIGxvZGFzaC5pbmRleE9mID0gaW5kZXhPZjsKICBsb2Rhc2guaXNBcmd1bWVudHMgPSBpc0FyZ3VtZW50czsKICBsb2Rhc2guaXNBcnJheSA9IGlzQXJyYXk7CiAgbG9kYXNoLmlzQXJyYXlCdWZmZXIgPSBpc0FycmF5QnVmZmVyOwogIGxvZGFzaC5pc0FycmF5TGlrZSA9IGlzQXJyYXlMaWtlOwogIGxvZGFzaC5pc0FycmF5TGlrZU9iamVjdCA9IGlzQXJyYXlMaWtlT2JqZWN0OwogIGxvZGFzaC5pc0Jvb2xlYW4gPSBpc0Jvb2xlYW47CiAgbG9kYXNoLmlzQnVmZmVyID0gaXNCdWZmZXI7CiAgbG9kYXNoLmlzRGF0ZSA9IGlzRGF0ZTsKICBsb2Rhc2guaXNFbGVtZW50ID0gaXNFbGVtZW50OwogIGxvZGFzaC5pc0VtcHR5ID0gaXNFbXB0eTsKICBsb2Rhc2guaXNFcXVhbCA9IGlzRXF1YWw7CiAgbG9kYXNoLmlzRXF1YWxXaXRoID0gaXNFcXVhbFdpdGg7CiAgbG9kYXNoLmlzRXJyb3IgPSBpc0Vycm9yOwogIGxvZGFzaC5pc0Zpbml0ZSA9IGlzRmluaXRlOwogIGxvZGFzaC5pc0Z1bmN0aW9uID0gaXNGdW5jdGlvbjsKICBsb2Rhc2guaXNJbnRlZ2VyID0gaXNJbnRlZ2VyOwogIGxvZGFzaC5pc0xlbmd0aCA9IGlzTGVuZ3RoOwogIGxvZGFzaC5pc01hcCA9IGlzTWFwOwogIGxvZGFzaC5pc01hdGNoID0gaXNNYXRjaDsKICBsb2Rhc2guaXNNYXRjaFdpdGggPSBpc01hdGNoV2l0aDsKICBsb2Rhc2guaXNOYU4gPSBpc05hTjsKICBsb2Rhc2guaXNOYXRpdmUgPSBpc05hdGl2ZTsKICBsb2Rhc2guaXNOaWwgPSBpc05pbDsKICBsb2Rhc2guaXNOdWxsID0gaXNOdWxsOwogIGxvZGFzaC5pc051bWJlciA9IGlzTnVtYmVyOwogIGxvZGFzaC5pc09iamVjdCA9IGlzT2JqZWN0OwogIGxvZGFzaC5pc09iamVjdExpa2UgPSBpc09iamVjdExpa2U7CiAgbG9kYXNoLmlzUGxhaW5PYmplY3QgPSBpc1BsYWluT2JqZWN0OwogIGxvZGFzaC5pc1JlZ0V4cCA9IGlzUmVnRXhwOwogIGxvZGFzaC5pc1NhZmVJbnRlZ2VyID0gaXNTYWZlSW50ZWdlcjsKICBsb2Rhc2guaXNTZXQgPSBpc1NldDsKICBsb2Rhc2guaXNTdHJpbmcgPSBpc1N0cmluZzsKICBsb2Rhc2guaXNTeW1ib2wgPSBpc1N5bWJvbDsKICBsb2Rhc2guaXNUeXBlZEFycmF5ID0gaXNUeXBlZEFycmF5OwogIGxvZGFzaC5pc1VuZGVmaW5lZCA9IGlzVW5kZWZpbmVkOwogIGxvZGFzaC5pc1dlYWtNYXAgPSBpc1dlYWtNYXA7CiAgbG9kYXNoLmlzV2Vha1NldCA9IGlzV2Vha1NldDsKICBsb2Rhc2guam9pbiA9IGpvaW47CiAgbG9kYXNoLmxhc3QgPSBsYXN0OwogIGxvZGFzaC5sYXN0SW5kZXhPZiA9IGxhc3RJbmRleE9mOwogIGxvZGFzaC5sdCA9IGx0OwogIGxvZGFzaC5sdGUgPSBsdGU7CiAgbG9kYXNoLnN0dWJBcnJheSA9IHN0dWJBcnJheTsKICBsb2Rhc2guc3R1YkZhbHNlID0gc3R1YkZhbHNlOwogIGxvZGFzaC5udGggPSBudGg7CiAgbG9kYXNoLm5vb3AgPSBub29wOwogIGxvZGFzaC5zb3J0ZWRJbmRleCA9IHNvcnRlZEluZGV4OwogIGxvZGFzaC5zb3J0ZWRJbmRleEJ5ID0gc29ydGVkSW5kZXhCeTsKICBsb2Rhc2guc29ydGVkSW5kZXhPZiA9IHNvcnRlZEluZGV4T2Y7CiAgbG9kYXNoLnNvcnRlZExhc3RJbmRleCA9IHNvcnRlZExhc3RJbmRleDsKICBsb2Rhc2guc29ydGVkTGFzdEluZGV4QnkgPSBzb3J0ZWRMYXN0SW5kZXhCeTsKICBsb2Rhc2guc29ydGVkTGFzdEluZGV4T2YgPSBzb3J0ZWRMYXN0SW5kZXhPZjsKICBsb2Rhc2gudG9GaW5pdGUgPSB0b0Zpbml0ZTsKICBsb2Rhc2gudG9JbnRlZ2VyID0gdG9JbnRlZ2VyOwogIGxvZGFzaC50b0xlbmd0aCA9IHRvTGVuZ3RoOwogIGxvZGFzaC50b051bWJlciA9IHRvTnVtYmVyOwogIGxvZGFzaC50b1NhZmVJbnRlZ2VyID0gdG9TYWZlSW50ZWdlcjsKICBsb2Rhc2gudG9TdHJpbmcgPSB0b1N0cmluZzsKCiAgLy8gQWRkIGFsaWFzZXMuCiAgbG9kYXNoLmZpcnN0ID0gaGVhZDsKCiAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKICAvKioKICAgKiBUaGUgc2VtYW50aWMgdmVyc2lvbiBudW1iZXIuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAdHlwZSB7c3RyaW5nfQogICAqLwogIGxvZGFzaC5WRVJTSU9OID0gVkVSU0lPTjsKCiAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgogIC8vIFNvbWUgQU1EIGJ1aWxkIG9wdGltaXplcnMsIGxpa2Ugci5qcywgY2hlY2sgZm9yIGNvbmRpdGlvbiBwYXR0ZXJucyBsaWtlOgogIGlmICh0eXBlb2YgZGVmaW5lID09ICdmdW5jdGlvbicgJiYgdHlwZW9mIGRlZmluZS5hbWQgPT0gJ29iamVjdCcgJiYgZGVmaW5lLmFtZCkgewogICAgLy8gRXhwb3NlIExvZGFzaCBvbiB0aGUgZ2xvYmFsIG9iamVjdCB0byBwcmV2ZW50IGVycm9ycyB3aGVuIExvZGFzaCBpcwogICAgLy8gbG9hZGVkIGJ5IGEgc2NyaXB0IHRhZyBpbiB0aGUgcHJlc2VuY2Ugb2YgYW4gQU1EIGxvYWRlci4KICAgIC8vIFNlZSBodHRwOi8vcmVxdWlyZWpzLm9yZy9kb2NzL2Vycm9ycy5odG1sI21pc21hdGNoIGZvciBtb3JlIGRldGFpbHMuCiAgICAvLyBVc2UgYF8ubm9Db25mbGljdGAgdG8gcmVtb3ZlIExvZGFzaCBmcm9tIHRoZSBnbG9iYWwgb2JqZWN0LgogICAgcm9vdC5fID0gbG9kYXNoOwoKICAgIC8vIERlZmluZSBhcyBhbiBhbm9ueW1vdXMgbW9kdWxlIHNvLCB0aHJvdWdoIHBhdGggbWFwcGluZywgaXQgY2FuIGJlCiAgICAvLyByZWZlcmVuY2VkIGFzIHRoZSAidW5kZXJzY29yZSIgbW9kdWxlLgogICAgZGVmaW5lKGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gbG9kYXNoOwogICAgfSk7CiAgfQogIC8vIENoZWNrIGZvciBgZXhwb3J0c2AgYWZ0ZXIgYGRlZmluZWAgaW4gY2FzZSBhIGJ1aWxkIG9wdGltaXplciBhZGRzIGl0LgogIGVsc2UgaWYgKGZyZWVNb2R1bGUpIHsKICAgIC8vIEV4cG9ydCBmb3IgTm9kZS5qcy4KICAgIChmcmVlTW9kdWxlLmV4cG9ydHMgPSBsb2Rhc2gpLl8gPSBsb2Rhc2g7CiAgICAvLyBFeHBvcnQgZm9yIENvbW1vbkpTIHN1cHBvcnQuCiAgICBmcmVlRXhwb3J0cy5fID0gbG9kYXNoOwogIH0KICBlbHNlIHsKICAgIC8vIEV4cG9ydCB0byB0aGUgZ2xvYmFsIG9iamVjdC4KICAgIHJvb3QuXyA9IGxvZGFzaDsKICB9Cn0uY2FsbCh0aGlzKSk7Cg==", "moduleName": "Lodash"}, {"javascript": "LyoqIEBmaWxlIFByb3ZpZGUgYSBHbG9iYWwgc3ltYm9sICovCkVYUE9SVEVEX1NZTUJPTFMgPSBbICdHbG9iYWwnIF07CgovLyBJbXBvcnRhbnQgbm90ZTogVGhpcyBtb2R1bGUgY2FuIG5vdCB1c2UgdGhlIExvZyBtb2R1bGUsIGFzIHRoZSBMb2cKLy8gbW9kdWxlIHVzZXMgdGhpcyBtb2R1bGUuIEFuZCwgaG9uZXN0ZWx5LCB3aGF0IHdvdWxkIHlvdSBsb2c/Ci8vIFJpZ2h0LiBKdXN0IGRvbid0IGRvIGl0LiBOb3csIG1vdmUgYWxvbmcsIG5vdGhpbmcgdG8gc2VlIGhlcmUuCgovKioKICogUHJvdmlkZSBjb25zaXN0ZW50IGFjY2VzcyB0byB0aGUgR2xvYmFsIHZhcmlhYmxlLgogKgogKiBXaGVuIHVzZWQsIHRoaXMgbW9kdWxlIHdpbGwgaW50cm9kdWNlIGEgZ2xvYmFsIHZhcmlhYmxlIGNhbGxlZAogKiBgR2xvYmFsYCwgdGhhdCBpcyBhIHJlZmVyZW5jZSB0byB0aGUgdG9wbGV2ZWwgR2xvYmFsIG9iamVjdC4KICogCiAqIFRoaXMgbW9kdWxlIGRvZXMgbm90IHByb3ZpZGUgYW55IG1ldGhvZHMgb3IgbWVtYmVyLCBiZXNpZGVzIHRoZQogKiBHbG9iYWwgdmFyaWFibGUuCiAqCiAqIEB0eXBlIHtvYmplY3R9CiAqIEBleGFtcGxlCi8vIFRoaXMgbG9hZHMgdGhlIEdsb2JhbCBtb2R1bGUsIGFuZCBjcmVhdGVzIGEgdmFyaWFibGUgY2FsbGVkIEdsb2JhbAp1c2UoICJHbG9iYWwiICk7CiogQG5hbWVzcGFjZQogKiBAbmFtZSBHbG9iYWwgKi8KdmFyIEdsb2JhbCA9IGZ1bmN0aW9uKCApIHsKICAgIC8qKiBHZXQgYWNjZXNzIHRvIHRoZSBHbG9iYWwgdmFyaWFibGUuCiAgICAgKiAKICAgICAqIFRoaXMgZnVuY3Rpb24gcmV0dXJucyBhIHJlZmVyZW5jZSB0byB0aGUgdG9wbGV2ZWwgR2xvYmFsCiAgICAgKiB2YXJpYWJsZS4gSW4gbm9uLWJyb3dzZXIgZW52aXJvbm1lbnRzLCB0aGlzIGlzIGVxdWFsIHRvIHRoZQogICAgICogdGhpcyB2YXJpYWJsZSBhdCB0b3BsZXZlbCBzY29wZSwgYnV0IHJlcXVpcmVzIGEgYml0IG1vcmUgdG8gZ2V0CiAgICAgKiB0bywgaWYgbm90IGEgdG9wbGV2ZWwgc2NvcGUuCiAgICAgKiAKICAgICAqIEB0eXBle2Z1bmN0aW9ufQogICAgICogQHByaXZhdGUKICAgICAqIEByZXR1cm4ge29iamVjdH0gQSByZWZlcmVuY2UgdG8gdGhlIGdsb2JhbCBvYmplY3QgKi8KICAgIHZhciBnZXRHbG9iYWwgPSBmdW5jdGlvbiggKSB7CiAgICAgICAgcmV0dXJuICggZnVuY3Rpb24oICkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0gKSggKTsKICAgIH07CiAgICAvLyByZXR1cm4gcmVzdWx0IG9mIGNhbGwgdG8gZ2V0R2xvYmFsLCBpLmUuIHJlZiB0byBnbG9iYWwKICAgIHJldHVybiBnZXRHbG9iYWwoICk7Cn0oICk7Cg==", "moduleName": "Global"}, {"javascript": "LyoqIEBmaWxlIE1vZHVsZSB0aGF0IHByb2R1Y2VzIGFkbWluaXN0cmF0aXZlIGRhdGEuICovCgpFWFBPUlRFRF9TWU1CT0xTID0gWyAnQWRtaW5EYXRhJyBdOwoKdXNlKCAiTG9nIiApOwp1c2UoICJYbWxVdGlsIiApOwp1c2UoICJVdGlsIiApOwoKCi8qKgogKiBNb2R1bGUgdGhhdCBwcm9kdWNlcyBhZG1pbmlzdHJhdGl2ZSBkYXRhIChYTUwpIGZvciB0aGUgZGF0YXdlbGwuCiAqCiAqIEB0eXBlIHtuYW1lc3BhY2V9CiAqIEBuYW1lc3BhY2UKICovCnZhciBBZG1pbkRhdGEgPSBmdW5jdGlvbigpIHsKCiAgICBMb2cuaW5mbyggIkVudGVyaW5nOiBBZG1pbkRhdGEgbW9kdWxlIiApOwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgVGluZyB4bWwgY29udGFpbmVyIGluc3RhbmNlLCBhbmQgYWRkcyBuYW1lc3BhY2VzLgogICAgICoKICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IEFkbWluRGF0YS5jcmVhdGVUaW5nQ29udGFpbmVyKCApCiAgICAgKiBAcmV0dXJuIHtYTUx9IFRpbmcgY29udGFpbmVyIFhNTCBvYmplY3QKICAgICAqIEBleGFtcGxlIEFkbWluRGF0YS5jcmVhdGVUaW5nQ29udGFpbmVyKCApCiAgICAgKiBAbmFtZSBBZG1pbkRhdGEuY3JlYXRlVGluZ0NvbnRhaW5lcgogICAgICogQGZ1bmN0aW9uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNyZWF0ZVRpbmdDb250YWluZXIgKCApIHsKCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmc6IEFkbWluRGF0YS5jcmVhdGVUaW5nQ29udGFpbmVyIGZ1bmN0aW9uIiApOwoKICAgICAgICB2YXIgY29udGFpbmVyID0gWG1sVXRpbC5jcmVhdGVEb2N1bWVudCggImNvbnRhaW5lciIsIFhtbE5hbWVzcGFjZXMudGluZyApOwogICAgICAgIFhtbFV0aWwuYWRkRG9jdW1lbnROYW1lc3BhY2UoY29udGFpbmVyLCBYbWxOYW1lc3BhY2VzLmRrYWJtICk7CiAgICAgICAgWG1sVXRpbC5hZGREb2N1bWVudE5hbWVzcGFjZShjb250YWluZXIsIFhtbE5hbWVzcGFjZXMuYWMgKTsKICAgICAgICBYbWxVdGlsLmFkZERvY3VtZW50TmFtZXNwYWNlKGNvbnRhaW5lciwgWG1sTmFtZXNwYWNlcy5ka2RjcGx1cyApOwogICAgICAgIFhtbFV0aWwuYWRkRG9jdW1lbnROYW1lc3BhY2UoY29udGFpbmVyLCBYbWxOYW1lc3BhY2VzLm9zcyApOwogICAgICAgIFhtbFV0aWwuYWRkRG9jdW1lbnROYW1lc3BhY2UoY29udGFpbmVyLCBYbWxOYW1lc3BhY2VzLmRjICk7CiAgICAgICAgWG1sVXRpbC5hZGREb2N1bWVudE5hbWVzcGFjZShjb250YWluZXIsIFhtbE5hbWVzcGFjZXMuZGN0ZXJtcyApOwogICAgICAgIFhtbFV0aWwuYWRkRG9jdW1lbnROYW1lc3BhY2UoY29udGFpbmVyLCBYbWxOYW1lc3BhY2VzLnhzaSApOwogICAgICAgIFhtbFV0aWwuYWRkRG9jdW1lbnROYW1lc3BhY2UoY29udGFpbmVyLCBYbWxOYW1lc3BhY2VzLmRvY2Jvb2sgKTsKCiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZzogQWRtaW5EYXRhLmNyZWF0ZVRpbmdDb250YWluZXIgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBjb250YWluZXI7CgogICAgfQoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGNvbGxlY3Rpb24gaWRlbnRpZmllcnMgZm9yIHRoZSB4bWwtZG9jdW1lbnQuCiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBBZG1pbkRhdGEuY3JlYXRlQ29sbGVjdGlvbklkZW50aWZpZXJzKCBhZG1pbkluZm8gKQogICAgICogQHBhcmFtIHtPYmplY3R9IGFkbWluSW5mbyBhZG1pbmlzdHJhdGl2ZSBpbmZvcm1hdGlvbgogICAgICogQHJldHVybiB7U3RyaW5nW119IEFycmF5IHdpdGggdGhlIGNvbGxlY3Rpb24gaWRlbnRpZmllcnMgZm9yIHRoZSByZWNvcmQKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgQWRtaW5EYXRhLmNyZWF0ZUNvbGxlY3Rpb25JZGVudGlmaWVycwogICAgICovCiAgICBmdW5jdGlvbiBjcmVhdGVDb2xsZWN0aW9uSWRlbnRpZmllcnMoIGFkbWluSW5mbyApIHsKCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmcgQWRtaW5EYXRhLmNyZWF0ZUNvbGxlY3Rpb25JZGVudGlmaWVycyBmdW5jdGlvbiIgKTsKICAgICAgICB2YXIgc3VibWl0dGVyID0gYWRtaW5JbmZvLnN1Ym1pdHRlcjsKICAgICAgICB2YXIgZm9ybWF0ID0gYWRtaW5JbmZvLmZvcm1hdDsKCiAgICAgICAgdmFyIGNvbGxlY3Rpb25JZGVudGlmaWVycyA9IFtdOwogICAgICAgIGNvbGxlY3Rpb25JZGVudGlmaWVycy5wdXNoKCBzdWJtaXR0ZXIgKyAiLSIgKyBmb3JtYXQgKTsKCiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBBZG1pbkRhdGFNYXJjLmNyZWF0ZUNvbGxlY3Rpb25JZGVudGlmaWVycyBmdW5jdGlvbiIgKTsKCiAgICAgICAgcmV0dXJuIGNvbGxlY3Rpb25JZGVudGlmaWVyczsKCiAgICB9CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IGZpbmRzIHRoZSBsaWJyYXJ5IHR5cGUgb2YgYSByZWNvcmQgYmFzZWQgb24gc3VibWl0dGVyLgogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggQWRtaW5EYXRhLmdldExpYnJhcnlUeXBlKCBzdWJtaXR0ZXIgKQogICAgICogQHBhcmFtIHtPYmplY3R9IGFkbWluSW5mbyBhZG1pbmlzdHJhdGl2ZSBpbmZvcm1hdGlvbjogZS5nLiBzdWJtaXR0ZXIsIGZvcm1hdCwgcmF3IChmb3IgcmF3IHJlcG8gcmVjb3JkKSwgYW5kIGxpYnJhcnkgcnVsZXMgZnJvbSB2aXAKICAgICAqIEByZXR1cm4ge1N0cmluZ30gdGhlIGxpYnJhcnkgdHlwZQogICAgICogQGV4YW1wbGUKICAgICAqIEFkbWluRGF0YS5nZXRMaWJyYXJ5VHlwZSggeyBzdWJtaXR0ZXI6ICI3MTAxMDAiLCBmb3JtYXQ6ICJrYXRhbG9nIiApCiAgICAgKiByZXR1cm5zICJwdWJsaWMiIC8vb2xkIGZ1bmN0aW9uCiAgICAgKiBBZG1pbkRhdGEuZ2V0TGlicmFyeVR5cGUgKCB7IHN1Ym1pdHRlcjogIjcxMDEwMCIsIGZvcm1hdDogImthdGFsb2ciLCByYXc6IHRydWUsIGFnZW5jeVR5cGU6ICJGb2xrZWJpYmxpb3RlayIgfSApCiAgICAgKiByZXR1cm5zICJwdWJsaWMiIC8vbmV3IGZ1bmN0aW9uIHdpdGggT3BlbkFnZW5jeSBydWxlcyBpbiByZWNvcmRzIGZyb20gcmF3IHJlcG8KICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgQWRtaW5EYXRhLmdldExpYnJhcnlUeXBlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldExpYnJhcnlUeXBlKCBhZG1pbkluZm8gKSB7CgogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIEFkbWluRGF0YS5nZXRMaWJyYXJ5VHlwZSBmdW5jdGlvbiIgKTsKCiAgICAgICAgdmFyIHN1Ym1pdHRlciA9IGFkbWluSW5mby5zdWJtaXR0ZXI7CiAgICAgICAgdmFyIGxpYnJhcnlUeXBlID0gIm5vbmUiOwoKICAgICAgICBpZiAoIHRydWUgPT09IGFkbWluSW5mby5yYXcgJiYgdW5kZWZpbmVkICE9PSBhZG1pbkluZm8uYWdlbmN5VHlwZSApIHsKICAgICAgICAgICAgc3dpdGNoICggYWRtaW5JbmZvLmFnZW5jeVR5cGUgKSB7CiAgICAgICAgICAgICAgICBjYXNlICJGb2xrZWJpYmxpb3RlayI6CiAgICAgICAgICAgICAgICAgICAgbGlicmFyeVR5cGUgPSAicHVibGljIjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgIkZvcnNrbmluZ3NiaWJsaW90ZWsiOgogICAgICAgICAgICAgICAgICAgIGxpYnJhcnlUeXBlID0gInJlc2VhcmNoIjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgIlNrb2xlYmlibGlvdGVrIjoKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5VHlwZSA9ICJzY2hvb2wiOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgeyAvL1RPRE8gcmVtb3ZlIHRoaXMgd2hlbiB3ZSd2ZSBhZGRlZCBjYWxsIHRvIE9wZW5BZ2VuY3kgdG8gZ2V0IHZpcCBydWxlcyBmb3Igbm9uIHJhdyByZXBvIHJlY29yZHMgaW4gIzk5NyBpbiBkYXRhaW8KCiAgICAgICAgICAgIGlmICggQWRtaW5EYXRhLmNoZWNrVHlwZU9mU3VibWl0dGVyKCBzdWJtaXR0ZXIsICJzY2hvb2xMaWJyYXJ5IiApICkgewogICAgICAgICAgICAgICAgbGlicmFyeVR5cGUgPSAic2Nob29sIjsKICAgICAgICAgICAgfSBlbHNlIGlmICggQWRtaW5EYXRhLmNoZWNrVHlwZU9mU3VibWl0dGVyKCBzdWJtaXR0ZXIsICJwdWJsaWNMaWJyYXJ5IiApICkgewogICAgICAgICAgICAgICAgbGlicmFyeVR5cGUgPSAicHVibGljIjsKICAgICAgICAgICAgfSBlbHNlIGlmICggc3VibWl0dGVyLm1hdGNoKCAvXjhcZHxeMTJcZC8gKSAmJiAhc3VibWl0dGVyLm1hdGNoKCAvXjg3MDk3LyApICkgewogICAgICAgICAgICAgICAgLy9ubyBsb25nZXIgY2hlY2tpbmcgZm9yIG5vbi1yZXNlYXJjaCBsaWJyYXJpZXMgdGhhdCBsb29rIGxpa2UgcmVzZWFyY2ggbGlicmFyeSBzdWJtaXR0ZXJzIGJlY2F1c2UgdGhleSBhbGwgY29tZSB0aHJvdWdoIGRhdGFpbwogICAgICAgICAgICAgICAgbGlicmFyeVR5cGUgPSAicmVzZWFyY2giOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIEFkbWluRGF0YS5nZXRMaWJyYXJ5VHlwZSBmdW5jdGlvbiIgKTsKICAgICAgICByZXR1cm4gbGlicmFyeVR5cGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IGNoZWNrcyB3aGV0aGVyIGEgc3VibWl0dGVyIGhhcyBhIHNwZWNpYWwgdHlwZSwgZm9yIGluc3RhbmNlIGRhdGFXZWxsQ3VzdG9tZXIgb3Igbm9uRmljdGlvblN1Ym1pdHRlci4KICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IEFkbWluRGF0YS5jaGVja1R5cGVPZlN1Ym1pdHRlciggc3VibWl0dGVyLCB0eXBlICkKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdWJtaXR0ZXIgVGhlIHN1Ym1pdHRlciBvZiBkYXRhCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUaGUgdHlwZSBvZiB0aGUgc3VibWl0dGVyIHRvIGNoZWNrIGZvcgogICAgICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZSBvciBmYWxzZQogICAgICogQGV4YW1wbGUgQWRtaW5EYXRhLmNoZWNrVHlwZU9mU3VibWl0dGVyKCAiODMwMDYwIiwgImRhdGFXZWxsQ3VzdG9tZXIiICkKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgQWRtaW5EYXRhLmNoZWNrVHlwZU9mU3VibWl0dGVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNoZWNrVHlwZU9mU3VibWl0dGVyKCBzdWJtaXR0ZXIsIHR5cGUgKSB7CgogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIEFkbWluRGF0YS5jaGVja1R5cGVPZlN1Ym1pdHRlciBmdW5jdGlvbiIgKTsKCiAgICAgICAgdmFyIHR5cGVPZlN1Ym1pdHRlcjsKICAgICAgICAvLyBUaGUgYXJyYXkgYmVsb3cgbXVzdCBvbmx5IGNvbnRhaW4gUEggTGlicmFyaWVzCiAgICAgICAgdmFyIGRhdGFXZWxsQ3VzdG9tZXJzID0gWyAiODMwMDYwIiwgIjgzMDE5MCIsICI4MzAzNzAiLCAiODMwMzgwIiwgIjgzMDY5MCIsICI4MzEwMjAiLCAiODYwOTAwIiBdOwogICAgICAgIHZhciBub25GaWN0aW9uU3VibWl0dGVycyA9IFsgIjE1MDAwNSIsICIxNTAwMTIiLCAiMTUwMDE4IiwgIjE1MDAyMyIsICIxNTAwMjQiLCAiMTUwMDI5IiwgIjE1MDAzMSIsICIxNTAwMzMiLCAiMTUwMDQyIiwgIjE1MDA0MyIsICIxNTAwNDYiLCAiMTUwMDQ5IiwgIjE1MDA1MiIsICIxNTAwNTgiLCAiMTUwMDYwIiwgIjE1MDA2NSIsICIxNTAwNjgiIF07CgogICAgICAgIHZhciBwdWJsaWNMaWJyYXJ5ID0gL143WzAtOV17NX0kLzsKICAgICAgICB2YXIgc2Nob29sTGlicmFyeSA9IC9eWzM2XVswLTldezV9JHxeMjhbMC05XXs0fSQvOwoKICAgICAgICB2YXIgY2hlY2tBcnJheSA9IFtdOwogICAgICAgIHZhciBjaGVja1JlZ0V4OwoKICAgICAgICBzd2l0Y2ggKCB0eXBlICkgewogICAgICAgICAgICBjYXNlICJkYXRhV2VsbEN1c3RvbWVyIjoKICAgICAgICAgICAgICAgIGNoZWNrQXJyYXkgPSBkYXRhV2VsbEN1c3RvbWVyczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJub25GaWN0aW9uU3VibWl0dGVyIjoKICAgICAgICAgICAgICAgIGNoZWNrQXJyYXkgPSBub25GaWN0aW9uU3VibWl0dGVyczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJwdWJsaWNMaWJyYXJ5IjoKICAgICAgICAgICAgICAgIGNoZWNrUmVnRXggPSBwdWJsaWNMaWJyYXJ5OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgInNjaG9vbExpYnJhcnkiOgogICAgICAgICAgICAgICAgY2hlY2tSZWdFeCA9IHNjaG9vbExpYnJhcnk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIExvZy53YXJuKCAiVGhlIHN1Ym1pdHRlciB0eXBlICIgKyB0eXBlICsgIiBpcyB1bmtub3duLiIgKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgaWYgKCBjaGVja1JlZ0V4ICE9PSB1bmRlZmluZWQgJiYgc3VibWl0dGVyLm1hdGNoKCBjaGVja1JlZ0V4ICkgKSB7CiAgICAgICAgICAgIHR5cGVPZlN1Ym1pdHRlciA9IHRydWU7CiAgICAgICAgfSBlbHNlIGlmICggY2hlY2tBcnJheS5pbmRleE9mKCBzdWJtaXR0ZXIgKSA+IC0xICkgewogICAgICAgICAgICB0eXBlT2ZTdWJtaXR0ZXIgPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHR5cGVPZlN1Ym1pdHRlciA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBBZG1pbkRhdGEuY2hlY2tUeXBlT2ZTdWJtaXR0ZXIgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiB0eXBlT2ZTdWJtaXR0ZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVja3MgaWYgcmVjb3JkIGlzIGNoaWxkcmVucyBtYXRlcmlhbC4KICAgICAqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgZGthYm0gcmVjb3JkIGNvbnRhaW5zICJiXHUwMGY4cm5lbWF0ZXJpYWxlciIgaW4gZGN0ZXJtczphdWRpZW5jZQogICAgICoKICAgICAqIEBzeW50YXggQWRtaW5EYXRhLmlzQ2hpbGRyZW5zTWF0ZXJpYWwoIGNvbnRhaW5lciApCiAgICAgKiBAcGFyYW0ge0RvY3VtZW50fSBjb250YWluZXIgYSB0aW5nIGNvbnRhaW5lciB3aXRoIHhtbCByZXByZXNlbnRpbmcgYSByZWNvcmQgaW4gZGthYm0KICAgICAqIEByZXR1cm5zIHtCb29sZWFufSB0cnVlIGlmIHJlY29yZCBpcyBjaGlsZHJlbnMgbWF0ZXJpYWwKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgQWRtaW5EYXRhLmlzQ2hpbGRyZW5zTWF0ZXJpYWwKICAgICAqLwogICAgZnVuY3Rpb24gaXNDaGlsZHJlbnNNYXRlcmlhbCggY29udGFpbmVyICkgewogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIEFkbWluRGF0YS5pc0NoaWxkcmVuc01hdGVyaWFsIiApOwoKICAgICAgICB2YXIgaXNDaGlsZHJlbnNNYXRlcmlhbCA9IGZhbHNlOwogICAgICAgIHZhciBhdWRpZW5jZU5vZGVzID0gWFBhdGguc2VsZWN0KCAidGluZzpjb250YWluZXIvZGthYm06cmVjb3JkL2RjdGVybXM6YXVkaWVuY2UiLCBjb250YWluZXIgKTsKCiAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgYXVkaWVuY2VOb2Rlcy5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgdmFyIHRleHQgPSBYbWxVdGlsLmdldFRleHQoIGF1ZGllbmNlTm9kZXNbIGkgXSApOwogICAgICAgICAgICBpZiAoICJiXHUwMGY4cm5lbWF0ZXJpYWxlciIgPT09IHRleHQgKSB7CiAgICAgICAgICAgICAgICBpc0NoaWxkcmVuc01hdGVyaWFsID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIEFkbWluRGF0YS5pc0NoaWxkcmVuc01hdGVyaWFsIiApOwogICAgICAgIHJldHVybiBpc0NoaWxkcmVuc01hdGVyaWFsOwogICAgfQoKICAgIC8qKgogICAgKiBGdW5jdGlvbiB0aGF0IGNyZWF0ZXMgYWRtaW5pc3RyYXRpdmUgZGF0YSB4bWwuCiAgICAqCiAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICogQHN5bnRheCBBZG1pbkRhdGEuY3JlYXRlQWRtaW5EYXRhWG1sKCBhZG1pbkluZm8sIGNvbnRhaW5lciApCiAgICAqIEBwYXJhbSB7T2JqZWN0fSBhZG1pbkluZm8gYWRtaW5pc3RyYXRpdmUgaW5mb3JtYXRpb246IGUuZy4gc3VibWl0dGVyLCBmb3JtYXQsIGxpYnJhcnlUeXBlLCBpc0RlbGV0ZVJlY29yZCwgb25saW5lQWNjZXNzIGFuZCBjcmVhdGlvbkRhdGUKICAgICogQHBhcmFtIHtEb2N1bWVudH0gY29udGFpbmVyIHRoZSBYbWwgdGluZyBjb250YWluZXIgZm9yIHRoZSBjb252ZXJ0ZWQgcmVjb3JkCiAgICAqIEByZXR1cm4ge0RvY3VtZW50fSB4bWwgZWxlbWVudHMgd2l0aCBhZG1pbmlzdHJhdGl2ZSBkYXRhIGdhdGhlcmVkIGluIHRoZSBBZG1pbkRhdGFYbWwgZWxlbWVudAogICAgKiBAZnVuY3Rpb24KICAgICogQG5hbWUgQWRtaW5EYXRhLmNyZWF0ZUFkbWluRGF0YVhtbAogICAgKi8KICAgZnVuY3Rpb24gY3JlYXRlQWRtaW5EYXRhWG1sKCBhZG1pbkluZm8sIGNvbnRhaW5lciApIHsKCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmcgQWRtaW5EYXRhLmNyZWF0ZUFkbWluRGF0YVhtbCIgKTsKCiAgICAgICAgdmFyIGFkbWluRGF0YVhtbCA9IFhtbFV0aWwuY3JlYXRlRG9jdW1lbnQoICJhZG1pbkRhdGEiICk7CgogICAgICAgIC8vYWRkaW5nIHJlY29yZFN0YXR1cwogICAgICAgIHZhciByZWNvcmRTdGF0dXMgPSAiYWN0aXZlIjsKICAgICAgICBpZiAoIGFkbWluSW5mby5pc0RlbGV0ZVJlY29yZCA9PT0gdHJ1ZSApIHsKICAgICAgICAgICAgcmVjb3JkU3RhdHVzID0gImRlbGV0ZSI7CiAgICAgICAgfQogICAgICAgIHZhciByZWNvcmRTdGF0dXNYbWwgPSBYbWxVdGlsLmNyZWF0ZUVsZW1lbnQoIGFkbWluRGF0YVhtbCwgInJlY29yZFN0YXR1cyIsIG51bGwsIHJlY29yZFN0YXR1cyApOwogICAgICAgIFhtbFV0aWwuYXBwZW5kQ2hpbGQoIGFkbWluRGF0YVhtbCwgcmVjb3JkU3RhdHVzWG1sICk7CiAgICAgICAgLy9hZGRpbmcgY3JlYXRpb25EYXRlCiAgICAgICAgaWYgKCBhZG1pbkluZm8uY3JlYXRpb25EYXRlICE9PSAiIiApIHsKICAgICAgICAgICAgdmFyIGNyZWF0aW9uRGF0ZVhtbCA9IFhtbFV0aWwuY3JlYXRlRWxlbWVudCggYWRtaW5EYXRhWG1sLCAiY3JlYXRpb25EYXRlIiwgbnVsbCwgYWRtaW5JbmZvLmNyZWF0aW9uRGF0ZSApOwogICAgICAgICAgICBYbWxVdGlsLmFwcGVuZENoaWxkKCBhZG1pbkRhdGFYbWwsIGNyZWF0aW9uRGF0ZVhtbCApOwogICAgICAgIH0KICAgICAgICAvL2FkZGluZyBkYXRhV2VsbEN1c3RvbWVyCiAgICAgICAgaWYgKCBhZG1pbkluZm8uZGF0YVdlbGxDdXN0b21lciA9PT0gdHJ1ZSApIHsKICAgICAgICAgICAgdmFyIGRhdGFXZWxsQ3VzdG9tZXJYbWwgPSBYbWxVdGlsLmNyZWF0ZUVsZW1lbnQoIGFkbWluRGF0YVhtbCwgImRhdGFXZWxsQ3VzdG9tZXIiLCBudWxsLCAidHJ1ZSIgKTsKICAgICAgICAgICAgWG1sVXRpbC5hcHBlbmRDaGlsZCggYWRtaW5EYXRhWG1sLCBkYXRhV2VsbEN1c3RvbWVyWG1sICk7CiAgICAgICAgfQogICAgICAgIC8vYWRkaW5nIGxpYnJhcnlUeXBlCiAgICAgICAgdmFyIGxpYnJhcnlUeXBlWG1sID0gWG1sVXRpbC5jcmVhdGVFbGVtZW50KCBhZG1pbkRhdGFYbWwsICJsaWJyYXJ5VHlwZSIsIG51bGwsIGFkbWluSW5mby5saWJyYXJ5VHlwZSApOwogICAgICAgIFhtbFV0aWwuYXBwZW5kQ2hpbGQoIGFkbWluRGF0YVhtbCwgbGlicmFyeVR5cGVYbWwgKTsKICAgICAgICAvL2FkZGluZyBnZW5yZQogICAgICAgIHZhciBnZW5yZSA9ICIiOwogICAgICAgIGlmICggQWRtaW5EYXRhLmNoZWNrVHlwZU9mU3VibWl0dGVyKCBhZG1pbkluZm8uc3VibWl0dGVyLCAibm9uRmljdGlvblN1Ym1pdHRlciIgKSA9PT0gdHJ1ZSApIHsKICAgICAgICAgICAgZ2VucmUgPSAibm9uZmlrdGlvbiI7CiAgICAgICAgfSBlbHNlIGlmICggInVuZGVmaW5lZCIgIT09IHR5cGVvZiBhZG1pbkluZm8uZ2VucmUgICkgewogICAgICAgICAgICBnZW5yZSA9IGFkbWluSW5mby5nZW5yZTsKICAgICAgICB9CiAgICAgICAgaWYgKCBnZW5yZSAhPT0gIiIgKSB7CiAgICAgICAgICAgIFhtbFV0aWwuYXBwZW5kQ2hpbGRFbGVtZW50KCBhZG1pbkRhdGFYbWwuZG9jdW1lbnRFbGVtZW50LCAiZ2VucmUiLCBudWxsLCBnZW5yZSApOwogICAgICAgIH0KICAgICAgICAvL2FkZGluZyBpbmRleGluZ0FsaWFzCiAgICAgICAgdmFyIGluZGV4aW5nQWxpYXNYbWwgPSBBZG1pbkRhdGEuY3JlYXRlSW5kZXhpbmdBbGlhc1htbCggYWRtaW5JbmZvLmluZGV4aW5nQWxpYXMgKTsKICAgICAgICBYbWxVdGlsLmFwcGVuZENoaWxkKCBhZG1pbkRhdGFYbWwsIGluZGV4aW5nQWxpYXNYbWwgKTsKICAgICAgICAvL2FkZGluZyBhY2Nlc3NUeXBlcwogICAgICAgIHZhciBhY2Nlc3NUeXBlcyA9IFtdOwogICAgICAgIGlmICggInVuZGVmaW5lZCIgIT09IHR5cGVvZiBhZG1pbkluZm8uYWNjZXNzVHlwZSApIHsKICAgICAgICAgICAgYWNjZXNzVHlwZXMgPSBhZG1pbkluZm8uYWNjZXNzVHlwZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhY2Nlc3NUeXBlcyA9IEFkbWluRGF0YS5nZXRBY2Nlc3NUeXBlKCBhZG1pbkluZm8uc3VibWl0dGVyLCBhZG1pbkluZm8ub25saW5lQWNjZXNzICk7CiAgICAgICAgfQogICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IGFjY2Vzc1R5cGVzLmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICAgICAgWG1sVXRpbC5hcHBlbmRDaGlsZEVsZW1lbnQoIGFkbWluRGF0YVhtbC5kb2N1bWVudEVsZW1lbnQsICJhY2Nlc3NUeXBlIiwgbnVsbCwgYWNjZXNzVHlwZXNbIGkgXSApOwogICAgICAgIH0KICAgICAgICAvL2FkZGluZyB3b3JrVHlwZXMKICAgICAgICB2YXIgd29ya1R5cGVzID0gQWRtaW5EYXRhLmNyZWF0ZVdvcmtUeXBlKCBjb250YWluZXIgKTsKICAgICAgICBmb3IgKCB2YXIgYSA9IDA7IGEgPCB3b3JrVHlwZXMubGVuZ3RoOyBhKysgKSB7CiAgICAgICAgICAgICAgICBYbWxVdGlsLmFwcGVuZENoaWxkRWxlbWVudCggYWRtaW5EYXRhWG1sLmRvY3VtZW50RWxlbWVudCwgIndvcmtUeXBlIiwgbnVsbCwgd29ya1R5cGVzWyBhIF0gKTsKICAgICAgICB9CiAgICAgICAgLy9hZGRpbmcgY29sbGVjdGlvbklkZW50aWZpZXJzCiAgICAgICAgLy9UT0RPIGJldGluZ2Vsc2Vza2xhbWFuc2VuIG5lZGVuZm9yIGthbiBzbGV0dGVzLCBodmlzIGh2ZXIga2lsZGUgaGVudGVyIGNvbGxlY3Rpb25JZGVudGlmaWVycyB2ZWQgb3ByZXR0ZWxzZSBhZiBkZXJlcyBhZG1pbkluZm8tb2JqZWt0CiAgICAgICAgaWYgKCAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGFkbWluSW5mby5jb2xsZWN0aW9uSWRlbnRpZmllcnMgKSB7IC8vYWRkaW5nIGNvbGxlY3Rpb25JZGVudGlmaWVycyBmb3Igbm9uLW1hcmMgcmVjb3JkIGkuZS4gb3RoZXIgc291cmNlcwogICAgICAgICAgICBMb2cuZGVidWcoICJBZG1pbkRhdGEuY3JlYXRlQWRtaW5EYXRhWG1sOiBjb2xsZWN0aW9uSWRlbnRpZmllcnMgd2FzIHVuZGVmaW5lZC4gQ2FsbGluZyBjcmVhdGVDb2xsZWN0aW9uSWRlbnRpZmllcnMiICk7CiAgICAgICAgICAgIGFkbWluSW5mby5jb2xsZWN0aW9uSWRlbnRpZmllcnMgPSBBZG1pbkRhdGEuY3JlYXRlQ29sbGVjdGlvbklkZW50aWZpZXJzKCBhZG1pbkluZm8gKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBMb2cuZGVidWcoICJBZG1pbkRhdGEuY3JlYXRlQWRtaW5EYXRhWG1sOiBjb2xsZWN0aW9uSWRlbnRpZmllcnMgZ2l2ZW4gYXMgcGFyYW1ldGVyOiAiLCBKU09OLnN0cmluZ2lmeSggYWRtaW5JbmZvLmNvbGxlY3Rpb25JZGVudGlmaWVycyApKTsKICAgICAgICB9CiAgICAgICAgZm9yICggdmFyIGIgPSAwOyBiIDwgYWRtaW5JbmZvLmNvbGxlY3Rpb25JZGVudGlmaWVycy5sZW5ndGg7IGIrKyApIHsKICAgICAgICAgICAgICAgIFhtbFV0aWwuYXBwZW5kQ2hpbGRFbGVtZW50KCBhZG1pbkRhdGFYbWwuZG9jdW1lbnRFbGVtZW50LCAiY29sbGVjdGlvbklkZW50aWZpZXIiLCBudWxsLCBhZG1pbkluZm8uY29sbGVjdGlvbklkZW50aWZpZXJzWyBiIF0gKTsKICAgICAgICB9CiAgICAgICAgLy9hZGRpbmcgcmV2aWV3ZWQgd29yayBkYXRhIGlmIHJlbGV2YW50IElPICM5NTUKICAgICAgICBpZiAoICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgYWRtaW5JbmZvLnJldmlld2VkQ3JlYXRvciApIHsKICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgYWRtaW5JbmZvLnJldmlld2VkQ3JlYXRvci5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgICAgIFhtbFV0aWwuYXBwZW5kQ2hpbGRFbGVtZW50KCBhZG1pbkRhdGFYbWwuZG9jdW1lbnRFbGVtZW50LCAicmV2aWV3ZWRDcmVhdG9yIiwgbnVsbCwgYWRtaW5JbmZvLnJldmlld2VkQ3JlYXRvclsgaSBdICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGFkbWluSW5mby5yZXZpZXdlZFRpdGxlICYmICIiICE9PSBhZG1pbkluZm8ucmV2aWV3ZWRUaXRsZSApIHsKICAgICAgICAgICAgWG1sVXRpbC5hcHBlbmRDaGlsZEVsZW1lbnQoIGFkbWluRGF0YVhtbC5kb2N1bWVudEVsZW1lbnQsICJyZXZpZXdlZFRpdGxlIiwgbnVsbCwgYWRtaW5JbmZvLnJldmlld2VkVGl0bGUgKTsKICAgICAgICB9CiAgICAgICAgaWYgKCAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGFkbWluSW5mby5yZXZpZXdlZFB1Ymxpc2hlciApIHsKICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgYWRtaW5JbmZvLnJldmlld2VkUHVibGlzaGVyLmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICAgICAgWG1sVXRpbC5hcHBlbmRDaGlsZEVsZW1lbnQoIGFkbWluRGF0YVhtbC5kb2N1bWVudEVsZW1lbnQsICJyZXZpZXdlZFB1Ymxpc2hlciIsIG51bGwsIGFkbWluSW5mby5yZXZpZXdlZFB1Ymxpc2hlclsgaSBdICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGFkbWluSW5mby5yZXZpZXdlZFR5cGUgKSB7CiAgICAgICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IGFkbWluSW5mby5yZXZpZXdlZFR5cGUubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgICAgICAgICBYbWxVdGlsLmFwcGVuZENoaWxkRWxlbWVudCggYWRtaW5EYXRhWG1sLmRvY3VtZW50RWxlbWVudCwgInJldmlld2VkVHlwZSIsIG51bGwsIGFkbWluSW5mby5yZXZpZXdlZFR5cGVbIGkgXSApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICggInVuZGVmaW5lZCIgIT09IHR5cGVvZiBhZG1pbkluZm8ucmV2aWV3ZWRXb3JrVHlwZSApIHsKICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgYWRtaW5JbmZvLnJldmlld2VkV29ya1R5cGUubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgICAgICAgICBYbWxVdGlsLmFwcGVuZENoaWxkRWxlbWVudCggYWRtaW5EYXRhWG1sLmRvY3VtZW50RWxlbWVudCwgInJldmlld2VkV29ya1R5cGUiLCBudWxsLCBhZG1pbkluZm8ucmV2aWV3ZWRXb3JrVHlwZVsgaSBdICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmcgQWRtaW5EYXRhLmNyZWF0ZUFkbWluRGF0YVhtbCIgKTsKCiAgICAgICAgICAgIHJldHVybiBhZG1pbkRhdGFYbWw7CiAgICAgICAgfQoKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgY3JlYXRlcyB0aGUgeG1sIGVsZW1lbnQgd2l0aCBpbmRleGluZ0FsaWFzIGZvciB0aGUgcmVjb3JkIGJhc2VkIG9uIHN1Ym1pdHRlciBhbmQgZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggQWRtaW5EYXRhLmNyZWF0ZUluZGV4aW5nQWxpYXNYbWwoIGluZGV4aW5nQWxpYXMgKQogICAgICogQHBhcmFtIHtTdHJpbmd9IGluZGV4aW5nQWxpYXMKICAgICAqIEByZXR1cm4ge05vZGV9IGluZGV4aW5nQWxpYXNYbWwKICAgICAqIEBleGFtcGxlIEFkbWluRGF0YS5jcmVhdGVJbmRleGluZ0FsaWFzWG1sKCB7ICJmb3JtYXQiOiAiYmFzaXMiLCAic3VibWl0dGVyIjogIjg3MDk3MCIgfSApCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIEFkbWluRGF0YS5jcmVhdGVJbmRleGluZ0FsaWFzWG1sCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNyZWF0ZUluZGV4aW5nQWxpYXNYbWwoIGluZGV4aW5nQWxpYXMgKSB7CgogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIEFkbWluRGF0YS5jcmVhdGVJbmRleGluZ0FsaWFzWG1sIiApOwoKICAgICAgICB2YXIgaW5kZXhpbmdBbGlhc1htbCA9IFhtbFV0aWwuY3JlYXRlRG9jdW1lbnQoICJpbmRleGluZ0FsaWFzIiApOwoKICAgICAgICBpZiAoIHVuZGVmaW5lZCA9PT0gaW5kZXhpbmdBbGlhcyB8fCAiIiA9PT0gaW5kZXhpbmdBbGlhcyApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgICAgICAgICAgIkFkbWluRGF0YS5jcmVhdGVJbmRleGluZ0FsaWFzWG1sOiBubyBpbmRleGluZ0FsaWFzIGRlZmluZWQiCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIFhtbFV0aWwuYXBwZW5kVGV4dCggaW5kZXhpbmdBbGlhc1htbCwgaW5kZXhpbmdBbGlhcyApOwoKICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIEFkbWluRGF0YS5jcmVhdGVJbmRleGluZ0FsaWFzWG1sIiApOwoKICAgICAgICByZXR1cm4gaW5kZXhpbmdBbGlhc1htbDsKCiAgICB9CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IGRldGVybWluZXMgYWNjZXNzVHlwZSBmb3IgdGhlIHJlY29yZC4KICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IEFkbWluRGF0YS5nZXRBY2Nlc3NUeXBlKCBzdWJtaXR0ZXIsIG9ubGluZUFjY2VzcywgW3JlY29yZF0gKQogICAgICogQHBhcmFtIHtTdHJpbmd9IHN1Ym1pdHRlciBUaGUgc3VibWl0dGVyIG9mIGRhdGEKICAgICAqIC8vVE9ETyBjaGFuZ2Ugb25saW5lQWNjZXNzIHRvIGJvb2xlYW4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBvbmxpbmVBY2Nlc3MgU3RhdHVzIG9mIG9ubGluZSBhY2Nlc3Mgc2hvdWxkIGJlICJub3QgYXZhaWxhYmxlIiBpZiB1cmwgZG9lcyBub3Qgd29yaywgb3RoZXJ3aXNlIGVtcHR5IHN0cmluZwogICAgICogQHJldHVybiB7U3RyaW5nW119IGFjY2Vzc1R5cGVzIGZvciB0aGUgcmVjb3JkIC0gd2l0aCAibm9uZSIgYXMgdGhlIG9ubHkgZWxlbWVudCBpZiBubyBhY2Nlc3MgdHlwZSBleGlzdHMKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgQWRtaW5EYXRhLmdldEFjY2Vzc1R5cGUKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0QWNjZXNzVHlwZSggc3VibWl0dGVyLCBvbmxpbmVBY2Nlc3MgKSB7CgogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIEFkbWluRGF0YS5nZXRBY2Nlc3NUeXBlIiApOwoKICAgICAgICB2YXIgYWNjZXNzVHlwZXMgPSBbXTsKICAgICAgICAvL1RPRE8gY2hhbmdlIG9ubGluZUFjY2VzcyB0byBib29sZWFuCiAgICAgICAgaWYgKCBzdWJtaXR0ZXIubWF0Y2goIC9eMTUwLyApICYmIG9ubGluZUFjY2VzcyAhPT0gIm5vdCBhdmFpbGFibGUiICkgewogICAgICAgICAgICBhY2Nlc3NUeXBlcy5wdXNoKCAib25saW5lIiApOwogICAgICAgIH0KICAgICAgICBpZiAoIDAgPT09IGFjY2Vzc1R5cGVzLmxlbmd0aCApIHsKICAgICAgICAgICAgYWNjZXNzVHlwZXMucHVzaCggIm5vbmUiICk7CiAgICAgICAgfQoKICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIEFkbWluRGF0YS5nZXRBY2Nlc3NUeXBlIiApOwoKICAgICAgICByZXR1cm4gYWNjZXNzVHlwZXM7CgogICAgfQoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIHRoZSB3b3JrIHR5cGUgb2YgdGhlIGRhdGEgKGxpdGVyYXR1cmUsIG11c2ljLCBtb3ZpZSBldGMuKSBiYXNlZCBvbiB0aGUgbWF0ZXJpYWwgdHlwZSAoREtBQk0pLgogICAgICoKICAgICAqCiAgICAgKiBAc3ludGF4IEFkbWluRGF0YS5jcmVhdGVXb3JrVHlwZSggZGthYm1YbWwgKQogICAgICogQHBhcmFtIHtEb2N1bWVudH0gY29udGFpbmVyIHRoZSBYbWwgdGluZyBjb250YWluZXIgZm9yIHRoZSBjb252ZXJ0ZWQgcmVjb3JkCiAgICAgKiBAcmV0dXJuIHtTdHJpbmdbXX0gQW4gYXJyYXkgb2Ygd29yayB0eXBlcwogICAgICogQG5hbWUgQWRtaW5EYXRhLmNyZWF0ZVdvcmtUeXBlCiAgICAgKiBAZnVuY3Rpb24KICAgICAqLwogICAgZnVuY3Rpb24gY3JlYXRlV29ya1R5cGUoIGNvbnRhaW5lciApIHsKCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmcgQWRtaW5EYXRhLmNyZWF0ZVdvcmtUeXBlIiApOwoKICAgICAgICB2YXIgd29ya1R5cGVzID0gewogICAgICAgICAgICAiQmlsbGVkYm9nIjogImxpdGVyYXR1cmUiLAogICAgICAgICAgICAiQm9nIjogImxpdGVyYXR1cmUiLAogICAgICAgICAgICAiQm9nIHN0b3Igc2tyaWZ0IjogImxpdGVyYXR1cmUiLAogICAgICAgICAgICAiRGlza2V0dGUiOiAibGl0ZXJhdHVyZSIsCiAgICAgICAgICAgICJEVEJvb2siOiAibGl0ZXJhdHVyZSIsCiAgICAgICAgICAgICJEdmQtcm9tIjogImxpdGVyYXR1cmUiLAogICAgICAgICAgICAiRWJvZyI6ICJsaXRlcmF0dXJlIiwKICAgICAgICAgICAgIkx5ZGJvZyAoYlx1MDBlNW5kKSI6ICJsaXRlcmF0dXJlIiwKICAgICAgICAgICAgIkx5ZGJvZyAoY2QpIjogImxpdGVyYXR1cmUiLAogICAgICAgICAgICAiTHlkYm9nIChuZXQpIjogImxpdGVyYXR1cmUiLAogICAgICAgICAgICAiTHlkYm9nIChjZC1tcDMpIjogImxpdGVyYXR1cmUiLAogICAgICAgICAgICAiTmV0ZG9rdW1lbnQiOiAibGl0ZXJhdHVyZSIsCiAgICAgICAgICAgICJQdW5rdHNrcmlmdCI6ICJsaXRlcmF0dXJlIiwKICAgICAgICAgICAgIlRlZ25lc2VyaWUiOiAibGl0ZXJhdHVyZSIsCiAgICAgICAgICAgICJUZWduZXNlcmllIChuZXQpIjogImxpdGVyYXR1cmUiLAogICAgICAgICAgICAiR3JhcGhpYyBub3ZlbCI6ICJsaXRlcmF0dXJlIiwKICAgICAgICAgICAgIlx1MDBDNXJib2ciOiAibGl0ZXJhdHVyZSIsCiAgICAgICAgICAgICJBdmlzIjogInBlcmlvZGljYSIsCiAgICAgICAgICAgICJBdmlzIChuZXQpIjogInBlcmlvZGljYSIsCiAgICAgICAgICAgICJUaWRzc2tyaWZ0IjogInBlcmlvZGljYSIsCiAgICAgICAgICAgICJUaWRzc2tyaWZ0IChuZXQpIjogInBlcmlvZGljYSIsCiAgICAgICAgICAgICJQZXJpb2Rpa3VtIjogInBlcmlvZGljYSIsCiAgICAgICAgICAgICJQZXJpb2Rpa3VtIChuZXQpIjogInBlcmlvZGljYSIsCiAgICAgICAgICAgICJCbHUtcmF5IjogIm1vdmllIiwKICAgICAgICAgICAgIkJsdS1yYXkgM0QiOiAibW92aWUiLAogICAgICAgICAgICAiQmx1LXJheSA0SyI6ICJtb3ZpZSIsCiAgICAgICAgICAgICJEdmQiOiAibW92aWUiLAogICAgICAgICAgICAiQmlvZ3JhZmZpbG0iOiAibW92aWUiLAogICAgICAgICAgICAiRmlsbSI6ICJtb3ZpZSIsCiAgICAgICAgICAgICJGaWxtIChuZXQpIjogIm1vdmllIiwKICAgICAgICAgICAgIlZpZGVvIjogIm1vdmllIiwKICAgICAgICAgICAgIkJcdTAwZTVuZCI6ICJtdXNpYyIsCiAgICAgICAgICAgICJDZCAobXVzaWspIjogIm11c2ljIiwKICAgICAgICAgICAgIkdyYW1tb2ZvbnBsYWRlIjogIm11c2ljIiwKICAgICAgICAgICAgIk1pbmkgZGlzYyI6ICJtdXNpYyIsCiAgICAgICAgICAgICJNdXNpayAobmV0KSI6ICJtdXNpYyIsCiAgICAgICAgICAgICJNdXNpa3RyYWNrIChuZXQpIjogInRyYWNrIiwKICAgICAgICAgICAgIkdhbWVCb3kiOiAiZ2FtZSIsCiAgICAgICAgICAgICJHYW1lQm95IEFkdmFuY2UiOiAiZ2FtZSIsCiAgICAgICAgICAgICJOaW50ZW5kbyBEUyI6ICJnYW1lIiwKICAgICAgICAgICAgIk5pbnRlbmRvIFN3aXRjaCI6ICJnYW1lIiwKICAgICAgICAgICAgIlBjLXNwaWwiOiAiZ2FtZSIsCiAgICAgICAgICAgICJQYy1zcGlsIChuZXQpIjogImdhbWUiLAogICAgICAgICAgICAiUGxheXN0YXRpb24iOiAiZ2FtZSIsCiAgICAgICAgICAgICJQU1AiOiAiZ2FtZSIsCiAgICAgICAgICAgICJXaWkiOiAiZ2FtZSIsCiAgICAgICAgICAgICJYYm94IjogImdhbWUiLAogICAgICAgICAgICAiQXJ0aWtlbCI6ICJhcnRpY2xlIiwKICAgICAgICAgICAgIkF2aXNhcnRpa2VsIjogImFydGljbGUiLAogICAgICAgICAgICAiVGlkc3NrcmlmdHNhcnRpa2VsIjogImFydGljbGUiLAogICAgICAgICAgICAiU3BcdTAwZjhyZ3NtXHUwMEU1bCBvZyBzdmFyIjogImFydGljbGUiLCAvL0JpYmxpb3Rla3N2YWd0ZW4KICAgICAgICAgICAgIk5vZGUiOiAic2hlZXRtdXNpYyIsCiAgICAgICAgICAgICJFLW5vZGUiOiAic2hlZXRtdXNpYyIsCiAgICAgICAgICAgICJLb3J0IjogIm1hcCIsCiAgICAgICAgICAgICJFLWtvcnQiOiAibWFwIiwKICAgICAgICAgICAgIkFubWVsZGVsc2UiOiAicmV2aWV3IiwKICAgICAgICAgICAgIk9tdGFsZSI6ICJib29rZGVzY3JpcHRpb24iCiAgICAgICAgfTsKCiAgICAgICAgdmFyIGNyZWF0ZWRXb3JrVHlwZXMgPSBbXTsKICAgICAgICB2YXIgc3ViamVjdHMgPSBYUGF0aC5zZWxlY3RNdWx0aXBsZVRleHQoICIvKi9ka2FibTpyZWNvcmQvZGM6c3ViamVjdCIsIGNvbnRhaW5lciApOwoKICAgICAgICAvLyBpbiBjYXNlIG9mIEZvcmZhdHRlcnBvcnRyYWV0CiAgICAgICAgaWYgKCBzdWJqZWN0cy50b1N0cmluZygpLm1hdGNoKCAvb3JmYXR0ZXJwb3J0ci8gKSApIHsKICAgICAgICAgICAgY3JlYXRlZFdvcmtUeXBlcy5wdXNoKCAicG9ydHJhaXQiICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIGJpYkRrVHlwZXMgPSBYUGF0aC5zZWxlY3QoICcvdGluZzpjb250YWluZXIvZGthYm06cmVjb3JkL2RjOnR5cGUnLCBjb250YWluZXIgKTsKICAgICAgICAgICAgZm9yICggdmFyIGogPSAwOyBqIDwgYmliRGtUeXBlcy5sZW5ndGg7IGorKyApIHsKICAgICAgICAgICAgICAgIGlmICggYmliRGtUeXBlc1sgaiBdLmdldEF0dHJpYnV0ZSggJ3hzaTp0eXBlJyApID09PSAiZGtkY3BsdXM6QmliREstVHlwZSIgKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBBZG1pbkRhdGEuY2xlYW5NYXRlcmlhbFR5cGUoIGJpYkRrVHlwZXNbIGogXS50ZXh0Q29udGVudCApOwogICAgICAgICAgICAgICAgICAgIGlmICggdHlwZSAhPT0gIlNhbW1lbnNhdCBtYXRlcmlhbGUiICYmIHdvcmtUeXBlc1sgdHlwZSBdICE9PSB1bmRlZmluZWQgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRXb3JrVHlwZXMucHVzaCggd29ya1R5cGVzWyB0eXBlIF0gKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCgogICAgICAgICAgICAvL2FkZGluZyB3b3JrVHlwZXMgYmFzZWQgb24gZGM6c3ViamVjdCBlbGVtZW50cwogICAgICAgICAgICBpZiAoIHN1YmplY3RzLnRvU3RyaW5nKCkubWF0Y2goIC9saXR0ZXJhdHVyYW5hbHlzZS8gKSApIHsKICAgICAgICAgICAgICAgIGNyZWF0ZWRXb3JrVHlwZXMucHVzaCggImFuYWx5c2lzIiApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vaWYgIm1vdmllIiBpcyBhIHdvcmtUeXBlLCB3ZSBjaGVjayBpZiB0aGlzIG1vdmllIGlzIGEgbXVzaWMgbW92aWUgZS5nLiBhbiBvcGVyYWZpbG0gb3IgYSBjb25jZXJ0LCBpZiBpdCBpcyB3ZSBhZGQgd29ya1R5cGU9Im11c2ljIiAoVVMxOTApCiAgICAgICAgaWYgKCAtMSAhPT0gY3JlYXRlZFdvcmtUeXBlcy5pbmRleE9mKCAibW92aWUiICkgJiYgQWRtaW5EYXRhLmlzTXVzaWNNb3ZpZSggY29udGFpbmVyICkgKSB7CiAgICAgICAgICAgIGNyZWF0ZWRXb3JrVHlwZXMucHVzaCggIm11c2ljIiApOwogICAgICAgIH0KCiAgICAgICAgLy9pbiBjYXNlIG5vIHdvcmt0eXBlIGhhcyBiZWVuIGZvdW5kIHlldCwgc2V0IGl0IHRvICJub25lIgogICAgICAgIGlmICggY3JlYXRlZFdvcmtUeXBlcy5sZW5ndGggPT09IDAgKSB7CiAgICAgICAgICAgIGNyZWF0ZWRXb3JrVHlwZXMucHVzaCggIm5vbmUiICk7CiAgICAgICAgfQoKICAgICAgICBjcmVhdGVkV29ya1R5cGVzID0gVXRpbC51bmlxdWVWYWx1ZXMoIGNyZWF0ZWRXb3JrVHlwZXMgKTsKCiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBBZG1pbkRhdGEuY3JlYXRlV29ya1R5cGUiICk7CgogICAgICAgIHJldHVybiBjcmVhdGVkV29ya1R5cGVzOwoKICAgIH0KCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgdHJhbnNmb3JtcyBzcGVjaWZpYyBtYXRlcmlhbHR5cGVzIGludG8gbW9yZSBnZW5lcmFsIG1hdGVyaWFsdHlwZXMKICAgICAqIHNvIHRoYXQgdGhlIG1hdGVyaWFsdHlwZSBjYW4gYmUgbG9va2VkIHVwIGluIGEgdGFibGUgdGhhdCBkb2VzIG5vdAogICAgICogbmVjZXNzYXJpbHkgaGF2ZSBhbGwgc3BlY2lmaWMgdHlwZXMgbGlzdGVkCiAgICAgKiBlLmcuIFBsYXlzdGF0aW9uIDMgYW5kIFBsYXlzdGF0aW9uIDQgYXJlIGJvdGggdHJhbnNmb3JtZWQgaW50bwogICAgICogIlBsYXlzdGF0aW9uIiBhcyBtYXRlcmlhbHR5cGUgdG8gbG9vayB1cAogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggQWRtaW5EYXRhLmNsZWFuTWF0ZXJpYWxUeXBlKCBtYXRlcmlhbFR5cGUgKQogICAgICogQHBhcmFtIHtTdHJpbmd9IG1hdGVyaWFsVHlwZSBUaGUgbWF0ZXJpYWx0eXBlIHRvIG1vZGlmeQogICAgICogQHJldHVybiB7U3RyaW5nfSB0aGUgbW9kaWZpZWQgbWF0ZXJpYWx0eXBlCiAgICAgKiBAZXhhbXBsZSBBZG1pbkRhdGEuY2xlYW5NYXRlcmlhbFR5cGUoICJQbGF5c3RhdGlvbiA0IiApCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIEFkbWluRGF0YS5jbGVhbk1hdGVyaWFsVHlwZQogICAgICovCiAgICBmdW5jdGlvbiBjbGVhbk1hdGVyaWFsVHlwZSggbWF0ZXJpYWxUeXBlICkgewoKICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZzogQWRtaW5EYXRhLmNsZWFuTWF0ZXJpYWxUeXBlIiApOwoKICAgICAgICBpZiAoIG1hdGVyaWFsVHlwZS5tYXRjaCggL3BsYXlzdGF0aW9uL2kgKSApIHsKICAgICAgICAgICAgbWF0ZXJpYWxUeXBlID0gIlBsYXlzdGF0aW9uIjsKICAgICAgICB9IGVsc2UgaWYgKCBtYXRlcmlhbFR5cGUubWF0Y2goIC94Ym94L2kgKSApIHsKICAgICAgICAgICAgbWF0ZXJpYWxUeXBlID0gIlhib3giOwogICAgICAgIH0gZWxzZSBpZiAoIG1hdGVyaWFsVHlwZS5tYXRjaCggL3dpaS9pICkgKSB7CiAgICAgICAgICAgIG1hdGVyaWFsVHlwZSA9ICJXaWkiOwogICAgICAgIH0KCiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZzogQWRtaW5EYXRhLmNsZWFuTWF0ZXJpYWxUeXBlIiApOwoKICAgICAgICByZXR1cm4gbWF0ZXJpYWxUeXBlOwogICAgfQoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjaGVja3MgaWYgYSBtb3ZpZSByZWNvcmQgaXMgYSBtdXNpYyBtb3ZpZQogICAgICoKICAgICAqIEB0eXBlIGZ1bmN0aW9uCiAgICAgKiBAc3ludGF4IEFkbWluRGF0YS5pc011c2ljTW92aWUKICAgICAqIEBwYXJhbSBjb250YWluZXIKICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUgaWYgbXVzaWMgbW92aWUKICAgICAqLwogICAgZnVuY3Rpb24gaXNNdXNpY01vdmllKCBjb250YWluZXIgKSB7CgogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIEFkbWluRGF0YS5pc011c2ljTW92aWUiICk7CgogICAgICAgIHZhciBzdWJUZXh0ID0gWFBhdGguc2VsZWN0VGV4dCggIi8qL21hcmN4OmNvbGxlY3Rpb24vbWFyY3g6cmVjb3JkL21hcmN4OmRhdGFmaWVsZFsgQHRhZyA9ICcwMDknIF0vbWFyY3g6c3ViZmllbGRbIEBjb2RlID0gJ2EnIF1bIDEgXSIsIGNvbnRhaW5lciApOwogICAgICAgIHN1YlRleHQgKz0gWFBhdGguc2VsZWN0VGV4dCggIi8qL21hcmN4OmNvbGxlY3Rpb24vbWFyY3g6cmVjb3JkL21hcmN4OmRhdGFmaWVsZFsgQHRhZyA9ICcwMDknIF0vbWFyY3g6c3ViZmllbGRbIEBjb2RlID0gJ2InIF1bIDEgXSIsIGNvbnRhaW5lciApOwoKICAgICAgICBpZiAoIHN1YlRleHQubWF0Y2goIC9zLyApICkgewogICAgICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIEFkbWluRGF0YS5pc011c2ljTW92aWUiICk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICAvL2lra2UgYWxsZSBwb3N0ZXIgbWVkIGRlIGRpc3NlIGdlbnJlciBoYXIgcyBpIDAwOSBhIGVsbGVyIGIuIE1BUiB2aWwgZ2VybmUgaGF2ZSwgYXQgbWVzdCBtdWxpZ3QgYmxpdmVyIHdvcmtUeXBlPW11c2lrLiBEZXJmb3IgZmFuZ2VyIHZpIGRlbSBoZXIvMjAxNi0wMi0wMSBTVFcKICAgICAgICB2YXIgZ2VucmVzID0gWFBhdGguc2VsZWN0KCAiLyovZGthYm06cmVjb3JkL2RjOnN1YmplY3RbIEB4c2k6dHlwZSA9ICdka2RjcGx1czpnZW5yZScgXSIsIGNvbnRhaW5lciApOwogICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IGdlbnJlcy5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgc3dpdGNoICggZ2VucmVzWyBpIF0udGV4dENvbnRlbnQgKSB7CiAgICAgICAgICAgICAgICBjYXNlICJwb3BmaWxtIjoKICAgICAgICAgICAgICAgIGNhc2UgImphenpmaWxtIjoKICAgICAgICAgICAgICAgIGNhc2UgIm11c2ljYWxmaWxtIjoKICAgICAgICAgICAgICAgIGNhc2UgInJvY2tmaWxtIjoKICAgICAgICAgICAgICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIEFkbWluRGF0YS5pc011c2ljTW92aWUiICk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgoKICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIEFkbWluRGF0YS5pc011c2ljTW92aWUiICk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogTWV0aG9kIHRoYXQgY3JlYXRlcyBhbiBBZGRpIHJlZmVyZW5jZSB4bWwgaW5zdGFuY2UuCiAgICAgKiBUaGUgcmVmRGF0YU9iamVjdCBjb250YWlucyBpbmZvcm1hdGlvbiBzcGVjaWZpYyBmb3IgdXNlIGluIHRoZSBJTyBzeXN0ZW0gYWJvdXQKICAgICAqIGVucmljaG1lbnRUcmFpbCBpZiB0aGUgcmVjb3JkIGlzIGEgInBhYWhhZW5nc3Bvc3QiCiAgICAgKiBlbmNvZGVBczI3MDkgdHJ1ZSBpZiByZWNvcmQgaXMgZ29pbmcgdG8gQkFTSVMgYW5kIG5lZWRzIHRvIGJlIGVuY29kZWQgYXMgMjcwOSBpbiB0aGUgRVMgc2luawogICAgICogdXBkYXRlVGVtcGxhdGUgdGhlIHRlbXBsYXRlIHRoYXQgc2hvdWxkIGJlIHVzZWQgaWYgdGhlIHJlY29yZCBpcyBnb2luZyB0byBiZSB2YWxpZGF0ZWQgYWdhaW5zdCB0aGUgT3BlblVwZGF0ZSBzZXJ2aWNlCiAgICAgKgogICAgICogQHR5cGUge21ldGhvZH0KICAgICAqIEBzeW50YXggQWRtaW5EYXRhLmNyZWF0ZVJlZmVyZW5jZURhdGFGb3JEYXRhd2VsbCggc3VibWl0dGVyLCBmb3JtYXQsIGxhbmd1YWdlLCByZWZEYXRhT2JqZWN0ICkKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdWJtaXR0ZXIgU3VibWl0dGVyIG51bWJlciBvZiB0aGUgc291cmNlCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZm9ybWF0IEZvcm1hdCBvZiB0aGUgc291cmNlCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbGFuZ3VhZ2UgbGFuZ3VhZ2Ugb2YgdGhlIHNvdXJjZQogICAgICogQHBhcmFtIHtPYmplY3R9IHJlZkRhdGFPYmplY3Qgb2JqZWN0IGNvbnRhaW5pbmcgcG9zc2libGUgZW5yaWNobWVudFRyYWlsLCBlbmNvZGVBczI3MDkgb3IgdXBkYXRlVGVtcGxhdGUKICAgICAqIEByZXR1cm4ge0RvY3VtZW50fSBBZGRpIHJlZmVyZW5jZSBYTUwgb2JqZWN0CiAgICAgKiBAZXhhbXBsZSBBZG1pbkRhdGEuY3JlYXRlUmVmZXJlbmNlRGF0YUZvckRhdGF3ZWxsKCAiODkwNzkxIiwgImFydGlrbGVyIiwgImRhbiIgKQogICAgICogQGV4YW1wbGUgQWRtaW5EYXRhLmNyZWF0ZVJlZmVyZW5jZURhdGFGb3JEYXRhd2VsbCggIjg5MDc5MCIsICJrYXRhbG9nIiwgImRhbiIsIHsgImVucmljaG1lbnRUcmFpbCI6ICI3NjE1MDAiIH0gKQogICAgICogQGV4YW1wbGUgQWRtaW5EYXRhLmNyZWF0ZVJlZmVyZW5jZURhdGFGb3JEYXRhd2VsbCggIjg5MDc5MCIsICJrYXRhbG9nIiwgImRhbiIsIHsgImVuY29kZUFzMjcwOSI6IHRydWUgfSApCiAgICAgKiBAZXhhbXBsZSBBZG1pbkRhdGEuY3JlYXRlUmVmZXJlbmNlRGF0YUZvckRhdGF3ZWxsKCAiODkwNzkwIiwgImthdGFsb2ciLCAiZGFuIiwgeyAidXBkYXRlVGVtcGxhdGUiOiAiZGJjIiB9ICkKICAgICAqIEBuYW1lIEFkbWluRGF0YS5jcmVhdGVSZWZlcmVuY2VEYXRhRm9yRGF0YXdlbGwKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgZnVuY3Rpb24gY3JlYXRlUmVmZXJlbmNlRGF0YUZvckRhdGF3ZWxsICggc3VibWl0dGVyLCBmb3JtYXQsIGxhbmd1YWdlLCByZWZEYXRhT2JqZWN0ICkgewoKICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZzogQWRtaW5EYXRhLmNyZWF0ZVJlZmVyZW5jZURhdGFGb3JEYXRhd2VsbCBmdW5jdGlvbiIgKTsKCiAgICAgICAgdmFyIHJlZmVyZW5jZWRhdGEgPSBYbWxVdGlsLmNyZWF0ZURvY3VtZW50KCAicmVmZXJlbmNlZGF0YSIsIFhtbE5hbWVzcGFjZXMuZXMgKTsKICAgICAgICB2YXIgaW5mbyA9IFhtbFV0aWwuYXBwZW5kQ2hpbGRFbGVtZW50KCByZWZlcmVuY2VkYXRhLCAiaW5mbyIsIFhtbE5hbWVzcGFjZXMuZXMgKTsKICAgICAgICBYbWxVdGlsLnNldEF0dHJpYnV0ZSggaW5mbywgJ3N1Ym1pdHRlcicsIHN1Ym1pdHRlciApOwogICAgICAgIGlmICggIm5ldGx5ZHVuZyIgPT09IGZvcm1hdCApIHsKICAgICAgICAgICBYbWxVdGlsLnNldEF0dHJpYnV0ZSggaW5mbywgJ2Zvcm1hdCcsICJuZXRseWRib2ciICk7CiAgICAgICAgfSBlbHNlIGlmICggImVib2d1bmciID09PSBmb3JtYXQgKXsKICAgICAgICAgICBYbWxVdGlsLnNldEF0dHJpYnV0ZSggaW5mbywgJ2Zvcm1hdCcsICJlYm9nIiApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICBYbWxVdGlsLnNldEF0dHJpYnV0ZSggaW5mbywgJ2Zvcm1hdCcsIGZvcm1hdCApOwogICAgICAgIH0KICAgICAgICBYbWxVdGlsLnNldEF0dHJpYnV0ZSggaW5mbywgJ2xhbmd1YWdlJywgbGFuZ3VhZ2UgKTsKICAgICAgICBpZiAoIHVuZGVmaW5lZCAhPT0gcmVmRGF0YU9iamVjdCAmJiB1bmRlZmluZWQgIT09IHJlZkRhdGFPYmplY3QuZW5yaWNobWVudFRyYWlsICkgewogICAgICAgICAgICBYbWxVdGlsLnNldEF0dHJpYnV0ZSggaW5mbywgJ2NvbnRlbnRGcm9tJywgcmVmRGF0YU9iamVjdC5lbnJpY2htZW50VHJhaWwpOwogICAgICAgIH0KICAgICAgICBpZiAoIHVuZGVmaW5lZCAhPT0gcmVmRGF0YU9iamVjdCAmJiB1bmRlZmluZWQgIT09IHJlZkRhdGFPYmplY3QuZW5jb2RlQXMyNzA5ICYmIHRydWUgPT09IHJlZkRhdGFPYmplY3QuZW5jb2RlQXMyNzA5ICkgewoKICAgICAgICAgICAgdmFyIGVuY29kZVhtbCA9IFhtbFV0aWwuZnJvbVN0cmluZygnPGRhdGFpbzpzaW5rLXByb2Nlc3NpbmcgeG1sbnM6ZGF0YWlvPSJkay5kYmMuZGF0YWlvLnByb2Nlc3NpbmciIGVuY29kZUFzMjcwOT0idHJ1ZSIgY2hhcnNldD0iZGFubWFyYzIiLz4nKTsKICAgICAgICAgICAgWG1sVXRpbC5hcHBlbmRDaGlsZCggcmVmZXJlbmNlZGF0YSwgZW5jb2RlWG1sICk7CiAgICAgICAgfQogICAgICAgIGlmICggdW5kZWZpbmVkICE9PSByZWZEYXRhT2JqZWN0ICYmIHVuZGVmaW5lZCAhPT0gcmVmRGF0YU9iamVjdC51cGRhdGVUZW1wbGF0ZSApIHsKCiAgICAgICAgICAgIHZhciBlbmNvZGVYbWwgPSBYbWxVdGlsLmZyb21TdHJpbmcoJzxkYXRhaW86c2luay11cGRhdGUtdGVtcGxhdGUgeG1sbnM6ZGF0YWlvPSJkay5kYmMuZGF0YWlvLnByb2Nlc3NpbmciIHVwZGF0ZVRlbXBsYXRlPSInICsgcmVmRGF0YU9iamVjdC51cGRhdGVUZW1wbGF0ZSArICciLz4nKTsKICAgICAgICAgICAgWG1sVXRpbC5hcHBlbmRDaGlsZCggcmVmZXJlbmNlZGF0YSwgZW5jb2RlWG1sICk7CiAgICAgICAgfQogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmc6IEFkbWluRGF0YS5jcmVhdGVSZWZlcmVuY2VEYXRhRm9yRGF0YXdlbGwgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiByZWZlcmVuY2VkYXRhOwoKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIGNyZWF0ZVRpbmdDb250YWluZXI6IGNyZWF0ZVRpbmdDb250YWluZXIsCiAgICAgICAgZ2V0TGlicmFyeVR5cGU6IGdldExpYnJhcnlUeXBlLAogICAgICAgIGNoZWNrVHlwZU9mU3VibWl0dGVyOiBjaGVja1R5cGVPZlN1Ym1pdHRlciwKICAgICAgICBjcmVhdGVDb2xsZWN0aW9uSWRlbnRpZmllcnM6IGNyZWF0ZUNvbGxlY3Rpb25JZGVudGlmaWVycywKICAgICAgICBpc0NoaWxkcmVuc01hdGVyaWFsOiBpc0NoaWxkcmVuc01hdGVyaWFsLAogICAgICAgIGNyZWF0ZUFkbWluRGF0YVhtbDogY3JlYXRlQWRtaW5EYXRhWG1sLAogICAgICAgIGNyZWF0ZUluZGV4aW5nQWxpYXNYbWw6IGNyZWF0ZUluZGV4aW5nQWxpYXNYbWwsCiAgICAgICAgZ2V0QWNjZXNzVHlwZTogZ2V0QWNjZXNzVHlwZSwKICAgICAgICBjcmVhdGVXb3JrVHlwZTogY3JlYXRlV29ya1R5cGUsCiAgICAgICAgY2xlYW5NYXRlcmlhbFR5cGU6IGNsZWFuTWF0ZXJpYWxUeXBlLAogICAgICAgIGlzTXVzaWNNb3ZpZTogaXNNdXNpY01vdmllLAogICAgICAgIGNyZWF0ZVJlZmVyZW5jZURhdGFGb3JEYXRhd2VsbDogY3JlYXRlUmVmZXJlbmNlRGF0YUZvckRhdGF3ZWxsCiAgICAgICAgfTsKCgogICAgfSgpOw==", "moduleName": "AdminData"}, {"javascript": "LyoqCiAqIEBmaWxlIEZpbGUgdGhhdCBwcm92aWRlcyBhIG1vZHVsZSB0byBoYW5kbGUgc29tZSBzbWFsbCBjb252ZXJzaW9uCiAqIGlzc3VlcyB3aXRoIFhNTCBzdHJpbmdzIGFuZCBvYmplY3RzIGFuZCBvdGhlciB1dGlsaXRpZXMuICovCgp1c2UoICJMb2ciICk7CnVzZSggIlhNTERPTSIgKTsKdXNlKCAiWFBhdGgiICk7CnVzZSggIlV0aWwiICk7CnVzZSggIk5vZGVUeXBlcyIgKTsKCkVYUE9SVEVEX1NZTUJPTFMgPSBbICJYbWxVdGlsIiBdOwovKioKICogVXRpbGl0eSBtZXRob2RzIGZvciBYTUwgaGFuZGxpbmcuCiAqIAogKiBWYXJpb3VzIHV0aWxpdHkgbWV0aG9kcyBmb3IgWE1MIGhhbmRsaW5nLiBTb21lIG1vc3RseSB0byBlbnN1cmUgc2FtZQogKiB0cmVhdG1lbnQgb2YgWE1MIGNvZGUgYWNyb3NzIHZhcmlvdXMgaW1wbGVtZW50YXRpb25zLiAKICogCiAqIEB0eXBlIHtuYW1lc3BhY2V9CiAqIEBuYW1lc3BhY2UgCiAqIEBuYW1lIFhtbFV0aWwKICovCnZhciBYbWxVdGlsID0gZnVuY3Rpb24oICkgewoKICAgIC8vIE9iamVjdCB0aGF0IGV2ZW50dWFsbHkgZ2V0cyBleHBvcnRlZAogICAgdmFyIHRoYXQgPSB7fTsKICAgIAogICAgLyoqCiAgICAgKiBJbnN0YW5jZSBvZiBET01JbXBsZW1lbnRhdGlvbgogICAgICogaHR0cDovL3d3dy53My5vcmcvVFIvRE9NLUxldmVsLTItQ29yZS9jb3JlLmh0bWwjSUQtMTAyMTYxNDkwCiAgICAgKiBAdHlwZSB7RE9NSW1wbGVtZW50YXRpb259CiAgICAgKi8KICAgIHRoYXQuZG9tSW1wbCA9IG5ldyBYTUxET00uRE9NSW1wbGVtZW50YXRpb24oKTsKCiAgICB0aGF0Ll9fZ2V0QWN0dWFsTm9kZSA9IGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgICAvLyBTdXBwb3J0IGJvdGggZG9jdW1lbnRzIGFuZCBub2RlcyBhcyBkZXN0aW5hdGlvbgogICAgICAgIGlmKFhtbFV0aWwuaXNEb2N1bWVudChub2RlKSl7CiAgICAgICAgICAgIGlmKG5vZGUuZG9jdW1lbnRFbGVtZW50ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBub2RlLmRvY3VtZW50RWxlbWVudDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgcmV0dXJuIG5vZGUuZ2V0RG9jdW1lbnRFbGVtZW50KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgICB9CiAgICB9OwogICAgdGhhdC5fX3Rocm93RXJyb3IgPSBmdW5jdGlvbihlcnJvcikgewogICAgICAgIExvZy5lcnJvcihlcnJvcik7CiAgICAgICAgdGhyb3cgRXJyb3IoZXJyb3IpOwogICAgfTsKCiAgICAvKioKICAgICAqIFBhcnNlciBmb3IgcGFyc2luZyB4bWwgc3RyaW5ncyBpbnRvIERPTSBEb2N1bWVudHMKICAgICAqIEB0eXBlIHtET01QYXJzZXJ9CiAgICAgKi8KICAgIHRoYXQucGFyc2VyID0gbmV3IFhNTERPTS5ET01QYXJzZXIoewogICAgICAgIGVycm9ySGFuZGxlcjogZnVuY3Rpb24gKGtleSwgbXNnKSB7CiAgICAgICAgICAgIHZhciBlcnJvciA9ICJFcnJvciBwYXJzaW5nIGRvY3VtZW50LCBrZXk6JyIgKyBrZXkgKyAiJywgbWVzc2FnZTonIiArIG1zZyArICInIjsKICAgICAgICAgICAgWG1sVXRpbC5fX3Rocm93RXJyb3IoZXJyb3IpOwogICAgICAgIH19CiAgICApOwogICAgCiAgICAvKioKICAgICAqIFBhcnNlcyBYTUwgaW4gYSBzdHJpbmcgaW50byBhIERPTSBkb2N1bWVudAogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhtbFV0aWwuZnJvbVN0cmluZwogICAgICogQHN5bnRheCBYbWxVdGlsLmZyb21TdHJpbmcoeG1sU3RyaW5nKQogICAgICogQHBhcmFtIHtzdHJpbmd9IHhtbFN0cmluZyBzdHJpbmcgdG8gYmUgcGFyc2VkIHRvIERPTQogICAgICogQHJldHVybiB7RG9jdW1lbnR9IFBhcnNlZCBYTUwgRG9jdW1lbnQKICAgICAqIEBleGFtcGxlCiAgICAgKiB2YXIgZG9jID0gWG1sVXRpbC5mcm9tU3RyaW5nKCI8cm9vdD48Y2hpbGQ+aGVsbG8gJmFtcDsgd29ybGQ8L2NoaWxkPjxjaGlsZD5mb28gJmFtcDsgYmFyPC9jaGlsZD48L3Jvb3Q+IikKICAgICAqLwogICAgdGhhdC5mcm9tU3RyaW5nID0gZnVuY3Rpb24oeG1sU3RyaW5nKXsKICAgICAgICBMb2cudHJhY2UoIkVudGVyaW5nIFhtbFV0aWwuZnJvbVN0cmluZywgJyIsIHhtbFN0cmluZywgIiciKTsKLy8gICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICggeG1sU3RyaW5nID09PSBudWxsIHx8IHhtbFN0cmluZyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBYbWxVdGlsLl9fdGhyb3dFcnJvcigiWG1sVXRpbC5mcm9tU3RyaW5nOiBkb2N1bWVudCBpcyByZXF1aXJlZCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggeG1sU3RyaW5nID09PSAnJykgewogICAgICAgICAgICAgICAgWG1sVXRpbC5fX3Rocm93RXJyb3IoIlhtbFV0aWwuZnJvbVN0cmluZzogZG9jdW1lbnQgaXMgZW1wdHkiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gWG1sVXRpbC5wYXJzZXIucGFyc2VGcm9tU3RyaW5nKHhtbFN0cmluZyk7Ci8vICAgICAgICB9IGZpbmFsbHkgewovLyAgICAgICAgICAgIExvZy50cmFjZSgiTGVhdmluZyBYbWxVdGlsLmZyb21TdHJpbmciKTsKLy8gICAgICAgIH0KICAgIH07CgoKICAgIC8qKgogICAgICogTWFrZSBvYmplY3QgdGhhdCB1c2VzIHRvWG1sU3RyaW5nIGFzIHRvU3RyaW5nLgogICAgICoKICAgICAqIFRoaXMgZnVuY3Rpb24gIndyYXBzIiB0aGUgeG1sIG9iamVjdCBwYXNzZWQgdG8gaXQsIGFuZCBjcmVhdGVzIGEgbmV3IG9iamVjdCB0aGF0IHVzZXMgdGhlIHRvWG1sU3RyaW5nIGFzIHRvU3RyaW5nLgogICAgICogSXQgaXMgbW9zdGx5IGludGVuZGVkIHRvIGJlIHVzZWQgd2hlbiBsb2dnaW5nIFhNTCBvYmplY3RzLiBCeSB1c2luZyB0aGlzIG1ldGhvZCwgdGhlIHRvWG1sU3RyaW5nIGlzIG9ubHkgY2FsbGVkIGlmIHRoZQogICAgICogbG9nIGxldmVsIGlzIGVuYWJsZWQsIHdoaWNoIGNhbiByZXN1bHQgaW4gaHVnZSBwZXJmb3JtYW5jZSBpbXByb3ZlbWVudHMgd2hlbiBsZXZlbHMgYXJlIGRpc2FibGVkLgogICAgICogIFNlZSB0aGUgZXhhbXBsZSBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KICAgICAqCiAgICAgKiBAZXhhbXBsZQovLyBEbyB0aGlzLCB3aGVuIHlvdSBuZWVkIHRvIGxvZyBzb21lIFhNTCAoZ29vZCk6CkxvZy5kZWJ1ZyggIlRoZSB4bWwgaXM6ICIsIFhtbFV0aWwubG9nWG1sU3RyaW5nKCB4bWwgKSApOwovLyBpbnN0ZWFkIG9mIHRoaXMgKGJhZCwgZG9uJ3QgZG8gdGhpcyk6CkxvZy5kZWJ1ZyggIlRoZSB4bWwgaXM6ICIsIHhtbC50b1htbFN0cmluZygpICk7CiAgICAgKgogICAgICogQHBhcmFtIHtEb2N1bWVudHxFbGVtZW50fSB4bWwgQW4geG1sIG9iamVjdCBvciBhcnJheSBvZiB4bWwgb2JqZWN0cyB0byBjYWxsIHRvWE1MU3RyaW5nIG9uLgogICAgICogQHJldHVybiB7T2JqZWN0fSBBbiBvYmplY3QgdGhhdCBjYW4gYmUgdXNlZCBmb3IgZGVsYXllZCB0b1N0cmluZyBpbnZvY2F0aW9ucy4KICAgICAqIEBzeW50YXggWG1sVXRpbC5sb2dYbWxTdHJpbmcoIHhtbCApOwogICAgICogQG5hbWUgWG1sVXRpbC5sb2dYbWxTdHJpbmcKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgdGhhdC5sb2dYbWxTdHJpbmcgPSBmdW5jdGlvbiAoIHhtbCApIHsKICAgICAgICB2YXIgcmVzID0ge307CiAgICAgICAgcmVzLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoIFV0aWwuZ2V0VHlwZSggeG1sICkgPT09ICdBcnJheScgKSB7CiAgICAgICAgICAgICAgICB2YXIgcmVzID0gIiI7CiAgICAgICAgICAgICAgICBmb3IgKCB2YXIgaSA9IDAgOyBpIDwgeG1sLmxlbmd0aCA7IGkrKyApIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzKz0gIiwiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXMgKz0gWG1sVXRpbC50b1htbFN0cmluZyh4bWxbaV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBYbWxVdGlsLnRvWG1sU3RyaW5nKHhtbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHJldHVybiByZXM7CiAgICB9OwoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHhtbERvY3VtZW50KHMpLgogICAgICogSWYgcGFyYW1ldGVyIGlzIGFuIGFycmF5LCBhIGNvbW1hIHNlcGFyYXRlZCBzdHJpbmcgcmVwcmVzZW50YXRpb24gaXMgcHJvZHVjZWQKICAgICAqCiAgICAgKiBAbWV0aG9kIAogICAgICogQHBhcmFtIHtOb2RlfE5vZGVbXX0gZG9jIE5vZGUgb3IgTm9kZXMgdG8gY29udmVydCB0byBzdHJpbmcKICAgICAqIEBzeW50YXggWG1sVXRpbC50b1htbFN0cmluZyggZG9jICkKICAgICAqIEBuYW1lIFhtbFV0aWwudG9YbWxTdHJpbmcKICAgICAqIEByZXR1cm5zIHtzdHJpbmd9CiAgICAgKi8KICAgIHRoYXQudG9YbWxTdHJpbmcgPSBmdW5jdGlvbiAoZG9jKSB7CiAgICAgICAgdmFyIHJldHVyblN0cmluZyA9ICcnOwogICAgICAgIGlmIChkb2MgaW5zdGFuY2VvZiBBcnJheSkgewogICAgICAgICAgICBmb3IgKCB2YXIgaSA9IDAgOyBpIDwgZG9jLmxlbmd0aCA7IGkrKyApIHsKICAgICAgICAgICAgICAgIGlmIChyZXR1cm5TdHJpbmcubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgICAgIHJldHVyblN0cmluZyArPSAnLCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm5TdHJpbmcgKz0gWG1sVXRpbC5wYXJzZXIudG9YbWxTdHJpbmcoZG9jW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuU3RyaW5nID0gWG1sVXRpbC5wYXJzZXIudG9YbWxTdHJpbmcoZG9jKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFN0cmluZyggcmV0dXJuU3RyaW5nICk7CiAgICB9OwoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIGlmIGEgbm9kZSBpcyBhIERvY3VtZW50IG5vZGUKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLmlzRG9jdW1lbnQKICAgICAqIEBzeW50YXggWG1sVXRpbC5pc0RvY3VtZW50KG5vZGUpCiAgICAgKiBAcGFyYW0ge05vZGV9IG5vZGUKICAgICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIG5vZGUgaXMgYSBkb2N1bWVudAogICAgICogQGV4YW1wbGUKICAgICAqIGlmICggWG1sVXRpbC5pc0RvY3VtZW50KG5vZGUpICkgewogICAgICogICAvLyBEbyBzdHVmZgogICAgICogfQogICAgICovCiAgICB0aGF0LmlzRG9jdW1lbnQgPSBmdW5jdGlvbihub2RlKSB7CiAgICAgICAgdmFyIG5vZGVUeXBlID0gbm9kZS5ub2RlVHlwZTsKICAgICAgICByZXR1cm4gKG5vZGVUeXBlID09PSBOb2RlVHlwZXMuRE9DVU1FTlRfTk9ERSk7CiAgICB9OwoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIGlmIGEgbm9kZSBpcyBhbiBFbGVtZW50IG5vZGUKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLmlzRWxlbWVudAogICAgICogQHN5bnRheCBYbWxVdGlsLmlzRWxlbWVudChub2RlKQogICAgICogQHBhcmFtIHtOb2RlfSBub2RlCiAgICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBub2RlIGlzIGEgZG9jdW1lbnQKICAgICAqIEBleGFtcGxlCiAgICAgKiBpZiAoIFhtbFV0aWwuaXNFbGVtZW50KG5vZGUpICkgewogICAgICogICAvLyBEbyBzdHVmZgogICAgICogfQogICAgICovCiAgICB0aGF0LmlzRWxlbWVudCA9IGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgICB2YXIgbm9kZVR5cGUgPSBub2RlLm5vZGVUeXBlOwogICAgICAgIC8vTG9nLnRyYWNlKCJFbnRlcmluZyBYbWxVdGlsLmlzRWxlbWVudCBmb3Igbm9kZSB0eXBlICIgKyBub2RlVHlwZSApOwogICAgICAgIHJldHVybiAobm9kZVR5cGUgPT09IE5vZGVUeXBlcy5FTEVNRU5UX05PREUpOwogICAgfTsKCgogICAvKioKICAgICAqIERldGVybWluZSBpZiBuYW1lc3BhY2UgaXMgZGVmaW5lZCBpbiB0aGUgbm9kZSBvciBvbmUgb2YgaXRzIGFuY2VzdG9ycwogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhtbFV0aWwuaXNOYW1lc3BhY2VEZWZpbmVkCiAgICAgKiBAc3ludGF4IFhtbFV0aWwuaXNOYW1lc3BhY2VEZWZpbmVkKG5vZGUsIG5hbWVzcGFjZSkKICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZQogICAgICogQHBhcmFtIHtOYW1lc3BhY2V9IG5hbWVzcGFjZQogICAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgbm9kZSBpcyBhIGRvY3VtZW50CiAgICAgKiBAZXhhbXBsZQogICAgICogaWYgKCBYbWxVdGlsLmlzTmFtZXNwYWNlRGVmaW5lZChub2RlLCBYbWxOYW1lc3BhY2VzLmRjKSApIHsKICAgICAqICAgLy8gRG8gc3R1ZmYKICAgICAqIH0KICAgICAqLwogICAgdGhhdC5pc05hbWVzcGFjZURlZmluZWQgPSBmdW5jdGlvbihub2RlLCBuYW1lc3BhY2UpIHsKLy8gICAgICAgIExvZy50cmFjZSgiRW50ZXJpbmcgWG1sVXRpbC5pc05hbWVzcGFjZURlZmluZWQgZm9yIG5vZGUgIiArIG5vZGUudG9TdHJpbmcoKSk7Ci8vICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgZG9jID0gbm9kZS5vd25lckRvY3VtZW50OwogICAgICAgICAgICB2YXIgY3VycmVudCA9IG5vZGU7CiAgICAgICAgICAgIHZhciBhdHRyTmFtZSA9IFhtbE5hbWVzcGFjZXMueG1sbnMucHJlZml4ICsgIjoiICsgbmFtZXNwYWNlLnByZWZpeDsKICAgICAgICAgICAgTG9nLnRyYWNlKCJYbWxVdGlsLmlzTmFtZXNwYWNlRGVmaW5lZCwgbG9va2luZyBmb3IgbmFtZXNwYWNlIGRlZmluaXRpb246ICIsIGF0dHJOYW1lKTsKICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICAgIGlmICggIWN1cnJlbnQgfHwgWG1sVXRpbC5pc0RvY3VtZW50KGN1cnJlbnQpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGN1cnJlbnQuZ2V0QXR0cmlidXRlKGF0dHJOYW1lKSAhPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vTG9nLmRlYnVnKCAiWG1sVXRpbC5pc05hbWVzcGFjZURlZmluZWQsIGN1cnJlbnQ6ICIsIFhtbFV0aWwudG9YbWxTdHJpbmcoIGN1cnJlbnQgKSApOwogICAgICAgICAgICAgICAgY3VycmVudCA9IGN1cnJlbnQucGFyZW50Tm9kZTsKICAgICAgICAgICAgfQovLyAgICAgICAgfQovLyAgICAgICAgZmluYWxseSB7Ci8vICAgICAgICAgICAgTG9nLnRyYWNlKCJMZWF2aW5nIFhtbFV0aWwuaXNOYW1lc3BhY2VEZWZpbmVkIGZvciBub2RlIHR5cGUgIiArIG5vZGUubm9kZVR5cGUpOwovLyAgICAgICAgfQogICAgfTsKCiAgICAvKioKICAgICAqIENyZWF0ZSBhIGRvY3VtZW50IHdpdGggYSBuYW1lZCByb290IGVsZW1lbnQKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLmNyZWF0ZURvY3VtZW50CiAgICAgKiBAc3ludGF4IFhtbFV0aWwuY3JlYXRlRG9jdW1lbnQocm9vdEVsZW1lbnROYW1lLCBuYW1lc3BhY2UpCiAgICAgKiBAcGFyYW0ge3N0cmluZ3x1bmRlZmluZWR9IHJvb3RFbGVtZW50TmFtZSBuYW1lIG9mIHJvb3QgZWxlbWVudC4gU2tpcCB0aGlzIHRvIGNyZWF0ZSBhIGRvY3VtZW50IHdpdGggbm8gZG9jdW1lbnRFbGVtZW50CiAgICAgKiBAcGFyYW0ge05hbWVzcGFjZXx1bmRlZmluZWR9IG5hbWVzcGFjZSBvcHRpb25hbCBuYW1lc3BhY2Ugb2JqZWN0IGluIFhtbE5hbWVzcGFjZXMKICAgICAqIEByZXR1cm4ge0RvY3VtZW50fSBOZXdseSBjcmVhdGVkIGRvY3VtZW50CiAgICAgKiBAZXhhbXBsZQogICAgICogdmFyIGRvYyA9IFhtbFV0aWwuY3JlYXRlRG9jdW1lbnQoKQogICAgICogdmFyIGRvYyA9IFhtbFV0aWwuY3JlYXRlRG9jdW1lbnQoImRjIiwgWG1sTmFtZXNwYWNlcy5vYWlfZGMpCiAgICAgKiAvLyBjcmVhdGVzICc8b2FpX2RjOmRjIHhtbG5zOm9haV9kYz0iaHR0cDovL3d3dy5vcGVuYXJjaGl2ZXMub3JnL09BSS8yLjAvb2FpX2RjLyIvPicKICAgICAqLwogICAgdGhhdC5jcmVhdGVEb2N1bWVudCA9IGZ1bmN0aW9uKHJvb3RFbGVtZW50TmFtZSwgbmFtZXNwYWNlKSB7Ci8vICAgICAgICBMb2cudHJhY2UoIkVudGVyaW5nIFhtbFV0aWwuY3JlYXRlRG9jdW1lbnQiKTsKLy8gICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChuYW1lc3BhY2UpIHsKICAgICAgICAgICAgICAgIHZhciBwcmVmaXggPSBuYW1lc3BhY2UucHJlZml4OwogICAgICAgICAgICAgICAgdmFyIG5hbWVzcGFjZVVSSSA9IG5hbWVzcGFjZS51cmk7CiAgICAgICAgICAgICAgICB2YXIgcXVhbGlmaWVkTmFtZSA9IHByZWZpeCArICI6IiArIHJvb3RFbGVtZW50TmFtZTsKICAgICAgICAgICAgICAgIExvZy5kZWJ1ZygiWG1sVXRpbC5jcmVhdGVEb2N1bWVudCwgY3JlYXRpbmcgZG9jdW1lbnQgd2l0aCByb290IGVsZW1lbnQgJyIsIHF1YWxpZmllZE5hbWUsICInIGFuZCBuYW1lc3BhY2UgdXJpICciLCBuYW1lc3BhY2VVUkksICInIik7CiAgICAgICAgICAgICAgICB2YXIgZG9jdW1lbnQgPSBYbWxVdGlsLmRvbUltcGwuY3JlYXRlRG9jdW1lbnQobmFtZXNwYWNlVVJJLCBxdWFsaWZpZWROYW1lLG51bGwpOwogICAgICAgICAgICAgICAgLy92YXIgZG9jdW1lbnQgPSBYTUxET00uY3JlYXRlRG9jdW1lbnQobmFtZXNwYWNlLCByb290RWxlbWVudE5hbWUpCgogICAgICAgICAgICAgICAgWG1sVXRpbC5hZGREb2N1bWVudE5hbWVzcGFjZShkb2N1bWVudCwgbmFtZXNwYWNlKTsKICAgICAgICAgICAgICAgIHJldHVybiBkb2N1bWVudDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIExvZy5kZWJ1ZygiWG1sVXRpbC5jcmVhdGVEb2N1bWVudCwgY3JlYXRpbmcgZG9jdW1lbnQgd2l0aCByb290IGVsZW1lbnQgJyIsIHJvb3RFbGVtZW50TmFtZSwgIiciKTsKICAgICAgICAgICAgICAgIHJldHVybiBYbWxVdGlsLmRvbUltcGwuY3JlYXRlRG9jdW1lbnQodW5kZWZpbmVkLCByb290RWxlbWVudE5hbWUpOwogICAgICAgICAgICAgICAgLy9yZXR1cm4gWG1sVXRpbC5kb21JbXBsLmNyZWF0ZURvY3VtZW50KG51bGwsIG51bGwsbnVsbCk7CiAgICAgICAgICAgIH0KLy8gICAgICAgIH0gZmluYWxseSB7Ci8vICAgICAgICAgICAgTG9nLnRyYWNlKCJMZWF2aW5nIFhtbFV0aWwuY3JlYXRlRG9jdW1lbnQiKTsKLy8gICAgICAgIH0KICAgIH07CgogICAgLyoqCiAgICAgKiBBZGQgYSBuYW1lc3BhY2UgcHJlZml4IGRlZmluaXRpb24gdG8gdGhlIHJvb3QgZG9jdW1lbnQgZWxlbWVudCBpbiBhIGRvY3VtZW50CiAgICAgKgogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgWG1sVXRpbC5hZGREb2N1bWVudE5hbWVzcGFjZQogICAgICogQHN5bnRheCBYbWxVdGlsLmFkZERvY3VtZW50TmFtZXNwYWNlKGRvY3VtZW50LCBuYW1lc3BhY2UpCiAgICAgKiBAcGFyYW0ge0RvY3VtZW50fSBkb2N1bWVudCBEb2N1bWVudCB0byBhZGQgbmFtZXNwYWNlIGZvcgogICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWVzcGFjZSBuYW1lc3BhY2UgcHJlZml4IHRvIGxvb2sgdXAKCiAgICAgKiBAZXhhbXBsZQogICAgICogdmFyIGRjWG1sID0gWG1sVXRpbC5hZGREb2N1bWVudE5hbWVzcGFjZSgiZGMiLCAib2FpX2RjIik7CiAgICAgKiBYbWxVdGlsLmFkZERvY3VtZW50TmFtZXNwYWNlKGRjWG1sLCAiZGMiKTsKICAgICAqIC8vIGNyZWF0ZXMgJzxvYWlfZGM6ZGMgeG1sbnM6b2FpX2RjPSJodHRwOi8vd3d3Lm9wZW5hcmNoaXZlcy5vcmcvT0FJLzIuMC9vYWlfZGMvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iLz4nCiAgICAgKi8KICAgIHRoYXQuYWRkRG9jdW1lbnROYW1lc3BhY2UgPSBmdW5jdGlvbihkb2N1bWVudCwgbmFtZXNwYWNlKSB7Ci8vICAgICAgICBMb2cudHJhY2UoIkVudGVyaW5nIFhtbFV0aWwuYWRkRG9jdW1lbnROYW1lc3BhY2UsIHByZWZpeDoiLCBuYW1lc3BhY2UucHJlZml4KTsKLy8gICAgICAgIHRyeSB7CiAgICAgICAgICAgIFhtbFV0aWwuYWRkTmFtZXNwYWNlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwgbmFtZXNwYWNlKTsKLy8gICAgICAgIH0gZmluYWxseSB7Ci8vICAgICAgICAgICAgTG9nLnRyYWNlKCJMZWF2aW5nIFhtbFV0aWwuYWRkRG9jdW1lbnROYW1lc3BhY2UiKTsKLy8gICAgICAgIH0KICAgIH07CgogICAgLyoqCiAgICAgKiBBZGQgYSBuYW1lc3BhY2UgcHJlZml4IGRlZmluaXRpb24gdG8gc29tZSBlbGVtZW50IGluIGEgZG9jdW1lbnQKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLmFkZE5hbWVzcGFjZQogICAgICogQHN5bnRheCBYbWxVdGlsLmFkZE5hbWVzcGFjZShkb2N1bWVudCwgbmFtZXNwYWNlKQogICAgICogQHBhcmFtIHtOb2RlfSBub2RlIGVsZW1lbnQgdG8gYWRkIG5hbWVzcGFjZSB0bwogICAgICogQHBhcmFtIHtOYW1lc3BhY2V9IG5hbWVzcGFjZSBuYW1lc3BhY2UgcHJlZml4IHRvIGxvb2sgdXAKCiAgICAgKiAqIEBleGFtcGxlCiAgICAgKiB2YXIgc29tZSA9IFhtbFV0aWwuZnJvbVN0cmluZygiPHJvb3Q+PGNoaWxkPjwvY2hpbGQ+PC9yb290PiIpOwogICAgICogWG1sVXRpbC5hZGROYW1lc3BhY2Uoc29tZSwgWG1sTmFtZXNwYWNlLmRjKTsKICAgICAqIC8vIGNyZWF0ZXMgJzxyb290PjxjaGlsZCB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iPjwvY2hpbGQ+PC9yb290PicKICAgICAqLwogICAgdGhhdC5hZGROYW1lc3BhY2UgPSBmdW5jdGlvbiAobm9kZSwgbmFtZXNwYWNlKSB7Ci8vICAgICAgICBMb2cudHJhY2UoIkVudGVyaW5nIFhtbFV0aWwuYWRkTmFtZXNwYWNlLCBwcmVmaXg6IiwgbmFtZXNwYWNlLnByZWZpeCk7Ci8vICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgYWN0dWFsTm9kZSA9IFhtbFV0aWwuX19nZXRBY3R1YWxOb2RlKG5vZGUpOwogICAgICAgICAgICBMb2cuZGVidWcoIlhtbFV0aWwuYWRkTmFtZXNwYWNlLCBjcmVhdGluZyBuYW1lc3BhY2UgYXR0cmlidXRlIHdpdGggcHJlZml4ICciLCBuYW1lc3BhY2UucHJlZml4LCAiJyBhbmQgbmFtZXNwYWNlIHVyaSAnIiwgbmFtZXNwYWNlLnVyaSwgIiciKTsKICAgICAgICAgICAgWG1sVXRpbC5zZXRBdHRyaWJ1dGUoYWN0dWFsTm9kZSwgbmFtZXNwYWNlLnByZWZpeCwgbmFtZXNwYWNlLnVyaSwgWG1sTmFtZXNwYWNlcy54bWxucyk7Ci8vICAgICAgICB9IGZpbmFsbHkgewovLyAgICAgICAgICAgIExvZy50cmFjZSgiTGVhdmluZyBYbWxVdGlsLmFkZE5hbWVzcGFjZSIpOwovLyAgICAgICAgfQogICAgfTsKCiAgICAvKioKICAgICAqIFNldHMgdGhlIG5hbWVzcGFjZS1wcmVmaXggb24gYW4gZWxlbWVudC4gSWYgdGhlIG5hbWVzcGFjZSBpcyBub3QgZGVjbGFyZWQgb24gYW4gYW5jZXN0b3IgYWxlbWVudAogICAgICogaXQgd2lsbCBiZSBkZWNsYXJlZCBvbiB0aGUgcm9vdCBlbGVtZW50LgogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhtbFV0aWwuc2V0TmFtZXNwYWNlCiAgICAgKiBAc3ludGF4IFhtbFV0aWwuc2V0TmFtZXNwYWNlKGRvY3VtZW50LCBuYW1lc3BhY2UpCiAgICAgKiBAcGFyYW0ge05vZGV9IG5vZGUgZWxlbWVudCB0byBhcHBseSB0aGUgcHJlZml4IG9uCiAgICAgKiBAcGFyYW0ge05hbWVzcGFjZX0gbmFtZXNwYWNlIG5hbWVzcGFjZSB0byBzZXQKCiAgICAgKiAqIEBleGFtcGxlCiAgICAgKiB2YXIgc29tZSA9IFhtbFV0aWwuZnJvbVN0cmluZygiPHJvb3Q+PGNoaWxkPjwvY2hpbGQ+PC9yb290PiIpOwogICAgICogWG1sVXRpbC5zZXROYW1lc3BhY2Uoc29tZSwgWG1sTmFtZXNwYWNlLmRjKTsKICAgICAqIC8vIGNyZWF0ZXMgJzxyb290PjxjaGlsZCB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iPjwvY2hpbGQ+PC9yb290PicKICAgICAqLwogICAgdGhhdC5zZXROYW1lc3BhY2UgPSBmdW5jdGlvbiAobm9kZSwgbmFtZXNwYWNlKSB7Ci8vICAgICAgICBMb2cudHJhY2UoIkVudGVyaW5nIFhtbFV0aWwuc2V0TmFtZXNwYWNlLCBwcmVmaXg6IiwgbmFtZXNwYWNlLnByZWZpeCk7Ci8vICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgYWN0dWFsTm9kZSA9IFhtbFV0aWwuX19nZXRBY3R1YWxOb2RlKG5vZGUpOwogICAgICAgICAgICBMb2cuZGVidWcoIlhtbFV0aWwuc2V0TmFtZXNwYWNlLCBjcmVhdGluZyBuYW1lc3BhY2UgYXR0cmlidXRlIHdpdGggcHJlZml4ICciLCBuYW1lc3BhY2UucHJlZml4LCAiJyBhbmQgbmFtZXNwYWNlIHVyaSAnIiwgbmFtZXNwYWNlLnVyaSwgIiciKTsKCiAgICAgICAgICAgIGlmIChYbWxVdGlsLmlzTmFtZXNwYWNlRGVmaW5lZChhY3R1YWxOb2RlLCBuYW1lc3BhY2UpID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgWG1sVXRpbC5hZGREb2N1bWVudE5hbWVzcGFjZShhY3R1YWxOb2RlLm93bmVyRG9jdW1lbnQsIG5hbWVzcGFjZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWN0dWFsTm9kZS5vd25lckRvY3VtZW50LnJlbmFtZU5vZGUoYWN0dWFsTm9kZSwgbmFtZXNwYWNlLnVyaSwgbmFtZXNwYWNlLnByZWZpeCArICI6IiArIGFjdHVhbE5vZGUubm9kZU5hbWUpOwovLyAgICAgICAgfSBmaW5hbGx5IHsKLy8gICAgICAgICAgICBMb2cudHJhY2UoIkxlYXZpbmcgWG1sVXRpbC5zZXROYW1lc3BhY2UiKTsKLy8gICAgICAgIH0KICAgIH07CgogICAgLy8gVE9ETzogY29uc2lkZXIgcmVuYW1pbmcgdG8ganVzdCBjbG9uZToKICAgIC8qKgogICAgICogTWFrZXMgYW4gZXhhY3QgY2xvbmUgb2YgYSBub2RlCiAgICAgKgogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgWG1sVXRpbC5kZWVwQ2xvbmUKICAgICAqIEBzeW50YXggWG1sVXRpbC5kZWVwQ2xvbmUoeG1sTm9kZSkKICAgICAqIEBwYXJhbSB7Tm9kZX0geG1sTm9kZQogICAgICogQHJldHVybiB7RG9jdW1lbnR9CiAgICAgKiBAZXhhbXBsZQogICAgICogWG1sVXRpbC5kZWVwQ2xvbmUoWG1sVXRpbC5mcm9tU3RyaW5nKCI8cm9vdC8+IikpOwogICAgICovCiAgICB0aGF0LmRlZXBDbG9uZSA9IGZ1bmN0aW9uKHhtbE5vZGUpewovLyAgICAgICAgTG9nLnRyYWNlKCJFbnRlcmluZyBYbWxVdGlsLmRlZXBDbG9uZSwgbm9kZTogIiwgWG1sVXRpbC5sb2dYbWxTdHJpbmcoIHhtbE5vZGUgKSApOwovLyAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIHhtbE5vZGUuY2xvbmVOb2RlKHRydWUpOwovLyAgICAgICAgfSBmaW5hbGx5IHsKLy8gICAgICAgICAgICBMb2cudHJhY2UoIkxlYXZpbmcgWG1sVXRpbC5kZWVwQ2xvbmUiKTsKLy8gICAgICAgIH0KICAgIH07CgogICAgLyoqCiAgICAgKiBBIG5vZGUgaXMgY29uc2lkZXJlZCB0byBjb250YWluIGNvbXBsZXggY29udGVudCBpZiBpdCBoYXMgb25lCiAgICAgKiBvciBtb3JlIGNoaWxkIG5vZGVzIG9mIHR5cGUgRUxFTUVOVF9OT0RFLgogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhtbFV0aWwuaGFzQ29tcGxleENvbnRlbnQKICAgICAqIEBzeW50YXggWG1sVXRpbC5oYXNDb21wbGV4Q29udGVudCh4bWxOb2RlKQogICAgICogQHBhcmFtIHtOb2RlfSB4bWxOb2RlCiAgICAgKiBAcmV0dXJuIHtib29sZWFufQogICAgICogQGV4YW1wbGUKICAgICAqIFhtbFV0aWwuaGFzQ29tcGxleENvbnRlbnQoWG1sVXRpbC5mcm9tU3RyaW5nKCI8cm9vdC8+IikpOyAvLyBmYWxzZQogICAgICogWG1sVXRpbC5oYXNDb21wbGV4Q29udGVudChYbWxVdGlsLmZyb21TdHJpbmcoIjxyb290IHNvbWVhdHRyPSdzb21lIGF0dHJpYnV0ZSc+YSB0ZXh0IG5vZGU8L3Jvb3Q+IikpOyAvLyBmYWxzZQogICAgICogWG1sVXRpbC5oYXNDb21wbGV4Q29udGVudChYbWxVdGlsLmZyb21TdHJpbmcoIjxyb290PjxjaGlsZC8+PC9yb290PiIpKTsgLy8gdHJ1ZQogICAgICovCiAgICB0aGF0Lmhhc0NvbXBsZXhDb250ZW50ID0gZnVuY3Rpb24oeG1sTm9kZSl7CiAgICAgICAgTG9nLnRyYWNlKCJFbnRlcmluZyBYbWxVdGlsLmhhc0NvbXBsZXhDb250ZW50ICIsIFhtbFV0aWwubG9nWG1sU3RyaW5nKCB4bWxOb2RlICkgKTsKICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgYWN0dWFsWG1sTm9kZSA9IFhtbFV0aWwuX19nZXRBY3R1YWxOb2RlKHhtbE5vZGUpOwogICAgICAgICAgICBpZiAoICFhY3R1YWxYbWxOb2RlLmNoaWxkTm9kZXMgfHwgeG1sTm9kZS5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gMCkgeyAKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFjdHVhbFhtbE5vZGUuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYoYWN0dWFsWG1sTm9kZS5jaGlsZE5vZGVzLml0ZW0oaSkubm9kZVR5cGUgPT09IE5vZGVUeXBlcy5FTEVNRU5UX05PREUpewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIFhtbFV0aWwuaGFzQ29tcGxleENvbnRlbnQiKTsKICAgICAgICB9IAogICAgfTsKCiAgICAvKioKICAgICAqIEFwcGVuZCBhIGNoaWxkIHRvIGEgcGFyZW50IG5vZGUuCiAgICAgKgogICAgICogQXV0b21hdGljYWxseSBjbG9uZXMgb3IgaW1wb3J0cyBjaGlsZCBpZiBuZWNlc3NhcnkuCiAgICAgKiBJZiBjaGlsZCBiZWxvbmdzIHRvIGEgZGlmZmVyZW50IGRvY3VtZW50LCBpdCBpcyBpbXBvcnRlZC4KICAgICAqIElmIGNoaWxkIGFscmVhZHkgaGFzIGEgcGFyZW50LCBpdCBpcyBjbG9uZWQKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLmFwcGVuZENoaWxkCiAgICAgKiBAc3ludGF4IFhtbFV0aWwuYXBwZW5kQ2hpbGQocGFyZW50LCBjaGlsZCkKICAgICAqIEBwYXJhbSB7Tm9kZXxEb2N1bWVudH0gcGFyZW50IE5vZGUgdG8gcmVjZWl2ZSBjaGlsZAogICAgICogQHBhcmFtIHtOb2RlfSBjaGlsZCAgVGhlIGNoaWxkIHRvIGFwcGVuZAogICAgICogQHJldHVybiB7Tm9kZX0gdGhlIGFwcGVuZGVkIG5vZGUKICAgICAqIEBleGFtcGxlCiAgICAgKiBYbWxVdGlsLmFwcGVuZENoaWxkKHBhcmVudCwgY2hpbGQpCiAgICAgKi8KICAgIHRoYXQuYXBwZW5kQ2hpbGQgPSBmdW5jdGlvbiggcGFyZW50LCBjaGlsZCApIHsKICAgICAgICBpZiAocGFyZW50ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgWG1sVXRpbC5fX3Rocm93RXJyb3IoIlhtbFV0aWwuYXBwZW5kQ2hpbGQsIHBhcmVudCBpcyB1bmRlZmluZWQiKTsKICAgICAgICB9CiAgICAgICAgaWYgKGNoaWxkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgWG1sVXRpbC5fX3Rocm93RXJyb3IoIlhtbFV0aWwuYXBwZW5kQ2hpbGQsIGNoaWxkIGlzIHVuZGVmaW5lZCIpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGFjdHVhbFBhcmVudCA9IFhtbFV0aWwuX19nZXRBY3R1YWxOb2RlKHBhcmVudCk7CiAgICAgICAgdmFyIGFjdHVhbENoaWxkID0gWG1sVXRpbC5fX2dldEFjdHVhbE5vZGUoY2hpbGQpOwovLyAgICAgICAgTG9nLnRyYWNlKCJFbnRlcmluZyBYbWxVdGlsLmFwcGVuZENoaWxkIik7CiAgICAgICAgLy8gSW1wb3J0IGNoaWxkIGlmIGl0IGJlbG9uZ3MgdG8gYSBkaWZmZXJlbnQgZG9jdW1lbnQKICAgICAgICBpZiAoYWN0dWFsQ2hpbGQub3duZXJEb2N1bWVudCAhPT0gYWN0dWFsUGFyZW50Lm93bmVyRG9jdW1lbnQpIHsKICAgICAgICAgICAgTG9nLmRlYnVnKCJYbWxVdGlsLmFwcGVuZENoaWxkLCBpbXBvcnRpbmcgY2hpbGQgdG8gbmV3IGRvY3VtZW50Iik7CiAgICAgICAgICAgIGFjdHVhbENoaWxkID0gYWN0dWFsUGFyZW50Lm93bmVyRG9jdW1lbnQuaW1wb3J0Tm9kZShhY3R1YWxDaGlsZCx0cnVlKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoYWN0dWFsQ2hpbGQucGFyZW50Tm9kZSAhPT0gdW5kZWZpbmVkICYmIGFjdHVhbENoaWxkLnBhcmVudE5vZGUgIT09IG51bGwpIHsKICAgICAgICAgICAgTG9nLmRlYnVnKCJYbWxVdGlsLmFwcGVuZENoaWxkLCBjaGlsZCBhbHJlYWR5IGhhcyBhIHBhcmVudC4gQ2xvbmluZyBpdCIpOwogICAgICAgICAgICBhY3R1YWxDaGlsZCA9IGFjdHVhbENoaWxkLmNsb25lTm9kZSh0cnVlKTsKICAgICAgICB9CiAgICAgICAgdmFyIG5ld05vZGUgPSBhY3R1YWxQYXJlbnQuYXBwZW5kQ2hpbGQoYWN0dWFsQ2hpbGQpOwoKICAgICAgICAvLyBHbyB0aHJvdWdoIG5ld2x5IGFwcGVuZGVkIHN0cnVjdHVyZSBhbmQgYWRkIG9yIHJlbW92ZSBuYW1lc3BhY2UgYXR0cmlidXRlIGRlZmluaXRpb25zIGFzIHJlcXVpcmVkCiAgICAgICAgdmFyIHByb2Nlc3NOYW1lc3BhY2VzID0gZnVuY3Rpb24oIG5vZGUgKSB7CiAgICAgICAgICAgIExvZy50cmFjZSgiRW50ZXJpbmcgWG1sVXRpbC5wcm9jZXNzTmFtZXNwYWNlcywgIiwgWG1sVXRpbC5sb2dYbWxTdHJpbmcoIG5vZGUgKSApOwogICAgICAgICAgICBpZiAoIFhtbFV0aWwuaXNFbGVtZW50KCBub2RlICkgKSB7CiAgICAgICAgICAgICAgICB2YXIgbmFtZXNwYWNlc1RvQWRkID0gW107CiAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlc1RvUmVtb3ZlID0gW107CiAgICAgICAgICAgICAgICB2YXIgcGFyZW50ID0gbm9kZS5wYXJlbnROb2RlOwoKICAgICAgICAgICAgICAgIC8vIEFkZGluZyBub2RlIG5hbWVzcGFjZSBpZiByZXF1aXJlZAogICAgICAgICAgICAgICAgaWYgKCBub2RlLnByZWZpeCAmJiBub2RlLm5hbWVzcGFjZVVSSSApIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZXNwYWNlID0geyBwcmVmaXg6IG5vZGUucHJlZml4LCB1cmk6IG5vZGUubmFtZXNwYWNlVVJJfTsKICAgICAgICAgICAgICAgICAgICBpZiAoICEgWG1sVXRpbC5pc05hbWVzcGFjZURlZmluZWQoIHBhcmVudCwgbmFtZXNwYWNlICkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgWG1sVXRpbC5hZGROYW1lc3BhY2UoIG5vZGUsIG5hbWVzcGFjZSApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBDaGVjayBmb3IgYXR0cmlidXRlIG5hbWVzcGFjZXMgYXMgd2VsbCBhcyBuYW1lc3BhY2UgZGVmaW5pdGlvbiBhdHRyaWJ1dGVzCiAgICAgICAgICAgICAgICBMb2cudHJhY2UoIlhtbFV0aWwucHJvY2Vzc05hbWVzcGFjZXMsIGNoZWNrIGF0dHJpYnV0ZXMiICk7CiAgICAgICAgICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBub2RlLmF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlID0gbm9kZS5hdHRyaWJ1dGVzLml0ZW0oaSk7CgogICAgICAgICAgICAgICAgICAgIGlmICggYXR0cmlidXRlLnByZWZpeCAmJiBhdHRyaWJ1dGUubmFtZXNwYWNlVVJJICkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBBdHRyaWJ1dGUgd2l0aCBhIG5hbWVzcGFjZQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZXNwYWNlID0geyBwcmVmaXg6IGF0dHJpYnV0ZS5wcmVmaXgsIHVyaTogYXR0cmlidXRlLm5hbWVzcGFjZVVSSX07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggYXR0cmlidXRlLnByZWZpeCA9PSBYbWxOYW1lc3BhY2VzLnhtbG5zLnByZWZpeCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5hbWVzcGFjZSBkZWZpbml0aW9uIGF0dHJpYnV0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZXNwYWNlID0geyBwcmVmaXg6IGF0dHJpYnV0ZS5sb2NhbE5hbWUsIHVyaTogYXR0cmlidXRlLm5vZGVWYWx1ZX07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIFhtbFV0aWwuaXNOYW1lc3BhY2VEZWZpbmVkKCBwYXJlbnQsIG5hbWVzcGFjZSApICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFscmVhZHkgZGVmaW5lZCBpbiBhbmNlc3RvciwgcmVtb3ZlIGl0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlc1RvUmVtb3ZlLnB1c2goIGF0dHJpYnV0ZSApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCAhWG1sVXRpbC5pc05hbWVzcGFjZURlZmluZWQoIG5vZGUsIG5hbWVzcGFjZSApICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTmFtZXNwYWNlIGlzIG5vdCBkZWZpbmVkIGluIGFuY2VzdG9ycywgc28gZGVmaW5lIGl0IGhlcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzcGFjZXNUb0FkZC5wdXNoKCBuYW1lc3BhY2UgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgbmFtZXNwYWNlIGRlZmluaXRpb24gYXR0cmlidXRlcyBmb3IgbmFtZXNwYWNlcyBhbHJlYWR5IGRlZmluZWQgaW4gYW5jZXN0b3JzCiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzVG9SZW1vdmUuZm9yRWFjaCggZnVuY3Rpb24gKCBhdHRyaWJ1dGUgKSB7CiAgICAgICAgICAgICAgICAgICAgTG9nLmRlYnVnKCAiUmVtb3ZpbmcgZHVwbGljYXRlIG5hbWVzcGFjZSBhdHRyaWJ1dGUgIiwgYXR0cmlidXRlLm5vZGVOYW1lLCAiIGZvciAiLCBYbWxVdGlsLmxvZ1htbFN0cmluZyggbm9kZSApICk7CiAgICAgICAgICAgICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGVOb2RlKCBhdHRyaWJ1dGUgKTsKICAgICAgICAgICAgICAgIH0gKTsKCiAgICAgICAgICAgICAgICBuYW1lc3BhY2VzVG9BZGQuZm9yRWFjaCggZnVuY3Rpb24gKCBuYW1lc3BhY2UgKSB7IFhtbFV0aWwuYWRkTmFtZXNwYWNlKCBub2RlLCBuYW1lc3BhY2UgKTsgfSApOwoKCiAgICAgICAgICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBub2RlLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGQgPSBub2RlLmNoaWxkTm9kZXMuaXRlbSggaSApOwogICAgICAgICAgICAgICAgICAgIHByb2Nlc3NOYW1lc3BhY2VzKCBjaGlsZCApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICBwcm9jZXNzTmFtZXNwYWNlcyggbmV3Tm9kZSApOwoKLy8gICAgICAgIExvZy50cmFjZSgiTGVhdmluZyBYbWxVdGlsLmFwcGVuZENoaWxkIik7CiAgICAgICAgcmV0dXJuIG5ld05vZGU7CiAgICB9OwoKICAgIC8qKgogICAgICogQXBwZW5kIG9uZSBvciBtb3JlIGNoaWxkcmVuIHRvIGEgcGFyZW50IG5vZGUuCiAgICAgKgogICAgICogQXV0b21hdGljYWxseSBjbG9uZXMgb3IgaW1wb3J0cyBjaGlsZHJlbiBpZiBuZWNlc3NhcnkuCiAgICAgKiBJZiBjaGlsZCBiZWxvbmdzIHRvIGEgZGlmZmVyZW50IGRvY3VtZW50LCBpdCBpcyBpbXBvcnRlZC4KICAgICAqIElmIGNoaWxkIGFscmVhZHkgaGFzIGEgcGFyZW50LCBpdCBpcyBjbG9uZWQKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLmFwcGVuZENoaWxkcmVuCiAgICAgKiBAc3ludGF4IFhtbFV0aWwuYXBwZW5kQ2hpbGRyZW4ocGFyZW50LCBjaGlsZCkKICAgICAqIEBwYXJhbSB7Tm9kZXxEb2N1bWVudH0gcGFyZW50IE5vZGUgdG8gcmVjZWl2ZSBjaGlsZAogICAgICogQHBhcmFtIHtBcnJheX0gY2hpbGRyZW4gU2luZ2xlIG5vZGUgb3IgYXJyYXkgb2Ygbm9kZXMgdG8gYXBwZW5kCiAgICAgKiBAZXhhbXBsZQogICAgICogWG1sVXRpbC5hcHBlbmRDaGlsZHJlbihwYXJlbnQsIG90aGVyTm9kZS5jaGlsZE5vZGVzKQogICAgICovCiAgICB0aGF0LmFwcGVuZENoaWxkcmVuID0gZnVuY3Rpb24oIHBhcmVudCwgY2hpbGRyZW4gKSB7Ci8vICAgICAgICBMb2cudHJhY2UoIkVudGVyaW5nIFhtbFV0aWwuYXBwZW5kQ2hpbGRyZW4iKTsKLy8gICAgICAgIExvZy50cmFjZSgiWG1sVXRpbC5hcHBlbmRDaGlsZHJlbiwgYXBwZW5kaW5nIGNoaWxkcmVuOiIsIFhtbFV0aWwubG9nWG1sU3RyaW5nKCBjaGlsZHJlbiApLCAiIHRvIHBhcmVudDoiLCBYbWxVdGlsLmxvZ1htbFN0cmluZyggcGFyZW50ICkgKTsKCiAgICAgICAgdmFyIGFjdHVhbFBhcmVudCA9IFhtbFV0aWwuX19nZXRBY3R1YWxOb2RlKHBhcmVudCk7CgogICAgICAgIGlmKCBjaGlsZHJlbi5ub2RlVHlwZSAhPT0gdW5kZWZpbmVkKXsKICAgICAgICAgICAgLy8gSWYgY2hpbGRyZW4gaXMgYSBzaW5nbGUgbm9kZSwgYXBwZW5kIGl0CiAgICAgICAgICAgIFhtbFV0aWwuYXBwZW5kQ2hpbGQoYWN0dWFsUGFyZW50LCBjaGlsZHJlbik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgTG9nLnRyYWNlKCJYbWxVdGlsLmFwcGVuZENoaWxkcmVuLCBjaGlsZHJlbi5sZW5ndGg9IiwgY2hpbGRyZW4ubGVuZ3RoKTsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAgOyBpICA8IGNoaWxkcmVuLmxlbmd0aCA7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIGNoaWxkID0gY2hpbGRyZW5baV07CiAgICAgICAgICAgICAgICBMb2cudHJhY2UoIlhtbFV0aWwuYXBwZW5kQ2hpbGRyZW4sIGNoaWxkcmVuWyIsIGkgLCAiXT0iLCBYbWxVdGlsLmxvZ1htbFN0cmluZyggY2hpbGQgKSApOwogICAgICAgICAgICAgICAgWG1sVXRpbC5hcHBlbmRDaGlsZChhY3R1YWxQYXJlbnQsIGNoaWxkcmVuW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KLy8gICAgICAgIExvZy50cmFjZSgiTGVhdmluZyBYbWxVdGlsLmFwcGVuZENoaWxkcmVuIik7CiAgICB9OwoKICAgIC8qKgogICAgICogU2VsZWN0IG5vZGVzIGZyb20gb25lIGRvY3VtZW50IG9yIG5vZGUgYW5kIGFwcGVuZCB0byBhbm90aGVyIG5vZGUKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLmFwcGVuZFNlbGVjdGVkCiAgICAgKiBAc3ludGF4IFhtbFV0aWwuYXBwZW5kU2VsZWN0ZWQoc291cmNlWFBhdGgsIHNvdXJjZU5vZGUsIGRlc3RpbmF0aW9uTm9kZSwgZGVzdGluYXRpb25YUGF0aCkKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzb3VyY2VYUGF0aCBUaGUgcGF0aCB0byBzZWxlY3Qgc291cmNlIG5vZGVzIGZyb20KICAgICAqIEBwYXJhbSB7RG9jdW1lbnR8Tm9kZX0gc291cmNlTm9kZSBUaGUgZG9jdW1lbnQgb3Igbm9kZSB0byBzZWxlY3Qgc291cmNlIG5vZGVzIGZyb20KICAgICAqIEBwYXJhbSB7Tm9kZX0gZGVzdGluYXRpb25Ob2RlIFRoZSBub2RlIHRvIGJlIHBhcmVudCBvZiB0aGUgYXBwZW5kZWQgbm9kZXMKICAgICAqIEBwYXJhbSB7U3RyaW5nfFVuZGVmaW5lZH0gZGVzdGluYXRpb25YUGF0aCBPcHRpb25hbCB4cGF0aCB0byBzZWxlY3QgZGVzdGluYXRpb24gbm9kZSBpbnNpZGUgZGVzdGluYXRpb25Ob2RlLgogICAgICogSWYgbm90IHNwZWNpZmllZCwgc291cmNlIG5vZGVzIHdpbGwgYmUgcHV0IGluIGFzIGNoaWxkcmVuIGRpcmVjdGx5IHVuZGVyIGRlc3RpbmF0aW9uTm9kZQogICAgICogQHJldHVybiB7Tm9kZX0gdGhlIGRlc3RpbmF0aW9uIG5vZGUgdGhhdCBpcyBwYXJlbnQgb2YgdGhlIG5ldyBpbXBvcnRlZCBjaGlsZHJlbgogICAgICogQGV4YW1wbGUKICAgICAqIFhtbFV0aWwuYXBwZW5kU2VsZWN0ZWQoJy9yb290LyonLCBzb3VyY2VEb2MsIGRlc3RpbmF0aW9uRG9jKTsKICAgICAqIFhtbFV0aWwuYXBwZW5kU2VsZWN0ZWQoJy9yb290LyonLCBzb3VyY2VEb2MsIGRlc3RpbmF0aW9uRG9jLCAnL25ld1Jvb3QnKTsKICAgICAqLwogICAgdGhhdC5hcHBlbmRTZWxlY3RlZCA9IGZ1bmN0aW9uKHNvdXJjZVhQYXRoLCBzb3VyY2VOb2RlLCBkZXN0aW5hdGlvbk5vZGUsIGRlc3RpbmF0aW9uWFBhdGgpIHsKLy8gICAgICAgIExvZy50cmFjZSgiRW50ZXJpbmcgWG1sVXRpbC5hcHBlbmRTZWxlY3RlZCIpOwovLyAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gU3VwcG9ydCBib3RoIGRvY3VtZW50cyBhbmQgbm9kZXMgYXMgZGVzdGluYXRpb24KICAgICAgICAgICAgdmFyIGFjdHVhbERlc3RpbmF0aW9uTm9kZSA9IFhtbFV0aWwuX19nZXRBY3R1YWxOb2RlKGRlc3RpbmF0aW9uTm9kZSk7CgogICAgICAgICAgICBpZiAoZGVzdGluYXRpb25YUGF0aCkgewogICAgICAgICAgICAgICAgTG9nLmRlYnVnKCJYbWxVdGlsLmFwcGVuZFNlbGVjdGVkLCBzZWxlY3RpbmcgZGVzdGluYXRpb24gbm9kZSB3aXRoICIsIGRlc3RpbmF0aW9uWFBhdGgpOwogICAgICAgICAgICAgICAgYWN0dWFsRGVzdGluYXRpb25Ob2RlID0gWFBhdGguc2VsZWN0Tm9kZShkZXN0aW5hdGlvblhQYXRoLCBhY3R1YWxEZXN0aW5hdGlvbk5vZGUgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIGFjdHVhbERlc3RpbmF0aW9uTm9kZSA9PT0gdW5kZWZpbmVkICkgewogICAgICAgICAgICAgICAgWG1sVXRpbC5fX3Rocm93RXJyb3IoIlhtbFV0aWwuYXBwZW5kU2VsZWN0ZWQsIGRlc3RpbmF0aW9uIG5vZGUgaXMgdW5kZWZpbmVkIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIExvZy5kZWJ1ZygiWG1sVXRpbC5hcHBlbmRTZWxlY3RlZCwgc2VsZWN0aW5nIHNvdXJjZSBub2RlcyB3aXRoICIsIHNvdXJjZVhQYXRoKTsKICAgICAgICAgICAgdmFyIGNoaWxkcmVuID0gWFBhdGguc2VsZWN0KHNvdXJjZVhQYXRoLCBzb3VyY2VOb2RlKTsKICAgICAgICAgICAgWG1sVXRpbC5hcHBlbmRDaGlsZHJlbihhY3R1YWxEZXN0aW5hdGlvbk5vZGUsIGNoaWxkcmVuKTsKCiAgICAgICAgICAgIHJldHVybiBhY3R1YWxEZXN0aW5hdGlvbk5vZGU7Ci8vICAgICAgICB9IGZpbmFsbHkgewovLyAgICAgICAgICAgIExvZy50cmFjZSgiTGVhdmluZyBYbWxVdGlsLmFwcGVuZFNlbGVjdGVkIik7Ci8vICAgICAgICB9CiAgICB9OwoKCiAgICAvKioKICAgICAqIENyZWF0ZSBhbmQgYXBwZW5kIGEgbmV3IGVsZW1lbnQgbm9kZSB3aXRoIG9wdGlvbmFsIG5hbWVzcGFjZSBhbmQgdGV4dCBjb250ZW50IHRvIHRoZSBzcGVjaWZpZWQgbm9kZQogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhtbFV0aWwuYXBwZW5kQ2hpbGRFbGVtZW50CiAgICAgKiBAc3ludGF4IFhtbFV0aWwuYXBwZW5kQ2hpbGRFbGVtZW50KG5vZGUsIGVsZW1lbnROYW1lLCBuYW1lc3BhY2UsIGVsZW1lbnRWYWx1ZSkKICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZSBwYXJlbnQgb2YgbmV3IG5vZGUKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50TmFtZSBuYW1lIG9mIHRoZSBlbGVtZW50IG5vZGUgdG8gY3JlYXRlCiAgICAgKiBAcGFyYW0ge05hbWVzcGFjZXx1bmRlZmluZWR9IG5hbWVzcGFjZSBvcHRpb25hbCBuYW1lc3BhY2UgZm9yIG5vZGUKICAgICAqIEBwYXJhbSB7c3RyaW5nfHVuZGVmaW5lZH0gZWxlbWVudFZhbHVlIG9wdGlvbmFsIHN0cmluZyB2YWx1ZSB0byBpbnNlcnQgaW4gYSB0ZXh0IG5vZGUKICAgICAqIEByZXR1cm4ge0VsZW1lbnR9IFhNTERPTSBFbGVtZW50IHRoYXQgd2FzIGNyZWF0ZWQKICAgICAqIEBleGFtcGxlCiAgICAgKiB2YXIgZWxlbWVudCA9IFhtbFV0aWwuYXBwZW5kQ2hpbGRFbGVtZW50KG5vZGUsICJjcmVhdG9yIiwgWG1sTmFtZXNwYWNlcy5kYywgIk1lIik7CiAgICAgKiB2YXIgZWxlbWVudCA9IFhtbFV0aWwuYXBwZW5kQ2hpbGRFbGVtZW50KG5vZGUsICJjcmVhdG9yIiwgWG1sTmFtZXNwYWNlcy5kYyk7CiAgICAgKiB2YXIgZWxlbWVudCA9IFhtbFV0aWwuYXBwZW5kQ2hpbGRFbGVtZW50KG5vZGUsICJjcmVhdG9yIiwgdW5kZWZpbmVkLCAiTWUiKTsKICAgICAqIHZhciBlbGVtZW50ID0gWG1sVXRpbC5hcHBlbmRDaGlsZEVsZW1lbnQobm9kZSwgImNyZWF0b3IiKTsKICAgICAqLwogICAgdGhhdC5hcHBlbmRDaGlsZEVsZW1lbnQgPSBmdW5jdGlvbiggbm9kZSwgZWxlbWVudE5hbWUsIG5hbWVzcGFjZSwgZWxlbWVudFZhbHVlICkgewovLyAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmcgWG1sVXRpbC5hcHBlbmRDaGlsZEVsZW1lbnQiICk7Ci8vICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBTdXBwb3J0IGJvdGggZG9jdW1lbnRzIGFuZCBub2RlcyBhcyBkZXN0aW5hdGlvbgogICAgICAgICAgICB2YXIgYWN0dWFsTm9kZSA9IFhtbFV0aWwuX19nZXRBY3R1YWxOb2RlKG5vZGUpOwoKICAgICAgICAgICAgdmFyIGRvY3VtZW50ID0gYWN0dWFsTm9kZS5vd25lckRvY3VtZW50OwogICAgICAgICAgICB2YXIgZWxlbWVudCA9IFhtbFV0aWwuY3JlYXRlRWxlbWVudChkb2N1bWVudCwgZWxlbWVudE5hbWUsIG5hbWVzcGFjZSwgZWxlbWVudFZhbHVlKTsKCiAgICAgICAgICAgIFhtbFV0aWwuYXBwZW5kQ2hpbGQoIGFjdHVhbE5vZGUsIGVsZW1lbnQgKTsKCiAgICAgICAgICAgIHJldHVybiBlbGVtZW50OwovLyAgICAgICAgfSBmaW5hbGx5IHsKLy8gICAgICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIFhtbFV0aWwuYXBwZW5kQ2hpbGRFbGVtZW50IiApOwovLyAgICAgICAgfQogICAgfTsKCiAgICAvKioKICAgICAqIENyZWF0ZSBhbmQgYXBwZW5kIG9yIHJlcGxhY2UgYW4gZWxlbWVudCBub2RlIHdpdGggb3B0aW9uYWwgbmFtZXNwYWNlIGFuZCB0ZXh0IGNvbnRlbnQgdG8gdGhlIHNwZWNpZmllZCBub2RlLgogICAgICogCiAgICAgKiBJZiBhIG5vZGUgd2l0aCB0aGUgc3BlY2lmaWVkIG5hbWUgYWxyZWFkeSBleGlzdHMsIGl0cyB0ZXh0IHdpbGwgYmUgcmVwbGFjZWQuCiAgICAgKiBFbHNlIGEgbmV3IG5vZGUgd2lsbCBiZSBjcmVhdGVkCiAgICAgKgogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgWG1sVXRpbC5yZXBsYWNlQ2hpbGRFbGVtZW50CiAgICAgKiBAc3ludGF4IFhtbFV0aWwucmVwbGFjZUNoaWxkRWxlbWVudChub2RlLCBlbGVtZW50TmFtZSwgbmFtZXNwYWNlLCBlbGVtZW50VmFsdWUpCiAgICAgKiBAcGFyYW0ge05vZGV9IG5vZGUgcGFyZW50IG9mIG5ldyBub2RlCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudE5hbWUgbmFtZSBvZiB0aGUgZWxlbWVudCBub2RlIHRvIGNyZWF0ZQogICAgICogQHBhcmFtIHtOYW1lc3BhY2V8dW5kZWZpbmVkfSBuYW1lc3BhY2Ugb3B0aW9uYWwgbmFtZXNwYWNlIGZvciBub2RlCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudFZhbHVlIHN0cmluZyB2YWx1ZSB0byBpbnNlcnQgaW4gYSB0ZXh0IG5vZGUKICAgICAqIEByZXR1cm4ge0VsZW1lbnR9IFhNTERPTSBFbGVtZW50IHRoYXQgd2FzIGNyZWF0ZWQKICAgICAqIEBleGFtcGxlCiAgICAgKiB2YXIgZWxlbWVudCA9IFhtbFV0aWwucmVwbGFjZUNoaWxkRWxlbWVudChub2RlLCAiY3JlYXRvciIsIFhtbE5hbWVzcGFjZXMuZGMsICJNZSIpOwogICAgICogdmFyIGVsZW1lbnQgPSBYbWxVdGlsLnJlcGxhY2VDaGlsZEVsZW1lbnQobm9kZSwgImNyZWF0b3IiLCBYbWxOYW1lc3BhY2VzLmRjKTsKICAgICAqIHZhciBlbGVtZW50ID0gWG1sVXRpbC5yZXBsYWNlQ2hpbGRFbGVtZW50KG5vZGUsICJjcmVhdG9yIik7CiAgICAgKi8KICAgIHRoYXQucmVwbGFjZUNoaWxkRWxlbWVudCA9IGZ1bmN0aW9uKCBub2RlLCBlbGVtZW50TmFtZSwgbmFtZXNwYWNlLCBlbGVtZW50VmFsdWUgKSB7Ci8vICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZyBYbWxVdGlsLnJlcGxhY2VDaGlsZEVsZW1lbnQiICk7Ci8vICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBTdXBwb3J0IGJvdGggZG9jdW1lbnRzIGFuZCBub2RlcyBhcyBkZXN0aW5hdGlvbgogICAgICAgICAgICB2YXIgYWN0dWFsTm9kZSA9IFhtbFV0aWwuX19nZXRBY3R1YWxOb2RlKG5vZGUpOwogICAgICAgICAgICAKICAgICAgICAgICAgdmFyIGV4aXN0aW5nRWxlbWVudHMgPSBYbWxVdGlsLmdldENoaWxkRWxlbWVudHMoYWN0dWFsTm9kZSwgZWxlbWVudE5hbWUsIG5hbWVzcGFjZSk7CiAgICAgICAgICAgIGlmICggZXhpc3RpbmdFbGVtZW50cy5sZW5ndGggPiAwICkgewogICAgICAgICAgICAgICAgTG9nLmRlYnVnKCAiWG1sVXRpbC5yZXBsYWNlQ2hpbGRFbGVtZW50LCBmb3VuZCAiLCBleGlzdGluZ0VsZW1lbnRzLmxlbmd0aCwgIiBlbGVtZW50KHMpIHdpdGggbmFtZSAiLCBlbGVtZW50TmFtZSApOwogICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBleGlzdGluZ0VsZW1lbnRzWzBdOwogICAgICAgICAgICAgICAgLy92YXIgZWxlbWVudCA9IGV4aXN0aW5nRWxlbWVudHMuaXRlbSgwKTsKICAgICAgICAgICAgICAgIExvZy5kZWJ1ZyggIlhtbFV0aWwucmVwbGFjZUNoaWxkRWxlbWVudCwgYmVmb3JlIHJlcGxhY2UiLCBYbWxVdGlsLmxvZ1htbFN0cmluZyggZWxlbWVudCApKTsKICAgICAgICAgICAgICAgIC8vIE92ZXJ3cml0ZSBleGlzdGluZyB0ZXh0CiAgICAgICAgICAgICAgICBYbWxVdGlsLmFwcGVuZFRleHQoZWxlbWVudCwgZWxlbWVudFZhbHVlLCB0cnVlKTsKICAgICAgICAgICAgICAgIExvZy5kZWJ1ZyggIlhtbFV0aWwucmVwbGFjZUNoaWxkRWxlbWVudCwgcmVwbGFjZWQgZWxlbWVudCAiLCBYbWxVdGlsLmxvZ1htbFN0cmluZyggZWxlbWVudCApICk7CiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIExvZy5kZWJ1ZyggIlhtbFV0aWwucmVwbGFjZUNoaWxkRWxlbWVudCwgZXhpc3RpbmcgZWxlbWVudCBub3QgZm91bmQuIENyZWF0ZSBuZXcgZWxlbWVudCIgKTsKICAgICAgICAgICAgICAgIHJldHVybiBYbWxVdGlsLmFwcGVuZENoaWxkRWxlbWVudChhY3R1YWxOb2RlLCBlbGVtZW50TmFtZSwgbmFtZXNwYWNlLCBlbGVtZW50VmFsdWUpOwogICAgICAgICAgICB9Ci8vICAgICAgICB9IGZpbmFsbHkgewovLyAgICAgICAgICAgIExvZy50cmFjZSggIkxlYXZpbmcgWG1sVXRpbC5yZXBsYWNlQ2hpbGRFbGVtZW50IiApOwovLyAgICAgICAgfQogICAgfTsKCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBlbGVtZW50IG5vZGUgd2l0aCBvcHRpb25hbCBuYW1lc3BhY2UgYW5kIHRleHQgY29udGVudAogICAgICoKICAgICAqICoqTm90ZToqKiBPbmx5IGNyZWF0ZXMgdGhlIG5vZGUuIEl0IGlzIG5vdCBhZGRlZCBhcyBhIGNoaWxkIG5vZGUgdG8gYW55IG90aGVyIG5vZGUgaW4gdGhlIGRvY3VtZW50LgogICAgICogdXNlIGFwcGVuZENoaWxkIG1ldGhvZCBvZiB0aGUgbm9kZSB5b3Ugd2FuIHRvIGluc2VydCBpdCBpbgogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhtbFV0aWwuY3JlYXRlRWxlbWVudAogICAgICogQHN5bnRheCBYbWxVdGlsLmNyZWF0ZUVsZW1lbnQoZG9jdW1lbnQsIGVsZW1lbnROYW1lLCBuYW1lc3BhY2UsIGVsZW1lbnRWYWx1ZSkKICAgICAqIEBwYXJhbSB7RG9jdW1lbnR9IGRvY3VtZW50IHRvIGNyZWF0ZSBlbGVtZW50IGluCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudE5hbWUgbmFtZSBvZiB0aGUgZWxlbWVudCBub2RlIHRvIGNyZWF0ZQogICAgICogQHBhcmFtIHtOYW1lc3BhY2V8dW5kZWZpbmVkfSBuYW1lc3BhY2Ugb3B0aW9uYWwgbmFtZXNwYWNlIGZvciBub2RlCiAgICAgKiBAcGFyYW0ge3N0cmluZ3x1bmRlZmluZWR9IGVsZW1lbnRWYWx1ZSBvcHRpb25hbCBzdHJpbmcgdmFsdWUgdG8gaW5zZXJ0IGluIGEgdGV4dCBub2RlCiAgICAgKiBAcmV0dXJuIHtFbGVtZW50fSBYTUxET00gRWxlbWVudCB0aGF0IHdhcyBjcmVhdGVkCiAgICAgKiBAZXhhbXBsZQogICAgICogdmFyIGVsZW1lbnQgPSBYbWxVdGlsLmNyZWF0ZUVsZW1lbnQoZG9jdW1lbnQsICJjcmVhdG9yIiwgWG1sTmFtZXNwYWNlcy5kYywgIk1lIik7CiAgICAgKiB2YXIgZWxlbWVudCA9IFhtbFV0aWwuY3JlYXRlRWxlbWVudChkb2N1bWVudCwgImNyZWF0b3IiLCBYbWxOYW1lc3BhY2VzLmRjKTsKICAgICAqIHZhciBlbGVtZW50ID0gWG1sVXRpbC5jcmVhdGVFbGVtZW50KGRvY3VtZW50LCAiY3JlYXRvciIsIHVuZGVmaW5lZCwgIk1lIik7CiAgICAgKiB2YXIgZWxlbWVudCA9IFhtbFV0aWwuY3JlYXRlRWxlbWVudChkb2N1bWVudCwgImNyZWF0b3IiKTsKICAgICAqLwogICAgdGhhdC5jcmVhdGVFbGVtZW50ID0gZnVuY3Rpb24oIGRvY3VtZW50LCBlbGVtZW50TmFtZSwgbmFtZXNwYWNlLCBlbGVtZW50VmFsdWUgKSB7Ci8vICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZyBYbWxVdGlsLmNyZWF0ZUVsZW1lbnQiICk7Ci8vICAgICAgICB0cnkgewoKICAgICAgICAvLyBqYXZhIG9iamVjdHMgbXVzdCBvcGVyYXRlIG9uIG93bmVyZG9jdW1lbnQKICAgICAgICAvLyBAVE9ETyBpcyB0aGlzIE9LID8/CiAgICAgICAgaWYoZG9jdW1lbnQub3duZXJEb2N1bWVudCAhPT0gdW5kZWZpbmVkICYmIGRvY3VtZW50Lm93bmVyRG9jdW1lbnQgIT09IG51bGwpIHsKICAgICAgICAgICAgZG9jdW1lbnQgPSBkb2N1bWVudC5vd25lckRvY3VtZW50OwogICAgICAgIH0KICAgICAgICAgICAgdmFyIGVsZW1lbnQ7CiAgICAgICAgICAgIGlmICggIW5hbWVzcGFjZSApIHsKICAgICAgICAgICAgICAgIExvZy50cmFjZSggIlhtbFV0aWwuY3JlYXRlRWxlbWVudCwgY3JlYXRlIGVsZW1lbnQ6ICIsIGVsZW1lbnROYW1lICk7CiAgICAgICAgICAgICAgICBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChlbGVtZW50TmFtZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoIW5hbWVzcGFjZS5wcmVmaXgpIHsKICAgICAgICAgICAgICAgICAgICBYbWxVdGlsLl9fdGhyb3dFcnJvcigiWG1sVXRpbC5jcmVhdGVFbGVtZW50LCBOYW1lc3BhY2UgcHJlZml4IG1pc3NpbmcgIiArIG5hbWVzcGFjZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIW5hbWVzcGFjZS51cmkpIHsKICAgICAgICAgICAgICAgICAgICBYbWxVdGlsLl9fdGhyb3dFcnJvcigiWG1sVXRpbC5jcmVhdGVFbGVtZW50LCBOYW1lc3BhY2UgdXJpIG1pc3NpbmcgIiArIG5hbWVzcGFjZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBMb2cudHJhY2UoICJYbWxVdGlsLmNyZWF0ZUVsZW1lbnQsIGNyZWF0ZSBlbGVtZW50OiAiLCBuYW1lc3BhY2UucHJlZml4LCAiOiIsIGVsZW1lbnROYW1lICk7CiAgICAgICAgICAgICAgICBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKG5hbWVzcGFjZS51cmksIG5hbWVzcGFjZS5wcmVmaXggKyAiOiIgKyBlbGVtZW50TmFtZSk7CiAgICAgICAgICAgICAgICBYbWxVdGlsLmFkZE5hbWVzcGFjZShlbGVtZW50LCBuYW1lc3BhY2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChlbGVtZW50VmFsdWUpIHsKICAgICAgICAgICAgICAgIC8vTG9nLnRyYWNlKCAiWG1sVXRpbC5jcmVhdGVFbGVtZW50LCBhZGRpbmcgdGV4dCBub2RlOiAnIiwgZWxlbWVudFZhbHVlLCAiJyIgKTsKICAgICAgICAgICAgICAgIHZhciB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZWxlbWVudFZhbHVlKTsKICAgICAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQodGV4dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgTG9nLnRyYWNlKCJYbWxVdGlsLmNyZWF0ZUVsZW1lbnQsIGNyZWF0ZWQgZWxlbWVudCAiLCBYbWxVdGlsLmxvZ1htbFN0cmluZyggZWxlbWVudCApICk7CiAgICAgICAgICAgIHJldHVybiBlbGVtZW50OwovLyAgICAgICAgfSBmaW5hbGx5IHsKLy8gICAgICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIFhtbFV0aWwuY3JlYXRlRWxlbWVudCIgKTsKLy8gICAgICAgIH0KICAgIH07CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIGNoaWxkIG5vZGVzIHRoYXQgYXJlIEVsZW1lbnQgbm9kZXMuCiAgICAgKiBJLmUuIHNraXAgdGV4dCBvciBvdGhlciBjaGlsZCBub2Rlcy4KICAgICAqCiAgICAgKiBBZGRpdGlvbmFsIHBhcmFtZXRlcnMgYWxsb3cgdG8gc3BlY2lmeSB0aGF0IHlvdSBvbmx5IHdhbnQgZWxlbWVudHMgd2l0aCBhIHNwZWNpZmljIG5hbWUsCiAgICAgKiBlbGVtZW50cyB0aGF0IGhhdmUgYSBwYXJ0aWN1bGFyIGF0dHJpYnV0ZSAoYnkgbmFtZSBhbmQvb3IgdmFsdWUpCiAgICAgKgogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgWG1sVXRpbC5nZXRDaGlsZEVsZW1lbnRzCiAgICAgKiBAc3ludGF4IFhtbFV0aWwuZ2V0Q2hpbGRFbGVtZW50cyhub2RlKQogICAgICogQHBhcmFtIHtEb2N1bWVudHxOb2RlfSBub2RlIHRvIGdldCBjaGlsZCBlbGVtZW50cyBmcm9tCiAgICAgKiBAcGFyYW0ge1N0cmluZ3x1bmRlZmluZWR9IGVsZW1lbnROYW1lIE9wdGlvbmFsIGVsZW1lbnQgbmFtZSBmaWx0ZXIgcmVzdWx0IGZvcgogICAgICogQHBhcmFtIHtPYmplY3R8dW5kZWZpbmVkfSBlbGVtZW50TmFtZXNwYWNlIE9wdGlvbmFsIG5hbWVzcGFjZSBmb3IgZWxlbWVudCBuYW1lCiAgICAgKiBAcGFyYW0ge1N0cmluZ3x1bmRlZmluZWR9IGF0dHJpYnV0ZU5hbWUgT3B0aW9uYWwgYXR0cmlidXRlIG5hbWUgZmlsdGVyIHJlc3VsdCBmb3IKICAgICAqIEBwYXJhbSB7T2JqZWN0fHVuZGVmaW5lZH0gYXR0cmlidXRlTmFtZXNwYWNlIE9wdGlvbmFsIG5hbWVzcGFjZSBmb3IgYXR0cmlidXRlIG5hbWUKICAgICAqIEBwYXJhbSB7T2JqZWN0fHVuZGVmaW5lZH0gYXR0cmlidXRlVmFsdWUgT3B0aW9uYWwgYXR0cmlidXRlIHZhbHVlIHRvIGZpbHRlciByZXN1bHQgZm9yCiAgICAgKiBAcmV0dXJuIHtFbGVtZW50W119IEFycmF5IG9mIGNoaWxkIGVsZW1lbnRzCiAgICAgKiBAZXhhbXBsZQogICAgICogdmFyIGVsZW1lbnRzID0gWG1sVXRpbC5nZXRDaGlsZEVsZW1lbnRzKGRvY3VtZW50KTsKICAgICAqIHZhciBlbGVtZW50cyA9IFhtbFV0aWwuZ2V0Q2hpbGRFbGVtZW50cyhkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpOwogICAgICogdmFyIGVsZW1lbnRzID0gWG1sVXRpbC5nZXRDaGlsZEVsZW1lbnRzKGRvY3VtZW50LCAiY2hpbGQiKTsKICAgICAqIHZhciBlbGVtZW50cyA9IFhtbFV0aWwuZ2V0Q2hpbGRFbGVtZW50cyhkb2N1bWVudCwgImNoaWxkIiwgWG1sTmFtZXNwYWNlcy5kYyk7IC8vZmlsdGVyIGJ5IGVsZW1lbnQgbmFtZQogICAgICogdmFyIGVsZW1lbnRzID0gWG1sVXRpbC5nZXRDaGlsZEVsZW1lbnRzKGRvY3VtZW50LCAiY2hpbGQiLCBYbWxOYW1lc3BhY2VzLmRjLCAiYXR0IiwgWG1sTmFtZXNwYWNlcy5kYyk7IC8vZmlsdGVyIGJ5IGVsZW1lbnQgbmFtZSBhbmQgYXR0cmlidXRlIG5hbWUKICAgICAqIHZhciBlbGVtZW50cyA9IFhtbFV0aWwuZ2V0Q2hpbGRFbGVtZW50cyhkb2N1bWVudCwgImNoaWxkIiwgWG1sTmFtZXNwYWNlcy5kYywgImF0dCIsIFhtbE5hbWVzcGFjZXMuZGMsICJ2YWx1ZSIpOyAvL2ZpbHRlciBieSBlbGVtZW50IG5hbWUsIGF0dHJpYnV0ZSBuYW1lIGFuZCBhdHRyaWJ1dGUgdmFsdWUKICAgICAqIHZhciBlbGVtZW50cyA9IFhtbFV0aWwuZ2V0Q2hpbGRFbGVtZW50cyhkb2N1bWVudCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCAidmFsdWUiKTsgLy9maWx0ZXIgYnkgYXR0cmlidXRlIHZhbHVlCiAgICAgKi8KICAgIHRoYXQuZ2V0Q2hpbGRFbGVtZW50cyA9IGZ1bmN0aW9uKCBub2RlLCBlbGVtZW50TmFtZSwgZWxlbWVudE5hbWVzcGFjZSwgYXR0cmlidXRlTmFtZSwgYXR0cmlidXRlTmFtZXNwYWNlLCBhdHRyaWJ1dGVWYWx1ZSApIHsKLy8gICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIFhtbFV0aWwuZ2V0Q2hpbGRFbGVtZW50cyIgKTsKLy8gICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghWG1sVXRpbC5pc1htbChub2RlKSkgewogICAgICAgICAgICAgICAgWG1sVXRpbC5fX3Rocm93RXJyb3IoIk5vZGUgaXMgbm90IGFuIHhtbCBub2RlOiIgKyBub2RlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBTdXBwb3J0IGJvdGggZG9jdW1lbnRzIGFuZCBub2RlcwogICAgICAgICAgICB2YXIgYWN0dWFsTm9kZSA9IFhtbFV0aWwuX19nZXRBY3R1YWxOb2RlKG5vZGUpOwoKICAgICAgICAgICAgaWYoZWxlbWVudE5hbWVzcGFjZSl7CiAgICAgICAgICAgICAgICBlbGVtZW50TmFtZSA9IGVsZW1lbnROYW1lc3BhY2UucHJlZml4ICsgIjoiICsgZWxlbWVudE5hbWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBlbGVtZW50cyA9IFtdOwogICAgICAgICAgICBmb3IodmFyIGkgPSAwIDsgaSA8IGFjdHVhbE5vZGUuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgICAgICAvL3ZhciBjaGlsZCA9IGFjdHVhbE5vZGUuY2hpbGROb2Rlc1tpXTsKICAgICAgICAgICAgICAgIHZhciBjaGlsZCA9IGFjdHVhbE5vZGUuY2hpbGROb2Rlcy5pdGVtKGkpOwogICAgICAgICAgICAgICAgaWYgKGNoaWxkLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuRUxFTUVOVF9OT0RFKSB7CgkJICAgIGlmKGVsZW1lbnROYW1lICYmIGVsZW1lbnROYW1lICE9PSBjaGlsZC5ub2RlTmFtZSl7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoJCSAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoYXR0cmlidXRlTmFtZSAmJiAhWG1sVXRpbC5nZXRBdHRyaWJ1dGUoY2hpbGQsIGF0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZU5hbWVzcGFjZSkpewogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoYXR0cmlidXRlVmFsdWUpewogICAgICAgICAgICAgICAgICAgICAgICBpZihhdHRyaWJ1dGVOYW1lKXsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihhdHRyaWJ1dGVWYWx1ZSAhPT0gWG1sVXRpbC5nZXRBdHRyaWJ1dGUoY2hpbGQsIGF0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZU5hbWVzcGFjZSkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIGF0dHJpYnV0ZU5hbWUgaXMgbm90IGRlZmluZWQsIHdlIGNoZWNrIGFnYWluc3QgYWxsIGF0dHJpYnV0ZSB2YWx1ZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmb3VuZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKCB2YXIgaiA9IDA7IGogPCBjaGlsZC5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrICl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9pZihhdHRyaWJ1dGVWYWx1ZSA9PT0gY2hpbGQuYXR0cmlidXRlc1tqXS5ub2RlVmFsdWUpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGF0dHJpYnV0ZVZhbHVlID09PSBjaGlsZC5hdHRyaWJ1dGVzLml0ZW0oaikubm9kZVZhbHVlKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighZm91bmQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLnB1c2goY2hpbGQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vTG9nLnRyYWNlKCJYbWxVdGlsLmdldENoaWxkRWxlbWVudHMsIHJldHVybmluZyBlbGVtZW50cyAiLCBlbGVtZW50cyk7CiAgICAgICAgICAgIHJldHVybiBlbGVtZW50czsKLy8gICAgICAgIH0gZmluYWxseSB7Ci8vICAgICAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBYbWxVdGlsLmdldENoaWxkRWxlbWVudHMiICk7Ci8vICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAgICogR2V0IHRoZSB0ZXh0IGZyb20gYSBub2RlLgogICAgICogSWYgdGhlIG5vZGUgaXMgYSB0ZXh0IG5vZGUgaXRzIHZhbHVlIHdpbGwgYmUgcmV0dXJuZWQuIAogICAgICogSWYgbm9kZSBpcyBhbiBlbGVtZW50IG5vZGUsIGl0ZXJhdGUgdGhyb3VnaCBmaXJzdCBsZXZlbCBjaGlsZHJlbiBhbmQgbG9vayBmb3IgdGV4dCBub2RlLgogICAgICogQ29uY2F0ZW5hdGUgc3RyaW5ncyBpZiB0aGUgbm9kZSBoYXMgbXVsdGlwbGUgdGV4dCBub2RlIGNoaWxkcmVuCiAgICAgKgogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgWG1sVXRpbC5nZXRUZXh0CiAgICAgKiBAc3ludGF4IFhtbFV0aWwuZ2V0VGV4dChub2RlKQogICAgICogQHBhcmFtIHtOb2RlfSBub2RlIGRvY3VtZW50IG9yIG5vZGUgdG8gZ2V0IHRleHQgZnJvbQogICAgICogQHJldHVybiB7U3RyaW5nfSBUaGUgbm9kZSB0ZXh0IG9yICcnIGlmIG5vZGUgaGFzIG5vIHRleHQKICAgICAqIEBleGFtcGxlCiAgICAgKiB2YXIgZG9jdW1lbnQgPSBYbWxVdGlsLmZyb21TdHJpbmcoIjxyb290PmhlbGxvPGNoaWxkPnRleHQ8L2NoaWxkPndvcmxkPC9yb290PiIpOwogICAgICogdmFyIHRleHQgPSBYbWxVdGlsLmdldFRleHQoZG9jdW1lbnQpOwogICAgICogLy8gcmV0dXJucyAnaGVsbG93b3JsZCcKICAgICAqIHZhciBjaGlsZCA9IFhQYXRoLnNlbGVjdE5vZGUoIi9yb290L2NoaWxkIiwgZG9jdW1lbnQpOwogICAgICogdmFyIHRleHQgPSBYbWxVdGlsLmdldFRleHQoY2hpbGQpOwogICAgICogLy8gcmV0dXJucyAndGV4dCcKICAgICAqLwogICAgdGhhdC5nZXRUZXh0ID0gZnVuY3Rpb24oIG5vZGUgKSB7Ci8vICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZyBYbWxVdGlsLmdldFRleHQiICk7Ci8vICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBTdXBwb3J0IGJvdGggZG9jdW1lbnRzIGFuZCBub2RlcyBhcyBkZXN0aW5hdGlvbgogICAgICAgICAgICB2YXIgYWN0dWFsTm9kZSA9IFhtbFV0aWwuX19nZXRBY3R1YWxOb2RlKG5vZGUpOwogICAgICAgICAgICB2YXIgdGV4dCA9ICIiOwoKICAgICAgICAgICAgaWYgKGFjdHVhbE5vZGUubm9kZVR5cGUgPT0gTm9kZVR5cGVzLlRFWFRfTk9ERSB8fCBhY3R1YWxOb2RlLm5vZGVUeXBlID09IE5vZGVUeXBlcy5DREFUQV9TRUNUSU9OX05PREUpIHsKICAgICAgICAgICAgICAgIHRleHQgPSBhY3R1YWxOb2RlLm5vZGVWYWx1ZTsKICAgICAgICAgICAgfSBlbHNlIGlmIChhY3R1YWxOb2RlLmNoaWxkTm9kZXMpewogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAgOyBpIDwgYWN0dWFsTm9kZS5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNoaWxkID0gYWN0dWFsTm9kZS5jaGlsZE5vZGVzLml0ZW0oaSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLm5vZGVUeXBlID09IE5vZGVUeXBlcy5URVhUX05PREUgfHwgY2hpbGQubm9kZVR5cGUgPT0gTm9kZVR5cGVzLkNEQVRBX1NFQ1RJT05fTk9ERSkgewogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ICs9IGNoaWxkLm5vZGVWYWx1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgTG9nLnRyYWNlKCAiWG1sVXRpbC5nZXRUZXh0LCByZXR1cm5pbmcgJyIsIHRleHQsICInIiApOwogICAgICAgICAgICByZXR1cm4gdGV4dDsKLy8gICAgICAgIH0gZmluYWxseSB7Ci8vICAgICAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBYbWxVdGlsLmdldFRleHQiICk7Ci8vICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAgICogQXBwZW5kIGEgdGV4dCBub2RlIHRvIGFuIGV4aXN0aW5nIG5vZGUuIElmIG5vZGUgYWxyZWFkeSBoYXMgYSB0ZXh0IG5vZGUsIGFwcGVuZCB0ZXh0IHRvIHRoZSBleGlzdGluZyB0ZXh0LAogICAgICogdW5sZXNzIG92ZXJ3cml0ZSBmbGFnIGlzIHNldAogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhtbFV0aWwuYXBwZW5kVGV4dAogICAgICogQHN5bnRheCBYbWxVdGlsLmFwcGVuZFRleHQobm9kZSwgdmFsdWUpCiAgICAgKiBAcGFyYW0ge05vZGV9IG5vZGUgcGFyZW50IG9mIG5ldyB0ZXh0IG5vZGUKICAgICAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZSBzdHJpbmcgdmFsdWUgdG8gaW5zZXJ0IGluIHRleHQgbm9kZQogICAgICogQHBhcmFtIHtib29sZWFufHVuZGVmaW5lZH0gb3ZlcndyaXRlIG92ZXJ3cml0ZXMgZXhpc3RpbmcgdmFsdWUgaW4gc3RlYWQgb2YgYXBwcGVuZGluZyBpZiB0cnVlLCBhcHBlbmRzIGlmIGZhbHNlIG9yIHVuZGVmaW5lZCAob3B0aW9uYWwpCiAgICAgKiBAcmV0dXJuIHtFbGVtZW50fSBYTUxET00gVGV4dCBub2RlIHRoYXQgd2FzIGNyZWF0ZWQgb3IgYXBwcGVuZGVkIHRvCiAgICAgKiBAZXhhbXBsZQogICAgICogdmFyIHRleHQgPSBYbWxVdGlsLmFwcGVuZFRleHQobm9kZSwgInNvbWUgdmFsdWUiKTsKICAgICAqIExvZy5kZWJ1ZygidGV4dCBpcyBub3c6IiwgdGV4dC5ub2RlVmFsdWUpOwogICAgICovCiAgICB0aGF0LmFwcGVuZFRleHQgPSBmdW5jdGlvbiggbm9kZSwgdmFsdWUsIG92ZXJ3cml0ZSApIHsKLy8gICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIFhtbFV0aWwuYXBwZW5kVGV4dCIgKTsKLy8gICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIFN1cHBvcnQgYm90aCBkb2N1bWVudHMgYW5kIG5vZGVzIGFzIGRlc3RpbmF0aW9uCiAgICAgICAgICAgIHZhciBhY3R1YWxOb2RlID0gWG1sVXRpbC5fX2dldEFjdHVhbE5vZGUobm9kZSk7CiAgICAgICAgICAgIHZhciB0ZXh0ID0gWFBhdGguc2VsZWN0Tm9kZSgidGV4dCgpIiwgYWN0dWFsTm9kZSk7CiAgICAgICAgICAgIGlmICh0ZXh0ICYmIG92ZXJ3cml0ZSkgewogICAgICAgICAgICAgICAgTG9nLmRlYnVnKCJYbWxVdGlsLmFwcGVuZFRleHQsIFJlcGxhY2luZyAnIiwgdGV4dC5ub2RlVmFsdWUsICInIHdpdGggJyIsIHZhbHVlLCAiJyBvbiBub2RlICciLCBhY3R1YWxOb2RlLm5vZGVOYW1lLCAiJyIpOwogICAgICAgICAgICAgICAgdGV4dC5ub2RlVmFsdWUgPSB2YWx1ZS50b1N0cmluZygpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgTG9nLmRlYnVnKCJYbWxVdGlsLmFwcGVuZFRleHQsIGNyZWF0aW5nIHRleHQgJyIsIHZhbHVlLCAiJyBvbiBub2RlICciLCBhY3R1YWxOb2RlLm5vZGVOYW1lLCAiJyIpOwogICAgICAgICAgICAgICAgdmFyIGRvY3VtZW50ID0gYWN0dWFsTm9kZS5vd25lckRvY3VtZW50OwogICAgICAgICAgICAgICAgdmFyIHRleHQgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh2YWx1ZSk7CiAgICAgICAgICAgICAgICBhY3R1YWxOb2RlLmFwcGVuZENoaWxkKHRleHQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0ZXh0OwovLyAgICAgICAgfSBmaW5hbGx5IHsKLy8gICAgICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIFhtbFV0aWwuYXBwZW5kVGV4dCIgKTsKLy8gICAgICAgIH0KICAgIH07CgogICAgLyoqCiAgICAgKiBHZXQgYW4gYXR0cmlidXRlIGZvciBhIG5vZGUKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLmdldEF0dHJpYnV0ZQogICAgICogQHN5bnRheCBYbWxVdGlsLmdldEF0dHJpYnV0ZShub2RlLCBhdHRyaWJ1dGVOYW1lLCBhdHRyaWJ1dGVOYW1lc3BhY2UpCiAgICAgKiBAcGFyYW0ge05vZGV9IG5vZGUgRG9jdW1lbnQgb3IgZWxlbWVudCB0byBnZXQgYXR0cmlidXRlIGZyb20KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBhdHRyaWJ1dGVOYW1lIGF0dHJpYnV0ZSBuYW1lCiAgICAgKiBAcGFyYW0ge05hbWVzcGFjZXx1bmRlZmluZWR9IGF0dHJpYnV0ZU5hbWVzcGFjZSBvcHRpb25hbCBuYW1lc3BhY2UgZm9yIGF0dHJpYnV0ZQogICAgICogQHJldHVybiB7U3RyaW5nfFVuZGVmaW5lZH0gVmFsdWUgb2YgYXR0cmlidXRlIChtYXkgYmUgZW1wdHkpIG9yIHVuZGVmaW5lZCBpbiBub2RlcyBkb2VzIG5vdCBoYXZlIHRoZSBhdHRyaWJ1dGUKICAgICAqIEBleGFtcGxlCmRvY3VtZW50ID0gWG1sVXRpbC5mcm9tU3RyaW5nKCc8cm9vdCB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiBmb289ImJhciIvPicpOwpYbWxVdGlsLmdldEF0dHJpYnV0ZShkb2N1bWVudCwgInhzaSIsIFhtbE5hbWVzcGFjZXMueG1sbnMpOwpYbWxVdGlsLmdldEF0dHJpYnV0ZShkb2N1bWVudCwgImZvbyIpOwogICAgICovCiAgICB0aGF0LmdldEF0dHJpYnV0ZSA9IGZ1bmN0aW9uKCBub2RlLCBhdHRyaWJ1dGVOYW1lLCBhdHRyaWJ1dGVOYW1lc3BhY2UpIHsKLy8gICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIFhtbFV0aWwuZ2V0QXR0cmlidXRlIiApOwovLyAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gU3VwcG9ydCBib3RoIGRvY3VtZW50cyBhbmQgbm9kZXMgYXMgZGVzdGluYXRpb24KICAgICAgICAgICAgdmFyIGFjdHVhbE5vZGUgPSBYbWxVdGlsLl9fZ2V0QWN0dWFsTm9kZShub2RlKTsKICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZU5hbWVzcGFjZSkgewogICAgICAgICAgICAgICAgTG9nLmRlYnVnKCJYbWxVdGlsLmdldEF0dHJpYnV0ZSwgR2V0dGluZyBhdHRyaWJ1dGUgJyIsIGF0dHJpYnV0ZU5hbWUsICInIHdpdGggbmFtZXNwYWNlICIsIGF0dHJpYnV0ZU5hbWVzcGFjZS5wcmVmaXgpOwogICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IGFjdHVhbE5vZGUuYXR0cmlidXRlcy5nZXROYW1lZEl0ZW1OUyhhdHRyaWJ1dGVOYW1lc3BhY2UudXJpLCBhdHRyaWJ1dGVOYW1lKTsKICAgICAgICAgICAgICAgIGlmIChhdHRyaWJ1dGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXR0cmlidXRlLm5vZGVWYWx1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIExvZy5kZWJ1ZygiWG1sVXRpbC5nZXRBdHRyaWJ1dGUsIEdldHRpbmcgYXR0cmlidXRlICciLCBhdHRyaWJ1dGVOYW1lLCAiJyIpOwogICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IGFjdHVhbE5vZGUuYXR0cmlidXRlcy5nZXROYW1lZEl0ZW0oYXR0cmlidXRlTmFtZSk7CiAgICAgICAgICAgICAgICBpZiAoYXR0cmlidXRlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZS5ub2RlVmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KLy8gICAgICAgIH0gZmluYWxseSB7Ci8vICAgICAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBYbWxVdGlsLmdldEF0dHJpYnV0ZSIgKTsKLy8gICAgICAgIH0KICAgIH07CgogICAgLyoqCiAgICAgKiBTZXQgYW4gYXR0cmlidXRlIGZvciBhIG5vZGUKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLnNldEF0dHJpYnV0ZQogICAgICogQHN5bnRheCBYbWxVdGlsLnNldEF0dHJpYnV0ZShub2RlLCBhdHRyaWJ1dGVOYW1lLCBhdHRyaWJ1dGVWYWx1ZSwgYXR0cmlidXRlTmFtZXNwYWNlKQogICAgICogQHBhcmFtIHtOb2RlfSBub2RlIERvY3VtZW50IHRvIGFkZCBhdHRyaWJ1dGUgbmFtZSBmb3IKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBhdHRyaWJ1dGVOYW1lIGF0dHJpYnV0ZSBuYW1lCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gYXR0cmlidXRlVmFsdWUgYXR0cmlidXRlIHZhbHVlCiAgICAgKiBAcGFyYW0ge05hbWVzcGFjZXx1bmRlZmluZWR9IGF0dHJpYnV0ZU5hbWVzcGFjZSBvcHRpb25hbCBuYW1lc3BhY2UgZm9yIGF0dHJpYnV0ZQoKICAgICAqIEBleGFtcGxlCiAgICAgKiBkb2N1bWVudCA9IFhtbFV0aWwuZnJvbVN0cmluZygiPHJvb3QvPiIpOwogICAgICogdmFyIGVsZW1lbnQgPSBYbWxVdGlsLmNyZWF0ZUVsZW1lbnQoZG9jdW1lbnQsICJjaGlsZCIpOwogICAgICogLy8gV2l0aG91dCBuYW1lc3BhY2UsIHByb2R1Y2VzIDxyb290PjxjaGlsZCBhdHRyPSJ2YWx1ZSIvPjwvcm9vdD4KICAgICAqIFhtbFV0aWwuc2V0QXR0cmlidXRlKGVsZW1lbnQsICJhdHRyIiwgInZhbHVlIik7CiAgICAgKgogICAgICogLy8gd2l0aCBuYW1lc3BhY2UsIHByb2R1Y2VzIDxyb290PjxjaGlsZCBkYzpjcmVhdG9yPSJtZSIvPjwvcm9vdD4KICAgICAqIFhtbFV0aWwuc2V0QXR0cmlidXRlKGVsZW1lbnQsICJjcmVhdG9yIiwgIm1lIiwgWG1sTmFtZXNwYWNlcy5kYyk7CiAgICAgKi8KICAgIHRoYXQuc2V0QXR0cmlidXRlID0gZnVuY3Rpb24oIG5vZGUsIGF0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZVZhbHVlLCBhdHRyaWJ1dGVOYW1lc3BhY2UpIHsKLy8gICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIFhtbFV0aWwuc2V0QXR0cmlidXRlIiApOwovLyAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdmFyIGFjdHVhbE5vZGUgPSBYbWxVdGlsLl9fZ2V0QWN0dWFsTm9kZShub2RlKTsKICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZU5hbWVzcGFjZSkgewogICAgICAgICAgICAgICAgTG9nLnRyYWNlKCJTZXR0aW5nIGF0dHJpYnV0ZSAnIiwgYXR0cmlidXRlTmFtZSwgIic9JyIsIGF0dHJpYnV0ZVZhbHVlLCAiJyB3aXRoIG5hbWVzcGFjZSAiLCBhdHRyaWJ1dGVOYW1lc3BhY2UucHJlZml4KTsKICAgICAgICAgICAgICAgIGlmICggYXR0cmlidXRlTmFtZXNwYWNlICE9PSBYbWxOYW1lc3BhY2VzLnhtbG5zICYmICFYbWxVdGlsLmlzTmFtZXNwYWNlRGVmaW5lZChhY3R1YWxOb2RlLCBhdHRyaWJ1dGVOYW1lc3BhY2UpKSB7CiAgICAgICAgICAgICAgICAgICAgWG1sVXRpbC5hZGROYW1lc3BhY2UoYWN0dWFsTm9kZSwgYXR0cmlidXRlTmFtZXNwYWNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGFjdHVhbE5vZGUuc2V0QXR0cmlidXRlTlMoYXR0cmlidXRlTmFtZXNwYWNlLnVyaSwgYXR0cmlidXRlTmFtZXNwYWNlLnByZWZpeCArICI6IiArIGF0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZVZhbHVlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIExvZy50cmFjZSgiU2V0dGluZyBhdHRyaWJ1dGUgJyIsIGF0dHJpYnV0ZU5hbWUsICInPSciLCBhdHRyaWJ1dGVWYWx1ZSwgIiciKTsKICAgICAgICAgICAgICAgIGFjdHVhbE5vZGUuc2V0QXR0cmlidXRlKGF0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZVZhbHVlKTsKICAgICAgICAgICAgfQovLyAgICAgICAgfSBmaW5hbGx5IHsKLy8gICAgICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIFhtbFV0aWwuc2V0QXR0cmlidXRlIiApOwovLyAgICAgICAgfQogICAgfTsKICAgIAogICAgICAgCiAgICAvKioKICAgICAqIERlbGV0ZXMgdGhlIGNvcnJlc3BvbmRpbmcgbm9kZQogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhtbFV0aWwuZGVsZXRlTm9kZQogICAgICogQHN5bnRheCBYbWxVdGlsLmRlbGV0ZU5vZGUoeG1sTm9kZSkKICAgICAqIEBwYXJhbSB7Tm9kZX0geG1sTm9kZQogICAgICogQGV4YW1wbGUKICAgICAqIHZhciB4bWxOb2RlID0gWG1sVXRpbC5mcm9tU3RyaW5nKCI8cm9vdD48Y2hpbGQ+PC9jaGlsZD48L3Jvb3Q+IikKICAgICAqIFhtbFV0aWwuZGVsZXRlTm9kZShYbWxVdGlsLnNlbGVjdE5vZGUoIi9yb290L2NoaWxkIiwgeG1sTm9kZSkpOwogICAgICogeG1sTm9kZS50b1N0cmluZygpIC8vICI8cm9vdC8+IgogICAgICovCiAgICB0aGF0LmRlbGV0ZU5vZGUgPSBmdW5jdGlvbih4bWxOb2RlKXsKICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZyBYbWxVdGlsLmRlbGV0ZU5vZGUsIG5vZGU6ICIsIFhtbFV0aWwubG9nWG1sU3RyaW5nKCB4bWxOb2RlICkgKTsKICAgICAgICB4bWxOb2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoeG1sTm9kZSk7Ci8vICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIFhtbFV0aWwuZGVsZXRlTm9kZSIpOwogICAgfTsKCiAgICAvKioKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLmlzWG1sCiAgICAgKiBAcGFyYW0gcG9zc2libGVYbWwgSmF2YVNjcmlwdCBPYmplY3QKICAgICAqIEByZXR1cm4ge2Jvb2xlYW59IHJldHVybiBpZiBUaGUgdmFyaWFibGUgaXMgYSB4bWxFbGVtZW50CiAgICAgKi8KICAgIHRoYXQuaXNYbWwgPSBmdW5jdGlvbihwb3NzaWJsZVhtbCkgewogICAgICAgIHJldHVybiBwb3NzaWJsZVhtbC5ub2RlVHlwZSAhPT0gdW5kZWZpbmVkICYmICh0eXBlb2YgcG9zc2libGVYbWwubm9kZVR5cGUpID09PSAibnVtYmVyIjsKICAgIH07CgogICAgLyoqCiAgICAgKiBQcmV0dHkgcHJpbnQgYW4gWE1MIGRvY3VtZW50L3NuaXBwZXQsIHdpdGggcmVzdHJpY3Rpb25zLgogICAgICoKICAgICAqIFRoaXMgbWV0aG9kIHRha2VzIGFuZCBYTUwgb2JqZWN0IChub3QgWE1MTGlzdCkgYW5kIHByb2R1Y2VzIGEgc3RyaW5nCiAgICAgKiByZXByZXNlbnRpbmcgdGhlIG9iamVjdCB0aGF0IGlzIHN1aXRlZCBmb3IgZS5nLiB1c2Ugd2l0aCBkaWZmIAogICAgICogCiAgICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgc2xvdyEgQ29tcGFyZWQgdG8gdGhlIGJ1aWx0aW4gdG9YTUxTdHJpbmcsCiAgICAgKiB0aGUgbWV0aG9kIGlzIDEwLTMwIHRpbWVzIGFzIHNsb3cuIEl0IHNob3VsZCBub3QgYmUgdXNlZCBmb3IKICAgICAqIHByb2dyYW1zIHRoYXQgbmVlZHMgdG8gcnVuIHF1aWNrbHkuIEFsc286IFRoZSBvdXRwdXQgc3RyaW5nIG1heQogICAgICogbm90IGFsd2F5cyByZXByZXNlbnQgdGhlIGV4YWN0IFhNTCBpbnB1dDogSW5zaWduaWZpY2FudAogICAgICogd2hpdGVzcGFjZSBjYW4gYmUgaW50cm9kdWNlZCBiZXR3ZWVuIGVsZW1lbnRzLCBidXQgbm90ICppbioKICAgICAqIHRleHQgZWxlbWVudHMuIENvbnRhaW5zIG5vIHN1cHBvcnQgZm9yIG91dHB1dHRpbmcgQ0RBVEEsCiAgICAgKiB0b3BsZXZlbC1jb21tZW50cyBvciBwcmVwcm9jZXNzaW5nIG5vZGVzLCBhcyB0aGVyZSBpcyBubyBrbm93biB3YXkgdG8KICAgICAqIGdldCB0aGVzZSBub2RlcyBpbnRvIHRoZSBYTUwgb2JqZWN0LiBPbmx5IHRoZSBjb250cm9sCiAgICAgKiBjaGFyYWN0ZXJzIG9mIHhtbCAxLjAgYXJlIHN1cHBvcnRlZCAoeDksIHhBLCB4RCkuCiAgICAgKgogICAgICogQHN5bnRheCBYbWxVdGlsLnByZXR0eVByaW50KCB4bWwsIG9wdGlvbnMgKQogICAgICogQHBhcmFtIHtOb2RlfSB4bWwgQW4geG1sIGRvY3VtZW50L2VsZW1lbnQgdG8gcHJldHR5IHByaW50CiAgICAgKiBAcGFyYW0gb3B0aW9ucyBPYmplY3Qgd2l0aCBvcHRpb25zIGZvciB0aGUgY3JlYXRpb24gb2YgdGhlIFhNTCBzdHJpbmcgcmVwcmVzZW50YXRpb24uCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLnNvcnRBdHRyaWJ1dGVzPXRydWVdIElmIHRydWUsIHRoZSBhdHRyaWJ1dGVzIHdpbGwgYmUgc29ydGVkIHdoZW4gb3V0cHV0CiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLmRpZmZJbXByb3ZlPXRydWVdIElmIHRydWUsIG91dHB1dCB3aWxsIGJlIGJldHRlciBzdWl0ZWQgZm9yIGRpZmYgKGF0dHJpYnV0ZXMgYW5kIG5hbWVzcGFjZXMgb24gc2luZ2xlIGxpbmVzKS4KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5pbmRlbnRMZXZlbD0yXSBMZXZlbCBvZiBpbmRlbnQgZm9yIGVhY2ggWE1MIGxldmVsCiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IEEgc3RyaW5nIHdpdGggYSByZXByZXNlbnRhdGlvbiBvZiB0aGUgWE1MIChzZWUgbm90ZSkKICAgICAqIEBleGFtcGxlCi8vIFRoaXMgZXhhbXBsZSwgZnJvbSB1c2luZyBhIEphdmFTY3JpcHQgc2hlbGwsIGRlbW9uc3RyYXRlcyB0aGUgZm9ybWF0dGluZyBvZiBhIHNpbXBsZSBYTUwgZG9jdW1lbnQKanM+IFhtbFV0aWwucHJldHR5UHJpbnQoIFhtbFV0aWwuZnJvbVN0cmluZygiPHJvb3QgYT0nYWF0JyAgIGM9J2NhdCcgYj0nYmF0Jz48Zm9vIGZvb2FhdD0nZm9vYWF0YXQnICBmb29iYXQ9J2Zvb2JhdGF0Jz5iYXI8L2Zvbz48L3Jvb3Q+IiksIHsgZGlmZkltcHJvdmUgOiB0cnVlIH0gKTsKPHJvb3QKICAgIGE9ImFhdCIKICAgIGI9ImJhdCIKICAgIGM9ImNhdCI+CiAgPGZvbwogICAgICBmb29hYXQ9ImZvb2FhdGF0IgogICAgICBmb29iYXQ9ImZvb2JhdGF0Ij5iYXI8L2Zvbz4KPC9yb290PgogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgWG1sVXRpbC5wcmV0dHlQcmludCAqLwogICAgdGhhdC5wcmV0dHlQcmludCA9IGZ1bmN0aW9uKCB4bWwsIG9wdGlvbnMgKSB7CiAgICAgICAgLy8gTm90ZTogVGVjaG5pY2FsbHkgdGhpcyBzaG91bGQgYmUgYSByZWltcGxlbWVudGF0aW9uIG9mIHRvWE1MU3RyaW5nIGZyb20gdGhlIEVDTUEgc3RhbmRhcmQsCiAgICAgICAgLy8gcHAgMTAuMi4xLCBidXQgdGhhdCB3YXMganVzdCB0b28gY3JhenksIHNvIEkgZGlkIHRoaXMgaW5zdGVhZC4gCiAgICAgICAgLy8gTm9ybWFsIHRvWE1MU3RyaW5nIGNhbiBpbnNlcnQgbm9uLXNpZ25pZmljYW50IHdoaXRlc3BhY2UgaW4gdGV4dCBlbGVtZW50cywgYW5kIGJldHdlZW4gZWxlbWVudHMuCiAgICAgICAgLy8gVGhpcyBpbXBsZW1lbnRhdGlvbiBvbmx5IGluc2VydHMgd2hpdGVzcGFjZSBiZXR3ZWVuIGVsZW1lbnRzLCBub3QgKmluKiBlbGVtZW50cy4KICAgICAgICAvLyBOb3RlOiBUaGUgdXNlIG9mIGEgYnVmZmVyIHRvIGNvbGxlY3QgZ2VuZXJhdGVkIHN0cmluZ3MgaW4sIGlzIGludGVudGlvbmFsIGFuZCBkdWUgdG8gKHJlYWwpIHBlcmZvcm1hbmNlIGlzc3VlcyAKICAgICAgICAvLyBpbiBzdHJpbmcgY29uY2F0ZW5hdGlvbi4KICAgICAgICBMb2cudHJhY2UoICItPlhtbFV0aWwucHJldHR5UHJpbnQiICk7CiAgICAgICAgLy8gU2V0IHVwIGRlZmF1bHQgb3B0aW9ucwogICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICAgIGlmICggb3B0aW9ucy5zb3J0QXR0cmlidXRlcyA9PT0gdW5kZWZpbmVkICkgewogICAgICAgICAgICBvcHRpb25zLnNvcnRBdHRyaWJ1dGVzID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgb3B0aW9ucy5kaWZmSW1wcm92ZSA9IG9wdGlvbnMuZGlmZkltcHJvdmUgfHwgZmFsc2U7CiAgICAgICAgaWYgKCBvcHRpb25zLmRpZmZJbXByb3ZlICkgewogICAgICAgICAgICBvcHRpb25zLnNvcnRBdHRyaWJ1dGVzID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgb3B0aW9ucy5pbmRlbnRMZXZlbCA9IG9wdGlvbnMuaW5kZW50TGV2ZWwgfHwgMjsKCiAgICAgICAgdmFyIG5ld0xpbmU9IlxuIjsKICAgICAgICBpZiggb3B0aW9ucy5ub05ld0xpbmVzICE9PSB1bmRlZmluZWQgKSB7CiAgICAgICAgICAgIG5ld0xpbmU9IiI7CiAgICAgICAgICAgIG9wdGlvbnMuaW5kZW50TGV2ZWw9MDsKICAgICAgICB9CgogICAgICAgIExvZy5kZWJ1ZyggImRpZmZJbXByb3ZlOiAiICsgb3B0aW9ucy5kaWZmSW1wcm92ZS50b1N0cmluZyggKSArICIsIHNvcnRBdHRyaWJ1dGVzOiAiICsgb3B0aW9ucy5zb3J0QXR0cmlidXRlcy50b1N0cmluZyggKSArCiAgICAgICAgICAgICIsIGluZGVudExldmVsOiAiICsgb3B0aW9ucy5pbmRlbnRMZXZlbC50b1N0cmluZyggKSApOwoKCiAgICAgICAgLy8gRml4IGluZGVudHByZWZpeCAtIGFkZCBvbmUgYmVjYXVzZSBqb2luIGlzICJpbi1iZXR3ZWVuIi4KICAgICAgICB2YXIgaW5kZW50UHJlZml4ID0gbmV3IEFycmF5KCBvcHRpb25zLmluZGVudExldmVsICsgMSApLmpvaW4oICIgIiApOyAvLyBuZXcgQXJyYXkgT0sKCiAgICAgICAgLy8gVGhpcyBpcyBhICJmdW5jdGlvbiBnbG9iYWwiIGJ1ZmZlciB0aGF0IGlzIHVzZWQgdG8gY29sbGVjdCB0aGUgCiAgICAgICAgLy8gcmVzdWx0IGluLiBUaGUgaWRlYSBpcyB0byByZWR1Y2UgdGhlIG51bWJlciBvZiBzdHJpbmcgb3BlcmF0aW9ucwogICAgICAgIHZhciBidWZmZXIgPSBbIF07CgogICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgIC8vIEVzY2FwZXMgc29tZSBrZXkgY2hhcnMuCiAgICAgICAgLy8gTGlmdGVkIGZyb20gYSBnaXN0LCBubyBsaWNlbnNlLgogICAgICAgIC8vIE5COiBBZGp1c3RlZCB0byB3b3JrIGFsbW9zdCBhY2NvcmRpbmcgdG8gRUNNQQogICAgICAgIC8vIDEwLjIuMS4xIDogRXNjYXBlRWxlbWVudFZhbHVlCiAgICAgICAgLy8gMTAuMi4xLjIgOiBFc2NhcGVBdHRyaWJ1dGVWYWx1ZQogICAgICAgIHZhciBYTUxfQ0hBUl9NQVAgPSB7CiAgICAgICAgICAgICc8JzogJyZsdDsnLAogICAgICAgICAgICAnPic6ICcmZ3Q7JywKICAgICAgICAgICAgJyYnOiAnJmFtcDsnLAogICAgICAgICAgICAnIic6ICcmcXVvdDsnLAogICAgICAgICAgICAiJyI6ICcmYXBvczsnLAogICAgICAgICAgICAiXHUwMDBBIjogIiYjeEE7IiwKICAgICAgICAgICAgIlx1MDAwRCI6ICImI3hEOyIsCiAgICAgICAgICAgICJcdTAwMDkiOiAiJiN4OTsiLAogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIGVzY2FwZVhtbCggcyApIHsKICAgICAgICAgICAgcmV0dXJuIHMucmVwbGFjZSggL1s8PiZcIlwnXHJcdFxuXS9nLCBmdW5jdGlvbiggY2ggKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFhNTF9DSEFSX01BUFsgY2ggXTsKICAgICAgICAgICAgICAgIH0gKTsKICAgICAgICB9OwoKICAgICAgICB2YXIgZ2V0TmFtZXNwYWNlcyA9IGZ1bmN0aW9uKCB4bWwgKXsKICAgICAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmcgWG1sVXRpbC5nZXROYW1lc3BhY2VzIiApOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFyIG5hbWVzcGFjZXMgPSBbXTsKICAgICAgICAgICAgICAgIGlmICggeG1sLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuRUxFTUVOVF9OT0RFICkgewogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgeG1sLmF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoeG1sLmF0dHJpYnV0ZXMuaXRlbShpKS5ub2RlVHlwZSA9PT0gTm9kZVR5cGVzLkFUVFJJQlVURV9OT0RFKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHhtbC5hdHRyaWJ1dGVzLml0ZW0oaSkubmFtZS5pbmRleE9mKCJ4bWxucyIpID09PSAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lc3BhY2VzLnB1c2goeG1sLmF0dHJpYnV0ZXMuaXRlbShpKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nLmRlYnVnKCJmb3VuZCBuYW1lc3BhY2UiLCB4bWwuYXR0cmlidXRlcy5pdGVtKGkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBuYW1lc3BhY2VzOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBYbWxVdGlsLmdldE5hbWVzcGFjZXMiICk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHZhciBnZXRBdHRyaWJ1dGVzID0gZnVuY3Rpb24oIHhtbCApewogICAgICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZyBYbWxVdGlsLmdldEF0dHJpYnV0ZXMiICk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlcyA9IFtdOwogICAgICAgICAgICAgICAgaWYgKCB4bWwubm9kZVR5cGUgPT09IE5vZGVUeXBlcy5FTEVNRU5UX05PREUgKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG5vZGVBdHRyaWJ1dGVzPXhtbC5hdHRyaWJ1dGVzOwogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZUF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZT1ub2RlQXR0cmlidXRlcy5pdGVtKGkpOwogICAgICAgICAgICAgICAgICAgICAgICBpZihhdHRyaWJ1dGUubm9kZVR5cGUgPT09IE5vZGVUeXBlcy5BVFRSSUJVVEVfTk9ERSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihhdHRyaWJ1dGUubmFtZS5pbmRleE9mKCJ4bWxucyIpICE9PSAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzLnB1c2goYXR0cmlidXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cuZGVidWcoImZvdW5kIGF0dHJpYnV0ZSIsIGF0dHJpYnV0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYXR0cmlidXRlczsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIExvZy50cmFjZSggIkxlYXZpbmcgWG1sVXRpbC5nZXRBdHRyaWJ1dGVzIiApOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyBGb3JtYXQgYSBzaW5nbGUgbmFtZXNwYWNlCiAgICAgICAgdmFyIGZvcm1hdE5hbWVzcGFjZSA9IGZ1bmN0aW9uKCBuYW1lc3BhY2UgKSB7CiAgICAgICAgICAgIExvZy50cmFjZSgiZm9ybWF0IG5hbWVzcGFjZSIsbmFtZXNwYWNlKTsKICAgICAgICAgICAgdmFyIG5hbWUgPSBuYW1lc3BhY2UubG9jYWxOYW1lOwogICAgICAgICAgICBpZiAobmFtZSA9PSAieG1sbnMiKXsKICAgICAgICAgICAgICAgIG5hbWUgPSAiIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIG5hbWUgIT0gIiIgKSB7CiAgICAgICAgICAgICAgICBuYW1lID0gIjoiICsgbmFtZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgcmVzID0gWyBdOwogICAgICAgICAgICByZXMucHVzaCggInhtbG5zIiApOwogICAgICAgICAgICByZXMucHVzaCggbmFtZSApOwogICAgICAgICAgICByZXMucHVzaCggJz0iJyApOwogICAgICAgICAgICByZXMucHVzaCggZXNjYXBlWG1sKCBuYW1lc3BhY2UudmFsdWUgKSApOwogICAgICAgICAgICByZXMucHVzaCggJyInICk7CiAgICAgICAgICAgIHJldHVybiByZXMuam9pbiggIiIgKTsKICAgICAgICB9OwoKICAgICAgICAvLyBGb3JtYXQgYWxsIHRoZSBhdmFpbGFibGUgbmFtZXNwYWNlcyBmb3IgYSBwYXJ0aWN1bGFyIG5vZGUuLi4KICAgICAgICB2YXIgZm9ybWF0TmFtZXNwYWNlcyA9IGZ1bmN0aW9uKCB4bWwsIGxldmVsICkgewogICAgICAgICAgICB2YXIgbmFtZXNwYWNlcyA9IGdldE5hbWVzcGFjZXMoeG1sKTsKICAgICAgICAgICAgaWYgKCBuYW1lc3BhY2VzLmxlbmd0aCA9PSAwICkgewogICAgICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggb3B0aW9ucy5zb3J0QXR0cmlidXRlcyApIHsKICAgICAgICAgICAgICAgIG5hbWVzcGFjZXMuc29ydCggZnVuY3Rpb24oIGEsIGIgKSB7ICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGEubG9jYWxOYW1lID09PSAieG1sbnMiKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZihiLmxvY2FsTmFtZSA9PT0gInhtbG5zIil7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5sb2NhbE5hbWUubG9jYWxlQ29tcGFyZShiLmxvY2FsTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgfSApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciByZXMgPSBbIF07CiAgICAgICAgICAgIHZhciBuZXdsaW5lID0gIiI7CiAgICAgICAgICAgIHZhciBpbmRlbnQgPSAiICI7CiAgICAgICAgICAgIGlmICggb3B0aW9ucy5kaWZmSW1wcm92ZSAmJiBuYW1lc3BhY2VzLmxlbmd0aCA+IDEgKSB7CiAgICAgICAgICAgICAgICBuZXdsaW5lID0gIlxuIjsKICAgICAgICAgICAgICAgIGluZGVudCA9IGxldmVsICsgaW5kZW50UHJlZml4ICsgaW5kZW50UHJlZml4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbmFtZXNwYWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgcmVzLnB1c2goIG5ld2xpbmUgKTsKICAgICAgICAgICAgICAgIHJlcy5wdXNoKCBpbmRlbnQgKTsKICAgICAgICAgICAgICAgIHJlcy5wdXNoKCBmb3JtYXROYW1lc3BhY2UoIG5hbWVzcGFjZXNbIGkgXSApICk7CiAgICAgICAgICAgIH0KICAKICAgICAgICAgICAgcmV0dXJuIHJlcy5qb2luKCAiIiApOwogICAgICAgIH07CgogICAgICAgIC8vIEZvcm1hdCBhIHNpbmdsZSBhdHRyaWJ1dGUsIG5vIGluZGVudCwgbm8gbmV3bGluZSwgbm8gbm90aGluZwogICAgICAgIC8vIFRha2VzIGludG8gYWNvdW50IG5hbWVzcGFjZXMgYW5kIHByZWZpeCB2YWx1ZXMuCiAgICAgICAgdmFyIGZvcm1hdEF0dHJpYnV0ZSA9IGZ1bmN0aW9uKCB4bWwgKSB7CiAgICAgICAgICAgIExvZy50cmFjZSgiZm9ybWF0IGF0dHJpYnV0ZSIseG1sKTsKICAgICAgICAgICAgdmFyIHJlcyA9IFsgXTsKICAgICAgICAgICAgdmFyIG5hbWUgPSB4bWwubm9kZU5hbWU7CiAgICAgICAgICAgIHJlcy5wdXNoKCBuYW1lICk7CiAgICAgICAgICAgIHJlcy5wdXNoKCAnPSInICk7CiAgICAgICAgICAgIHJlcy5wdXNoKCBlc2NhcGVYbWwoIHhtbC52YWx1ZSApICk7CiAgICAgICAgICAgIHJlcy5wdXNoKCAnIicgKTsKICAgICAgICAgICAgcmV0dXJuIHJlcy5qb2luKCAiIiApOwogICAgICAgIH07CgogICAgICAgIC8vIEZvcm1hdCBhbGwgYXR0cmlidXRlcyBvZiBhbiBlbGVtZW50CiAgICAgICAgLy8gVGFrZXMgaW50byBhY2NvdW50IGluZGVudCBhbmQgbmV3bGluZXMgKGlmIG1vcmUgdGhhbiBvbmUgYXR0cmlidXRlKQogICAgICAgIC8vIFRoZSByZXR1cm5lZCByZXN1bHQgYWx3YXlzIHN0YXJ0cyB3aXRoIGF0IGxlYXN0IGEgc2luZ2xlIHNwYWNlIG9yIGEgbmV3bGluZQogICAgICAgIHZhciBmb3JtYXRBdHRyaWJ1dGVzID0gZnVuY3Rpb24oIHhtbCwgbGV2ZWwgKSB7CiAgICAgICAgICAgIHZhciBkb19jb21wYXJlID0gZnVuY3Rpb24gKGEsYikgewogICAgICAgICAgICAgICAgaWYoYT5iKSByZXR1cm4gMTsKICAgICAgICAgICAgICAgIGlmKGE8YikgcmV0dXJuIC0xOwogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIExvZy50cmFjZSgiZm9ybWF0IGF0dHJpYnV0ZXMiLHhtbCk7CiAgICAgICAgICAgIHZhciBhdHRyaWJ1dGVzID0gZ2V0QXR0cmlidXRlcyh4bWwpOwogICAgICAgICAgICBpZiAoIGF0dHJpYnV0ZXMubGVuZ3RoID09IDAgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gSWYgYXBwbGljYWJsZSwgc29ydCwgYnV0IG9ubHkgYnkgbG9jYWxOYW1lLiBQcmVmaXgnZXMgd2lsbCBiZSAiaW50ZXJtaXhlZCIuCiAgICAgICAgICAgIGlmICggb3B0aW9ucy5zb3J0QXR0cmlidXRlcyApIHsKICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXMuc29ydCggZnVuY3Rpb24oIGEsIGIgKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRvX2NvbXBhcmUoYS5sb2NhbE5hbWUsIGIubG9jYWxOYW1lKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciByZXMgPSBbIF07CiAgICAgICAgICAgIHZhciBuZXdsaW5lID0gIiI7CiAgICAgICAgICAgIHZhciBpbmRlbnQgPSAiICI7CiAgICAgICAgICAgIGlmICggb3B0aW9ucy5kaWZmSW1wcm92ZSAmJiBhdHRyaWJ1dGVzLmxlbmd0aCA+IDEgKSB7CiAgICAgICAgICAgICAgICBuZXdsaW5lID0gIlxuIjsKICAgICAgICAgICAgICAgIGluZGVudCA9IGxldmVsICsgaW5kZW50UHJlZml4ICsgaW5kZW50UHJlZml4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXR0cmlidXRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgcmVzLnB1c2goIG5ld2xpbmUgKTsKICAgICAgICAgICAgICAgIHJlcy5wdXNoKCBpbmRlbnQgKTsKICAgICAgICAgICAgICAgIHJlcy5wdXNoKCBmb3JtYXRBdHRyaWJ1dGUoIGF0dHJpYnV0ZXNbIGkgXSApICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZXMuam9pbiggIiIgKTsKICAgICAgICB9OwoKCiAgICAgICAgLy8gRm9ybWF0IGFuIG9iamVjdCwgdGhhdCBpcywgdGhpcyBvYmplY3QsIGFuZCBhbGwgY2hpbGRyZW4uCiAgICAgICAgLy8geG1sIC0gdGhlIHhtbCBvYmplY3QvZWxlbWVudCB0byBmb3JtYXQKICAgICAgICAvLyBpbmRlbnQgLSB3aGV0ZXIgdG8gZG8gaW5kZW50L2Zvcm1hdCBmaXJzdCBsaW5lIG9mIGVsZW1lbnQgb3Igbm90CiAgICAgICAgLy8gbGV2ZWwgLSB0aGUgY3VycmVudCBpbmRlbnRhdGlvbiBsZXZlbCAoYXMgYSBzdHJpbmcpCiAgICAgICAgdmFyIGZvcm1hdE5vZGUgPSBmdW5jdGlvbiggeG1sLCBpbmRlbnQsIGxldmVsICkgewogICAgICAgICAgICBMb2cudHJhY2UoImZvcm1hdCBub2RlIixYbWxVdGlsLmxvZ1htbFN0cmluZyggeG1sICkpOwogICAgICAgICAgICAvLyBEbyBkaWZmZXJlbnQgdGhpbmdzIGZvciBlbGVtZW50LCB0ZXh0LCBjb21tZW50IGFuZCBwcmVwcm9jZXNzZXIgaW5zdHJ1Y3Rpb24KICAgICAgICAgICAgCiAgICAgICAgICAgIHhtbCA9IHRoYXQuX19nZXRBY3R1YWxOb2RlKHhtbCk7CiAgICAgICAgICAgIGlmICggeG1sLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuRUxFTUVOVF9OT0RFICkgewogICAgICAgICAgICAgICAgLy8gRm9ybWF0IG5hbWVzcGFjZXMsIGF0dHJpYnV0ZXMgYW5kIGNoaWxkcmVuLgoKICAgICAgICAgICAgICAgIHZhciBuYW1lID0geG1sLm5vZGVOYW1lOwogICAgICAgICAgICAgICAgaWYgKCBpbmRlbnQgKSB7CiAgICAgICAgICAgICAgICAgICAgYnVmZmVyLnB1c2goIG5ld0xpbmUgKTsKICAgICAgICAgICAgICAgICAgICBidWZmZXIucHVzaCggbGV2ZWwgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJ1ZmZlci5wdXNoKCAiPCIgKTsKICAgICAgICAgICAgICAgIGJ1ZmZlci5wdXNoKCBuYW1lICk7CiAgICAgICAgICAgICAgICBidWZmZXIucHVzaCggZm9ybWF0TmFtZXNwYWNlcyggeG1sLCBsZXZlbCApICk7CiAgICAgICAgICAgICAgICBidWZmZXIucHVzaCggZm9ybWF0QXR0cmlidXRlcyggeG1sLCBsZXZlbCApICk7CgogICAgICAgICAgICAgICAgLy8gRm9yIGNoaWxkcmVuOgogICAgICAgICAgICAgICAgLy8gVGhlIGlkZWEgaXMgdG8gaGF2ZSBlYWNoIGVsZW1lbnQgZm9ybWF0IGl0c2VsZiByZWN1cnNpdmVseS4KICAgICAgICAgICAgICAgIC8vIEZvcm1hdHRpbmcgaW5jbHVkZXMgbmV3bGluZSBhbmQgaW5kZW50cyBiZWZvcmUgdGhlIGVsZW1lbnQsIGJ1dCBub3QgYWZ0ZXIuCiAgICAgICAgICAgICAgICAvLyBUZXh0IGVsZW1lbnRzIGRvIG5vdCBpbnNlcnQgbmV3bGluZXMgYmVmb3JlIHRoZW1zZWx2ZXMKICAgICAgICAgICAgICAgIC8vIEVsZW1lbnRzIGZvbGxvd2luZyBhIHRleHRlbGVtZW50IGlzIG5vdCBhbGxvd2VkIHRvIG5ld2xpbmUgYW5kIGluZGVudCBiZWZvcmUsIGJ1dCBtYXkgZG8gYWZ0ZXIuCiAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGNvbnRyb2xsZWQgYnkgdGhlICJpbmRlbnQiIHZhcmlhYmxlLgogICAgICAgICAgICAgICAgLy8gSWYgdGhlIGZpbmFsIGVsZW1lbnQgaXMgYSBuZXdsaW5lLCB0aGUgY2xvc2luZyB0YWcgaXMgbm90IHNldAogICAgICAgICAgICAgICAgLy8gSWYgdGhpcyBlbGVtZW50IGNvbnRhaW5zIGFueSB0ZXh0IG5vZGVzLCB3ZSBkbyBub3Qgd2FudCB0byBpbmRlbnQgdGhlIGNvbnRlbnQgb2YgdGhpcyAKICAgICAgICAgICAgICAgIC8vIGVsZW1lbnQuIChUaGlzIGRvZXMgbm90IGluZmx1ZW5jZSBlLmcuIGF0dHJpYnV0ZXMgb24gc2VwYXJhdGUgbGluZXMpLgoKICAgICAgICAgICAgICAgIC8vIFVzZWQgZm9yIGl0ZXJhdGlvbgogICAgICAgICAgICAgICAgdmFyIGNoaWxkcmVuID0geG1sLmNoaWxkTm9kZXM7CgogICAgICAgICAgICAgICAgLy8gVXNlZCB0byB0cmFjayBpZiB0aGUgY2hpbGRyZW5zIG1hZGUgYW55IGNvbnRlbnQKICAgICAgICAgICAgICAgIC8vIE9wdGltaXN0aWNhbGx5IGFzc3VtZSB0aGF0IGNoaWxkcmVuIG1lYW5zIHRoYXQgd2UgbmVlZCBhIGNsb3NpbmcgdGFnCiAgICAgICAgICAgICAgICB2YXIgY29udGVudEluZGV4ID0gYnVmZmVyLnB1c2goICI+IiApOwoKICAgICAgICAgICAgICAgIC8vIEFjdHVhbGx5IGZpZ3VyZSBvdXQgaWYgd2UgY2FuIGludHJvZHVjZSBzcGFjZXMvZm9ybWF0dGluZyBpbnRvIGFuIGVsZW1lbnQvbWl4ZWQgY29udGVudAogICAgICAgICAgICAgICAgdmFyIGxhc3RXYXNOb25Ucml2aWFsVGV4dE5vZGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBmb3JtYXROb2RlKCBjaGlsZHJlbi5pdGVtKCBpICksICFsYXN0V2FzTm9uVHJpdmlhbFRleHROb2RlLCBsZXZlbCArIGluZGVudFByZWZpeCApOwogICAgICAgICAgICAgICAgICAgIGxhc3RXYXNOb25Ucml2aWFsVGV4dE5vZGUgPSAoICggY2hpbGRyZW4uaXRlbSggaSApLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuVEVYVF9OT0RFICYmIFhtbFV0aWwudG9YbWxTdHJpbmcoIGNoaWxkcmVuLml0ZW0oaSkgKSAhPSAiIiApICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gRGlkIHdlIGdlbmVyYXRlIGFueSBjb250ZW50IGF0IGFsbD8gSWYgbm90LCBjbG9zZSB0YWcgYnkgaXQgc2VsZi4KICAgICAgICAgICAgICAgIGlmICggY29udGVudEluZGV4ID09IGJ1ZmZlci5sZW5ndGggKSB7CiAgICAgICAgICAgICAgICAgICAgYnVmZmVyWyBjb250ZW50SW5kZXggLSAxIF0gPSAiLz4iOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBJZiBsYXN0IHdhcyBhIG5vbiB0cml2aWFsIHRleHQgbm9kZSwgZG8gbm90IGluc2VydCBhIG5ld2xpbmUgYmVmb3JlIGNsb3NlIHRhZwogICAgICAgICAgICAgICAgICAgIC8vIGJ1ZmZlcltjb250ZW50SW5kZXgtMV0gPSAiPiI7IC8vIGFscmVhZHkgZG9uZQogICAgICAgICAgICAgICAgICAgIGlmICggIWxhc3RXYXNOb25Ucml2aWFsVGV4dE5vZGUgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlci5wdXNoKCBuZXdMaW5lICsgbGV2ZWwgKTsKICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJ1ZmZlci5wdXNoKCAiPC8iICsgbmFtZSArICI+IiApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKCB4bWwubm9kZVR5cGUgPT09IE5vZGVUeXBlcy5URVhUX05PREUgKSB7CiAgICAgICAgICAgICAgICBidWZmZXIucHVzaCggZXNjYXBlWG1sKFhtbFV0aWwudG9YbWxTdHJpbmcoIHhtbCApICkgKTsKICAgICAgICAgICAgfSBlbHNlIGlmICggeG1sLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuQ09NTUVOVF9OT0RFICkgewogICAgICAgICAgICAgICAgYnVmZmVyLnB1c2goIG5ld0xpbmUgKyBsZXZlbCArIFhtbFV0aWwudG9YbWxTdHJpbmcoIHhtbCApICk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIHhtbC5ub2RlVHlwZSA9PT0gTm9kZVR5cGVzLkNEQVRBX1NFQ1RJT05fTk9ERSApIHsKICAgICAgICAgICAgICAgIGJ1ZmZlci5wdXNoKCBuZXdMaW5lICsgbGV2ZWwgKyB4bWwubm9kZVZhbHVlICk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBXZSBkbyBub3QgYWN0dWFsbHkgZXhwZWN0IHRvIGdldCBoZXJlIQogICAgICAgICAgICAgICAgTG9nLndhcm4oICJYbWxVdGlsLnByZXR0eVByaW50OiBVbmV4cGVjdGVkIG5vZGVLaW5kICIgKyB4bWwubm9kZVR5cGUgKyAiIG9jY3VyZWQuIFJldmVydGluZyB0byB0b1hNTFN0cmluZygpIiApOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBidWZmZXIucHVzaCggeG1sLm5vZGVUeXBlICk7CiAgICAgICAgICAgICAgICB9IGNhdGNoICggZSApIHsKICAgICAgICAgICAgICAgICAgICBYbWxVdGlsLl9fdGhyb3dFcnJvciggIldoaWxlIHRyeWluZyB0byBnZW5lcmF0ZSBYTUwgZm9yIHVua25vd24gbm9kZUtpbmQgOiAnIiArIHhtbC5ub2RlVHlwZSArICInLCBhbiBlcnJvciBvY2N1cnJlZDogIiArIGUgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGZvcm1hdE5vZGUoIHhtbCwgZmFsc2UsICIiICk7CiAgICAgICAgcmV0dXJuIGJ1ZmZlci5qb2luKCAiIiApOwogICAgfTsKCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBEb2N1bWVudCBmcm9tIGF0IEVsZW1lbnRzLiBBbGwgTmFtZXNwYWNlcyBmcm9tIHRoaXMgY2hpbGQgdG8gdGhlIGRvY3VtZW50CiAgICAgKiBpcyBjb3B5ZWQgdG8gdGhlIG5ldyBkb2N1bWVudEVsZW1lbnQKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYbWxVdGlsLmNyZWF0ZURvY3VtZW50RnJvbUVsZW1lbnQKICAgICAqIEBwYXJhbSBFbGVtZW50IHRvIGJlIG5ldyB0b3BsZXZlbCBmb3IgdGhlIGRvY3VtZW50CiAgICAgKiBAcmV0dXJuIHtEb2N1bWVudH0gbmV3IGRvY3VtZW50IHdpdGggY2hpbGQgYXMgZG9jdW1lbnRFbGVtZW50CiAgICAgKi8KICAgIHRoYXQuY3JlYXRlRG9jdW1lbnRGcm9tRWxlbWVudCA9IGZ1bmN0aW9uKCBFbGVtZW50ICkgewogICAgICAgIC8qKgogICAgICAgICAqICByZWN1cnNpdmUgdHJhY2UgdXAgdG8gYW5kIGNvbGxlY3QgYWxsIGF0dHJvYnV0ZXMgc3RhcnRpbmcgd2l0aCB4bWxucwogICAgICAgICAqIEBuYW1lIFhtbFV0aWwuY3JlYXRlRG9jdW1lbnRGcm9tRWxlbWVudC5leHRyYWN0UGFyZW50TmFtZXNwYWNlQXR0cmlidXRlcwogICAgICAgICAqIEBwYXJhbSBjaGlsZAogICAgICAgICAqIEByZXR1cm4ge0FycmF5fSBvZiBOYW1lc3BhY2VzIG5vZGVzIGZyb20gY2hpbGQgdXAgdG8gRG9jdW1lbnQ7CiAgICAgICAgICovCiAgICAgICAgdmFyIGV4dHJhY3RQYXJlbnROYW1lc3BhY2VBdHRyaWJ1dGVzPWZ1bmN0aW9uKCBjaGlsZCApIHsKCiAgICAgICAgICAgIHZhciBuYW1lc3BhY2VBdHRyaWJ1dGVzPVtdOwogICAgICAgICAgICBpZiAoIGNoaWxkLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuRUxFTUVOVF9OT0RFICkgewogICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZXM9Y2hpbGQuYXR0cmlidXRlczsKICAgICAgICAgICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IGF0dHJpYnV0ZXMubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZT1hdHRyaWJ1dGVzLml0ZW0oaSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCBhdHRyaWJ1dGUubm9kZVR5cGUgPT09IE5vZGVUeXBlcy5BVFRSSUJVVEVfTk9ERSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZS5wcmVmaXggPT09IFhtbE5hbWVzcGFjZXMueG1sbnMucHJlZml4IHx8IGF0dHJpYnV0ZS5ub2RlTmFtZSA9PT0gInhtbG5zIiApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzcGFjZUF0dHJpYnV0ZXMucHVzaCggYXR0cmlidXRlICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCBjaGlsZC5wYXJlbnROb2RlICkgewogICAgICAgICAgICAgICAgbmFtZXNwYWNlQXR0cmlidXRlcz1uYW1lc3BhY2VBdHRyaWJ1dGVzLmNvbmNhdCggZXh0cmFjdFBhcmVudE5hbWVzcGFjZUF0dHJpYnV0ZXMoIGNoaWxkLnBhcmVudE5vZGUgKSApOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbmFtZXNwYWNlQXR0cmlidXRlczsKICAgICAgICB9OwoKCiAgICAgICAgdmFyIHJlc3VsdERvY3VtZW50PVhtbFV0aWwuZG9tSW1wbC5jcmVhdGVEb2N1bWVudCgpOwogICAgICAgIHZhciBuZXdDaGlsZD1yZXN1bHREb2N1bWVudC5pbXBvcnROb2RlKEVsZW1lbnQsdHJ1ZSk7CiAgICAgICAgcmVzdWx0RG9jdW1lbnQuYXBwZW5kQ2hpbGQobmV3Q2hpbGQpOwoKICAgICAgICB2YXIgbnM9ZXh0cmFjdFBhcmVudE5hbWVzcGFjZUF0dHJpYnV0ZXMoIEVsZW1lbnQgKTsKICAgICAgICBucy5mb3JFYWNoKCBmdW5jdGlvbiggbnMgKSB7IG5ld0NoaWxkLnNldEF0dHJpYnV0ZU5TKCBucy5uYW1lc3BhY2VVUkksIG5zLm5hbWUsIG5zLnZhbHVlICk7IH0pOwoKICAgICAgICByZXR1cm4gcmVzdWx0RG9jdW1lbnQ7CiAgICB9OwoKICAgIC8qKgogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhtbFV0aWwubm9ybWFsaXplWG1sCiAgICAgKiBAcGFyYW0ge0RvY3VtZW50fE5vZGV9IHhtbAogICAgICogQHJldHVybiB7RG9jdW1lbnR9IG5ldyBkb2N1bWVudCB3aXRoIGNoaWxkIGFzIGRvY3VtZW50RWxlbWVudAogICAgICovCiAgICB0aGF0Lm5vcm1hbGl6ZVhtbCA9IGZ1bmN0aW9uICggeG1sICkgewoKCiAgICAgICAgZnVuY3Rpb24gZG9tVHJpbSggeG1sRWxlbWVudCApIHsKICAgICAgICAgICAgaWYoIHhtbEVsZW1lbnQubm9kZVR5cGUgPT09IE5vZGVUeXBlcy5URVhUX05PREUgKSB7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIE9ubHkgdHJpbSBpZiBURVhUIG5vZGUgaGFzIGEgc2libGluZyB3aGljaCBpcyBub3QgYSBURVhUIG5vZGUKICAgICAgICAgICAgICAgIGlmKCAoIHhtbEVsZW1lbnQucHJldmlvdXNTaWJsaW5nICYmIHhtbEVsZW1lbnQucHJldmlvdXNTaWJsaW5nLm5vZGVUeXBlICE9PSBOb2RlVHlwZXMuVEVYVF9OT0RFICkKICAgICAgICAgICAgICAgICAgICAgICAgfHwgKCB4bWxFbGVtZW50Lm5leHRTaWJsaW5nICYmIHhtbEVsZW1lbnQubmV4dFNpYmxpbmcubm9kZVR5cGUgIT09IE5vZGVUeXBlcy5URVhUX05PREUgKSApIHsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB4bWxFbGVtZW50Lm5vZGVWYWx1ZSA9IHhtbEVsZW1lbnQubm9kZVZhbHVlLnRyaW0oKTsgICAgICAgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGNoaWxkPXhtbEVsZW1lbnQuZmlyc3RDaGlsZDsKICAgICAgICAgICAgd2hpbGUoY2hpbGQpIHsKICAgICAgICAgICAgICAgIGRvbVRyaW0oIGNoaWxkICk7CiAgICAgICAgICAgICAgICBjaGlsZCA9IGNoaWxkLm5leHRTaWJsaW5nOwoKICAgICAgICAgICAgfQogICAgICAgIH0KCgogICAgICAgIC8vIHJlbW92ZXMgbmFtZXNwYWNlcyBmcm9tIHRoaXMgbm9kZQogICAgICAgIC8vCiAgICAgICAgZnVuY3Rpb24gZXh0cmFjdE5hbWVzcGFjZXNGcm9tRWxlbWVudCggeG1sRWxlbWVudCApIHsKICAgICAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmcgWG1sVXRpbC5nZXROYW1lc3BhY2VzICIsIFhtbFV0aWwubG9nWG1sU3RyaW5nKCB4bWxFbGVtZW50ICkpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFyIG5hbWVzcGFjZXMgPSBbXTsKICAgICAgICAgICAgICAgIHZhciBub25fbmFtZXNwYWNlcyA9IFtdOwogICAgICAgICAgICAgICAgaWYgKCB4bWxFbGVtZW50Lm5vZGVUeXBlID09PSBOb2RlVHlwZXMuRUxFTUVOVF9OT0RFICkgewogICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGVMaXN0PXhtbEVsZW1lbnQuYXR0cmlidXRlczsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGF0dHJpYnV0ZUxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZT1hdHRyaWJ1dGVMaXN0Lml0ZW0oaSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCBhdHRyaWJ1dGUubm9kZVR5cGUgPT09IE5vZGVUeXBlcy5BVFRSSUJVVEVfTk9ERSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihhdHRyaWJ1dGUucHJlZml4ID09PSBYbWxOYW1lc3BhY2VzLnhtbG5zLnByZWZpeCApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzcGFjZXMucHVzaChhdHRyaWJ1dGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZy50cmFjZSgiZm91bmQgbmFtZXNwYWNlIiwgYXR0cmlidXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9uX25hbWVzcGFjZXMucHVzaCggYXR0cmlidXRlICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBuYW1lc3BhY2VzLmZvckVhY2goZnVuY3Rpb24obnMpIHsgeG1sRWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUobnMubmFtZSk7fSk7CiAgICAgICAgICAgICAgICBub25fbmFtZXNwYWNlcy5mb3JFYWNoKCBmdW5jdGlvbihucyl7IHhtbEVsZW1lbnQucmVtb3ZlQXR0cmlidXRlTm9kZShucyk7fSk7CiAgICAgICAgICAgICAgICBub25fbmFtZXNwYWNlcy5zb3J0KGZ1bmN0aW9uIChhLGIpIHsKICAgICAgICAgICAgICAgICAgICBpZihhLm5hbWU+Yi5uYW1lKSByZXR1cm4gMTsKICAgICAgICAgICAgICAgICAgICBpZihhLm5hbWU8Yi5uYW1lKSByZXR1cm4gLTE7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIG5vbl9uYW1lc3BhY2VzLmZvckVhY2goZnVuY3Rpb24obnMpeyBYbWxVdGlsLnNldEF0dHJpYnV0ZSh4bWxFbGVtZW50LCBucy5uYW1lLG5zLnZhbHVlLCBucy5uYW1lc3BhY2UpO30pOwogICAgICAgICAgICAgICAgcmV0dXJuIG5hbWVzcGFjZXM7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIFhtbFV0aWwuZ2V0TmFtZXNwYWNlcyIsIFhtbFV0aWwubG9nWG1sU3RyaW5nKCB4bWxFbGVtZW50ICkgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZXh0cmFjdE5hbWVzcGFjZXMoIHhtbEVsZW1lbnQgKSB7CiAgICAgICAgICAgIExvZy50cmFjZSgiRW50ZXJpbmcgZXh0cmFjdE5hbWVzcGFjZXMgOiAiLCBYbWxVdGlsLmxvZ1htbFN0cmluZyggeG1sRWxlbWVudCApICk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB2YXIgbmFtZXNwYWNlcyA9IGV4dHJhY3ROYW1lc3BhY2VzRnJvbUVsZW1lbnQoeG1sRWxlbWVudCk7CgogICAgICAgICAgICAgICAgdmFyIGNoaWxkID0geG1sRWxlbWVudC5maXJzdENoaWxkOwogICAgICAgICAgICAgICAgd2hpbGUgKCBjaGlsZCApIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbmV3bnMgPSBleHRyYWN0TmFtZXNwYWNlcyggY2hpbGQgKTsKICAgICAgICAgICAgICAgICAgICBuZXducy5mb3JFYWNoKCBmdW5jdGlvbiAoIGUgKSB7IG5hbWVzcGFjZXMucHVzaCggZSApOyB9ICk7CiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBjaGlsZC5uZXh0U2libGluZzsKCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIG5hbWVzcGFjZXM7CiAgICAgICAgICAgIH0gZmluYWxseXsKICAgICAgICAgICAgICBMb2cudHJhY2UoIkxlYXZpbmcgZXh0cmFjdE5hbWVzcGFjZXMgOiAiLCBYbWxVdGlsLmxvZ1htbFN0cmluZyggeG1sRWxlbWVudCApICk7CiAgICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICB2YXIgZG9jdW1lbnRFbGVtZW50PXhtbDsKICAgICAgICBpZiggeG1sLmRvY3VtZW50RWxlbWVudCApIHsKICAgICAgICAgICAgZG9jdW1lbnRFbGVtZW50PXhtbC5kb2N1bWVudEVsZW1lbnQ7CiAgICAgICAgfQoKICAgICAgICBkb21UcmltKCBkb2N1bWVudEVsZW1lbnQgKTsKICAgICAgICB2YXIgdG9wbnM9ZXh0cmFjdE5hbWVzcGFjZXMoIGRvY3VtZW50RWxlbWVudCApOwogICAgICAgIHRvcG5zLnNvcnQoZnVuY3Rpb24gKGEsYikgewogICAgICAgICAgICBpZihhLm5hbWU+Yi5uYW1lKSByZXR1cm4gMTsKICAgICAgICAgICAgaWYoYS5uYW1lPGIubmFtZSkgcmV0dXJuIC0xOwogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9KTsKICAgICAgICB0b3Bucy5mb3JFYWNoKGZ1bmN0aW9uKG5zKXsKICAgICAgICAgICAgZG9jdW1lbnRFbGVtZW50LnNldEF0dHJpYnV0ZU5TKG5zLm5hbWVzcGFjZVVSSSwgbnMubmFtZSwgbnMudmFsdWUpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiB4bWw7CiAgICB9OwoKCiAgICAvKioKICAgICAqIEdldHMgeG1sIGFzIGVpdGhlciBzdHJpbmcsIGRvY3VtZW50LCBvciBlbGVtZW50IGFuZCB3aWxsIGFsd2F5cyByZXR1cm4gYW4gZWxlbWVudAogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhtbFV0aWwuYXNFbGVtZW50CiAgICAgKiBAc3ludGF4IFhtbFV0aWwuYXNFbGVtZW50KCB4bWwgKQogICAgICogQHBhcmFtIHtOb2RlfERvY3VtZW50fFN0cmluZyB9IHhtbCB4bWwgZWl0aGVyIGFzIGRvY3VtZW50LCBlbGVtZW50IG9yIHN0cmluZwogICAgICogQGV4YW1wbGUKICAgICAqIHZhciBlbGVtZW50ID0gWG1sVXRpbC5hc0VsZW1lbnQoIHhtbCApOwogICAgICogWG1sVXRpbC5hc0VsZW1lbnQoICI8dGFnPjwvdGFnPiIpOwogICAgICovCgogICAgdGhhdC5hc0VsZW1lbnQgPSBmdW5jdGlvbiggeG1sICkgewoKICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZyBYbWxVdGlsLmFzRWxlbWVudCIgKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIHVuZGVmaW5lZCA9PT0geG1sIHx8IG51bGwgPT09IHhtbCApIHsKICAgICAgICAgICAgICAgIFhtbFV0aWwuX190aHJvd0Vycm9yKCAiRXJyb3IgLSBpbnB1dCB0byBYbWxVdGlsLmFzRWxlbWVudCB3YXMgZWl0aGVyIG51bGwgb3IgdW5kZWZpbmVkIiApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciB0eXBlID0gVXRpbC5nZXRUeXBlKCB4bWwgKTsKCiAgICAgICAgICAgIHN3aXRjaCAoIHR5cGUgKSB7CiAgICAgICAgICAgICAgICBjYXNlICJvYmplY3QiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGF0Ll9fZ2V0QWN0dWFsTm9kZSggeG1sICk7CiAgICAgICAgICAgICAgICBjYXNlICJEb2N1bWVudCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHhtbC5kb2N1bWVudEVsZW1lbnQ7CiAgICAgICAgICAgICAgICBjYXNlICJzdHJpbmciOgogICAgICAgICAgICAgICAgY2FzZSAiU3RyaW5nIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gWG1sVXRpbC5mcm9tU3RyaW5nKHhtbCkuZG9jdW1lbnRFbGVtZW50OwogICAgICAgICAgICAgICAgY2FzZSAiRWxlbWVudCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHhtbDsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgWG1sVXRpbC5fX3Rocm93RXJyb3IoICJFcnJvciAtIGlucHV0IHRvIFhtbFV0aWwuYXNFbGVtZW50IHdhcyBub3QgeG1sIiApOwogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBYbWxVdGlsLmFzRWxlbWVudCIgKTsKICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAgICogU29ydCBjaGlsZCBlbGVtZW50cyBhbHBoYWJldGljYWxseS4KICAgICAqIAogICAgICogU29ydCBjaGlsZCBlbGVtZW50cyBvZiB0aGUgcGFzc2VkIG5vZGUgYWxwaGFiZXRpY2FsbHkgYWNjb3JkaW5nIHRvIGZ1bGx5IHF1YWxpZmllZCBuYW1lCiAgICAgKgogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgWG1sVXRpbC5zb3J0RWxlbWVudHMKICAgICAqIEBzeW50YXggWG1sVXRpbC5hc0VsZW1lbnQoIHhtbCApCiAgICAgKiBAcGFyYW0ge05vZGV8RG9jdW1lbnQgfSB4bWwgeG1sIGVpdGhlciBhcyBkb2N1bWVudCBvciBlbGVtZW50CiAgICAgKiBAcmV0dXJuIHtOb2RlfSB0aGUgbW9kaWZpZWQgbm9kZQogICAgICogQGV4YW1wbGUKICAgICAqIFhtbFV0aWwuc29ydEVsZW1lbnRzKCB4bWwgKTsKICAgICAqLwogICAgdGhhdC5zb3J0RWxlbWVudHMgPSBmdW5jdGlvbiggeG1sICl7CiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmcgWG1sVXRpbC5zb3J0RWxlbWVudHMiICk7CiAgICAgICAgdmFyIHBhcmVudE5vZGUgPSBYbWxVdGlsLl9fZ2V0QWN0dWFsTm9kZSh4bWwpOwogICAgICAgIHZhciBlbGVtZW50cyA9IFtdOwogICAgICAgIC8vTG9nLmRlYnVnKCJYbWxVdGlsLnNvcnRFbGVtZW50cywgaW5wdXQgaGFzICIsIHBhcmVudE5vZGUuY2hpbGROb2Rlcy5sZW5ndGgsICIgbm9kZXMiKTsKICAgICAgICBmb3IgKCB2YXIgaSA9IHBhcmVudE5vZGUuY2hpbGROb2Rlcy5sZW5ndGgtMSA7IGkgPj0gMCA7IGktLSApIHsKICAgICAgICAgICAgLy92YXIgbm9kZSA9IHBhcmVudE5vZGUuY2hpbGROb2Rlc1sgaSBdOwogICAgICAgICAgICB2YXIgbm9kZT0gcGFyZW50Tm9kZS5jaGlsZE5vZGVzLml0ZW0oaSk7CiAgICAgICAgICAgIC8vTG9nLmRlYnVnKCJYbWxVdGlsLnNvcnRFbGVtZW50cywgcmVtb3ZlICIsIG5vZGUpOwogICAgICAgICAgICBwYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBub2RlICk7CiAgICAgICAgICAgIGVsZW1lbnRzLnB1c2goIG5vZGUgKTsKICAgICAgICB9CiAgICAgICAgLy9Mb2cuZGVidWcoIlhtbFV0aWwuc29ydEVsZW1lbnRzLCBlbGVtZW50cyBoYXMgIiwgZWxlbWVudHMubGVuZ3RoLCAiIG5vZGVzIik7CiAgICAgICAgLy9Mb2cuZGVidWcoIlhtbFV0aWwuc29ydEVsZW1lbnRzLCBjbGVhbmVkIG91dHB1dCBoYXMgIiwgcGFyZW50Tm9kZS5jaGlsZE5vZGVzLmxlbmd0aCwgIiBub2RlcyIpOwogICAgICAgIGVsZW1lbnRzLnNvcnQoZnVuY3Rpb24gKGEsYikgewogICAgICAgICAgICBpZihhLm5vZGVOYW1lPmIubm9kZU5hbWUpIHJldHVybiAxOwogICAgICAgICAgICBpZihhLm5vZGVOYW1lPGIubm9kZU5hbWUpIHJldHVybiAtMTsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfSk7CiAgICAgICAgTG9nLmRlYnVnKCJYbWxVdGlsLnNvcnRFbGVtZW50cywgc29ydGVkIGVsZW1lbnRzIGhhcyAiLCBlbGVtZW50cy5sZW5ndGgsICIgbm9kZXMiKTsKCiAgICAgICAgZm9yICggdmFyIGkgPSAwIDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICB2YXIgbm9kZSA9IGVsZW1lbnRzWyBpIF07CiAgICAgICAgICAgIC8vTG9nLmRlYnVnKCJYbWxVdGlsLnNvcnRFbGVtZW50cywgYXBwZW5kIHNvcnRlZCAiLCBub2RlKTsKICAgICAgICAgICAgWG1sVXRpbC5hcHBlbmRDaGlsZChwYXJlbnROb2RlLCBub2RlKTsKICAgICAgICAgICAgLy9wYXJlbnROb2RlLmFwcGVuZENoaWxkKG5vZGUpOwogICAgICAgICAgICAvL0xvZy5kZWJ1ZygiWG1sVXRpbC5zb3J0RWxlbWVudHMsIG91dHB1dCAiLCBwYXJlbnROb2RlKTsKICAgICAgICB9CiAgICAgICAgLy9Mb2cuZGVidWcoIlhtbFV0aWwuc29ydEVsZW1lbnRzLCBvdXRwdXQgaGFzICIsIHBhcmVudE5vZGUuY2hpbGROb2Rlcy5sZW5ndGgsICIgbm9kZXMiKTsKICAgICAgICBMb2cuZGVidWcoIlhtbFV0aWwuc29ydEVsZW1lbnRzLCBvdXRwdXQgIiwgcGFyZW50Tm9kZSk7CiAgICAgICAgcmV0dXJuIHhtbDsKICAgIH07CgogICAgcmV0dXJuIHRoYXQ7Cn0oICk7Cgo=", "moduleName": "XmlUtil"}, {"javascript": "LyoqIEBmaWxlIFByb3ZpZGUgVzNDIGNvbXBhdGlibGUgWE1MRE9NIGltcGxlbWVudGF0aW9uLiAqLwpFWFBPUlRFRF9TWU1CT0xTID0gWyAnWE1MRE9NJyBdOwpJR05PUkVEX1NZTUJPTFMgPSBbICdfX3VzZV9qYXZhX3htbF9kb20nIF07CnVzZSggIkVuZ2luZSIgKTsKdXNlKCAiTG9nIiApOwoKLy8gWE1MRE9NIHR1dG9yaWFsOiBodHRwOi8vd3d3Lnczc2Nob29scy5jb20vRG9tLwovLyBYTUxET00gcmVmZXJlbmNlOiBodHRwOi8vd3d3Lnczc2Nob29scy5jb20vRG9tL2RvbV9kb2N1bWVudC5hc3AKLy8gWE1MRE9NIGNvbW5mb3JtYW5jZSB0ZXN0OiBodHRwOi8vd3d3LnczLm9yZy9ET00vVGVzdC8KCi8qKgogKiBQcm92aWRlcyBhbiBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgVzNDIFhNTCBET00uCiAqIAogKiBUaGlzIG1vZHVsZSBhbGxvd3Mgd29ya2luZyB3aXRoIFhNTCB1c2luZyB0aGUgc3RhbmRhcmRpemVkIFhNTCBBUEkgZnJvbSBXQzMuIAogKiAKICogVGhlcmUgaXMgYW4gaW50cm9kdWN0aW9uL3R1dG9yaWFsIGZvciB0aGlzLCBoZXJlOiB7QGxpbmsgaHR0cDovL3d3dy53M3NjaG9vbHMuY29tL0RvbS99LgogKiBBIGZ1bGwgcmVmZXJlbmNlIGlzIGF2YWlsYWJsZSBoZXJlOiB7QGxpbmsgaHR0cDovL3d3dy53M3NjaG9vbHMuY29tL0RvbS9kb21fZG9jdW1lbnQuYXNwfS4KICogCiAqIFRoZSBhY3R1YWwgaW1wbGVtZW50YXRpb24gaXMgYmFzZWQgb24ge0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS9qaW5kdy94bWxkb219IChjbG9uZWQgaW50byB7QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL0RCQ0RLL3htbGRvbS5naXR9LgogKiAKICogKipOT1RFOioqIFRoaXMgaXMgY3VycmVudGx5IGFuIGltcGxlbWVudGF0aW9uIG9mIHRoZSB2ZXJzaW9uIDIgb2YgdGhlIFhNTCBET00gc3RhbmRhcmQuCiAqIAogKiAqKk5PVEU6KiogVGhpcyBtb2R1bGUgZGVwZW5kcyBvbiBhIENvbW1vbkpTL01vZHVsZXMvMS4wIG1vZHVsZSwgdGhhdCBsaXZlcyBhcyBhIHN1YmRpcmVjdG9yeSB0byB0aGUganNjb21tb24gZXh0ZXJuYWxzIG1vZHVsZS4gRXJyb3JzIGxpa2UgIkVycm9yOiBSZXF1aXJlLnJlcXVpcmUsIHVuYWJsZSB0byByZXNvbHZlICgnJywgJ3htbGRvbScpIHRvIGEgbW9kdWxlLiAoUmVxdWlyZS51c2UuanMjMzc5KSIgaW5kaWNhdGVzIHRoYXQKICogdGhlIHNlYXJjaCBwYXRocyBuZWVkcyB0byBoYXZlIHRoaXMgc2V0IChpbiBhYnNvbHV0ZSBvciByZWxhdGl2ZSBmb3JtYXQ6IHNlZSB7QGxpbmsgUmVxdWlyZX0gZm9yIG1vcmUgaW5mb3JtYXRpb24pLiAKCiAqIAogKiBAZXhhbXBsZSAvLyBIb3cgdG8gY3JlYXRlIGEgc2ltcGxlIFhNTCBkb2N1bWVudCBmcm9tIGEgc3RyaW5nLCBhbmQgZXh0cmFjdCBpbmZvcm1hdGlvbiBhYm91dCB0aGUgZG9jdW1lbnRSb290cyBsb2NhbE5hbWU6CnVzZSggIlhNTERPTSIgKTsKLy8gQ3JlYXRlIGEgbmV3IERPTSBwYXJzZXIsIHRoYXQgY2FuIGUuZy4gcGFyc2UgeG1sIGRvY3VtZW50cwp2YXIgZG9tUGFyc2VyID0gbmV3IFhNTERPTS5ET01QYXJzZXIoKTsKLy8gQ3JlYXRlIGEgc2ltcGxlIGRvY3VtZW50IGZyb20gYSBzaW1wbGUgc3RyaW5nCnZhciBkb2MgPSBkb21QYXJzZXIucGFyc2VGcm9tU3RyaW5nKCAiPHNvbWU+eG1sPC9zb21lPiIgKTsKLy8gVGhpcyByZXR1cm5zICJzb21lIgpkb2MuZG9jdW1lbnRFbGVtZW50LmxvY2FsTmFtZQogKgogKiBAbmFtZXNwYWNlCiAqIEBuYW1lIFhNTERPTQogKi8KCi8vIEBUT0RPIGNoZWNrIGZvciBqYXZhIG9yIGMrKyBlbnZpcm9ubWVudCBhbmQgYWN0IGFjY29yZGluZ2x5CgovLyBGbGFnIHRvIHVzZSBqYXZhIG9yIGphdmFzY3JpcHQgWE1MRE9NIGltcGxlbWVudGF0aW9uCi8vIENvbnRyb2xsZWQgYnkgZW52aXJvbm1lbnQgdmFyaWFibGUgVVNFX0pBVkFfWE1MX0RPTSBvciBieSBwdXR0aW5nIHRoZSBnbG9iYWwgcHJvcGVydHkKLy8gX19VU0VfSkFWQV9YTUxfRE9NIGluIHRoZSBqYXZhc2NyaXB0IGVudmlyb25tZW50Ci8vIERlZmF1bHRzIHRvIHVzZSBKYXZhc2NyaXB0IERPTSBpbXBsZW1lbnRhdGlvbgp2YXIgX191c2VfamF2YV94bWxfZG9tID0gZnVuY3Rpb24oKSB7CiAgICBpZiAoICEgRW5naW5lLmlzRW5naW5lKEVuZ2luZS5OQVNIT1JOKSApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB2YXIgc3lzdGVtID0gUGFja2FnZXMuamF2YS5sYW5nLlN5c3RlbTsKICAgIHZhciB2YWx1ZSA9IHN5c3RlbS5nZXRlbnYoIlVTRV9KQVZBX1hNTF9ET00iKTsKICAgIExvZy5kZWJ1ZyggIkVudmlyb25tZW50IHZhcmlhYmxlOiBVU0VfSkFWQV9YTUxfRE9NOiAiLCBMb2cuc2FmZVZhbHVlKCB2YWx1ZSApICk7CgogICAgdmFyIGdsb2JhbCA9IHRoaXMuaGFzT3duUHJvcGVydHkoICJfX1VTRV9KQVZBX1hNTF9ET00iICkgJiYgX19VU0VfSkFWQV9YTUxfRE9NOwogICAgTG9nLmRlYnVnKCAiR2xvYmFsIDogX19VU0VfSkFWQV9YTUxfRE9NOiAiLCBMb2cuc2FmZVZhbHVlKCBnbG9iYWwgKSApOwogICAgICAKICAgIGlmKCBzeXN0ZW0uZ2V0ZW52KCJVU0VfSkFWQV9YTUxfRE9NIikgPT09IG51bGwgJiYgCiAgICAgICAgICAgIHRoaXMuaGFzT3duUHJvcGVydHkoICJfX1VTRV9KQVZBX1hNTF9ET00iICkgPT09IGZhbHNlICkgewogICAgICAgIHJldHVybiB0cnVlOyAvLyBkZWZhdWx0CiAgICB9CgogICAgaWYgKCBnbG9iYWwgfHwgKCB2YWx1ZSAmJiBKU09OLnBhcnNlKCB2YWx1ZSApICkgKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KfTsKCmlmICggIV9fdXNlX2phdmFfeG1sX2RvbSgpICkgewogICAgLy8gSmF2YXNjcmlwdCBpbXBsZW1lbnRhdGlvbgogICAgTG9nLmluZm8oIlVzaW5nIFhNTERPTSBpbXBsZW1lbnRhdGlvbjogSmF2YXNjcmlwdCIpOwogICAgLy8gT25seSBsb2FkIHJlcXVpcmUgbW9kdWxlcyBpZiAncmVxdWlyZWQnCiAgICB1c2UoICJSZXF1aXJlIiApOwogICAgdmFyIFhNTERPTSA9IChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHRoYXQgPSByZXF1aXJlKCJ4bWxkb20iKTsKICAgICAgICB0aGF0LkRPTVBhcnNlci5wcm90b3R5cGUudG9YbWxTdHJpbmcgPSBmdW5jdGlvbiAoZG9jKSB7CiAgICAgICAgICAgIHJldHVybiBkb2MudG9TdHJpbmcoKTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gdGhhdDsKICAgIH0pKCk7Cn0gZWxzZSB7CiAgICAvLyBKYXZhIGltcGxlbWVudGF0aW9uCiAgICBMb2cuaW5mbygiVXNpbmcgWE1MRE9NIGltcGxlbWVudGF0aW9uOiBKYXZhIik7CiAgICB2YXIgWE1MRE9NID0gKCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGRvY0J1aWxkZXJGYWMgPSBQYWNrYWdlcy5qYXZheC54bWwucGFyc2Vycy5Eb2N1bWVudEJ1aWxkZXJGYWN0b3J5Lm5ld0luc3RhbmNlKCk7CiAgICAgICAgZG9jQnVpbGRlckZhYy5uYW1lc3BhY2VBd2FyZSA9IHRydWU7CiAgICAgICAgdmFyIGRvY0J1aWxkZXIgPSBkb2NCdWlsZGVyRmFjLm5ld0RvY3VtZW50QnVpbGRlcigpOwogICAgICAgIHZhciBkb21JbXBsZW1lbnRhdGlvbiA9IGRvY0J1aWxkZXIuZ2V0RE9NSW1wbGVtZW50YXRpb24oKTsKICAgICAgICB2YXIgbHNTZXJpYWxpemVyID0gZG9tSW1wbGVtZW50YXRpb24uY3JlYXRlTFNTZXJpYWxpemVyKCk7CiAgICAgICAgdmFyIEJvb2xlYW4gPSBQYWNrYWdlcy5qYXZhLmxhbmcuQm9vbGVhbjsKICAgICAgICBsc1NlcmlhbGl6ZXIuZG9tQ29uZmlnLnNldFBhcmFtZXRlciggInhtbC1kZWNsYXJhdGlvbiIsIEJvb2xlYW4uRkFMU0UgKTsKCiAgICAgICAgdmFyIERPTVBhcnNlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHBhcnNlRnJvbVN0cmluZzogZnVuY3Rpb24gKCB4bWxTdHJpbmcgKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGlzID0gbmV3IFBhY2thZ2VzLm9yZy54bWwuc2F4LklucHV0U291cmNlKCBuZXcgUGFja2FnZXMuamF2YS5pby5TdHJpbmdSZWFkZXIoIHhtbFN0cmluZyApICk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGRvY3VtZW50ID0gZG9jQnVpbGRlci5wYXJzZSggaXMgKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZG9jdW1lbnQ7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdG9YbWxTdHJpbmc6IGZ1bmN0aW9uICggZG9jICkgewogICAgICAgICAgICAgICAgICAgIGlmICggZG9jICkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgeG1sID0gbHNTZXJpYWxpemVyLndyaXRlVG9TdHJpbmcoIGRvYyApOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geG1sOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICB9OwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIERPTVBhcnNlcjogRE9NUGFyc2VyLAogICAgICAgICAgICBET01JbXBsZW1lbnRhdGlvbjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBjcmVhdGVEb2N1bWVudDogZnVuY3Rpb24gKCBuYW1lc3BhY2VVUkksIHF1YWxpZmllZE5hbWUsIGRvY3R5cGUgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IDM7IGkrKyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggYXJndW1lbnRzW2ldID09IHVuZGVmaW5lZCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHNbaV0gPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkb21JbXBsZW1lbnRhdGlvbi5jcmVhdGVEb2N1bWVudCggYXJndW1lbnRzWzBdLCBhcmd1bWVudHNbMV0sIGFyZ3VtZW50c1syXSApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfSkoKTsKfQoKCi8qKiBQcm92aWRlcyBhbiBpbXBsZW1lbnRhdGlvbiBvZiBhIERPTVBhcnNlci4KICogCiAqIFRoaXMgcHJvdmlkZXMgYW4gaW1wbGVtZW50YXRpb24gb2YgdGhlIHtAbGluayBodHRwOi8vZG9tcGFyc2luZy5zcGVjLndoYXR3Zy5vcmcvI3RoZS1kb21wYXJzZXItaW50ZXJmYWNlfERPTVBhcnNlciBpbnRlcmZhY2V9LiBZb3UgbW9zdGx5IHVzZSBpdCB0byBjcmVhdGUgYSBET00gRG9jdW1lbnQgd2l0aCB0aGUgcGFyc2VGcm9tU3RyaW5nIG1ldGhvZC4KICogCiAqIEBleGFtcGxlIC8vIEhvdyB0byBjcmVhdGUgYSBzaW1wbGUgWE1MIGRvY3VtZW50IGZyb20gYSBzdHJpbmcKdXNlKCAiWE1MRE9NIiApOwp2YXIgZG9jID0gKG5ldyBYTUxET00uRE9NUGFyc2VyKCkpLnBhcnNlRnJvbVN0cmluZyggIjxzb21lPnhtbDwvc29tZT4iICk7CiAqCiAqIAogKiBAY29uc3RydWN0b3IKICogQG5hbWUgWE1MRE9NLkRPTVBhcnNlciAKICovCgovKiogUHJvdmlkZXMgYW4gaW1wbGVtZW50YXRpb24gb2YgdGhlIERPTUltcGxlbWVudGF0aW9uIGludGVyZmFjZS4KICogCiAqIFRoZSBET01JbXBsZW1lbnRhdGlvbiBpbnRlcmZhY2UgcmVwcmVzZW50IGFuIG9iamVjdCBwcm92aWRpbmcgbWV0aG9kcyB3aGljaCBhcmUgbm90IGRlcGVuZGVudCBvbiBhbnkgcGFydGljdWxhciBkb2N1bWVudC4gU3VjaCBhbiBvYmplY3QgaXMgcmV0dXJuZWQgYnkgdGhlIERvY3VtZW50LmltcGxlbWVudGF0aW9uIHByb3BlcnR5LgogKiAKICogKipOb3RlOioqIFRoaXMgaXMgcmFyZWx5IHVzZWQsIEkgdGhpbmsuCiAqIAogKiBAZXhhbXBsZSAvLyBIb3cgdG8gdXNlIHRoZSBET01JbXBsZW1lbnRhdGlvbiB0byBjcmVhdGUgYSBkb2N1bWVudAp1c2UoICJYTUxET00iICk7CnZhciBkb21pID0gbmV3IFhNTERPTS5ET01JbXBsZW1lbnRhdGlvbigpOwovLyBDcmVhdGUgbmV3IGVtcHR5IGRvY3VtZW50Lgp2YXIgZG9jID0gZG9taS5jcmVhdGVEb2N1bWVudCgpOwogKgogKiAKICogQGNvbnN0cnVjdG9yCiAqIEBuYW1lIFhNTERPTS5ET01JbXBsZW1lbnRhdGlvbgogKi8KCi8qKiBQcm92aWRlcyBhIHNlcmlhbGl6ZXIgdGhhdCBjYW4gY29udmVydCBET00gc3VidHJlZSBvciBkb2N1bWVudCBpbnRvIHRleHQuCiAqCiAqIFhNTFNlcmlhbGl6ZXIgY2FuIGJlIHVzZWQgdG8gY29udmVydCBET00gc3VidHJlZSBvciBET00gZG9jdW1lbnQgaW50byB0ZXh0LgogKiAKICogQGV4YW1wbGUgLy8gSG93IHRvIHNlcmlhbGl6ZSBhIGRvY3VtZW50CnVzZSggIlhNTERPTSIgKTsKdmFyIGRvYyA9IChuZXcgWE1MRE9NLkRPTVBhcnNlcigpKS5wYXJzZUZyb21TdHJpbmcoICI8c29tZT54bWw8L3NvbWU+IiApOwovLyBBZGQgYW4gImVkaXRpb24iIGVsZW1lbnQKZG9jLmRvY3VtZW50RWxlbWVudC5hcHBlbmRDaGlsZCggZG9jLmNyZWF0ZUVsZW1lbnQoICJlZGl0aW9uIiApICk7Ci8vIENyZWF0ZSBhIHNlcmlhbGl6ZXIKdmFyIHhtbHMgPSBuZXcgWE1MRE9NLlhNTFNlcmlhbGl6ZXIoKTsKLy8gU2VyaWFsaXNlIHdob2xlIGVsZW1lbnQgLSByZXR1cm5zIDxzb21lPnhtbDxlZGl0aW9uLz48L3NvbWU+CnhtbHMuc2VyaWFsaXplVG9TdHJpbmcoIGRvYyApOwogKiAKICogQGNvbnN0cnVjdG9yCiAqIEBuYW1lIFhNTERPTS5YTUxTZXJpYWxpemVyICAKKi8K", "moduleName": "XMLDOM"}, {"javascript": "Ly8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpFWFBPUlRFRF9TWU1CT0xTID0gWyAnRW5naW5lJyBdOwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovKioKICoKICoKICogQGNvbnN0cnVjdG9yCiAqLwp2YXIgRW5naW5lID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgU1BJREVSTU9OS0VZID0gInNwaWRlcm1vbmtleSI7CiAgICB2YXIgUkhJTk8gPSAicmhpbm8iOwogICAgdmFyIE5BU0hPUk4gPSAibmFzaG9ybiI7CgogICAgZnVuY3Rpb24gaXNFbmdpbmUoIG5hbWUgKSB7CiAgICAgICAgc3dpdGNoKCBuYW1lICkgewogICAgICAgICAgICBjYXNlIFJISU5POiB7CiAgICAgICAgICAgICAgICByZXR1cm4gKCB0eXBlb2YgUGFja2FnZXMgPT09ICJvYmplY3QiICkgJiYgKCB0eXBlb2YgUGFja2FnZXMuamF2YSA9PT0gIm9iamVjdCIgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2FzZSBOQVNIT1JOOiB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mKCBfX2Vudmlyb25tZW50ICkgPT09ICJvYmplY3QiOwogICAgICAgICAgICB9CgogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgICBpZiggbmFtZSAhPT0gU1BJREVSTU9OS0VZICkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gIWlzRW5naW5lKCBSSElOTyApICYmICFpc0VuZ2luZSggTkFTSE9STiApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgJ1NQSURFUk1PTktFWSc6IFNQSURFUk1PTktFWSwKICAgICAgICAnUkhJTk8nOiBSSElOTywKICAgICAgICAnTkFTSE9STic6IE5BU0hPUk4sCiAgICAgICAgJ2lzRW5naW5lJzogaXNFbmdpbmUKICAgIH0KfSgpOwo=", "moduleName": "Engine"}, {"javascript": "LyoqIEBmaWxlIFByb3ZpZGUgRE9NIDMgWFBhdGggaW1wbGVtZW50YXRpb24uICovCkVYUE9SVEVEX1NZTUJPTFMgPSBbICdYUGF0aCcgXTsKCnVzZSggIlhtbE5hbWVzcGFjZXMiICk7CnVzZSggIlV0aWwiICk7CnVzZSggIkxvZyIgKTsKdXNlKCAiTm9kZVR5cGVzIiApOwp1c2UoICJFbmdpbmUiICk7CgovLyBYUGF0aCB0dXRvcmlhbDogaHR0cDovL3d3dy53M3NjaG9vbHMuY29tL1hQYXRoLwovLyBYUGF0aCByZWZlcmVuY2U6ID8gCgoKLyoqCiAqIFByb3ZpZGVzIGFuIGltcGxlbWVudGF0aW9uIG9mIGFuIERPTSAzIFhQYXRoIGltcGxlbWVudGF0aW9uLgogKiAKICogVGhpcyBtb2R1bGUgYWxsb3dzIHdvcmtpbmcgd2l0aCBYTUwgdXNpbmcgdGhlIHN0YW5kYXJkaXplZCBYUGF0aCBBUEkgZnJvbSBXQzMuIAogKiAKICogVGhlcmUgaXMgYW4gaW50cm9kdWN0aW9uL3R1dG9yaWFsIGZvciB0aGlzLCBoZXJlOiB7QGxpbmsgaHR0cDovL3d3dy53M3NjaG9vbHMuY29tL1hQYXRoL30uCiAqIAogKiBUaGUgYWN0dWFsIGltcGxlbWVudGF0aW9uIGlzIGJhc2VkIG9uIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vZ290bzEwMC94cGF0aH0gKGNsb25lZCBpbnRvIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vREJDREsveHBhdGguZ2l0fSkuCiAqIAogKiBUaGlzIG1vZHVsZSBjb250YWlucyBubyBkb2N1bWVudGF0aW9uIC0geW91IHdpbGwgaGF2ZSB0byBjb25zdWx0IG9ubGluZSBzb3VyY2VzIG9yIHRoZSB0dXRvcmlhbCBhYm92ZSBmb3IgZG9jdW1lbnRhdGlvbi4KICogCiAqICoqTk9URToqKiBUaGlzIG1vZHVsZSBhdXRvbWF0aWNhbGx5IGxvYWRzIHRoZSB7QGxpbmsgWE1MRE9NfSBtb2R1bGUsIHNpbmNlIGl0IGlzIGFzc3VtZWQgdGhhdCB5b3Ugd2lzaCB0byB3b3JrIHdpdGggdGhpcy4KICogCiAqICoqTk9URToqKiBUaGlzIG1vZHVsZSBkZXBlbmRzIG9uIGEgQ29tbW9uSlMvTW9kdWxlcy8xLjAgbW9kdWxlLCB0aGF0IGxpdmVzIGFzIGEgc3ViZGlyZWN0b3J5IHRvIHRoZSBqc2NvbW1vbiBleHRlcm5hbHMgbW9kdWxlLiBFcnJvcnMgbGlrZSAiRXJyb3I6IFJlcXVpcmUucmVxdWlyZSwgdW5hYmxlIHRvIHJlc29sdmUgKCcnLCAneHBhdGgnKSB0byBhIG1vZHVsZS4gKFJlcXVpcmUudXNlLmpzIzM3OSkiIGluZGljYXRlcyB0aGF0CiAqIHRoZSBzZWFyY2ggcGF0aHMgbmVlZHMgdG8gaGF2ZSB0aGlzIHNldCAoaW4gYWJzb2x1dGUgb3IgcmVsYXRpdmUgZm9ybWF0OiBzZWUge0BsaW5rIFJlcXVpcmV9IGZvciBtb3JlIGluZm9ybWF0aW9uKS4gCiAqIAogKiBAZXhhbXBsZSAvLyBSZWFkIHRoZSB0aXRsZSBmcm9tIGEgc2ltcGxlIHhtbCBkb2N1bWVudAp1c2UoICJYUGF0aCIgKTsKdmFyIHhtbFN0cmluZyA9ICI8Ym9vaz48dGl0bGU+SGFycnkgUG90dGVyPC90aXRsZT48L2Jvb2s+IjsKLy8gQ3JlYXRlIGEgRE9NIGRvY3VtZW50IGZyb20gdGhlIHN0cmluZy4KdmFyIGRvYyA9IChuZXcgWE1MRE9NLkRPTVBhcnNlcigpKS5wYXJzZUZyb21TdHJpbmcoeG1sU3RyaW5nKTsKLy8gR2V0IGFsbCB0aXRsZSBub2Rlcwp2YXIgbm9kZXMgPSBYUGF0aC5zZWxlY3QoIi8vdGl0bGUiLCBkb2MpOwovLyBMb2NhbG5hbWUgYW5kIGRhdGEgPT4gdGl0bGU6IEhhcnJ5IFBvdHRlcgpub2Rlc1swXS5ub2RlTmFtZSArICI6ICIgKyBub2Rlc1swXS5maXJzdENoaWxkLm5vZGVWYWx1ZTsKLy8gTm9kZSBub2RlOiA8dGl0bGU+SGFycnkgUG90dGVyPC90aXRsZT4KIm5vZGU6ICIgKyBub2Rlc1swXS50b1N0cmluZygpOwogKgogKiBAbmFtZXNwYWNlCiAqIEBuYW1lIFhQYXRoCiAqLwp2YXIgWFBhdGggPSAoZnVuY3Rpb24oKSB7CiAgICB2YXIgdGhhdDsKICAgIAogICAgLy8gRmxhZyB0byB1c2UgamF2YSBvciBqYXZhc2NyaXB0IFhQQVRIIGltcGxlbWVudGF0aW9uCiAgICAvLyBDb250cm9sbGVkIGJ5IGVudmlyb25tZW50IHZhcmlhYmxlIFVTRV9KQVZBX1hQQVRIIG9yIGJ5IHB1dHRpbmcgdGhlIGdsb2JhbCBwcm9wZXJ0eQogICAgLy8gX19VU0VfSkFWQV9YUEFUSCBpbiB0aGUgamF2YXNjcmlwdCBlbnZpcm9ubWVudAogICAgLy8gRGVmYXVsdHMgdG8gdXNlIEphdmFzY3JpcHQgRE9NIGltcGxlbWVudGF0aW9uCiAgICB2YXIgX191c2VfamF2YV94cGF0aCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICggISBFbmdpbmUuaXNFbmdpbmUoRW5naW5lLk5BU0hPUk4pICkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHZhciBzeXN0ZW0gPSBQYWNrYWdlcy5qYXZhLmxhbmcuU3lzdGVtOwogICAgICAgIHZhciB2YWx1ZSA9IHN5c3RlbS5nZXRlbnYoIlVTRV9KQVZBX1hQQVRIIik7CiAgICAgICAgTG9nLmRlYnVnKCAiRW52aXJvbm1lbnQgdmFyaWFibGU6IFVTRV9KQVZBX1hQQVRIOiAiLCBMb2cuc2FmZVZhbHVlKCB2YWx1ZSApICk7CgogICAgICAgIHZhciBnbG9iYWwgPSB0aGlzLmhhc093blByb3BlcnR5KCAiX19VU0VfSkFWQV9YUEFUSCIgKSAmJiBfX1VTRV9KQVZBX1hQQVRIOwogICAgICAgIExvZy5kZWJ1ZyggIkdsb2JhbCA6IF9fVVNFX0pBVkFfWFBBVEg6ICIsIExvZy5zYWZlVmFsdWUoIGdsb2JhbCApICk7CiAgICAgICAgCiAgICAgICAgaWYoIHN5c3RlbS5nZXRlbnYoIlVTRV9KQVZBX1hQQVRIIikgPT09IG51bGwgJiYgCiAgICAgICAgICAgICAgICB0aGlzLmhhc093blByb3BlcnR5KCAiX19VU0VfSkFWQV9YUEFUSCIgKSA9PT0gZmFsc2UgKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOyAvLyBkZWZhdWx0CiAgICAgICAgfQoKICAgICAgICBpZiAoIGdsb2JhbCB8fCAoIHZhbHVlICYmIEpTT04ucGFyc2UoIHZhbHVlICkgKSApIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH07CgogICAgaWYgKCAhX191c2VfamF2YV94cGF0aCgpICkgewogICAgICAgIExvZy5pbmZvKCJVc2luZyBYUEFUSCBpbXBsZW1lbnRhdGlvbjogSmF2YXNjcmlwdCIpOwogICAgICAgIC8vIE9ubHkgbG9hZCByZXF1aXJlIG1vZHVsZXMgaWYgJ3JlcXVpcmVkJwogICAgICAgIHVzZSggIlJlcXVpcmUiICk7CiAgICAgICAgdGhhdCA9IHJlcXVpcmUoICJ4cGF0aCIgKTsKICAgICAgICB0aGF0LnNlbGVjdEltcGwgPSB0aGF0LnVzZU5hbWVzcGFjZXMoWG1sTmFtZXNwYWNlcy5uYW1lc3BhY2VNYXApOwogICAgICAgIC8vIFNhdmUgb3JpZ2luYWwgc2VsZWN0IG1ldGhvZCBpbiBjYXNlIGl0IGlzIG5lZWRlZAogICAgICAgIHRoYXQuc2VsZWN0T3JpZ2luYWwgPSB0aGF0LnNlbGVjdDsKCiAgICB9IGVsc2UgewogICAgICAgIExvZy5pbmZvKCJVc2luZyBYUEFUSCBpbXBsZW1lbnRhdGlvbjogSmF2YSIpOwogICAgICAgIHRoYXQgPSB7fTsKICAgICAgICB2YXIgZmFjdG9yeSA9IFBhY2thZ2VzLmphdmF4LnhtbC54cGF0aC5YUGF0aEZhY3RvcnkubmV3SW5zdGFuY2UoKTsKICAgICAgICB2YXIgeFBhdGggPSBmYWN0b3J5Lm5ld1hQYXRoKCk7CiAgICAgICAgdmFyIFhQYXRoQ29uc3RhbnRzID0gIFBhY2thZ2VzLmphdmF4LnhtbC54cGF0aC5YUGF0aENvbnN0YW50czsKICAgICAgICAKICAgICAgICAvLyBtYXAgeHBhdGggZnVuY3Rpb25zIHRvIHJldHVybiB0eXBlCiAgICAgICAgdmFyIHJldHVyblR5cGVzID0gewogICAgICAgICAgICAiYm9vbGVhbiI6IFhQYXRoQ29uc3RhbnRzLkJPT0xFQU4sCiAgICAgICAgICAgICJub3QiOiBYUGF0aENvbnN0YW50cy5CT09MRUFOLAogICAgICAgICAgICAidHJ1ZSI6IFhQYXRoQ29uc3RhbnRzLkJPT0xFQU4sCiAgICAgICAgICAgICJmYWxzZSI6IFhQYXRoQ29uc3RhbnRzLkJPT0xFQU4sCiAgICAgICAgICAgICJib29sZWFuLWZyb20tc3RyaW5nIjogWFBhdGhDb25zdGFudHMuQk9PTEVBTiwKICAgICAgICAgICAgImlmIjogWFBhdGhDb25zdGFudHMuQk9PTEVBTiwKICAgICAgICAgICAgCiAgICAgICAgICAgICJzdHJpbmciOiBYUGF0aENvbnN0YW50cy5TVFJJTkcsCiAgICAgICAgICAgICJjb25jYXQiOiBYUGF0aENvbnN0YW50cy5TVFJJTkcsCiAgICAgICAgICAgICJzdGFydHMtd2l0aCI6IFhQYXRoQ29uc3RhbnRzLlNUUklORywKICAgICAgICAgICAgImNvbnRhaW5zIjogWFBhdGhDb25zdGFudHMuU1RSSU5HLAogICAgICAgICAgICAic3Vic3RyaW5nLWJlZm9yZSI6IFhQYXRoQ29uc3RhbnRzLlNUUklORywKICAgICAgICAgICAgInN1YnN0cmluZy1hZnRlciI6IFhQYXRoQ29uc3RhbnRzLlNUUklORywKICAgICAgICAgICAgInN1YnN0cmluZyI6IFhQYXRoQ29uc3RhbnRzLlNUUklORywKICAgICAgICAgICAgIm5vcm1hbGl6ZS1zcGFjZSI6IFhQYXRoQ29uc3RhbnRzLlNUUklORywKICAgICAgICAgICAgInRyYW5zbGF0ZSI6IFhQYXRoQ29uc3RhbnRzLlNUUklORywKICAgICAgICAgICAgImxvd2VyLWNhc2UiOiBYUGF0aENvbnN0YW50cy5TVFJJTkcsCiAgICAgICAgICAgICJ1cHBlci1jYXNlIjogWFBhdGhDb25zdGFudHMuU1RSSU5HLAogICAgICAgICAgICAiZW5kcy13aXRoIjogWFBhdGhDb25zdGFudHMuU1RSSU5HLAogICAgICAgICAgICAibG9jYWwtbmFtZSI6IFhQYXRoQ29uc3RhbnRzLlNUUklORywKICAgICAgICAgICAgIm5hbWVzcGFjZS11cmkiOiBYUGF0aENvbnN0YW50cy5TVFJJTkcsCiAgICAgICAgICAgICJuYW1lIjogWFBhdGhDb25zdGFudHMuU1RSSU5HLAogICAgICAgICAgICAKICAgICAgICAgICAgImNvdW50IjogWFBhdGhDb25zdGFudHMuTlVNQkVSLAogICAgICAgICAgICAic3RyaW5nLWxlbmd0aCI6IFhQYXRoQ29uc3RhbnRzLk5VTUJFUiwKICAgICAgICAgICAgImxhc3QiOiBYUGF0aENvbnN0YW50cy5OVU1CRVIsCiAgICAgICAgICAgICJwb3NpdGlvbiI6IFhQYXRoQ29uc3RhbnRzLk5VTUJFUiwKICAgICAgICAgICAgInN1bSI6IFhQYXRoQ29uc3RhbnRzLk5VTUJFUiwKICAgICAgICAgICAgImZsb29yIjogWFBhdGhDb25zdGFudHMuTlVNQkVSLAogICAgICAgICAgICAiY2VpbGluZyI6IFhQYXRoQ29uc3RhbnRzLk5VTUJFUiwKICAgICAgICAgICAgInJvdW5kIjogWFBhdGhDb25zdGFudHMuTlVNQkVSLAogICAgICAgICAgICAiYXZnIjogWFBhdGhDb25zdGFudHMuTlVNQkVSLAogICAgICAgICAgICAibWluIjogWFBhdGhDb25zdGFudHMuTlVNQkVSLAogICAgICAgICAgICAibWF4IjogWFBhdGhDb25zdGFudHMuTlVNQkVSLAogICAgICAgICAgICAiY291bnQtbm90LWVtcHR5IjogWFBhdGhDb25zdGFudHMuTlVNQkVSLAogICAgICAgICAgICAKICAgICAgICAgICAgImlkIjogWFBhdGhDb25zdGFudHMuTk9ERVNFVCwKICAgICAgICAgICAgImV2YWx1YXRlIjogWFBhdGhDb25zdGFudHMuTk9ERVNFVCwKICAgICAgICAgICAgIm1hdGNoIjogWFBhdGhDb25zdGFudHMuTk9ERVNFVCwKICAgICAgICAgICAgImluc3RhbmNlIjogWFBhdGhDb25zdGFudHMuTk9ERVNFVAogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgdmFyIGNvbnRleHQgPSB7CiAgICAgICAgICAgIGdldE5hbWVzcGFjZVVSSTogZnVuY3Rpb24oIHByZWZpeCApIHsgCgogICAgICAgICAgICAgICAgaWYoICFwcmVmaXggKSB7IAogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oIk51bGwgcHJlZml4Iik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyIHVyaSA9IFhtbE5hbWVzcGFjZXMubmFtZXNwYWNlTWFwWyBwcmVmaXggXTsKICAgICAgICAgICAgICAgIGlmKCAhdXJpICkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB1cmk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHhQYXRoLnNldE5hbWVzcGFjZUNvbnRleHQoIG5ldyBQYWNrYWdlcy5qYXZheC54bWwubmFtZXNwYWNlLk5hbWVzcGFjZUNvbnRleHQoIGNvbnRleHQgKSApOwogICAgICAgIAogICAgICAgIAogICAgICAgIHRoYXQuZ2V0UmV0dXJuVHlwZSA9IGZ1bmN0aW9uICggeHBhdGggKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICB2YXIgb3BlcmF0aW9uID0geHBhdGgubWF0Y2goIC8oXlx3Kylccz9cKC8gKTsKICAgICAgICAgICAgaWYoIG9wZXJhdGlvbiApIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5UeXBlc1sgb3BlcmF0aW9uWzFdIF07CiAgICAgICAgICAgIH0KCiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRoYXQuc2VsZWN0SW1wbCA9IGZ1bmN0aW9uICggeHBhdGgsIHhtbE5vZGUsIHNpbmdsZSApIHsKICAgICAgICAgICAgdmFyIHJlc3VsdDsKICAgICAgICAgICAgdmFyIHJldHVyblR5cGUgPSBYUGF0aENvbnN0YW50cy5OT0RFU0VUOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRGVyaXZlIHRoZSByZXR1cm4gdHlwZSBmcm9tIHhwYXRoIHF1ZXJ5LiAKICAgICAgICAgICAgLy8gSmF2YSdzIFhQYXRoIGV2YWx1YXRlIG1ldGhvZCByZXF1aXJlcyBhIHJldHVybiB0eXBlIGFyZ3VtZW50ICh1bmxlc3MgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gaXMgd2FudGVkKS4KICAgICAgICAgICAgLy8gSGVuY2UgdGhlIHhwYXRoIHF1ZXJ5IGlzIGNoZWNrZWQsIHRvIHNlZSBpZiBhbiBYUGF0aCBmdW5jdGlvbiBpcyB3cmFwcGluZyB0aGUgbm9kZSBzZWxlY3Rpb24uCiAgICAgICAgICAgIC8vIEZ4ICdjb3VudCgvL2NoaWxkKScgcmV0dXJucyBhIFhQYXRoQ29uc3RhbnRzLk5VTUJFUgogICAgICAgICAgICB2YXIgZnVuY1N0ciA9IHhwYXRoLm1hdGNoKCAvXlxzKihcdyspXHMqXCgvICk7CiAgICAgICAgICAgIGlmKCBmdW5jU3RyICkgewogICAgICAgICAgICAgICAgLy8gTG9nLnRyYWNlKCJYUGF0aCBmdW5jdGlvbiB3cmFwcyBub2RlIHNlbGVjdGlvbi4gZnVuY3Rpb246JyIsIGZ1bmNTdHJbMV0sICInLCBYUGF0aCBxdWVyeTogJyIsIHhwYXRoLCAiJyIpOwogICAgICAgICAgICAgICAgcmV0dXJuVHlwZSA9IHJldHVyblR5cGVzWyBmdW5jU3RyWzFdIF0gfHwgWFBhdGhDb25zdGFudHMuTk9ERVNFVDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiggc2luZ2xlID09PSB0cnVlICYmIHJldHVyblR5cGUgPT09IFhQYXRoQ29uc3RhbnRzLk5PREVTRVQgKSB7CiAgICAgICAgICAgICAgICByZXR1cm5UeXBlID0gWFBhdGhDb25zdGFudHMuTk9ERTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBMb2cudHJhY2UoIlhQYXRoIHJldHVybiB0eXBlOiAnIiwgcmV0dXJuVHlwZSwgIicsIFhQYXRoIHF1ZXJ5OiAnIiwgeHBhdGgsICInIik7CgogICAgICAgICAgICAvLyBUT0RPOiBDYWNoZSBjb21waWxlZCB4cGF0aD8KICAgICAgICAgICAgcmVzdWx0ID0geFBhdGguY29tcGlsZSggeHBhdGggKS5ldmFsdWF0ZSggeG1sTm9kZSwgcmV0dXJuVHlwZSApOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYoIHJldHVyblR5cGUgPT09ICBYUGF0aENvbnN0YW50cy5OT0RFU0VUICkgewogICAgICAgICAgICAgICAgdmFyIG5vZGVzID0gW107CiAgICAgICAgICAgICAgICBmb3IoIHZhciBpID0gMDsgaSA8IHJlc3VsdC5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgICAgICAgICBub2Rlcy5wdXNoKCByZXN1bHQuaXRlbSggaSApICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXN1bHQgPSBub2RlczsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0ID09PSBudWxsID8gdW5kZWZpbmVkIDogcmVzdWx0OwogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9OwogICAgfQoKICAgIHRoYXQuX190aHJvd0Vycm9yID0gZnVuY3Rpb24oZXJyb3IpIHsKICAgICAgICBMb2cuZXJyb3IoZXJyb3IpOwogICAgICAgIHRocm93IEVycm9yKGVycm9yKTsKICAgIH07CgogICAgLy8gTXVzdCBiZSBkdXBsaWNhdGVkIGhlcmUgdG8gYXZvaWQgY3ljbGljIGRlcGVuZGVuY2llcwogICAgdGhhdC5fX2lzWG1sID0gZnVuY3Rpb24ocG9zaWJsZVhtbCkgewogICAgICAgIHJldHVybiBwb3NpYmxlWG1sLm5vZGVUeXBlICE9PSB1bmRlZmluZWQgJiYgKHR5cGVvZiBwb3NpYmxlWG1sLm5vZGVUeXBlKSA9PT0gIm51bWJlciI7CiAgICB9OwogICAgCiAgICAvKioKICAgICAqIFhQYXRoIHNlbGVjdG9yIGZ1bmN0aW9uIHdpdGggc3VwcG9ydCBmb3IgYWxsIGN1cnJlbnRseSBrbm93biBuYW1lc3BhY2VzLgogICAgICoKICAgICAqIFNlbGVjdCBub2RlcyBpbiB0aGUgeG1sIGRvY3VtZW50IGJhc2VkIG9uIFhQYXRoIGV4cHJlc3Npb24uCiAgICAgKgogICAgICogU2VlIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMDAvUkVDLURPTS1MZXZlbC0yLUNvcmUtMjAwMDExMTMvY29yZS5odG1sI0lELTE5NTA2NDEyNDcKICAgICAqIGZvciBub2RlIGFuZCBzdWJjbGFzc2VzIGludGVyZmFjZQogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhQYXRoLnNlbGVjdAogICAgICogQHN5bnRheCBYUGF0aC5zZWxlY3QoeHBhdGgsIHhtbE5vZGUpCiAgICAgKiBAcGFyYW0ge3N0cmluZ30geHBhdGggZXhwcmVzc2lvbiB0byBzZWxlY3QKICAgICAqIEBwYXJhbSB7Tm9kZX0geG1sTm9kZSBkb2N1bWVudCB0byBzZWxlY3QgaW4KICAgICAqIEBwYXJhbSB7Ym9vbGVhbnx1bmRlZmluZWR9IHNpbmdsZSBSZXR1cm4gYSBzaW5nbGUgbm9kZSBpbiBzdGVhZCBvZiBhbiBhcnJheSBvZiBub2RlcyAob3B0aW9uYWwpCiAgICAgKiBAcmV0dXJuIHtOb2RlW119IG5vZGVzIG1hdGNoaW5nIGV4cHJlc3Npb24uIEVtcHR5IGlmIG5vdGhpbmcgbWF0Y2hlcwogICAgICogQGV4YW1wbGUKICAgICAqIHZhciBub2RlcyA9IFhQYXRoLnNlbGVjdCgiL3Jvb3QvY2hpbGQiLCBkb2MpCiAgICAgKiBAZXhhbXBsZQogICAgICogdmFyIHRleHQgPSBYUGF0aC5zZWxlY3QoIi9yb290L2NoaWxkWzFdL3RleHQoKSIsIGRvYywgdHJ1ZSkubm9kZVZhbHVlCiAgICAgKi8KICAgIHRoYXQuc2VsZWN0ID0gZnVuY3Rpb24oeHBhdGgsIHhtbE5vZGUsIHNpbmdsZSl7CiAgICAgICAgLy8gTG9nLnRyYWNlKCJFbnRlcmluZyBYUGF0aC5zZWxlY3QsIHhwYXRoOiciLCB4cGF0aCwgIiciKTsKLy8gICAgICAgIExvZy50cmFjZSgiRW50ZXJpbmcgWFBhdGguc2VsZWN0LCB4cGF0aDonIiwgeHBhdGgsICInLCBmcm9tICIsIHhtbE5vZGUpOwovLyAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHhwYXRoID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHZhciBtc2cgPSAiWFBhdGguc2VsZWN0OiB4cGF0aCBhcmd1bWVudCBtaXNzaW5nIjsKICAgICAgICAgICAgICAgIExvZy5lcnJvcihtc2cpOwogICAgICAgICAgICAgICAgdGhhdC5fX3Rocm93RXJyb3IobXNnKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgaWYgKHhtbE5vZGUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgdmFyIG1zZyA9ICJYUGF0aC5zZWxlY3Q6IHhtbE5vZGUgYXJndW1lbnQgbWlzc2luZyI7CiAgICAgICAgICAgICAgICBMb2cuZXJyb3IobXNnKTsKICAgICAgICAgICAgICAgIHRoYXQuX190aHJvd0Vycm9yKG1zZyk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBpZiAoISB0aGF0Ll9faXNYbWwoeG1sTm9kZSkgKSB7CiAgICAgICAgICAgICAgICB2YXIgbXNnID0gIlhQYXRoLnNlbGVjdDogeG1sTm9kZSBpcyBub3QgYW4gWE1MRE9NIG5vZGU6ICIgKyBVdGlsLmdldFR5cGUoeG1sTm9kZSk7CiAgICAgICAgICAgICAgICBMb2cuZXJyb3IobXNnKTsKICAgICAgICAgICAgICAgIHRoYXQuX190aHJvd0Vycm9yKG1zZyk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gdGhhdC5zZWxlY3RJbXBsKHhwYXRoLCB4bWxOb2RlLCBzaW5nbGUpOwovLyAgICAgICAgICAgICAgICBMb2cudHJhY2UoIlhQYXRoLnNlbGVjdCwgcmV0dXJuaW5nICIsIChyZXN1bHQpID8gcmVzdWx0IDogIi0tbm90aGluZy0tIik7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgTG9nLmVycm9yKCJYUGF0aC5zZWxlY3QsIENhdWdodCBleGNlcHRpb24gd2hpbGUgc2VsZWN0aW5nICciLCB4cGF0aCwgIicgZnJvbSAiLCBYbWxVdGlsLmxvZ1htbFN0cmluZyh4bWxOb2RlKSwgIi4gRXJyb3IgaXMgIiwgZXJyb3IpOwogICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7CiAgICAgICAgICAgIH0KLy8gICAgICAgIH0gZmluYWxseSB7Ci8vICAgICAgICAgICAgTG9nLnRyYWNlKCJMZWF2aW5nIFhQYXRoLnNlbGVjdCIpOwovLyAgICAgICAgfQogICAgfTsKICAgIAogICAgLyoqCiAgICAgKiBTZWxlY3QgdGhlIGZpcnN0IG5vZGUgdGhhdCBtYXRjaGVzIHRoZSBzcGVjaWZpZWQgeHBhdGguCiAgICAgKgogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgWFBhdGguc2VsZWN0Tm9kZQogICAgICogQHN5bnRheCBYUGF0aC5zZWxlY3ROb2RlKHhwYXRoLCB4bWxOb2RlKQogICAgICogQHBhcmFtIHtzdHJpbmd9IHhwYXRoIGV4cHJlc3Npb24gdG8gbWF0Y2gKICAgICAqIEBwYXJhbSB7Tm9kZX0geG1sTm9kZSBEb2N1bWVudCB0byBtYXRjaCB4cGF0aCBpbgogICAgICogQHJldHVybiB7Tm9kZXx1bmRlZmluZWR9IFRoZSBmaXJzdCBub2RlIHRoYXQgbWF0Y2hlcyB0aGUgcGF0aCBvciB1bmRlZmluZWQgaWYgbm8gbm9kZSBtYXRjaGVzCiAgICAgKiBAZXhhbXBsZQogICAgICogWFBhdGguc2VsZWN0Tm9kZSgiL3Jvb3QvY2hpbGQiLCBkb2MpCiAgICAqLwogICAgdGhhdC5zZWxlY3ROb2RlID0gZnVuY3Rpb24oeHBhdGgsIHhtbE5vZGUpewovLyAgICAgICAgTG9nLnRyYWNlKCJFbnRlcmluZyBYUGF0aC5zZWxlY3ROb2RlIik7Ci8vICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgbm9kZSA9IHRoYXQuc2VsZWN0KHhwYXRoLCB4bWxOb2RlLCB0cnVlKTsKICAgICAgICAgICAgLy8gaWYgKG5vZGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAvLyAgICAgTG9nLnRyYWNlKCJYUGF0aC5zZWxlY3ROb2RlLCBub2RlOiAnIiwgbm9kZS5ub2RlTmFtZSwgIiciKTsKICAgICAgICAgICAgLy8gfQogICAgICAgICAgICByZXR1cm4gbm9kZTsKLy8gICAgICAgIH0gZmluYWxseSB7Ci8vICAgICAgICAgICAgTG9nLnRyYWNlKCJMZWF2aW5nIFhQYXRoLnNlbGVjdE5vZGUiKTsKLy8gICAgICAgIH0KICAgIH07CiAgICAKICAgICAvKioKICAgICAqIFNlbGVjdCB0ZXh0IGNvbnRlbnQgZnJvbSB0aGUgZmlyc3Qgbm9kZSB0aGF0IG1hdGNoZXMgdGhlIHNwZWNpZmllZCBYUGF0aAogICAgICoKICAgICAqICoqTk9URToqKiBOb2RlcyBzZWxlY3RlZCBieSB4cGF0aCBhcmUgbm90IHJldHVybmVkIGluIGFueSBwYXJ0aWN1bGFyIG9yZGVyLgogICAgICogVGhlIG9yZGVyIG9mIGZvdW5kIG5vZGVzIG1heSBub3QgYmUgdGhlIG9yZGVyIHRoZXkgYXBwZWFyIGluIHRoZSBkb2N1bWVudC4KICAgICAqIFRvIHNwZWNpZnkgYSBwYXJ0aWN1bGFyIG5vZGUgaW4gdGhlIGRvY3VtZW50IG9yZGVyIHVzZSBlLmcuIFsxXSBpbiB0aGUgeHBhdGggZXhwcmVzc2lvbgogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhQYXRoLnNlbGVjdFRleHQKICAgICAqIEBzeW50YXggWFBhdGguc2VsZWN0VGV4dCh4cGF0aCwgeG1sTm9kZSkKICAgICAqIEBwYXJhbSB7c3RyaW5nfSB4cGF0aCBleHByZXNzaW9uIHRvIG1hdGNoCiAgICAgKiBAcGFyYW0ge05vZGV9IHhtbE5vZGUgRG9jdW1lbnQgdG8gbWF0Y2ggeHBhdGggaW4KICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IGNvbnRlbnQgb2YgZmlyc3Qgc3RyaW5nIG5vZGUgb3IgIiIgaWYgbm8gbm9kZSBvciB0ZXh0IGZvdW5kCiAgICAgKiBAZXhhbXBsZQogICAgICogWFBhdGguc2VsZWN0VGV4dCgiL3Jvb3QvY2hpbGQiLCBkb2MpCiAgICAgKi8KICAgIHRoYXQuc2VsZWN0VGV4dCA9IGZ1bmN0aW9uKHhwYXRoLCB4bWxOb2RlKXsKLy8gICAgICAgIExvZy50cmFjZSgiRW50ZXJpbmcgWFBhdGguc2VsZWN0VGV4dCIpOwovLyAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gQXBwZW5kIC90ZXh0KCkgaWYgbmVjZXNzYXJ5CiAgICAgICAgICAgIHZhciBub2RlID0gdGhhdC5zZWxlY3ROb2RlKHhwYXRoLCB4bWxOb2RlKTsKCiAgICAgICAgICAgIHZhciB0ZXh0ID0gIiI7CiAgICAgICAgICAgIGlmIChub2RlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIExvZy5kZWJ1ZygiTm8gbm9kZSBtYXRjaGluZyAnIiwgeHBhdGgsICInIGZvdW5kIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAobm9kZS5ub2RlVHlwZSA9PT0gTm9kZVR5cGVzLlRFWFRfTk9ERSB8fCBub2RlLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuQ0RBVEFfU0VDVElPTl9OT0RFKSB7CiAgICAgICAgICAgICAgICB0ZXh0ID0gbm9kZS5ub2RlVmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAobm9kZS5maXJzdENoaWxkICYmIChub2RlLmZpcnN0Q2hpbGQubm9kZVR5cGUgPT09IE5vZGVUeXBlcy5URVhUX05PREUgfHwgbm9kZS5maXJzdENoaWxkLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuQ0RBVEFfU0VDVElPTl9OT0RFICkgKSB7CiAgICAgICAgICAgICAgICB0ZXh0ID0gbm9kZS5maXJzdENoaWxkLm5vZGVWYWx1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIExvZy5kZWJ1ZygiTm9kZSBpcyBub3QgYSB0ZXh0IG5vZGUgYW5kIGhhcyBubyB0ZXh0IG5vZGUgY2hpbGQiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBMb2cudHJhY2UoIlhQYXRoLnNlbGVjdFRleHQsIHJldHVybmluZzogJyIsIHRleHQsICInIik7CiAgICAgICAgICAgIHJldHVybiB0ZXh0OwovLyAgICAgICAgfSBmaW5hbGx5IHsKLy8gICAgICAgICAgICBMb2cudHJhY2UoIkxlYXZpbmcgWFBhdGguc2VsZWN0VGV4dCIpOwovLyAgICAgICAgfQogICAgfTsKICAgIAogICAgLyoqCiAgICAgKiBTZWxlY3QgdGV4dCBjb250ZW50IGZyb20gdGhlIG11bHRpcGxlIG5vZGVzIHRoYXQgbWF0Y2hlcyB0aGUgc3BlY2lmaWVkIFhQYXRoCiAgICAgKgogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgWFBhdGguc2VsZWN0TXVsdGlwbGVUZXh0CiAgICAgKiBAc3ludGF4IFhQYXRoLnNlbGVjdE11bHRpcGxlVGV4dCh4cGF0aCwgeG1sTm9kZSkKICAgICAqIEBwYXJhbSB7c3RyaW5nfSB4cGF0aCBleHByZXNzaW9uIHRvIG1hdGNoCiAgICAgKiBAcGFyYW0ge05vZGV9IHhtbE5vZGUgRG9jdW1lbnQgdG8gbWF0Y2ggeHBhdGggaW4KICAgICAqIEByZXR1cm5zIHtTdHJpbmdbXX0gY29udGVudHMgIHN0cmluZyBub2Rlcy4gRW1wdHkgaWYgbm8gbm9kZXMgbWF0Y2gKICAgICAqIEBleGFtcGxlCiAgICAgKiBYUGF0aC5zZWxlY3RNdWx0aXBsZVRleHQoIi9yb290L2NoaWxkIiwgZG9jKQogICAgICovCiAgICB0aGF0LnNlbGVjdE11bHRpcGxlVGV4dCA9IGZ1bmN0aW9uKHhwYXRoLCB4bWxOb2RlKXsKLy8gICAgICAgIExvZy50cmFjZSgiRW50ZXJpbmcgWFBhdGguc2VsZWN0TXVsdGlwbGVUZXh0Iik7Ci8vICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gW107CiAgICAgICAgICAgIHRoYXQuZm9yRWFjaE5vZGVUZXh0KHhwYXRoLCB4bWxOb2RlLCBmdW5jdGlvbih0ZXh0KSB7CiAgICAgICAgICAgICAgICAvLyBMb2cudHJhY2UoIlhQYXRoLnNlbGVjdE11bHRpcGxlVGV4dCwgYWRkaW5nIHRleHQ6ICciLCB0ZXh0LCAiJyIpOwogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGV4dCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwovLyAgICAgICAgfSBmaW5hbGx5IHsKLy8gICAgICAgICAgICBMb2cudHJhY2UoIkxlYXZpbmcgWFBhdGguc2VsZWN0TXVsdGlwbGVUZXh0Iik7Ci8vICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAgICogSXRlcmF0ZSBvdmVyIHRleHQgbm9kZXMgYW5kIGNhbGwgYSBmdW5jdGlvbiBmb3IgZWFjaCBmb3VuZCB2YWx1ZQogICAgICoKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFhQYXRoLmZvckVhY2hOb2RlVGV4dAogICAgICogQHN5bnRheCBYUGF0aC5mb3JFYWNoTm9kZVRleHQoeHBhdGgsIHhtbE5vZGUsIGZuKQogICAgICogQHBhcmFtIHtzdHJpbmd9IHhwYXRoIGV4cHJlc3Npb24gdG8gbWF0Y2gKICAgICAqIEBwYXJhbSB7Tm9kZX0geG1sTm9kZSBEb2N1bWVudCB0byBtYXRjaCB4cGF0aCBpbgogICAgICogQHBhcmFtIHtmdW5jdGlvbn0gZm4gRnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCBmb3IgZWFjaCB0ZXh0IHN0cmluZwogICAgICogQGV4YW1wbGUKICAgICAqIFhQYXRoLmZvckVhY2hOb2RlVGV4dCgiL3Jvb3QvY2hpbGQiLCBkb2MsIGZ1bmN0aW9uKHRleHQpIHsgcHJpbnRuKHRleHQpIH0gKTsKICAgICAqLwogICAgdGhhdC5mb3JFYWNoTm9kZVRleHQgPSBmdW5jdGlvbih4cGF0aCwgeG1sTm9kZSwgZm4pewovLyAgICAgICAgTG9nLnRyYWNlKCJFbnRlcmluZyBYUGF0aC5mb3JFYWNoTm9kZVRleHQiKTsKLy8gICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIEFwcGVuZCAvdGV4dCgpIGlmIG5lY2Vzc2FyeQovLyAgICAgICAgICAgIGlmICgheHBhdGgubWF0Y2goL1wvdGV4dFwoXCkkLykpIHsKLy8gICAgICAgICAgICAgICAgeHBhdGggKz0gIi90ZXh0KCkiOwovLyAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG5vZGVzID0gdGhhdC5zZWxlY3QoeHBhdGgsIHhtbE5vZGUpOwogICAgICAgICAgICBub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgICAgICAgICAgIGlmICggbm9kZS5ub2RlVHlwZSA9PT0gTm9kZVR5cGVzLlRFWFRfTk9ERSB8fCBub2RlLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuQ0RBVEFfU0VDVElPTl9OT0RFICkgewogICAgICAgICAgICAgICAgICAgIGZuKCBub2RlLm5vZGVWYWx1ZSApOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICggbm9kZS5jaGlsZE5vZGVzICkgewogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwIDsgaSA8IG5vZGUuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGQgPSBub2RlLmNoaWxkTm9kZXMuaXRlbShpKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuVEVYVF9OT0RFIHx8IGNoaWxkLm5vZGVUeXBlID09PSBOb2RlVHlwZXMuQ0RBVEFfU0VDVElPTl9OT0RFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbiggY2hpbGQubm9kZVZhbHVlICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwovLyAgICAgICAgfSBmaW5hbGx5IHsKLy8gICAgICAgICAgICBMb2cudHJhY2UoIkxlYXZpbmcgWFBhdGguZm9yRWFjaE5vZGVUZXh0Iik7Ci8vICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAgICogU2VsZWN0IHRoZSBmaXJzdCBhdHRyaWJ1dGUgdGhhdCBtYXRjaGVzIHRoZSBzcGVjaWZpZWQgWFBhdGgKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYUGF0aC5zZWxlY3RBdHRyaWJ1dGUKICAgICAqIEBzeW50YXggWFBhdGguc2VsZWN0QXR0cmlidXRlKHhwYXRoLCB4bWxOb2RlKQogICAgICogQHBhcmFtIHtzdHJpbmd9IHhwYXRoIGV4cHJlc3Npb24gdG8gbWF0Y2gKICAgICAqIEBwYXJhbSB7Tm9kZX0geG1sTm9kZSBEb2N1bWVudCB0byBtYXRjaCB4cGF0aCBpbgogICAgICogQHJldHVybnMge1N0cmluZ3x1bmRlZmluZWR9IGNvbnRlbnQgb2YgZmlyc3QgbWF0Y2hpbmcgYXR0cmlidXRlIG9yIHVuZGVmaW5lZCBpZiBubyBhdHRyaWJ1dGUgZm91bmQKICAgICAqIEBleGFtcGxlCiAgICAgKiBYUGF0aC5zZWxlY3RBdHRyaWJ1dGUoIi9yb290L2NoaWxkL0BhdHRyaWJ1dGUiLCBkb2MpCiAgICAgKi8KICAgIHRoYXQuc2VsZWN0QXR0cmlidXRlID0gZnVuY3Rpb24oeHBhdGgsIHhtbE5vZGUpewovLyAgICAgICAgTG9nLnRyYWNlKCJFbnRlcmluZyBYUGF0aC5zZWxlY3RBdHRyaWJ1dGUiKTsKLy8gICAgICAgIHRyeSB7CiAgICAgICAgICAgIHZhciBub2RlID0gdGhhdC5zZWxlY3ROb2RlKHhwYXRoLCB4bWxOb2RlKTsKICAgICAgICAgICAgaWYgKG5vZGUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChub2RlLm5vZGVUeXBlICE9PSBOb2RlVHlwZXMuQVRUUklCVVRFX05PREUpIHsKICAgICAgICAgICAgICAgIExvZy5lcnJvcigiWFBhdGguc2VsZWN0QXR0cmlidXRlLCBzZWxlY3RlZCBub2RlIGlzIG5vdCBhbiBhdHRyaWJ1dGUgbm9kZToiLCBYbWxVdGlsLmxvZ1htbFN0cmluZyhub2RlKSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciB2YWx1ZSA9IG5vZGUubm9kZVZhbHVlOwogICAgICAgICAgICAvLyBMb2cudHJhY2UoIlhQYXRoLnNlbGVjdEF0dHJpYnV0ZSwgdmFsdWU6ICciLCB2YWx1ZSwgIiciKTsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwovLyAgICAgICAgfSBmaW5hbGx5IHsKLy8gICAgICAgICAgICBMb2cudHJhY2UoIkxlYXZpbmcgWFBhdGguc2VsZWN0QXR0cmlidXRlIik7Ci8vICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAgICogRGVsZXRlcyBub2RlcyB0aGF0IG1hdGNoIHhwYXRoIGV4cHJlc3Npb24KICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBYUGF0aC5kZWxldGUKICAgICAqIEBzeW50YXggWFBhdGguZGVsZXRlKHhwYXRoLCB4bWxOb2RlKQogICAgICogQHBhcmFtIHtzdHJpbmd9IHhwYXRoIGV4cHJlc3Npb24gdG8gbWF0Y2gKICAgICAqIEBwYXJhbSB7Tm9kZX0geG1sTm9kZQogICAgICogQHJldHVybnMKICAgICAqIEBleGFtcGxlCiAgICAgKiB2YXIgeG1sTm9kZSA9IFhtbFV0aWwuZnJvbVN0cmluZygiPHJvb3Q+PGNoaWxkPjwvY2hpbGQ+PG90aGVyPjwvb3RoZXI+PC9yb290PiIpCiAgICAgKiBYUGF0aC5kZWxldGUoIi9yb290LyoiLCB4bWxOb2RlKTsKICAgICAqIHhtbE5vZGUudG9TdHJpbmcoKSAvLyAiPHJvb3QvPiIKICAgICAqLwogICAgdGhhdC5kZWxldGUgPSBmdW5jdGlvbih4cGF0aCwgeG1sTm9kZSl7CiAgICAgICAgdmFyIG5vZGVzID0gdGhhdC5zZWxlY3QoIHhwYXRoLCB4bWxOb2RlICk7CiAgICAgICAgZm9yKCB2YXIgaSA9IDA7IGkgPCBub2Rlcy5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgdmFyIHZhbHVlID0gbm9kZXNbaV07CiAgICAgICAgICAgIHZhciBwYXJlbnQgPSB2YWx1ZS5wYXJlbnROb2RlOwogICAgICAgICAgICAvLyBMb2cudHJhY2UoIlJlbW92aW5nICciLCB2YWx1ZS5ub2RlTmFtZSwgIicgZnJvbSBwYXJlbnQgJyIsIHBhcmVudC5ub2RlTmFtZSwgIiciICk7CiAgICAgICAgICAgIHBhcmVudC5yZW1vdmVDaGlsZCh2YWx1ZSk7CiAgICAgICAgfQogICAgfTsKICAgIAogICAgcmV0dXJuIHRoYXQ7Cn0pKCk7Cgo=", "moduleName": "XPath"}, {"javascript": "LyoqIEBmaWxlIE5hbWVzcGFjZXMgYW5kIG1hcHMgb2YgbmFtZXNwYWNlcyBmb3IgdXNlIHdpdGggWE1MRE9NIGFuZCBYUGF0aCAqLwpFWFBPUlRFRF9TWU1CT0xTID0gWyAnWG1sTmFtZXNwYWNlcycgXTsKCi8qKgogKiBNb2R1bGUgdGhhdCBob2xkcyBhIG51bWJlciBvZiBuYW1lc3BhY2UgZGVjbGFyYXRpb25zLi4KICoKICogVGhpcyBuYW1lc3BhY2UgaG9sZHMgYSBudW1iZXIgb2YgbmFtZXNwYWNlIGRlY2xhcmF0aW9ucyB0aGF0IGFyZSB1c2VkCiAqIGFzIGNvbnN0YW50cyBpbiBwYXJ0cyBvZiB0aGUgY29kZS4KICoKICogQHR5cGUge25hbWVzcGFjZX0KICogQG5hbWVzcGFjZQogKiBAbmFtZSBYbWxOYW1lc3BhY2VzICovCnZhciBYbWxOYW1lc3BhY2VzID0gZnVuY3Rpb24oICkgewoKICAgIHZhciB0aGF0ID0ge307CgogICAgdGhhdC5uYW1lc3BhY2VNYXAgPSB7fTsKICAgIHRoYXQucmV2ZXJzZU5hbWVzcGFjZU1hcCA9IHt9OwoKICAgIHRoYXQuTmFtZXNwYWNlID0gZnVuY3Rpb24gKHByZWZpeCwgdXJpKSB7CiAgICAgICAgdmFyIG5zID0ge307CiAgICAgICAgbnMucHJlZml4ID0gcHJlZml4OwogICAgICAgIG5zLnVyaSA9IHVyaTsKICAgICAgICBucy50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHByZWZpeCArICI9IiArIHVyaSB9OyAvLyBGb3IgbG9nZ2luZwogICAgICAgIHRoYXQubmFtZXNwYWNlTWFwW3ByZWZpeF0gPSB1cmk7CiAgICAgICAgdGhhdC5yZXZlcnNlTmFtZXNwYWNlTWFwW3VyaV0gPSBwcmVmaXg7CiAgICAgICAgcmV0dXJuIG5zOwogICAgfTsKCiAgICAvKiogeG1sbnMgbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGB4bWxuc2AuIFRoZSB1cmkgZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBodHRwOi8vd3d3LnczLm9yZy8yMDAwL3htbG5zL2AuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy54bWxucyAqLwogICAgdGhhdC54bWxucyA9IHRoYXQuTmFtZXNwYWNlKCAieG1sbnMiLCAiaHR0cDovL3d3dy53My5vcmcvMjAwMC94bWxucy8iICk7CiAgICAvKiogdWJmIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgdWJmYC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGh0dHA6Ly93d3cuZGJjLmRrL3ViZmAKICAgICAqCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy51YmYgKi8KICAgIHRoYXQudWJmID0gdGhhdC5OYW1lc3BhY2UoICJ1YmYiLCAiaHR0cDovL3d3dy5kYmMuZGsvdWJmIiApOwogICAgLyoqIG9ycyBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYG9yc2AuIFRoZSB1cmkgZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBodHRwOi8vb3NzLmRiYy5kay9ucy9vcGVucmVzb3VyY2VzaGFyaW5nYC4KICAgICAqCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5vcnMgKi8KICAgIHRoYXQub3JzID0gdGhhdC5OYW1lc3BhY2UoICJvcnMiLCAiaHR0cDovL29zcy5kYmMuZGsvbnMvb3BlbnJlc291cmNlc2hhcmluZyIgKTsKICAgIC8qKiBob2xkaW5ncyBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGhzYC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGh0dHA6Ly9vc3MuZGJjLmRrL25zL2hvbGRpbmdzYC4KICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLmhvbGRpbmdzICovCiAgICB0aGF0LmhvbGRpbmdzID0gdGhhdC5OYW1lc3BhY2UoICJocyIsICJodHRwOi8vb3NzLmRiYy5kay9ucy9ob2xkaW5ncyIgKTsKICAgIC8qKiBpbGw1IG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaWxsNWAuIFRoZSB1cmkgZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGAKICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLmlsbDUgKi8KICAgIHRoYXQuaWxsNSA9IHRoYXQuTmFtZXNwYWNlKCAiaWxsNSIsICJodHRwOi8vd3d3LmxvYy5nb3YvejM5NTAvYWdlbmN5L2RlZm5zL2lsbDUiICk7CiAgICAvKiogemlnaG9sZGluZ3MgbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBuYC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGh0dHA6Ly93d3cubG9jLmdvdi96Mzk1MC9hZ2VuY3kvZGVmbnMvSG9sZGluZ3NTY2hlbWE4YC4KICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLnppZ2hvbGRpbmdzICovCiAgICB0aGF0LnppZ2hvbGRpbmdzID0gdGhhdC5OYW1lc3BhY2UoICJuIiwgImh0dHA6Ly93d3cubG9jLmdvdi96Mzk1MC9hZ2VuY3kvZGVmbnMvSG9sZGluZ3NTY2hlbWE4IiApOwogICAgLyoqIG9wZW5hZ2VuY3kgbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBvYWAuIFRoZSB1cmkgZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBodHRwOi8vb3NzLmRiYy5kay9ucy9vcGVuYWdlbmN5YC4KICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLm9wZW5hZ2VuY3kgKi8KICAgIHRoYXQub3BlbmFnZW5jeSA9IHRoYXQuTmFtZXNwYWNlKCAib2EiLCAiaHR0cDovL29zcy5kYmMuZGsvbnMvb3BlbmFnZW5jeSIgKTsKICAgIC8qKiB0aW5nIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgdGluZ2AuIFRoZSB1cmkgZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBodHRwOi8vd3d3LmRiYy5kay90aW5nYC4KICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLnRpbmcgKi8KICAgIHRoYXQudGluZyA9IHRoYXQuTmFtZXNwYWNlKCAidGluZyIsICJodHRwOi8vd3d3LmRiYy5kay90aW5nIiApOwogICAgLyoqIGVzIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgZXNgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL29zcy5kYmMuZGsvbnMvZXNgLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMuZXMgKi8KICAgIHRoYXQuZXMgPSB0aGF0Lk5hbWVzcGFjZSggImVzIiwgImh0dHA6Ly9vc3MuZGJjLmRrL25zL2VzIiApOwogICAgLyoqIGRrYWJtIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgZGthYm1gLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL2JpYmxzdGFuZGFyZC5kay9hYm0vbmFtZXNwYWNlL2RrYWJtL2AuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5ka2FibSAqLwogICAgdGhhdC5ka2FibSA9IHRoYXQuTmFtZXNwYWNlKCAiZGthYm0iLCAiaHR0cDovL2JpYmxzdGFuZGFyZC5kay9hYm0vbmFtZXNwYWNlL2RrYWJtLyIgKTsKICAgIC8qKiBhYyBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGFjYC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGh0dHA6Ly9iaWJsc3RhbmRhcmQuZGsvYWMvbmFtZXNwYWNlL2AuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5hYyAqLwogICAgdGhhdC5hYyA9IHRoYXQuTmFtZXNwYWNlKCAiYWMiLCAiaHR0cDovL2JpYmxzdGFuZGFyZC5kay9hYy9uYW1lc3BhY2UvIiApOwogICAgLyoqIGRrZGNwbHVzIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgZGtkY3BsdXNgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL2JpYmxzdGFuZGFyZC5kay9hYm0vbmFtZXNwYWNlL2RrZGNwbHVzL2AuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5ka2RjcGx1cyAqLwogICAgdGhhdC5ka2RjcGx1cyA9IHRoYXQuTmFtZXNwYWNlKCAiZGtkY3BsdXMiLCAiaHR0cDovL2JpYmxzdGFuZGFyZC5kay9hYm0vbmFtZXNwYWNlL2RrZGNwbHVzLyIgKTsKICAgIC8qKiBvc3MgbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBvc3NgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL29zcy5kYmMuZGsvbnMvb3NzdHlwZXNgLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMub3NzICovCiAgICB0aGF0Lm9zcyA9IHRoYXQuTmFtZXNwYWNlKCAib3NzIiwgImh0dHA6Ly9vc3MuZGJjLmRrL25zL29zc3R5cGVzIiApOwogICAgLyoqIGRjIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgZGNgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS9gLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMuZGMgKi8KICAgIHRoYXQuZGMgPSB0aGF0Lk5hbWVzcGFjZSggImRjIiwgImh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiApOwogICAgLyoqIG9haSBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYG9haWAuIFRoZSB1cmkgZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBodHRwOi8vd3d3Lm9wZW5hcmNoaXZlcy5vcmcvT0FJLzIuMC9gLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMub2FpICovCiAgICB0aGF0Lm9haSA9IHRoYXQuTmFtZXNwYWNlKCAib2FpIiwgImh0dHA6Ly93d3cub3BlbmFyY2hpdmVzLm9yZy9PQUkvMi4wLyIgKTsKCiAgICAvKiogb2FpX2RjIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgb2FpX2RjYC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGh0dHA6Ly93d3cub3BlbmFyY2hpdmVzLm9yZy9PQUkvMi4wL29haV9kYy9gLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMub2FpX2RjICovCiAgICB0aGF0Lm9haV9kYyA9IHRoYXQuTmFtZXNwYWNlKCAib2FpX2RjIiwgImh0dHA6Ly93d3cub3BlbmFyY2hpdmVzLm9yZy9PQUkvMi4wL29haV9kYy8iICk7CiAgICAvKiogZGN0ZXJtcyBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGRjdGVybXNgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL3B1cmwub3JnL2RjL3Rlcm1zL2AuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5kY3Rlcm1zICovCiAgICB0aGF0LmRjdGVybXMgPSB0aGF0Lk5hbWVzcGFjZSggImRjdGVybXMiLCAiaHR0cDovL3B1cmwub3JnL2RjL3Rlcm1zLyIgKTsKICAgIC8qKiB4c2kgbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGB4c2lgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VgLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMueHNpICovCiAgICB0aGF0LnhzaSA9IHRoYXQuTmFtZXNwYWNlKCAieHNpIiwgImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiApOwogICAgLyoqIG1hcmN4IG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgbWFyY3hgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaW5mbzpsYy94bWxucy9tYXJjeGNoYW5nZS12MWAuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5tYXJjeCAqLwogICAgdGhhdC5tYXJjeCA9IHRoYXQuTmFtZXNwYWNlKCAibWFyY3giLCAiaW5mbzpsYy94bWxucy9tYXJjeGNoYW5nZS12MSIgKTsKICAgIC8qKiBteCBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYG14YC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGh0dHA6Ly93d3cubG9jLmdvdi9NQVJDMjEvc2xpbWAuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5teCAqLwogICAgdGhhdC5teCA9IHRoYXQuTmFtZXNwYWNlKCAibXgiLCAiaHR0cDovL3d3dy5sb2MuZ292L01BUkMyMS9zbGltIiApOwogICAgLyoqIGRvY2Jvb2sgbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBkb2Nib29rYC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGh0dHA6Ly9kb2Nib29rLm9yZy9ucy9kb2Nib29rYC4KICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLmRvY2Jvb2sgKi8KICAgIHRoYXQuZG9jYm9vayA9IHRoYXQuTmFtZXNwYWNlKCAiZG9jYm9vayIsICJodHRwOi8vZG9jYm9vay5vcmcvbnMvZG9jYm9vayIgKTsKICAgIC8qKiBvc28gbmFtZXNwYWNlLgogICAgICoKIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBvc29gLiAgICAgKiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL29zcy5kYmMuZGsvbnMvb3BlbnNlYXJjaG9iamVjdHNgLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMub3NvICovCiAgICB0aGF0Lm9zbyA9IHRoYXQuTmFtZXNwYWNlKCAib3NvIiwgImh0dHA6Ly9vc3MuZGJjLmRrL25zL29wZW5zZWFyY2hvYmplY3RzIiApOwogICAgLyoqIHhzZCBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYHhzZGAuIFRoZSB1cmkgZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSNgLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMueHNkICovCiAgICB0aGF0LnhzZCA9IHRoYXQuTmFtZXNwYWNlKCAieHNkIiwgImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIyIgKTsKICAgIC8qKiB4bWwgbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGB4bWxgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL3d3dy53My5vcmcvWE1MLzE5OTgvbmFtZXNwYWNlYC4KICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLnhtbCAqLwogICAgdGhhdC54bWwgPSB0aGF0Lk5hbWVzcGFjZSggInhtbCIsICJodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2UiICk7CiAgICAvKiogcmRmIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgcmRmYC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyNgLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMucmRmICovCiAgICB0aGF0LnJkZiA9IHRoYXQuTmFtZXNwYWNlKCAicmRmIiwgImh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiICk7CiAgICAvKiogc2tvcyBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYHNrb3NgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL3d3dy53My5vcmcvMjAwOC8wNS9za29zI2AuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5za29zICovCiAgICB0aGF0LnNrb3MgPSB0aGF0Lk5hbWVzcGFjZSggInNrb3MiLCAiaHR0cDovL3d3dy53My5vcmcvMjAwOC8wNS9za29zIyIgKTsKICAgIC8qKiBmb2FmIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgZm9hZmAuIFRoZSB1cmkgZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBodHRwOi8veG1sbnMuY29tL2ZvYWYvMC4xYC4KICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLmZvYWYgKi8KICAgIHRoYXQuZm9hZiA9IHRoYXQuTmFtZXNwYWNlKCAiZm9hZiIsICJodHRwOi8veG1sbnMuY29tL2ZvYWYvMC4xIiApOwogICAgLyoqIG9mIG5hbWVzcGFjZS4KICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBvZmAuCiAgICAgKiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL29zcy5kYmMuZGsvbnMvb3BlbmZvcm1hdGAuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5vZiAqLwogICAgdGhhdC5vZiA9IHRoYXQuTmFtZXNwYWNlKCAib2YiLCAiaHR0cDovL29zcy5kYmMuZGsvbnMvb3BlbmZvcm1hdCIgKTsKICAgIC8qKiBvZm8gbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBvZm9gLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL29zcy5kYmMuZGsvbnMvb3BlbmZvcm1hdG91dHB1dGAuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5vZm8gKi8KICAgIHRoYXQub2ZvID0gdGhhdC5OYW1lc3BhY2UoICJvZm8iLCAiaHR0cDovL29zcy5kYmMuZGsvbnMvb3BlbmZvcm1hdG91dHB1dCIgKTsKICAgIC8qKiBiaWJkayBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGJpYmRrYC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGh0dHA6Ly9vc3MuZGJjLmRrL25zL29wZW5mb3JtYXRvdXRwdXQvYmlibGlvdGVrZGtkaXNwbGF5YC4KICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLmJpYmRrICovCiAgICB0aGF0LmJpYmRrID0gdGhhdC5OYW1lc3BhY2UoICJiaWJkayIsICJodHRwOi8vb3NzLmRiYy5kay9ucy9vcGVuZm9ybWF0b3V0cHV0L2JpYmxpb3Rla2RrZGlzcGxheSIgKTsKICAgIC8qKiBvcyBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYG9zYC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGh0dHA6Ly9vc3MuZGJjLmRrL25zL29wZW5zZWFyY2hgLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMub3MgKi8KICAgIHRoYXQub3MgPSB0aGF0Lk5hbWVzcGFjZSggIm9zIiwgImh0dHA6Ly9vc3MuZGJjLmRrL25zL29wZW5zZWFyY2giICk7CiAgICAvKiogaXNvMTg2MjYgbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBuMWAuIFRoZSB1cmkgZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBodHRwOi8vaWxsdHJhbnNhY3Rpb25zLm9yZy8yMDEzL2lzbzE4NjI2YC4KICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLmlzbzE4NjI2ICovCiAgICB0aGF0LmlzbzE4NjI2ID0gdGhhdC5OYW1lc3BhY2UoICJuMSIsICJodHRwOi8vaWxsdHJhbnNhY3Rpb25zLm9yZy8yMDEzL2lzbzE4NjI2IiApOwogICAgLyoqIGxuIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgbG5gLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL29zcy5kYmMuZGsvbnMvbGlua3NgLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMubG4gKi8KICAgIHRoYXQubG4gPSB0aGF0Lk5hbWVzcGFjZSggImxuIiwgImh0dHA6Ly9vc3MuZGJjLmRrL25zL2xpbmtzIiApOwoKICAgIC8qKiBmb3htbCBuYW1lc3BhY2UuCiAgICAgKgogICAgICogVGhlIHByZWZpeCBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGZveG1sYC4gVGhlIHVyaSBmb3IgdGhpcyBuYW1lc3BhY2UgaXMgYGluZm86ZmVkb3JhL2ZlZG9yYS1zeXN0ZW06ZGVmL2ZveG1sI2AuCiAgICAgKiBAdHlwZSB7TmFtZXNwYWNlfQogICAgICogQG5hbWUgWG1sTmFtZXNwYWNlcy5mb3htbCAqLwogICAgdGhhdC5mb3htbCA9IHRoYXQuTmFtZXNwYWNlKCAiZm94bWwiLCAiaW5mbzpmZWRvcmEvZmVkb3JhLXN5c3RlbTpkZWYvZm94bWwjIiApOwoKICAgIC8qKiBmZWRvcmEgbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBmZWRvcmFgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaW5mbzpmZWRvcmEvYC4KICAgICAqIEB0eXBlIHtOYW1lc3BhY2V9CiAgICAgKiBAbmFtZSBYbWxOYW1lc3BhY2VzLmZlZG9yYSAqLwogICAgdGhhdC5mZWRvcmEgPSB0aGF0Lk5hbWVzcGFjZSggImZlZG9yYSIsICJpbmZvOmZlZG9yYS8iICk7CgogICAgLyoqIFNPQVAtRU5WIG5hbWVzcGFjZS4KICAgICAqCiAgICAgKiBUaGUgcHJlZml4IGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgU09BUC1FTlZgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvc29hcC9lbnZlbG9wZS9gLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMuc29hcGVudiAqLwogICAgdGhhdC5zb2FwZW52ID0gdGhhdC5OYW1lc3BhY2UoICJTT0FQLUVOViIsICJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy9zb2FwL2VudmVsb3BlLyIgKTsKCiAgICAvKiogIFRoZSBuYW1lc3BhY2UgZm9yIHRoZQogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBkYXRhaW9jb250YWluZXJgLiBUaGUgdXJpIGZvciB0aGlzIG5hbWVzcGFjZSBpcyBgaHR0cDovL29zcy5kYmMuZGsvbnMvZGF0YS1jb250YWluZXJgLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMuZGF0YWlvY29udGFpbmVyICovCiAgICB0aGF0LmRhdGFpb2NvbnRhaW5lciA9IHRoYXQuTmFtZXNwYWNlKCAiZGF0YWlvY29udGFpbmVyIiwgImh0dHA6Ly9vc3MuZGJjLmRrL25zL2RhdGEtY29udGFpbmVyIiApOwoKICAgIC8qKiBmZWRvcmEgbmFtZXNwYWNlLgogICAgICoKICAgICAqIFRoZSBwcmVmaXggZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGB6c2AuIFRoZSB1cmkgZm9yIHRoaXMgbmFtZXNwYWNlIGlzIGBodHRwOi8vZG9jcy5vYXNpcy1vcGVuLm9yZy9ucy9zZWFyY2gtd3Mvc3J1UmVzcG9uc2VgLgogICAgICogQHR5cGUge05hbWVzcGFjZX0KICAgICAqIEBuYW1lIFhtbE5hbWVzcGFjZXMuenMgKi8KICAgIHRoYXQuenMgPSB0aGF0Lk5hbWVzcGFjZSggInpzIiwgImh0dHA6Ly9kb2NzLm9hc2lzLW9wZW4ub3JnL25zL3NlYXJjaC13cy9zcnVSZXNwb25zZSIgKTsKCiAgICByZXR1cm4gdGhhdDsKfSggKTsKCg==", "moduleName": "XmlNamespaces"}, {"javascript": "LyoqIEBmaWxlIFZhcmlvdXMgdXRpbGl0aWVzICovCgpFWFBPUlRFRF9TWU1CT0xTID0gWyAnVXRpbCcgXTsKdXNlKCAiTG9kYXNoIiApOwp1c2UoICJNYXJjIiApOwoKLyoqCiAqIFZhcmlvdXMgdXRpbGl0aWVzLgogKiAKICogVmFyaW91cyB1dGlsaXRpZXMsIG1vc3RseSByZWxhdGVkIHRvIG9iamVjdHMuCiAqIAogKiBAbmFtZSBVdGlsCiAqIEBuYW1lc3BhY2UgCiAqLwp2YXIgVXRpbCA9IGZ1bmN0aW9uKCApIHsKCiAgICAvKioKICAgICAqIEFkZCBhbiBvYmplY3QgdG8gYW4gYXJyYXksIGlmIHRoZSBvYmplY3QgaXMgbm90IGFscmVhZHkgaW4gdGhlIGFycmF5CiAgICAgKiAKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggVXRpbC5hZGRVbmlxdWVPYmplY3RUb0FycmF5KCBhcnJheSwgb2JqICk7CiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBBbiBhcnJheSBvZiBvYmplY3RzIHRvIHB1c2ggYW4gdW5pcXVlIG9iamVjdCB0by4KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmogVGhlIG9iamVjdCB0byBwdXNoIHRvIHRoZSBhcnJheS4KICAgICAqIEByZXR1cm4ge0FycmF5IH0gdGhlIHVwZGF0ZWQgYXJyYXkuCiAgICAgKiBAbmFtZSBVdGlsLmFkZFVuaXF1ZU9iamVjdFRvQXJyYXkgCiAgICAqIEBleGFtcGxlIFV0aWwuYWRkVW5pcXVlT2JqZWN0VG9BcnJheSggW3sgImZpcnN0TmFtZSI6ICJIYW5zIiwgImZhbWlseU5hbWUiOiAiSmVuc2VuIiB9LCB7ICJmaXJzdE5hbWUiOiAiSmVucyIsICJmYW1pbHlOYW1lIjogIkhhbnNlbiJ9LCB7ICJmaXJzdE5hbWUiOiAiSmVucyIsICJmYW1pbHlOYW1lIjogIkplbnNlbiIgfV0sIHsgImZpcnN0TmFtZSI6ICJIYW5zIiwiZmFtaWx5TmFtZSI6ICJIYW5zZW4iIH0gKTsgCiAgICAgKiAvL3JldHVybnMgW3sgImZpcnN0TmFtZSI6ICJIYW5zIiwgImZhbWlseU5hbWUiOiAiSmVuc2VuIiB9LCB7ICJmaXJzdE5hbWUiOiAiSmVucyIsICJmYW1pbHlOYW1lIjogIkhhbnNlbiIgfSwgeyAiZmlyc3ROYW1lIjogIkplbnMiLCAiZmFtaWx5TmFtZSI6ICJKZW5zZW4iIH0sIHsgImZpcnN0TmFtZSI6ICJIYW5zIiwiZmFtaWx5TmFtZSI6ICJIYW5zZW4iIH0gXQogICAgICogCiAgICAgKiBAbWV0aG9kIAogICAgICovCgogICAgZnVuY3Rpb24gYWRkVW5pcXVlT2JqZWN0VG9BcnJheSggYXJyYXksIG9iaiApIHsKCiAgICAgICAgdmFyIGlzVW5pcXVlID0gdHJ1ZTsKICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgaWYgKCAwID09PSBhcnJheS5sZW5ndGggfHwgdHJ1ZSA9PT0gXy5pc0VxdWFsKCBhcnJheVsgaSBdLCBvYmogKSApIHsKICAgICAgICAgICAgICAgIHZhciBpc1VuaXF1ZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCB0cnVlID09PSBpc1VuaXF1ZSApIHsKICAgICAgICAgICAgYXJyYXkucHVzaCggb2JqICk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhcnJheTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUga2V5cyBmcm9tIGFuIG9iamVjdCBhcyBhbiBhcnJheS4KICAgICAqIAogICAgICogR2V0IGFuIGFycmF5IG9mIGtleXMgb2YgdGhlIG9iamVjdCwgdXNpbmcgc29tZSB0cmlja3MgZnJvbSB0aGUgYmFnIG9mCiAgICAgKiBSSkUgCiAgICAgKiAKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggVXRpbC5hcnJheU9mS2V5cyhvYmopOwogICAgICogQHBhcmFtIHtvYmplY3R9IG9iaiBUaGUgb2JqZWN0IHRvIGdldCB0aGUga2V5cyBmb3IuCiAgICAgKiBAcmV0dXJuIHtvYmplY3RbXX0gUmV0dXJucyBhIG5ldyBhcnJheSBjb250YWluaW5nIGFsbCB0aGUga2V5cyBvZiBvYmouCiAgICAgKiBAbmFtZSBVdGlsLmFycmF5T2ZLZXlzCiAgICAgKiBAZXhhbXBsZQogICAgICogVXRpbC5hcnJheU9mS2V5cyggeyAnZWxlbWVudE5hbWUnOiAndGl0bGUnLCAnZWxlbWVudFZhbHVlJzogJ0RlbiBnYW1sZSBtYW5kIG9nIGhhdmV0JyB9ICksCiAgICAgKiAvL3JldHVybnMgWyAiZWxlbWVudE5hbWUiLCAiZWxlbWVudFZhbHVlIiBdCiAgICAgKiAgCiAgICAgKiBAbWV0aG9kICovCgogICAgZnVuY3Rpb24gYXJyYXlPZktleXMoIG9iaiApIHsKCiAgICAgICAgdmFyIHJlc3VsdCA9IFsgXTsKICAgICAgICBmb3IgKCB2YXIgZWxlbSBpbiBvYmogKQogICAgICAgICAgICBpZiAoIG9iai5oYXNPd25Qcm9wZXJ0eSggZWxlbSApICkgewogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goIGVsZW0gKTsKICAgICAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgb2JqZWN0IHRoYXQgaGFzIHRoZSBhcmd1bWVudCBhcyBwcm90b3R5cGUKICAgICAqIAogICAgICogU2VlIENyb2NrZm9yZCBwYWdlIDIyLiBJbiBzb21lIG9mIENyb2NrZm9yZHMgbm90ZXMsIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIAogICAgICogImJlZ2V0Ii4gVGhpcyB3aWxsIGJlY29tZSBPYmplY3QuY3JlYXRlIGluIEVTNS4KICAgICAqICAKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggVXRpbC5rZXlTb3J0ZWRPYmplY3QoIHByb3RvdHlwZV9vYmplY3QgKTsKICAgICAqIEBwYXJhbSB7T2JqZWN0fSAKICAgICAqIEByZXR1cm4ge09iamVjdH0gCiAgICAgKiBAbmFtZSBVdGlsLmNyZWF0ZQogICAgICogQG1ldGhvZCAqLwoKICAgIGZ1bmN0aW9uIGNyZWF0ZSggcHJvdG90eXBlX29iamVjdCApIHsKICAgICAgICB2YXIgRiA9IGZ1bmN0aW9uKCApIHt9OwogICAgICAgIEYucHJvdG90eXBlID0gcHJvdG90eXBlX29iamVjdDsKICAgICAgICByZXR1cm4gbmV3IEYoICk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYXAgYSBmdW5jdGlvbiBhY3Jvc3MgdGhlIG1hdGNoZXMgb2YgYSBSZWdFeHAuIAogICAgICoKICAgICAqICoqVE9ETzoqKiBSSkUgbmVlZHMgdG8gZG9jdW1lbnQgdGhpcywgYW5kIGdpdmUgYXQgbGVhc3Qgb25lIGV4YW1wbGUgb24gaG93IHRvIHVzZSBpdC4KICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAbWV0aG9kCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyIFRoZSBzdHJpbmcgdG8gc2VhcmNoIGZvciBtYXRjaGVzLgogICAgICogQHBhcmFtIHtSZWdFeHB9IHJlIFJlZ3VsYXIgZXhwcmVzc2lvbiB0byBtYXRjaCBhZ2FpbnN0LgogICAgICogQHBhcmFtIHtmdW5jdGlvbn0gZm4gRnVuY3Rpb24gdG8gbWFwLCB0aGlzIGdldHMgdGhlIG1hdGNoZWQgcmVnZXgtZ3JvdXBzIGFzIHBhcmFtZXRlcnMgKHRoZSBmdWxsIG1hdGNoIGFzIHRoZSBmaXJzdCBvZiB0aGVtKS4KICAgICAqIEBuYW1lIFV0aWwuZm9yRWFjaEdyb3VwZWRSZWdFeHBNYXRjaAogICAgICovCgogICAgZnVuY3Rpb24gZm9yRWFjaEdyb3VwZWRSZWdFeHBNYXRjaCggc3RyLCByZSwgZm4gKSB7CiAgICAgICAgLy8gSmF2YVNjcmlwdCBxdWlyY2s6IHRoZSBlYXNpZXN0IHdheSB0byBtYXAgYSBmdW5jdGlvbiBhY3Jvc3MgdGhlIF9ncm91cHNfIG9mIHRoZSBtYXRjaGVzIG9mIGEgcmVnZXggaXMgdG8gY2FsbCByZXBsYWNlIGFuZCB0aHJvdyB0aGUgcmVzdWx0IGF3YXkuIAogICAgICAgIHN0ci5yZXBsYWNlKCByZSwgZm4gKTsKICAgIH0KCgoKICAgIC8qKgogICAgICogR2V0IHRoZSB0eXBlIG9mIGFuIG9iamVjdC4KICAgICAqIAogICAgICogR2V0IHRoZSB0eXBlIG9mIGFuIG9iamVjdCwgdXNpbmcgc29tZSB0cmlja3MgZnJvbSB0aGUgYmFnIG9mIFJKRS4uLgogICAgICogTk9URTogVGhpcyBkb2VzIG5vdCB3b3JrIHdpdGggY3VzdG9tIG1hZGUgb2JqZWN0cyBsaWtlIFJlY29yZCwgRmllbGQsIFN1YmZpZWxkLCBzbyBiZSBjYXJlZnVsbC4gCiAgICAgKiBOT1RFOiBVc2UgdGhpcyBvbmx5IHdoZW4geW91IGV4cGVjdCBidWlsdCBpbiB0eXBlcyBvciB1c2UgdHlwZW9mIG9yIGluc3RhbmNlb2YgaW5zdGVhZC4KICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggVXRpbC5nZXRUeXBlKG9iaik7CiAgICAgKiBAcGFyYW0ge29iamVjdH0gb2JqIFRoZSBvYmplY3QgdG8gZ2V0IHRoZSB0eXBlIGZvci4KICAgICAqIEByZXR1cm4ge3N0cmluZ30gdHlwZW9mIG9iaiwgb3IgbmFtZSBvZiBvYmouY29uc3RydWN0b3IgaWYgYXZhaWxhYmxlLgogICAgICogQG5hbWUgVXRpbC5nZXRUeXBlCiAgICAgKiBAbWV0aG9kCiAgICAgKi8KCiAgICBmdW5jdGlvbiBnZXRUeXBlKCBvYmogKSB7CgogICAgICAgIHZhciB0eXBlID0gdHlwZW9mKCBvYmogKTsKICAgICAgICBpZiAoIHR5cGUgPT09ICJvYmplY3QiICYmIG9iaiAhPT0gbnVsbCAmJiBvYmouY29uc3RydWN0b3IgKSB7CiAgICAgICAgICAgIHZhciBtYXRjaCA9IFJlZ0V4cCggImZ1bmN0aW9uIChbXihdW14oXSopIiApLmV4ZWMoIG9iai5jb25zdHJ1Y3Rvci50b1NvdXJjZSggKSApOwogICAgICAgICAgICBpZiAoIG1hdGNoICYmIG1hdGNoLmxlbmd0aCA9PSAyICkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoWyAxIF07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHR5cGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBBcmUgdHdvIG9iamVjdHMgdGhlIHNhbWUuCiAgICAgKiAKICAgICAqIENvbXBhcmVzIHR3byBvYmplY3RzIHRvIGRldGVybWluZSBpZiB0aGV5IGFyZSBlcXVhbC4KICAgICAqIAogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBVdGlsLmlzRXF1YWwob2JqZWN0MSwgb2JqZWN0MikKICAgICAqIEBwYXJhbSB7b2JqZWN0fSBvYmplY3QxIFRoZSBmaXJzdCBvYmplY3QgZm9yIHRoZSBjb21wYXJpc29uIHRlc3QKICAgICAqIEBwYXJhbSB7b2JqZWN0fSBvYmplY3QyIFRoZSBzZWNvbmQgb2JqZWN0IGZvciB0aGUgY29tcGFyaXNvbiB0ZXN0CiAgICAgKiBAcmV0dXJuIHtib29sZWFufSB0cnVlIGlmIHRoZSB0d28gb2JqZWN0cyBhcmUgZXF1YWwsIG90aGVyd2lzZSBmYWxzZQogICAgICogQG5hbWUgVXRpbC5pc0VxdWFsCiAgICAgKiBAZXhhbXBsZQogICAgICogVXRpbC5pc0VxdWFsKCB7IGVsZW1lbnROYW1lOiAndGl0bGUnLCBlbGVtZW50VmFsdWU6ICdEZW4gZ2FtbGUgbWFuZCBvZyBoYXZldCcgfSwgeyBlbGVtZW50TmFtZTogJ3RpdGxlJywgZWxlbWVudFZhbHVlOiAnRGVuIGdhbWxlIG1hbmQgb2cgaGF2ZXQnIH0gKQogICAgICogLy9yZXR1cm5zIHRydWUKICAgICAqIAogICAgICogVXRpbC5pc0VxdWFsKCB7IGVsZW1lbnRWYWx1ZTogJ0RlbiBnYW1sZSBtYW5kIG9nIGhhdmV0JywgZWxlbWVudE5hbWU6ICd0aXRsZScgfSwgeyBlbGVtZW50TmFtZTogJ3RpdGxlJywgZWxlbWVudFZhbHVlOiAnRGVuIGdhbWxlIG1hbmQgb2cgaGF2ZXQnIH0gKQogICAgICogLy9yZXR1cm5zIHRydWUKICAgICAqIAogICAgICogVXRpbC5pc0VxdWFsKCB7IGVsZW1lbnROYW1lOiAndGl0bGUnLCBlbGVtZW50VmFsdWU6ICdEZW4gZ2FtbGUgbWFuZCBvZyBoYXZldCcgfSwgeyBlbGVtZW50TmFtZTogJ3RpdGxlJywgZWxlbWVudFZhbHVlOiAnRGVuIGdhbWxlIG1hbmQgb2cgaGF2ZXQnLCBlbGVtZW50UHJvcGVydHk6ICJmdWxsIiB9ICkKICAgICAqIC8vcmV0dXJucyBmYWxzZQogICAgICogCiAgICAgKiBAbWV0aG9kICovCgogICAgZnVuY3Rpb24gaXNFcXVhbCggb2JqZWN0MSwgb2JqZWN0MiApIHsKCiAgICAgICAgcmV0dXJuIF8uaXNFcXVhbCggb2JqZWN0MSwgb2JqZWN0MiApOwoKICAgIH0KCgoKICAgIC8qKgogICAgICogSXMgdGhpcyBhbiBvYmplY3QuIERvIG5vdCB1c2UgdGhpcyBmdW5jdGlvbiBpbiBuZXcgY29kZS4KICAgICAqIAogICAgICogRmlndXJlcyBvdXQgaWYgdGhpcyBpcyBhbiBvYmplY3QsIHVzaW5nIHNvbWUgdHJpY2tzIGZyb20gdGhlIGJhZyBvZiBSSkUuCiAgICAgKiAKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggVXRpbC5pc09iamVjdChvYmopOwogICAgICogQHBhcmFtIHtvYmplY3R9IG9iaiBUaGUgb2JqZWN0IHRvIHRlc3QgZm9yIGJlZWluZyBhbiBvYmplY3QuCiAgICAgKiBAcmV0dXJuIHtib29sZWFufSB0cnVlIGlmIG9iaiBpcyBhbiBvYmplY3QgKG5vdCBudWxsIG9yIGFycmF5KQogICAgICogQG5hbWUgVXRpbC5pc09iamVjdAogICAgICogQG1ldGhvZCAqLwoKICAgIGZ1bmN0aW9uIGlzT2JqZWN0KCBvYmogKSB7CiAgICAgICAgdGhyb3cgImRlcHJlY2F0ZWQiOyAvL1RoaXMgaXMgcHJvYmFibHkgaW5zZXJ0ZWQgdG8gcHJldmVudCBhbnkgdXNlIG9mIHRoZSBmdW5jdGlvbgogICAgICAgIHJldHVybiBvYmogIT0gbnVsbCAmJiB0eXBlb2YoIG9iaiApID09PSAib2JqZWN0IiAmJiAhKCBvYmogaW5zdGFuY2VvZiBBcnJheSApICYmICEoIG9iaiBpbnN0YW5jZW9mIERhdGUgKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBhIG5ldyBvYmplY3Qgd2l0aCBzb3J0ZWQga2V5cy4KICAgICAqIAogICAgICogR2V0IGEgbmV3IG9iamVjdCB3aXRoIHRoZSBzYW1lIGtleXMvdmFsdWVzIGFzIHRoZSBvYmosIGJ1dCBpbnNlcnRlZCBpbgogICAgICogYWxwaGFiZXRpY2FsIG9yZGVyLCB1c2luZyBzb21lIHRyaWNrcyBmcm9tIHRoZSBiYWcgb2YgUkpFLgogICAgICogCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IFV0aWwua2V5U29ydGVkT2JqZWN0KG9iaik7CiAgICAgKiBAcGFyYW0ge29iamVjdH0gb2JqIFRoZSBvYmplY3QgdG8gc29ydCBrZXlzIGZvci4KICAgICAqIEByZXR1cm4ge29iamVjdH0gQSBuZXcgb2JqZWN0IHdpdGggdGhlIHNhbWUga2V5cy92YWx1ZXMgYXMgdGhlIG9iaiwgYnV0IGluc2VydGVkIGluIGFscGhhYmV0aWNhbCBvcmRlcgogICAgICogQG5hbWUgVXRpbC5rZXlTb3J0ZWRPYmplY3QKICAgICAqIEBleGFtcGxlIFV0aWwua2V5U29ydGVkT2JqZWN0KCB7IGVsZW1lbnROYW1lOiAndGl0bGUnLCBlbGVtZW50VmFsdWU6ICdEZW4gZ2FtbGUgbWFuZCBvZyBoYXZldCcsIGVsZW1lbnRQcm9wZXJ0eTogImZ1bGwiIH0pOwogICAgICogLy9yZXR1cm5zIHsgZWxlbWVudE5hbWU6ICd0aXRsZScsIGVsZW1lbnRQcm9wZXJ0eTogImZ1bGwiLCBlbGVtZW50VmFsdWU6ICdEZW4gZ2FtbGUgbWFuZCBvZyBoYXZldCcgfQogICAgICogCiAgICAgKiBAbWV0aG9kICovCgogICAgZnVuY3Rpb24ga2V5U29ydGVkT2JqZWN0KCBvYmogKSB7CgogICAgICAgIGlmICggb2JqID09PSBudWxsIHx8IHR5cGVvZiggb2JqICkgIT09ICJvYmplY3QiIHx8ICggb2JqIGluc3RhbmNlb2YgQXJyYXkgKSB8fCAoIG9iaiBpbnN0YW5jZW9mIERhdGUgKSApIHsKICAgICAgICAgICAgcmV0dXJuIG9iajsKICAgICAgICB9CiAgICAgICAgdmFyIHJlc3VsdCA9IHt9OwogICAgICAgIF8ua2V5cyggb2JqICkuc29ydCggKS5mb3JFYWNoKCBmdW5jdGlvbigga2V5ICkgewogICAgICAgICAgICByZXN1bHRbIGtleSBdID0gb2JqWyBrZXkgXTsKICAgICAgICB9ICk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICAvKioKICAgICAqIE1ldGhvZCB0aGF0IGhhbmRsZXMgbnVtZXJpYyBzb3J0aW5nIG9mIGFuIGFycmF5LgogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggVXRpbC5zb3J0QXJyYXlPZk51bWJlcnMoIGFycmF5LCBbbW9kZV0gKQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgQW4gYXJyYXkgY29udGFpbmluZyBudW1iZXJzLiBUaGUgbnVtYmVycyBhcmUgYWxzbyBhbGxvd2VkIGFzIHN0cmluZ3MuCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW21vZGVdIEEgImQiIGdpdmluZyBkZXNjZW5kaW5nIG9yZGVyIG9yIGFueXRoaW5nIGVsc2UgZ2l2aW5nIGFzY2VuZGluZyBvcmRlcgogICAgICogQHJldHVybiB7QXJyYXl9IEEgbmV3IGFycmF5IGNvbnRhaW5pbmcgc29ydGVkIG51bWJlcnMKICAgICAqIEBleGFtcGxlIFV0aWwuc29ydEFycmF5T2ZOdW1iZXJzKCBbIDMsIDcsIDEyLCAxLCAxMDAsIDQ3IF0sICJkIiApCiAgICAgKiAvL3JldHVybnMgWyAxMDAsIDQ3LCAxMiwgNywgMywgMSBdCiAgICAgKiAgCiAgICAgKiBAZXhhbXBsZSBVdGlsLnNvcnRBcnJheU9mTnVtYmVycyggWyAiMDIwIiwgIjMiLCAiNzUiICwiMzAxIiwgIjAwMSIgXSApCiAgICAgKiAvLyByZXR1cm5zIFsgIjAwMSIsICIzIiwgIjAyMCIsICI3NSIgLCIzMDEiIF0KICAgICAqIAogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgVXRpbC5zb3J0QXJyYXlPZk51bWJlcnMKICAgICAqLwogICAgZnVuY3Rpb24gc29ydEFycmF5T2ZOdW1iZXJzKCBhcnJheSwgbW9kZSApIHsKCiAgICAgICAgYXJyYXkuc29ydCggZnVuY3Rpb24oIGEsIGIgKSB7CiAgICAgICAgICAgIGlmICggbW9kZSAhPT0gImQiICkgewogICAgICAgICAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGIgLSBhOwogICAgICAgICAgICB9CiAgICAgICAgfSApOwoKICAgICAgICByZXR1cm4gYXJyYXk7CgogICAgfQoKICAgIC8qKgogICAgICogTWV0aG9kIHRoYXQgaGFuZGxlcyBhbHBoYWJldGljYWwgc29ydGluZyBvbiBhIHNwZWNpZmllZCBwcm9wZXJ0eSBmb3IgYW4gYXJyYXkgb2Ygb2JqZWN0cy4KICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IFV0aWwuc29ydEFycmF5T2ZPYmplY3RzKCBhcnJheSwgcHJvcGVydHkgKQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgQW4gYXJyYXkgY29udGFpbmluZyBvYmplY3RzCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcHJvcGVydHkgVGhlIG5hbWUgb2YgdGhlIHByb3BlcnR5IHVzZWQgZm9yIHNvcnRpbmcKICAgICAqIEByZXR1cm4ge0FycmF5fSBBIG5ldyBhcnJheSBjb250YWluaW5nIHNvcnRlZCBvYmplY3RzCiAgICAgKiBAZXhhbXBsZSBVdGlsLnNvcnRBcnJheU9mT2JqZWN0cyggWyB7ICJ2YWx1ZSI6ICJoZXN0IiwgInR5cGUiOiAiYW5pbWFsIiB9LHsgInZhbHVlIjogImtvIiwgInR5cGUiOiAiYW5pbWFsIiB9LHsgInZhbHVlIjogImdyaXMiLCAidHlwZSI6ICJhbmltYWwiIH0gXSwgInZhbHVlIiApIAogICAgICogLy8gcmV0dXJucyBbIHsgInZhbHVlIjogImdyaXMiLCAidHlwZSI6ICJhbmltYWwiIH0sIHsgInZhbHVlIjogImhlc3QiLCAidHlwZSI6ICJhbmltYWwiIH0seyAidmFsdWUiOiAia28iLCAidHlwZSI6ICJhbmltYWwiIH0gXQogICAgICogCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBVdGlsLnNvcnRBcnJheU9mT2JqZWN0cwogICAgICovCiAgICBmdW5jdGlvbiBzb3J0QXJyYXlPZk9iamVjdHMoIGFycmF5LCBwcm9wZXJ0eSApIHsKCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmc6IFV0aWwuc29ydEFycmF5T2ZPYmplY3RzIG1ldGhvZCIgKTsKCiAgICAgICAgdmFyIHNvcnRlZEFycmF5ID0gYXJyYXkuc29ydCggZnVuY3Rpb24oIGEsIGIgKSB7CiAgICAgICAgICAgIGlmICggYVsgcHJvcGVydHkgXSA8IGJbIHByb3BlcnR5IF0gKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCBhWyBwcm9wZXJ0eSBdID4gYlsgcHJvcGVydHkgXSApIHsKICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0gKTsKCiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZzogVXRpbC5zb3J0QXJyYXlPZk9iamVjdHMgbWV0aG9kIiApOwoKICAgICAgICByZXR1cm4gc29ydGVkQXJyYXk7CgogICAgfQoKICAgIC8qKgogICAgICogTWV0aG9kIHRoYXQgcmVtb3ZlcyBkdXBsaWNhdGUgb2JqZWN0cyBpbiBhbiBhcnJheS4KICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IFV0aWwudW5pcXVlT2JqZWN0c0luQXJyYXkoIGFycmF5T2ZPYmplY3RzICkKICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IEFuIGFycmF5IGNvbnRhaW5pbmcgT2JqZWN0cwogICAgICogQHJldHVybiB7QXJyYXl9IEEgbmV3IGFycmF5IGNvbnRhaW5pbmcgb25seSB1bmlxdWUgb2JqZWN0cwogICAgICogQGV4YW1wbGUgVXRpbC51bmlxdWVPYmplY3RzSW5BcnJheSggWyB7ICJhbmltYWwiOiAiaG9yc2UiLCAiY29sb3VyIjogImJyb3duIiB9LHsgImFuaW1hbCI6ICJob3JzZSIsICJjb2xvdXIiOiAiYmxhY2siIH0seyAiYW5pbWFsIjogImhvcnNlIiwgImNvbG91ciI6ICJicm93biIgfSBdICkKICAgICAqIC8vcmV0dXJucyBbIHsgImFuaW1hbCI6ICJob3JzZSIsICJjb2xvdXIiOiAiYmxhY2siIH0seyAiYW5pbWFsIjogImhvcnNlIiwgImNvbG91ciI6ICJicm93biIgfSBdCiAgICAgKiAKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFV0aWwudW5pcXVlT2JqZWN0c0luQXJyYXkKICAgICAqLwoKICAgIGZ1bmN0aW9uIHVuaXF1ZU9iamVjdHNJbkFycmF5KCBhcnJheU9mT2JqZWN0cyApIHsKCiAgICAgICAgdmFyIG51bWJlck9mT2JqZWN0cyA9IGFycmF5T2ZPYmplY3RzLmxlbmd0aDsKICAgICAgICB2YXIgYXJyYXlPZlVuaXF1ZU9iamVjdHMgPSBbIF07CiAgICAgICAgZm9yICggdmFyIGogPSAwOyBqIDwgYXJyYXlPZk9iamVjdHMubGVuZ3RoOyBqKysgKSB7CiAgICAgICAgICAgIHZhciByZXN0ID0gYXJyYXlPZk9iamVjdHMuc2xpY2UoIGogKyAxLCBudW1iZXJPZk9iamVjdHMgKQogICAgICAgICAgICB2YXIgY3VycmVudE9iamVjdCA9IGFycmF5T2ZPYmplY3RzWyBqIF07CiAgICAgICAgICAgIHZhciBpc1VuaXF1ZSA9IHRydWU7CiAgICAgICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IHJlc3QubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgICAgICAgICBpZiAoIF8uaXNFcXVhbCggY3VycmVudE9iamVjdCwgcmVzdFsgaSBdICkgKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGlzVW5pcXVlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmICggdHJ1ZSA9PT0gaXNVbmlxdWUgKSB7CiAgICAgICAgICAgICAgICBhcnJheU9mVW5pcXVlT2JqZWN0cy5wdXNoKCBjdXJyZW50T2JqZWN0ICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFycmF5T2ZVbmlxdWVPYmplY3RzOwogICAgfQoKCiAgICAvKioKICAgICAqIE1ldGhvZCB0aGF0IHJlbW92ZXMgZHVwbGljYXRlIHZhbHVlcyBpbiBhbiBhcnJheS4KICAgICAqIAogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBVdGlsLnVuaXF1ZVZhbHVlcyggYXJyYXkgKQogICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIHNvcnRlZCBhcnJheSB3aGVyZSBkdXBsaWNhdGVzIG5lZWQgdG8gYmUgcmVtb3ZlZAogICAgICogQHJldHVybiB7QXJyYXl9IEFuIGFycmF5IGNvbnRhaW5pbmcgdW5pcXVlIHZhbHVlcwogICAgICogQGV4YW1wbGUgVXRpbC51bmlxdWVWYWx1ZXMoIFsgIjIwNyIsICIyMTciLCAiMjE3IiwgIjU4MyIsICIyMTciXSApCiAgICAgKiAvL3JldHVybnMgWyAiMjA3IiwgIjU4MyIsICIyMTciXQogICAgICogCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBVdGlsLnVuaXF1ZVZhbHVlcwogICAgICovCiAgICBmdW5jdGlvbiB1bmlxdWVWYWx1ZXMoIGFycmF5ICkgewoKICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZzogVXRpbC51bmlxdWVWYWx1ZXMgbWV0aG9kIiApOwoKICAgICAgICB2YXIgdW5pcXVlVmFsdWVBcnJheSA9IFsgXTsKICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgaWYgKCB1bmlxdWVWYWx1ZUFycmF5LmluZGV4T2YoIGFycmF5WyBpIF0gKSA8IDAgKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVWYWx1ZUFycmF5LnB1c2goIGFycmF5WyBpIF0gKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZzogVXRpbC51bmlxdWVWYWx1ZXMgbWV0aG9kIiApOwoKICAgICAgICByZXR1cm4gdW5pcXVlVmFsdWVBcnJheTsKCiAgICB9CgogICAgLyoqCiAgICAgKiBEZWVwIGNsb25lcyBhbiBvYmplY3QuCiAgICAgKgogICAgICogSGFuZGxlcyBSZWNvcmQsIEZpZWxkLCBTdWJmaWVsZCwgeG1sIE5vZGVzLCBhbmQgcGxhaW4gamF2YXNjcmlwdCBvYmplY3RzLgogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggVXRpbC5jbG9uZURlZXAoIG9iaiApCiAgICAgKiBAcGFyYW0geyp9IG9iaiBhbiBvYmplY3QgdG8gY2xvbmUKICAgICAqIEByZXR1cm5zIHsqfSBhIGRlZXAgY2xvbmUgb2YgdGhlIGlucHV0IG9iamVjdAogICAgICogQGZ1bmN0aW9uCiAgICAgKiBAbmFtZSBVdGlsLmNsb25lRGVlcAogICAgICoKICAgICAqIEBleGFtcGxlCiAgICAgKiB2YXIgYSA9IFt7ImEiOiAxfSwgeyJiIjogMn1dOwogICAgICogdmFyIGNsb25lID0gVXRpbC5jbG9uZURlZXAoYSk7CiAgICAgKiBhWzBdID09PSBjbG9uZVswXSAvLyA9PiBmYWxzZQogICAgICovCiAgICBmdW5jdGlvbiBjbG9uZURlZXAoIG9iaiApIHsKICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZyBVdGlsLmNsb25lRGVlcCIgKTsKCiAgICAgICAgdmFyIGNsb25lID0gbnVsbDsKICAgICAgICBpZiAoIG9iaiBpbnN0YW5jZW9mIFJlY29yZCB8fCBvYmogaW5zdGFuY2VvZiBGaWVsZCB8fAogICAgICAgICAgICBvYmogaW5zdGFuY2VvZiBTdWJmaWVsZCApIHsKICAgICAgICAgICAgY2xvbmUgPSBvYmouY2xvbmUoKTsKICAgICAgICB9IGVsc2UgaWYgKCB0eXBlb2YgUGFja2FnZXMgIT09ICd1bmRlZmluZWQnICYmIG9iaiBpbnN0YW5jZW9mIFBhY2thZ2VzLm9yZy53M2MuZG9tLk5vZGUgKSB7CiAgICAgICAgICAgIGNsb25lID0gb2JqLmNsb25lTm9kZSggdHJ1ZSApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNsb25lID0gXy5jbG9uZURlZXAoIG9iaiApOwogICAgICAgIH0KCiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBVdGlsLmNsb25lRGVlcCIgKTsKICAgICAgICByZXR1cm4gY2xvbmU7CiAgICB9CgoKICAgIC8qKgogICAgICogTWV0aG9kIHRoYXQgY29udmVydHMgcm9tYW4gbnVtYmVycyB0byBsYXRpbiBudW1iZXJzIGFzIGEgc3RyaW5nCiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBVdGlsLmNvbnZlcnRSb21hbk51bWJlcnNUb0xhdGluKCBzdHJpbmcgKQogICAgICogQHBhcmFtIHtTdHJpbmd9IGlucHV0IFRoZSByb21hbiBudW1iZXIKICAgICAqIEByZXR1cm4ge051bWJlcn0gVGhlIGxhdGluIG51bWJlciBvciB6ZXJvCiAgICAgKiBAZXhhbXBsZSBVdGlsLmNvbnZlcnRSb21hbk51bWJlcnNUb0xhdGluKCAiTURDQ1hYSVYiICkKICAgICAqIC8vcmV0dXJucyAiMTcyNCIKICAgICAqCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBVdGlsLmNvbnZlcnRSb21hbk51bWJlcnNUb0xhdGluCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbnZlcnRSb21hbk51bWJlcnNUb0xhdGluKCBpbnB1dCApIHsKCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmc6IFV0aWwuY29udmVydFJvbWFuTnVtYmVyc1RvTGF0aW4gbWV0aG9kIiApOwoKICAgICAgICBpZiggdHlwZW9mIGlucHV0ICE9ICJzdHJpbmciICl7CiAgICAgICAgICAgIExvZy53YXJuKCAiaW5wdXQgbnVtYmVyIGlzIG5vdCB3cml0dGVuIGFzIGEgc3RyaW5nIiApOwogICAgICAgICAgICBpbnB1dCA9IFN0cmluZyggaW5wdXQgKTsKICAgICAgICB9CgogICAgICAgIHZhciBfX2NoYXJfdG9faW50ID0gZnVuY3Rpb24oIGMgKSB7CiAgICAgICAgICAgIHN3aXRjaCAoIGMgKSB7CiAgICAgICAgICAgICAgICBjYXNlICdJJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgICAgIGNhc2UgJ1YnOgogICAgICAgICAgICAgICAgICAgIHJldHVybiA1OwogICAgICAgICAgICAgICAgY2FzZSAnWCc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEwOwogICAgICAgICAgICAgICAgY2FzZSAnTCc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDUwOwogICAgICAgICAgICAgICAgY2FzZSAnQyc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEwMDsKICAgICAgICAgICAgICAgIGNhc2UgJ0QnOgogICAgICAgICAgICAgICAgICAgIHJldHVybiA1MDA7CiAgICAgICAgICAgICAgICBjYXNlICdNJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTAwMDsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgaWYgKCBpbnB1dCA9PSBudWxsICkgcmV0dXJuIC0xOwogICAgICAgIHZhciBudW1iZXIgPSBfX2NoYXJfdG9faW50KCBpbnB1dC5jaGFyQXQoIDAgKSApOwogICAgICAgIHZhciBwcmU7CiAgICAgICAgdmFyIGN1cnI7CgogICAgICAgIGZvciAoIHZhciBpID0gMTsgaSA8IGlucHV0Lmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICBjdXJyID0gX19jaGFyX3RvX2ludCggaW5wdXQuY2hhckF0KCBpICkgKTsKICAgICAgICAgICAgcHJlID0gX19jaGFyX3RvX2ludCggaW5wdXQuY2hhckF0KCBpIC0gMSApICk7CiAgICAgICAgICAgIGlmICggY3VyciA8PSBwcmUgKSB7CiAgICAgICAgICAgICAgICBudW1iZXIgKz0gY3VycjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG51bWJlciA9IG51bWJlciAtIHByZSAqIDIgKyBjdXJyOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiggbnVtYmVyIDwgMCApewogICAgICAgICAgICBudW1iZXIgPSAwOwogICAgICAgICAgICBMb2cud2FybiggIklucHV0IG51bWJlciBpcyBub3QgY29udmVydGFibGUgLSByZXR1cm5pbmcgMCIgKTsKCiAgICAgICAgfQoKICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nOiBVdGlsLmNvbnZlcnRSb21hbk51bWJlcnNUb0xhdGluIG1ldGhvZCIgKTsKCiAgICAgICAgcmV0dXJuIG51bWJlcjsKCiAgICB9CgoKICAgIC8qKgogICAgICogTWV0aG9kIHRoYXQgY29udmVydHMgbGF0aW4gbnVtYmVycyB0byByb21hbiBudW1iZXJzCiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBVdGlsLmNvbnZlcnRMYXRpbk51bWJlcnNUb1JvbWFuKCBzdHJpbmcgKQogICAgICogQHBhcmFtIHtTdHJpbmd9IHN0cmluZyBUaGUgcm9tYW4gbnVtYmVyCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IFRoZSBsYXRpbiBudW1iZXJzIGFzIGEgc3RyaW5nCiAgICAgKiBAZXhhbXBsZSBVdGlsLmNvbnZlcnRMYXRpbk51bWJlcnNUb1JvbWFuKCAgKQogICAgICogLy9yZXR1cm5zICIiCiAgICAgKgogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgVXRpbC5jb252ZXJ0TGF0aW5OdW1iZXJzVG9Sb21hbgogICAgICovCiAgICBmdW5jdGlvbiBjb252ZXJ0TGF0aW5OdW1iZXJzVG9Sb21hbiggbnVtYmVyICkgewoKICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZzogVXRpbC5jb252ZXJ0TGF0aW5OdW1iZXJzVG9Sb21hbiBtZXRob2QiICk7CgogICAgICAgIHZhciByb21hbk51bWJlciA9ICcnOwogICAgICAgIHZhciByb20gPSBbICdNJywgJ0NNJywgJ0QnLCAnQ0QnLCAnQycsICdYQycsICdMJywgJ1hMJywgJ1gnLCAnSVgnLCAnVicsICdJVicsICdJJyBdOwogICAgICAgIHZhciBhcmEgPSBbIDEwMDAsIDkwMCwgNTAwLCA0MDAsIDEwMCwgOTAsIDUwLCA0MCwgMTAsIDksIDUsIDQsIDEgXTsKCiAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgcm9tLmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICB3aGlsZSAoIG51bWJlciA+PSBhcmFbIGkgXSApIHsKICAgICAgICAgICAgICAgIHJvbWFuTnVtYmVyICs9IHJvbVsgaSBdOwogICAgICAgICAgICAgICAgbnVtYmVyIC09IGFyYVsgaSBdOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nOiBVdGlsLmNvbnZlcnRMYXRpbk51bWJlcnNUb1JvbWFuIG1ldGhvZCIgKTsKCiAgICAgICAgcmV0dXJuIHJvbWFuTnVtYmVyOwoKICAgIH0KCiAgICByZXR1cm4gewoKICAgICAgICBhZGRVbmlxdWVPYmplY3RUb0FycmF5OiBhZGRVbmlxdWVPYmplY3RUb0FycmF5LAogICAgICAgIGFycmF5T2ZLZXlzOiBhcnJheU9mS2V5cywKICAgICAgICBjcmVhdGU6IGNyZWF0ZSwKICAgICAgICBjbG9uZURlZXA6IGNsb25lRGVlcCwKICAgICAgICBmb3JFYWNoR3JvdXBlZFJlZ0V4cE1hdGNoOiBmb3JFYWNoR3JvdXBlZFJlZ0V4cE1hdGNoLAogICAgICAgIGdldFR5cGU6IGdldFR5cGUsCiAgICAgICAgaXNFcXVhbDogaXNFcXVhbCwKCQlpc09iamVjdDogaXNPYmplY3QsCiAgICAgICAga2V5U29ydGVkT2JqZWN0OiBrZXlTb3J0ZWRPYmplY3QsCgkJc29ydEFycmF5T2ZOdW1iZXJzOiBzb3J0QXJyYXlPZk51bWJlcnMsCQkJCgkJc29ydEFycmF5T2ZPYmplY3RzOiBzb3J0QXJyYXlPZk9iamVjdHMsCQogICAgICAgIHVuaXF1ZU9iamVjdHNJbkFycmF5OiB1bmlxdWVPYmplY3RzSW5BcnJheSwKICAgICAgICB1bmlxdWVWYWx1ZXM6IHVuaXF1ZVZhbHVlcywKICAgICAgICBjb252ZXJ0Um9tYW5OdW1iZXJzVG9MYXRpbjogY29udmVydFJvbWFuTnVtYmVyc1RvTGF0aW4sCiAgICAgICAgY29udmVydExhdGluTnVtYmVyc1RvUm9tYW46IGNvbnZlcnRMYXRpbk51bWJlcnNUb1JvbWFuCgogICAgfTsKCn0oICk7CgovLyB1bml0dGVzdHMgYXJlIGluIFV0aWwudGVzdC5qcwovLyAoYmVjYXVzZSB0aGUgVW5pdFRlc3QgbW9kdWxlIGlzIG5vdCBhdmFpbGFibGUgZnJvbSB0aGlzIG1vZHVsZSkK", "moduleName": "Util"}, {"javascript": "LyoqIEBmaWxlIFNvbWUgYWRkZWQgZnVuY3Rpb25hbGl0eSB0byBtYXJjIGNsYXNzZXMgKi8KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLyohCiAgICBcZmlsZSBtYXJjLmpzCiovCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyAgICAgICAgICAgICAgICAgICAgICBFeHBvcnRlZCBTeW1ib2xzCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgpFWFBPUlRFRF9TWU1CT0xTID0gWyAnRWFjaEZhY3RvcnknLCAnSGFuZGxlcicgXTsKCi8vIE1hcmMgZGVwZW5kcyBvbiBNYXJjQ2xhc3Nlcwp1c2UoICJNYXJjQ2xhc3NlcyIgKTsKdXNlKCAiTWFyY01hdGNoZXJzIiApOwp1c2UoICJMb2ciICk7CgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyAgICAgICAgICAgIFN1YmZpZWxkIHByb3RvdHlwZXMKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzClN1YmZpZWxkLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKCApIHsKICAgIHJldHVybiBuZXcgU3ViZmllbGQoIHRoaXMubmFtZSwgdGhpcy52YWx1ZSApOwp9OwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gICAgICAgICAgICBGaWVsZCBwcm90b3R5cGVzCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgovLyBTZWUgZG9jIGluIE1hcmNDbGFzc2VzLnVzZS5qcwpGaWVsZC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiggKSB7CiAgICB2YXIgbmV3RmllbGQgPSBuZXcgRmllbGQoIHRoaXMubmFtZSwgdGhpcy5pbmRpY2F0b3IgKTsKCiAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCB0aGlzLnNpemUoICk7IGkrKyApIHsKICAgICAgICBuZXdGaWVsZC5hcHBlbmQoIHRoaXMuc3ViZmllbGQoIGkgKS5jbG9uZSggKSApOwogICAgfQoKICAgIHJldHVybiBuZXdGaWVsZDsKfTsKCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzCkZpZWxkLnByb3RvdHlwZS5lbXB0eSA9IGZ1bmN0aW9uKCApIHsKICAgIHJldHVybiB0aGlzLnNpemUoICkgPT09IDA7Cn07CgovLyBTZWUgZG9jIGluIE1hcmNDbGFzc2VzLnVzZS5qcwpGaWVsZC5wcm90b3R5cGUuc2l6ZSA9IGZ1bmN0aW9uKCApIHsKICAgIHJldHVybiB0aGlzLmNvdW50KCApOwp9OwoKLy8gU2VlIGRvYyBpbiBNYXJjQ2xhc3Nlcy51c2UuanMKRmllbGQucHJvdG90eXBlLmVhY2hTdWJGaWVsZCA9IGZ1bmN0aW9uKCBtYXRjaGVyLCBoYW5kbGVyICkgewogICAgcmV0dXJuIG5ldyBFYWNoRmFjdG9yeSggKS5lYWNoU3ViRmllbGQoIHRoaXMsIGdldE1hdGNoU3ViRmllbGQoIG1hdGNoZXIgKSwgaGFuZGxlciApOwp9OwoKLy8gU2VlIGRvYyBpbiBNYXJjQ2xhc3Nlcy51c2UuanMKRmllbGQucHJvdG90eXBlLmVhY2hTdWJGaWVsZE1hcCA9IGZ1bmN0aW9uKCBtYXAsIGV4dHJhRGF0YSApIHsKCiAgICB2YXIgbnVtc3ViZmllbGRzPXRoaXMuc2l6ZSgpOwogICAgZm9yICggdmFyIGkgPSAwOyBpIDwgbnVtc3ViZmllbGRzOyBpKysgKSB7CiAgICAgICAgdmFyIGN1cnN1YmZpZWxkPXRoaXMuc3ViZmllbGQoIGkgKTsKICAgICAgICB2YXIgc3ViZmllbGRGdW5jdGlvbnMgPSBtYXAuZnVuY3Rpb25zW2N1cnN1YmZpZWxkLm5hbWVdOwogICAgICAgIGlmIChzdWJmaWVsZEZ1bmN0aW9ucykgewogICAgICAgICAgICB2YXIgbGVuZ3RoID0gc3ViZmllbGRGdW5jdGlvbnMubGVuZ3RoOwogICAgICAgICAgICBMb2cuZGVidWcoIlJlY29yZC5lYWNoU3ViRmllbGRNYXAgQ2FsbGluZyAiLCBsZW5ndGgsICIgbWV0aG9kcyBmb3Igc3ViZmllbGQgIiwgY3Vyc3ViZmllbGQpOwogICAgICAgICAgICBmb3IgKHZhciBqID0gMCA7IGogPCBsZW5ndGggOyBqKyspIHsKICAgICAgICAgICAgICAgIChzdWJmaWVsZEZ1bmN0aW9uc1tqXSkodGhpcywgY3Vyc3ViZmllbGQsIGV4dHJhRGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKfTsKCgovLyBTZWUgZG9jIGluIE1hcmNDbGFzc2VzLnVzZS5qcwpGaWVsZC5wcm90b3R5cGUuZmlyc3RTdWJGaWVsZCA9IGZ1bmN0aW9uKCBtYXRjaGVyLCBoYW5kbGVyICkgewogICAgcmV0dXJuIG5ldyBFYWNoRmFjdG9yeSggKS5maXJzdFN1YkZpZWxkKCB0aGlzLCBnZXRNYXRjaFN1YkZpZWxkKCBtYXRjaGVyICksIGhhbmRsZXIgKTsKfTsKCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzCkZpZWxkLnByb3RvdHlwZS5lYWNoU3ViRmllbGRTZXF1ZW5jZSA9IGZ1bmN0aW9uKCBtYXRjaGVycywgaGFuZGxlciApIHsKICAgIHJldHVybiBuZXcgRWFjaEZhY3RvcnkoICkuZWFjaEZpZWxkU2VxdWVuY2UoIHRoaXMsIG1hdGNoZXJzLCBoYW5kbGVyICk7Cn07CgovLyBTZWUgZG9jIGluIE1hcmNDbGFzc2VzLnVzZS5qcwpGaWVsZC5wcm90b3R5cGUuZXhpc3RzID0gZnVuY3Rpb24oIG1hdGNoZXIgKSB7CiAgICB2YXIgcmVzdWx0ID0gZmFsc2U7CgogICAgdGhpcy5lYWNoU3ViRmllbGQoIGdldE1hdGNoU3ViRmllbGQoIG1hdGNoZXIgKSwgZnVuY3Rpb24oIGZpZWxkLCBzdWJGaWVsZCApIHsKICAgICAgICAgICAgcmVzdWx0ID0gdHJ1ZTsKICAgICAgICB9ICk7CgogICAgcmV0dXJuIHJlc3VsdDsKfTsKCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzCkZpZWxkLnByb3RvdHlwZS5pc1VuaXF1ZSA9IGZ1bmN0aW9uKCBtYXRjaGVyICkgewogICAgcmV0dXJuIHRoaXMuZWFjaFN1YkZpZWxkKCBnZXRNYXRjaFN1YkZpZWxkKCBtYXRjaGVyICksIGZ1bmN0aW9uKCBmaWVsZCwgc3ViRmllbGQgKSB7CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0gKSA9PSAxOwp9OwoKLy8gU2VlIGRvYyBpbiBNYXJjQ2xhc3Nlcy51c2UuanMKRmllbGQucHJvdG90eXBlLmdldEZpcnN0VmFsdWUgPSBmdW5jdGlvbiggbWF0Y2hlciApIHsKCiAgICB2YXIgbXNmID0gbWF0Y2hlcjsKICAgIHZhciByZXN1bHQgPSB0aGlzLmZpcnN0U3ViRmllbGQoIG1zZiwgZnVuY3Rpb24oIGZpZWxkLCBzdWJGaWVsZCApIHsKICAgICAgICAgICAgaWYgKCAiIiAhPT0gc3ViRmllbGQudmFsdWUgfHwgc3ViRmllbGQudmFsdWUgIT09IHVuZGVmaW5lZCApIHsKICAgICAgICAgICAgICAgIHJldHVybiBzdWJGaWVsZC52YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0gKTsKICAgIGlmICggcmVzdWx0ICE9ICIiICkgewogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAiIjsKICAgIH07Cn07CgovLyBTZWUgZG9jIGluIE1hcmNDbGFzc2VzLnVzZS5qcwpGaWVsZC5wcm90b3R5cGUuZ2V0VmFsdWVBc0FycmF5ID0gZnVuY3Rpb24oIG1hdGNoZXIgKSB7CgogICAgdmFyIG1hdGNoZXJzOwoKICAgIGlmICggbWF0Y2hlciBpbnN0YW5jZW9mIEFycmF5ICkgewogICAgICAgIG1hdGNoZXJzID0gbWF0Y2hlcjsKICAgIH0gZWxzZSB7CiAgICAgICAgbWF0Y2hlcnMgPSBbIG1hdGNoZXIgXTsKICAgIH07CgogICAgdmFyIHJlc3VsdCA9IFtdOwogICAgZm9yICggdmFyIGkgPSAwOyBpIDwgbWF0Y2hlcnMubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgdmFyIG1zZiA9IGdldE1hdGNoU3ViRmllbGQoIG1hdGNoZXJzWyBpIF0gKTsKCiAgICAgICAgdGhpcy5lYWNoU3ViRmllbGQoIG1zZiwgZnVuY3Rpb24oIGZpZWxkLCBzdWJGaWVsZCApIHsKICAgICAgICAgICAgICAgIGlmICggc3ViRmllbGQudmFsdWUgIT09ICIiICYmIHN1YkZpZWxkLnZhbHVlICE9PSB1bmRlZmluZWQgKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goIHN1YkZpZWxkLnZhbHVlICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gKTsKICAgIH07CiAgICBpZiAoIHJlc3VsdC5sZW5ndGggPiAwICkgewogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICByZXR1cm4gWyBdOwp9OwoKLy8gU2VlIGRvYyBpbiBNYXJjQ2xhc3Nlcy51c2UuanMKRmllbGQucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24oIG1hdGNoZXIsIHNlcCApIHsKCiAgICB2YXIgbWF0Y2hlcnM7CgogICAgaWYgKCBtYXRjaGVyIGluc3RhbmNlb2YgQXJyYXkgKSB7CiAgICAgICAgbWF0Y2hlcnMgPSBtYXRjaGVyOwogICAgfSBlbHNlIHsKICAgICAgICBtYXRjaGVycyA9IFsgbWF0Y2hlciBdOwogICAgfTsKCiAgICB2YXIgcmVzdWx0ID0gIiI7CiAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBtYXRjaGVycy5sZW5ndGg7IGkrKyApIHsKICAgICAgICB2YXIgbXNmID0gZ2V0TWF0Y2hTdWJGaWVsZCggbWF0Y2hlcnNbIGkgXSApOwoKICAgICAgICB0aGlzLmVhY2hTdWJGaWVsZCggbXNmLCBmdW5jdGlvbiggZmllbGQsIHN1YkZpZWxkICkgewogICAgICAgICAgICAgICAgaWYgKCByZXN1bHQgPT09ICIiICkgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHN1YkZpZWxkLnZhbHVlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIHNlcCAhPT0gdW5kZWZpbmVkICYmIHJlc3VsdCAhPT0gIiIgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBzZXA7CiAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHN1YkZpZWxkLnZhbHVlOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSApOwoKICAgIH07CgogICAgcmV0dXJuIHJlc3VsdDsKfTsKCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzCkZpZWxkLnByb3RvdHlwZS5tYXRjaFZhbHVlID0gZnVuY3Rpb24oIG1hdGNoZXIsIHZhbHVlUmVnRXhwICkgewogICAgcmV0dXJuIHZhbHVlUmVnRXhwLnRlc3QoIHRoaXMuZ2V0VmFsdWUoIG1hdGNoZXIgKSApOwp9OwoKLy8gU2VlIGRvYyBpbiBNYXJjQ2xhc3Nlcy51c2UuanMKRmllbGQucHJvdG90eXBlLnJlbW92ZVdpdGhNYXRjaGVyID0gZnVuY3Rpb24oIG1hdGNoZXIgKSB7CiAgICB2YXIgbWF0Y2hlcnM7CgogICAgaWYgKCBtYXRjaGVyIGluc3RhbmNlb2YgQXJyYXkgKSB7CiAgICAgICAgbWF0Y2hlcnMgPSBtYXRjaGVyOwogICAgfSBlbHNlIHsKICAgICAgICBtYXRjaGVycyA9IFsgbWF0Y2hlciBdOwogICAgfTsKCiAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBtYXRjaGVycy5sZW5ndGg7IGkrKyApIHsKICAgICAgICB2YXIgbXNmID0gZ2V0TWF0Y2hTdWJGaWVsZCggbWF0Y2hlcnNbIGkgXSApOwoKICAgICAgICB2YXIgaiA9IDA7CiAgICAgICAgd2hpbGUgKCBqIDwgdGhpcy5zaXplKCApICkgewogICAgICAgICAgICBpZiAoIG1zZi5tYXRjaFN1YkZpZWxkKCB0aGlzLCB0aGlzLnN1YmZpZWxkKCBqICkgKSApIHsKICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKCBqICk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBqKys7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIHJldHVybiAiIjsKfTsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vICAgICAgICAgICAgUmVjb3JkIHByb3RvdHlwZXMKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzClJlY29yZC5wcm90b3R5cGUuZ2V0Rmlyc3RGaWVsZEFzRmllbGQgPSBmdW5jdGlvbiggcmVnRXhGaWVsZE1hdGNoZXIgKSB7CiAgICAvL2lmIGl0cyBub3QgYSByZWdleCBvYmogd2Ugc2hvdWxkIHByb2JhbGx5IHRocm93IGFuIGVycm9yIGluIHRoZSBmdXR1cmUgbXZzCiAgICAvL2lmICghcmVnRXhGaWVsZE1hdGNoZXIgaW5zdGFuY2VvZiBSZWdFeHAgICkgewogICAgLy8gIHJldHVybiAiIjsKICAgIC8vfQoKICAgIC8vInRoaXMiIHJlZmVycyB0byB0aGUgcmVjb3JkIG9iagogICAgdmFyIHNpemUgPSB0aGlzLm51bWJlck9mRmllbGRzKCApOwoKICAgIGZvciAoIHZhciBpID0gMDsgaSA8IHNpemU7IGkrKyApIHsKICAgICAgICBpZiAoIHRoaXMuZmllbGQoIGkgKS5uYW1lLm1hdGNoKCByZWdFeEZpZWxkTWF0Y2hlciApICkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5maWVsZCggaSApOwogICAgICAgIH0KICAgIH07CiAgICAvL3dlIHJldHVybiBhbiBlbXB0eSBzdHJpbmcgaWYgbm8gdmFsaWQgZmllbGRzIGFyZSBpbiB0aGUgcmVjb3JkcwogICAgcmV0dXJuICIiOwp9OwoKLy8gU2VlIGRvYyBpbiBNYXJjQ2xhc3Nlcy51c2UuanMKUmVjb3JkLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKCApIHsKICAgIHZhciBuZXdSZWNvcmQgPSBuZXcgUmVjb3JkOwoKICAgIG5ld1JlY29yZC5yZWNvcmRTdGF0dXMgPSB0aGlzLnJlY29yZFN0YXR1czsKICAgIG5ld1JlY29yZC5pbXBsZW1lbnRhdGlvbkNvZGVzID0gdGhpcy5pbXBsZW1lbnRhdGlvbkNvZGVzOwoKICAgIGZvciAoIHZhciBpID0gMDsgaSA8IHRoaXMuc2l6ZSggKTsgaSsrICkgewogICAgICAgIG5ld1JlY29yZC5hcHBlbmQoIHRoaXMuZmllbGQoIGkgKS5jbG9uZSggKSApOwogICAgfTsKCiAgICByZXR1cm4gbmV3UmVjb3JkOwp9OwoKLy8gU2VlIGRvYyBpbiBNYXJjQ2xhc3Nlcy51c2UuanMKUmVjb3JkLnByb3RvdHlwZS5lbXB0eSA9IGZ1bmN0aW9uKCApIHsKICAgIHJldHVybiB0aGlzLnNpemUoICkgPT09IDA7Cn07CgovLyBTZWUgZG9jIGluIE1hcmNDbGFzc2VzLnVzZS5qcwpSZWNvcmQucHJvdG90eXBlLmVhY2hGaWVsZCA9IGZ1bmN0aW9uKCBtYXRjaGVyLCBhcmcyLCBhcmczICkgewogICAgaWYgKCBhcmczICE9IHVuZGVmaW5lZCApIHsKICAgICAgICByZXR1cm4gbmV3IEVhY2hGYWN0b3J5KCB0aGlzLCBhcmcyICkuZWFjaEZpZWxkKCBnZXRNYXRjaEZpZWxkKCBtYXRjaGVyICksIGFyZzMgKTsKICAgIH07CiAgICByZXR1cm4gbmV3IEVhY2hGYWN0b3J5KCB0aGlzICkuZWFjaEZpZWxkKCBnZXRNYXRjaEZpZWxkKCBtYXRjaGVyICksIGFyZzIgKTsKfTsKCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzClJlY29yZC5wcm90b3R5cGUuZWFjaEZpZWxkTWFwID0gZnVuY3Rpb24oIG1hcCwgZXh0cmFEYXRhICkgewogICAgdmFyIG51bWZpZWxkcz10aGlzLnNpemUoKTsKICAgIGZvciAoIHZhciBpID0gMDsgaSA8IG51bWZpZWxkczsgaSsrICkgewogICAgICAgIHZhciBjdXJmaWVsZD10aGlzLmZpZWxkKCBpICk7CiAgICAgICAgdmFyIGZpZWxkRnVuY3Rpb25zID0gbWFwLmZ1bmN0aW9uc1tjdXJmaWVsZC5uYW1lXTsKICAgICAgICBpZiAoZmllbGRGdW5jdGlvbnMpIHsKICAgICAgICAgICAgdmFyIGxlbmd0aCA9IGZpZWxkRnVuY3Rpb25zLmxlbmd0aDsKICAgICAgICAgICAgTG9nLmRlYnVnKCJSZWNvcmQuZWFjaEZpZWxkTWFwIENhbGxpbmcgIiwgbGVuZ3RoLCAiIG1ldGhvZHMgZm9yIGZpZWxkICIsIGN1cmZpZWxkKTsKICAgICAgICAgICAgZm9yICh2YXIgaiA9IDAgOyBqIDwgbGVuZ3RoIDsgaisrKSB7CiAgICAgICAgICAgICAgICAoZmllbGRGdW5jdGlvbnNbal0pKGN1cmZpZWxkLCBleHRyYURhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKfTsKCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzClJlY29yZC5wcm90b3R5cGUuZWFjaEZpZWxkTWFwV2l0aERlZmF1bHQgPSBmdW5jdGlvbiggbWFwLGRlZmF1bHRGdW5jdGlvbiwgZXh0cmFEYXRhKSB7CgogICAgdmFyIG1hdGNoID0gewogICAgICAgIG1hdGNoRmllbGQ6IGZ1bmN0aW9uKHJlY29yZCwgZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgbnVtZmllbGRzPXRoaXMuc2l6ZSgpOwogICAgZm9yICggdmFyIGkgPSAwOyBpIDwgbnVtZmllbGRzOyBpKysgKSB7CiAgICAgICAgdmFyIGN1cmZpZWxkPXRoaXMuZmllbGQoIGkgKTsKCiAgICAgICAgdmFyIGZpZWxkRnVuY3Rpb25zID0gbWFwLmZ1bmN0aW9uc1tjdXJmaWVsZC5uYW1lXTsKCiAgICAgICAgaWYgKCBmaWVsZEZ1bmN0aW9ucyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGZpZWxkRnVuY3Rpb25zID0gW2RlZmF1bHRGdW5jdGlvbl07CiAgICAgICAgfQogICAgICAgIHZhciBsZW5ndGggPSBmaWVsZEZ1bmN0aW9ucy5sZW5ndGg7CiAgICAgICAgZm9yICh2YXIgZmluZGV4ID0gMCA7IGZpbmRleCA8IGxlbmd0aCA7IGZpbmRleCsrKSB7CiAgICAgICAgICAgIChmaWVsZEZ1bmN0aW9uc1tmaW5kZXhdKShjdXJmaWVsZCwgZXh0cmFEYXRhKTsKCiAgICAgICAgfQogICAgfQp9OwoKCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzClJlY29yZC5wcm90b3R5cGUuZmlyc3RGaWVsZCA9IGZ1bmN0aW9uKCBtYXRjaGVyLCBhcmcyLCBhcmczICkgewogICAgaWYgKCBhcmczICE9IHVuZGVmaW5lZCApIHsKICAgICAgICByZXR1cm4gbmV3IEVhY2hGYWN0b3J5KCB0aGlzLCBhcmcyICkuZmlyc3RGaWVsZCggZ2V0TWF0Y2hGaWVsZCggbWF0Y2hlciApLCBhcmczICk7CiAgICB9OwoKICAgIHJldHVybiBuZXcgRWFjaEZhY3RvcnkoIHRoaXMgKS5maXJzdEZpZWxkKCBnZXRNYXRjaEZpZWxkKCBtYXRjaGVyICksIGFyZzIgKTsKfTsKCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzClJlY29yZC5wcm90b3R5cGUuZWFjaEZpZWxkU2VxdWVuY2UgPSBmdW5jdGlvbiggbWF0Y2hlcnMsIGFyZzIsIGFyZzMgKSB7CiAgICBpZiAoIGFyZzMgIT0gdW5kZWZpbmVkICkgewogICAgICAgIHJldHVybiBuZXcgRWFjaEZhY3RvcnkoIHRoaXMsIGFyZzIgKS5lYWNoRmllbGRTZXF1ZW5jZSggbWF0Y2hlcnMsIGFyZzMgKTsKICAgIH07CgogICAgcmV0dXJuIG5ldyBFYWNoRmFjdG9yeSggdGhpcyApLmVhY2hGaWVsZFNlcXVlbmNlKCBtYXRjaGVycywgYXJnMiApOwp9OwoKLy8gU2VlIGRvYyBpbiBNYXJjQ2xhc3Nlcy51c2UuanMKUmVjb3JkLnByb3RvdHlwZS5zZWxlY3RGaWVsZHMgPSBmdW5jdGlvbiggbWF0Y2hlciwgc29ydGVycyApIHsKICAgIHJldHVybiBuZXcgRWFjaEZhY3RvcnkoIHRoaXMsIHNvcnRlcnMgKS5zZWxlY3RGaWVsZHMoIGdldE1hdGNoRmllbGQoIG1hdGNoZXIgKSApOwp9OwoKLy8gU2VlIGRvYyBpbiBNYXJjQ2xhc3Nlcy51c2UuanMKUmVjb3JkLnByb3RvdHlwZS5zZWxlY3RGaWVsZHNTZXF1ZW5jZSA9IGZ1bmN0aW9uKCBtYXRjaGVyLCBzb3J0ZXJzICkgewogICAgcmV0dXJuIG5ldyBFYWNoRmFjdG9yeSggdGhpcywgc29ydGVycyApLnNlbGVjdEZpZWxkc1NlcXVlbmNlKCBtYXRjaGVyICk7Cn07CgovLyBTZWUgZG9jIGluIE1hcmNDbGFzc2VzLnVzZS5qcwpSZWNvcmQucHJvdG90eXBlLnNpemUgPSBmdW5jdGlvbiggKSB7CiAgICByZXR1cm4gdGhpcy5udW1iZXJPZkZpZWxkcyggKTsKfTsKCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzClJlY29yZC5wcm90b3R5cGUuZXhpc3RGaWVsZCA9IGZ1bmN0aW9uKCBtYXRjaGVyICkgewogICAgdmFyIHJlc3VsdCA9IGZhbHNlOwoKCXZhciBkb01hdGNoZXIgPSBnZXRNYXRjaEZpZWxkKCBtYXRjaGVyICk7CglpZiAoIGRvTWF0Y2hlciA9PT0gdW5kZWZpbmVkICkgewoJCQkvLyBRdWVzdGlvbiBpcyBpZiB0aGlzIGJlaGF2aW91ciBtYWtlcyBzZW5zZQoJCQlyZXR1cm4gdHJ1ZTsKCX0KCgl2YXIgc3RvcHBlciA9IHRoaXMuc2l6ZSgpOwogICAgZm9yICggdmFyIGkgPSAwOyBpIDwgc3RvcHBlcjsgaSsrICkgewogICAgICAgIGlmICggZG9NYXRjaGVyLm1hdGNoRmllbGQoIHRoaXMsIHRoaXMuZmllbGQoIGkgKSApICkgewoJCQlyZXR1cm4gdHJ1ZTsKICAgICAgICB9OwogICAgfTsKCiAgICByZXR1cm4gcmVzdWx0Owp9OwoKLy8gU2VlIGRvYyBpbiBNYXJjQ2xhc3Nlcy51c2UuanMKUmVjb3JkLnByb3RvdHlwZS5pc1VuaXF1ZSA9IGZ1bmN0aW9uKCBtYXRjaGVyICkgewogICAgcmV0dXJuIHRoaXMuZWFjaEZpZWxkKCBnZXRNYXRjaEZpZWxkKCBtYXRjaGVyICksIGZ1bmN0aW9uKCBmaWVsZCApIHsKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfSApID09IDE7Cn07CgovLyBTZWUgZG9jIGluIE1hcmNDbGFzc2VzLnVzZS5qcwpSZWNvcmQucHJvdG90eXBlLmdldEZpcnN0VmFsdWUgPSBmdW5jdGlvbiggZmllbGRNYXRjaGVyLCBzdWJGaWVsZE1hdGNoZXIgKSB7CgogICAgdmFyIHJlc3VsdCA9IHRoaXMuZmlyc3RGaWVsZCggZ2V0TWF0Y2hGaWVsZCggZmllbGRNYXRjaGVyICksIGZ1bmN0aW9uKCBmaWVsZCApIHsKICAgICAgICAgICAgaWYgKCAiIiAhPSBmaWVsZC5nZXRGaXJzdFZhbHVlKCBzdWJGaWVsZE1hdGNoZXIgKSApIHsKICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZC5nZXRGaXJzdFZhbHVlKCBzdWJGaWVsZE1hdGNoZXIgKTsKICAgICAgICAgICAgfQogICAgICAgIH0gKTsKICAgIGlmICggIiIgIT0gcmVzdWx0ICYmIHVuZGVmaW5lZCAhPT0gcmVzdWx0ICkgewogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAiIjsKICAgIH07Cn07CgovLyBTZWUgZG9jIGluIE1hcmNDbGFzc2VzLnVzZS5qcwpSZWNvcmQucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24oIGZpZWxkTWF0Y2hlciwgc3ViRmllbGRNYXRjaGVyLCBzZXAgKSB7CiAgICB2YXIgcmVzdWx0ID0gIiI7CgogICAgdGhpcy5lYWNoRmllbGQoIGdldE1hdGNoRmllbGQoIGZpZWxkTWF0Y2hlciApLCBmdW5jdGlvbiggZmllbGQgKSB7CiAgICAgICAgICAgIGlmICggc2VwICE9PSB1bmRlZmluZWQgJiYgcmVzdWx0ICE9PSAiIiApIHsKICAgICAgICAgICAgICAgIHJlc3VsdCArPSBzZXA7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICByZXN1bHQgKz0gZmllbGQuZ2V0VmFsdWUoIHN1YkZpZWxkTWF0Y2hlciwgc2VwICk7CiAgICAgICAgfSApOwoKICAgIHJldHVybiByZXN1bHQ7Cn07CgovLyBTZWUgZG9jIGluIE1hcmNDbGFzc2VzLnVzZS5qcwpSZWNvcmQucHJvdG90eXBlLm1hdGNoVmFsdWUgPSBmdW5jdGlvbiggZmllbGRNYXRjaGVyLCBzdWJGaWVsZE1hdGNoZXIsIHZhbHVlUmVnRXhwICkgewogICAgcmV0dXJuIHZhbHVlUmVnRXhwLnRlc3QoIHRoaXMuZ2V0VmFsdWUoIGZpZWxkTWF0Y2hlciwgc3ViRmllbGRNYXRjaGVyICkgKTsKfTsKCi8vIFNlZSBkb2MgaW4gTWFyY0NsYXNzZXMudXNlLmpzClJlY29yZC5wcm90b3R5cGUucmVtb3ZlV2l0aE1hdGNoZXIgPSBmdW5jdGlvbiggbWF0Y2hlciApIHsKICAgIHZhciBtYXRjaGVyczsKCiAgICBpZiAoIG1hdGNoZXIgaW5zdGFuY2VvZiBBcnJheSApIHsKICAgICAgICBtYXRjaGVycyA9IG1hdGNoZXI7CiAgICB9IGVsc2UgewogICAgICAgIG1hdGNoZXJzID0gWyBtYXRjaGVyIF07CiAgICB9OwoKICAgIGZvciAoIHZhciBpID0gMDsgaSA8IG1hdGNoZXJzLmxlbmd0aDsgaSsrICkgewogICAgICAgIHZhciBtc2YgPSBnZXRNYXRjaEZpZWxkKCBtYXRjaGVyc1sgaSBdICk7CgogICAgICAgIHZhciBqID0gMDsKICAgICAgICB3aGlsZSAoIGogPCB0aGlzLnNpemUoICkgKSB7CiAgICAgICAgICAgIGlmICggbXNmLm1hdGNoRmllbGQoIHRoaXMsIHRoaXMuZmllbGQoIGogKSApICkgewogICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoIGogKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGorKzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07Cn07CgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICBFYWNoRmFjdG9yeSBjbGFzcwovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKZnVuY3Rpb24gRWFjaEZhY3RvcnkoIHJlY29yZCwgc29ydGVyICkgewogICAgdGhpcy5yZWNvcmQgPSByZWNvcmQ7CiAgICB0aGlzLnNvcnRlciA9IHNvcnRlcjsKfTsKCkVhY2hGYWN0b3J5LnByb3RvdHlwZS5lYWNoRmllbGQgPSBmdW5jdGlvbiggbWF0Y2hlciwgaGFuZGxlciApIHsKICAgIHZhciByZXN1bHQgPSAiIjsKICAgIHZhciBmaWVsZHMgPSB0aGlzLnNlbGVjdEZpZWxkcyggbWF0Y2hlciApOwoKICAgIGlmICggdGhpcy5zb3J0ZXIgIT0gdW5kZWZpbmVkICkgewogICAgICAgIHZhciBzb3J0ZXIgPSBuZXcgU29ydGVyKCB0aGlzLnNvcnRlciApOwoKICAgICAgICBmaWVsZHMuc29ydCggZnVuY3Rpb24oIGEsIGIgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc29ydGVyLnNvcnQoIGEsIGIgKTsKICAgICAgICAgICAgfSApOwogICAgfTsKCiAgICB2YXIgZmlyc3QgPSB0cnVlOwogICAgZm9yICggdmFyIGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrICkgewogICAgICAgIGlmICggZmlyc3QgKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuY2FsbEZpZWxkSGFuZGxlciggaGFuZGxlciwgZmllbGRzWyBpIF0gKTsKICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHQgKz0gdGhpcy5jYWxsRmllbGRIYW5kbGVyKCBoYW5kbGVyLCBmaWVsZHNbIGkgXSApOwogICAgICAgIH07CiAgICB9OwoKICAgIHJldHVybiByZXN1bHQ7Cn07CgpFYWNoRmFjdG9yeS5wcm90b3R5cGUuZmlyc3RGaWVsZCA9IGZ1bmN0aW9uKCBtYXRjaGVyLCBoYW5kbGVyICkgewoKICAgIHZhciByZXN1bHQgPSAiIjsKICAgIHZhciBmaWVsZHMgPSB0aGlzLnNlbGVjdEZpZWxkcyggbWF0Y2hlciApOwoKICAgIGlmICggdGhpcy5zb3J0ZXIgIT0gdW5kZWZpbmVkICkgewogICAgICAgIHZhciBzb3J0ZXIgPSBuZXcgU29ydGVyKCB0aGlzLnNvcnRlciApOwoKICAgICAgICBmaWVsZHMuc29ydCggZnVuY3Rpb24oIGEsIGIgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc29ydGVyLnNvcnQoIGEsIGIgKTsKICAgICAgICAgICAgfSApOwogICAgfTsKCiAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgcmVzdWx0ID0gdGhpcy5jYWxsRmllbGRIYW5kbGVyKCBoYW5kbGVyLCBmaWVsZHNbIGkgXSApOwogICAgICAgIGlmICggIiIgIT0gcmVzdWx0ICYmIHVuZGVmaW5lZCAhPT0gcmVzdWx0ICkgewogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgIH07CiAgICByZXR1cm4gcmVzdWx0Owp9OwoKRWFjaEZhY3RvcnkucHJvdG90eXBlLmVhY2hGaWVsZFNlcXVlbmNlID0gZnVuY3Rpb24oIG1hdGNoZXJzLCBoYW5kbGVyICkgewogICAgdmFyIHJlc3VsdCA9ICIiOwogICAgdmFyIG1heCA9IDA7CiAgICB2YXIgc2VxcyA9IG5ldyBBcnJheTsKCiAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBtYXRjaGVycy5sZW5ndGg7IGkrKyApIHsKICAgICAgICB2YXIgc2VxID0gdGhpcy5zZWxlY3RGaWVsZHMoIG1hdGNoZXJzWyBpIF0gKTsKCiAgICAgICAgaWYgKCB0aGlzLnNvcnRlciAhPSB1bmRlZmluZWQgKSB7CiAgICAgICAgICAgIHZhciBzb3J0ZXIgPSBuZXcgU29ydGVyKCB0aGlzLnNvcnRlciApOwoKICAgICAgICAgICAgc2VxLnNvcnQoIGZ1bmN0aW9uKCBhLCBiICkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzb3J0ZXIuc29ydCggYSwgYiApOwogICAgICAgICAgICAgICAgfSApOwogICAgICAgIH07CgogICAgICAgIHNlcXMucHVzaCggc2VxICk7CgogICAgICAgIGlmICggbWF4IDwgc2VxLmxlbmd0aCApIHsKICAgICAgICAgICAgbWF4ID0gc2VxLmxlbmd0aDsKICAgICAgICB9OwogICAgfTsKCiAgICB2YXIgZmlyc3QgPSB0cnVlOwogICAgZm9yICggdmFyIGkgPSAwOyBpIDwgbWF4OyBpKysgKSB7CiAgICAgICAgZm9yICggdmFyIHNlcSA9IDA7IHNlcSA8IHNlcXMubGVuZ3RoOyBzZXErKyApIHsKICAgICAgICAgICAgaWYgKCBpIDwgc2Vxc1sgc2VxIF0ubGVuZ3RoICkgewogICAgICAgICAgICAgICAgaWYgKCBmaXJzdCApIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLmNhbGxGaWVsZEhhbmRsZXIoIGhhbmRsZXIsIHNlcXNbIHNlcSBdWyBpIF0gKTsKICAgICAgICAgICAgICAgICAgICBmaXJzdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gdGhpcy5jYWxsRmllbGRIYW5kbGVyKCBoYW5kbGVyLCBzZXFzWyBzZXEgXVsgaSBdICk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9OwogICAgICAgIH07CiAgICB9OwoKICAgIHJldHVybiByZXN1bHQ7Cn07CgpFYWNoRmFjdG9yeS5wcm90b3R5cGUuZmlyc3RTdWJGaWVsZCA9IGZ1bmN0aW9uKCBmaWVsZCwgbWF0Y2hlciwgaGFuZGxlciApIHsKCiAgICB2YXIgcmVzdWx0ID0gIiI7CgogICAgZm9yICggdmFyIGkgPSAwOyBpIDwgZmllbGQuY291bnQoICk7IGkrKyApIHsKICAgICAgICBpZiAoIG1hdGNoZXIgPT0gdW5kZWZpbmVkIHx8IG1hdGNoZXIubWF0Y2hTdWJGaWVsZCggZmllbGQsIGZpZWxkLnN1YmZpZWxkKCBpICkgKSApIHsKICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5jYWxsU3ViRmllbGRIYW5kbGVyKCBoYW5kbGVyLCBmaWVsZCwgZmllbGQuc3ViZmllbGQoIGkgKSApOwogICAgICAgICAgICBpZiAoICIiICE9IHJlc3VsdCApIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfTsKCiAgICBpZiAoIHJlc3VsdCA9PT0gdW5kZWZpbmVkICkge30gZWxzZSB7CgogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKfTsKRWFjaEZhY3RvcnkucHJvdG90eXBlLmVhY2hTdWJGaWVsZCA9IGZ1bmN0aW9uKCBmaWVsZCwgbWF0Y2hlciwgaGFuZGxlciApIHsKCiAgICB2YXIgcmVzdWx0ID0gIiI7CgoKICAgIHZhciBmaXJzdCA9IHRydWU7CiAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBmaWVsZC5jb3VudCggKTsgaSsrICkgewogICAgICAgIGlmICggbWF0Y2hlciA9PSB1bmRlZmluZWQgfHwgbWF0Y2hlci5tYXRjaFN1YkZpZWxkKCBmaWVsZCwgZmllbGQuc3ViZmllbGQoIGkgKSApICkgewogICAgICAgICAgICBpZiAoIGZpcnN0ICkgewogICAgICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5jYWxsU3ViRmllbGRIYW5kbGVyKCBoYW5kbGVyLCBmaWVsZCwgZmllbGQuc3ViZmllbGQoIGkgKSApOwogICAgICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlc3VsdCArPSB0aGlzLmNhbGxTdWJGaWVsZEhhbmRsZXIoIGhhbmRsZXIsIGZpZWxkLCBmaWVsZC5zdWJmaWVsZCggaSApICk7CiAgICAgICAgICAgIH07CiAgICAgICAgfTsKICAgIH07CgogICAgcmV0dXJuIHJlc3VsdDsKfTsKCkVhY2hGYWN0b3J5LnByb3RvdHlwZS5lYWNoU3ViRmllbGRTZXF1ZW5jZSA9IGZ1bmN0aW9uKCBmaWVsZCwgbWF0Y2hlcnMsIGhhbmRsZXIgKSB7CiAgICB2YXIgcmVzdWx0ID0gIiI7CgogICAgdmFyIGZpcnN0ID0gdHJ1ZTsKICAgIGZvciAoIHZhciBpID0gMDsgaSA8IG1hdGNoZXJzLmxlbmd0aDsgaSsrICkgewogICAgICAgIGlmICggZmlyc3QgKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuZWFjaFN1YkZpZWxkKCBmaWVsZCwgbWF0Y2hlcnNbIGkgXSwgaGFuZGxlciApOwogICAgICAgICAgICBmaXJzdCA9IGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlc3VsdCArPSB0aGlzLmVhY2hTdWJGaWVsZCggZmllbGQsIG1hdGNoZXJzWyBpIF0sIGhhbmRsZXIgKTsKICAgICAgICB9OwogICAgfTsKCiAgICByZXR1cm4gcmVzdWx0Owp9OwoKCgpFYWNoRmFjdG9yeS5wcm90b3R5cGUuc2VsZWN0RmllbGRzID0gZnVuY3Rpb24oIG1hdGNoZXIgKSB7CiAgICB2YXIgbGlzdCA9IG5ldyBBcnJheTsKCiAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCB0aGlzLnJlY29yZC5zaXplKCApOyBpKysgKSB7CiAgICAgICAgaWYgKCBtYXRjaGVyID09PSB1bmRlZmluZWQgfHwgbWF0Y2hlci5tYXRjaEZpZWxkKCB0aGlzLnJlY29yZCwgdGhpcy5yZWNvcmQuZmllbGQoIGkgKSApICkgewogICAgICAgICAgICBsaXN0LnB1c2goIHRoaXMucmVjb3JkLmZpZWxkKCBpICkgKTsKICAgICAgICB9OwogICAgfTsKCiAgICByZXR1cm4gbGlzdDsKfTsKCkVhY2hGYWN0b3J5LnByb3RvdHlwZS5zZWxlY3RGaWVsZHNTZXF1ZW5jZSA9IGZ1bmN0aW9uKCBtYXRjaGVycyApIHsKICAgIHZhciBsaXN0ID0gbmV3IEFycmF5OwoKICAgIGZvciAoIHZhciBpID0gMDsgaSA8IG1hdGNoZXJzLmxlbmd0aDsgaSsrICkgewogICAgICAgIGxpc3QgPSBsaXN0LmNvbmNhdCggdGhpcy5zZWxlY3RGaWVsZHMoIG1hdGNoZXJzWyBpIF0gKSApOwogICAgfTsKCiAgICByZXR1cm4gbGlzdDsKfTsKCkVhY2hGYWN0b3J5LnByb3RvdHlwZS5jYWxsRmllbGRIYW5kbGVyID0gZnVuY3Rpb24oIGhhbmRsZXIsIHJlY29yZCwgZmllbGQgKSB7CiAgICBpZiAoIGhhbmRsZXIgaW5zdGFuY2VvZiBIYW5kbGVyICkgewogICAgICAgIHJldHVybiBoYW5kbGVyLmZ1bmMuY2FsbCggaGFuZGxlci50aGlzT2JqLCByZWNvcmQsIGZpZWxkICk7CiAgICB9OwoKICAgIHJldHVybiBoYW5kbGVyKCByZWNvcmQsIGZpZWxkICk7Cn07CgpFYWNoRmFjdG9yeS5wcm90b3R5cGUuY2FsbFN1YkZpZWxkSGFuZGxlciA9IGZ1bmN0aW9uKCBoYW5kbGVyLCBmaWVsZCwgc3ViRmllbGQgKSB7CiAgICBpZiAoIGhhbmRsZXIgaW5zdGFuY2VvZiBIYW5kbGVyICkgewogICAgICAgIHJldHVybiBoYW5kbGVyLmZ1bmMuY2FsbCggaGFuZGxlci50aGlzT2JqLCBmaWVsZCwgc3ViRmllbGQgKTsKICAgIH07CgogICAgcmV0dXJuIGhhbmRsZXIoIGZpZWxkLCBzdWJGaWVsZCApOwp9OwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgSGFuZGxlciBjbGFzcwovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKLyoqIERlZmluZXMgYSBoYW5kbGVyIG9iamVjdCB0aGVuIHdlIGl0ZXJhdGUgb3ZlciBmaWVsZHMgb3Igc3ViIGZpZWxkcyB3aXRoIFJlY29yZC5lYWNoRmllbGQsCiAqIEZpZWxkLmVhY2hTdWJGaWVsZHMsIGV0Yy4KICoKICogQHBhcmFtIHtPYmplY3R9IFt0aGlzT2JqXSBUaGlzIGlzIHRoZSBvYmplY3QgdGhhdCB3aWxsIGJlIHBhc3NlZCBhcyB0aGUgInRoaXMiIG9iamVjdCwgdGhlbiB0aGUgZnVuY3Rpb24KICogCQkgIGlzIGludm9rZWQuIFRoaXMgbG9naWMgaXMgaW1wbGVtZW50YXRlZCBpbiB0aGUgRWFjaEZhY3RvcnkgdHlwZS4KICogQHBhcmFtIHtGdW5jdGlvbn0gW2Z1bmNdIFRoZSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgaW52b2tlZCBmb3IgZWFjaCBGaWVsZCBvciBTdWJmaWVsZCBpbiBhIHJlY29yZC4KICogQGNvbnN0cnVjdG9yCiAqIEBzZWUgTWFyY0NsYXNzZXMKICogQHNlZSBSZWNvcmQKICogQHNlZSBGaWVsZAogKiBAbmFtZSBIYW5kbGVyICovCmZ1bmN0aW9uIEhhbmRsZXIoIHRoaXNPYmosIGZ1bmMgKSB7CiAgICB0aGlzLnRoaXNPYmogPSB0aGlzT2JqOwogICAgdGhpcy5mdW5jID0gZnVuYzsKfTsKCg==", "moduleName": "Marc"}, {"javascript": "LyoqIEBmaWxlIGRvY3VtZW50YXRpb24gZm9yIFJlY29yZCwgRmllbGQgYW5kIFN1YmZpZWxkICovCi8vIFRoaXMgaXMgbm90IGFjdHVhbGx5IHRoZSBNYXJjQ2xhc3NlcyAoUmVjb3JkLCBGaWVsZCwgU3ViZmllbGQpLCAKLy8gYnV0IHJhdGhlciB0aGUgZG9jdW1lbnRhdGlvbiBvZiB0aGVtLgovLyBUaGUgYWN0dWFsIGltcGxlbWVudGF0aW9uIGlzIGluIE1hcmNDbGFzc2VzQ29yZS4KCnVzZSggIlN5c3RlbSIgKTsKdXNlKCAiTWFyY0NsYXNzZXNDb3JlIiApOwoKRVhQT1JURURfU1lNQk9MUyA9IFsiTWFyY0NsYXNzZXMiXTsKCgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyBET0NVTUVOVEFUSU9OCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgovKiogTW9kdWxlIHRvIGFsbG93IHJlcHJlc2VudGF0aW9uIG9mIE1hcmMgb2JqZWN0cy4KICoKICogSW4gb3JkZXIgdG8gYWxsb3cgcmVwcmVzZW50YXRpb25zIG9mIE1hcmMgb2JqZWN0cywgdGhlIE1hcmNDbGFzc2VzCiAqIG1vZHVsZSBleHBvc2VzIHRocmVlIGNsYXNzZXM6IFJlY29yZCwgRmllbGQgYW5kIFN1YmZpZWxkLiBUaGV5CiAqIHJlcHJlc2VudCBhIE1hcmMgcmVjb3JkLCBmaWVsZCBhbmQgc3ViZmllbGQgcmVzcGVjdGl2ZWx5LgogKgogKiBBbHRob3VnaCBNYXJjQ2xhc3NlcyBpcyBwcmVzZW50ZWQgYXMgYSBuYW1lc3BhY2UsIHRoZSBSZWNvcmQsIEZpZWxkCiAqIGFuZCBTdWJmaWVsZCBjbGFzc2VzIGxpdmUgaW4gdGhlIGdsb2JhbCBuYW1lc3BhY2UuIFRoaXMgaXMgZm9yCiAqIGhpc3RvcmljYWwgcmVhc29ucyAtIHRoZXNlIGNsYXNzZXMgd2VyZSBpbnRyb2R1Y2VkIGludG8gdGhlIERCQwogKiBKYXZhU2NyaXB0IHN5c3RlbSBiZWZvcmUgbW9kdWxlIHN1cHBvcnQgd2FzIGVzdGFibGlzaGVkLgogKgogKiBAc2VlIFJlY29yZAogKiBAc2VlIEZpZWxkCiAqIEBzZWUgU3ViZmllbGQKICogQG5hbWUgTWFyY0NsYXNzZXMKICogQG5hbWVzcGFjZSAqLwpNYXJjQ2xhc3NlcyA9ICggZnVuY3Rpb24oKSB7CiAgICB2YXIgZXhwb3J0cyA9IHt9OwogICAgZXhwb3J0cy5SZWNvcmQgPSBSZWNvcmQ7CiAgICBleHBvcnRzLkZpZWxkID0gRmllbGQ7CiAgICBleHBvcnRzLlN1YmZpZWxkID0gU3ViZmllbGQ7CiAgICByZXR1cm4gZXhwb3J0czsKfSgpICk7CgoKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyBSRUNPUkQKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKLy8gTm90ZSwgdGhhdCBhIGxvdCBwcm9wZXJ0aWVzIGlzIGFzc2lnbmVkIHRvIHRoZSBjb25zdHJ1Y3RvciwgdG8gaGF2ZSBzb21ldGhpbmcKLy8gdG8gYXR0YWNoIHRoZSBkb2N1bWVudGF0aW9uIHRvLgoKLyoqIEFic3RyYWN0aW9uIGZvciBhIE1hcmMgcmVjb3JkLgogKgogKiBUaGUgUmVjb3JkIGNsYXNzIGlzIGFuIGFic3RyYWN0aW9uIGZvciBhIE1hcmMgcmVjb3JkLgogKgogKiBJdCBjb250YWlucyBhIG51bWJlciBvZiBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzIHRvIHJlcHJlc2VudCBhbmQKICogbWFuaXB1bGF0ZSBhIHJlY29yZCwgaW5jbHVkaW5nIHRoZSBoZWFkZXIuCiAqCiAqIEBleGFtcGxlIC8vIFlvdSBjb25zdHJ1Y3QgYSBuZXcgUmVjb3JkIGluc3RhbmNlIGxpa2UgdGhpczoKIHZhciByID0gbmV3IFJlY29yZCgpOwogKgogKiBAbmFtZSBSZWNvcmQKICogQGNvbnN0cnVjdG9yCiAqIEBzZWUgTWFyY0NsYXNzZXMKICogQHNlZSBGaWVsZAogKiBAc2VlIFN1YmZpZWxkICovCi8vIERvIG5vdCByZW1vdmUgdGhpcyBjb21tZW50CgovLyBQUk9QRVJUSUVTCgovKiogVGhlIGZvclVzZXJTeXN0ZW1zIHByb3BlcnR5IG9mIHRoZSByZWNvcmQuCiAqCiAqIFRoaXMgcHJvcGVydHkgaG9sZHMgdGhlIGZvclVzZXJTeXN0ZW1zIHN0cmluZyBmb3IgdGhlIHJlY29yZC4KICoKICogQHR5cGUge3N0cmluZ30KICogQG5hbWUgUmVjb3JkLmZvclVzZXJTeXN0ZW1zCiAqIEBuYW1lIFJlY29yZCNmb3JVc2VyU3lzdGVtcyAqLwpSZWNvcmQuZm9yVXNlclN5c3RlbXMgPSBuZXcgU3RyaW5nKCk7CgovKiogVGhlIGltcGxlbWVudGF0aW9uIGNvZGVzIG9mIHRoZSByZWNvcmQuCiAqCiAqIFRoaXMgcHJvcGVydHkgaG9sZHMgdGhlIGltcGxlbWVudGF0aW9uIGNvZGVzIGZvciB0aGUgcmVjb3JkLCBhcyBhIHN0cmluZy4KICoKICogQHR5cGUge3N0cmluZ30KICogQG5hbWUgUmVjb3JkLmltcGxlbWVudGF0aW9uQ29kZXMKICogQG5hbWUgUmVjb3JkI2ltcGxlbWVudGF0aW9uQ29kZXMgKi8KUmVjb3JkLmltcGxlbWVudGF0aW9uQ29kZXMgPSBuZXcgU3RyaW5nKCk7CgovKiogVGhlIHN0YXR1cyBvZiB0aGUgcmVjb3JkLgogKgogKiBUaGlzIHByb3BlcnR5IGhvbGRzIHRoZSBzdGF0dXMgb2YgdGhlIHJlY29yZCBhcyBhIHN0cmluZyB3aXRoIGEgc2luZ2xlIGNoYXJhY3RlciBpbi4KICoKICogQHR5cGUge3N0cmluZ30KICogQG5hbWUgUmVjb3JkLnJlY29yZFN0YXR1cwogKiBAbmFtZSBSZWNvcmQjcmVjb3JkU3RhdHVzICovClJlY29yZC5yZWNvcmRTdGF0dXMgPSBuZXcgU3RyaW5nKCk7CgovLyBNRVRIT0RTCgovKiogQWRkcyBhIGZpZWxkIHRvIHRoZSByZWNvcmQuCiAqCiAqIFRoaXMgbWV0aG9kIGFkZHMgYSBmaWVsZCB0byB0aGUgcmVjb3JkLgogKgogKiBJdCBjYW4gYmUgY2FsbGVkIHdpdGggZWl0aGVyIGEgRmllbGQgaW5zdGFuY2UsIG9yIHR3byBTdHJpbmdzLgogKgogKiBJZiBjYWxsZWQgd2l0aCBhIEZpZWxkIGluc3RhbmNlLCB0aGUgaW5zdGFuY2UgaXMgY29waWVkIHRvIHRoZSByZWNvcmQuCiAqCiAqIElmIGNhbGxlZCB3aXRoIHR3byBTdHJpbmdzLCBhIG5ldyBGaWVsZCBpbnN0YW5jZSB3aWxsIGJlIGNyZWF0ZWQsCiAqIGJhc2VkIG9uIHRoZSB2YWx1ZSBvZiB0aGUgc3RyaW5ncywgYW5kIGFwcGVuZGVkIHRvIHRoZSByZWNvcmQuIFRoZQogKiBmaXJzdCBzdHJpbmcgaXMgdGhlbiB0aGUgbmFtZSBvZiB0aGUgZmllbGQsIHRoZSBzZWNvbmQgdGhlIGZpZWxkCiAqIGluZGljYXRvci4KICoKICogKipOb3RlOioqIEZvciB0aGUgQysrIGltcGxlbWVudGF0aW9uOiBBbnkgcmVmZXJlbmNlIHRvIGV4aXN0aW5nCiAqIGZpZWxkcyBvbiB0aGlzIHJlY29yZCBtYXkgYmUgaW52YWxpZGF0ZWQgYnkgYXBwZW5kIGEgZmllbGQuIFRoaXMKICogaGFzIGEgbnVtYmVyIG9mIHBvdGVudGlhbCBiYWQgY29uc2VxdWVuY2VzLCBtb3N0IG9mIHdoaWNoIGxlYWRzIHRvCiAqIGNyYXNoZXMgb3IgdW5wcmVkaWN0YWJsZSBiZWhhdmlvdXIuIEl0IGlzIGVhc3kgdG8gZmFsbCBpbnRvIHRoZQogKiB0cmFwIG9mIGUuZy4gaXRlcmF0aW5nIGFsbCBmaWVsZHMgaW4gYSByZWNvcmQsIGFuZCBhcHBlbmQgc29tZQogKiB3aGlsZSBpdGVyYXRpbmcuIFRoaXMgaXMgYWxtb3N0IGNlcnRhaW4gdG8gbWFrZSB5b3VyIGFwcGxpY2F0aW9uCiAqIGNyYXNoLiBJbnN0ZWFkLCBjb2xsZWN0IHRoZSBuZXcgZmllbGRzIHlvdSB3aXNoIHRvIGFwcGVuZCwgdGhlbgogKiBhcHBlbmQgdGhlbSBhZnRlciB5b3VyIG1haW4gaXRlcmF0aW9uLgogKgogKiBAZXhhbXBsZQogLy8gQXBwZW5kIGFuIGV4aXN0aW5nIGZpZWxkIHRvIGEgcmVjb3JkIChmaWVsZCB3aWxsIGJlIGNvcGllZCkKIGFSZWNvcmQuYXBwZW5kKCBmaWVsZCApOwogLy8gQ3JlYXRlIGEgbmV3IGZpZWxkLCBhbmQgYXBwZW5kIGl0IHRvIHRoZSByZWNvcmQKIGFSZWNvcmQuYXBwZW5kKCAiMDEwIiwgIjAyIiApOwogKiBAZXhhbXBsZQogLy8gVGhpcyBleGFtcGxlIGlsbHVzdHJhdGVzIHRoZSByZWxhdGlvbiBiZXR3ZWVuIGV4aXN0aW5nIHJlZmVyZW5jZXMsIGFuZCBuZXcgRmllbGRzLgogdmFyIGFSZWNvcmQgPSBuZXcgUmVjb3JkKCk7CiBhUmVjb3JkLmFwcGVuZCggIjAwMSIsICIwMiIgKTsKIHZhciBhRmllbGQgPSBhUmVjb3JkLmZpZWxkKCAiMDAxIiApOwogYUZpZWxkLm5hbWUgPSAiMDAyIiAvLyBDaGFuZ2VzIHRoZSBuYW1lIG9mIHRoZSBmaWVsZCBpbiBhUmVjb3JkCiB2YXIgbmV3UmVjb3JkID0gbmV3IFJlY29yZCgpOwogbmV3UmVjb3JkLmFwcGVuZCggYUZpZWxkICk7IC8vIGFGaWVsZCBpcyBjb3BpZWQgaW50byBuZXdSZWNvcmQKIGFGaWVsZC5uYW1lID0gIjAwMSIgLy8gQ2hhbmdlcyB0aGUgbmFtZSBvZiB0aGUgZmllbGQgaW4gYVJlY29yZCwgYnV0IG5vdCBpbiBuZXdSZWNvcmQuCiAqCiAqIEBwYXJhbSB7RmllbGR8c3RyaW5nfSBmaWVsZE9yRmllbGROYW1lIEEgRmllbGQgaW5zdGFuY2UgdG8gYWRkLCBvciB0aGUgbmFtZSBvZiBhIG5ldyBmaWVsZCB0byBjb25zdHJ1Y3QgYW5kIGFkZAogKiBAcGFyYW0ge3N0cmluZ30gW2ZpZWxkSW5kaWNhdG9yXSBUaGUgaW5kaWNhdG9yIHZhbHVlIG9mIHRoZSBuZXcgRmllbGQgdG8gYWRkLiAqTXVzdCBiZSBwcm92aWRlZCwgaWYgZmllbGRPckZpZWxkTmFtZSBpcyBhIHN0cmluZyBpbnN0YW5jZSB3aXRoIHRoZSBuYW1lIG9mIGEgZmllbGQuKgogKiBAbWV0aG9kCiAqIEBuYW1lIFJlY29yZC5hcHBlbmQKICogQG5hbWUgUmVjb3JkI2FwcGVuZCAqLwpSZWNvcmQuYXBwZW5kID0gbmV3IFN0cmluZygpOwoKLyoqIENyZWF0ZSBhIGNsb25lIChjb3B5KSBvZiB0aGlzIHJlY29yZC4KICoKICogQWxsIHRoZSBmaWVsZHMgb2YgdGhpcyBmaWVsZCBhcmUgYWxzbyBjbG9uZWQgYnkgdGhpcyBmdW5jdGlvbi4KICoKICogQHJldHVybiB7UmVjb3JkfSBBbiBleGFjdCBjbG9uZSBvZiB0aGlzIHJlY29yZC4KICoKICogQG1ldGhvZAogKiBAbmFtZSBSZWNvcmQuY2xvbmUKICogQG5hbWUgUmVjb3JkI2Nsb25lICovClJlY29yZC5jbG9uZSA9IG5ldyBTdHJpbmcoKTsKCi8qKiBDb3VudCB0aGUgbnVtYmVyIG9mIGZpZWxkcyBpbiBhIHJlY29yZCB3aXRoIGEgZ2l2ZW4gbmFtZS4KICoKICogR2l2ZW4gdGhlIG5hbWUgb2YgYSBmaWVsZCwgdGhpcyBtZXRob2QgcmV0dXJucyB0aGUgbnVtYmVyIG9mIGZpZWxkcwogKiB3aXRoIHRoYXQgbmFtZS4KICoKICogQHBhcmFtIHtzdHJpbmd9IGZpZWxkTmFtZSBUaGUgbmFtZSBvZiBhIGZpZWxkLgogKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBudW1iZXIgb2YgZmllbGRzIHdpdGggdGhlIGdpdmVuIGZpZWxkTmFtZQogKgogKiBAZXhhbXBsZQogLy8gR2V0IHRoZSBudW1iZXIgb2YgNTQ1IGZpZWxkcyBpbiBhIHJlY29yZAogdmFyIG51bSA9IGFSZWNvcmQuY291bnQoICI1NDUiICk7CiAqIEBtZXRob2QKICogQG5hbWUgUmVjb3JkLmNvdW50CiAqIEBuYW1lIFJlY29yZCNjb3VudCAqLwpSZWNvcmQuY291bnQgPSBuZXcgU3RyaW5nKCk7CgoKLyoqIEl0ZXJhdGVzIG92ZXIgdGhlIGZpZWxkcyBhbmQgY2FsbHMgYSBoYW5kbGVyIG9uIGVhY2ggZmllbGQuCiAqCiAqIFRoaXMgZnVuY3Rpb24gaGFzIDIgZm9ybXM6CiAqCiAqIElmIGdpdmVuIGEgbWF0Y2hlciBhbmQgYSBoYW5kbGVyLCB0aGVuIHRoZSBoYW5kbGVyIGlzIGNhbGxlZCBmb3IgZWFjaCBmaWVsZC4KICoKICogSWYgZ2l2ZW4gYSBtYXRjaGVyLCBhbiBhcnJheSBvZiBzb3J0ZXIgb2JqZWN0cyBhbmQgYSBoYW5kbGVyLCB0aGVuIHRoZSBtYXRjaGVkCiAqIGZpZWxkcyBhcmUgc29ydGVkIGJlZm9yZSB0aGUgaGFuZGxlciBpcyBjYWxsZWQgZm9yIGVhY2ggZmllbGQuCiAqCiAqIEBwYXJhbSB7UmVnRXhwfFN0cmluZ3xPYmplY3R9IG1hdGNoZXIgQSBSZWdFeHAgb3Igc3RyaW5nIHRoYXQgbWF0Y2hlcyB0aGUgZmllbGQgbmFtZQogKiAgICAgICAgICBvciBhbiBvYmplY3Qgd2l0aCBhIGZ1bmN0aW9uIG9mIHRoZSBub3JtOiBmdW5jdGlvbiBtYXRjaEZpZWxkKCByZWNvcmQsIGZpZWxkICkuCiAqICAgICAgICBUaGUgZnVuY3Rpb24gc2hvdWxkIHJldHVybiBhIGJvb2xlYW4gdmFsdWUuCiAqIEBwYXJhbSB7QXJyYXl9IHNvcnRlciBBbiBhcnJheSBvZiBvYmplY3RzIHRoYXQgaGFzIGEgZnVuY3Rpb246IHNvcnQoIGEsIGIgKS4gYSBhbmQKICogICAgICAgICAgYiBhcmUgZmllbGRzIGFuZCB0aGUgZnVuY3Rpb24gc2hvdWxkIHJldHVybiAtMSAoYSA8IGIpLCAwICggYSA9PSBiKSBvciAxIChhID4gYikuCiAqICAgICAgICAgIElmIHRoZSBmdW5jdGlvbiByZXR1cm5zIC0xIG9yIDEsIHRoZW4gdGhlIHR3byBmaWVsZHMgYXJlIHNvcnRlZCBhbmQgYW55IGZ1cnRoZXIKICogICAgICAgICAgZWxlbWVudHMgaW4gdGhlIGFycmF5IGFyZSBpZ25vcmVkIGZvciB0aGVzZSB0d28gZmllbGRzLgogKiBAcGFyYW0ge0hhbmRsZXJ8RnVuY3Rpb259IGhhbmRsZXIgVGhlIGhhbmRsZXIgdG8gY2FsbCBmb3IgZWFjaCBzdWJmaWVsZCBmb3VuZAogKiAgICAgICAgICBieSBtYXRjaGVyLgogKgogKiBAcmV0dXJuIElmIGhhbmRsZXIgcmV0dXJucyBhIHZhbHVlIHRoZW4gYWxsIHRoZSB2YWx1ZXMgYXJlIGFkZGVkIHRvZ2V0aGVyIGludG8gYQogKiAgICAgICAgICAgc2luZ2xlIHZhbHVlLgogKgogKiBAZXhhbXBsZQogLy8gUHJpbnQgYWxsIGZpZWxkcwogcmVjb3JkLmVhY2hGaWVsZCggLy4vLCBmdW5jdGlvbiggZmllbGQgKSB7CiAgICBwcmludCggZmllbGQudG9TdHJpbmcoKSArICJcbiIgKTsKfSApOwoKIC8vIExpc3QgZmllbGQgNzk1IHNvcnRlZCBieSBzdWIgZmllbGQgIsOlIgogcmVjb3JkLmVhY2hGaWVsZCggIjc5NSIsIFsgbmV3IFNvcnRCeVN1YkZpZWxkcyggL8OlLyApIF0sIGZ1bmN0aW9uKCBmaWVsZCApIHsKICAgIHByaW50KCBmaWVsZC50b1N0cmluZygpICsgIlxuIiApOwp9ICk7CgogLy8gSG93IHRvIHVzZSBhIGN1c3RvbSBtYXRjaGVyIGZ1bmN0aW9uIHdpdGggZWFjaEZpZWxkCiAvLyBUaGUgZnVuY3Rpb24gbWF0Y2hlcyBhbGwgZmllbGRzICI3MDAiIHdpdGggYSBzdWJmaWVsZCAiYSIuCiByZWNvcmQuZWFjaEZpZWxkKCB7IG1hdGNoRmllbGQ6IGZ1bmN0aW9uKCByZWNvcmQsIGZpZWxkICkgewogICAgcmV0dXJuIGZpZWxkLm5hbWUgPT09ICI3MDAiICYmIGZpZWxkLmV4aXN0cyggL2EvICkgfSB9LCBmdW5jdGlvbiggZmllbGQgKSB7CiAgICBwcmludCggZmllbGQudG9TdHJpbmcoKSArICJcbiIgICk7Cn0gKTsKCiAvL2NvbWJpbmUgZWFjaEZpZWxkIHdpdGggZWFjaFN1YkZpZWxkIHRvIHByaW50IGFsbCBzdWJmaWVsZCB2YWx1ZXMgaW4gYWxsIGZpZWxkcwogcmVjb3JkLmVhY2hGaWVsZCAoIC8uLywgZnVuY3Rpb24gKCBmaWVsZCApIHsKICAgIGZpZWxkLmVhY2hTdWJGaWVsZCAoIC8uLywgZnVuY3Rpb24gKCBmaWVsZCwgc3ViZmllbGQgKSB7CiAgICAgICAgcHJpbnQgKCBzdWJmaWVsZC52YWx1ZSArICJcbiIgKTsKICAgIH0gKTsgLy9lbmQgZWFjaFN1YkZpZWxkCiAgfSk7IC8vZW5kIGVhY2hGaWVsZAoKICoKICogQG1ldGhvZAogKiBAbmFtZSBSZWNvcmQuZWFjaEZpZWxkCiAqIEBuYW1lIFJlY29yZCNlYWNoRmllbGQgKi8KUmVjb3JkLmVhY2hGaWVsZCA9IG5ldyBTdHJpbmcoKTsKCi8qKiBJdGVyYXRlcyBvdmVyIHRoZSBmaWVsZHMgYW5kIGxvb2t1cCBoYW5kbGVycyBpbiBhIG1hcC4KICoKICogVGhpcyBtZXRob2QgaXMgdXNlZnVsIHdoZW4geW91IHdhbnQgdG8gaGFuZGxlIG11bHRpcGxlIGZpZWxkcyBpbiBhIHJlY29yZCB3aXRoIGRpZmZlcmVudCBmdW5jdGlvbnMKICoKICogSXQgaXMgbW9yZSBlZmZpY2llbnQgdGhhbiBtYWtpbmcgbXVsdGlwbGUgZWFjaEZpZWxkIGNhbGxzLCBzaW5jZSBpdCBvbmx5IGxvb3BzIHRocm91Z2ggZmllbGRzIG9uY2UgYW5kCiAqIHVzZXMgbWFwIHN0cmluZyBsb29rdXAgaW5zdGVhZCBvZiByZWd1bGFyIGV4cHJlc3Npb25zLgogKiBCdXQgaXQgY2FuIG9ubHkgbWF0Y2ggb24gZXhhY3QgZmllbGQgbmFtZXMsIGJlY2F1c2Ugb2YgdGhlIG1hcCBsb29rdXAuCiAqCiAqIEBwYXJhbSB7TWF0Y2hNYXB9IG1hcCBBbiBvYmplY3QgY29udGFpbmluZyBtYXBwaW5nIGJldHdlZW4gZmllbGRuYW1lIHN0cmluZ3MgYW5kIGZ1bmN0aW9ucyB0byBjYWxsCiAqIEBwYXJhbSB7T2JqZWN0fFVuZGVmaW5lZH0gZXh0cmFEYXRhIGdpdmVuIHRvIGFsbCBmdW5jdGlvbnMgY2FsbGVkIGFzIHNlY29uZCBwYXJhbWV0ZXIKICoKICogQGV4YW1wbGUKIHZhciBtYXAgPSBuZXcgTWF0Y2hNYXAoKTsKIG1hcC5wdXQoICI3MDAiLCBmdW5jdGlvbiggZmllbGQgKSB7CiAgICAvLyBoYW5kbGUgZmllbGQgNzAwCn0pOwogbWFwLnB1dCggIjc5NSIsIGZ1bmN0aW9uKCBmaWVsZCApIHsKICAgIC8vIGhhbmRsZSBmaWVsZCA3OTUKfSk7CiBtYXAucHV0KCAiMTAwIiwgIjEwMSIsIGZ1bmN0aW9uKCBmaWVsZCApIHsKICAgIC8vIGhhbmRsZSBmaWVsZCAxMDAgYW5kIDEwMQp9KTsKIHJlY29yZC5lYWNoRmllbGRNYXAobWFwKTsKIC8vIEFsdGVybmF0ZQogdmFyIG1hcDIgPSBuZXcgTWF0Y2hNYXAoKTsKIG1hcDIucHV0KCAiNzAwIiwgZnVuY3Rpb24oIGZpZWxkLCBjb2xsZWN0b3IgKSB7CiAgICBjb2xsZWN0b3IucHVzaCggZmllbGQudmFsdWUgKTsKfSk7CiB2YXIgdmFsdWVzID0gW10KIHJlY29yZC5lYWNoRmllbGRNYXAobWFwMiwgdmFsdWVzKTsKICoKICogQG1ldGhvZAogKiBAbmFtZSBSZWNvcmQuZWFjaEZpZWxkTWFwCiAqIEBuYW1lIFJlY29yZCNlYWNoRmllbGRNYXAgKi8KUmVjb3JkLmVhY2hGaWVsZE1hcCA9IG5ldyBTdHJpbmcoKTsKCgovKiogSXRlcmF0ZXMgb3ZlciB0aGUgZmllbGRzIGFuZCBsb29rdXAgaGFuZGxlcnMgaW4gYSBtYXAuCiAqCiAqIFRoaXMgbWV0aG9kIGlzIHVzZWZ1bCB3aGVuIHlvdSB3YW50IHRvIGhhbmRsZSBtdWx0aXBsZSBmaWVsZHMgaW4gYSByZWNvcmQgd2l0aCBkaWZmZXJlbnQgZnVuY3Rpb25zIGFuZCBub25zcGVjaWZpZWQKICogZmllbGRzIHdpdGggYSBkZWZhdWx0IGZ1bmN0aW9uLiBTbyBhbGwgZmllbGRzIHRoYXQgYXJlIGFkZGVkIHRvIHRoZSBtYXAgdXNlIGEgc3BlY2lmaWMgZnVuY3Rpb24gYW5kIHRoZSByZW1haW5pbmcgZmllbGRzCiAqIGFyZSBjYWxsZWQgd2l0aCB0aGUgZGVmYXVsdCBmdW5jdGlvbi4KICoKICogSXQgaXMgbW9yZSBlZmZpY2llbnQgdGhhbiBtYWtpbmcgbXVsdGlwbGUgZWFjaEZpZWxkIGNhbGxzLCBzaW5jZSBpdCBvbmx5IGxvb3BzIHRocm91Z2ggZmllbGRzIG9uY2UgYW5kCiAqIHVzZXMgbWFwIHN0cmluZyBsb29rdXAgaW4gc3RlYWQgb2YgcmVndWxhciBleHByZXNzaW9ucy4KICogQnV0IGl0IGNhbiBvbmx5IG1hdGNoIG9uIGV4YWN0IGZpZWxkIG5hbWVzLCBiZWNhdXNlIG9mIHRoZSBtYXAgbG9va3VwCiAqCiAqIEBwYXJhbSB7TWF0Y2hNYXB9IG1hcCBBbiBvYmplY3QgY29udGFpbmluZyBtYXBwaW5nIGJldHdlZW4gZmllbGQgbmFtZSBzdHJpbmdzIGFuZCBmdW5jdGlvbnMgdG8gY2FsbAogKiBAcGFyYW0ge2RlZmF1bHRGdW5jdGlvbn0gZGVmYXVsdEZ1bmN0aW9uIHRvIGNhbGwgZm9yIGZpZWxkcyBub3QgaSBNYXRjaE1hcAogKiBAcGFyYW0ge2V4dHJhRGF0YX0gT2JqZWN0IGdpdmVuIHRvIGFsbCBmdW5jdGlvbnMgY2FsbGVkIGFzIHNlY29uZCBwYXJhbWV0ZXIKICoKICoKICogQGV4YW1wbGUKIHZhciBtYXAgPSBuZXcgTWF0Y2hNYXAoKTsKCiBtYXAucHV0KCAiMDAxIiwgZnVuY3Rpb24oIGYsIHJlc3VsdERhdGEgKSB7IHJlc3VsdERhdGEucHVzaCggIjAwMSBjYWxsZWQgIitmLm5hbWUgKTsgfSApOwogbWFwLnB1dCggIjAwMiIsIGZ1bmN0aW9uKCBmLCByZXN1bHREYXRhICkgeyByZXN1bHREYXRhLnB1c2goICIwMDIgY2FsbGVkICIrZi5uYW1lICk7IH0gKTsKCiB2YXIgZGVmYXVsdEZ1bmN0aW9uID0gZnVuY3Rpb24gKCBmLCByZXN1bHREYXRhICkgeyByZXN1bHREYXRhLnB1c2goICJkZWZhdWx0IGNhbGxlZCAiICsgZi5uYW1lICk7IH07CgogdmFyIHJlc3VsdERhdGE9W107CgogcmVjb3JkLmVhY2hGaWVsZE1hcFdpdGhEZWZhdWx0KCBtYXAsIGRlZmF1bHRGdW5jdGlvbiwgcmVzdWx0RGF0YSApOwoKIC8vIGlmIHJlY29yZCBpcwogLy8gMDAxIDAwICphCiAvLyAwMDIgMDAgKmEKIC8vIDI0NSAwMCAqYQogLy8gMzAwIDAwICphCiAvL3Jlc3VsdCBkYXRhIGlzIG5vdyBbICIwMDEgY2FsbGVkIDAwMSIsICIwMDIgY2FsbGVkIDAwMiIsICJkZWZhdWx0IGNhbGxlZCAyNDUiLCAiZGVmYXVsdCBjYWxsZWQgMzAwIiBdCgogKgogKiBAbWV0aG9kCiAqIEBuYW1lIFJlY29yZC5lYWNoRmllbGRNYXBXaXRoRGVmYXVsdAogKiBAbmFtZSBSZWNvcmQjZWFjaEZpZWxkTWFwV2l0aERlZmF1bHQgKi8KUmVjb3JkLmVhY2hGaWVsZE1hcFdpdGhEZWZhdWx0ID0gbmV3IFN0cmluZygpOwoKLyoqIEl0ZXJhdGVzIG92ZXIgdGhlIGZpZWxkcyBhbmQgY2FsbHMgYSBoYW5kbGVyIG9uIGVhY2ggZmllbGQgYXMgYSBzZXF1ZW5jZS4KICoKICogQSBzZXF1ZW5jZSBpcyBhbiBhcnJheSBvZiBtYXRjaGVycyB0aGF0IGlzIHVzZWQgdG8gZXh0cmFjdCBmaWVsZHMuIFRoZSBoYW5kbGVyIGlzIHRoZW4KICogdXNlZCBvbiB0aGUgZmlyc3QgZmllbGQgZnJvbSBlYWNoIG1hdGNoZXIsIHRoZW4gb24gdGhlIHNlY29uZCBmaWVsZCBmcm9tIGVhY2ggbWF0Y2hlciwKICogYW5kIHNvIG9uLgogKgogKiBJZiB0aGUgbWF0Y2hlcnMgbWF0Y2hlcyBvbiBkaWZmZXJlbnQgbnVtYmVyIG9mIGZpZWxkcywgdGhlbiBvbmx5IHRoZSBzbWFsbGVzdCBudW1iZXIgb2YgbWF0Y2hlZAogKiBmaWVsZHMgaXMgdXNlZCwgdGhlbiB3ZSBpbnZva2UgdGhlIGhhbmRsZXIgb24gdGhlIHN1YiBmaWVsZC4KICoKICogVGhpcyBmdW5jdGlvbiBoYXMgMiBmb3JtczoKICoKICogSWYgZ2l2ZW4gYSBtYXRjaGVyIGFuZCBhIGhhbmRsZXIsIHRoZW4gdGhlIGhhbmRsZXIgaXMgY2FsbGVkIGZvciBlYWNoIGZpZWxkLgogKgogKiBJZiBnaXZlbiBhIG1hdGNoZXIsIGFuIGFycmF5IG9mIHNvcnRlciBvYmplY3RzIGFuZCBhIGhhbmRsZXIsIHRoZW4gdGhlIG1hdGNoZWQKICogZmllbGRzIGFyZSBzb3J0ZWQgYmVmb3JlIHRoZSBoYW5kbGVyIGlzIGNhbGxlZCBmb3IgZWFjaCBmaWVsZC4KICoKICogQHBhcmFtIHtBcnJheX0gbWF0Y2hlcnMgQW4gQXJyYXkgb2YgUmVnRXhwIHRoYXQgbWF0Y2hlcyB0aGUgZmllbGQgbmFtZQogKiAgICAgICAgICBvciBhbiBvYmplY3Qgd2l0aCBhIGZ1bmN0aW9uIG9mIHRoZSBub3JtOiBmdW5jdGlvbiBtYXRjaEZpZWxkKCByZWNvcmQsIGZpZWxkICkuCiAqICAgICAgICBUaGUgZnVuY3Rpb24gc2hvdWxkIHJldHVybiBhIGJvb2xlYW4gdmFsdWUuCiAqIEBwYXJhbSB7QXJyYXl9IHNvcnRlciBBbiBhcnJheSBvZiBvYmplY3RzIHRoYXQgaGFzIGEgZnVuY3Rpb246IHNvcnQoIGEsIGIgKS4gYSBhbmQKICogICAgICAgICAgYiBhcmUgZmllbGRzIGFuZCB0aGUgZnVuY3Rpb24gc2hvdWxkIHJldHVybiAtMSAoYSA8IGIpLCAwICggYSA9PSBiKSBvciAxIChhID4gYikuCiAqICAgICAgICAgIElmIHRoZSBmdW5jdGlvbiByZXR1cm5zIC0xIG9yIDEsIHRoZW4gdGhlIHR3byBmaWVsZHMgYXJlIHNvcnRlZCBhbmQgYW55IGZ1cnRoZXIKICogICAgICAgICAgZWxlbWVudHMgaW4gdGhlIGFycmF5IGFyZSBpZ25vcmVkIGZvciB0aGVzZSB0d28gZmllbGRzLgogKiBAcGFyYW0ge0hhbmRsZXJ8RnVuY3Rpb259IGhhbmRsZXIgVGhlIGhhbmRsZXIgdG8gY2FsbCBmb3IgZWFjaCBzdWIgZmllbGQgZm91bmQKICogICAgICAgICAgYnkgbWF0Y2hlci4KICoKICogQHJldHVybiBJZiBoYW5kbGVyIHJldHVybnMgYSB2YWx1ZSB0aGVuIGFsbCB0aGUgdmFsdWVzIGFyZSBhZGRlZCB0b2dldGhlciBpbnRvIGEKICogICAgICAgICAgIHNpbmdsZSB2YWx1ZS4KICoKICogQGV4YW1wbGUKIC8vIFByaW50IGZpZWxkcyAiNzcwIiBhbmQgIjc5NSIgYXMgcGFpcnMuCiByZWNvcmQuZWFjaEZpZWxkU2VxdWVuY2UoIFsgLzc3MC8sIC83OTUvIF0sIGZ1bmN0aW9uKCBmaWVsZCApIHsKICAgIHByaW50KCBmaWVsZC50b1N0cmluZygpICsgIlxuIiApOwp9ICk7CgogLy8gU2VxdWVuY2Ugd2l0aCBhIGN1c3RvbSBtYXRjaGVyLgogcmVjb3JkLmVhY2hGaWVsZFNlcXVlbmNlKCBbIHsgbWF0Y2hGaWVsZDogZnVuY3Rpb24oIHJlY29yZCwgZmllbGQgKSB7IHJldHVybiBmaWVsZC5uYW1lID09PSAiNjUyIiAmJiBmaWVsZC5leGlzdHMoIC8wLyApIH0KCQkJCQkJICAgIH0sIC83NzAvLCAvNzk1LyBdLCBmdW5jdGlvbiggZmllbGQgKSB7IHByaW50KCBmaWVsZC50b1N0cmluZygpICsgIlxuIiApOyB9ICk7CgogKiBAbWV0aG9kCiAqIEBuYW1lIFJlY29yZC5lYWNoRmllbGRTZXF1ZW5jZQogKiBAbmFtZSBSZWNvcmQjZWFjaEZpZWxkU2VxdWVuY2UgKi8KUmVjb3JkLmVhY2hGaWVsZFNlcXVlbmNlID0gbmV3IFN0cmluZygpOwoKLyoqIENoZWNrcyBpZiB0aGUgcmVjb3JkIGlzIGVtcHR5LCB0aGF0IGl0IGhhcyB6ZXJvIGZpZWxkcy4KICoKICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgcmVjb3JkIGlzIGVtcHR5LCBmYWxzZSBvdGhlcndpc2UuCiAqCiAqIEBleGFtcGxlCiAvLyBlbXB0eSgpIGlzIG1hbnkgdGltZXMgdXNlZCBhcyBhbiBlYXJseSBjaGVjayBpbiB0aGUgYmVnaW5uaW5nIG9mIGEgZnVuY3Rpb24KIGZ1bmN0aW9uIGYoIHJlY29yZCApIHsKCWlmKCByZWNvcmQuZW1wdHkoKSApIHsKIAkJcmV0dXJuOwogCX0KIAkKIAkvLyBOb3JtYWwgbG9naWMuLi4gCQp9CiAqIEBtZXRob2QKICogQG5hbWUgUmVjb3JkLmVtcHR5CiAqIEBuYW1lIFJlY29yZCNlbXB0eSAqLwpSZWNvcmQuZW1wdHkgPSBuZXcgU3RyaW5nKCk7CgovKiogQ2hlY2tzIGlmIHRoaXMgcmVjb3JkIGNvbnRhaW5zIGF0IGxlYXN0IG9uZSBmaWVsZCwgdGhhdCBtYXRjaGVzIGEgY3JpdGVyaWEuCiAqCiAqIEBwYXJhbSB7UmVnRXhwfFN0cmluZ3xPYmplY3R9IG1hdGNoZXIgQW4gUmVnRXhwIG9yIHN0cmluZyB0aGF0IG1hdGNoZXMgdGhlIGZpZWxkIG5hbWUKICogICAgICAgICAgb3IgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbiBvZiB0aGUgbm9ybTogZnVuY3Rpb24gbWF0Y2hGaWVsZCggcmVjb3JkLCBmaWVsZCApLgogKiAgICAgICAgVGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBib29sZWFuIHZhbHVlLgogKgogKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIGEgZmllbGQgbWF0Y2hlcyB0aGUgbWF0Y2hlciBhcmd1bWVudCwgRmFsc2Ugb3RoZXJ3aXNlLgogKgogKiBAZXhhbXBsZQogZnVuY3Rpb24gaGFzVGl0bGUoIHJlY29yZCApIHsKCXJldHVybiByZWNvcmQuZXhpc3RGaWVsZCggLzI0NS8gKTsKfQogLy9UaGUgZnVuY3Rpb24gaGFzVGl0bGUgY2hlY2tzIGlmIHRoZSBwYXNzZWQgcmVjb3JkIGNvbnRhaW5zIGEgZmllbGQgd2l0aCBuYW1lICIyNDUiLgoKCiB2YXIgZXhhbXBsZVJlY29yZF9PbmUgPSBuZXcgUmVjb3JkKCk7CiB2YXIgZXhhbXBsZUZpZWxkID0gbmV3IEZpZWxkICggIjI0NSIsICIwMCIgKTsKIGV4YW1wbGVSZWNvcmRfT25lLmFwcGVuZCAoIGV4YW1wbGVGaWVsZCApOwoKIGhhc1RpdGxlICggZXhhbXBsZVJlY29yZF9PbmUgKTsgLy8gPC0tIHRoaXMgY2FsbCByZXR1cm5zIFRydWUKCiB2YXIgZXhhbXBsZVJlY29yZF9Ud28gPSBuZXcgUmVjb3JkKCk7CiB2YXIgZXhhbXBsZUZpZWxkID0gbmV3IEZpZWxkICggIjI2MCIsICIwMCIgKTsKIGV4YW1wbGVSZWNvcmRfVHdvLmFwcGVuZCAoIGV4YW1wbGVGaWVsZCApOwoKIGhhc1RpdGxlICggZXhhbXBsZVJlY29yZF9Ud28gKTsgLy8gPC0tIHRoaXMgY2FsbCByZXR1cm5zIEZhbHNlCgogKgogKgogKgogKiBAbWV0aG9kCiAqIEBuYW1lIFJlY29yZC5leGlzdEZpZWxkCiAqIEBuYW1lIFJlY29yZCNleGlzdEZpZWxkICovClJlY29yZC5leGlzdEZpZWxkID0gbmV3IFN0cmluZygpOwoKLyoqIEdldCBhIHJlZmVyZW5jZSB0byBhIGZpZWxkIGluIHRoZSByZWNvcmQuCiAqCiAqIEdpdmVuIHRoZSBpbmRleCBvZiBhIGZpZWxkLCBvciBhIGZpZWxkTmFtZSwgb3IgYSBmaWVsZE5hbWUgYW5kIGFuCiAqIGluZGV4LCByZXR1cm4gYSByZWZlcmVuY2UgdG8gYSBmaWVsZC4KICoKICogVGhpcyBpcyB0aGUgcHJpbWFyeSBtZXRob2QgdG8gZ2V0IGFjY2VzcyB0byB0aGUgZmllbGRzIG9mIGEKICogcmVjb3JkLiBUaGUgbWV0aG9kIGV4aXN0cyBpbiB0aHJlZSB2ZXJzaW9ucywgZGVwZW5kaW5nIG9uIHRoZQogKiBudW1iZXIgYW5kIHR5cGUgb2YgYXJndW1lbnRzIGdpdmVuLgogKgogKiBJZiBnaXZlbiBhIG51bWVyaWNhbCBpbmRleCBvbmx5LCBpdCByZXR1cm5zIHRoZSBmaWVsZCBhdCB0aGF0IHBvc2l0aW9uCiAqIGluIHRoZSByZWNvcmRzIGludGVybmFsIHJlcHJlc2VudGF0aW9uIG9mIGZpZWxkcy4gVGhpcyBpcyBwcm9iYWJseQogKiBvbmx5IHVzZWZ1bCBpbiBjb25qdW5jdGlvbiB3aXRoIGUuZy4gbG9vcGluZyB0aHJvdWdoIGFsbCBmaWVsZHMgaW4KICogdGhlIHJlY29yZC4KICoKICogSWYgZ2l2ZW4gYSBuYW1lLCBpdCByZXR1cm5zIHRoZSBmaXJzdCBmaWVsZCBmb3VuZCwgdGhhdCBtYXRjaGVzIHRoZQogKiBnaXZlbiBuYW1lLgogKgogKiBJZiBnaXZlbiBhIG5hbWUgYW5kIGFuIGluZGV4IG4sIGl0IHJldHVybnMgdGhlIG4ndGggZmllbGQgd2l0aAogKiB0aGUgZ2l2ZW4gbmFtZS4KICoKICogTm90ZSwgdGhhdCBpZiB0aGUgZmllbGQgaXMgbm90IGZvdW5kLCBhbiBlbXB0eSBmaWVsZCBpcwogKiByZXR1cm5lZC4gVGhpcyBmaWVsZCBpcyBub3QgcGFydCBvZiB0aGUgcmVjb3JkLgogKgogKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IGZpZWxkSW5kZXhPckZpZWxkTmFtZSBJbmRleCBvZiBmaWVsZCB0byBmaW5kLCB6ZXJvLWJhc2VkLCBvciBuYW1lIG9mIGEgZmllbGQgdG8gZmluZC4KICogQHBhcmFtIHtudW1iZXJ9IFtmaWVsZE5hbWVJbmRleF0gSW5kZXggb2YgbmFtZWQgZmllbGQgdG8gZmluZCwgemVyby1iYXNlZC4gKk9ubHkgYWxsb3dlZCBpZiBmaXJzdCBhcmd1bWVudCBpcyBhIGZpZWxkTmFtZS4qCiAqIEByZXR1cm4ge0ZpZWxkfSBBIHJlZmVyZW5jZSB0byBhIGZpZWxkLCBvciBhbiBlbXB0eSBmaWVsZCwgaWYgbm90IGZvdW5kLgogKiBAZXhhbXBsZQogLy9leGFtcGxlIHJlY29yZAogdmFyIHJlY29yZCA9IG5ldyBSZWNvcmQoKTsKIGZpZWxkID0gbmV3IEZpZWxkICggIjAyMSIsICIwMCIgKTsKIGZpZWxkLmFwcGVuZCAoICJlIiwgIjk3ODA2MTgyNjAzMDAiICk7CiByZWNvcmQuYXBwZW5kKCBmaWVsZCApOwogZmllbGQgPSBuZXcgRmllbGQgKCAiMDIxIiwgIjAwIiApOwogZmllbGQuYXBwZW5kICggImEiLCAiMDYxODE2MjIxNiIgKTsKIHJlY29yZC5hcHBlbmQoIGZpZWxkICk7CiBmaWVsZCA9IG5ldyBGaWVsZCAoICIxMDAiLCAiMDAiICk7CiBmaWVsZC5hcHBlbmQgKCAiYSIsICJUb2xraWVuIiApOwogZmllbGQuYXBwZW5kICggImgiLCAiSi5SLlIuIiApOwogcmVjb3JkLmFwcGVuZCggZmllbGQgKTsKIGZpZWxkID0gbmV3IEZpZWxkICggIjI0NSIsICIwMCIgKTsKIGZpZWxkLmFwcGVuZCAoICJhIiwgIlRoZSBob2JiaXQsIG9yLCBUaGVyZSBhbmQgYmFjayBhZ2FpbiIgKTsKIHJlY29yZC5hcHBlbmQoIGZpZWxkICk7CgoKIC8vIEdldCB0aGUgdGhpcmQgZmllbGQgaW4gdGhlIHJlY29yZAogdmFyIGYxID0gcmVjb3JkLmZpZWxkKCAyICk7IC8vPC0tIHRoaXMgcmVmZXJzIHRvIGZpZWxkIDEwMAoKIC8vIEJlIGF3YXJlIGlmIHlvdSB1c2Ugb25seSB0aGUgbmFtZSBvZiB0aGUgZmllbGQgYW5kIHRoZXJlIGlzIG1vcmUgdGhhbiBvbmUgb2YgdGhhdCBmaWVsZAogLy8geW91IHdpbGwgZ2V0IGEgcmVmZXJlbmNlIHRvIHRoZSBmaXJzdCBmaWVsZAogdmFyIGYyID0gcmVjb3JkLmZpZWxkKCAiMDIxIiApOyAgLy8gPC0tIHRoaXMgcmVmZXJzIHRvIGZpZWxkIDAyMSBjb250YWluaW5nIHN1YmZpZWxkICJlIiB2YWx1ZSA9IDk3ODA2MTgyNjAzMDAKCiAvLyBHZXQgdGhlIHNlY29uZCAwMjEgZmllbGQKIHZhciBmMyA9IHJlY29yZC5maWVsZCggIjAyMSIsIDEgKTsgLy8gPC0tIHRoaXMgcmVmZXJzIHRvIGZpZWxkIDAyMSBjb250YWluaW5nIHN1YmZpZWxkICJhIiB2YWx1ZSA9IDA2MTgxNjIyMTYKCiAvL0JlIGF3YXJlIGlmIHlvdSByZWZlciB0byBhIGZpZWxkIHdpdGggbmFtZSBhbmQgaW5kZXggdGhhdCBpcyBub3QgdGhlcmUgeW91IGdldCBhbiBlbXB0eSBmaWVsZAogdmFyIGY0ID0gcmVjb3JkLmZpZWxkKCAiMDIxIiwgMiApOyAvLyA8LS0gdGhpcyByZWZlcnMgdG8gYW4gZW1wdHkgZmllbGQsIGJlY2F1c2UgdGhlcmUgYXJlIG9ubHkgdHdvIGZpZWxkIDAyMSBpbiB0aGlzIHJlY29yZAoKICogQG1ldGhvZAogKiBAbmFtZSBSZWNvcmQuZmllbGQKICogQG5hbWUgUmVjb3JkI2ZpZWxkICovClJlY29yZC5maWVsZCA9IG5ldyBTdHJpbmcoKTsKCi8qKiBJdGVyYXRlcyBvdmVyIHRoZSBmaWVsZHMgYW5kIGNhbGxzIGEgaGFuZGxlciBvbiBlYWNoIGZpZWxkLiBSZXR1cm5zIHRoZSB2YWx1ZSBvZgogKiB0aGUgZmlyc3QgdmFsdWUgdGhlIGhhbmRsZXIgcmV0dXJucywgdGhhdCBpcyBub3QgdW5kZWZpbmVkLgogKgogKiBUaGlzIGZ1bmN0aW9uIGhhcyAyIGZvcm1zOgogKgogKiBJZiBnaXZlbiBhIG1hdGNoZXIgYW5kIGEgaGFuZGxlciwgdGhlbiB0aGUgaGFuZGxlciBpcyBjYWxsZWQgZm9yIGVhY2ggZmllbGQuCiAqCiAqIElmIGdpdmVuIGEgbWF0Y2hlciwgYW4gYXJyYXkgb2Ygc29ydGVyIG9iamVjdHMgYW5kIGEgaGFuZGxlciwgdGhlbiB0aGUgbWF0Y2hlZAogKiBmaWVsZHMgYXJlIHNvcnRlZCBiZWZvcmUgdGhlIGhhbmRsZXIgaXMgY2FsbGVkIGZvciBlYWNoIGZpZWxkLgogKgogKiBAcGFyYW0ge1JlZ0V4cHxTdHJpbmd8T2JqZWN0fSBtYXRjaGVyIEEgUmVnRXhwIG9yIHN0cmluZyB0aGF0IG1hdGNoZXMgdGhlIGZpZWxkIG5hbWUKICogICAgICAgICAgb3IgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbiBvZiB0aGUgbm9ybTogZnVuY3Rpb24gbWF0Y2hGaWVsZCggcmVjb3JkLCBmaWVsZCApLgogKiAgICAgICAgVGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBib29sZWFuIHZhbHVlLgogKiBAcGFyYW0ge0FycmF5fSBzb3J0ZXIgQW4gYXJyYXkgb2Ygb2JqZWN0cyB0aGF0IGhhcyBhIGZ1bmN0aW9uOiBzb3J0KCBhLCBiICkuIGEgYW5kCiAqICAgICAgICAgIGIgYXJlIGZpZWxkcyBhbmQgdGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gLTEgKGEgPCBiKSwgMCAoIGEgPT0gYikgb3IgMSAoYSA+IGIpLgogKiAgICAgICAgICBJZiB0aGUgZnVuY3Rpb24gcmV0dXJucyAtMSBvciAxLCB0aGVuIHRoZSB0d28gZmllbGRzIGFyZSBzb3J0ZWQgYW5kIGFueSBmdXJ0aGVyCiAqICAgICAgICAgIGVsZW1lbnRzIGluIHRoZSBhcnJheSBhcmUgaWdub3JlZCBmb3IgdGhlc2UgdHdvIGZpZWxkcy4KICogQHBhcmFtIHtIYW5kbGVyfEZ1bmN0aW9ufSBoYW5kbGVyIFRoZSBoYW5kbGVyIHRvIGNhbGwgZm9yIGVhY2ggc3ViZmllbGQgZm91bmQKICogICAgICAgICAgYnkgbWF0Y2hlci4KICoKICogQHJldHVybiBSZXR1cm5zIHRoZSBmaXJzdCB2YWx1ZSB0aGUgaGFuZGxlciByZXR1cm5zLgogKgogKiBAZXhhbXBsZQogLy8gR2V0IHRoZSBmaXJzdCBwZXJzb24gbmFtZSBmcm9tIDc5NQogdmFyIHBlcnNvbk5hbWUgPSByZWNvcmQuZmlyc3RGaWVsZCggLzc5NS8sIGZ1bmN0aW9uKCBmaWVsZCApIHsgZmllbGQuZ2V0VmFsdWUoIC9hLyApIH0gKTsKCiAvLyBBbmQgd2l0aCBhIGN1c3RvbSBtYXRjaGVyCiB2YXIgcGVyc29uTmFtZSA9IHJlY29yZC5maXJzdEZpZWxkKCB7IG1hdGNoRmllbGQ6IGZ1bmN0aW9uKCByZWNvcmQsIGZpZWxkICkgeyByZXR1cm4gZmllbGQubmFtZSA9PT0gIjc5NSIgfSB9LCBmdW5jdGlvbiggZmllbGQgKSB7IGZpZWxkLmdldFZhbHVlKCAvYS8gKSB9ICk7CgogLy8gR2V0cyB0aGUgZmlyc3QgbmFtZSBvZiAiNzk1IiBhZnRlciB0aGUgZmllbGRzIGhhdmUgYmVlbiBzb3J0ZWQgYnkgc3ViIGZpZWxkICLDpSIKIHZhciBwZXJzb25OYW1lID0gcmVjb3JkLmZpcnN0RmllbGQoIC83OTUvLCBbIG5ldyBTb3J0QnlTdWJGaWVsZHMoIC/DpS8sIFNvcnRlci5BU0MgKSBdLCBmdW5jdGlvbiggZmllbGQgKSB7IGZpZWxkLmdldFZhbHVlKCAvYS8gKSB9ICk7CiAqCiAqIEBtZXRob2QKICogQG5hbWUgUmVjb3JkLmZpcnN0RmllbGQKICogQG5hbWUgUmVjb3JkI2ZpcnN0RmllbGQgKi8KUmVjb3JkLmZpcnN0RmllbGQgPSBuZXcgU3RyaW5nKCk7CgovKiogUmV0dXJucyB0aGUgZmlyc3QgZmllbGQgdGhhdCBtYXRjaGVzIGEgZ2l2ZW4gbWF0Y2hlci4KICoKICogQHBhcmFtIHtSZWdFeHB9IHJlZ0V4RmllbGRNYXRjaGVyIFJlZ3VsYXIgZXhwcmVzc2lvbiB0aGF0IG1hdGNoZXMgdGhlIGZpZWxkIG5hbWUKICogICAgICAgICAgICAgICAgICAgb2YgdGhlIGZpZWxkIHlvdSB3YW50IHRvIHJldHVybi4KICoKICogQHJldHVybiB7RmllbGR9IFRoZSBmaXJzdCBmaWVsZCB3aG9zZSBuYW1lIG1hdGNoZXMgdGhlIG1hdGNoZXIgaW4gcmVnRXhGaWVsZE1hdGNoZXIuCiAqCiAqIEBleGFtcGxlCiAvLyBUaGlzIGZ1bmN0aW9uIHJldHVybnMgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgZmllbGQgMjQ1LgogZnVuY3Rpb24gZ2V0VGl0bGUoKSB7CglyZXR1cm4gcmVjb3JkLmdldEZpcnN0RmllbGRBc0ZpZWxkKCAvMjQ1LyApOwp9CiAqIEBtZXRob2QKICogQG5hbWUgUmVjb3JkLmdldEZpcnN0RmllbGRBc0ZpZWxkCiAqIEBuYW1lIFJlY29yZCNnZXRGaXJzdEZpZWxkQXNGaWVsZCAqLwpSZWNvcmQuZ2V0Rmlyc3RGaWVsZEFzRmllbGQgPSBuZXcgU3RyaW5nKCk7CgovKiogUmV0dXJucyB0aGUgZmlyc3Qgc3ViZmllbGQgdmFsdWUgaW4gdGhlIHJlY29yZC4KICoKICogQHBhcmFtIHtSZWdFeHB8U3RyaW5nfE9iamVjdH0gZmllbGRNYXRjaGVyIEEgUmVnRXhwIG9yIHN0cmluZyB0aGF0IG1hdGNoZXMgdGhlIGZpZWxkIG5hbWUKICogICAgICAgICAgb3IgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbiBvZiB0aGUgbm9ybTogZnVuY3Rpb24gbWF0Y2hGaWVsZCggcmVjb3JkLCBmaWVsZCApLgogKiAgICAgICAgVGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBib29sZWFuIHZhbHVlLgogKiBAcGFyYW0ge1JlZ0V4cHxTdHJpbmd8T2JqZWN0fSBzdWJGaWVsZE1hdGNoZXIgQSBSZWdFeHAgb3IgU3RyaW5nIHRoYXQgbWF0Y2hlcyB0aGUgc3ViZmllbGQgbmFtZQogKiAgICAgICAgICBvciBhbiBvYmplY3Qgd2l0aCBhIGZ1bmN0aW9uIG9mIHRoZSBub3JtOiBmdW5jdGlvbiBtYXRjaFN1YkZpZWxkKCBmaWVsZCwgc3ViZmllbGQgKS4KICogICAgICAgIFRoZSBmdW5jdGlvbiBzaG91bGQgcmV0dXJuIGEgYm9vbGVhbiB2YWx1ZS4KICoKICogQHJldHVybiB7U3RyaW5nfSBUaGUgZmlyc3QgdmFsdWUgZm91bmQgaW4gdGhlIHJlY29yZCBvciB0aGUgZW1wdHkgc3RyaW5nLgogKgogKiBAZXhhbXBsZQogZnVuY3Rpb24gZmlyc3RTdWJqZWN0KCByZWNvcmQgKSB7CglyZXR1cm4gcmVjb3JkLmdldEZpcnN0VmFsdWUoIC82NjYvLCAvZi8gKTsKfQogKgogKiBAbWV0aG9kCiAqIEBuYW1lIFJlY29yZC5nZXRGaXJzdFZhbHVlCiAqIEBuYW1lIFJlY29yZCNnZXRGaXJzdFZhbHVlICovClJlY29yZC5nZXRGaXJzdFZhbHVlID0gbmV3IFN0cmluZygpOwoKLyoqIEl0ZXJhdGVzIG92ZXIgdGhlIGZpZWxkcyBhbmQgcmV0dXJucyB0aGUgdmFsdWVzIG9mIGFueSBzdWJmaWVsZCB0aGF0IG1hdGNoZXMgYSBjcml0ZXJpYS4KICoKICogQHBhcmFtIHtSZWdFeHB8U3RyaW5nfE9iamVjdH0gZmllbGRNYXRjaGVyIEEgUmVnRXhwIG9yIFN0cmluZyB0aGF0IG1hdGNoZXMgdGhlIGZpZWxkIG5hbWUKICogICAgICAgICAgb3IgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbiBvZiB0aGUgbm9ybTogZnVuY3Rpb24gbWF0Y2hGaWVsZCggcmVjb3JkLCBmaWVsZCApLgogKiAgICAgICAgVGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBib29sZWFuIHZhbHVlLgogKiBAcGFyYW0ge1JlZ0V4cHxTdHJpbmd8T2JqZWN0fSBzdWJGaWVsZE1hdGNoZXIgQW4gUmVnRXhwIG9yIHN0cmluZyB0aGF0IG1hdGNoZXMgdGhlIHN1YmZpZWxkIG5hbWUKICogICAgICAgICAgb3IgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbiBvZiB0aGUgbm9ybTogZnVuY3Rpb24gbWF0Y2hTdWJGaWVsZCggZmllbGQsIHN1YmZpZWxkICkuCiAqICAgICAgICBUaGUgZnVuY3Rpb24gc2hvdWxkIHJldHVybiBhIGJvb2xlYW4gdmFsdWUuCiAqIEBwYXJhbSB7U3RyaW5nfSBzZXAgQSBzZXBhcmF0b3IgdG8gaW5zZXJ0IGJldHdlZW4gdGhlIHZhbHVlcywgaWYgbW9yZSB0aGFuIG9uZSBpcyBmb3VuZC4KICoKICogQHJldHVybiB7U3RyaW5nfSBUaGUgZm91bmQgdmFsdWVzIGFzIGEgc3RyaW5nLiBJZiBubyB2YWx1ZXMgYXJlIGZvdW5kLCB0aGUgZnVuY3Rpb24gd2lsbAogKiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoZSBlbXB0eSBzdHJpbmcuCiAqCiAqIEBleGFtcGxlCiAvLyBSZXR1cm5zIGFsbCB2YWx1ZXMgZnJvbSBmaWVsZCAiMjQ1YSIgd2l0aG91dCBhbnkgc2VwYXJhdG9yLgogZnVuY3Rpb24gZ2V0VGl0bGVzKCByZWNvcmQgKSB7CglyZXR1cm4gcmVjb3JkLmdldFZhbHVlKCAiMjQ1IiwgImEiICk7Cn0KCiAvLyBSZXR1cm5zIGFsbCB2YWx1ZXMgZnJvbSBmaWVsZCAiMjQ1YSIgd2l0aCBhIGNvbW1hIHNlcGFyYXRvci4KIGZ1bmN0aW9uIGdldFRpdGxlcyggcmVjb3JkICkgewoJcmV0dXJuIHJlY29yZC5nZXRWYWx1ZSggIjI0NSIsICJhIiwgIiwgIiApOwp9CiAqCiAqIEBtZXRob2QKICogQG5hbWUgUmVjb3JkLmdldFZhbHVlCiAqIEBuYW1lIFJlY29yZCNnZXRWYWx1ZSAqLwpSZWNvcmQuZ2V0VmFsdWUgPSBuZXcgU3RyaW5nKCk7CgovKiogQ2hlY2tzIGlmIGEgbWF0Y2hlciBvbmx5IG1hdGNoZXMgb25lIGZpZWxkLgogKgogKiBAcGFyYW0ge1JlZ0V4cHxPYmplY3R9IG1hdGNoZXIgQSBSZWdFeHAgdGhhdCBtYXRjaGVzIHRoZSBmaWVsZCBuYW1lCiAqICAgICAgICAgIG9yIGFuIG9iamVjdCB3aXRoIGEgZnVuY3Rpb24gb2YgdGhlIG5vcm06IGZ1bmN0aW9uIG1hdGNoRmllbGQoIHJlY29yZCwgZmllbGQgKS4KICogICAgICAgIFRoZSBmdW5jdGlvbiBzaG91bGQgcmV0dXJuIGEgYm9vbGVhbiB2YWx1ZS4KICoKICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiBvbmx5IG9uZSBmaWVsZCBtYXRjaGVzIG1hdGNoZXIsIEZhbHNlIG90aGVyd2lzZS4KICogQG1ldGhvZAogKiBAbmFtZSBSZWNvcmQuaXNVbmlxdWUKICogQG5hbWUgUmVjb3JkI2lzVW5pcXVlICovClJlY29yZC5pc1VuaXF1ZSA9IG5ldyBTdHJpbmcoKTsKCi8qKiBJdGVyYXRlcyBvdmVyIHRoZSBmaWVsZHMgYW5kIGNoZWNrcyBpZiBhbnkgb2YgdGhlIHN1YmZpZWxkcyBoYXMgYSBnaXZlbiB2YWx1ZS4KICoKICogQHBhcmFtIHtSZWdFeHB8U3RyaW5nfE9iamVjdH0gZmllbGRNYXRjaGVyIEEgUmVnRXhwIG9yIHN0cmluZyB0aGF0IG1hdGNoZXMgdGhlIGZpZWxkIG5hbWUKICogICAgICAgICAgb3IgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbiBvZiB0aGUgbm9ybTogZnVuY3Rpb24gbWF0Y2hGaWVsZCggcmVjb3JkLCBmaWVsZCApLgogKiAgICAgICAgVGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBib29sZWFuIHZhbHVlLgogKiBAcGFyYW0ge1JlZ0V4cHxTdHJpbmd8T2JqZWN0fSBzdWJGaWVsZE1hdGNoZXIgQSBSZWdFeHAgb3Igc3RyaW5nIHRoYXQgbWF0Y2hlcyB0aGUgc3ViZmllbGQgbmFtZQogKiAgICAgICAgICBvciBhbiBvYmplY3Qgd2l0aCBhIGZ1bmN0aW9uIG9mIHRoZSBub3JtOiBmdW5jdGlvbiBtYXRjaFN1YkZpZWxkKCBmaWVsZCwgc3ViZmllbGQgKS4KICogICAgICAgIFRoZSBmdW5jdGlvbiBzaG91bGQgcmV0dXJuIGEgYm9vbGVhbiB2YWx1ZS4KICogQHBhcmFtIHtSZWdFeHB9IHZhbHVlUmVnRXhwIFRoZSB2YWx1ZSB0aGF0IHlvdSB3YW50IHRvIG1hdGNoLgogKgogKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIGEgdmFsdWUgaXMgbWF0Y2hlZCwgRmFsc2Ugb3RoZXJ3aXNlLgogKgogKiBAZXhhbXBsZQogLy8gQ2hlY2tzIGlmIGEgcmVjb3JkIGlzIGEgYm9vawogZnVuY3Rpb24gaXNCb29rKCByZWNvcmQgKSB7CglyZXR1cm4gcmVjb3JkLm1hdGNoVmFsdWUoIC8wMDkvLCAvYS8sIC94eC8gKTsKfQogKgogKiBAbWV0aG9kCiAqIEBuYW1lIFJlY29yZC5tYXRjaFZhbHVlCiAqIEBuYW1lIFJlY29yZCNtYXRjaFZhbHVlICovClJlY29yZC5tYXRjaFZhbHVlID0gbmV3IFN0cmluZygpOwoKLyoqIFRoZSBudW1iZXIgb2YgZmllbGRzIGluIHRoZSByZWNvcmQuCiAqCiAqIFRoaXMgbWV0aG9kIHJldHVybnMgdGhlIG51bWJlciBvZiBmaWVsZHMgaW4gdGhlIHJlY29yZC4gSXQgaXMgbW9zdAogKiBvZnRlbiB1c2VkIHRvIGl0ZXJhdGUgdGhlIGZpZWxkcyBvZiBhIHJlY29yZC4KICoKICogQHJldHVybiB7bnVtYmVyfSBUaGUgbnVtYmVyIG9mIGZpZWxkcyBpbiB0aGUgcmVjb3JkLgogKiBAZXhhbXBsZSAvLyBJdGVyYXRlIGFsbCBmaWVsZHMgb2YgYSByZWNvcmQgYW5kIHByaW50IHRoZW0KIGZvciggdmFyIGkgPSAwOyBpIDwgcmVjb3JkLm51bWJlck9mRmllbGRzKCk7ICsraSApIHsKICBwcmludCggcmVjb3JkLmZpZWxkKCBpICkudG9TdHJpbmcoKSApOwp9CiAqIEBtZXRob2QKICogQG5hbWUgUmVjb3JkLm51bWJlck9mRmllbGRzCiAqIEBuYW1lIFJlY29yZCNudW1iZXJPZkZpZWxkcyAqLwpSZWNvcmQubnVtYmVyT2ZGaWVsZHMgPSBuZXcgU3RyaW5nKCk7CgovKiogUmVtb3ZlIGEgZmllbGQgZnJvbSBhIHJlY29yZC4KICoKICogR2l2ZW4gdGhlIGluZGV4IG9mIGEgZmllbGQsIG9yIGEgZmllbGROYW1lLCBvciBhIGZpZWxkTmFtZSBhbmQgYW4KICogaW5kZXgsIHJlbW92ZXMgdGhlIGZpZWxkIGZyb20gdGhlIHJlY29yZC4KICoKICogVGhlIG1ldGhvZCBleGlzdHMgaW4gdGhyZWUgdmVyc2lvbnMsIGRlcGVuZGluZyBvbiB0aGUKICogbnVtYmVyIGFuZCB0eXBlIG9mIGFyZ3VtZW50cyBnaXZlbi4KICoKICogSWYgZ2l2ZW4gYSBudW1lcmljYWwgaW5kZXgsIGl0IHJlbW92ZXMgdGhlIGZpZWxkIGF0IHRoYXQgcG9zaXRpb24KICogaW4gdGhlIHJlY29yZHMgaW50ZXJuYWwgcmVwcmVzZW50YXRpb24gb2YgZmllbGRzLgogKgogKiBJZiBnaXZlbiBhIG5hbWUsIGl0IHJlbW92ZXMgdGhlIGZpcnN0IGZpZWxkIGZvdW5kLCB0aGF0IG1hdGNoZXMgdGhlCiAqIGdpdmVuIG5hbWUuCiAqCiAqIElmIGdpdmVuIGEgbmFtZSBhbmQgYW4gaW5kZXggbiwgaXQgcmVtb3ZlcyB0aGUgbid0aCBmaWVsZCB3aXRoCiAqIHRoZSBnaXZlbiBuYW1lLgogKgogKiBJZiBubyBmaWVsZCBtYXRjaGVzIHRoZSBwYXJhbWV0ZXJzLCBub3RoaW5nIGhhcHBlbnMuCiAqCiAqICoqTm90ZToqKiBGb3IgdGhlIEMrKyBpbXBsZW1lbnRhdGlvbjogQW55IHJlZmVyZW5jZSB0byBleGlzdGluZwogKiBmaWVsZHMgb24gdGhpcyByZWNvcmQgbWF5IGJlIGludmFsaWRhdGVkIGJ5IHJlbW92aW5nIGEgZmllbGQuIFRoaXMKICogaGFzIGEgbnVtYmVyIG9mIHBvdGVudGlhbCBiYWQgY29uc2VxdWVuY2VzLCBtb3N0IG9mIHdoaWNoIGxlYWRzIHRvCiAqIGNyYXNoZXMgb3IgdW5wcmVkaWN0YWJsZSBiZWhhdmlvdXIuIEl0IGlzIGVhc3kgdG8gZmFsbCBpbnRvIHRoZQogKiB0cmFwIG9mIGUuZy4gaXRlcmF0aW5nIGFsbCBmaWVsZHMgaW4gYSByZWNvcmQsIGFuZCByZW1vdmUgc29tZSBvZgogKiB0aGVtLiBUaGlzIGlzIGFsbW9zdCBjZXJ0YWluIHRvIG1ha2UgeW91ciBhcHBsaWNhdGlvbgogKiBjcmFzaC4gSW5zdGVhZCwgY29sbGVjdCB0aGUgbmFtZXMgb3IgaW5kZXhlcyBvZiB0aGUgZmllbGRzIHlvdSB3aXNoCiAqIHRvIHJlbW92ZSwgdGhlbiByZW1vdmUgdGhlbSBhZnRlciB5b3VyIG1haW4gaXRlcmF0aW9uLgogKgogKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IGZpZWxkSW5kZXhPckZpZWxkTmFtZSBJbmRleCBvZiBmaWVsZCB0byByZW1vdmUsIHplcm8tYmFzZWQsIG9yIG5hbWUgb2YgYSBmaWVsZCB0byByZW1vdmUKICogQHBhcmFtIHtudW1iZXJ9IFtmaWVsZE5hbWVJbmRleF0gSW5kZXggb2YgbmFtZWQgZmllbGQgdG8gcmVtb3ZlLCB6ZXJvLWJhc2VkLiAqT25seSBhbGxvd2VkIGlmIGZpcnN0IGFyZ3VtZW50IGlzIGEgZmllbGROYW1lLioKICogQGV4YW1wbGUKIC8vIFJlbW92ZSB0aGUgdGhpcmQgZmllbGQgaW4gdGhlIHJlY29yZAogYVJlY29yZC5yZW1vdmUoIDIgKTsKIC8vIFJlbW92ZSB0aGUgZmlyc3QgNTQ1IGZpZWxkCiBhUmVjb3JkLnJlbW92ZSggIjU0NSIgKTsKIC8vIFJlbW92ZSB0aGUgc2Vjb25kIDU0NSBmaWVsZAogYVJlY29yZC5yZW1vdmUoICI1NDUiLCAxICk7CiAqIEBtZXRob2QKICogQG1lbWJlck9mIFJlY29yZAogKiBAbmFtZSBSZWNvcmQucmVtb3ZlCiAqIEBuYW1lIFJlY29yZCNyZW1vdmUgKi8KUmVjb3JkLnJlbW92ZSA9IG5ldyBTdHJpbmcoKTsKCi8qKiBSZW1vdmUgYWxsIG1hdGNoaW5nIGZpZWxkcyBmcm9tIGEgcmVjb3JkLgogKgogKiBHaXZlbiBhIGZpZWxkIG5hbWUsIHJlbW92ZXMgYWxsIG1hdGNoaW5nIGZpZWxkcyBmcm9tIHRoZSByZWNvcmQuCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBmaWVsZE5hbWUgTmFtZSBvZiBmaWVsZCB0byByZW1vdmUKICogQGV4YW1wbGUKIC8vIFJlbW92ZSBhbGwgNTQ1IGZpZWxkcwogYVJlY29yZC5yZW1vdmVBbGwoICI1NDUiICk7CiAqIEBtZXRob2QKICogQG1lbWJlck9mIFJlY29yZAogKiBAbmFtZSBSZWNvcmQucmVtb3ZlQWxsCiAqIEBuYW1lIFJlY29yZCNyZW1vdmVBbGwgKi8KUmVjb3JkLnJlbW92ZUFsbCA9IG5ldyBTdHJpbmcoKTsKCi8qKiBSZW1vdmVzIGFueSBmaWVsZCBpbiB0aGUgcmVjb3JkLCB0aGF0IG1hdGNoZXMgYSBnaXZlbiBjcml0ZXJpYS4KICoKICogQHBhcmFtIHtSZWdFeHB8T2JqZWN0fSBtYXRjaGVyIEEgUmVnRXhwIHRoYXQgbWF0Y2hlcyB0aGUgZmllbGQgbmFtZQogKiAgICAgICAgICBvciBhbiBvYmplY3Qgd2l0aCBhIGZ1bmN0aW9uIG9mIHRoZSBub3JtOiBmdW5jdGlvbiBtYXRjaEZpZWxkKCByZWNvcmQsIGZpZWxkICkuCiAqICAgICAgICBUaGUgZnVuY3Rpb24gc2hvdWxkIHJldHVybiBhIGJvb2xlYW4gdmFsdWUuCiAqCiAqIEByZXR1cm4gTm90aGluZy4KICoKICogQGV4YW1wbGUKIGZ1bmN0aW9uIHJlbW92ZVN1YmplY3RzKCByZWNvcmQgKSB7CglyZXR1cm4gcmVjb3JkLnJlbW92ZVdpdGhNYXRjaGVyKCAvNjY2LyApOwp9CiAqCiAqIEBtZXRob2QKICogQG5hbWUgUmVjb3JkLnJlbW92ZVdpdGhNYXRjaGVyCiAqIEBuYW1lIFJlY29yZCNyZW1vdmVXaXRoTWF0Y2hlciAqLwpSZWNvcmQucmVtb3ZlV2l0aE1hdGNoZXIgPSBuZXcgU3RyaW5nKCk7CgovKiogSXRlcmF0ZXMgb3ZlciB0aGUgZmllbGRzIGFuZCByZXR1cm5zIGFuIGFycmF5IG9mIHRoZSBzZWxlY3RlZCBmaWVsZHMKICoKICogQHBhcmFtIHtSZWdFeHB8U3RyaW5nfE9iamVjdH0gbWF0Y2hlciBBIFJlZ0V4cCB0aGF0IG1hdGNoZXMgdGhlIGZpZWxkIG5hbWUKICogICAgICAgICAgb3IgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbiBvZiB0aGUgbm9ybTogZnVuY3Rpb24gbWF0Y2hGaWVsZCggcmVjb3JkLCBmaWVsZCApLgogKiAgICAgICAgVGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBib29sZWFuIHZhbHVlLgogKiBAcGFyYW0ge0FycmF5fSBzb3J0ZXIgQW4gYXJyYXkgb2Ygb2JqZWN0cyB0aGF0IGhhcyBhIGZ1bmN0aW9uOiBzb3J0KCBhLCBiICkuIGEgYW5kCiAqICAgICAgICAgIGIgYXJlIGZpZWxkcyBhbmQgdGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gLTEgKGEgPCBiKSwgMCAoIGEgPT0gYikgb3IgMSAoYSA+IGIpLgogKiAgICAgICAgICBJZiB0aGUgZnVuY3Rpb24gcmV0dXJucyAtMSBvciAxLCB0aGVuIHRoZSB0d28gZmllbGRzIGFyZSBzb3J0ZWQgYW5kIGFueSBmdXJ0aGVyCiAqICAgICAgICAgIGVsZW1lbnRzIGluIHRoZSBhcnJheSBhcmUgaWdub3JlZCBmb3IgdGhlc2UgdHdvIGZpZWxkcy4KICoKICogQHJldHVybiB7QXJyYXl9IEFuIGFycmF5IG9mIHRoZSBzZWxlY3RlZCBmaWVsZHMuIEVhY2ggZWxlbWVudCBpcyBvZiB0eXBlIEZpZWxkLgogKgogKiBAbWV0aG9kCiAqIEBuYW1lIFJlY29yZC5zZWxlY3RGaWVsZHMKICogQG5hbWUgUmVjb3JkI3NlbGVjdEZpZWxkcyAqLwoKUmVjb3JkLnNlbGVjdEZpZWxkcyA9IG5ldyBTdHJpbmcoKTsKCi8qKiBJdGVyYXRlcyBvdmVyIHRoZSBmaWVsZHMgYW5kIHJldHVybnMgYW4gYXJyYXkgb2YgdGhlIHNlbGVjdGVkIGZpZWxkcyBhcyBhIHNlcXVlbmNlLgogKgogKiBBIHNlcXVlbmNlIGlzIGFuIGFycmF5IG9mIG1hdGNoZXJzIHRoYXQgaXMgdXNlZCB0byBleHRyYWN0IGZpZWxkcy4gVGhlIHJldHVybmVkIGFycmF5IGNvbnRhaW5zCiAqIGZpcnN0IHRoZSBmaXJzdCBmaWVsZCBmcm9tIGVhY2ggbWF0Y2hlciwgdGhlbiBvbiB0aGUgc2Vjb25kIGZpZWxkIGZyb20gZWFjaCBtYXRjaGVyLAogKiBhbmQgc28gb24uCiAqCiAqIElmIHRoZSBtYXRjaGVycyBtYXRjaGVzIG9uIGRpZmZlcmVudCBudW1iZXIgb2YgZmllbGRzLCB0aGVuIG9ubHkgdGhlIHNtYWxsZXN0IG51bWJlciBvZiBtYXRjaGVkCiAqIGZpZWxkcyBpcyB1c2VkLgogKgogKiBAcGFyYW0ge1JlZ0V4cHxPYmplY3R9IG1hdGNoZXIgQSBSZWdFeHAgdGhhdCBtYXRjaGVzIHRoZSBmaWVsZCBuYW1lCiAqICAgICAgICAgIG9yIGFuIG9iamVjdCB3aXRoIGEgZnVuY3Rpb24gb2YgdGhlIG5vcm06IGZ1bmN0aW9uIG1hdGNoRmllbGQoIHJlY29yZCwgZmllbGQgKS4KICogICAgICAgIFRoZSBmdW5jdGlvbiBzaG91bGQgcmV0dXJuIGEgYm9vbGVhbiB2YWx1ZS4KICogQHBhcmFtIHtBcnJheX0gc29ydGVyIEFuIGFycmF5IG9mIG9iamVjdHMgdGhhdCBoYXMgYSBmdW5jdGlvbjogc29ydCggYSwgYiApLiBhIGFuZAogKiAgICAgICAgICBiIGFyZSBmaWVsZHMgYW5kIHRoZSBmdW5jdGlvbiBzaG91bGQgcmV0dXJuIC0xIChhIDwgYiksIDAgKCBhID09IGIpIG9yIDEgKGEgPiBiKS4KICogICAgICAgICAgSWYgdGhlIGZ1bmN0aW9uIHJldHVybnMgLTEgb3IgMSwgdGhlbiB0aGUgdHdvIGZpZWxkcyBhcmUgc29ydGVkIGFuZCBhbnkgZnVydGhlcgogKiAgICAgICAgICBlbGVtZW50cyBpbiB0aGUgYXJyYXkgYXJlIGlnbm9yZWQgZm9yIHRoZXNlIHR3byBmaWVsZHMuCiAqCiAqIEByZXR1cm4ge0FycmF5fSBBbiBhcnJheSBvZiB0aGUgc2VsZWN0ZWQgZmllbGRzLiBFYWNoIGVsZW1lbnQgaXMgb2YgdHlwZSBGaWVsZC4KICoKICogQG1ldGhvZAogKiBAbmFtZSBSZWNvcmQuc2VsZWN0RmllbGRzU2VxdWVuY2UKICogQG5hbWUgUmVjb3JkI3NlbGVjdEZpZWxkc1NlcXVlbmNlICovClJlY29yZC5zZWxlY3RGaWVsZHNTZXF1ZW5jZSA9IG5ldyBTdHJpbmcoKTsKCi8qKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgZmllbGRzIGluIHRoaXMgcmVjb3JkLgogKgogKiAgQHJldHVybiB7TnVtYmVyfSBUaGUgbnVtYmVyIG9mIGZpZWxkcy4KICogIEBleGFtcGxlCiAvLyBUaGlzIGZ1bmN0aW9uIGlzIG1vc3RseSB1c2VkIGluIGZ1bmN0aW9ucyB3aXRoIGZvci1zdHJ1Y3R1cmVzIGxpa2U6CiBmdW5jdGlvbiBwcmludEZpZWxkcyggcmVjb3JkICkgewoJZm9yKCB2YXIgaSA9IDA7IGkgPCByZWNvcmQuc2l6ZSgpOyBpKysgKSB7CgkJdmFyIGZpZWxkID0gcmVjb3JkLmZpZWxkKCBpICk7CgkJCgkJcHJpbnQoIGZpZWxkLnRvU3RyaW5nKCkgKyAiXG4iICk7Cgl9Cn0KICoKICogQG1ldGhvZAogKiBAbmFtZSBSZWNvcmQuc2l6ZQogKiBAbmFtZSBSZWNvcmQjc2l6ZSAqLwpSZWNvcmQuc2l6ZSA9IG5ldyBTdHJpbmcoKTsKCi8qKiBHZXQgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIHJlY29yZC4KICoKICogVGhpcyBtZXRob2QgcmV0dXJucyBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgcmVjb3JkLCBpbiBhCiAqIGZvcm1hdCB2ZXJ5IGNsb3NlIHRvIGEgc3RhbmRhcmQgTWFyYyBsaW5lIGZvcm1hdC4gVGhlIHN0cmluZyBpcwogKiBjb25zdHJ1Y3RlZCBieSBjYWxsaW5nIHRoZSB0b1N0cmluZyBtZXRob2Qgb2YgYWxsIHRoZSBmaWVsZHMgdGhlCiAqIHJlY29yZCBjb250YWlucy4KICoKICogQW55IHZhbHVlcyBvZiBAIG9yICogaW4gZmllbGRzL3N1YmZpZWxkcywgd2lsbCBiZSB3cml0dGVuIGFzCiAqIEBAIGFuZCBAKiByZXNwZWN0aXZlbHkuCiAqCiAqIEByZXR1cm4ge1N0cmluZ30gQSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIHJlY29yZAogKiBAbWV0aG9kCiAqIEBtZW1iZXJPZiBSZWNvcmQKICogQG5hbWUgUmVjb3JkLnRvU3RyaW5nCiAqIEBuYW1lIFJlY29yZCN0b1N0cmluZyAqLwpSZWNvcmQudG9TdHJpbmcgPSBuZXcgU3RyaW5nKCk7CgovKiogQ3JlYXRlIGEgcmVjb3JkIGZyb20gYSBzdHJpbmcuCiAqCiAqIFRoaXMgbWV0aG9kIGNoYW5nZXMgdGhlIHJlY29yZCB0byByZXByZXNlbnQgdGhlIGlucHV0IGluIHRoZSBzdHJpbmcuCiAqCiAqIEV4aXN0aW5nIGNvbnRlbnQgb2YgdGhlIHJlY29yZCBpcyBjbGVhcmVkLiBUaGUgaW5wdXQgaXMgcGFyc2VkIHRvCiAqIGJ1aWxkIGEgbmV3IHJlY29yZCBpbiBwbGFjZS4gVGhlIHBhcnNlciBob25vcnMgdHdvICJzdGFuZGFyZCIgTWFyYwogKiByZWNvcmQgZXNjYXBlIGNvZGVzOiBAQCBhbmQgQFwqLCB3aGljaCBhcmUgdHJhbnNsYXRlZCB0byBAIGFuZCBcKgogKiByZXNwZWN0aXZlbHkuIE90aGVyIEAgY29kZXMgYXJlIG5vdCBpbnRlcnByZXRlZCwgYnV0IGFyZSBjYXJyaWVkCiAqIHRocm91Z2ggdW5jaGFuZ2VkLgogKgogKiAqKk5PVEU6KiogY29udHJvbEZpZWxkcyBhcmUgKm5vdCBzdXBwb3J0ZWQqIGJ5IHRoaXMgbWV0aG9kLgogKgogKiBAcGFyYW0ge1N0cmluZ30gc3RyaW5nIEEgTWFyYyByZWNvcmQgaW4gbGluZSBmb3JtYXQuCiAqIEBtZXRob2QKICogQG1lbWJlck9mIFJlY29yZAogKiBAbmFtZSBSZWNvcmQuZnJvbVN0cmluZwogKiBAbmFtZSBSZWNvcmQjZnJvbVN0cmluZyAqLwpSZWNvcmQuZnJvbVN0cmluZyA9IG5ldyBTdHJpbmcoKTsKCgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vIEZJRUxECi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCi8qKiBBIGZpZWxkIGluIGEgTWFyYyByZWNvcmQuCiAqCiAqIFRoZSBGaWVsZCBjbGFzcyBpcyBhbiBhYnN0cmFjdGlvbiBmb3IgYSBGaWVsZCBpbiBhIE1hcmMgcmVjb3JkLiBJdAogKiBjb250YWlucyBhIG51bWJlciBvZiBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzIHRvIHJlcHJlc2VudCBhbmQKICogbWFuaXB1bGF0ZSBhIGZpZWxkLgogKgogKiBZb3UgY2FuIGNvbnN0cnVjdCBhIGZpZWxkIGluc3RhbmNlIGluIG9uZSBvZiB0d28gd2F5cywgZWl0aGVyIGFzIGFuCiAqIGVtcHR5IGZpZWxkLCBvciBieSBnaXZpbmcgaXQgYSBuYW1lIGFuZCBhbiBpbmRpY2F0b3IuCiAqCiAqIEEgZmllbGQgY2FuIGJlIGVpdGhlciBhICpub3JtYWwgZmllbGQqLCB3aXRoIG5hbWUsIGluZGljYXRvciBhbmQKICogc3ViZmllbGRzLCBvciBpdCBjYW4gYmUgYSAqY29udHJvbCBmaWVsZCosIHdpdGggbmFtZSBhbmQgdmFsdWUuIEFsbAogKiBmaWVsZHMgYXJlIGNvbnN0cnVjdGVkIGFzIG5vcm1hbCBmaWVsZHMuIElmIHlvdSB3YW50IHRvIGNyZWF0ZSBhCiAqIGNvbnRyb2wgZmllbGQsIHlvdSBtdXN0IHVzZSB0aGUgZGVmYXVsdCBjb25zdHJ1Y3RvciAobm8gYXJndW1lbnQpLAogKiB0aGVuIHNldCB0aGUgbmFtZSBhbmQgdmFsdWUgcHJvcGVydGllcyBhZnRlcndhcmRzLiBTZXR0aW5nIHRoZQogKiB2YWx1ZSBwcm9wZXJ0eSBvbiBhIGZpZWxkIHdpdGggbm8gaW5kaWNhdG9yLCBhbmQgbm8gc3ViZmllbGRzLAogKiB0dXJucyBpdCBpbnRvIGEgY29udHJvbCBmaWVsZC4gSXQgaXMgbm90IHBvc3NpYmx5IHRvIHR1cm4gYSBjb250cm9sCiAqIGZpZWxkIGJhY2sgaW50byBhIG5vcm1hbCBmaWVsZC4KICoKICogQGV4YW1wbGUKIC8vIFN5bnRheAogdmFyIGYxID0gbmV3IEZpZWxkKCk7CiB2YXIgZjIgPSBuZXcgRmllbGQoIGZpZWxkTmFtZSwgaW5kaWNhdG9yICk7CiAqIEBleGFtcGxlCiAvLyBUaGlzIGNvbnN0cnVjdHMgYSBub3JtYWwgZmllbGQsIGFuZCBhZGRzIGEgc3ViZmllbGQKIHZhciBub3JtYWxGaWVsZCA9IG5ldyBGaWVsZCggIjAwMSIsICIwMiIgKTsKIG5vcm1hbEZpZWxkLmFwcGVuZCggbmV3IFN1YmZpZWxkKCAiYSIsICJ2YWx1ZSBvZiBhIHN1YmZpZWxkIiApICk7CiAqIEBleGFtcGxlCiAvLyBUaGlzIGNvbnN0cnVjdHMgYSBub3JtYWwgZmllbGQsIHdpdGggbm8gbmFtZSBvciBpbmRpY2F0b3IsCiAvLyB3aGljaCBpcyB0aGVuIHRyYW5zZm9ybWVkIHRvIGEgY29udHJvbCBmaWVsZCBieSBzZXR0aW5ncyBpdHMgdmFsdWUKIHZhciBjb250cm9sRmllbGQgPSBuZXcgRmllbGQoKTsKIGNvbnRyb2xGaWVsZC5uYW1lID0gIjAwMiI7CiBjb250cm9sRmllbGQudmFsdWUgPSAiVGhpcyBpcyB0aGUgdmFsdWUgb2YgdGhlIGNvbnRyb2wgZmllbGQiCiAqIEBwYXJhbSB7c3RyaW5nfSBbZmllbGROYW1lXSBOYW1lIG9mIHRoZSBuZXcgZmllbGQuCiAqIEBwYXJhbSB7c3RyaW5nfSBbaW5kaWNhdG9yXSBWYWx1ZSBvZiB0aGUgaW5kaWNhdG9yLiAqTXVzdCBiZSBwcmVzZW50IGlmIGZpZWxkTmFtZSBpcyBnaXZlbi4qCiAqIEBjb25zdHJ1Y3RvcgogKiBAc2VlIE1hcmNDbGFzc2VzCiAqIEBzZWUgUmVjb3JkCiAqIEBzZWUgU3ViZmllbGQKICogQG5hbWUgRmllbGQgKi8KLy8gRG8gbm90IHJlbW92ZSB0aGlzIGNvbW1lbnQKCi8vIFBST1BFUlRJRVMKCi8qKiBUaGUgbmFtZSBvZiB0aGUgZmllbGQuCiAqCiAqIFRoaXMgcHJvcGVydHkgaG9sZHMgdGhlIG5hbWUgb2YgdGhlIGZpZWxkLgogKgogKiBAdHlwZSB7c3RyaW5nfQogKiBAbmFtZSBGaWVsZC5uYW1lCiAqIEBuYW1lIEZpZWxkI25hbWUgKi8KRmllbGQubmFtZSA9IG5ldyBTdHJpbmcoKTsKCi8qKiBUaGUgaW5kaWNhdG9yIGZvciB0aGUgZmllbGQuCiAqCiAqIFRoaXMgcHJvcGVydHkgaG9sZHMgdGhlIGluZGljYXRvciBmb3IgdGhlIGZpZWxkLCBhcyBhIHN0cmluZywgaWYKICogdGhlIGZpZWxkIGlzIGEgKm5vcm1hbCogZmllbGQuCiAqCiAqIFRoaXMgcHJvcGVydHkgaXMgb25seSBhdmFpbGFibGUsIGlmIHRoZSBmaWVsZCBpcyBhIG5vcm1hbCBmaWVsZCwKICogbm90IGEgY29udHJvbCBmaWVsZC4gQXNzaWduaW5nIHRvLCBvciByZWFkaW5nIGZyb20sIHRoaXMgcHJvcGVydHksCiAqIGlmIHRoZSBmaWVsZCBpcyBhIGNvbnRyb2wgZmllbGQsIHdpbGwgdGhyb3cgYW4gZXhjZXB0aW9uLgogKgogKiBAdHlwZSB7c3RyaW5nfQogKiBAbmFtZSBGaWVsZC5pbmRpY2F0b3IKICogQG5hbWUgRmllbGQjaW5kaWNhdG9yICovCkZpZWxkLmluZGljYXRvciA9IG5ldyBTdHJpbmcoKTsKCi8qKiBUaGUgdmFsdWUgb2YgdGhlIGZpZWxkLgogKgogKiBUaGlzIHByb3BlcnR5IGhvbGRzIHRoZSB2YWx1ZSBvZiB0aGUgZmllbGQsIGlmIHRoZSBmaWVsZCBpcyBhICpjb250cm9sKiBmaWVsZC4KICoKICogQXNzaWduaW5nIHRvIHRoaXMgcHJvcGVydHksIHdpbGwgY29udmVydCBhIG5vcm1hbCBmaWVsZCB0byBhCiAqIGNvbnRyb2wgZmllbGQsICppZiogdGhlIGZpZWxkIGRvZXMgbm90IGNvbnRhaW4gYW4gaW5kaWNhdG9yIG9yIGFueQogKiBzdWJmaWVsZHMuIElmIGl0IGRvZXMsIGFuIGV4Y2VwdGlvbiB3aWxsIGJlIHRocm93bi4gUmVhZGluZyBmcm9tCiAqIHRoaXMgcHJvcGVydHkgd2lsbCBhbHNvIHRocm93LCBpZiB0aGUgZmllbGQgaXMgYSBub3JtYWwgZmllbGQuCiAqCiAqIEB0eXBlIHtzdHJpbmd9CiAqIEBuYW1lIEZpZWxkLnZhbHVlCiAqIEBuYW1lIEZpZWxkI3ZhbHVlICovCkZpZWxkLnZhbHVlID0gbmV3IFN0cmluZygpOwoKLy8gTUVUSE9EUwoKLyoqIEFwcGVuZCBhIHN1YmZpZWxkIHRvIGEgZmllbGQuCiAqCiAqIFRoaXMgbWV0aG9kIGFwcGVuZHMgYSBzdWJmaWVsZCB0byBhIGZpZWxkLiBJdCBjYW4gYmUgY2FsbGVkIGluCiAqIHRocmVlIGRpZmZlcmVudCB3YXlzLgogKgogKiBJZiBjYWxsZWQgd2l0aCBhIFN1YmZpZWxkIGluc3RhbmNlLCB0aGUgc3ViZmllbGQgaXMgYWRkZWQgKGNvcGllZCkKICogdG8gdGhlIGZpZWxkLgogKgogKiBJZiBjYWxsZWQgd2l0aCBhIG5hbWUgYW5kIHZhbHVlLCBhIG5ldyBzdWJmaWVsZCBpcyBjcmVhdGVkIGFuZAogKiBhZGRlZCB0byB0aGUgZmllbGQuCiAqCiAqIElmIGNhbGxlZCB3aXRoIGEgbmFtZSwgYSB2YWx1ZSwgYW5kIGEgYm9vbCBzZXQgdG8gdHJ1ZSwgYSBzdWJmaWVsZAogKiB3aWxsIGJlIGNyZWF0ZWQsIGFuZCBpdCB3aWxsIHJlcGxhY2UgdGhlIGZpcnN0IHN1YmZpZWxkIHdpdGggdGhlCiAqIHNhbWUgbmFtZSwgaWYgcHJlc2VudCwgb3RoZXJ3aXNlIGl0IHdpbGwganVzdCBiZSBhcHBlbmRlZC4KICoKICogVGhlIGFwcGVuZCBvcGVyYXRpb24gY2FuIG9ubHkgYmUgY2FsbGVkIG9uIG5vcm1hbCBmaWVsZHMsIG5vdAogKiBjb250cm9sIGZpZWxkcy4KICoKICogKipOb3RlOioqIEZvciB0aGUgQysrIGltcGxlbWVudGF0aW9uOiBBbnkgcmVmZXJlbmNlIHRvIGV4aXN0aW5nCiAqIHN1YmZpZWxkcyBvbiB0aGlzIHJlY29yZCBtYXkgYmUgaW52YWxpZGF0ZWQgYnkgYXBwZW5kIGEKICogc3ViZmllbGQuIFRoaXMgaGFzIGEgbnVtYmVyIG9mIHBvdGVudGlhbCBiYWQgY29uc2VxdWVuY2VzLCBtb3N0IG9mCiAqIHdoaWNoIGxlYWRzIHRvIGNyYXNoZXMgb3IgdW5wcmVkaWN0YWJsZSBiZWhhdmlvdXIuIEl0IGlzIGVhc3kgdG8KICogZmFsbCBpbnRvIHRoZSB0cmFwIG9mIGUuZy4gaXRlcmF0aW5nIGFsbCBzdWJmaWVsZHMgaW4gYSBmaWVsZCwgYW5kCiAqIGFwcGVuZCBzb21lIHdoaWxlIGl0ZXJhdGluZy4gVGhpcyBpcyBhbG1vc3QgY2VydGFpbiB0byBtYWtlIHlvdXIKICogYXBwbGljYXRpb24gY3Jhc2guIEluc3RlYWQsIGNvbGxlY3QgdGhlIG5ldyBzdWJmaWVsZHMgeW91IHdpc2ggdG8KICogYXBwZW5kLCB0aGVuIGFwcGVuZCB0aGVtIGFmdGVyIHlvdXIgbWFpbiBpdGVyYXRpb24uCiAqCiAqIEBleGFtcGxlCiAvLyBBcHBlbmQgYW4gZXhpc3RpbmcgZmVsZAogYUZpZWxkLmFwcGVuZCggc3ViZmllbGQgKTsKIC8vIENyZWF0ZSBhIG5ldyBzdWJmaWVsZCwgYW5kIGFwcGVuZCBpdAogYUZpZWxkLmFwcGVuZCggImEiLCAiSSBhbSBhbiBhIHN1YmZpZWxkIiApOwogLy8gQ3JlYXRlIGEgbmV3IHN1YmZpZWxkLCBhbmQgYXBwZW5kIGl0IHRvIHRoZSBmaWVsZCwgcmVwbGFjaW5nIHRoZSBmaXJzdCBzaW1pbGFyIHN1YmZpZWxkCiBhRmllbGQuYXBwZW5kKCAiYSIsICJJIGFtIGFuIGEgc3ViZmllbGQiLCB0cnVlICk7CiAqIEBleGFtcGxlIC8vIFRoaXMgZXhhbXBsZSBpbGx1c3RyYXRlcyB0aGUgcmVsYXRpb24gYmV0d2VlbiBleGlzdGluZyByZWZlcmVuY2VzLCBhbmQgbmV3IFN1YmZpZWxkcy4KIHZhciBhRmllbGQgPSBuZXcgRmllbGQoKTsKIGFGaWVsZC5hcHBlbmQoICJhIiwgIkkgYW0gYW4gc3ViZmllbGQiICk7CiB2YXIgYVN1YmZpZWxkID0gYUZpZWxkLnN1YmZpZWxkKCAiYSIgKTsKIGFTdWJmaWVsZC5uYW1lID0gImIiIC8vIENoYW5nZXMgdGhlIG5hbWUgb2YgdGhlIHN1YmZpZWxkIGluIGFGaWVsZAogdmFyIG5ld0ZpZWxkID0gbmV3IEZpZWxkKCk7CiBuZXdGaWVsZC5hcHBlbmQoIGFTdWJmaWVsZCApOyAvLyBhU3ViZmllbGQgaXMgY29waWVkIGludG8gbmV3RmllbGQKIGFTdWJmaWVsZC5uYW1lID0gImEiIC8vIENoYW5nZXMgdGhlIG5hbWUgb2YgdGhlIGZpZWxkIGluIGFGaWVsZCwgYnV0IG5vdCBpbiBuZXdGaWVsZC4KICoKICogQHBhcmFtIHtTdWJmaWVsZHxTdHJpbmd9IHN1YmZpZWxkT3JTdWJmaWVsZE5hbWUgVGhlIFN1YmZpZWxkIHRvIGFkZCwgb3IgdGhlIG5hbWUgb2YgYSBuZXcgc3ViZmllbGQgdG8gY3JlYXRlIGFuZCBhZGQuCiAqIEBwYXJhbSB7U3RyaW5nfSBbc3ViZmllbGRWYWx1ZV0gVGhlIHZhbHVlIG9mIHRoZSBuZXcgU3ViZmllbGQgdG8gYWRkLiAqTXVzdCBiZSBwcmVzZW50IGlmIHRoZSBmaXJzdCBhcmd1bWVudCBpcyBhIHN1YmZpZWxkTmFtZS4qCiAqIEBwYXJhbSB7Qm9vbH0gW3JlcGxhY2VdIElmIHRydWUsIHJlcGxhY2UgZXhpc3Rpbmcgc3ViZmllbGRzIG9mIHRoZSBzYW1lIG5hbWUuCiAqIEBtZXRob2QKICogQG5hbWUgRmllbGQuYXBwZW5kCiAqIEBuYW1lIEZpZWxkI2FwcGVuZCAqLwpGaWVsZC5hcHBlbmQgPSBuZXcgU3RyaW5nKCk7CgovKiogQ3JlYXRlIGEgY2xvbmUgKGNvcHkpIG9mIHRoaXMgZmllbGQuCiAqCiAqIEFsbCB0aGUgc3ViIGZpZWxkcyBvZiB0aGlzIGZpZWxkIGFyZSBhbHNvIGNsb25lZCBieSB0aGlzIGZ1bmN0aW9uLgogKgogKiBAcmV0dXJuIHtGaWVsZH0gQW4gZXhhY3QgY2xvbmUgb2YgdGhpcyBmaWVsZC4KICoKICogQG1ldGhvZAogKiBAbmFtZSBGaWVsZC5jbG9uZQogKiBAbmFtZSBGaWVsZCNjbG9uZSAqLwpGaWVsZC5jbG9uZSA9IG5ldyBTdHJpbmcoKTsKCi8qKiBDb3VudCB0aGUgbnVtYmVyIG9mIHN1YmZpZWxkcyBpbiBhIGZpZWxkIHdpdGggYSBnaXZlbiBuYW1lLgogKgogKiBHaXZlbiB0aGUgbmFtZSBvZiBhIHN1YmZpZWxkLCB0aGlzIG1ldGhvZCByZXR1cm5zIHRoZSBudW1iZXIgb2YKICogc3ViZmllbGRzIHdpdGggdGhhdCBuYW1lLgogKgogKiBAcGFyYW0ge3N0cmluZ30gc3ViZmllbGROYW1lIFRoZSBuYW1lIG9mIGEgZmllbGQuCiAqIEByZXR1cm4ge251bWJlcn0gVGhlIG51bWJlciBvZiBzdWJmaWVsZHMgd2l0aCB0aGUgZ2l2ZW4gc3ViZmllbGROYW1lCiAqCiAqIEBleGFtcGxlCiAvLyBDb3VudCB0aGUgbnVtYmVyIG9mICJhIiBzdWJmaWVsZHMKIHZhciBudW0gPSBmaWVsZC5jb3VudCggImEiICk7CiAqIEBtZXRob2QKICogQG5hbWUgRmllbGQuY291bnQKICogQG5hbWUgRmllbGQjY291bnQgKi8KRmllbGQuY291bnQgPSBuZXcgU3RyaW5nKCk7CgovKiogSXRlcmF0ZXMgb3ZlciB0aGUgc3ViIGZpZWxkcyBhbmQgY2FsbHMgYW4gaGFuZGxlciBvbiBlYWNoIHN1YiBmaWVsZC4KICoKICogQHBhcmFtIHtSZWdFeHB8U3RyaW5nfE9iamVjdH0gbWF0Y2hlciBBbiBSZWdFeHAgb3Igc3RyaW5nIHRoYXQgbWF0Y2hlcyB0aGUgc3ViZmllbGQgbmFtZQogKiAgICAgICAgICBvciBhbiBvYmplY3Qgd2l0aCBhIGZ1bmN0aW9uIG9mIHRoZSBub3JtOiBmdW5jdGlvbiBtYXRjaFN1YkZpZWxkKCBmaWVsZCwgc3ViZmllbGQgKS4KICogICAgICAgIFRoZSBmdW5jdGlvbiBzaG91bGQgcmV0dXJuIGEgYm9vbGVhbiB2YWx1ZS4KICogQHBhcmFtIHtIYW5kbGVyfEZ1bmN0aW9ufSBoYW5kbGVyIFRoZSBoYW5kbGVyIHRvIGNhbGwgZm9yIGVhY2ggc3ViZmllbGQgZm91bmQKICogICAgICAgICAgYnkgbWF0Y2hlci4KICoKICogQHJldHVybiBJZiBoYW5kbGVyIHJldHVybnMgYSB2YWx1ZSB0aGVuIGFsbCB0aGUgdmFsdWVzIGFyZSBhZGRlZCB0b2dldGhlciBpbnRvIGEKICogICAgICAgICAgIHNpbmdsZSB2YWx1ZS4KICoKICogQGV4YW1wbGUKIGZ1bmN0aW9uIGdldFZhbHVlKCBmaWVsZCApIHsKCXJldHVybiBmaWVsZC5lYWNoU3ViRmllbGQoICJhIiwgZnVuY3Rpb24oIGZpZWxkLCBzdWJGaWVsZCApIHsgcmV0dXJuIHN1YkZpZWxkLnZhbHVlOyB9ICk7Cn0KICoKICogVGhlIGZ1bmN0aW9uIGdldFZhbHVlIGlzIHBhc3NlZCBhIGZpZWxkIGFuZCBpdGVyYXRlcyBvdmVyIGEgc3ViIGZpZWxkcyB3aXRoIG5hbWUgImEiIGFuZCBjb2xsZWN0cyB0aGUgdmFsdWVzIG9mIGFsbCBzdWIgZmllbGRzIHdpdGggbmFtZSAiYSIKICoKICogQG1ldGhvZAogKiBAbmFtZSBGaWVsZC5lYWNoU3ViRmllbGQKICogQG5hbWUgRmllbGQjZWFjaFN1YkZpZWxkICovCkZpZWxkLmVhY2hTdWJGaWVsZCA9IG5ldyBTdHJpbmcoKTsKCi8qKiBJdGVyYXRlcyBvdmVyIHRoZSBzdWJmaWVsZHMgYW5kIGNhbGxzIGEgaGFuZGxlciBvbiBlYWNoIHN1YmZpZWxkIGFzIGEgc2VxdWVuY2UuCiAqCiAqIEEgc2VxdWVuY2UgaXMgYW4gYXJyYXkgb2YgbWF0Y2hlcnMgdGhhdCBpcyB1c2VkIHRvIGV4dHJhY3Qgc3ViZmllbGRzLiBUaGUgaGFuZGxlcgogKiBpcyB0aGVuIHVzZWQgb24gdGhlIGZpcnN0IHN1YmZpZWxkIGZyb20gZWFjaCBtYXRjaGVyLCB0aGVuIG9uIHRoZSBzZWNvbmQgc3ViZmllbGQKICogZnJvbSBlYWNoIG1hdGNoZXIsIGFuZCBzbyBvbi4KICoKICogSWYgdGhlIG1hdGNoZXJzIG1hdGNoZXMgb24gZGlmZmVyZW50IG51bWJlciBvZiBzdWJmaWVsZHMsIHRoZW4gb25seSB0aGUgc21hbGxlc3QKICogbnVtYmVyIG9mIG1hdGNoZWQgc3ViZmllbGRzIGluIHVzZWQsIHRoZW4gd2UgaW52b2tlIHRoZSBoYW5kbGVyIG9uIHRoZSBzdWJmaWVsZC4KICoKICogQHBhcmFtIHtBcnJheX0gbWF0Y2hlcnMgQW4gQXJyYXkgb2YgbWF0Y2hlciBvYmplY3RzIChSZWdFeHAncyBvciBPYmplY3RzKS4KICogICAgICAgICAgVXNlIFJlZ0V4cCB0byBtYXRjaCB0aGUgc3ViZmllbGQgbmFtZSBvciB1c2UgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbgogKiAgICAgICAgICBvZiB0aGUgbm9ybTogZnVuY3Rpb24oIGZpZWxkLCBzdWJmaWVsZCApLiBUaGUgZnVuY3Rpb24gc2hvdWxkIHJldHVybiBhCiAqICAgICAgICAgIGJvb2xlYW4gdmFsdWUuCiAqIEBwYXJhbSB7SGFuZGxlcnxGdW5jdGlvbn0gaGFuZGxlciBUaGUgaGFuZGxlciB0byBjYWxsIGZvciBlYWNoIHN1YmZpZWxkIGZvdW5kCiAqICAgICAgICAgIGJ5IG1hdGNoZXIuCiAqCiAqIEByZXR1cm4gSWYgaGFuZGxlciByZXR1cm5zIGEgdmFsdWUgdGhlbiBhbGwgdGhlIHZhbHVlcyBhcmUgYWRkZWQgdG9nZXRoZXIgaW50byBhCiAqICAgICAgICAgICBzaW5nbGUgdmFsdWUuCiAqCiAqIEBleGFtcGxlCiBmaWVsZC5lYWNoU3ViRmllbGQoIFsgL2EvLCAvaS8gXSwgZnVuY3Rpb24oIGZpZWxkLCBzdWJGaWVsZCApIHsgcHJpbnQoIHN1YkZpZWxkLnZhbHVlICsgIiAiICkgfSApOwogKgogKiBUaGUgZnVuY3Rpb24gcHJpbnRzIHRoZSBzdWIgZmllbGRzICJhIiBhbmQgImkiIGluIHRoaXMgb3JkZXI6IEZpcnN0IGEsIGZpcnN0IGksIHNlY29uZCBhLAogKiBzZWNvbmQgaSwgYW5kIHNvIG9uLgogKgogKiBAbWV0aG9kCiAqIEBuYW1lIEZpZWxkLmVhY2hTdWJGaWVsZFNlcXVlbmNlCiAqIEBuYW1lIEZpZWxkI2VhY2hTdWJGaWVsZFNlcXVlbmNlICovCkZpZWxkLmVhY2hTdWJGaWVsZFNlcXVlbmNlID0gbmV3IFN0cmluZygpOwoKRmllbGQuZWFjaFN1YkZpZWxkTWFwID0gbmV3IFN0cmluZygpOwoKLyoqIENoZWNrcyBpZiB0aGUgZmllbGQgaXMgZW1wdHksIHRoYXQgaXQgaGFzIHplcm8gc3ViZmllbGRzLgogKgogKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBmaWVsZCBpcyBlbXB0eSwgZmFsc2Ugb3RoZXJ3aXNlLgogKgogKiBAZXhhbXBsZQogLy8gZW1wdHkoKSBpcyBhbnkgdGltZXMgdXNlZCBhcyBhIGVhcmx5IGNoZWNrIGluIHRoZSBiZWdpbm5pbmcgb2YgYSBmdW5jdGlvbgogZnVuY3Rpb24gZiggZmllbGQgKSB7CglpZiggZmllbGQuZW1wdHkoKSApIHsKIAkJcmV0dXJuOwogCX0KIAkKIAkvLyBOb3JtYWwgbG9naWMuLi4gCQp9CiAqIEBtZXRob2QKICogQG5hbWUgRmllbGQuZW1wdHkKICogQG5hbWUgRmllbGQjZW1wdHkgKi8KRmllbGQuZW1wdHkgPSBuZXcgU3RyaW5nKCk7CgovKiogQ2hlY2tzIGlmIHRoZSBmaWVsZCBjb250YWlucyBhdCBsZWFzdCBvbmUgc3ViZmllbGQsIHRoYXQgbWF0Y2hlcyBhIGNyaXRlcmlhLgogKgogKiBAcGFyYW0ge1JlZ0V4cHxPYmplY3R9IG1hdGNoZXIgQSBSZWdFeHAgdGhhdCBtYXRjaGVzIHRoZSBzdWJmaWVsZCBuYW1lCiAqICAgICAgICAgIG9yIGFuIG9iamVjdCB3aXRoIGEgZnVuY3Rpb24gb2YgdGhlIG5vcm06IGZ1bmN0aW9uIG1hdGNoU3ViRmllbGQoIGZpZWxkLCBzdWJmaWVsZCApLgogKiAgICAgICAgVGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBib29sZWFuIHZhbHVlLgogKgogKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIGEgc3ViIGZpZWxkIG1hdGNoZXMgdGhlIG1hdGNoZXIgYXJndW1lbnQsIEZhbHNlIG90aGVyd2lzZS4KICoKICogQGV4YW1wbGUKIGZ1bmN0aW9uIGhhc1RpdGxlKCBmaWVsZCApIHsKCXJldHVybiBmaWVsZC5leGlzdHMoIC9hLyApOwp9CiAqCiAqIFRoZSBmdW5jdGlvbiBoYXNUaXRsZSBjaGVja3MgaWYgdGhlIHBhc3NlZCBmaWVsZCBjb250YWlucyBhIHN1YiBmaWVsZCB3aXRoIG5hbWUgImEiLgogKgogKiBAbWV0aG9kCiAqIEBuYW1lIEZpZWxkLmV4aXN0cwogKiBAbmFtZSBGaWVsZCNleGlzdHMgKi8KRmllbGQuZXhpc3RzID0gbmV3IFN0cmluZygpOwoKLyoqIEl0ZXJhdGVzIG92ZXIgdGhlIHN1YmZpZWxkcyBhbmQgcmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIGZpcnN0IHN1YmZpZWxkIHRoYXQgbWF0Y2hlcyBhIGNyaXRlcmlhLgogKgogKiBAcGFyYW0ge1JlZ0V4cHxTdHJpbmd8T2JqZWN0fSBtYXRjaGVyIEEgUmVnRXhwIG9yIHN0cmluZyB0aGF0IG1hdGNoZXMgdGhlIHN1YmZpZWxkIG5hbWUKICogICAgICAgICAgb3IgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbiBvZiB0aGUgbm9ybTogZnVuY3Rpb24gbWF0Y2hTdWJGaWVsZCggZmllbGQsIHN1YmZpZWxkICkuCiAqICAgICAgICBUaGUgZnVuY3Rpb24gc2hvdWxkIHJldHVybiBhIGJvb2xlYW4gdmFsdWUuCiAqIEBwYXJhbSB7SGFuZGxlcnxGdW5jdGlvbn0gaGFuZGxlciBUaGUgaGFuZGxlciB0byBjYWxsIGZvciBlYWNoIHN1YmZpZWxkIGZvdW5kCiAqICAgICAgICAgIGJ5IG1hdGNoZXIuCiAqCiAqIEByZXR1cm4gSWYgaGFuZGxlciByZXR1cm5zIGEgdmFsdWUgdGhlbiB0aGF0IHZhbHVlIGlzIHJldHVybmVkIGJ5IEZpZWxkLmZpcnN0U3ViRmllbGQKICoKICogQGV4YW1wbGUKIGZ1bmN0aW9uIGdldFRpdGxlKCBmaWVsZCApIHsKCXJldHVybiBmaWVsZC5maXJzdFN1YkZpZWxkKCAvYS8sIGZ1bmN0aW9uKCBmaWVsZCwgc3ViRmllbGQgKSB7IHJldHVybiBzdWJGaWVsZC52YWx1ZTsgfSApOwp9CiAqCiAqIFRoZSBmdW5jdGlvbiBnZXRUaXRsZSBpcyBwYXNzZWQgYSBmaWVsZCBhbmQgaXRlcmF0ZXMgb3ZlciBzdWJmaWVsZHMgd2l0aCBuYW1lICJhIiBhbmQKICogcmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIGZpcnN0IG9jY3VyZW5jZSBvZiBzdWJmaWVsZCAiYSIuCiAqCiAqIEBtZXRob2QKICogQG5hbWUgRmllbGQuZmlyc3RTdWJGaWVsZAogKiBAbmFtZSBGaWVsZCNmaXJzdFN1YkZpZWxkICovCkZpZWxkLmZpcnN0U3ViRmllbGQgPSBuZXcgU3RyaW5nKCk7CgovKiogUmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIGZpcnN0IHN1YmZpZWxkIHRoYXQgbWF0Y2hlcyBhIG1hdGNoZXIuCiAqCiAqIEBwYXJhbSB7UmVnRXhwfFN0cmluZ3xPYmplY3R9IG1hdGNoZXIgQSBSZWdFeHAgb3Igc3RyaW5nIHRoYXQgbWF0Y2hlcyB0aGUgc3ViZmllbGQgbmFtZQogKiAgICAgICAgICBvciBhbiBvYmplY3Qgd2l0aCBhIGZ1bmN0aW9uIG9mIHRoZSBub3JtOiBmdW5jdGlvbiBtYXRjaFN1YkZpZWxkKCBmaWVsZCwgc3ViZmllbGQgKS4KICogICAgICAgIFRoZSBmdW5jdGlvbiBzaG91bGQgcmV0dXJuIGEgYm9vbGVhbiB2YWx1ZS4KICoKICogQHJldHVybiB7U3RyaW5nfSBJZiBoYW5kbGVyIHJldHVybnMgYSB2YWx1ZSB0aGVuIHRoYXQgdmFsdWUgaXMgcmV0dXJuZWQgYnkgRmllbGQuZmlyc3RTdWJGaWVsZAogKgogKiBAZXhhbXBsZQogZnVuY3Rpb24gZ2V0Rmlyc3RUaXRsZSggZmllbGQgKSB7CglyZXR1cm4gZmllbGQuZ2V0Rmlyc3RWYWx1ZSggL2EvICk7Cn0KICoKICogVGhlIGZ1bmN0aW9uIGdldEZpcnN0VGl0bGUgaXMgcGFzc2VkIGEgbWF0Y2hlciBhbmQgcmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIGZpcnN0IHN1YmZpZWxkIHdpdGggbmFtZSAiYSIuCiAqCiAqIEBtZXRob2QKICogQG5hbWUgRmllbGQuZ2V0Rmlyc3RWYWx1ZQogKiBAbmFtZSBGaWVsZCNnZXRGaXJzdFZhbHVlICovCkZpZWxkLmdldEZpcnN0VmFsdWUgPSBuZXcgU3RyaW5nKCk7CgovKiogSXRlcmF0ZXMgb3ZlciB0aGUgc3ViZmllbGRzIGFuZCByZXR1cm5zIHRoZSB2YWx1ZXMgb2YgYW55IHN1YmZpZWxkIHRoYXQgbWF0Y2hlcyB0aGUgY3JpdGVyaWEuCiAqCiAqIEBwYXJhbSB7UmVnRXhwfE9iamVjdH0gbWF0Y2hlciBBIFJlZ0V4cCB0aGF0IG1hdGNoZXMgdGhlIHN1YiBmaWVsZG5hbWUKICogICAgICAgICAgb3IgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbiBvZiB0aGUgbm9ybTogZnVuY3Rpb24gbWF0Y2hTdWJGaWVsZCggZmllbGQsIHN1YmZpZWxkICkuCiAqICAgICAgICBUaGUgZnVuY3Rpb24gc2hvdWxkIHJldHVybiBhIGJvb2xlYW4gdmFsdWUuCiAqCiAqIEByZXR1cm4ge0FycmF5fSBBbiBhcnJheSB3aXRoIGFsbCB0aGUgZm91bmQgdmFsdWVzLgogKgogKiBAZXhhbXBsZQogZnVuY3Rpb24gZ2V0VGl0bGVzKCBmaWVsZCApIHsKCXJldHVybiBmaWVsZC5nZXRWYWx1ZUFzQXJyYXkoIC9hLyApOwp9CiAqCiAqIFRoZSBmdW5jdGlvbiBnZXRUaXRsZXMgaXMgcGFzc2VkIGEgZmllbGQgYW5kIGl0ZXJhdGVzIG92ZXIgYSBzdWJmaWVsZHMgd2l0aCBuYW1lICJhIiBhbmQKICogcmV0dXJucyB0aGUgdmFsdWVzIG9mIHRoZSBhbGwgc3ViZmllbGQgd2l0aCBuYW1lICJhIgogKgogKiBAbWV0aG9kCiAqIEBuYW1lIEZpZWxkLmdldFZhbHVlQXNBcnJheQogKiBAbmFtZSBGaWVsZCNnZXRWYWx1ZUFzQXJyYXkgKi8KRmllbGQuZ2V0VmFsdWVBc0FycmF5ID0gbmV3IFN0cmluZygpOwoKLyoqIEl0ZXJhdGVzIG92ZXIgdGhlIHN1YmZpZWxkcyBhbmQgcmV0dXJucyB0aGUgdmFsdWVzIG9mIGFueSBzdWJmaWVsZCB0aGF0IG1hdGNoZXMgYSBjcml0ZXJpYS4KICoKICogQHBhcmFtIHtSZWdFeHB8U3RyaW5nfE9iamVjdH0gbWF0Y2hlciBBIFJlZ0V4cCBvciBzdHJpbmcgdGhhdCBtYXRjaGVzIHRoZSBzdWJmaWVsZCBuYW1lCiAqICAgICAgICAgIG9yIGFuIG9iamVjdCB3aXRoIGEgZnVuY3Rpb24gb2YgdGhlIG5vcm06IGZ1bmN0aW9uIG1hdGNoU3ViRmllbGQoIGZpZWxkLCBzdWJmaWVsZCApLgogKiAgICAgICAgVGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBib29sZWFuIHZhbHVlLgogKiBAcGFyYW0ge1N0cmluZ30gc2VwIEEgc2VwYXJhdG9yIHRvIGluc2VydCBiZXR3ZWVuIHRoZSB2YWx1ZXMsIGlmIG1vcmUgdGhhbiBvbmUgaXMgZm91bmQuCiAqCiAqIEByZXR1cm4ge1N0cmluZ30gVGhlIGZvdW5kIHZhbHVlcyBhcyBhIHN0cmluZy4gSWYgbm8gdmFsdWVzIGFyZSBmb3VuZCwgdGhlIGZ1bmN0aW9uIHdpbGwKICogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGUgZW1wdHkgc3RyaW5nLgogKgogKiBAZXhhbXBsZQogLy8gUmV0dXJucyBhbGwgdmFsdWVzIGZyb20gc3ViZmllbGQgImEiIHdpdGhvdXQgYW55IHNlcGFyYXRvci4KIGZ1bmN0aW9uIGdldFRpdGxlcyggZmllbGQgKSB7CglyZXR1cm4gZmllbGQuZ2V0VmFsdWUoICJhIiApOwp9CgogLy8gUmV0dXJucyBhbGwgdmFsdWVzIGZyb20gc3ViIGZpZWxkICJhIiB3aXRoIGEgY29tbWEgc2VwYXJhdG9yLgogZnVuY3Rpb24gZ2V0VGl0bGVzKCBmaWVsZCApIHsKCXJldHVybiBmaWVsZC5nZXRWYWx1ZSggImEiLCAiLCAiICk7Cn0KICoKICogQG1ldGhvZAogKiBAbmFtZSBGaWVsZC5nZXRWYWx1ZQogKiBAbmFtZSBGaWVsZCNnZXRWYWx1ZSAqLwpGaWVsZC5nZXRWYWx1ZSA9IG5ldyBTdHJpbmcoKTsKCi8qKiBJcyB0aGUgZmllbGQgYSBjb250cm9sIGZpZWxkIG9yIG5vdD8uCiAqCiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZmllbGQgaXMgYSBjb250cm9sIGZpZWxkLCBvdGhlcndpc2UgZmFsc2UuCiAqCgogKiBDYWxsIHRoaXMgZnVuY3Rpb24gdG8gZmlndXJlIG91dCBpZiBhIGZpZWxkIGlzIGEgY29udHJvbCBmaWVsZC4KICoKICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgZmllbGQgaXMgYSBjb250cm9sIGZpZWxkLCBmYWxzZSBvdGhlcndpc2UuCiAqIEBtZXRob2QKICogQG5hbWUgRmllbGQuaXNDb250cm9sRmllbGQKICogQG5hbWUgRmllbGQjaXNDb250cm9sRmllbGQgKi8KRmllbGQuaXNDb250cm9sRmllbGQgPSBuZXcgU3RyaW5nKCk7CgovKiogQ2hlY2tzIGlmIGEgbWF0Y2hlciBvbmx5IG1hdGNoZXMgb25lIHN1YmZpZWxkLgogKgogKiBAcGFyYW0ge1JlZ0V4cHxPYmplY3R9IG1hdGNoZXIgQSBSZWdFeHAgdGhhdCBtYXRjaGVzIHRoZSBzdWJmaWVsZCBuYW1lCiAqICAgICAgICAgIG9yIGFuIG9iamVjdCB3aXRoIGEgZnVuY3Rpb24gb2YgdGhlIG5vcm06IGZ1bmN0aW9uIG1hdGNoU3ViRmllbGQoIGZpZWxkLCBzdWJmaWVsZCApLgogKiAgICAgICAgVGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBib29sZWFuIHZhbHVlLgogKgogKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIG9ubHkgb25lIHN1YmZpZWxkIG1hdGNoZXMgbWF0Y2hlciwgRmFsc2Ugb3RoZXJ3aXNlLgogKiBAbWV0aG9kCiAqIEBuYW1lIEZpZWxkLmlzVW5pcXVlCiAqIEBuYW1lIEZpZWxkI2lzVW5pcXVlICovCkZpZWxkLmlzVW5pcXVlID0gbmV3IFN0cmluZygpOwoKLyoqIENoZWNrcyBpZiB0aGUgdmFsdWUgb2Ygb25lIG9yIG1vcmUgc3ViZmllbGRzIG1hdGNoZXMgYSBnaXZlbiB2YWx1ZS4KICoKICogQHBhcmFtIHtSZWdFeHB8U3RyaW5nfE9iamVjdH0gbWF0Y2hlciBBbiBSZWdFeHAgdGhhdCBtYXRjaGVzIHRoZSBzdWIgZmllbGQgbmFtZSBvciBhIHN0cmluZyB0aGF0IG1hdGNoZXMgdGhlIHN1YiBmaWVsZCBuYW1lCiAqICAgICAgICAgIG9yIGFuIG9iamVjdCB3aXRoIGEgZnVuY3Rpb24gb2YgdGhlIG5vcm06IGZ1bmN0aW9uIG1hdGNoU3ViRmllbGQoIGZpZWxkLCBzdWJmaWVsZCApLgogKiAgICAgICAgVGhlIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBib29sZWFuIHZhbHVlLgogKiBAcGFyYW0ge1JlZ0V4cH0gdmFsdWVSZWdFeHAgVGhlIHBhdHRlcm4gdGhhdCB0aGUgdmFsdWUgb2YgdGhlIHN1YmZpZWxkcyBzaG91bGQgbWF0Y2guCiAqCiAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIHZhbHVlIGlzIG1hdGNoZWQsIEZhbHNlIG90aGVyd2lzZS4KICogQG1ldGhvZAogKiBAbmFtZSBGaWVsZC5tYXRjaFZhbHVlCiAqIEBuYW1lIEZpZWxkI21hdGNoVmFsdWUgKi8KRmllbGQubWF0Y2hWYWx1ZSA9IG5ldyBTdHJpbmcoKTsKCi8qKiBSZW1vdmUgYSBzdWJmaWVsZCBmcm9tIGEgZmllbGQuCiAqCiAqIFRoZSBtZXRob2QgZXhpc3RzIGluIHRocmVlIHZlcnNpb25zLCBkZXBlbmRpbmcgb24gdGhlIG51bWJlciBhbmQgdHlwZSBvZiBhcmd1bWVudHMgZ2l2ZW4uCiAqCiAqIElmIGdpdmVuIGEgbnVtZXJpY2FsIGluZGV4LCBpdCByZW1vdmVzIHRoZSBzdWJmaWVsZCBhdCB0aGF0IHBvc2l0aW9uCiAqIGluIHRoZSBmaWVsZHMgaW50ZXJuYWwgcmVwcmVzZW50YXRpb24gb2Ygc3ViZmllbGRzLgogKgogKiBJZiBnaXZlbiBhIG5hbWUsIGl0IHJlbW92ZXMgdGhlIGZpcnN0IHN1YmZpZWxkIGZvdW5kLCB0aGF0IG1hdGNoZXMgdGhlCiAqIGdpdmVuIG5hbWUuCiAqCiAqIElmIGdpdmVuIGEgbmFtZSBhbmQgYW4gaW5kZXggbiwgaXQgcmVtb3ZlcyB0aGUgbid0aCBzdWJmaWVsZCB3aXRoCiAqIHRoZSBnaXZlbiBuYW1lLgogKgogKiBJZiBubyBzdWJmaWVsZCBtYXRjaGVzIHRoZSBwYXJhbWV0ZXJzLCBub3RoaW5nIGhhcHBlbnMuCiAqCiAqICoqTm90ZToqKiBGb3IgdGhlIEMrKyBpbXBsZW1lbnRhdGlvbjogQW55IHJlZmVyZW5jZSB0byBleGlzdGluZwogKiBzdWJmaWVsZHMgb24gdGhpcyByZWNvcmQgbWF5IGJlIGludmFsaWRhdGVkIGJ5IHJlbW92aW5nIGEgc3ViZmllbGQuIFRoaXMKICogaGFzIGEgbnVtYmVyIG9mIHBvdGVudGlhbCBiYWQgY29uc2VxdWVuY2VzLCBtb3N0IG9mIHdoaWNoIGxlYWRzIHRvCiAqIGNyYXNoZXMgb3IgdW5wcmVkaWN0YWJsZSBiZWhhdmlvdXIuIEl0IGlzIGVhc3kgdG8gZmFsbCBpbnRvIHRoZQogKiB0cmFwIG9mIGUuZy4gaXRlcmF0aW5nIGFsbCBzdWJmaWVsZHMgaW4gYSBmaWVsZCwgYW5kIHJlbW92ZSBzb21lIG9mCiAqIHRoZW0uIFRoaXMgaXMgYWxtb3N0IGNlcnRhaW4gdG8gbWFrZSB5b3VyIGFwcGxpY2F0aW9uCiAqIGNyYXNoLiBJbnN0ZWFkLCBjb2xsZWN0IHRoZSBuYW1lcyBvciBpbmRleGVzIG9mIHRoZSBzdWJmaWVsZHMgeW91IHdpc2gKICogdG8gcmVtb3ZlLCB0aGVuIHJlbW92ZSB0aGVtIGFmdGVyIHlvdXIgbWFpbiBpdGVyYXRpb24uCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBzdWJmaWVsZE5hbWUgTmFtZSBvZiBhIHN1YmZpZWxkIHRvIHJlbW92ZQogKiBAcGFyYW0ge251bWJlcn0gW3N1YmZpZWxkTmFtZUluZGV4XSBJbmRleCBvZiBuYW1lZCBzdWJmaWVsZCB0byByZW1vdmUsIHplcm8tYmFzZWQuCiAqIEBleGFtcGxlCiAvLyBSZW1vdmUgdGhlIGZpcnN0IGEgc3ViZmllbGQKIGFGaWVsZC5yZW1vdmUoICJhIiApOwogLy8gUmVtb3ZlIHRoZSBzZWNvbmQgYSBzdWJmaWVsZAogYUZpZWxkLnJlbW92ZSggImEiLCAxICk7CiAqIEBtZXRob2QKICogQG5hbWUgRmllbGQucmVtb3ZlCiAqIEBuYW1lIEZpZWxkI3JlbW92ZSAqLwpGaWVsZC5yZW1vdmUgPSBuZXcgU3RyaW5nKCk7CgovKiogUmVtb3ZlcyBhbGwgc3ViZmllbGRzIHRoYXQgbWF0Y2hlcyBhIG1hdGNoZXIuCiAqCiAqIEBwYXJhbSB7UmVnRXhwfE9iamVjdH0gbWF0Y2hlciBBIFJlZ0V4cCB0aGF0IG1hdGNoZXMgdGhlIHN1YmZpZWxkIG5hbWUKICogICAgICAgICAgb3IgYW4gb2JqZWN0IHdpdGggYSBmdW5jdGlvbiBvZiB0aGUgbm9ybTogZnVuY3Rpb24gbWF0Y2hTdWJGaWVsZCggZmllbGQsIHN1YmZpZWxkICkuCiAqICAgICAgICBUaGUgZnVuY3Rpb24gc2hvdWxkIHJldHVybiBhIGJvb2xlYW4gdmFsdWUuCiAqCiAqIEByZXR1cm4gTm90aGluZy4KICoKICogQG1ldGhvZAogKiBAbmFtZSBGaWVsZC5yZW1vdmVXaXRoTWF0Y2hlcgogKiBAbmFtZSBGaWVsZCNyZW1vdmVXaXRoTWF0Y2hlciAqLwpGaWVsZC5yZW1vdmVXaXRoTWF0Y2hlciA9IG5ldyBTdHJpbmcoKTsKCi8qKiBSZXR1cm5zIHRoZSBudW1iZXIgb2Ygc3ViZmllbGRzIGluIHRoaXMgZmllbGQuCiAqCiAqIFRoaXMgZnVuY3Rpb24gaXMgYSBzaG9ydGN1dCBmb3IgRmllbGQuY291bnQoKS4KICoKICogQHJldHVybiB7bnVtYmVyfSBUaGUgbnVtYmVyIG9mIHN1YmZpZWxkcyBpbiB0aGlzIGZpZWxkLiBHcmVhdGVyIG9yIGVxdWFsIHRvIDAuCiAqCiAqIEBtZXRob2QKICogQG5hbWUgRmllbGQuc2l6ZQogKiBAbmFtZSBGaWVsZCNzaXplICovCkZpZWxkLnNpemUgPSBuZXcgU3RyaW5nKCk7CgovKiogR2V0IGEgcmVmZXJlbmNlIHRvIGEgc3ViZmllbGQgaW4gdGhlIGZpZWxkLgogKgogKiBHaXZlbiB0aGUgaW5kZXggb2YgYSBzdWJmaWVsZCwgb3IgYSBzdWJmaWVsZE5hbWUsIG9yIGEgc3ViZmllbGROYW1lIGFuZCBhbgogKiBpbmRleCwgcmV0dXJuIGEgcmVmZXJlbmNlIHRvIGEgc3ViZmllbGQuCiAqCiAqIFRoaXMgaXMgdGhlIHByaW1hcnkgbWV0aG9kIHRvIGdldCBhY2Nlc3MgdG8gdGhlIHN1YmZpZWxkcyBvZiBhCiAqIGZpZWxkLiBUaGUgbWV0aG9kIGV4aXN0cyBpbiB0aHJlZSB2ZXJzaW9ucywgZGVwZW5kaW5nIG9uIHRoZQogKiBudW1iZXIgYW5kIHR5cGUgb2YgYXJndW1lbnRzIGdpdmVuLgogKgogKiBJZiBnaXZlbiBhIG51bWVyaWNhbCBpbmRleCBvbmx5LCBpdCByZXR1cm5zIHRoZSBzdWJmaWVsZCBhdCB0aGF0IHBvc2l0aW9uCiAqIGluIHRoZSBmaWVsZCdzIGludGVybmFsIHJlcHJlc2VudGF0aW9uIG9mIHN1YmZpZWxkcy4gVGhpcyBpcyBwcm9iYWJseQogKiBvbmx5IHVzZWZ1bCBpbiBjb25qdW5jdGlvbiB3aXRoIGUuZy4gbG9vcGluZyB0aHJvdWdoIGFsbCBzdWJmaWVsZHMgaW4KICogdGhlIGZpZWxkLgogKgogKiBJZiBnaXZlbiBhIG5hbWUsIGl0IHJldHVybnMgdGhlIGZpcnN0IHN1YmZpZWxkIGZvdW5kLCB0aGF0IG1hdGNoZXMgdGhlCiAqIGdpdmVuIG5hbWUuCiAqCiAqIElmIGdpdmVuIGEgbmFtZSBhbmQgYW4gaW5kZXggbiwgaXQgcmV0dXJucyB0aGUgbid0aCBzdWJmaWVsZCB3aXRoCiAqIHRoZSBnaXZlbiBuYW1lLgogKgogKiBOb3RlLCB0aGF0IGlmIHRoZSBzdWJmaWVsZCBpcyBub3QgZm91bmQsIGFuIGVtcHR5IHN1YmZpZWxkIGlzCiAqIHJldHVybmVkLiBUaGlzIHN1YmZpZWxkIGlzIG5vdCBwYXJ0IG9mIHRoZSByZWNvcmQuCiAqCiAqIEBwYXJhbSB7TnVtYmVyfFN0cmluZ30gc3ViZmllbGRJbmRleE9yU3ViZmllbGROYW1lIEluZGV4IG9mIHN1YmZpZWxkIHRvIGZpbmQsIHplcm8tYmFzZWQsIG9yIG5hbWUgb2YgYSBzdWJmaWVsZCB0byBmaW5kLgogKiBAcGFyYW0ge051bWJlcn0gW3N1YmZpZWxkTmFtZUluZGV4XSBJbmRleCBvZiBuYW1lZCBzdWJmaWVsZCB0byBmaW5kLCB6ZXJvLWJhc2VkLiAqT25seSBhbGxvd2VkIGlmIGZpcnN0IGFyZ3VtZW50IGlzIGEgc3ViZmllbGROYW1lLioKICogQHJldHVybiB7U3ViZmllbGR9IEEgcmVmZXJlbmNlIHRvIGEgc3ViZmllbGQsIG9yIGFuIGVtcHR5IHN1YmZpZWxkLCBpZiBub3QgZm91bmQuCiAqIEBleGFtcGxlCiAvL2V4YW1wbGUgcmVjb3JkIGFuZCBmaWVsZAogdmFyIGV4YW1wbGVSZWNvcmQgPSBuZXcgUmVjb3JkOwogdmFyIGV4YW1wbGVGaWVsZCA9IG5ldyBGaWVsZCAoICIyNjAiLCAiMDAiICk7CiBleGFtcGxlRmllbGQuYXBwZW5kICggImEiLCAiS2Fzc2VsIiApOwogZXhhbXBsZUZpZWxkLmFwcGVuZCAoICJiIiwgIkJhcmVucmVpdGVyIiApOwogZXhhbXBsZUZpZWxkLmFwcGVuZCAoICJhIiwgIlN0dXR0Z2FydCIgKTsKIGV4YW1wbGVGaWVsZC5hcHBlbmQgKCAiYiIsICJNZXR6bGVyIiApOwogZXhhbXBsZUZpZWxkLmFwcGVuZCAoICJjIiwgIjE5OTQtIiApOwogZXhhbXBsZVJlY29yZC5hcHBlbmQgKCBleGFtcGxlRmllbGQgKTsKCiAvLyBHZXQgdGhlIHRoaXJkIHN1YmZpZWxkIGluIHRoZSBleGFtcGxlIGZpZWxkCiB2YXIgczEgPSBleGFtcGxlRmllbGQuc3ViZmllbGQoIDIgKTsgLy88LS0gdGhpcyByZWZlcnMgdG8gc3ViZmllbGQgImEiIHdpdGggdGhlIHZhbHVlICJTdHV0dGdhcnQiCgogLy8gQmUgYXdhcmUgaWYgeW91IHVzZSBvbmx5IHRoZSBuYW1lIG9mIHRoZSBzdWJmaWVsZCBhbmQgdGhlcmUgaXMgbW9yZSB0aGFuIG9uZSBvZiB0aGF0IHN1YmZpZWxkCiAvLyB5b3Ugd2lsbCBnZXQgYSByZWZlcmVuY2UgdG8gdGhlIGZpcnN0IHN1YmZpZWxkCiB2YXIgczIgPSBleGFtcGxlRmllbGQuc3ViZmllbGQoICJhIiApOyAvLzwtLSB0aGlzIHJlZmVycyB0byBzdWJmaWVsZCAiYSIgd2l0aCB0aGUgdmFsdWUgIkthc3NlbCIKCiAvLyBHZXQgdGhlIHNlY29uZCAiYiIgc3ViZmllbGQKIHZhciBzMyA9IGV4YW1wbGVGaWVsZC5zdWJmaWVsZCggImIiLCAxICk7ICAvLzwtLSB0aGlzIHJlZmVycyB0byBzdWJmaWVsZCAiYiIgd2l0aCB0aGUgdmFsdWUgIk1ldHpsZXIiCgogLy8gQmUgYXdhcmUgaWYgeW91IHJlZmVyIHRvIGEgc3ViZmllbGQgd2l0aCBuYW1lIGFuZCBpbmRleCB0aGF0IGlzIG5vdCB0aGVyZSB5b3UgZ2V0IGFuIGVtcHR5IHN1YmZpZWxkCiB2YXIgczQgPSBleGFtcGxlRmllbGQuc3ViZmllbGQoICJiIiwgMiApOyAvLyA8LS0gdGhpcyByZWZlcnMgdG8gYW4gZW1wdHkgc3ViZmllbGQsIGJlY2F1c2UgdGhlcmUgYXJlIG9ubHkgdHdvIHN1YmZpZWxkICJiIiBpbiB0aGlzIGZpZWxkCgogLy8gQ29tYmluaW5nIG1ldGhvZCBmaWVsZCBmcm9tIFJlY29yZCBhbmQgbWV0aG9kIHN1YmZpZWxkIGZyb20gRmllbGQKIHZhciBzNSA9IGV4YW1wbGVSZWNvcmQuZmllbGQoICIyNjAiICkuc3ViZmllbGQoICJjIiApOyAvLyA8LS0gdGhpcyByZWZlcnMgdG8gdGhlIGZpcnN0IHN1YmZpZWxkICJjIiBpbiB0aGUgZmlyc3QgZmllbGQgIjI2MCIgaW4gdGhlIGV4YW1wbGUgcmVjb3JkCgogKiBAbWV0aG9kCiAqIEBuYW1lIEZpZWxkLnN1YmZpZWxkCiAqIEBuYW1lIEZpZWxkI3N1YmZpZWxkICovCkZpZWxkLnN1YmZpZWxkID0gbmV3IFN0cmluZygpOwoKLyoqIEdldCBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgRmllbGQuCiAqCiAqIFRoaXMgbWV0aG9kIHJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGZpZWxkLCBpbiBhCiAqIGZvcm1hdCB2ZXJ5IGNsb3NlIHRvIGEgc3RhbmRhcmQgTWFyYyBsaW5lIGZvcm1hdC4KICoKICogSWYgdGhlIGZpZWxkIGlzIGEgY29udHJvbCBmaWVsZCwgaXQgd2lsbCByZXR1cm4gYSBzdHJpbmcKICogY29uc3RydWN0ZWQgZnJvbSBpdHMgbmFtZSBhbmQgaXRzIHZhbHVlLiBJZiB0aGUgZmllbGQgaXMgYSBub3JtYWwKICogZmllbGQsIGl0IHdpbGwgYnVpbGQgYSBzdHJpbmcgZnJvbSBpdHMgbmFtZSwgdGhlIGluZGljYXRvciwgYW5kIHRoZQogKiBjb21iaW5lZCByZXN1bHRzIGZyb20gY2FsbGluZyB0b1N0cmluZyBvbiBhbGwgaXRzIHN1YmZpZWxkcy4KICoKICogTm90ZSB0aGF0IHRoZSBjaGFyYWN0ZXJzICJAIiBhbmQgIlwqIiBhcmUgY29udmVydGVkIHRvICJAQCIgYW5kCiAqICJAXCoiIHJlc3BlY3RpdmVseSwgaW4gdGhlIHJlc3VsdCBmcm9tIHRvU3RyaW5nLgogKgogKiBAcmV0dXJuIHtzdHJpbmd9IEEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBmaWVsZC4KICogQG1ldGhvZAogKiBAbmFtZSBGaWVsZC50b1N0cmluZwogKiBAbmFtZSBGaWVsZCN0b1N0cmluZyAqLwpGaWVsZC50b1N0cmluZyA9IG5ldyBTdHJpbmcoKTsKCgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vIFNVQkZJRUxECi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLyoqIEEgc3ViZmllbGQgaW4gYSBNYXJjIHJlY29yZC4KICoKICogVGhlIFN1YmZpZWxkIGNsYXNzIGlzIGFuIGFic3RyYWN0aW9uIGZvciBhIFN1YmZpZWxkIGluIGEgTWFyYwogKiByZWNvcmQuIEl0IGNvbnRhaW5zIGEgbmFtZSwgdmFsdWUgYW5kIGEgdG9TdHJpbmcgbWV0aG9kLCBhbmQgYXMKICogc3VjaCBpcyBhIHByZXR0eSBzaW1wbGUgYWJzdHJhY3Rpb24uCiAqCiAqIFlvdSBjYW4gY29uc3RydWN0IGEgc3ViZmllbGQgaW5zdGFuY2Ugb25seSBieSBnaXZpbmcgaXQgYSBuYW1lIGFuZAogKiBhIHZhbHVlIGFzIHBhcmFtZXRlcnMgdG8gdGhlIGNvbnN0cnVjdG9yLgogKgogKiBAZXhhbXBsZQogLy8gQ29uc3RydWN0IGEgc3ViZmllbGQKIHZhciBzdWJmaWVsZCA9IG5ldyBTdWJmaWVsZCggImEiLCAiSSBhbSBhIHN1YmZpZWxkIiApOwogKiBAcGFyYW0ge1N0cmluZ30gc3ViZmllbGROYW1lXSBOYW1lIG9mIHRoZSBuZXcgc3ViZmllbGQuCiAqIEBwYXJhbSB7U3RyaW5nfSBzdWJmaWVsZFZhbHVlIFZhbHVlIG9mIHRoZSBuZXcgc3ViZmllbGQKICogQGNvbnN0cnVjdG9yCiAqIEBzZWUgTWFyY0NsYXNzZXMKICogQHNlZSBSZWNvcmQKICogQHNlZSBGaWVsZAogKiBAbmFtZSBTdWJmaWVsZCAqLwovLyBEbyBub3QgcmVtb3ZlIHRoaXMgY29tbWVudAoKLy8gUFJPUEVSVElFUwoKLyoqIFRoZSBuYW1lIG9mIHRoZSBzdWJmaWVsZC4KICoKICogVGhpcyBwcm9wZXJ0eSBob2xkcyB0aGUgbmFtZSBvZiB0aGUgc3ViZmllbGQuCiAqCiAqIEB0eXBlIHtzdHJpbmd9CiAqIEBuYW1lIFN1YmZpZWxkLm5hbWUKICogQG5hbWUgU3ViZmllbGQjbmFtZSAqLwpTdWJmaWVsZC5uYW1lID0gbmV3IFN0cmluZygpOwoKLyoqIFRoZSB2YWx1ZSBvZiB0aGUgc3ViZmllbGQuCiAqCiAqIFRoaXMgcHJvcGVydHkgaG9sZHMgdGhlIHZhbHVlIG9mIHRoZSBzdWJmaWVsZC4KICoKICogQHR5cGUge1N0cmluZ30KICogQG5hbWUgU3ViZmllbGQudmFsdWUKICogQG5hbWUgU3ViZmllbGQjdmFsdWUgKi8KU3ViZmllbGQudmFsdWUgPSBuZXcgU3RyaW5nKCk7CgovLyBNRVRIT0RTCgovKiogR2V0IGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBzdWJmaWVsZC4KICoKICogVGhpcyBtZXRob2QgcmV0dXJucyBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3ViZmllbGQsIGluIGEKICogZm9ybWF0IHZlcnkgY2xvc2UgdG8gYSBzdGFuZGFyZCBNYXJjIGxpbmUgZm9ybWF0LiBUaGlzIG1lYW5zLCB0aGF0CiAqIHRoZSBjaGFyYWN0ZXJzICJAIiBhbmQgIlwqIiBhcmUgY29udmVydGVkIHRvICJAQCIgYW5kICJAXCoiIHJlc3BlY3RpdmVseS4KICoKICogQHJldHVybiB7U3RyaW5nfSBBIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3ViZmllbGQuCiAqIEBtZXRob2QKICogQG5hbWUgU3ViZmllbGQudG9TdHJpbmcKICogQG5hbWUgU3ViZmllbGQjdG9TdHJpbmcgKi8KU3ViZmllbGQudG9TdHJpbmcgPSBuZXcgU3RyaW5nKCk7CgovKioKICogUmV0dXJucyBhIGNsb25lIChjb3B5KSBvZiB0aGlzIFN1YmZpZWxkCiAqCiAqIEByZXR1cm4ge1N1YmZpZWxkfSBUaGUgbmV3IFN1YmZpZWxkIHRoYXQgaXMgYW4gZW50aXJlIGNsb25lIG9mIHRoaXMgc3ViZmllbGQuCiAqCiAqIEBtZXRob2QKICogQG5hbWUgU3ViZmllbGQuY2xvbmUKICogQG5hbWUgU3ViZmllbGQjY2xvbmUgKi8KU3ViZmllbGQuY2xvbmUgPSBuZXcgU3RyaW5nKCk7Cg==", "moduleName": "MarcClasses"}, {"javascript": "LyoqIEBmaWxlIFN5c3RlbSBtb2R1bGUuIFByb3ZpZGVzIFN5c3RlbSBjbGFzcywgdGhhdCBjYW4gYmUgcG9wdWxhdGVkIGJ5IG90aGVyIG1vZHVsZXMuICovCkVYUE9SVEVEX1NZTUJPTFMgPSBbICdTeXN0ZW0nIF07CgovKioKICogUHJvdmlkZXMgYSBuYW1lc3BhY2UgdG8gYWRkIGxvd2xldmVsL3N5c3RlbSBsaWtlIGZ1bmN0aW9uYWxpdHkgdG8uCiAqIAogKiBNZXRob2RzIGFuZCBtb2R1bGVzIHJlbGF0ZWQgdG8gbG93LWxldmVsIHN0dWZmIGlzIGFkZGVkIGludG8gdGhpcwogKiBuYW1lc3BhY2UuIAogKgogKiBUbyBhY3R1YWxseSB1c2UgbW9zdCBvZiB0aGUgZnVuY3Rpb25zIGluIHRoaXMgbmFtZXNwYWNlLCB5b3UgbmVlZAogKiB0byBsb2FkIGFkZGl0aW9uYWwgbW9kdWxlcy4gRS5nLiB0byBiZSBhYmxlIHRvIHVzZSB0aGUgCiAqIHtAbGluayBTeXN0ZW0ucmVhZEZpbGV9IGZ1bmN0aW9uLCB5b3UgbXVzdCB1c2UgdGhlIG1vZHVsZSBgUmVhZEZpbGVgLiB0bwogKiB1c2UgdGhlIHtAbGluayBTeXN0ZW0ucHJpbnR9IGZ1bmN0aW9uIHlvdSBtdXN0IHVzZSB0aGUgbW9kdWxlCiAqIGBQcmludGAuIEZvciBhbGwgZnVuY3Rpb25zLCBpdCBpcyBpbmRpY2F0ZWQgd2hpY2ggbW9kdWxlIHRoZXkgYXJlCiAqIHBhcnQgb2YsIHRoYXQgaXMsIHdoaWNoIG1vZHVsZSB5b3Ugc2hvdWxkIHVzZSB0byBnZXQgYWNjZXNzIHRvIHRoZQogKiBmdW5jdGlvbi4KICogCiAqIEBuYW1lc3BhY2UgCiAqIEBuYW1lIFN5c3RlbSAqLwp2YXIgU3lzdGVtID0gZnVuY3Rpb24oICkgewogICAgdmFyIHRoYXQgPSB7fTsKCiAgICAvKioKICAgICAqIEFycmF5IGNvbnRhaW5pbmcgYXJndW1lbnRzIHBhc3NlZCB0byB0aGUgc3lzdGVtLCBpZiBpbnZva2VkIGludGVyYWN0aXZlbHkuCiAgICAgKiAKICAgICAqIENvbnRhaW5zIGFueSBhcmd1bWVudHMgcGFzc2VkIHRvIHRoZSBzeXN0ZW0sIGlmIHVzZWQgaW50ZXJhY3RpdmVseS4gSXMKICAgICAqIGFuIGVtcHR5IGFycmF5IGlmIG5vdC4gCiAgICAgKgogICAgICogQGV4YW1wbGUKLy8gR2V0IHRoZSBmaXJzdCBhcmd1bWVudCB0byBhIHNjcmlwdCB3aGVuIGNhbGxlZCBpbiBhIHNoZWxsCnVzZSggIlN5c3RlbSIgKTsKaWYgKCBTeXN0ZW0uYXJndW1lbnRzLmxlbmd0aCA+IDAgKSB7CiAgdmFyIGZpcnN0QXJnID0gU3lzdGVtLmFyZ3VtZW50c1swXTsKfQogICAgICoKICAgICAqIEBuYW1lIFN5c3RlbS5hcmd1bWVudHMKICAgICAqIEB0eXBlIHtTdHJpbmdbXX0KICAgICAqIEBwcm9wZXJ0eSAqLwogICAgdGhhdC5hcmd1bWVudHMgPSBbIF07CgogICAgLyoqIAogICAgICogU3RyaW5nIGNvbnRhaW5pbmcgdGhlIG5hbWUgb2YgdGhlIGNhbGxlZCBzY3JpcHQsIGlmIGludm9rZWQgaW50ZXJhY3RpdmVseS4KICAgICAqIAogICAgICogQGV4YW1wbGUKLy8gUHJpbnQgdGhlIG5hbWUgb2YgdGhlIGNhbGxpbmcgc2NyaXB0CnVzZSggIlN5c3RlbSIgKTsKdXNlKCAiUHJpbnQiICk7CnByaW50KCBTeXN0ZW0uc2NyaXB0bmFtZSArICJcbiIgKTsKICAgICAqIAogICAgICogQG5hbWUgU3lzdGVtLnNjcmlwdG5hbWUKICAgICAqIEB0eXBlIHtTdHJpbmd9CiAgICAgKiBAcHJvcGVydHkgKi8KICAgIHRoYXQuc2NyaXB0bmFtZSA9ICIiOwoKICAgIC8qKiBQcm9wZXJ0eSB0byBkZWZpbmUgdGhlIFJoaW5vIHBsYXRmb3JtLgogICAgICogQG5hbWUgU3lzdGVtLnBsYXRmb3JtX3JoaW5vCiAgICAgKiBAdHlwZSB7U3RyaW5nfQogICAgICogQHByb3BlcnR5ICovCiAgICB0aGF0LnBsYXRmb3JtX3JoaW5vID0gIlJoaW5vIjsKCiAgICAvKiogUHJvcGVydHkgdG8gZGVmaW5lIHRoZSBTcGlkZXJNb25rZXkgcGxhdGZvcm0uCiAgICAgKiBAbmFtZSBTeXN0ZW0ucGxhdGZvcm1fc3BpZGVybW9ua2V5CiAgICAgKiBAdHlwZSB7U3RyaW5nfQogICAgICogQHByb3BlcnR5ICovCiAgICB0aGF0LnBsYXRmb3JtX3NwaWRlcm1vbmtleSA9ICJTcGlkZXJNb25rZXkiOwoKICAgIC8qKgogICAgICogR2V0IHRoZSBuYW1lIG9mIHRoZSBwbGF0Zm9ybSB3ZSBhcmUgY3VycmVudGx5IHJ1bm5pbmcgdW5kZXIuCiAgICAgKgogICAgICogVGhpcyByZXR1cm5zIHRoZSBuYW1lIG9mIG91ciBwbGF0Zm9ybSwgb25lIG9mICJSaGlubyIgb3IgIlNwaWRlck1vbmtleSIuCiAgICAgKiBUaGlzIG1ldGhvZCBpcyBtZWFudCBmb3IgdGhlIHZlcnkgcmFyZSBzaXR1YXRpb25zIHdoZXJlIHdlIGhhdmUgdG8gZG8KICAgICAqIHNvbWV0aGluZyBzbGlnaHRseSBkaWZmZXJlbnQgZGVwZW5kaW5nIG9uIHBsYXRmb3JtLCBpbiBvcmRlciB0byAKICAgICAqIHdvcmsgYXJvdW5kIGRpZmZlcmVuY2VzLgogICAgICoKICAgICAqIFVzZSB0aGUgcHJvcGVydGllcyBwbGF0Zm9ybV9yaGlubyBhbmQgcGxhdGZvcm1fc3BpZGVybW9ua2V5IHRvCiAgICAgKiBjaGVjayBhZ2FpbnN0IHRoaXMgcHJvcGVydHkuCiAgICAgKgogICAgICogKipOb3RlOioqIE1vcmUgcGxhdGZvcm1zIG1heSBiZSBhZGRlZCBpbiB0aGUgZnV0dXJlLiBBbHdheXMKICAgICAqIGNoZWNrIGV4cGxpY2l0bHkgZm9yIGEgc3BlY2lmaWMgcGxhdGZvcm0uCgogICAgICogKipOb3RlOioqIE9OTFkgVVNFIFRISVMgTUVUSE9EIEFTIEEgTEFTVCBSRVNPUlQuIFRoZSBwbGF0Zm9ybXMgYmVoYXZlIGFsbW9zdCAKICAgICAqIGV4YWN0bHkgdGhlIHNhbWUsIGFuZCB0aGUgY29kZSBzaG91bGQgbm90IGJlIHNwcmlua2xlZCB3aXRoICJpZiBwbGF0Zm9ybSB0aGVuIi4KICAgICAqIEl0IGlzIHN1c3BlY3RlZCB0aGlzIGlzIG9ubHkgbmVlZGVkIGZvciBFNFggY29kZSB0aGF0IGlzIGJyb2tlbiBhbnl3YXkuCiAgICAgKiBJZiB5b3UgdXNlIHRoaXMgZnVuY3Rpb24sIGF0IGxlYXN0IHdyYXAgaXQgaW4gYSBsaWJyYXJ5L21vZHVsZSBzdWNoIHRoYXQKICAgICAqIHlvdSBjYW4gY2hhbmdlIHRoZSBpbXBsZW1lbnRhdGlvbiBsYXRlciwgd2l0aG91dCBicmVha2luZyB0aGUgaW50ZXJmYWNlLgogICAgICogIAogICAgICogQG5hbWUgU3lzdGVtLnBsYXRmb3JtCiAgICAgKiBAdHlwZSB7U3RyaW5nfQogICAgICogQHByb3BlcnR5ICovCiAgICB0aGF0LnBsYXRmb3JtICA9IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICggKCB0eXBlb2YgUGFja2FnZXMgPT09ICJvYmplY3QiICkgJiYgKCB0eXBlb2YgUGFja2FnZXMuamF2YSA9PT0gIm9iamVjdCIgKSApIHsKICAgICAgICAgICAgcmV0dXJuICJSaGlubyI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuICJTcGlkZXJNb25rZXkiOwogICAgICAgIH0KICAgIH0oKTsgLy8gTm90ZSwgbm90IGEgZnVuY3Rpb24sIGEgdmFsdWUuCgoKICAgIHJldHVybiB0aGF0Owp9KCApOwo=", "moduleName": "System"}, {"javascript": "Ly8gUHVyZSBKYXZhU2NyaXB0IGltcGxlbWVudGF0aW9uIG9mIFJlY29yZCwgRmllbGQgYW5kIFN1YmZpZWxkIGNsYXNzZXMuCi8vIFBsYWNlZCBpbiBqYXZhY29yZSBmb3Igbm93LCB0byBhdm9pZCBjbGFzaGVzIHdpdGggdGhlIEMrKyBpbXBsZW1lbnRhdGlvbi4KCi8vIE5vdGUsIHRoZSBkb2N1bWVudGF0aW9uIG9mIHRoZXNlIGNsYXNzZXMgaXMgdGhlIE1hcmNDbGFzc2VzLnVzZS5qcwovLyBtb2R1bGUsIHN1Y2ggdGhhdCBpdCBjYW4gYmUgc2hhcmVkIGJldHdlZW4gdGhlIEphdmEgYW5kIEMrKwovLyBpbXBsZW1lbnRhdGlvbnMuCgp1c2UoIkxvZyIpOwoKRVhQT1JURURfU1lNQk9MUyA9IFsgIlJlY29yZCIsICJGaWVsZCIsICJTdWJmaWVsZCIgXTsKCi8vIFRoZSBwYXR0ZXJuIHVzZWQgdG8gY3JlYXRlIFJlY29yZCwgRmllbGQgYW5kIFN1YmZpZWxkIG9iamVjdHMgaW4KLy8gdGhpcyBtb2R1bGUgZGlmZmVycyBmcm9tIG1vc3Qgb3RoZXIgbW9kdWxlcyBpbiBEQkMsIGJlY2F1c2UgaXQgaXMgYQovLyB0cnVlIGNvbnN0cnVjdG9yIHRoYXQgd2Ugd2lzaCBmb3IsIHdoaWNoIGNhbiBiZSBjYWxsZWQgbXVsdGlwbGUKLy8gdGltZXMuCgp2YXIgU3ViZmllbGQgPSAoZnVuY3Rpb24gKCkgewogICAgdmFyIFN0YW5kYXJkQ2hhcnNldHMgPSBQYWNrYWdlcy5qYXZhLm5pby5jaGFyc2V0LlN0YW5kYXJkQ2hhcnNldHM7CiAgICB2YXIgU3RyaW5nID0gUGFja2FnZXMuamF2YS5sYW5nLlN0cmluZzsKICAgIHZhciBEYW5NYXJjMkNoYXJzZXQgPSBQYWNrYWdlcy5kay5kYmMubWFyYy5EYW5NYXJjMkNoYXJzZXQ7CiAgICB2YXIgZGFuTWFyYzJDaGFyc2V0ID0gbmV3IERhbk1hcmMyQ2hhcnNldCgpOwogICAgdmFyIHRvRG0yID0gZnVuY3Rpb24gKHMpIHsKICAgICAgICByZXR1cm4gIiIgKyBuZXcgU3RyaW5nKG5ldyBTdHJpbmcocykuZ2V0Qnl0ZXMoZGFuTWFyYzJDaGFyc2V0KSwgU3RhbmRhcmRDaGFyc2V0cy5JU09fODg1OV8xKTsKICAgIH07CgogICAgcmV0dXJuIGZ1bmN0aW9uIChuYW1lYXJnLCB2YWx1ZWFyZykgewogICAgICAgIC8vIGNoZWNraW5nIHRoYXQgd2UgYXJlIGNhbGxlZCB3aXRoIGV4YWN0bHkgdHdvIGFyZ3VtZW50cywgaWYgbm90IHRocm93IGV4Y2VwdGlvbgogICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoICE9IDIpIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoInN1YmZpZWxkIG11c3QgYmUgaW5pdGlhbGl6ZWQgd2l0aCBleGFjdGx5IDIgYXJndW1lbnRzIik7CiAgICAgICAgICAgIC8qIENvbW1lbnRlZCBvdXQsIHBlbmRpbmcgZXhjZXB0aW9uIG1vZHVsZSBpbXBsZW1lbnRhdGlvbi4gIDA4LTA2LTEyLSBNdnMKICAgICAgICAgICAgICogewogICAgICAgICAgICAgKiAgICAgbmFtZTogJ2luaXRpYWxpemF0aW9uRXJyb3InLCAgIAogICAgICAgICAgICAgKiAgICAgbWVzc2FnZTonc3ViZmllbGQgbXVzdCBiZSBpbml0aWFsaXplZCB3aXRoIGV4YWN0bHkgMiBhcmd1bWVudHMnCiAgICAgICAgICAgICAqIH07CQogICAgICAgICAgICAgKi8KICAgICAgICB9CgogICAgICAgIC8vIEVuY2Fwc3VsYXRlIG9iamVjdAogICAgICAgIHZhciB0aGF0ID0gT2JqZWN0LmNyZWF0ZShTdWJmaWVsZC5wcm90b3R5cGUpOwoKICAgICAgICAvLyBQcml2YXRlIHZhbHVlIG9mIG5hbWUgYW5kIHZhbHVlCiAgICAgICAgdmFyIG5hbWUgPSBuYW1lYXJnOwogICAgICAgIHZhciB2YWx1ZSA9IHZhbHVlYXJnOwoKICAgICAgICB0aGF0Ll9fZGVmaW5lR2V0dGVyX18oIm5hbWUiLCBmdW5jdGlvbiAoICkgewogICAgICAgICAgICByZXR1cm4gbmFtZTsKCiAgICAgICAgfSk7CiAgICAgICAgdGhhdC5fX2RlZmluZVNldHRlcl9fKCJuYW1lIiwgZnVuY3Rpb24gKHZhbCkgewogICAgICAgICAgICBuYW1lID0gdmFsOwogICAgICAgIH0pOwoKICAgICAgICB0aGF0Ll9fZGVmaW5lR2V0dGVyX18oInZhbHVlIiwgZnVuY3Rpb24gKCApIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwoKICAgICAgICB9KTsKICAgICAgICB0aGF0Ll9fZGVmaW5lU2V0dGVyX18oInZhbHVlIiwgZnVuY3Rpb24gKHZhbCkgewogICAgICAgICAgICB2YWx1ZSA9IHZhbDsKICAgICAgICB9KTsKCiAgICAgICAgLy8gRnVuY3Rpb24gdGhhdCByZXR1cm5zIGVpdGhlciBuYW1lIG9yIG5hbWUgYW5kIHZhbHVlLgogICAgICAgIC8vIElmIHZhbHVlIGlzIHVuZGVmaW5lZCBvciBlbXB0eSB3aGVuIHRoZSBmdW5jdGlvbiBpcyBjYWxsZWQsIG9ubHkgbmFtZSBpcyByZXR1cm5lZC4KICAgICAgICB0aGF0LnRvU3RyaW5nID0gZnVuY3Rpb24gKCApIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gInVuZGVmaW5lZCIgfHwgdmFsdWUgPT09ICIiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIioiICsgdG9EbTIobmFtZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIioiICsgdG9EbTIobmFtZSkgKyAiICIgKyB0b0RtMih2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHJldHVybiB0aGF0OwogICAgfTsKfSkoKTsKCgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyBGaWVsZCBpbXBsZW1lbnRhdGlvbgovLyBhcnJheSBvZiBzdWJmaWVsZHMKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KdmFyIEZpZWxkID0gZnVuY3Rpb24oIG5hbWVhcmcsIGluZGljYXRvcmFyZyApIHsKCiAgICAvLyBjaGVja2luZyB0aGF0IHdlIGFyZSBjYWxsZWQgd2l0aCBleGFjdGx5IHplcm8gb3IgdHdvIGFyZ3VtZW50cywgaWYgbm90IHRocm93IGV4Y2VwdGlvbgogICAgaWYgKCBhcmd1bWVudHMubGVuZ3RoICE9IDIgJiYgYXJndW1lbnRzLmxlbmd0aCAhPT0gMCApIHsKICAgICAgICB0aHJvdyBFcnJvciggIkZpZWxkIG11c3QgYmUgaW5pdGlhbGl6ZWQgd2l0aCBleGFjdGx5IDAgb3IgMiBhcmd1bWVudHMiICk7CgogICAgICAgIC8qIENvbW1lbnRlZCBvdXQsIHBlbmRpbmcgZXhjZXB0aW9uIG1vZHVsZSBpbXBsZW1lbnRhdGlvbi4gIDA4LTA2LTEyLSBNdnMKCQl7CiAgICAgICAgbmFtZTogJ2luaXRpYWxpemF0aW9uRXJyb3InLAogICAgICAgICAgICAgICAgICBtZXNzYWdlOidGaWVsZCBtdXN0IGJlIGluaXRpYWxpemVkIHdpdGggZXhhY3RseSAwIG9yIDIgYXJndW1lbnRzJwogICAgICAgICAgICAgICAgICB9OyovCiAgICB9CiAgICAvLyBFbmNhcHN1bGF0ZSBvYmplY3QKICAgIHZhciB0aGF0ID0gT2JqZWN0LmNyZWF0ZSggRmllbGQucHJvdG90eXBlICk7CgogICAgdmFyIHN1YmZpZWxkQXJyYXkgPSBbIF07IC8vdXNlZCBmb3Igc3RvcmluZyB0aGUgc3ViZmllbGRzCgogICAgdmFyIGlzQ29udHJvbEZpZWxkQm9vbCA9IGZhbHNlOyAvLyBVc2VkIHRvIGRldGVybWluZSBpZiBmaWVsZCBpcyBhIGNvbnRyb2wgZmllbGQKICAgIHZhciB2YWx1ZSA9ICIiOyAvLyBPbmx5IHZhbGlkIGlmCgogICAgLy8gUHJpdmF0ZSB2YWx1ZSBvZiBuYW1lIGFuZCB2YWx1ZQogICAgdmFyIG5hbWUgPSBuYW1lYXJnOwogICAgdmFyIGluZGljYXRvciA9IGluZGljYXRvcmFyZzsKCiAgICAvKioKICAgICAqIEludGVybmFsIGhlbHBlcgogICAgICovCiAgICB2YXIgX19jcmVhdGVSZWFkT25seVN1YkZpZWxkID0gZnVuY3Rpb24oICkgewogICAgICAgICAgICAgICAgdmFyIHJlcyA9IFN1YmZpZWxkKCIiLCIiKTsKICAgICAgICAgICAgICAgIHJlcy5fX2RlZmluZVNldHRlcl9fKCJuYW1lIixmdW5jdGlvbih2YWwpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvciAoIklsbGVnYWwgb3BlcmF0aW9uIGFzc2lnbWVudCB0byBuYW1lIG9uICdub25FeGlzdGluZycgZmllbGQiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmVzLl9fZGVmaW5lU2V0dGVyX18oICJ2YWx1ZSIsIGZ1bmN0aW9uKCB2YWwgKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IgKCJJbGxlZ2FsIG9wZXJhdGlvbiBhc3NpZ25tZW50IHRvIHZhbHVlIG9uICdub25FeGlzdGluZycgZmllbGQiKQogICAgICAgICAgICAgICAgfSApOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICAgICAgfQoKICAgIHRoYXQuX19kZWZpbmVHZXR0ZXJfXyggIm5hbWUiLCBmdW5jdGlvbiggKSB7CiAgICAgICAgaWYgKCB0eXBlb2YgbmFtZSA9PSAidW5kZWZpbmVkIiApIHsKICAgICAgICAgICAgbmFtZSA9ICIiOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmFtZTsKCiAgICB9ICk7CiAgICB0aGF0Ll9fZGVmaW5lU2V0dGVyX18oICJuYW1lIiwgZnVuY3Rpb24oIHZhbCApIHsKICAgICAgICBuYW1lID0gdmFsOwogICAgfSApOwoKICAgIHRoYXQuX19kZWZpbmVHZXR0ZXJfXyggImluZGljYXRvciIsIGZ1bmN0aW9uKCApIHsKICAgICAgICBpZiAoIGlzQ29udHJvbEZpZWxkQm9vbCApIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoICJJbGxlZ2FsIG9wZXJhdGlvbiBvbiBjb250cm9sIGZpZWxkOiByZWFkaW5nIGluZGljYXRvciBhdHRyaWJ1dGUgaXMgbm90IGFsbG93ZWQiICk7CiAgICAgICAgfQogICAgICAgIGlmICggdHlwZW9mIGluZGljYXRvciA9PSAidW5kZWZpbmVkIiApIHsKICAgICAgICAgICAgaW5kaWNhdG9yID0gIiI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpbmRpY2F0b3I7CgogICAgfSApOwogICAgdGhhdC5fX2RlZmluZVNldHRlcl9fKCAiaW5kaWNhdG9yIiwgZnVuY3Rpb24oIHZhbCApIHsKICAgICAgICBpZiAoIGlzQ29udHJvbEZpZWxkQm9vbCApIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoICJJbGxlZ2FsIG9wZXJhdGlvbiBvbiBjb250cm9sIGZpZWxkOiBzZXR0aW5nIGluZGljYXRvciBhdHRyaWJ1dGUgaXMgbm90IGFsbG93ZWQiICk7CiAgICAgICAgfQogICAgICAgIGluZGljYXRvciA9IHZhbDsKICAgIH0gKTsKCiAgICB0aGF0LmlzQ29udHJvbEZpZWxkID0gZnVuY3Rpb24oICkgewogICAgICAgIHJldHVybiBpc0NvbnRyb2xGaWVsZEJvb2w7CiAgICB9OwoKICAgIC8vIEZpZWxkLnZhbHVlCiAgICAvLyBWYWx1ZSBjYW4gb25seSBiZSByZWFkIG9uIGNvbnRyb2wgZmllbGRzLCBhbmQgb25seSBiZSBzZXQgb24gY29udHJvbCBmaWVsZHMsIG9yIGVtcHR5IG9yZGluYXJ5IGZpZWxkcwogICAgdGhhdC5fX2RlZmluZUdldHRlcl9fKCAidmFsdWUiLCBmdW5jdGlvbiggKSB7CiAgICAgICAgaWYgKCAhaXNDb250cm9sRmllbGRCb29sICkgewogICAgICAgICAgICB0aHJvdyBFcnJvciggIklsbGVnYWwgb3BlcmF0aW9uIG9uIG5vbi1jb250cm9sIGZpZWxkOiByZWFkaW5nIHZhbHVlIGF0dHJpYnV0ZSBpcyBub3QgYWxsb3dlZCIgKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZhbHVlOwoKICAgIH0gKTsKICAgIHRoYXQuX19kZWZpbmVTZXR0ZXJfXyggInZhbHVlIiwgZnVuY3Rpb24oIHZhbCApIHsKICAgICAgICBpZiAoIGlzQ29udHJvbEZpZWxkQm9vbCB8fAogICAgICAgICAgICAoICggdHlwZW9mIGluZGljYXRvciA9PSAidW5kZWZpbmVkIiB8fCBpbmRpY2F0b3IgPT0gIiIgKSAmJgogICAgICAgICAgICAgICAgc3ViZmllbGRBcnJheS5sZW5ndGggPT0gMCApICkgewogICAgICAgICAgICBpc0NvbnRyb2xGaWVsZEJvb2wgPSB0cnVlOwogICAgICAgICAgICB2YWx1ZSA9IHZhbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBFcnJvciggIklsbGVnYWwgb3BlcmF0aW9uIG9uIG5vbi1jb250cm9sIGZpZWxkOiBzZXR0aW5nIHZhbHVlIGF0dHJpYnV0ZSBpcyBub3QgYWxsb3dlZCIgKTsKICAgICAgICB9CiAgICB9ICk7CgogICAgLy8gRmllbGQuYXBwZW5kCiAgICAvLyBGdW5jdGlvbiBmb3IgYXBwZW5kaW5nIG9yIGFkZGluZyBzdWJmaWVsZHMKICAgIC8vIG5hbWVBcmcgaXMgYSBzdWJmaWVsZAogICAgLy8gdmFsdWVBcmcgaXMgdGhlIHZhbHVlIG9mIHRoZSBzdWJmaWVsZCB0byBiZSBhcHBlbmRlZC4KICAgIC8vIHJlcGxhY2VCb29sIGRpY3RhdGVzIHdoZXRlciBhIHN1YmllbGQgc2hvdWxkIGJlIGFwcGVuZGVkIG9yIHJlcGxhY2VkLgogICAgLy8gSWYgcmVwbGFjZUJvb2wgaXMgdHJ1ZSB3ZSBhZGQgdG8gdGhlIGFycmF5IG90aGVyd2lzZSB0aGUgc3ViZmllbGQgaXMgYXBwZW5kZWQgdG8gdGhlIGFycmF5CiAgICB0aGF0LmFwcGVuZCA9IGZ1bmN0aW9uKCBuYW1lQXJnLCB2YWx1ZUFyZywgcmVwbGFjZUJvb2wgKSB7CiAgICAgICAgaWYgKCBpc0NvbnRyb2xGaWVsZEJvb2wgKSB7CiAgICAgICAgICAgIHRocm93IEVycm9yKCAiSWxsZWdhbCBvcGVyYXRpb24gb24gY29udHJvbCBmaWVsZDogY2FsbGluZyBhcHBlbmQgbWV0aG9kIGlzIG5vdCBhbGxvd2VkIiApOwogICAgICAgIH0KCiAgICAgICAgc3dpdGNoICggYXJndW1lbnRzLmxlbmd0aCApIHsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgc3ViZmllbGRBcnJheVsgc3ViZmllbGRBcnJheS5sZW5ndGggXSA9IFN1YmZpZWxkKCBuYW1lQXJnLm5hbWUsIG5hbWVBcmcudmFsdWUgKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgc3ViZmllbGRBcnJheVsgc3ViZmllbGRBcnJheS5sZW5ndGggXSA9IFN1YmZpZWxkKCBuYW1lQXJnLCB2YWx1ZUFyZyApOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBpZiAoIHJlcGxhY2VCb29sICkgewogICAgICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IC0xOwogICAgICAgICAgICAgICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IHN1YmZpZWxkQXJyYXkubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggc3ViZmllbGRBcnJheVsgaSBdLm5hbWUgPT0gbmFtZUFyZyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4ID0gaTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICggaW5kZXggIT0gLTEgKSB7IC8vd2UgZm91bmQgYSBzdWJmaWVsZAogICAgICAgICAgICAgICAgICAgICAgICBzdWJmaWVsZEFycmF5WyBpbmRleCBdID0gU3ViZmllbGQoIG5hbWVBcmcsIHZhbHVlQXJnICk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlQW5kU3RvcmVTdWJmaWVsZCggbmFtZUFyZywgdmFsdWVBcmcgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNyZWF0ZUFuZFN0b3JlU3ViZmllbGQoIG5hbWVBcmcsIHZhbHVlQXJnICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBkZWZhdWx0OgoKICAgICAgICAgICAgICAgIHRocm93IEVycm9yKCAiZnVuY3Rpb24gdGFrZXMgMSwgMiBvciAzIGFyZ3VtZW50cyIgKTsKICAgICAgICAgICAgICAgIC8qIENvbW1lbnRlZCBvdXQsIHBlbmRpbmcgZXhjZXB0aW9uIG1vZHVsZSBpbXBsZW1lbnRhdGlvbi4gIDA4LTA2LTEyLSBNdnMKCQkJewogICAgICAgICAgICBuYW1lOiAiaW52YWxpZEFyZ3VtZW50TnVtYmVyRXJyb3IiLAogICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogImZ1bmN0aW9uIHRha2VzIDEsIDIgb3IgMyBhcmd1bWVudHMiCiAgICAgICAgICAgICAgICAgICAgICB9OyovCiAgICAgICAgfQogICAgfTsKCiAgICAvLyBGaWVsZC5pbnNlcnQKICAgIC8vIEZ1bmN0aW9uIHRoYXQgaW5zZXJ0IGEgc3ViZmllbGQgYXQgYSBnaXZlbiBwb3NpdGlvbiBpLiBUaGUgc3ViZmllbGQgaXMgY3JlYXRlZCBmcm9tIG5hbWUgYW5kCiAgICAvLyB2YWx1ZS4KICAgIHRoYXQuaW5zZXJ0ID0gZnVuY3Rpb24oIGksIG5hbWUsIHZhbHVlICkgewogICAgICAgIGlmICggaXNDb250cm9sRmllbGRCb29sICkgewogICAgICAgICAgICB0aHJvdyBFcnJvciggIklsbGVnYWwgb3BlcmF0aW9uIG9uIGNvbnRyb2wgZmllbGQ6IGNhbGxpbmcgaW5zZXJ0IG1ldGhvZCBpcyBub3QgYWxsb3dlZCIgKTsKICAgICAgICB9CgogICAgICAgIHZhciBzdWJmaWVsZCA9IFN1YmZpZWxkKCBuYW1lLCB2YWx1ZSApOwogICAgICAgIGlmKCBpID09PSAwICkgewogICAgICAgICAgICBzdWJmaWVsZEFycmF5LnVuc2hpZnQoIHN1YmZpZWxkICk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBzdWJmaWVsZEFycmF5LnB1c2goIHVuZGVmaW5lZCApOwogICAgICAgICAgICBmb3IoIHZhciBqID0gaTsgaiA8IHN1YmZpZWxkQXJyYXkubGVuZ3RoIC0gMTsgaisrICkgewogICAgICAgICAgICAgICAgc3ViZmllbGRBcnJheVsgaiArIDEgXSA9IHN1YmZpZWxkQXJyYXlbIGogXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdWJmaWVsZEFycmF5WyBpIF0gPSBzdWJmaWVsZDsKICAgICAgICB9CiAgICB9OwoKICAgIC8vIEZpZWxkLnJlbW92ZQogICAgLy8gRnVuY3Rpb24gdGhhdCByZW1vdmVzIGEgc3ViZmllbGQgZnJvbSB0aGUgYXJyYXlzIG9mIHN1YmZpZWxkLiBDYW4gYmUgY2FsbGVkIHdpdGggZWl0aGVyIG9uZSBvciB0d28gYXJndW1lbnRzCiAgICAvLyBuYW1lQXJnID0gbmFtZSBvZiBzdWJmaWVsZAogICAgLy8gaW5kZXhBcmcgPSBpbmRleCBvZiB0aGUgc3ViZmllbGRzLCBzdGFydHMgd2l0aCAwLgogICAgdGhhdC5yZW1vdmUgPSBmdW5jdGlvbiggbmFtZUFyZywgaW5kZXhBcmcgKSB7CiAgICAgICAgaWYgKCBpc0NvbnRyb2xGaWVsZEJvb2wgKSB7CiAgICAgICAgICAgIHRocm93IEVycm9yKCAiSWxsZWdhbCBvcGVyYXRpb24gb24gY29udHJvbCBmaWVsZDogY2FsbGluZyByZW1vdmUgbWV0aG9kIGlzIG5vdCBhbGxvd2VkIiApOwogICAgICAgIH0KCiAgICAgICAgaWYgKCBhcmd1bWVudHMubGVuZ3RoID09IDEgKSB7IC8vbmFtZSBvZiBpbmRleCBvZiBzdWJmaWVsZAogICAgICAgICAgICBpZiAoIHR5cGVvZiBuYW1lQXJnID09ICJudW1iZXIiICkgewogICAgICAgICAgICAgICAgcmVtb3ZlSW5kZXhPZlN1YmZpZWxkQXJyYXkoIG5hbWVBcmcgKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGlmICggdHlwZW9mIG5hbWVBcmcgPT0gInN0cmluZyIgKSB7CiAgICAgICAgICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBzdWJmaWVsZEFycmF5Lmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICAgICAgICAgIGlmICggc3ViZmllbGRBcnJheVsgaSBdLm5hbWUgPT0gbmFtZUFyZyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlSW5kZXhPZlN1YmZpZWxkQXJyYXkoIGkgKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICggYXJndW1lbnRzLmxlbmd0aCA9PSAyICkgewogICAgICAgICAgICB2YXIgaXRlbUNvdW50ID0gLTE7CiAgICAgICAgICAgIGZvciAoIHZhciB5ID0gMDsgeSA8IHN1YmZpZWxkQXJyYXkubGVuZ3RoOyB5KysgKSB7CiAgICAgICAgICAgICAgICBpZiAoIHN1YmZpZWxkQXJyYXlbIHkgXS5uYW1lID09IG5hbWVBcmcgKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbUNvdW50ID0gaXRlbUNvdW50ICsgMTsKICAgICAgICAgICAgICAgICAgICBpZiAoIGl0ZW1Db3VudCA9PSBpbmRleEFyZyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlSW5kZXhPZlN1YmZpZWxkQXJyYXkoIHkgKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoICJmdW5jdGlvbiB0YWtlcyAxIG9yIDIgYXJndW1lbnRzIiApOwogICAgICAgICAgICAvKiBDb21tZW50ZWQgb3V0LCBwZW5kaW5nIGV4Y2VwdGlvbiBtb2R1bGUgaW1wbGVtZW50YXRpb24uICAwOC0wNi0xMi0gTXZzCgkJCXsKICAgICAgICAgICAgbmFtZToiaW52YWxpZEFyZ3VtZW50TnVtYmVyRXJyb3IiLAogICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiJmdW5jdGlvbiB0YWtlcyAxIG9yIDIgYXJndW1lbnRzIgogICAgICAgICAgICAgICAgICAgICB9OyovCiAgICAgICAgfQogICAgfTsKCiAgICAvLyBGaWVsZDpjb3VudAogICAgLy8gRnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSBudW1iZXIgb2YgaW5zdGFuY2VzIG9mIHN1YmZpZWxkcyBpbiB0aGUgYXJyYXkuCiAgICAvLyB0YWtlcyBvbmUgYXJndW1lbnQgPSBuYW1lIG9mIHN1YmZpZWxkcy4KICAgIHRoYXQuY291bnQgPSBmdW5jdGlvbiggbmFtZUFyZyApIHsKICAgICAgICBpZiAoIGlzQ29udHJvbEZpZWxkQm9vbCApIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoICJJbGxlZ2FsIG9wZXJhdGlvbiBvbiBjb250cm9sIGZpZWxkOiBjYWxsaW5nIGNvdW50IG1ldGhvZCBpcyBub3QgYWxsb3dlZCIgKTsKICAgICAgICB9CgogICAgICAgIGlmICggYXJndW1lbnRzLmxlbmd0aCA9PT0gMCApIHsKICAgICAgICAgICAgcmV0dXJuIHN1YmZpZWxkQXJyYXkubGVuZ3RoOwogICAgICAgIH0gZWxzZSBpZiAoIGFyZ3VtZW50cy5sZW5ndGggPT0gMSApIHsKICAgICAgICAgICAgdmFyIGl0ZW1Db3VudCA9IDA7CiAgICAgICAgICAgIHZhciBpdGVtID0gIiI7CiAgICAgICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IHN1YmZpZWxkQXJyYXkubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgICAgICAgICBpdGVtID0gc3ViZmllbGRBcnJheVsgaSBdOwogICAgICAgICAgICAgICAgaWYgKCBpdGVtLm5hbWUgPT0gbmFtZUFyZyApIHsKICAgICAgICAgICAgICAgICAgICBpdGVtQ291bnQgPSBpdGVtQ291bnQgKyAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBpdGVtQ291bnQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoICJmdW5jdGlvbiB0YWtlcyAwIG9yIDEgYXJndW1lbnQiICk7CiAgICAgICAgICAgIC8qIENvbW1lbnRlZCBvdXQsIHBlbmRpbmcgZXhjZXB0aW9uIG1vZHVsZSBpbXBsZW1lbnRhdGlvbi4gIDA4LTA2LTEyLSBNdnMKCQkJewogICAgICAgICAgICBuYW1lOiJpbnZhbGlkQXJndW1lbnROdW1iZXJFcnJvciIsCiAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ImZ1bmN0aW9uIHRha2VzIDAgb3IgMSBhcmd1bWVudCIKICAgICAgICAgICAgICAgICAgICAgfTsgKi8KICAgICAgICB9CgoKICAgIH07CgovL2phNiAgICAvLyBGaWVsZDpzdWJmaWVsZAogICAgLy8gRnVuY3Rpb24gdGhhdCByZXR1cm5zIGEgc3ViZmllbGQgZnJvbSB0aGUgYXJyYXkKICAgIC8vIFRha2VzIDIgYXJndW1lbnRzLiBGaXJzdCBhcmd1bWVudCBjYW4gYmUgZWl0aGVyIGEgbmFtZSBvZiBhIHN1YmZpZWxkIG9iamVjdCBvciBhIG51bWJlciBvZiBhIHN1YmlmaWVsZCwgd2hpY2ggaXMgemVybyBiYXNlZC4KICAgIC8vIHNlY29uZCBhcmd1bWVudCBpcyBpbmRleCBvZiBzdWJmaWVsZC4gVGhlIGluZGV4IG51bWJlciBkZXRlcm1pbmVzIHdoaWNoIG9jY3VyYW5jZSBvZiB0aGUgc3ViZmllbGQgc2hvdWxkIGJlIHJldHVybmVkLgogICAgLy8gSWYgdGhlIHNlY29uZCBhcmd1bWVudCBpcyBvbWl0dGVkLCB0aGUgYXJndW1lbnQgaXMgY2hlY2tlZCBmb3IgdHlwZS4KICAgIHRoYXQuc3ViZmllbGQgPSBmdW5jdGlvbiggbmFtZUFyZywgaW5kZXhBcmcgKSB7CiAgICAgICAgaWYgKCBpc0NvbnRyb2xGaWVsZEJvb2wgKSB7CiAgICAgICAgICAgIHRocm93IEVycm9yKCAiSWxsZWdhbCBvcGVyYXRpb24gb24gY29udHJvbCBmaWVsZDogY2FsbGluZyBzdWJmaWVsZCBtZXRob2QgaXMgbm90IGFsbG93ZWQiICk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIGFyZ3VtZW50cy5sZW5ndGggPT0gMSApIHsKICAgICAgICAgICAgaWYgKCB0eXBlb2YgbmFtZUFyZyA9PSAibnVtYmVyIiApIHsKICAgICAgICAgICAgICAgIGlmICggbmFtZUFyZyA+PSBzdWJmaWVsZEFycmF5Lmxlbmd0aCApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gU3ViZmllbGQoICIiLCAiIiApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3ViZmllbGRBcnJheVsgbmFtZUFyZyBdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKCB0eXBlb2YgbmFtZUFyZyA9PSAic3RyaW5nIiApIHsKICAgICAgICAgICAgICAgIGZvciAoIHZhciB5ID0gMDsgeSA8IHN1YmZpZWxkQXJyYXkubGVuZ3RoOyB5KysgKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBzdWJmaWVsZEFycmF5WyB5IF07CiAgICAgICAgICAgICAgICAgICAgaWYgKCBpdGVtLm5hbWUgPT0gbmFtZUFyZyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIF9fY3JlYXRlUmVhZE9ubHlTdWJGaWVsZCgpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICggYXJndW1lbnRzLmxlbmd0aCA9PSAyICkgewogICAgICAgICAgICB2YXIgaXRlbUNvdW50ID0gLTE7CiAgICAgICAgICAgIHZhciBpdGVtID0gIiI7CiAgICAgICAgICAgIGZvciAoIHZhciB4ID0gMDsgeCA8IHN1YmZpZWxkQXJyYXkubGVuZ3RoOyB4KysgKSB7CiAgICAgICAgICAgICAgICBpdGVtID0gc3ViZmllbGRBcnJheVsgeCBdOwogICAgICAgICAgICAgICAgaWYgKCBpdGVtLm5hbWUgPT0gbmFtZUFyZyApIHsKICAgICAgICAgICAgICAgICAgICBpdGVtQ291bnQgPSBpdGVtQ291bnQgKyAxOwogICAgICAgICAgICAgICAgICAgIGlmICggaXRlbUNvdW50ID09IGluZGV4QXJnICkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIF9fY3JlYXRlUmVhZE9ubHlTdWJGaWVsZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IEVycm9yKCAiZnVuY3Rpb24gdGFrZXMgMSBvciAyIGFyZ3VtZW50cyIgKTsKICAgICAgICAgICAgLyogQ29tbWVudGVkIG91dCwgcGVuZGluZyBleGNlcHRpb24gbW9kdWxlIGltcGxlbWVudGF0aW9uLiAgMDgtMDYtMTItIE12cwoJCQl7CiAgICAgICAgICAgICAgICBuYW1lIDogImludmFsaWRBcmd1bWVudE51bWJlckVycm9yIiwKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAiZnVuY3Rpb24gdGFrZXMgMSBvciAyIGFyZ3VtZW50cyIKICAgICAgICAgICAgICAgICAgICB9OyovCiAgICAgICAgfQogICAgfTsKCgogICAgLy8gRmllbGQ6dG9TdHJpbmcKICAgIC8vIEZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgY29udGVudHMgb2YgZmllbGQgYXMgYSBzdHJpbmcuCiAgICB0aGF0LnRvU3RyaW5nID0gZnVuY3Rpb24oICkgewogICAgICAgIGlmICggaXNDb250cm9sRmllbGRCb29sICkgewogICAgICAgICAgICByZXR1cm4gbmFtZSArICIgIiArIHZhbHVlLnJlcGxhY2UoIC9AL2csICJAQCIgKS5yZXBsYWNlKCAvXCovZywgIkAqIiApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFRyYXZlcnNlcyB0aGUgc3ViZmllbGRzIGFuZCByZXR1cm4gZWFjaCBhcyBhIHN0cmluZwogICAgICAgICAgICB2YXIgc3ViZmllbGRTdHJpbmcgPSAiICI7CiAgICAgICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IHN1YmZpZWxkQXJyYXkubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgICAgICAgICBzdWJmaWVsZFN0cmluZyA9IHN1YmZpZWxkU3RyaW5nICsgc3ViZmllbGRBcnJheVsgaSBdLnRvU3RyaW5nKCApICsgIiAiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBuYW1lICsgIiAiICsgaW5kaWNhdG9yICsgc3ViZmllbGRTdHJpbmc7CiAgICAgICAgfQogICAgfTsKCgogICAgLy9wcml2YXRlIGhlbHBlcmZ1bmN0aW9ucwoKICAgIC8vIEZ1bmN0aW9uIGZvciBjb3B5aW5nIGEgZmllbGQgYW5kIGFsbCBpdHMgc3ViZmllbGRzLiBOZWVkZWQgdG8gc2F2ZSBjb3BpZXMsIG5vdCByZWZlcmVuY2VzCiAgICB0aGF0Ll9fY29weSA9IGZ1bmN0aW9uKCApIHsKICAgICAgICB2YXIgcmVzID0gbmV3IEZpZWxkKCApOwogICAgICAgIHJlcy5uYW1lID0gbmFtZTsKICAgICAgICByZXMuaXNDb250cm9sRmllbGRCb29sID0gaXNDb250cm9sRmllbGRCb29sOwogICAgICAgIGlmICggaXNDb250cm9sRmllbGRCb29sICkgewogICAgICAgICAgICByZXMudmFsdWUgPSB2YWx1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXMuaW5kaWNhdG9yID0gaW5kaWNhdG9yOwogICAgICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBzdWJmaWVsZEFycmF5Lmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICAgICAgcmVzLmFwcGVuZCggc3ViZmllbGRBcnJheVsgaSBdICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlczsKICAgIH07CgogICAgLy8gRnVuY3Rpb24gdXNlZCBmb3IgY3JlYXRpbmcgYSBzdWJmaWVsZCBpbiB0aGUgc3ViZmllbGQgYXJyYXkKICAgIGZ1bmN0aW9uIGNyZWF0ZUFuZFN0b3JlU3ViZmllbGQoIG5hbWUsIHZhbCApIHsKICAgICAgICBzdWJmaWVsZEFycmF5WyBzdWJmaWVsZEFycmF5Lmxlbmd0aCBdID0gU3ViZmllbGQoIG5hbWUsIHZhbCApOwogICAgfTsKCiAgICAvLyBGdW5jdGlvbiB0aGF0IHJlbW92ZXMgYSBzdWJmaWVsZAogICAgZnVuY3Rpb24gcmVtb3ZlSW5kZXhPZlN1YmZpZWxkQXJyYXkoIGluZGV4QXJnICkgewogICAgICAgIGlmICggaW5kZXhBcmcgPT09IDAgKSB7CiAgICAgICAgICAgIHN1YmZpZWxkQXJyYXkuc3BsaWNlKCAwLCAxICk7CiAgICAgICAgICAgIC8vc3ViZmllbGRBcnJheSA9IHN1YmZpZWxkQXJyYXkuc2xpY2UoIDEgKTsKICAgICAgICB9IGVsc2UgaWYgKCBpbmRleEFyZyA9PSBzdWJmaWVsZEFycmF5Lmxlbmd0aCAtIDEgKSB7CiAgICAgICAgICAgIHN1YmZpZWxkQXJyYXkuc3BsaWNlKCAoIHN1YmZpZWxkQXJyYXkubGVuZ3RoIC0gMSApLCAxICk7CiAgICAgICAgICAgIC8vIHN1YmZpZWxkQXJyYXkgPSBzdWJmaWVsZEFycmF5LnNsaWNlKCAwLCBzdWJmaWVsZEFycmF5Lmxlbmd0aCAtMSApOwogICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgICBzdWJmaWVsZEFycmF5LnNwbGljZSggaW5kZXhBcmcsIDEgKTsKICAgICAgICAgICAgLyogY29tbWVudGVkIG91dCBieSBtdnMsIHJlcGxhY2VkIGJ5IHNwbGljZQogICAgICAgICAgICAgICAgdmFyIHBhcnQxID0gc3ViZmllbGRBcnJheS5zbGljZSggMCwgaW5kZXhBcmcpOwogICAgICAgICAgICAgICAgdmFyIHBhcnQyID0gc3ViZmllbGRBcnJheS5zbGljZSggaW5kZXhBcmcrMSk7CiAgICAgICAgICAgICAgICBzdWJmaWVsZEFycmF5ID0gcGFydDEuY29uY2F0KCBwYXJ0Mik7CiAgICAgICAgICAgICovCiAgICAgICAgfQogICAgfTsKICAgIHJldHVybiB0aGF0Owp9OwoKCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vIFJlY29yZCBpbXBsZW1lbnRhdGlvbgovLyBBcnJheSBvZiBmaWVsZHM6IGZpZWxkQXJyYXkKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KdmFyIFJlY29yZCA9IGZ1bmN0aW9uKCBmaWxlbmFtZUFyZyApIHsKCiAgICBpZiAoIGFyZ3VtZW50cy5sZW5ndGggPT09IDAgKSB7fSBlbHNlIGlmICggYXJndW1lbnRzLmxlbmd0aCA9PSAxICkgewogICAgICAgIHRocm93IEVycm9yKCAiQ2FsbCB0byBmdW5jdGlvbiB0aGF0IGNyZWF0ZXMgYSByZWNvcmQgZnJvbSBhIGZpbGUgaXMgbm90IGltcGxlbWVudGVkIGluIGphdmFzY3JpcHQiICk7CgogICAgICAgIC8qIENvbW1lbnRlZCBvdXQsIHBlbmRpbmcgZXhjZXB0aW9uIG1vZHVsZSBpbXBsZW1lbnRhdGlvbi4gIDA4LTA2LTEyLSBNdnMKCQl7CiAgICAgICAgbmFtZToibm90SW1wbGVtZW50ZWRFcnJvciIsCiAgICAgICAgICAgICAgICAgbWVzc2FnZToiQ2FsbCB0byBmdW5jdGlvbiB0aGF0IGNyZWF0ZXMgYSByZWNvcmQgZnJvbSBhIGZpbGUgaXMgbm90IGltcGxlbWVudGVkIGluIGphdmFzY3JpcHQiCiAgICAgICAgICAgICAgICAgfTsqLwogICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBFcnJvciggIlJlY29yZCBhdHRlbXB0ZWQgY3JlYXRlZCB3aXRoIHRvbyBtYW55IGFyZ3VtZW50cyIgKTsKICAgICAgICAvKiBDb21tZW50ZWQgb3V0LCBwZW5kaW5nIGV4Y2VwdGlvbiBtb2R1bGUgaW1wbGVtZW50YXRpb24uICAwOC0wNi0xMi0gTXZzCgkJewogICAgICAgIG5hbWU6ImludmFsaWRBcmd1bWVudE51bWJlckVycm9yIiwKICAgICAgICAgICAgICAgICBtZXNzYWdlOiJSZWNvcmQgYXR0ZW1wdGVkIGNyZWF0ZWQgd2l0aCB0b28gbWFueSBhcmd1bWVudHMiCiAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICovCiAgICB9CgogICAgLy8gRW5jYXBzdWxhdGUgb2JqZWN0CiAgICB2YXIgdGhhdCA9IE9iamVjdC5jcmVhdGUoIFJlY29yZC5wcm90b3R5cGUgKTsKICAgIHZhciBmaWVsZEFycmF5ID0gWyBdOwoKICAgIC8vIFRoZXNlIGFyZSBmaWVsZHMgZnJvbSB0aGUgaXNvIDI3MDkgaGVhZGVyLgogICAgLy8gUHJpdmF0ZSB2YWx1ZSBvZiBpbXBsZW1lbnRhdGlvbkNvZGVzIGFuZCByZWNvcmRTdGF0dXMKICAgIHZhciBpbXBsZW1lbnRhdGlvbkNvZGVzOwogICAgdmFyIHJlY29yZFN0YXR1cyA9ICJjIjsKICAgIHZhciBmb3JVc2VyU3lzdGVtcyA9ICIgICAiOwoKICAgIC8vIEhlbHBlciBmdW5jdGlvbiwgYWxsb3cgdXMgdG8gY2xlYXIgb3RoZXIgcGxhY2VzLgogICAgdmFyIF9fY2xlYXIgPSBmdW5jdGlvbigpIHsKICAgICAgICBmaWVsZEFycmF5ID0gW107CiAgICAgICAgaW1wbGVtZW50YXRpb25Db2RlcyA9ICIgICAgIjsKICAgICAgICByZWNvcmRTdGF0dXMgPSAiYyI7CiAgICAgICAgZm9yVXNlclN5c3RlbXMgPSAiICAgIjsKICAgIH0KICAgIF9fY2xlYXIoKTsKCiAgICB0aGF0Ll9fZGVmaW5lR2V0dGVyX18oICJpbXBsZW1lbnRhdGlvbkNvZGVzIiwgZnVuY3Rpb24oICkgewogICAgICAgIHJldHVybiBpbXBsZW1lbnRhdGlvbkNvZGVzOwogICAgfSApOwoKICAgIHRoYXQuX19kZWZpbmVTZXR0ZXJfXyggImltcGxlbWVudGF0aW9uQ29kZXMiLCBmdW5jdGlvbiggdmFsICkgewogICAgICAgIGltcGxlbWVudGF0aW9uQ29kZXMgPSB2YWw7CiAgICB9ICk7CgogICAgdGhhdC5fX2RlZmluZUdldHRlcl9fKCAicmVjb3JkU3RhdHVzIiwgZnVuY3Rpb24oICkgewogICAgICAgIHJldHVybiByZWNvcmRTdGF0dXM7CiAgICB9ICk7CgogICAgdGhhdC5fX2RlZmluZVNldHRlcl9fKCAicmVjb3JkU3RhdHVzIiwgZnVuY3Rpb24oIHZhbCApIHsKICAgICAgICByZWNvcmRTdGF0dXMgPSB2YWw7CiAgICB9ICk7CgogICAgdGhhdC5fX2RlZmluZUdldHRlcl9fKCAiZm9yVXNlclN5c3RlbXMiLCBmdW5jdGlvbiggKSB7CiAgICAgICAgcmV0dXJuIGZvclVzZXJTeXN0ZW1zOwogICAgfSApOwoKICAgIHRoYXQuX19kZWZpbmVTZXR0ZXJfXyggImZvclVzZXJTeXN0ZW1zIiwgZnVuY3Rpb24oIHZhbCApIHsKICAgICAgICBmb3JVc2VyU3lzdGVtcyA9IHZhbDsKICAgIH0gKTsKCgogICAgLyoqCiAgICAgKiBpbnRlcm5hbCBoZWxkcGVyCiAgICAgKiBAcmV0dXJucyBSZWNvcmQgb2JqZWN0IHdpdGggb3dlcndyaXR0ZW4gc2V0dGVyIE1ldGhvZHMgdGhhdCB0aHJvd3N7fQogICAgICogQHByaXZhdGUKICAgICAqLwogICAgdmFyIF9fY3JlYXRlUmVhZE9ubHlGaWVsZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgcmVzID0gRmllbGQoIiIsIiIpOwogICAgICAgIHJlcy5fX2RlZmluZVNldHRlcl9fKCJuYW1lIiwgZnVuY3Rpb24oIHZhbHVlICkgewogICAgICAgICAgICB0aHJvdyBFcnJvcigiSWxsZWdhbCBvcGVyYXRpb24gb24gbm9uIGV4aXN0ZW50IGZpZWxkOiBzZXR0aW5nIG5hbWUgYXR0cmlidXRlIGlzIG5vdCBhbGxvd2VkIik7CiAgICAgICAgfSk7CiAgICAgICAgcmVzLl9fZGVmaW5lU2V0dGVyX18oImluZGljYXRvciIsIGZ1bmN0aW9uKCB2YWx1ZSApIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoIklsbGVnYWwgb3BlcmF0aW9uIG9uIG5vbiBleGlzdGVudCBmaWVsZDogc2V0dGluZyBpbmRpY2F0b3IgYXR0cmlidXRlIGlzIG5vdCBhbGxvd2VkIikKICAgICAgICB9KTsKICAgICAgICByZXMuX19kZWZpbmVTZXR0ZXJfXygidmFsdWUiLCBmdW5jdGlvbiggdmFsdWUgKSB7CiAgICAgICAgICAgIHRocm93IEVycm9yKCJJbGxlZ2FsIG9wZXJhdGlvbiBvbiBub24gZXhpc3RlbnQgZmllbGQ6IHNldHRpbmcgdmFsdWUgYXR0cmlidXRlIGlzIG5vdCBhbGxvd2VkIikKICAgICAgICB9KTsKICAgICAgICByZXMuYXBwZW5kID0gZnVuY3Rpb24oICkgewogICAgICAgICAgICB0aHJvdyBFcnJvcigiSWxsZWdhbCBvcGVyYXRpb24gb24gbm9uIGV4aXN0ZW50IGZpZWxkOiBzZXR0aW5nIGFwcGVuZCBhdHRyaWJ1dGUgaXMgbm90IGFsbG93ZWQiKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlczsKICAgIH0KCiAgICAvLyBSZWNvcmQ6bnVtYmVyT2ZGaWVsZHMKICAgIC8vIEZ1bmN0aW9uIHdoaWNoIHJldHVybnMgdGhlIG51bWJlciBvZiBmaWVsZHMgaW4gdGhlIGZpZWxkIGFycmF5CiAgICB0aGF0Lm51bWJlck9mRmllbGRzID0gZnVuY3Rpb24oICkgewogICAgICAgIHJldHVybiBmaWVsZEFycmF5Lmxlbmd0aDsKICAgIH07CgoKICAgIC8vIFJlY29yZDpjb3VudAogICAgLy8gRnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSBnaXZlbiBudW1iZXIgb2YgZmllbGQgb2NjdXJhbmNlcyBpbiB0aGUgZmllbGQgYXJyYXkKICAgIC8vIFRha2VzIG9uZSBhcmd1bWVudCwgbmFtZUFyZyB3aGljaCBpcyB0aGUgZmllbGQgaWQuIAogICAgdGhhdC5jb3VudCA9IGZ1bmN0aW9uKCBuYW1lQXJnICkgewogICAgICAgIGlmICggYXJndW1lbnRzLmxlbmd0aCA9PSAxICkgewogICAgICAgICAgICB2YXIgaXRlbUNvdW50ID0gMDsKICAgICAgICAgICAgdmFyIGl0ZW0gPSAiIjsKICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgZmllbGRBcnJheS5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgICAgIGl0ZW0gPSBmaWVsZEFycmF5WyBpIF07CiAgICAgICAgICAgICAgICBpZiAoIGZpZWxkQXJyYXlbIGkgXS5uYW1lID09IG5hbWVBcmcgKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbUNvdW50ID0gaXRlbUNvdW50ICsgMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gaXRlbUNvdW50OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IEVycm9yKCAiRnVuY3Rpb24gdGFrZXMgb25seSAxIGFyZ3VtZW50IiApOwogICAgICAgICAgICAvKiBDb21tZW50ZWQgb3V0LCBwZW5kaW5nIGV4Y2VwdGlvbiBtb2R1bGUgaW1wbGVtZW50YXRpb24uICAwOC0wNi0xMi0gTXZzCgkJCXsKICAgICAgICAgICAgbmFtZToiaW52YWxpZEFyZ3VtZW50TnVtYmVyRXJyb3IiLAogICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiJGdW5jdGlvbiB0YWtlcyAxIGFyZ3VtZW50IgogICAgICAgICAgICAgICAgICAgICB9OyovCiAgICAgICAgfQoKICAgIH07CgogICAgLy8gUmVjb3JkOmFwcGVuZAogICAgLy8gRnVuY3Rpb24gdGhhdCBlaXRoZXIgYXBwZW5kcyB0byBhbiBleGNpc3RpbmcgZmllbGQgb3IgYWRkcyBhIG5ldyBmaWVsZCB0byB0aGUgZmllbGRBcnJheQogICAgLy8gVGFrZXMgdHdvIGFyZ3VtZW50cwogICAgLy8gRmlyc3QgYXJndW1lbnQgY2FuIGJlIGVpdGhlciBhIGZpZWxkIG9yIHRoZSBuYW1lIG9mIHRoZSBmaWVsZC4gSXRzIGFzc3VtZWQgdG8gYmUgYSBmaWVsZCBpZiBzZWNvbmQgYXJndW1lbnQgaXMgb21pdHRlZC4KICAgIC8vIElmIHRoZXJlIGFyZSB0d28gYXJndW1lbnRzIGl0cyBhc3N1bWVkIGZpcnN0IGFyZ3VtZW50IGlzIGEgbmFtZXN0cmluZyBhbmQgYW4gaW5kaWNhdG9yIHN0cmluZyBvZiB0aGUgZmllbGQgaW4gdGhlIGZpZWxkQXJyYXkuCiAgICB0aGF0LmFwcGVuZCA9IGZ1bmN0aW9uKCBuYW1lQXJnLCBpbmRpY2F0b3JBcmcgKSB7CiAgICAgICAgaWYgKCBhcmd1bWVudHMubGVuZ3RoID09IDEgKSB7IC8vaXRzIGEgZmllbGQgCiAgICAgICAgICAgIGZpZWxkQXJyYXlbIGZpZWxkQXJyYXkubGVuZ3RoIF0gPSBuYW1lQXJnLl9fY29weSggKTsgLy9TdG9yZXMgdGhlIG5ldyBmaWVsZCBpbiB0aGUgZmllbGRhcnJheQogICAgICAgIH0gZWxzZSBpZiAoIGFyZ3VtZW50cy5sZW5ndGggPT0gMiApIHsKICAgICAgICAgICAgZmllbGRBcnJheVsgZmllbGRBcnJheS5sZW5ndGggXSA9IG5ldyBGaWVsZCggbmFtZUFyZywgaW5kaWNhdG9yQXJnICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoICJmdW5jdGlvbiB0YWtlcyAxIG9yIDIgYXJndW1lbnRzIiApOwogICAgICAgICAgICAvKiBDb21tZW50ZWQgb3V0LCBwZW5kaW5nIGV4Y2VwdGlvbiBtb2R1bGUgaW1wbGVtZW50YXRpb24uICAwOC0wNi0xMi0gTXZzCgkJewogICAgICAgICAgICBuYW1lOiJpbnZhbGlkQXJndW1lbnROdW1iZXJFcnJvciIsCiAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ImZ1bmN0aW9uIHRha2VzIDEgb3IgMiBhcmd1bWVudHMiCiAgICAgICAgICAgICAgICAgICAgIH07Ki8KICAgICAgICB9CiAgICB9OwoKICAgIC8vIFJlY29yZDpyZW1vdmUKICAgIC8vIEZ1bmN0aW9uIHRoYXQgcmVtb3ZlcyBhIGZpZWxkIGZyb20gdGhlIHJlY29yZCBpbnN0YW5jZQogICAgLy8gVGFrZXMgdHdvIGFyZ3VtZW50cwogICAgLy8gRmlyc3QgYXJndW1lbnQgY2FuIGJlIGVpdGhlciB0aGUgbmFtZSBvciB0aGUgemVybyBiYXNlZCBJRCBudW1iZXIgb2YgdGhlIGZpZWxkIHRvIHJlbW92ZS4KICAgIC8vIFNlY29uZCBhcmd1bWVudCBpcyBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgaW5kZXggbnVtYmVycyBvZiBmaWVsZHMgaW4gdGhlIGZpZWxkYXJyYXkuCiAgICAvLyBJZiB0aGVyZSBpcyBubyBmaWVsZCBtYXRjaGluZyB0aGUgSUQgb3IgbmFtZSwgbm90aGluZyBoYXBwZW5zIAogICAgdGhhdC5yZW1vdmUgPSBmdW5jdGlvbiggbmFtZUFyZywgaW5kZXhBcmcgKSB7CiAgICAgICAgc3dpdGNoICggYXJndW1lbnRzLmxlbmd0aCApIHsKCiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIGlmICggYXJndW1lbnRzLmxlbmd0aCA9PSAxICYmIHR5cGVvZiBuYW1lQXJnID09ICJudW1iZXIiICkgewogICAgICAgICAgICAgICAgICAgIHJlbW92ZUluZGV4T2ZGaWVsZEFycmF5KCBuYW1lQXJnICk7CiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIGlmICggYXJndW1lbnRzLmxlbmd0aCA9PSAxICYmIHR5cGVvZiBuYW1lQXJnID09ICJzdHJpbmciICkgewogICAgICAgICAgICAgICAgICAgIGZvciAoIHZhciB5ID0gMDsgeSA8IGZpZWxkQXJyYXkubGVuZ3RoOyB5KysgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZmllbGRBcnJheVsgeSBdLm5hbWUgPT0gbmFtZUFyZyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUluZGV4T2ZGaWVsZEFycmF5KCB5ICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgdmFyIGl0ZW1Db3VudCA9IC0xOwogICAgICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgZmllbGRBcnJheS5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIGZpZWxkQXJyYXlbIGkgXS5uYW1lID09IG5hbWVBcmcgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1Db3VudCA9IGl0ZW1Db3VudCArIDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggaXRlbUNvdW50ID09IGluZGV4QXJnICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlSW5kZXhPZkZpZWxkQXJyYXkoIGkgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoICJmdW5jdGlvbiB0YWtlcyAxIG9yIDIgYXJndW1lbnRzIiApOwogICAgICAgICAgICAgICAgLyogQ29tbWVudGVkIG91dCwgcGVuZGluZyBleGNlcHRpb24gbW9kdWxlIGltcGxlbWVudGF0aW9uLiAgMDgtMDYtMTItIE12cwoJCQl7CiAgICAgICAgICAgIG5hbWU6ICJpbnZhbGlkQXJndW1lbnROdW1iZXJFcnJvciIsCiAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAiZnVuY3Rpb24gdGFrZXMgMSBvciAyIGFyZ3VtZW50cyIKCQkJCSAgICAgICAgICAgICAgICAgICAgICB9OyovCiAgICAgICAgfQogICAgfTsKCiAgICAvLyBJcyBpbiB0aGUgZG9jdW1lbnRhdGlvbiwgYnV0IGhhcyBubyB1bml0IHRlc3QuCiAgICB0aGF0LnJlbW92ZUFsbCA9IGZ1bmN0aW9uKCBuYW1lICkgewogICAgICAgIHZhciBudW0gPSB0aGF0LmNvdW50KCBuYW1lICk7CiAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgbnVtOyBpKysgKSB7CiAgICAgICAgICAgIHRoYXQucmVtb3ZlKCBuYW1lICk7CiAgICAgICAgfQogICAgfTsKCiAgICAvLyBSZWNvcmQ6ZmllbGQgICAgICAgICAgU3ViCiAgICAvLyBGdW5jdGlvbiB0aGF0IHJldHVybnMgYSBmaWVsZCBmcm9tIGEgcmVjb3JkCiAgICAvLyBUYWtlcyAyIGFyZ3VtZW50cwogICAgLy8gRmlyc3QgYXJndW1lbnQgY2FuIGJlIGVpdGhlciB0aGUgbmFtZSBvciB0aGUgemVybyBiYXNlZCBJRCBudW1iZXIgb2YgdGhlIGZpZWxkIHRvIHJldHVybiAKICAgIHRoYXQuZmllbGQgPSBmdW5jdGlvbiggbmFtZUFyZywgaW5kZXhBcmcgKSB7CiAgICAgICAgaWYgKCBhcmd1bWVudHMubGVuZ3RoID09IDEgKSB7CiAgICAgICAgICAgIGlmICggdHlwZW9mIG5hbWVBcmcgPT0gIm51bWJlciIgKSB7CiAgICAgICAgICAgICAgICBpZiAoIG5hbWVBcmcgPj0gZmllbGRBcnJheS5sZW5ndGggKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZpZWxkKCAiIiwgIiIgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkQXJyYXlbIG5hbWVBcmcgXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICggdHlwZW9mIG5hbWVBcmcgPT0gInN0cmluZyIgKSB7CiAgICAgICAgICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBmaWVsZEFycmF5Lmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICAgICAgICAgIGlmICggZmllbGRBcnJheVsgaSBdLm5hbWUgPT0gbmFtZUFyZyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkQXJyYXlbIGkgXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gX19jcmVhdGVSZWFkT25seUZpZWxkKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKCBhcmd1bWVudHMubGVuZ3RoID09IDIgKSB7CiAgICAgICAgICAgIHZhciBpdGVtQ291bnQgPSAtMTsKCiAgICAgICAgICAgIHZhciBsZW4gPSBmaWVsZEFycmF5Lmxlbmd0aDsKICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgbGVuOyBpKysgKSB7CiAgICAgICAgICAgICAgICBpZiAoIGZpZWxkQXJyYXlbIGkgXS5uYW1lID09IG5hbWVBcmcgKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbUNvdW50ID0gaXRlbUNvdW50ICsgMTsKICAgICAgICAgICAgICAgICAgICBpZiAoIGl0ZW1Db3VudCA9PSBpbmRleEFyZyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkQXJyYXlbIGkgXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIF9fY3JlYXRlUmVhZE9ubHlGaWVsZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IEVycm9yKCAiRnVuY3Rpb24gZmllbGQgaXMgY2FsbGVkIHdpdGggMSBvciAyIGFyZ3VtZW50cyIgKTsKICAgICAgICAgICAgLyogQ29tbWVudGVkIG91dCwgcGVuZGluZyBleGNlcHRpb24gbW9kdWxlIGltcGxlbWVudGF0aW9uLiAgMDgtMDYtMTItIE12cwoJCXsKICAgICAgICAgICAgbmFtZToiaW52YWxpZEFyZ3VtZW50TnVtYmVyRXJyb3IiLAogICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiJGdW5jdGlvbiBmaWVsZCBpcyBjYWxsZWQgd2l0aCAxIG9yIDIgYXJndW1lbnRzIgogICAgICAgICAgICAgICAgICAgICB9OyAqLwogICAgICAgIH0KICAgIH07CgogICAgLy8gUmVjb3JkOnRvU3RyaW5nCiAgICAvLyBGdW5jdGlvbiB0aGF0IHJldHVybnMgdGhlIGNvbnRlbnRzIG9mIGZpZWxkQXJyYXkgYXMgc3RyaW5ncy4KICAgIC8vIENhbGxzIGZpZWxkLnRvU3RyaW5nIHdoaWNoIGNhbGxzIHN1YmZpZWxkLnRvU3RyaW5nCiAgICB0aGF0LnRvU3RyaW5nID0gZnVuY3Rpb24oICkgewogICAgICAgIHZhciBmaWVsZFN0cmluZyA9ICIiOwogICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IGZpZWxkQXJyYXkubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgICAgIGZpZWxkU3RyaW5nID0gZmllbGRTdHJpbmcgKyBmaWVsZEFycmF5WyBpIF0udG9TdHJpbmcoICkgKyAiXG4iOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmllbGRTdHJpbmc7CiAgICB9OwoKCiAgICAvLyBSZWNvcmQ6ZnJvbVN0cmluZwogICAgdGhhdC5mcm9tU3RyaW5nID0gZnVuY3Rpb24gKHN0cmluZykgewogICAgICAgIHZhciBCeXRlQXJyYXlJbnB1dFN0cmVhbSA9IFBhY2thZ2VzLmphdmEuaW8uQnl0ZUFycmF5SW5wdXRTdHJlYW07CiAgICAgICAgdmFyIERhbk1hcmMyTGluZUZvcm1hdFJlYWRlciA9IFBhY2thZ2VzLmRrLmRiYy5tYXJjLnJlYWRlci5EYW5NYXJjMkxpbmVGb3JtYXRSZWFkZXI7CiAgICAgICAgdmFyIERhbk1hcmMyQ2hhcnNldCA9IFBhY2thZ2VzLmRrLmRiYy5tYXJjLkRhbk1hcmMyQ2hhcnNldDsKICAgICAgICB2YXIgZGFuTWFyYzJDaGFyc2V0ID0gbmV3IERhbk1hcmMyQ2hhcnNldChEYW5NYXJjMkNoYXJzZXQuVmFyaWFudC5MSU5FX0ZPUk1BVCk7CiAgICAgICAgdmFyIERhdGFGaWVsZCA9IFBhY2thZ2VzLmRrLmRiYy5tYXJjLmJpbmRpbmcuRGF0YUZpZWxkOwogICAgICAgIHZhciBTdHJpbmcgPSBQYWNrYWdlcy5qYXZhLmxhbmcuU3RyaW5nOwogICAgICAgIHZhciBTdGFuZGFyZENoYXJzZXRzID0gUGFja2FnZXMuamF2YS5uaW8uY2hhcnNldC5TdGFuZGFyZENoYXJzZXRzOwoKICAgICAgICBfX2NsZWFyKCk7CiAgICAgICAgCiAgICAgICAgdmFyIGlzID0gbmV3IEJ5dGVBcnJheUlucHV0U3RyZWFtKG5ldyBTdHJpbmcoc3RyaW5nKS5nZXRCeXRlcyhTdGFuZGFyZENoYXJzZXRzLklTT184ODU5XzEpKTsKICAgICAgICB2YXIgcmVhZGVyID0gbmV3IERhbk1hcmMyTGluZUZvcm1hdFJlYWRlcihpcywgZGFuTWFyYzJDaGFyc2V0KTsKICAgICAgICB2YXIgbWFyY1JlY29yZCA9IHJlYWRlci5yZWFkKCk7CiAgICAgICAgdmFyIGZpZWxkcyA9IG1hcmNSZWNvcmQuZ2V0RmllbGRzKCkuaXRlcmF0b3IoKTsKICAgICAgICB3aGlsZSAoZmllbGRzLmhhc05leHQoKSkgewogICAgICAgICAgICB2YXIgZmllbGQgPSBmaWVsZHMubmV4dCgpOwogICAgICAgICAgICBpZiAoZmllbGQgaW5zdGFuY2VvZiBEYXRhRmllbGQpIHsKICAgICAgICAgICAgICAgIHZhciBsaW5lID0gbmV3IEZpZWxkKCk7CiAgICAgICAgICAgICAgICBsaW5lLm5hbWUgPSAiIiArIGZpZWxkLmdldFRhZygpOwogICAgICAgICAgICAgICAgbGluZS5pbmRpY2F0b3IgPSAiIiArIGZpZWxkLmdldEluZDEoKSArIGZpZWxkLmdldEluZDIoKTsKICAgICAgICAgICAgICAgIHZhciBzdWJmaWVsZHMgPSBmaWVsZC5nZXRTdWJmaWVsZHMoKS5pdGVyYXRvcigpOwogICAgICAgICAgICAgICAgd2hpbGUoc3ViZmllbGRzLmhhc05leHQoKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBzdWJmaWVsZCA9IHN1YmZpZWxkcy5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgbGluZS5hcHBlbmQobmV3IFN1YmZpZWxkKCIiICsgc3ViZmllbGQuZ2V0Q29kZSgpLCAiIiArIHN1YmZpZWxkLmdldERhdGEoKSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5hcHBlbmQobGluZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIHRoYXQuZGVjb2RlID0gZnVuY3Rpb24gKCBiaW5hcnkgKSB7CiAgICAgICAgdmFyIElzbzI3MDlVbnBhY2tlciA9ICBQYWNrYWdlcy5kay5kYmMubWFyYy5Jc28yNzA5VW5wYWNrZXI7CiAgICAgICAgdmFyIE5vZGUgPSBQYWNrYWdlcy5vcmcudzNjLmRvbS5Ob2RlOwogICAgICAgIHZhciBEYW5NYXJjMkNoYXJzZXQgPSBQYWNrYWdlcy5kay5kYmMubWFyYy5EYW5NYXJjMkNoYXJzZXQ7CiAgICAgICAgdmFyIGRhbk1hcmMyQ2hhcnNldCA9IG5ldyBEYW5NYXJjMkNoYXJzZXQoKTsKICAgICAgICB2YXIgbWFyY3ggPSBJc28yNzA5VW5wYWNrZXIuY3JlYXRlTWFyY1hDaGFuZ2VSZWNvcmQoYmluYXJ5LnRvT3V0cHV0Qnl0ZXMoKSwgZGFuTWFyYzJDaGFyc2V0KTsKCiAgICAgICAgX19jbGVhcigpOwoJCiAgICAgICAgdmFyIGNobGQgPSBtYXJjeC5nZXREb2N1bWVudEVsZW1lbnQoKS5nZXRGaXJzdENoaWxkKCk7CiAgICAgICAgd2hpbGUgKGNobGQgIT09IG51bGwpIHsKICAgICAgICAgICAgaWYgKGNobGQuZ2V0Tm9kZVR5cGUoKSA9PT0gTm9kZS5FTEVNRU5UX05PREUpIHsKICAgICAgICAgICAgICAgIHZhciBuYW1lID0gY2hsZC5nZXRMb2NhbE5hbWUoKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgaWYobmFtZSA9PT0gJ2xlYWRlcicpIHsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZihuYW1lID09PSAnY29udHJvbGZpZWxkJykgewogICAgICAgICAgICAgICAgICAgIHZhciBmaWVsZCA9IG5ldyBGaWVsZCgpOwogICAgICAgICAgICAgICAgICAgIGZpZWxkLm5hbWUgPSAiIiArIGNobGQuZ2V0QXR0cmlidXRlKCd0YWcnKTsKICAgICAgICAgICAgICAgICAgICBmaWVsZC52YWx1ZSA9ICIiICsgY2hsZC5nZXRUZXh0Q29udGVudCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kKGZpZWxkKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmFtZSA9PT0gJ2RhdGFmaWVsZCcpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGQgPSBuZXcgRmllbGQoKTsKICAgICAgICAgICAgICAgICAgICBmaWVsZC5uYW1lID0gIiIgKyBjaGxkLmdldEF0dHJpYnV0ZSgndGFnJyk7CiAgICAgICAgICAgICAgICAgICAgZmllbGQuaW5kaWNhdG9yID0gIiIgKyBjaGxkLmdldEF0dHJpYnV0ZSgnaW5kMScpICsgY2hsZC5nZXRBdHRyaWJ1dGUoJ2luZDInKTsKICAgICAgICAgICAgICAgICAgICB2YXIgc3ViID0gY2hsZC5nZXRGaXJzdENoaWxkKCk7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHN1YiAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3ViLmdldE5vZGVUeXBlKCkgPT09IE5vZGUuRUxFTUVOVF9OT0RFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IHN1Yi5nZXRMb2NhbE5hbWUoKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWUgPT09ICdzdWJmaWVsZCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3ViRmllbGQgPSBuZXcgU3ViZmllbGQoIiIgKyBzdWIuZ2V0QXR0cmlidXRlKCdjb2RlJyksICIiICsgc3ViLmdldFRleHRDb250ZW50KCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkLmFwcGVuZChzdWJGaWVsZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgc3ViID0gc3ViLmdldE5leHRTaWJsaW5nKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kKGZpZWxkKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgTG9nLndhcm4oIlVua25vd24gZWxlbWVudCB0eXBlIGluIHJlY29yZDogIiArIG5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNobGQgPSBjaGxkLmdldE5leHRTaWJsaW5nKCk7CiAgICAgICAgfQogICAgfTsKCiAgICAvLyBwcml2YXRlIGhlbHBlciBmdW5jdGlvbgogICAgLy8gRnVuY3Rpb24gaXMgdXNlZCBmb3IgcmVtb3ZpbmcgYSBmaWVsZCBmcm9tIHRoZSBmaWVsZGFycmF5LgogICAgLy8gVGFrZXMgMSBhcmd1bWVudCB3aGljaCBpcyB0aGUgaW5kZXggbnVtYmVyIG9mIHRoZSBhcnJheSBwb3NpdGlvbiBwZW5kaW5nIHJlbW92YWwKICAgIGZ1bmN0aW9uIHJlbW92ZUluZGV4T2ZGaWVsZEFycmF5KCBpbmRleEFyZyApIHsKICAgICAgICBpZiAoIGluZGV4QXJnID09PSAwICkgewogICAgICAgICAgICBmaWVsZEFycmF5LnNwbGljZSggMCwgMSApOwogICAgICAgIH0gZWxzZSBpZiAoIGluZGV4QXJnID09IGZpZWxkQXJyYXkubGVuZ3RoIC0gMSApIHsKICAgICAgICAgICAgZmllbGRBcnJheS5zcGxpY2UoICggZmllbGRBcnJheS5sZW5ndGggLSAxICksIDEgKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmaWVsZEFycmF5LnNwbGljZSggaW5kZXhBcmcsIDEgKTsKICAgICAgICB9CiAgICB9OwogICAgcmV0dXJuIHRoYXQ7Cn07Cg==", "moduleName": "MarcClassesCore"}, {"javascript": "LyoqIEBmaWxlIEluZnJhc3RydWN0dXJlIHN1cHBvcnQgZm9yIG1hcmMgY2xhc3NlcyAqLwovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovKiEKICAgIFxmaWxlIHRleHRjb2RlYy5qcwogICAgXGJyaWVmIAoqLwovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gICAgICAgICAgICAgICAgICAgICAgRXhwb3J0ZWQgU3ltYm9scwovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKRVhQT1JURURfU1lNQk9MUyA9IFsgJ2dldE1hdGNoRmllbGQnLCAnZ2V0TWF0Y2hTdWJGaWVsZCcsICdNYXRjaEZpZWxkJywgJ01hdGNoU3ViRmllbGQnLAogICAgJ0RCQ01hdGNoRmllbGQnLCAnU3RyaW5nTWF0Y2hGaWVsZCcsICdTdHJpbmdNYXRjaFN1YkZpZWxkJywgJ01hdGNoTWFwJywgJ01hdGNoRnVuYycKXTsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdsb2JhbCBoZWxwIGZ1bmN0aW9ucwovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKLyoqCiAqIENvbnZlcnRzIHRoZSBhcmd1bWVudCB0byBhIE1hdGNoRmllbGQgaW5zdGFuY2UuCiAqIAogKiBAcGFyYW0ge01hdGNoRmllbGR8UmVnRXhwfSBhcmcgQSBNYXRjaEZpZWxkIG9yIGEgcmVndWxhciBleHByZXNzaW9uIG9mIGZpZWxkIG5hbWVzLgogKiAKICogQHJldHVybiB7TWF0Y2hGaWVsZH0gVGhlIE1hdGNoRmllbGQgYWZ0ZXIgYXJnIGlzIGNvbnZlcnRlZCB0byBpdC4KICovCmZ1bmN0aW9uIGdldE1hdGNoRmllbGQoIGFyZyApIHsKICAgIGlmICggYXJnID09IHVuZGVmaW5lZCApIHsKICAgICAgICByZXR1cm4gbmV3IE1hdGNoRmllbGQoICk7CiAgICB9OwoKICAgIGlmICggYXJnIGluc3RhbmNlb2YgUmVnRXhwICkgewogICAgICAgIHJldHVybiBuZXcgTWF0Y2hGaWVsZCggYXJnICk7CiAgICB9OwogICAgLy8gSGFuZGxlIGJvdGggIjAwMCIgYW5kIG5ldyBTdHJpbmcoIjAwMCIpCiAgICBpZiAoIHR5cGVvZiBhcmcgPT09ICJzdHJpbmciICkgewogICAgICAgIHJldHVybiBuZXcgU3RyaW5nTWF0Y2hGaWVsZCggYXJnICk7CiAgICB9OwogICAgaWYgKCBhcmcgaW5zdGFuY2VvZiBTdHJpbmcgKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdNYXRjaEZpZWxkKCBTdHJpbmcoYXJnKSApOwogICAgfTsKCiAgICByZXR1cm4gYXJnOwp9OwoKZnVuY3Rpb24gZ2V0TWF0Y2hTdWJGaWVsZCggYXJnICkgewogICAgaWYgKCBhcmcgPT0gdW5kZWZpbmVkICkgewogICAgICAgIHJldHVybiBuZXcgTWF0Y2hTdWJGaWVsZCggKTsKICAgIH07CiAgICBpZiAoIGFyZyBpbnN0YW5jZW9mIFJlZ0V4cCApIHsKICAgICAgICByZXR1cm4gbmV3IE1hdGNoU3ViRmllbGQoIGFyZyApOwogICAgfTsKICAgIC8vIEhhbmRsZSBib3RoICIwMDAiIGFuZCBuZXcgU3RyaW5nKCIwMDAiKQogICAgaWYgKCB0eXBlb2YgYXJnID09PSAic3RyaW5nIikgewogICAgICAgIHJldHVybiBuZXcgU3RyaW5nTWF0Y2hTdWJGaWVsZCggYXJnICk7CiAgICB9OwogICAgaWYgKCBhcmcgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAgICByZXR1cm4gbmV3IFN0cmluZ01hdGNoU3ViRmllbGQoIFN0cmluZyhhcmcpICk7CiAgICB9OwoKICAgIHJldHVybiBhcmc7Cn07CgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovKiogRGVmaW5lcyBhIG1hdGNoZXIgb2JqZWN0IHRoYXQgY2FuIG1hdGNoIGEgZmllbGQuCiAqIAogKiBUaGlzIG9iamVjdCBpcyBtYWlubHkgdXNlZCB3aXRoIGZvciBpbnN0YW5jZSBSZWNvcmQuZWFjaEZpZWxkIHRvIHNwZWNpZnkgaG93IHRvIAogKiBtYXRjaCBlYWNoIGZpZWxkIHRoYXQgbmVlZHMgdG8gYmUgcHJvY2Vzc2VkLiAKICoKICogQHBhcmFtIHtSZWdFeHB9IGZpZWxkUGF0dGVybiBQYXR0ZXJuIHRvIG1hdGNoIGEgZmllbGQgbmFtZS4KICogQHBhcmFtIHtSZWdFeHB9IGluZGljYXRvclBhdHRlcm4gUGF0dGVybiB0byBtYXRjaCBhIGZpZWxkIGluZGljYXRvci4KICogQHBhcmFtIHtSZWdFeHB9IHN1YkZpZWxkUGF0dGVybiBQYXR0ZXJuIHRvIG1hdGNoIGEgc3RyaW5nIHdpdGggYWxsIHN1YiBmaWVsZCBuYW1lcyAKICogCQkgIGluIHRoZSBmaWVsZC4KICogQHBhcmFtIHtOdW1iZXJ9IG1pbiBNaW5pbXVtIG9jY3VycmVuY2Ugb2YgdGhlIGZpZWxkIHRvIGJlIG1hdGNoZWQuICAgCiAqIEBwYXJhbSB7TnVtYmVyfSBtYXggTWF4aW11bSBvY2N1cnJlbmNlIG9mIHRoZSBmaWVsZCB0byBiZSBtYXRjaGVkLiAgIAogKiBAY29uc3RydWN0b3IKICogQHNlZSBNYXJjQ2xhc3NlcwogKiBAc2VlIFJlY29yZAogKiBAc2VlIEZpZWxkCiAqIEBuYW1lIE1hdGNoRmllbGQgKi8KZnVuY3Rpb24gTWF0Y2hGaWVsZCggZmllbGRQYXR0ZXJuLCBpbmRpY2F0b3JQYXR0ZXJuLCBzdWJGaWVsZFBhdHRlcm4sIG1pbiwgbWF4ICkgewogICAgdGhpcy5maWVsZFBhdHRlcm4gPSBmaWVsZFBhdHRlcm47CiAgICB0aGlzLmluZGljYXRvclBhdHRlcm4gPSBpbmRpY2F0b3JQYXR0ZXJuOwogICAgdGhpcy5zdWJGaWVsZFBhdHRlcm4gPSBzdWJGaWVsZFBhdHRlcm47CiAgICB0aGlzLm1pbiA9IG1pbjsKICAgIHRoaXMubWF4ID0gbWF4OwogICAgaWYgKCB0aGlzLm1heCA9PT0gdW5kZWZpbmVkICkgewogICAgICAgIHRoaXMubWF4ID0gdGhpcy5taW47CiAgICB9OwoKICAgIHRoaXMubWF0Y2hDb3VudGVyID0gbmV3IE9iamVjdDsKfTsKCk1hdGNoRmllbGQucHJvdG90eXBlLm1hdGNoRmllbGQgPSBmdW5jdGlvbiggcmVjb3JkLCBmaWVsZCApIHsKICAgIGlmICggdGhpcy5maWVsZFBhdHRlcm4gIT0gdW5kZWZpbmVkICYmICF0aGlzLmZpZWxkUGF0dGVybi50ZXN0KCBmaWVsZC5uYW1lICkgKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfTsKCiAgICBpZiAoIHRoaXMuaW5kaWNhdG9yUGF0dGVybiAhPSB1bmRlZmluZWQgJiYgIXRoaXMuaW5kaWNhdG9yUGF0dGVybi50ZXN0KCBmaWVsZC5pbmRpY2F0b3IgKSApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9OwoKICAgIGlmICggdGhpcy5zdWJGaWVsZFBhdHRlcm4gIT0gdW5kZWZpbmVkICkgewogICAgICAgIHZhciBzdWJGaWVsZHMgPSAiIjsKICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBmaWVsZC5jb3VudCggKTsgaSsrICkgewogICAgICAgICAgICBzdWJGaWVsZHMgKz0gZmllbGQuc3ViZmllbGQoIGkgKS5uYW1lOwogICAgICAgIH07CgogICAgICAgIGlmICggIXRoaXMuc3ViRmllbGRQYXR0ZXJuLnRlc3QoIHN1YkZpZWxkcyApICkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfTsKICAgIH07CgogICAgdmFyIHYgPSB0aGlzLm1hdGNoQ291bnRlclsgZmllbGQubmFtZSBdOwogICAgaWYgKCB2ID09PSB1bmRlZmluZWQgKSB7CiAgICAgICAgdiA9IDA7CiAgICB9OwogICAgdisrOwogICAgdGhpcy5tYXRjaENvdW50ZXJbIGZpZWxkLm5hbWUgXSA9IHY7CgogICAgcmV0dXJuICggdGhpcy5taW4gPT09IHVuZGVmaW5lZCB8fCB0aGlzLm1pbiA8PSB2ICkgJiYgKCB0aGlzLm1heCA9PT0gdW5kZWZpbmVkIHx8IHYgPD0gdGhpcy5tYXggKTsKfTsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8qIQogICAgXGJyaWVmIAoqLwoKZnVuY3Rpb24gTWF0Y2hTdWJGaWVsZCggbmFtZVBhdHRlcm4sIHZhbHVlUGF0dGVybiApIHsKICAgIHRoaXMubmFtZVBhdHRlcm4gPSBuYW1lUGF0dGVybjsKICAgIHRoaXMudmFsdWVQYXR0ZXJuID0gdmFsdWVQYXR0ZXJuOwp9OwoKTWF0Y2hTdWJGaWVsZC5wcm90b3R5cGUubWF0Y2hTdWJGaWVsZCA9IGZ1bmN0aW9uKCBmaWVsZCwgc3ViRmllbGQgKSB7CiAgICBpZiAoIHRoaXMubmFtZVBhdHRlcm4gIT0gdW5kZWZpbmVkICkgewogICAgICAgIGlmICggIXRoaXMubmFtZVBhdHRlcm4udGVzdCggc3ViRmllbGQubmFtZSApICkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfTsKICAgIH07CgogICAgaWYgKCB0aGlzLnZhbHVlUGF0dGVybiAhPSB1bmRlZmluZWQgKSB7CiAgICAgICAgaWYgKCAhdGhpcy52YWx1ZVBhdHRlcm4udGVzdCggc3ViRmllbGQudmFsdWUgKSApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH07CiAgICB9OwoKICAgIHJldHVybiB0cnVlOwp9OwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLyohCiAgICBcYnJpZWYKKi8KCmZ1bmN0aW9uIERCQ01hdGNoRmllbGQoIGZpZWxkUGF0dGVybiwgc3ViRmllbGRQYXR0ZXJuICkgewogICAgdGhpcy5pbXBsID0gbmV3IE1hdGNoRmllbGQoIGZpZWxkUGF0dGVybiwgdW5kZWZpbmVkLCBzdWJGaWVsZFBhdHRlcm4gKTsKfTsKCkRCQ01hdGNoRmllbGQucHJvdG90eXBlLm1hdGNoRmllbGQgPSBmdW5jdGlvbiggcmVjb3JkLCBmaWVsZCApIHsKICAgIHJldHVybiB0aGlzLmltcGwubWF0Y2hGaWVsZCggcmVjb3JkLCBmaWVsZCApOwp9OwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLyohCiAgICBcYnJpZWYKKi8KCmZ1bmN0aW9uIFN0cmluZ01hdGNoRmllbGQoIGZpZWxkTmFtZSApIHsKICAgIHRoaXMuZmllbGROYW1lICA9IGZpZWxkTmFtZTsKfTsKClN0cmluZ01hdGNoRmllbGQucHJvdG90eXBlLm1hdGNoRmllbGQgPSBmdW5jdGlvbiggcmVjb3JkLCBmaWVsZCApIHsKICAgIHJldHVybiB0aGlzLmZpZWxkTmFtZSA9PT0gZmllbGQubmFtZTsKfTsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8qIQogICAgXGJyaWVmCiovCgpmdW5jdGlvbiBTdHJpbmdNYXRjaFN1YkZpZWxkKCBzdWJGaWVsZE5hbWUgKSB7CiAgICB0aGlzLnN1YkZpZWxkTmFtZSAgPSBzdWJGaWVsZE5hbWU7Cn07CgpTdHJpbmdNYXRjaFN1YkZpZWxkLnByb3RvdHlwZS5tYXRjaFN1YkZpZWxkID0gZnVuY3Rpb24oIGZpZWxkLCBzdWJGaWVsZCApIHsKICAgIHJldHVybiB0aGlzLnN1YkZpZWxkTmFtZSA9PT0gc3ViRmllbGQubmFtZTsKfTsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8qKiBEZWZpbmVzIGFuIG9iamVjdCBmb3IgbWF0Y2hpbmcgZmllbGRzIG9yIHN1YmZpZWxkcyB1c2luZyBhIG1hcC4KICoKICogVGhpcyBvYmplY3QgaXMgbWFpbmx5IHVzZWQgd2l0aCBmb3IgaW5zdGFuY2UgUmVjb3JkLmVhY2hGaWVsZE1hcCB0byBzcGVjaWZ5IGhvdyB0bwogKiBtYXRjaCBlYWNoIGZpZWxkIHRoYXQgbmVlZHMgdG8gYmUgcHJvY2Vzc2VkLgogKgogKiBAY29uc3RydWN0b3IKICogQHNlZSBNYXJjQ2xhc3NlcwogKiBAc2VlIFJlY29yZAogKiBAc2VlIEZpZWxkCiAqIEBuYW1lIE1hdGNoTWFwICovCmZ1bmN0aW9uIE1hdGNoTWFwKCkgewogICAgLy8gdGhpcy5mdW5jdGlvbnMgaXMgYSBtYXAgb2YgZmllbGQgbmFtZSB0byBhcnJheSBvZiBmdW5jdGlvbnMKICAgIHRoaXMuZnVuY3Rpb25zID0gbmV3IE9iamVjdDsKfTsKCi8qKgogKiBNYXAgb25lIG9yIG1vcmUgZmllbGQgbmFtZXMgdG8gZnVuY3Rpb25zCiAqCiAqIE9uZXcgb3IgbW9yZSBmaWVsZCBuYW1lcyBjYW4gYmUgbWFwcGVkIHRvIGEgZnVuY3Rpb24KICoKICogQHBhcmFtIHtzdHJpbmd9IGZpZWxkbmFtZSBvbmUgb3IgbW9yZSBmaWVsZCBuYW1lcyB0byBtYXAgdG8gdGhlIGdpdmVuIGZ1bmN0aW9uCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgUGF0dGVybiB0byBtYXRjaCBhIGZpZWxkIGluZGljYXRvci4KICogbWV0aG9kCiAqIEBzZWUgTWFyY0NsYXNzZXMKICogQHNlZSBSZWNvcmQKICogQHNlZSBGaWVsZAogKiBAbmFtZSBNYXRjaEZpZWxkLnB1dAogKiBAZXhhbXBsZQp2YXIgbWFwID0gbmV3IE1hdGNoTWFwKCk7Cm1hcC5wdXQoIjAwMSIsICIwMDIiLCBmdW5jdGlvbihmaWVsZCkgewogICAgLy8gSGFuZGxlIGZpZWxkIDAwMSBhbmQgMDAyCn0pOwpyZWNvcmQuZWFjaEZpZWxkTWFwKG1hcCkKICogKi8KTWF0Y2hNYXAucHJvdG90eXBlLnB1dCA9IGZ1bmN0aW9uICgpIHsKICAgIC8vIEZ1bmN0aW9uIGlzIGxhc3QgYXJndW1lbnQKICAgIHZhciBmdW5jID0gYXJndW1lbnRzW2FyZ3VtZW50cy5sZW5ndGgtMV07CiAgICB2YXIgX21hcEZ1bmN0aW9uID0gZnVuY3Rpb24odGhpc0Z1bmN0aW9ucywgZk5hbWUsIHRoZUZ1bmN0aW9uKSB7CiAgICAgICAgdmFyIGZpZWxkRnVuY3Rpb25zID0gdGhpc0Z1bmN0aW9uc1tmTmFtZV07CiAgICAgICAgaWYgKGZpZWxkRnVuY3Rpb25zID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgZmllbGRGdW5jdGlvbnMgPSBbXTsKICAgICAgICAgICAgdGhpc0Z1bmN0aW9uc1tmTmFtZV0gPSBmaWVsZEZ1bmN0aW9uczsKICAgICAgICB9CiAgICAgICAgZmllbGRGdW5jdGlvbnMucHVzaCh0aGVGdW5jdGlvbik7CiAgICB9OwogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHsKICAgICAgICB2YXIgZmllbGROYW1lID0gYXJndW1lbnRzWzBdOwogICAgICAgIF9tYXBGdW5jdGlvbih0aGlzLmZ1bmN0aW9ucywgZmllbGROYW1lLCBmdW5jKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGZpZWxkTmFtZXMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCggYXJndW1lbnRzLCAwLCBhcmd1bWVudHMubGVuZ3RoIC0gMSApOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmllbGROYW1lcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgZmllbGROYW1lID0gZmllbGROYW1lc1tpXTsKICAgICAgICAgICAgX21hcEZ1bmN0aW9uKHRoaXMuZnVuY3Rpb25zLCBmaWVsZE5hbWUsIGZ1bmMpOwogICAgICAgIH0KICAgIH0KfTsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8qIQogICAgXGJyaWVmIE9iamVjdCB0aGF0IGNhbiBtYXRjaCBmaWVsZHMgaW4gYSByZWNvcmQgYW5kIGNhbGwgYSBmdW5jdGlvbiBvbiBlYWNoIG9mIHRoZW0uICAgIAoqLwoKZnVuY3Rpb24gTWF0Y2hGdW5jKCBmdW5jTWF0Y2hlciApIHsKICAgIHRoaXMuZnVuY01hdGNoZXIgPSBmdW5jTWF0Y2hlcjsKfTsKCk1hdGNoRnVuYy5wcm90b3R5cGUubWF0Y2hGaWVsZCA9IGZ1bmN0aW9uKCByZWNvcmQsIGZpZWxkICkgewogICAgaWYgKCB0aGlzLmZ1bmNNYXRjaGVyICE9IHVuZGVmaW5lZCApIHsKICAgICAgICByZXR1cm4gdGhpcy5mdW5jTWF0Y2hlciggZmllbGQgKTsKICAgIH07CgogICAgcmV0dXJuIGZhbHNlOwp9OwoKTWF0Y2hGdW5jLnByb3RvdHlwZS5tYXRjaFN1YkZpZWxkID0gZnVuY3Rpb24oIHJlY29yZCwgZmllbGQsIHN1YkZpZWxkICkgewogICAgaWYgKCB0aGlzLmZ1bmNNYXRjaGVyICE9IHVuZGVmaW5lZCApIHsKICAgICAgICByZXR1cm4gdGhpcy5mdW5jTWF0Y2hlciggc3ViRmllbGQgKTsKICAgIH07CgogICAgcmV0dXJuIGZhbHNlOwp9Owo=", "moduleName": "MarcMatchers"}, {"javascript": "CkVYUE9SVEVEX1NZTUJPTFMgPSBbICdOb2RlVHlwZXMnIF07Cgp2YXIgTm9kZVR5cGVzID0gIHsKICAgIEVMRU1FTlRfTk9ERSA6IDEsCiAgICBBVFRSSUJVVEVfTk9ERSA6IDIsCiAgICBURVhUX05PREUgOiAzLAogICAgQ0RBVEFfU0VDVElPTl9OT0RFIDogNCwKICAgIEVOVElUWV9SRUZFUkVOQ0VfTk9ERSA6IDUsCiAgICBFTlRJVFlfTk9ERSA6IDYsCiAgICBQUk9DRVNTSU5HX0lOU1RSVUNUSU9OX05PREUgOiA3LAogICAgQ09NTUVOVF9OT0RFIDogOCwKICAgIERPQ1VNRU5UX05PREUgOiA5LAogICAgRE9DVU1FTlRfVFlQRV9OT0RFIDogMTAsCiAgICBET0NVTUVOVF9GUkFHTUVOVF9OT0RFIDogMTEsCiAgICBOT1RBVElPTl9OT0RFIDogMTIKfTs=", "moduleName": "NodeTypes"}, {"javascript": "LyoqIEBmaWxlIE1hcmNYY2hhbmdlVXRpbCBtb2R1bGUgICovDQoNCg0KRVhQT1JURURfU1lNQk9MUyA9IFsgJ01hcmNYY2hhbmdlVXRpbCcgXTsNCg0KdXNlKCAiTG9nIiApOw0KdXNlKCAiWG1sVXRpbCIgKTsNCg0KDQovKioNCiAqIE1vZHVsZSB0aGF0IGluY2x1ZGVzIGRpZmZlcmVudCBmdW5jdGlvbnMgZm9yIG1vZGlmeWluZyBtYXJjWGNoYW5nZSByZWNvcmRzDQogKg0KICogQHR5cGUge25hbWVzcGFjZX0NCiAqIEBuYW1lc3BhY2UNCiAqLw0KDQp2YXIgTWFyY1hjaGFuZ2VVdGlsID0gZnVuY3Rpb24oKSB7DQoNCiAgICAvKioNCiAgICAgKiBNZXRob2QgdGhhdCByZW1vdmVzIGFsbCBsZXR0ZXIgZmllbGRzIGxpa2UgZDA5IGFuZCBzMTAgZnJvbSBhIG1hcnhDaGFuZ2UgcmVjb3JkDQogICAgICoNCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259DQogICAgICogQHN5bnRheCBNYXJjWGNoYW5nZVV0aWwucmVtb3ZlTGV0dGVyRmllbGRzKCByZWNvcmQgKQ0KICAgICAqIEBwYXJhbSB7RG9jdW1lbnR9IHJlY29yZCB0aGUgbWFyY1hjaGFuZ2UgcmVjb3JkDQogICAgICogQGZ1bmN0aW9uDQogICAgICogQHJldHVybiB7RG9jdW1lbnR9IHRoZSBtYXJjWGNoYW5nZSByZWNvcmQgd2l0aG91dCBsZXR0ZXIgZmllbGRzDQogICAgICogQG5hbWUgTWFyY1hjaGFuZ2VVdGlsLnJlbW92ZUxldHRlckZpZWxkcw0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJlbW92ZUxldHRlckZpZWxkcyggcmVjb3JkICkgew0KDQogICAgICAgIExvZy5pbmZvKCAiRW50ZXJpbmc6IE1hcmNYY2hhbmdlVXRpbC5yZW1vdmVMZXR0ZXJGaWVsZHMgZnVuY3Rpb24iICk7DQoNCiAgICAgICAgdmFyIGVsZW1lbnRzID0gWFBhdGguc2VsZWN0KCAiL21hcmN4OmNvbGxlY3Rpb24vbWFyY3g6cmVjb3JkL21hcmN4OmRhdGFmaWVsZCIsIHJlY29yZCApOw0KDQogICAgICAgIGZvciAoIHZhciBpbmRleCA9IDA7IGluZGV4IDwgZWxlbWVudHMubGVuZ3RoOyBpbmRleCsrICkgew0KDQogICAgICAgICAgICB2YXIgY2hpbGQgPSBlbGVtZW50c1sgaW5kZXggXTsNCg0KICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IFhQYXRoLnNlbGVjdE5vZGUoICJAdGFnIiwgY2hpbGQgKTsNCiAgICAgICAgICAgIGlmICggYXR0cmlidXRlLnZhbHVlLm1hdGNoKCAvW2Etel0vaSApICkgew0KICAgICAgICAgICAgICAgIFhtbFV0aWwuZGVsZXRlTm9kZSggY2hpbGQgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIExvZy5pbmZvKCAiTGVhdmluZzogTWFyY1hjaGFuZ2VVdGlsLnJlbW92ZUxldHRlckZpZWxkcyBmdW5jdGlvbiIgKTsNCiAgICAgICAgcmV0dXJuIHJlY29yZDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBNZXRob2QgdGhhdCBjaGFuZ2VzIHRoZSB2YWx1ZSBvZiAwMDFiIGluIGFsbCBtYXJjeDpyZWNvcmRzIGluIGEgbWFyY3g6Y29sbGVjdGlvbg0KICAgICAqDQogICAgICogQHR5cGUge2Z1bmN0aW9ufQ0KICAgICAqIEBzeW50YXggTWFyY1hjaGFuZ2VVdGlsLmNoYW5nZTAwMWJWYWx1ZSggcmVjb3JkQ29sbGVjdGlvbiApDQogICAgICogQHBhcmFtIHtEb2N1bWVudH0gcmVjb3JkQ29sbGVjdGlvbiB0aGUgbWFyY1hjaGFuZ2UgcmVjb3JkIGNvbGxlY3Rpb24NCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmV3MDAxYlZhbHVlIHRoZSBuZXcgMDAxYiB2YWx1ZQ0KICAgICAqIEBmdW5jdGlvbg0KICAgICAqIEByZXR1cm4ge0RvY3VtZW50fSB0aGUgbWFyY1hjaGFuZ2UgcmVjb3JkIGNvbGxlY3Rpb24gd2l0aCBjb3JyZWN0ZWQgdmFsdWUgaW4gYWxsIDAwMWIgZmllbGRzDQogICAgICogQG5hbWUgTWFyY1hjaGFuZ2VVdGlsLmNoYW5nZTAwMWJWYWx1ZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNoYW5nZTAwMWJWYWx1ZSggcmVjb3JkQ29sbGVjdGlvbiwgbmV3MDAxYlZhbHVlICkgew0KDQogICAgICAgIExvZy5pbmZvKCAiRW50ZXJpbmc6IE1hcmNYY2hhbmdlVXRpbC5jaGFuZ2UwMDFiVmFsdWUgZnVuY3Rpb24iICk7DQoNCiAgICAgICAgdmFyIGZpZWxkczAwMWIgPSBYUGF0aC5zZWxlY3QoICIvbWFyY3g6Y29sbGVjdGlvbi9tYXJjeDpyZWNvcmQvbWFyY3g6ZGF0YWZpZWxkW0B0YWc9JzAwMSddL21hcmN4OnN1YmZpZWxkW0Bjb2RlPSdiJ10iLCByZWNvcmRDb2xsZWN0aW9uICk7DQoNCiAgICAgICAgZm9yICggdmFyIGluZGV4ID0gMDsgaW5kZXggPCBmaWVsZHMwMDFiLmxlbmd0aDsgaW5kZXgrKyApIHsNCiAgICAgICAgICAgIHZhciBjaGlsZCA9IGZpZWxkczAwMWJbIGluZGV4IF07DQogICAgICAgICAgICBYbWxVdGlsLmFwcGVuZFRleHQoIGNoaWxkLCBTdHJpbmcoIG5ldzAwMWJWYWx1ZSApLCB0cnVlICk7DQogICAgICAgIH0NCg0KICAgICAgICBMb2cuaW5mbyggIkxlYXZpbmc6IE1hcmNYY2hhbmdlVXRpbC5jaGFuZ2UwMDFiVmFsdWUgZnVuY3Rpb24iICk7DQogICAgICAgIHJldHVybiByZWNvcmRDb2xsZWN0aW9uOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIE1ldGhvZCB0aGF0IHJlbW92ZXMgdW53YW50ZWQgYXN0ZXJpc2tzIGZyb20gZmllbGQgMDE1LCAwMTYsIDA4MiwgMDgzIGFuZCAyNDUNCiAgICAgKg0KICAgICAqIEB0eXBlIHtmdW5jdGlvbn0NCiAgICAgKiBAc3ludGF4IE1hcmNYY2hhbmdlVXRpbC5yZW1vdmVBc3Rlcmlza3MoIHhtbFJlY29yZCApDQogICAgICogQHBhcmFtIHtEb2N1bWVudH0geG1sUmVjb3JkIFRoZSBvcmlnaW5hbCBkYXRhIHRoYXQgbmVlZHMgbm9ybWFsaXphdGlvbg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbmFtZXNwYWNlXSBUaGUgbmFtZXNwYWNlIG9mIHRoZSBtYXJjIHhtbCByZWNvcmQgLSBkZWZhdWx0IGlzIG14IG1hcmMyMSBzbGltDQogICAgICogQGZ1bmN0aW9uDQogICAgICogQG5hbWUgTWFyY1hjaGFuZ2VVdGlsLnJlbW92ZUFzdGVyaXNrcw0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJlbW92ZUFzdGVyaXNrcyggeG1sUmVjb3JkLCBuYW1lc3BhY2UgKSB7DQoNCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmcgTWFyY1hjaGFuZ2VVdGlsLnJlbW92ZUFzdGVyaXNrcyIgKTsNCiAgICAgICAgaWYgKCB1bmRlZmluZWQgPT09IG5hbWVzcGFjZSApIHsNCiAgICAgICAgICAgIG5hbWVzcGFjZSA9ICJteCI7DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgZmllbGROYW1lQXJyYXkgPSBbICIwMTUiLCAiMDE2IiwgIjA4MiIsICIwODMiLCAiMjQ1IiBdOw0KICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBmaWVsZE5hbWVBcnJheS5sZW5ndGg7IGkrKyApIHsNCiAgICAgICAgICAgIHZhciBwYXRoID0gIi8iICsgbmFtZXNwYWNlICsgIjpyZWNvcmQvIiArIG5hbWVzcGFjZSArICI6ZGF0YWZpZWxkWyBAdGFnPSIgKyBmaWVsZE5hbWVBcnJheVsgaSBdICsgIiBdLyIgKyBuYW1lc3BhY2UgKyAiOnN1YmZpZWxkIjsNCiAgICAgICAgICAgIHZhciBlbGVtZW50cyA9IFhQYXRoLnNlbGVjdCggcGF0aCwgeG1sUmVjb3JkICk7DQogICAgICAgICAgICBmb3IgKCB2YXIgaiA9IDA7IGogPCBlbGVtZW50cy5sZW5ndGg7IGorKyApIHsNCiAgICAgICAgICAgICAgICB2YXIgaW5wdXRUZXh0ID0gWG1sVXRpbC5nZXRUZXh0KCBlbGVtZW50c1sgaiBdICk7DQogICAgICAgICAgICAgICAgZWxlbWVudHNbIGogXS5maXJzdENoaWxkLm5vZGVWYWx1ZSA9IGlucHV0VGV4dC5yZXBsYWNlKCAvXCpcKlwqL2csICIiICkucmVwbGFjZSggLyAgL2csICIgIik7DQogICAgICAgICAgICAgICAgdmFyIG5ld1RleHQgPSBYbWxVdGlsLmdldFRleHQoIGVsZW1lbnRzWyBqIF0gKTsNCiAgICAgICAgICAgICAgICBMb2cuZGVidWcoICJDaGFuZ2VkIHN1YmZpZWxkIHZhbHVlIGZyb20gJyIsIGlucHV0VGV4dCwgIicgdG8gJyIsIG5ld1RleHQsICInLiIgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmcgTWFyY1hjaGFuZ2VVdGlsLnJlbW92ZUFzdGVyaXNrcyIgKTsNCg0KICAgIH0NCg0KICAgIHJldHVybiB7DQogICAgICAgIHJlbW92ZUxldHRlckZpZWxkczogcmVtb3ZlTGV0dGVyRmllbGRzLA0KICAgICAgICBjaGFuZ2UwMDFiVmFsdWU6IGNoYW5nZTAwMWJWYWx1ZSwNCiAgICAgICAgcmVtb3ZlQXN0ZXJpc2tzOiByZW1vdmVBc3Rlcmlza3MNCiAgICB9Ow0KDQoNCn0oKTsNCg0KLy9Vbml0dGVzdHMgYXJlIGluIE1hcmNYY2hhbmdlVXRpbC50ZXN0LmpzDQo=", "moduleName": "MarcXchangeUtil"}, {"javascript": "LyoqIEBmaWxlIE1vZHVsZSB0aGF0IGFkZHMgc3VwcG9ydCBmb3IgeG1sIGNvbnZlcnNpb25zIG9mIFJlY29yZCBvYmplY3RzLiAqLwoKLy8gT25seSB2ZXJ5IGxpbWl0ZWQgaW50ZXJuYWwgZXJyb3IgY2hlY2tpbmcgaXMgcGVyZm9ybWVkLiBCYXNpY2FsbHksIGl0IGlzCi8vIGFzc3VtZWQsIHRoYXQgdGhlIFhNTCBpbnB1dCBpcyBsZWdhbC4gSWYgbm90LCB3ZWlyZCByZXN1bHRzIG1heSBvY2N1ci4KCnVzZSggIlhtbE5hbWVzcGFjZXMiICk7IC8vIFByb3ZpZGVzIFhNTCBuYW1lc3BhY2VzCnVzZSggIlhtbFV0aWwiICk7IC8vIFByb3ZpZGVzIFhNTCBjcmVhdGlvbiBmdW5jdGlvbnMKdXNlKCAiTWFyY0NsYXNzZXMiICk7IC8vIE5lZWQgdGhlIGJhc2ljIHJlY29yZCBjbGFzc2VzLgp1c2UoICJNYXJjIiApOyAvLyBUaGlzIG1vZHVsZSB1c2VzIHRoZSBlYWNoRmllbGQgbWV0aG9kIGZyb20gTWFyYwp1c2UoICJVdGlsIiApOyAvLyBGb3IgZ2V0VHlwZSBzdXBwb3J0CgpFWFBPUlRFRF9TWU1CT0xTID0gWyAiTWFyY1hjaGFuZ2UiIF07CgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKLyoqCiAqIE1vZHVsZSB0byBoYW5kbGUgY29udmVyc2lvbiBmcm9tIGEgbWFyYyByZWNvcmQgcmVwcmVzZW50ZWQgYXMgTWFyY1hjaGFuZ2UgWE1MIHRvIGEKICogSmF2YXNjcmlwdCBNYXJjIFJlY29yZCBPYmplY3QgKGFzIGRlZmluZWQgaW4gdGhlIE1hcmNDbGFzc2VzIG1vZHVsZSkgb3IgdGhlIG90aGVyIHdheSBhcm91bmQuCiAqCiAqIFRoZSBtb2R1bGUgY29udGFpbnMgdHdvIG1ldGhvZHMgbWFyY1hjaGFuZ2VUb01hcmNSZWNvcmQgYW5kIG1hcmNSZWNvcmRUb01hcmNYY2hhbmdlLgogKgogKiBAdHlwZSB7bmFtZXNwYWNlfQogKiBAbmFtZSBNYXJjWGNoYW5nZQogKiBAc2VlIE1hcmNDbGFzc2VzCiAqIEBuYW1lc3BhY2UgKi8KdmFyIE1hcmNYY2hhbmdlID0gZnVuY3Rpb24oKSB7CgogICAgTG9nLmluZm8oICJFbnRlcmluZyBNYXJjWGNoYW5nZSBtb2R1bGUiICk7CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgTWFyY1hjaGFuZ2UgWE1MIHN0cmluZyBvciBvYmplY3QgdG8gYSBKYXZhc2NyaXB0IE1hcmMgUmVjb3JkIE9iamVjdC4KICAgICAqCiAgICAgKiBUaGlzIGZ1bmN0aW9uIHRha2UgYSBzdHJpbmcgd2l0aCBhbiBNYXJjWENoYW5nZSBYTUwgb2JqZWN0LCBhbmQgY29udmVydHMgaXQgdG8gYSBSZWNvcmQgb2JqZWN0LgogICAgICoKICAgICAqICoqTm90ZToqKiBUaGlzIGZ1bmN0aW9uIGF0IHRoZSBtb21lbnQgb25seSBoYW5kbGVzIGlucHV0IGZyb20gZGFuTUFSQzIgcmVjb3JkcyByZXByZXNlbnRlZCBhcwogICAgICogTWFyY1hjaGFuZ2UuIElmIGEgbWFyYzIxIE1hcmNYY2hhbmdlIHJlY29yZCBpcyBwYXNzZWQgdG8gdGhlIGZ1bmN0aW9uLCBjb250cm9sIGZpZWxkcyBhbmQgdGhlIGluZm9ybWF0aW9uCiAgICAgKiBmcm9tIHRoZSBsZWFkZXIgd2lsbCBub3QgYmUgcmVwcmVzZW50ZWQgaW4gdGhlIG91dHB1dCBSZWNvcmQgb2JqZWN0CiAgICAgKiB1c2UgbWFyY1hjaGFuZ2VNMjFUb01hcmNSZWNvcmQgdG8gZG8gdGhpcwogICAgICoKICAgICAqIEB0eXBlIHttZXRob2R9CiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBzeW50YXggTWFyY1hjaGFuZ2UubWFyY1hjaGFuZ2VUb01hcmNSZWNvcmQoIHhtbCApCiAgICAgKiBAcGFyYW0ge3N0cmluZ3xYTUx8dW5kZWZpbmVkfSB4bWwgU3RyaW5nIG9yIFhNTCByZXByZXNlbnRhdGlvbiBvZiBhbiBtYXJjWGNoYW5nZSByZWNvcmQKICAgICAqIEByZXR1cm4ge1JlY29yZH0gSmF2YVNjcmlwdCBNYXJjIE9iamVjdAogICAgICogQHNlZSBSZWNvcmQKICAgICAqIEBleGFtcGxlCiAgICAgKiB4bWwgPSAnPG1hcmN4OnJlY29yZCBmb3JtYXQ9ImRhbk1BUkMyIiB0eXBlPSJCaWJsaW9ncmFwaGljIiB4bWxuczptYXJjeD0iaW5mbzpsYy94bWxucy9tYXJjeGNoYW5nZS12MSI+JysKICAgICAqICc8bWFyY3g6bGVhZGVyPjAwMDAwbiAgICAyMjAwMDAwICAgNDUwMDwvbWFyY3g6bGVhZGVyPicrCiAgICAgKiAnPG1hcmN4OmRhdGFmaWVsZCB0YWc9IjAwMSIgaW5kMT0iMCIgaW5kMj0iMCI+PG1hcmN4OnN1YmZpZWxkIGNvZGU9ImEiPjAgMzk3IDk0MCA3PC9tYXJjeDpzdWJmaWVsZD48bWFyY3g6c3ViZmllbGQgY29kZT0iYiI+ODcwOTcwPC9tYXJjeDpzdWJmaWVsZD48bWFyY3g6c3ViZmllbGQgY29kZT0iYyI+MTk4NTAzMjk8L21hcmN4OnN1YmZpZWxkPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJkIj4xOTg1MDMyOTwvbWFyY3g6c3ViZmllbGQ+PG1hcmN4OnN1YmZpZWxkIGNvZGU9ImYiPmE8L21hcmN4OnN1YmZpZWxkPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJvIj5jPC9tYXJjeDpzdWJmaWVsZD48L21hcmN4OmRhdGFmaWVsZD4nKwogICAgICogJzxtYXJjeDpkYXRhZmllbGQgdGFnPSIwMDQiIGluZDE9IjAiIGluZDI9IjAiPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJyIj5uPC9tYXJjeDpzdWJmaWVsZD48bWFyY3g6c3ViZmllbGQgY29kZT0iYSI+ZTwvbWFyY3g6c3ViZmllbGQ+PC9tYXJjeDpkYXRhZmllbGQ+JysKICAgICAqICc8bWFyY3g6ZGF0YWZpZWxkIHRhZz0iMDA4IiBpbmQxPSIwIiBpbmQyPSIwIj48bWFyY3g6c3ViZmllbGQgY29kZT0idCI+czwvbWFyY3g6c3ViZmllbGQ+PG1hcmN4OnN1YmZpZWxkIGNvZGU9InUiPnU8L21hcmN4OnN1YmZpZWxkPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJhIj4xOTY4PC9tYXJjeDpzdWJmaWVsZD48bWFyY3g6c3ViZmllbGQgY29kZT0iYiI+ZGs8L21hcmN4OnN1YmZpZWxkPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJqIj5wPC9tYXJjeDpzdWJmaWVsZD48bWFyY3g6c3ViZmllbGQgY29kZT0ibCI+ZGFuPC9tYXJjeDpzdWJmaWVsZD48bWFyY3g6c3ViZmllbGQgY29kZT0idiI+MTwvbWFyY3g6c3ViZmllbGQ+PC9tYXJjeDpkYXRhZmllbGQ+JysKICAgICAqICc8bWFyY3g6ZGF0YWZpZWxkIHRhZz0iMDA5IiBpbmQxPSIwIiBpbmQyPSIwIj48bWFyY3g6c3ViZmllbGQgY29kZT0iYSI+YTwvbWFyY3g6c3ViZmllbGQ+PG1hcmN4OnN1YmZpZWxkIGNvZGU9ImciPnh4PC9tYXJjeDpzdWJmaWVsZD48L21hcmN4OmRhdGFmaWVsZD4nKwogICAgICogJzxtYXJjeDpkYXRhZmllbGQgdGFnPSIwMzIiIGluZDE9IjAiIGluZDI9IjAiPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJ4Ij5TRkQxOTcwNzU8L21hcmN4OnN1YmZpZWxkPjwvbWFyY3g6ZGF0YWZpZWxkPicrCiAgICAgKiAnPG1hcmN4OmRhdGFmaWVsZCB0YWc9IjEwMCIgaW5kMT0iMCIgaW5kMj0iMCI+PG1hcmN4OnN1YmZpZWxkIGNvZGU9ImEiPkJyb2J5LUpvaGFuc2VuPC9tYXJjeDpzdWJmaWVsZD48bWFyY3g6c3ViZmllbGQgY29kZT0iaCI+Ui48L21hcmN4OnN1YmZpZWxkPjwvbWFyY3g6ZGF0YWZpZWxkPicrJzxtYXJjeDpkYXRhZmllbGQgdGFnPSIyNDUiIGluZDE9IjAiIGluZDI9IjAiPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJhIj5CbG9kPC9tYXJjeDpzdWJmaWVsZD48L21hcmN4OmRhdGFmaWVsZD4nKwogICAgICogJzxtYXJjeDpkYXRhZmllbGQgdGFnPSIyNTAiIGluZDE9IjAiIGluZDI9IjAiPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJhIj4yLiB1ZGdhdmU8L21hcmN4OnN1YmZpZWxkPjwvbWFyY3g6ZGF0YWZpZWxkPicrCiAgICAgKiAnPG1hcmN4OmRhdGFmaWVsZCB0YWc9IjI2MCIgaW5kMT0iMCIgaW5kMj0iMCI+PG1hcmN4OnN1YmZpZWxkIGNvZGU9ImIiPkd5bGRlbmRhbDwvbWFyY3g6c3ViZmllbGQ+PG1hcmN4OnN1YmZpZWxkIGNvZGU9ImMiPjE5Njg8L21hcmN4OnN1YmZpZWxkPjwvbWFyY3g6ZGF0YWZpZWxkPicrCiAgICAgKiAnPG1hcmN4OmRhdGFmaWVsZCB0YWc9IjQ0MCIgaW5kMT0iMCIgaW5kMj0iMCI+PG1hcmN4OnN1YmZpZWxkIGNvZGU9ImEiPkd5bGRlbmRhbHMgc3BcdTAwZTZ0dGViXHUwMGY4Z2VyPC9tYXJjeDpzdWJmaWVsZD48bWFyY3g6c3ViZmllbGQgY29kZT0idiI+NDE8L21hcmN4OnN1YmZpZWxkPjwvbWFyY3g6ZGF0YWZpZWxkPicrCiAgICAgKiAnPG1hcmN4OmRhdGFmaWVsZCB0YWc9IjUwNSIgaW5kMT0iMCIgaW5kMj0iMCI+PG1hcmN4OnN1YmZpZWxkIGNvZGU9ImEiPkRpZ3RlPC9tYXJjeDpzdWJmaWVsZD48L21hcmN4OmRhdGFmaWVsZD4nKwogICAgICogJzxtYXJjeDpkYXRhZmllbGQgdGFnPSI1MjAiIGluZDE9IjAiIGluZDI9IjAiPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJhIj5PcmlnaW5hbHVkZ2F2ZSAxOTIyPC9tYXJjeDpzdWJmaWVsZD48L21hcmN4OmRhdGFmaWVsZD4nKwogICAgICogJzxtYXJjeDpkYXRhZmllbGQgdGFnPSI2NTIiIGluZDE9IjAiIGluZDI9IjAiPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJtIj5zazwvbWFyY3g6c3ViZmllbGQ+PC9tYXJjeDpkYXRhZmllbGQ+JysKICAgICAqICc8bWFyY3g6ZGF0YWZpZWxkIHRhZz0iOTAwIiBpbmQxPSIwIiBpbmQyPSIwIj48bWFyY3g6c3ViZmllbGQgY29kZT0iYSI+Sm9oYW5zZW48L21hcmN4OnN1YmZpZWxkPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJoIj5SLiBCcm9ieS08L21hcmN4OnN1YmZpZWxkPjxtYXJjeDpzdWJmaWVsZCBjb2RlPSJ6Ij4xMDA8L21hcmN4OnN1YmZpZWxkPjwvbWFyY3g6ZGF0YWZpZWxkPicrCiAgICAgKiAnPG1hcmN4OmRhdGFmaWVsZCB0YWc9InMxMCIgaW5kMT0iMCIgaW5kMj0iMCI+PG1hcmN4OnN1YmZpZWxkIGNvZGU9ImEiPkRCQzwvbWFyY3g6c3ViZmllbGQ+PC9tYXJjeDpkYXRhZmllbGQ+PC9tYXJjeDpyZWNvcmQ+JwogICAgIC8vIENyZWF0ZSBhIE1hcmMgUmVjb3JkIG9iamVjdCBmcm9tIGFuIHhtbCBNYXJjWENoYW5nZSBzdHJpbmcuCiAgICAgTWFyY1hjaGFuZ2UubWFyY1hjaGFuZ2VUb01hcmNSZWNvcmQoIHhtbCApCiAgICAgKiBAbmFtZSBNYXJjWGNoYW5nZS5tYXJjWGNoYW5nZVRvTWFyY1JlY29yZAogICAgICoqLwogICAgZnVuY3Rpb24gbWFyY1hjaGFuZ2VUb01hcmNSZWNvcmQoIHhtbCApIHsKCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmcgTWFyY1hjaGFuZ2UubWFyY1hjaGFuZ2VUb01hcmNSZWNvcmQiICk7CgogICAgICAgIC8vQ2hlY2tpbmcgdHlwZSBhbmQgZm9ybWF0IHN0cnVjdHVyZQogICAgICAgIHZhciByZWNvcmQgPSBuZXcgUmVjb3JkKCk7CgogICAgICAgIGlmICggVXRpbC5nZXRUeXBlKCB4bWwgKSA9PT0gJ0FycmF5JyApIHsKICAgICAgICAgICAgTG9nLmVycm9yKCAiTWFyY1hjaGFuZ2UubWFyY1hjaGFuZ2VUb01hcmNSZWNvcmQgY2FsbGVkIHdpdGggQXJyYXkgdHlwZS4iICk7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvciggIk1hcmNYY2hhbmdlLm1hcmNYY2hhbmdlVG9NYXJjUmVjb3JkIGNhbGxlZCB3aXRoIEFycmF5IHR5cGUuIiApOwogICAgICAgIH0gZWxzZSBpZiAoIHhtbCA9PT0gdW5kZWZpbmVkIHx8IHhtbCA9PT0gIiIgKSB7CiAgICAgICAgICAgIExvZy5lcnJvciggIk1hcmNYY2hhbmdlLm1hcmNYY2hhbmdlVG9NYXJjUmVjb3JkIGNhbGxlZCB3aXRoIGVtcHR5IHN0cmluZyIgKTsKICAgICAgICAgICAgcmV0dXJuIHJlY29yZDsKICAgICAgICB9IGVsc2UgaWYgKCBVdGlsLmdldFR5cGUoIHhtbCApID09PSAnc3RyaW5nJyApIHsKICAgICAgICAgICAgeG1sID0gWG1sVXRpbC5mcm9tU3RyaW5nKCB4bWwgKTsKICAgICAgICB9CgogICAgICAgIHZhciByb290OwogICAgICAgIGlmICggWG1sVXRpbC5pc0RvY3VtZW50KCB4bWwgKSApIHsKICAgICAgICAgICAgcm9vdCA9IHhtbC5kb2N1bWVudEVsZW1lbnQ7CiAgICAgICAgfSBlbHNlIGlmICggWG1sVXRpbC5pc0VsZW1lbnQoIHhtbCApICkgewogICAgICAgICAgICByb290ID0geG1sOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJvb3QgPSBYbWxVdGlsLmZyb21TdHJpbmcoIHhtbCApLmRvY3VtZW50RWxlbWVudDsKICAgICAgICB9CgogICAgICAgIExvZy5kZWJ1ZyggIk1hcmNYY2hhbmdlLm1hcmNYY2hhbmdlVG9NYXJjUmVjb3JkLCB4bWw6ICIsIFhtbFV0aWwubG9nWG1sU3RyaW5nKCByb290ICkgKTsKCiAgICAgICAgLy9DaGVja2luZyBuYW1lc3BhY2VzCiAgICAgICAgdmFyIGFjY2VwdGVkTmFtZXNwYWNlVVJJcyA9IFsgWG1sTmFtZXNwYWNlcy5tYXJjeC51cmksIFhtbE5hbWVzcGFjZXMubXgudXJpIF07CiAgICAgICAgaWYgKCAwID4gYWNjZXB0ZWROYW1lc3BhY2VVUklzLmluZGV4T2YoIFN0cmluZyggcm9vdC5uYW1lc3BhY2VVUkkgKSApICkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoICdJbnZhbGlkIG5hbWVzcGFjZSB1cmk6JyArIHJvb3QubmFtZXNwYWNlVVJJICsgJyBpbiAnICsgWG1sVXRpbC50b1htbFN0cmluZyggcm9vdCApICk7CiAgICAgICAgfQogICAgICAgIHZhciByZWMgPSBuZXcgUmVjb3JkKCk7CiAgICAgICAgdmFyIGNobGQgPSByb290LmZpcnN0Q2hpbGQ7CiAgICAgICAgd2hpbGUgKCBjaGxkICE9PSBudWxsICkgewogICAgICAgICAgICBpZiAoIFhtbFV0aWwuaXNFbGVtZW50KCBjaGxkICkgKSB7CiAgICAgICAgICAgICAgICBpZiAoIDAgPiBhY2NlcHRlZE5hbWVzcGFjZVVSSXMuaW5kZXhPZiggU3RyaW5nKCBjaGxkLm5hbWVzcGFjZVVSSSApICkgKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCAnSW52YWxpZCBuYW1lc3BhY2UgdXJpOiAnICsgY2hsZC5uYW1lc3BhY2VVUkkgKyAnIGluICcgKyBYbWxVdGlsLnRvWG1sU3RyaW5nKCBjaGxkICkgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBuYW1lID0gY2hsZC5sb2NhbE5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIGlmICggbmFtZSA9PT0gJ2xlYWRlcicgKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGxlYWRlckNvbnRlbnQgPSBjaGxkLnRleHRDb250ZW50OwogICAgICAgICAgICAgICAgICAgIExvZy5kZWJ1ZyggIkxlYWRlciBmcm9tIGlucHV0IHJlY29yZDogIiwgbGVhZGVyQ29udGVudCApOwogICAgICAgICAgICAgICAgICAgIC8vbiwgYywgYW5kIGQgaXMgdXNlZCAtIG5vdCBhIGFuZCBwICh3aGljaCBtZWFucyAiaW5jcmVhc2UgaW4gZW5jb2RpbmcgbGV2ZWwiCiAgICAgICAgICAgICAgICAgICAgLy8gYW5kIGlzIHRoZXJlZm9yZSB0cmFuc2xhdGVkIHRvIGMpCiAgICAgICAgICAgICAgICAgICAgdmFyIG0yMVJlY29yZFN0YXR1cyA9IGxlYWRlckNvbnRlbnQuc2xpY2UoIDUsIDYgKSAgIC8vVG9kbzogd2h5IGlzIHRoaXMgbTIxUmVjb3JkU3RhdHVzPwogICAgICAgICAgICAgICAgICAgIGlmICggbTIxUmVjb3JkU3RhdHVzLm1hdGNoKCAvW25jZF0vICkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYy5yZWNvcmRTdGF0dXMgPSBtMjFSZWNvcmRTdGF0dXM7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVjLnJlY29yZFN0YXR1cyA9ICJjIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVjLmltcGxlbWVudGF0aW9uQ29kZXMgPSBsZWFkZXJDb250ZW50LnNsaWNlKCA2LCAxMCApOwogICAgICAgICAgICAgICAgICAgIHJlYy5mb3JVc2VyU3lzdGVtcyA9IGxlYWRlckNvbnRlbnQuc2xpY2UoIDE3LCAyMCApOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICggbmFtZSA9PT0gJ2NvbnRyb2xmaWVsZCcgKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZpZWxkID0gbmV3IEZpZWxkKCk7CiAgICAgICAgICAgICAgICAgICAgZmllbGQubmFtZSA9IGNobGQuZ2V0QXR0cmlidXRlKCAndGFnJyApOwogICAgICAgICAgICAgICAgICAgIGZpZWxkLnZhbHVlID0gY2hsZC50ZXh0Q29udGVudDsKICAgICAgICAgICAgICAgICAgICByZWMuYXBwZW5kKCBmaWVsZCApOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICggbmFtZSA9PT0gJ2RhdGFmaWVsZCcgKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZpZWxkID0gbmV3IEZpZWxkKCk7CiAgICAgICAgICAgICAgICAgICAgZmllbGQubmFtZSA9IGNobGQuZ2V0QXR0cmlidXRlKCAndGFnJyApOwogICAgICAgICAgICAgICAgICAgIGZpZWxkLmluZGljYXRvciA9IGNobGQuZ2V0QXR0cmlidXRlKCAnaW5kMScgKSArIGNobGQuZ2V0QXR0cmlidXRlKCAnaW5kMicgKTsKICAgICAgICAgICAgICAgICAgICB2YXIgc3ViID0gY2hsZC5maXJzdENoaWxkOwogICAgICAgICAgICAgICAgICAgIHdoaWxlICggc3ViICE9PSBudWxsICkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIFhtbFV0aWwuaXNFbGVtZW50KCBzdWIgKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggMCA+IGFjY2VwdGVkTmFtZXNwYWNlVVJJcy5pbmRleE9mKCBTdHJpbmcoIHN1Yi5uYW1lc3BhY2VVUkkgKSApICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvciggJ0ludmFsaWQgbmFtZXNwYWNlIHVyaTonICsgc3ViICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3ViTmFtZSA9IHN1Yi5sb2NhbE5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggc3ViTmFtZSA9PT0gJ3N1YmZpZWxkJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3ViRmllbGQgPSBuZXcgU3ViZmllbGQoIHN1Yi5nZXRBdHRyaWJ1dGUoICdjb2RlJyApLCBzdWIudGV4dENvbnRlbnQgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZC5hcHBlbmQoIHN1YkZpZWxkICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgc3ViID0gc3ViLm5leHRTaWJsaW5nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZWMuYXBwZW5kKCBmaWVsZCApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNobGQgPSBjaGxkLm5leHRTaWJsaW5nOwogICAgICAgIH0KICAgICAgICBMb2cuZGVidWcoICJNYXJjIHJlY29yZCBpczogIiwgcmVjLCAiIHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOiAiLCBKU09OLnN0cmluZ2lmeSggcmVjICkgKTsKICAgICAgICByZXR1cm4gcmVjOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCBhIEphdmFzY3JpcHQgTWFyYyBSZWNvcmQgT2JqZWN0IHRvIGEgTWFyY1hjaGFuZ2UgWE1MIG9iamVjdC4KICAgICAqCiAgICAgKiBUaGlzIGZ1bmN0aW9uIGNyZWF0ZXMgYW4gWE1MIG9iamVjdCBpbiBNYXJjWENoYW5nZSBmb3JtYXQsCiAgICAgKiByZXByZXNlbnRpbmcgdGhlIFJlY29yZCBvYmplY3QgcGFzc2VkIHRvIGl0LgogICAgICoKICAgICAqIFRoZSBmb3JtYXQgcGFyYW1ldGVyIGNvbnRyb2xzIGlmIHRoZSBnZW5lcmF0ZWQgTWFyY1hDaGFuZ2UgWE1MCiAgICAgKiByZWZsZWN0cyBhIG5vcm1hbCBEYW5tYXJjMiByZWNvcmQsIG9yIGFuIE1BUkMyMSByZWNvcmQuIFRoaXMKICAgICAqIGluZmx1ZW5jZXMgdGhlIG5hbWVzcGFjZSBvZiB0aGUgWE1MLCBhbmQgaXMgYWxzbyBzZXQgaW4gdGhlCiAgICAgKiBgZm9ybWF0YCBhdHRyaWJ1dGUgb2YgdGhlIHJlc3VsdGluZyBYTUwuCiAgICAgKgogICAgICogVGhlIHR5cGUgcGFyYW1ldGVyIGNvbnRhaW5zIGluZm9ybWF0aW9uIGFib3V0IHRoZSBsZXZlbCBvZiB0aGUgcmVjb3JkCiAgICAgKiB3aGljaCBpcyBzcGVjaWZpY2FsbHkgcmVsZXZhbnQgZm9yIGRhbk1BUkMyIHJlY29yZHMgYXMgYSByZWNvcmQgY2FuIGVpdGhlciBiZQogICAgICogYSBtYWluLCBzZWN0aW9uIG9yIHZvbHVtZSBkZXNjcmlwdGlvbiBvZiBhIHJlY29yZC4KICAgICAqIFRoZSBwb3NzaWJsZSBpbnB1dCBmb3IgdGhlIHR5cGUgcGFyYW1ldGVyIGFyZToKICAgICAqCiAgICAgKiAqICJCaWJsaW9ncmFwaGljIiAoc2luZ2xlIHJlY29yZCBvciBhIG1lcmdlZCB2ZXJzaW9uIG9mIGEgbWFpbitzZWN0aW9uK3ZvbHVtZSByZWNvcmQpCiAgICAgKiAqICJCaWJsaW9ncmFwaGljTWFpbiIgKG1haW4gcmVjb3JkKQogICAgICogKiAiQmlibGlvZ3JhcGhpY1NlY3Rpb24iIChzZWN0aW9uIHJlY29yZCkKICAgICAqICogIkJpYmxpb2dyYXBoaWNWb2x1bWUiICh2b2x1bWUgcmVjb3JkKQogICAgICoKICAgICAqIEB0eXBlIHttZXRob2R9CiAgICAgKiBAbWV0aG9kCiAgICAgKiBAc2VlIFJlY29yZAogICAgICogQHN5bnRheCBNYXJjWGNoYW5nZS5tYXJjUmVjb3JkVG9NYXJjWGNoYW5nZSggcmVjb3JkLCBmb3JtYXQsIHR5cGUgKQogICAgICogQHBhcmFtIHtSZWNvcmR9IHJlY29yZCBBIG1hcmMgcmVjb3JkIG9iamVjdAogICAgICogQHBhcmFtIHtzdHJpbmd9IGZvcm1hdCBtYXJjWGNoYW5nZSBmb3JtYXQgb2YgdGhlIHJlY29yZCwgZWl0aGVyICJNQVJDMjEiIG9yICJkYW5NQVJDMiIuCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZSBtYXJjWGNoYW5nZSB0eXBlIG9mIHRoZSByZWNvcmQsIGVpdGhlciAiQmlibGlvZ3JhcGhpYyIsICJCaWJsaW9ncmFwaGljTWFpbiIsICJCaWJsaW9ncmFwaGljU2VjdGlvbiIgb3IgIkJpYmxpb2dyYXBoaWNWb2x1bWUiLgogICAgICogQHJldHVybiB7WE1MfSBBbiBYTUwgb2JqZWN0IGNvbnRhaW5pbmcgYSBtYXJjWGNoYW5nZSByZWNvcmQKICAgICAqIEBleGFtcGxlCiAgICAgLy8gQ29udmVydCBhbiBNYXJjIGNsYXNzZXMgcmVjb3JkIGluc3RhbmNlIHRvIGFuIFhNTCBpbnN0YW5jZS4KICAgICB2YXIgeCA9IE1hcmNYY2hhbmdlLm1hcmNSZWNvcmRUb01hcmNYY2hhbmdlKCBzb21lX3JlY29yZF9vYmplY3QgKTsKICAgICAqIEBuYW1lIE1hcmNYY2hhbmdlLm1hcmNSZWNvcmRUb01hcmNYY2hhbmdlICovCiAgICBmdW5jdGlvbiBtYXJjUmVjb3JkVG9NYXJjWGNoYW5nZSggcmVjb3JkLCBmb3JtYXQsIHR5cGUgKSB7CiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmc6IE1hcmNYY2hhbmdlLm1hcmNSZWNvcmRUb01hcmNYY2hhbmdlIGZ1bmN0aW9uIiApOwogICAgICAgIExvZy5kZWJ1ZyggIjAgVmFyIHJlY29yZFN0YXR1cyBiYXNlZCBvbiBvcmlnaW5hbCByZWNvcmQ6ICIsIHJlY29yZC5yZWNvcmRTdGF0dXMgKTsKCiAgICAgICAgdmFyIHJlY29yZFN0YXR1czsKICAgICAgICBpZiAoICFyZWNvcmQuZXhpc3RGaWVsZCggIjAwNCIgKSApIHsKICAgICAgICAgICAgLy9uLCBjLCBhbmQgZCBpcyB1c2VkIC0gbm90IGEgYW5kIHAgKHdoaWNoIG1lYW5zICJpbmNyZWFzZSBpbiBlbmNvZGluZyBsZXZlbCIKICAgICAgICAgICAgLy8gYW5kIGlzIHRoZXJlZm9yZSB0cmFuc2xhdGVkIHRvIGMpCiAgICAgICAgICAgIGlmICggcmVjb3JkLnJlY29yZFN0YXR1cy5tYXRjaCggL15bY2RuXSQvICkgKSB7CiAgICAgICAgICAgICAgICByZWNvcmRTdGF0dXMgPSByZWNvcmQucmVjb3JkU3RhdHVzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVjb3JkU3RhdHVzID0gImMiOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVjb3JkU3RhdHVzID0gcmVjb3JkLmZpZWxkKCAiMDA0IiApLnN1YmZpZWxkKCAiciIgKS52YWx1ZTsKICAgICAgICB9CgogICAgICAgIC8vIENob29zZSB0aGUgbmFtZXNwYWNlIGJhc2VkIG9uIHRoZSBmb3JtYXQgcGFyYW1ldGVyLgogICAgICAgIHZhciBuYW1lc3BhY2U7CiAgICAgICAgaWYgKCBmb3JtYXQgPT09ICJNQVJDMjEiICkgewogICAgICAgICAgICBuYW1lc3BhY2UgPSBYbWxOYW1lc3BhY2VzLm14OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5hbWVzcGFjZSA9IFhtbE5hbWVzcGFjZXMubWFyY3g7CiAgICAgICAgfQogICAgICAgIC8vIFRoaXMgd2lsbCBiZSB0aGUgcmVzdWx0IG9mIHRoZSBmdW5jdGlvbi4KICAgICAgICB2YXIgeG1sID0gWG1sVXRpbC5jcmVhdGVEb2N1bWVudCggInJlY29yZCIsIG5hbWVzcGFjZSApOwogICAgICAgIFhtbFV0aWwuc2V0QXR0cmlidXRlKCB4bWwuZG9jdW1lbnRFbGVtZW50LCAiZm9ybWF0IiwgZm9ybWF0ICk7CiAgICAgICAgWG1sVXRpbC5zZXRBdHRyaWJ1dGUoIHhtbC5kb2N1bWVudEVsZW1lbnQsICJ0eXBlIiwgdHlwZSApOwogICAgICAgIGlmICggIiAgICAiID09PSByZWNvcmQuaW1wbGVtZW50YXRpb25Db2RlcyB8fCAiICAgIiA9PT0gcmVjb3JkLmZvclVzZXJTeXN0ZW1zICkgewogICAgICAgICAgICBNYXJjWGNoYW5nZS5zZXRWYWx1ZXNGb3JMZWFkZXIoIHJlY29yZCwgZm9ybWF0ICk7CiAgICAgICAgfQogICAgICAgIHZhciBsZWFkZXIgPSAiMDAwMDAiICsgcmVjb3JkU3RhdHVzICsgcmVjb3JkLmltcGxlbWVudGF0aW9uQ29kZXMgKyAiMjIwMDAwMCIgKyByZWNvcmQuZm9yVXNlclN5c3RlbXMgKyAiNDUwMCI7IC8vMDAwMDBuYW0gYTIyMDAwMDAwYyA0NTAwCiAgICAgICAgdmFyIGVsZW1lbnQgPSBYbWxVdGlsLmFwcGVuZENoaWxkRWxlbWVudCggeG1sLCAibGVhZGVyIiwgbmFtZXNwYWNlLCBsZWFkZXIgKTsKCiAgICAgICAgdmFyIHN1YmZpZWxkOwogICAgICAgIHZhciBpbmQ7CiAgICAgICAgcmVjb3JkLmVhY2hGaWVsZCggLy4vLCBmdW5jdGlvbiggZmllbGQgKSB7CiAgICAgICAgICAgIGlmICggZmllbGQuaXNDb250cm9sRmllbGQoKSApIHsKICAgICAgICAgICAgICAgIC8vIENvbnRyb2wgZmllbGRzIG9ubHkgaGF2ZSBhIG5hbWUgYW5kIGEgdmFsdWUuCiAgICAgICAgICAgICAgICBlbGVtZW50ID0gWG1sVXRpbC5hcHBlbmRDaGlsZEVsZW1lbnQoIHhtbCwgImNvbnRyb2xmaWVsZCIsIG5hbWVzcGFjZSwgZmllbGQudmFsdWUgKTsKICAgICAgICAgICAgICAgIFhtbFV0aWwuc2V0QXR0cmlidXRlKCBlbGVtZW50LCAidGFnIiwgZmllbGQubmFtZSApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gTm9ybWFsIGZpZWxkcyBoYXZlIG5hbWUgaW5kaWNhdG9yIGFuZCBzdWJmaWVsZHMKICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBYbWxVdGlsLmFwcGVuZENoaWxkRWxlbWVudCggeG1sLCAiZGF0YWZpZWxkIiwgbmFtZXNwYWNlICk7CiAgICAgICAgICAgICAgICBYbWxVdGlsLnNldEF0dHJpYnV0ZSggZWxlbWVudCwgInRhZyIsIGZpZWxkLm5hbWUgKTsKICAgICAgICAgICAgICAgIGluZCA9IGZpZWxkLmluZGljYXRvci5jaGFyQXQoIDAgKTsKICAgICAgICAgICAgICAgIGlmICggaW5kID09PSB1bmRlZmluZWQgKSB7CiAgICAgICAgICAgICAgICAgICAgaW5kID0gIiAiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgWG1sVXRpbC5zZXRBdHRyaWJ1dGUoIGVsZW1lbnQsICJpbmQxIiwgaW5kICk7CiAgICAgICAgICAgICAgICBpbmQgPSBmaWVsZC5pbmRpY2F0b3IuY2hhckF0KCAxICk7CiAgICAgICAgICAgICAgICBpZiAoIGluZCA9PT0gdW5kZWZpbmVkICkgewogICAgICAgICAgICAgICAgICAgIGluZCA9ICIgIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIFhtbFV0aWwuc2V0QXR0cmlidXRlKCBlbGVtZW50LCAiaW5kMiIsIGluZCApOwoKICAgICAgICAgICAgICAgIGZpZWxkLmVhY2hTdWJGaWVsZCggLy4vLCBmdW5jdGlvbiggZmllbGQsIHN1YkZpZWxkICkgewogICAgICAgICAgICAgICAgICAgIHN1YmZpZWxkID0gWG1sVXRpbC5hcHBlbmRDaGlsZEVsZW1lbnQoIGVsZW1lbnQsICJzdWJmaWVsZCIsIG5hbWVzcGFjZSwgc3ViRmllbGQudmFsdWUgKTsKICAgICAgICAgICAgICAgICAgICBYbWxVdGlsLnNldEF0dHJpYnV0ZSggc3ViZmllbGQsICJjb2RlIiwgc3ViRmllbGQubmFtZSApOwogICAgICAgICAgICAgICAgfSApOwogICAgICAgICAgICB9CiAgICAgICAgfSApOwoKICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nOiBtYXJjUmVjb3JkVG9NYXJjWGNoYW5nZSBmdW5jdGlvbiIgKTsKCiAgICAgICAgcmV0dXJuIHhtbDsKCiAgICB9CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IHNldCB2YWx1ZXMgZm9yIHRoZSBsZWFkZXIgZm9yIHRoZSBkYW5NYXJjMlJlY29yZCB3aXRoIHJlY29yZFN0YXR1cywgaW1wbGVtZW50YXRpb25Db2RlcyBhbmQgZm9yVXNlclN5c3RlbSBwcm9wZXJ0aWVzLgogICAgICoKICAgICAqIEBmdW5jdGlvbgogICAgICogQHN5bnRheCBNYXJjWGNoYW5nZS5zZXRWYWx1ZXNGb3JMZWFkZXIoIHJlY29yZCwgZm9ybWF0ICkKICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgQSBtYXJjIHJlY29yZCBvYmplY3QKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBmb3JtYXQgbWFyY1hjaGFuZ2UgZm9ybWF0IG9mIHRoZSByZWNvcmQsIGVpdGhlciAiTUFSQzIxIiBvciAiZGFuTUFSQzIiLiAKICAgICAqIEBuYW1lIE0yMVRvRE0yLnNldFZhbHVlc0ZvckxlYWRlcgogICAgICovCiAgICBmdW5jdGlvbiBzZXRWYWx1ZXNGb3JMZWFkZXIoIHJlY29yZCwgZm9ybWF0ICkgewoKICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZyBNYXJjWGNoYW5nZS5zZXRWYWx1ZXNGb3JMZWFkZXIiICk7CiAgICAgICAgaWYgKCAiZGFuTUFSQzIiID09PSBmb3JtYXQgKSB7CiAgICAgICAgICAgIC8vcG9zaXRpb25zIDAwIC0gMDQ6IFJlY29yZCBsZW5ndGgKICAgICAgICAgICAgLy9wb3NpdGlvbiAwNTogUmVjb3JkIHN0YXR1cyBpcyBzZXQgaW4gTWFyY1hjaGFuZ2UubWFyY1JlY29yZFRvTWFyY1hjaGFuZ2UgZnJvbSAwMDRyCiAgICAgICAgICAgIC8vcG9zaXRpb25zIDA2LTA5OgogICAgICAgICAgICB2YXIgaW1wbGVtZW50YXRpb25Db2RlcyA9IFsgIiAiLCAiICIsICIgIiwgIiAiIF07CiAgICAgICAgICAgIC8vIDA2IFR5cGUgb2YgcmVjb3JkIGZyb20gZmlyc3QgMDA5YQogICAgICAgICAgICB2YXIgdmFsdWVGcm9tMDA5YSA9IHJlY29yZC5maWVsZCggIjAwOSIgKS5zdWJmaWVsZCggImEiICkudmFsdWU7CiAgICAgICAgICAgIGltcGxlbWVudGF0aW9uQ29kZXNbIDAgXSA9ICggIiIgIT09IHZhbHVlRnJvbTAwOWEgKSA/IHZhbHVlRnJvbTAwOWEgOiAiICI7CiAgICAgICAgICAgIC8vIDA3IGJpYmxpb2dyYXBoaWMgY2F0ZWdvcnkgYXMgaW4gMDA4dCwKICAgICAgICAgICAgdmFyIHZhbHVlRnJvbTAwOHQgPSByZWNvcmQuZmllbGQoICIwMDgiICkuc3ViZmllbGQoICJ0IiApLnZhbHVlOwogICAgICAgICAgICBpZiAoICIiICE9PSB2YWx1ZUZyb20wMDh0ICkgewogICAgICAgICAgICAgICAgaW1wbGVtZW50YXRpb25Db2Rlc1sgMSBdID0gKCAicyIgPT09IHZhbHVlRnJvbTAwOHQgKSA/ICJtIiA6IHZhbHVlRnJvbTAwOHQ7IC8vaWYgMDA4dCBpcyBzIHVzZSBtLCBvdGhlcndpc2UgdXNlIHZhbHVlIGFzIGlzLgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaW1wbGVtZW50YXRpb25Db2Rlc1sgMSBdID0gKCAiaSIgPT09IHJlY29yZC5maWVsZCggIjAwNCIgKS5zdWJmaWVsZCggImEiICkudmFsdWUgKSA/ICJhIiA6ICJtIjsgLy9pZiAwMDRhIGlzIGkgdXNlIGEsIG90aGVyd2lzZSB1c2UgbQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vMDggdHlwZSBvZiByZWNvcmQgZnJvbSAwMDRhCiAgICAgICAgICAgIHZhciB2YWx1ZUZyb20wMDRhID0gcmVjb3JkLmZpZWxkKCAiMDA0IiApLnN1YmZpZWxkKCAiYSIgKS52YWx1ZTsKICAgICAgICAgICAgaW1wbGVtZW50YXRpb25Db2Rlc1sgMiBdID0gKCAiIiAhPT0gdmFsdWVGcm9tMDA0YSApID8gdmFsdWVGcm9tMDA0YSA6ICIgIjsKICAgICAgICAgICAgcmVjb3JkLmltcGxlbWVudGF0aW9uQ29kZXMgPSBpbXBsZW1lbnRhdGlvbkNvZGVzLmpvaW4oICIiICk7CiAgICAgICAgICAgIC8vIDA5IGJsYW5rCiAgICAgICAgICAgIC8vIDEwIEluZGljYXRvciBjb3VudCA9IDIKICAgICAgICAgICAgLy8gMTEgU3ViZmllbGQgY29kZSBjb3VudCA9IDIKICAgICAgICAgICAgLy8gMTItMTYgQmFzZSBhZGRyZXNzIG9mIGRhdGEKICAgICAgICAgICAgLy9wb3NpdGlvbnMgMTctMTk6IGNvZGUgZm9yIGNhdGFsb2d1aW5nIGxldmVsIGZyb20gMDA4KnYsIHZhbHVlczogKCcwJywnMScsJzMnLCc0JywnNycsJzgnLCc5JykgLSBpZiBtaXNzaW5nIHNldCB0byAnNCcsIHBvcy4gMTgtMTkgYXJlIGJsYW5rCiAgICAgICAgICAgIHZhciBjYXRhbG9ndWluZ0xldmVsID0gcmVjb3JkLmZpZWxkKCAiMDA4IiApLnN1YmZpZWxkKCAidiIgKS52YWx1ZTsKICAgICAgICAgICAgcmVjb3JkLmZvclVzZXJTeXN0ZW1zID0gKCAiIiA9PT0gY2F0YWxvZ3VpbmdMZXZlbCApID8gIjQgICIgOiBjYXRhbG9ndWluZ0xldmVsICsgIiAgIjsKICAgICAgICAgICAgLy8gMjAgTGVuZ3RoIG9mIHRoZSBsZW5ndGgtb2YtZmllbGQgcG9ydGlvbiA9IDQKICAgICAgICAgICAgLy8gMjEgTGVuZ3RoIG9mIHRoZSBzdGFydGluZy1jaGFyYWN0ZXItcG9zaXRpb24gcG9ydGlvbiA9IDUKICAgICAgICAgICAgLy8gMjIgTGVuZ3RoIG9mIHRoZSBpbXBsZW1lbnRhdGlvbi1kZWZpbmVkIHBvcnRpb24gPSAwCiAgICAgICAgICAgIC8vIDIzIFJlc2VydmVkIGZvciBmdXR1cmUgdXNlID0gMAoKICAgICAgICAgICAgTG9nLmRlYnVnKCAiSW5mb3JtYXRpb24gZm9yIHRoZSBsZWFkZXI6XG5kZWZhdWx0IFJlY29yZFN0YXR1czogIiwgcmVjb3JkLnJlY29yZFN0YXR1cywgIlxuSW1wbGVtZW50YXRpb25Db2RlczogJyIsIHJlY29yZC5pbXBsZW1lbnRhdGlvbkNvZGVzLCAiJyIgKwogICAgICAgICAgICAgICAgIlxuRm9yVXNlclN5c3RlbXM6ICciLCByZWNvcmQuZm9yVXNlclN5c3RlbXMgKyAiJyIgKTsKICAgICAgICB9CiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBNYXJjWGNoYW5nZS5zZXRWYWx1ZXNGb3JMZWFkZXIiICk7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICBtYXJjWGNoYW5nZVRvTWFyY1JlY29yZDogbWFyY1hjaGFuZ2VUb01hcmNSZWNvcmQsCiAgICAgICAgbWFyY1hjaGFuZ2VNMjFUb01hcmNSZWNvcmQ6IG1hcmNYY2hhbmdlVG9NYXJjUmVjb3JkLCAvLyB0aGUgZnVuY3Rpb24gbWFyY1hjaGFuZ2VNMjFUb01hcmNSZWNvcmQgaXMgcmVtb3ZlZCBhZnRlciBtZXJnaW5nIGl0IGluIHRvIG1hcmNYY2hhbmdlVG9NYXJjUmVjb3JkCiAgICAgICAgbWFyY1JlY29yZFRvTWFyY1hjaGFuZ2U6IG1hcmNSZWNvcmRUb01hcmNYY2hhbmdlLAogICAgICAgIHNldFZhbHVlc0ZvckxlYWRlcjogc2V0VmFsdWVzRm9yTGVhZGVyCiAgICB9Owp9KCk7CgovL1VuaXR0ZXN0cyBhcmUgaW4gdGhlIE1hcmNYY2hhbmdlLnRlc3QuanMgbW9kdWxlCg==", "moduleName": "MarcXchange"}, {"javascript": "LyoKIFNjcmlwdCB0aWwgZGFubmVsc2UgYWYgYm9nc3RhdGlzdGlrIHRpbCBEYW5tYXJrcyBTdGF0aXN0aWsuCgogQ29weXJpZ2h0IC91MDBBOSAyMDExLCBEYW5zayBCaWJsaW90ZWtzY2VudGVyIGEvcywKIFRlbXBvdmVqIDctMTEsIERLLTI3NTAgQmFsbGVydXAsIERlbm1hcmsuIENWUjogMTUxNDkwNDMKCiBEbTJUb0RzdCBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgogRG0yVG9Ec3QgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiBhbG9uZyB3aXRoIERtMlRvRHN0LiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoqLwoKdXNlKCAiTG9nIiApOwp1c2UoICJNYXJjIiApOwp1c2UoICJEYXRlVXRpbCIgKTsKdXNlKCAiWG1sVXRpbCIgKTsKdXNlKCAiTWFyY1hjaGFuZ2UiICk7CnVzZSggIlJlY29yZFByb2Nlc3NpbmciICk7CgoKRVhQT1JURURfU1lNQk9MUyA9IFsnRG0yVG9Ec3QnXTsKCi8qKgogKiBNb2R1bGUgd2l0aCBmdW5jdGlvbnMgZm9yIHByZXBhcmluZyBhIHJlY29yZCBmcm9tIFJhdyBSZXBvIHRvIERhbm1hcmtzIFN0YXRpc3RpayAoRFNUKSBvdXRwdXQgaW4gZm9ybWF0IGNzdgogKgogKiBAdHlwZSB7bmFtZXNwYWNlfQogKiBAbmFtZXNwYWNlCiAqLwoKdmFyIERtMlRvRHN0ID0gZnVuY3Rpb24oKSB7CiAgICBMb2cuaW5mbyggIkVudGVyaW5nOiBEbTJUb0RzdCBtb2R1bGUiICk7CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IGNyZWF0ZXMgYSBjc3Ygb3V0cHV0IHJlcHJlc2VudGluZyBhIGNvbGxlY3Rpb24gb2YgbWFyYyByZWNvcmRzIGZvciBEYW5tYXJrcyBTdGF0aXN0aWsgKERTVCkKICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IERtMlRvRHN0LmNyZWF0ZUNzdkZvckRzdCAoIGNvbGxlY3Rpb25TdHJpbmcgLCBkYXRlICkKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjb2xsZWN0aW9uU3RyaW5nIFhNTCBjb2xsZWN0aW9uIGNvbnRhaW5pbmcgbWFyY1hjaGFuZ2UgcmVjb3JkcyBhcyBhIHN0cmluZwogICAgICogQHBhcmFtIHtTdHJpbmcgfCB1bmRlZmluZWR9IGRhdGUgZm9yIHVuaXR0ZXN0aW5nCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGEgY3N2IHJlcHJlc2VudGF0aW9uIG9mIGEgbWFyYyByZWNvcmQKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgRG0yVG9Ec3QuY3JlYXRlQ3N2Rm9yRHN0CiAgICAgKi8KCiAgICBmdW5jdGlvbiBjcmVhdGVDc3ZGb3JEc3QgKCBjb2xsZWN0aW9uU3RyaW5nLCBkYXRlICkgewoKICAgICAgICBMb2cuaW5mbyggIkVudGVyaW5nIERtMlRvRHN0LmNyZWF0ZUNzdkZvckRzdCIgKTsKCiAgICAgICAgdmFyIG1hcmNSZWNvcmQgPSBudWxsOwogICAgICAgIHZhciBoZWFkID0gbnVsbDsKCiAgICAgICAgLy8gY29sbGVjdGlvblN0cmluZyBpbnRvIGEgY29sbGVjdGlvbiBhZiB4bWwgcmVjb3JkcwogICAgICAgIHZhciB4bWxSZWNvcmRzID0gWG1sVXRpbC5mcm9tU3RyaW5nKCBjb2xsZWN0aW9uU3RyaW5nICk7CgogICAgICAgIC8vIHNwbGl0IHhtbFJlY29yZHMgaW50byBtYXJjIHJlY29yZCBvYmplY3RzCiAgICAgICAgdmFyIGVsZW1lbnRzID0gWFBhdGguc2VsZWN0KCAnL21hcmN4OmNvbGxlY3Rpb24vbWFyY3g6cmVjb3JkJywgeG1sUmVjb3JkcyApOwogICAgICAgIGZvciAoIHZhciBpbmRleCA9IDA7IGluZGV4IDwgZWxlbWVudHMubGVuZ3RoOyBpbmRleCsrICkgewogICAgICAgICAgICB2YXIgcmVjb3JkID0gZWxlbWVudHNbIGluZGV4IF07CiAgICAgICAgICAgIHZhciBtYXJjUmVjb3JkT2JqZWN0ID0gTWFyY1hjaGFuZ2UubWFyY1hjaGFuZ2VUb01hcmNSZWNvcmQoIHJlY29yZCApOwoKICAgICAgICAgICAgLy8gY2hlY2sgaWYgbWFyY1JlY29yZE9iamVjdCBpcyBtdWx0aWJsZSB2b2x1bWUKICAgICAgICAgICAgdmFyIHJlY29yZFR5cGUgPSBtYXJjUmVjb3JkT2JqZWN0LmZpZWxkKCAnMDA0JyApLnN1YmZpZWxkKCAnYScgKS52YWx1ZTsKICAgICAgICAgICAgaWYgKCAiaCIgPT09IHJlY29yZFR5cGUgKSB7CiAgICAgICAgICAgICAgICBoZWFkID0gbWFyY1JlY29yZE9iamVjdDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1hcmNSZWNvcmQgPSBtYXJjUmVjb3JkT2JqZWN0OwogICAgICAgICAgICB9CgogICAgICAgIH0KCiAgICAgICAgLy8gY2hlY2sgaWYgdmFsaWQgbWFyYyByZWNvcmQKICAgICAgICBpZiAoIG51bGwgPT09IG1hcmNSZWNvcmQgKSB7CiAgICAgICAgICAgIExvZy5pbmZvKCAiTm8gcmVjb3JkIGZvdW5kIGluIHhtbCBjb2xsZWN0aW9uIiApOwogICAgICAgICAgICBSZWNvcmRQcm9jZXNzaW5nLnRlcm1pbmF0ZVByb2Nlc3NpbmdBbmRGYWlsUmVjb3JkKCAiUkVDT1JEIEZBSUxFRDogTm8gcmVjb3JkIGZvdW5kIGluIHhtbCBjb2xsZWN0aW9uIiApOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNzdiA9IGNyZWF0ZUFsbFBvc2l0aW9ucyggbWFyY1JlY29yZCwgaGVhZCwgZGF0ZSApCgogICAgICAgIExvZy5pbmZvKCAiTGVhdmluZyBEbTJUb0RzdC5jcmVhdGVDc3ZGb3JEc3QiICk7CgogICAgICAgIHJldHVybiBjc3Y7CgogICAgfQoKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhbGwgcG9zaXRpb25zIGZvciBhIGNvbW1hIHNlcGFyYXRlZAogICAgICogcmVwcmVzZW50YXRpb24gb2YgYSBtYXJjIHJlY29yZCBmb3IgRGFubWFya3MgU3RhdGlzdGlrIChEU1QpCiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBEbTJUb0RzdC5jcmVhdGVBbGxQb3NpdGlvbnMgKCByZWNvcmQsIGhlYWQgKQogICAgICogQHBhcmFtIHtSZWNvcmR9IHJlY29yZCBBIHNpbmdsZSBvciB2b2x1bWUgcmVjb3JkCiAgICAgKiBAcGFyYW0ge1JlY29yZH0gaGVhZCBBIG1hcmMgcGFyZW50IHJlY29yZAogICAgICogQHBhcmFtIHtTdHJpbmcgfCB1bmRlZmluZWR9IGRhdGUgZm9yIHVuaXR0ZXN0aW5nCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGEgY3N2IHJlcHJlc2VudGF0aW9uIG9mIGEgbWFyYyByZWNvcmQKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgRG0yVG9Ec3QuY3JlYXRlQWxsUG9zaXRpb25zCiAgICAgKi8KCgoKICAgIGZ1bmN0aW9uIGNyZWF0ZUFsbFBvc2l0aW9ucyggcmVjb3JkLCBoZWFkLCBkYXRlICkgewoKICAgICAgICBMb2cuaW5mbyggIlJFQ09SRDogIiArIHJlY29yZCApOwogICAgICAgIExvZy5pbmZvKCAiSEVBRDogIiArIGhlYWQgKTsKICAgICAgICBMb2cuaW5mbyggIkVudGVyaW5nIERtMlRvRHN0LmNyZWF0ZUFsbFBvc2l0aW9ucyIgKTsKCiAgICAgICAgdmFyIHJlY29yZGRhdGEgPSAiIjsKCiAgICAgICAgcmVjb3JkZGF0YSArPSBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjFfMTIoIHJlY29yZCwgaGVhZCApOyAgICAgICAvL0ZhdXN0bnVtbWVyCiAgICAgICAgcmVjb3JkZGF0YSArPSBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjEzXzE2KCByZWNvcmQsIGhlYWQgKTsgICAgICAvL01hdGVyaWFsZWJldGVnbmVsc2UKICAgICAgICByZWNvcmRkYXRhICs9IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMTdfMTgoIHJlY29yZCwgaGVhZCApOyAgICAgIC8vUGVyaW9kaWN1bSBlbGxlciBtb25vZ3JhZmkKICAgICAgICByZWNvcmRkYXRhICs9IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMTlfMjEoIHJlY29yZCwgaGVhZCApOyAgICAvL1VkZ2l2ZWxzZXNsYW5kCiAgICAgICAgcmVjb3JkZGF0YSArPSBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjIyXzIzKCByZWNvcmQsIGhlYWQgKTsgICAgLy9VZGdhdmVrb2RlCiAgICAgICAgcmVjb3JkZGF0YSArPSBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjI0XzI4KCByZWNvcmQsIGhlYWQgKTsgICAgLy9VZGdpdmVsc2VzYWFyIGZvZXJzdCBvcGxhZwogICAgICAgIHJlY29yZGRhdGEgKz0gRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb24yOV8zMCggcmVjb3JkLCBoZWFkICk7ICAgIC8vT3BsYWcKICAgICAgICByZWNvcmRkYXRhICs9IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMzFfMzUoIHJlY29yZCwgaGVhZCApOyAgICAvL1NlbmVzdGUgdWRnaXZlbHNlc2FhciBmb3Igb3BsYWcKICAgICAgICByZWNvcmRkYXRhICs9IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMzZfMzcoIHJlY29yZCwgaGVhZCApOyAgICAvL1NtYWF0cnlrPwogICAgICAgIHJlY29yZGRhdGEgKz0gRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb24zOF8zOSggcmVjb3JkLCBoZWFkICk7ICAgIC8vQm9lcm5lL3Nrb2xla29kZQogICAgICAgIHJlY29yZGRhdGEgKz0gRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb240MF80MyggcmVjb3JkLCBoZWFkICk7ICAgIC8vUHJpbWFlcnQgc3Byb2cKICAgICAgICByZWNvcmRkYXRhICs9IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNDRfNDcoIHJlY29yZCwgaGVhZCApOyAgICAvL0V2dC4gb3JpZ2luYWxzcHJvZwogICAgICAgIHJlY29yZGRhdGEgKz0gRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb240OF80OSggcmVjb3JkLCBoZWFkICk7ICAgIC8vSGFuZGVsc2tvZGUKICAgICAgICByZWNvcmRkYXRhICs9IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNTBfNTEoIHJlY29yZCwgaGVhZCApOyAgICAvL0ZhZy0gZWxsZXIgc2tvZW5saXR0ZXJhdHVyCiAgICAgICAgcmVjb3JkZGF0YSArPSBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjUyXzU0KCByZWNvcmQsIGhlYWQgKTsgICAgLy9FbW5lIGZvciBmYWdsaXR0ZXJhdHVyL3R5cGUgYWYgc2tvZW5saXR0dGVyYXR1cgogICAgICAgIHJlY29yZGRhdGEgKz0gRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb241NV81NiggcmVjb3JkLCBoZWFkICk7ICAgIC8vUG9zdHR5cGUKICAgICAgICByZWNvcmRkYXRhICs9IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNTdfNjgoIHJlY29yZCwgaGVhZCApOyAgICAvL0V2dC4gRmF1c3RudW1tZXIgcMOlIGhvdmVkcG9zdAogICAgICAgIHJlY29yZGRhdGEgKz0gRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb242OV83NSggcmVjb3JkLCBoZWFkICk7ICAgIC8vS2F0YWxvZ3VnZWtvZGUKICAgICAgICByZWNvcmRkYXRhICs9IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNzZfODkoIGRhdGUgKTsgICAgICAgICAgICAgICAgLy9MZXZlcmFuY2V0aWRzcHVua3QKCiAgICAgICAgTG9nLmluZm8oICJMZWF2aW5nIERtMlRvRHN0LmNyZWF0ZUFsbFBvc2l0aW9ucyIgKTsKCiAgICAgICAgcmV0dXJuIHJlY29yZGRhdGE7CgogICAgfQoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgc3RyaW5nIHdpdGggcG9zaXRpb24gMS0xMiBvZiBhIGNvbW1hIHNlcGFyYXRlZAogICAgICogcmVwcmVzZW50YXRpb24gb2YgYSBtYXJjIHJlY29yZCBmaWVsZCAwMDEKICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMV8xMiAoIHJlY29yZCwgaGVhZCApCiAgICAgKiBAcGFyYW0ge1JlY29yZH0gcmVjb3JkIEEgbWFyYyByZWNvcmQgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGEgZmF1c3QgbnVtYmVyIGFzIGEgc3RyaW5nCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMV8xMgogICAgICovCgoKICAgIGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uMV8xMiggcmVjb3JkICkgeyAgICAgIC8vRmF1c3RudW1tZXIKCiAgICAgICAgTG9nLmluZm8oICJFbnRlcmluZyBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjFfMTIiICk7CgogICAgICAgIHZhciBwb3MxXzEyID0gcmVjb3JkLmZpZWxkKCAnMDAxJyApLnN1YmZpZWxkKCAnYScgKS52YWx1ZSArICI7IjsKCiAgICAgICAgTG9nLmluZm8oICJMZWF2aW5nOiBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjFfMTIgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBwb3MxXzEyOwoKICAgIH07CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IGNyZWF0ZXMgYSBzdHJpbmcgd2l0aCBwb3NpdGlvbiAxMy0xNiBvZiBhIGNvbW1hIHNlcGFyYXRlZAogICAgICogcmVwcmVzZW50YXRpb24gb2YgYSBtYXJjIHJlY29yZCBmaWVsZCAwMDkKICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMTNfMTYgKCByZWNvcmQsIGhlYWQgKQogICAgICogQHBhcmFtIHtSZWNvcmR9IHJlY29yZCBBIG1hcmMgcmVjb3JkIG9iamVjdAogICAgICogQHBhcmFtIHtSZWNvcmR9IGhlYWQgYSBtYXJjIGhlYWQgcmVjb3JkIG9iamVjdAogICAgICogQHJldHVybiB7U3RyaW5nfSBjb2RlIGZvciBtYXRlcmlhbCB0eXBlIGFzIGEgc3RyaW5nCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMTNfMTYKICAgICAqLwoKICAgIGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uMTNfMTYoIHJlY29yZCwgaGVhZCApIHsgICAgIC8vTWF0ZXJpYWxlYmV0ZWduZWxzZQoKICAgICAgICBMb2cuaW5mbyggIkVudGVyaW5nIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMTNfMTYiICk7CgogICAgICAgIHZhciBwb3MxM18xNiA9ICJYWFg7IjsKICAgICAgICB2YXIgc3ViZmllbGR2YWx1ZSA9ICIiOwogICAgICAgIHZhciBmb2N1c1JlY29yZDsKICAgICAgICBpZiAoIGhlYWQgIT09IG51bGwgKSB7CiAgICAgICAgICAgIGZvY3VzUmVjb3JkID0gaGVhZDsgICAgICAgICAgICAgICAgICAgICAgICAgLy9JZiB0aGVyZSBpcyBhIG1haW4gcmVjb3JkLCBmaW5kIG1hdGVyaWFsIHR5cGUgaGVyZQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvY3VzUmVjb3JkID0gcmVjb3JkOyAgICAgICAgICAgICAgICAgICAgICAgLy9lbHNlIHVzZSB0aGUgcmVjb3JkIGl0IHNlbGYgdG8gbG9vayBmb3IgbWF0ZXJpYWwgdHlwZQogICAgICAgIH0KICAgICAgICBmb2N1c1JlY29yZC5lYWNoRmllbGQoICIwMDkiLAogICAgICAgICAgICBmdW5jdGlvbiggZmllbGQgKSB7CiAgICAgICAgICAgICAgICBmaWVsZC5lYWNoU3ViRmllbGQoIC9bYWddLywKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiggZmllbGQsIHN1YkZpZWxkICkgewogICAgICAgICAgICAgICAgICAgICAgICBzdWJmaWVsZHZhbHVlICs9IHN1YkZpZWxkLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICApOwogICAgICAgIGlmICggc3ViZmllbGR2YWx1ZS5tYXRjaCggL2F4eC8gKSApIHsKICAgICAgICAgICAgcG9zMTNfMTYgPSAiQVhYOyI7CiAgICAgICAgfSBlbHNlIGlmICggc3ViZmllbGR2YWx1ZS5tYXRjaCggL2F4ZS8gKSApIHsKICAgICAgICAgICAgcG9zMTNfMTYgPSAiQVhFOyI7CiAgICAgICAgfSBlbHNlIGlmICggc3ViZmllbGR2YWx1ZS5tYXRjaCggLyhheHkpfChhdC4pLyApICkgeyAgICAvLyBBZGRlZCAyMDE1MTIxNgogICAgICAgICAgICBwb3MxM18xNiA9ICJBWFk7IjsKICAgICAgICB9IGVsc2UgaWYgKCBzdWJmaWVsZHZhbHVlLm1hdGNoKCAvKHR4ZSl8KHJ4ZSl8KG14ZSkvICkgKSB7CiAgICAgICAgICAgIHBvczEzXzE2ID0gIlRYRTsiOwogICAgICAgIH0gZWxzZSBpZiAoIHN1YmZpZWxkdmFsdWUubWF0Y2goIC8odHQuKXwodHh5KXwobXh5KXwobXRvKS8gKSApIHsKICAgICAgICAgICAgcG9zMTNfMTYgPSAiVFhZOyI7CiAgICAgICAgfQoKICAgICAgICBMb2cuaW5mbyggIkxlYXZpbmc6IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMTNfMTYgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBwb3MxM18xNjsKICAgIH07CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IGNyZWF0ZXMgYSBzdHJpbmcgd2l0aCBwb3NpdGlvbiAxNy0xOCBvZiBhIGNvbW1hIHNlcGFyYXRlZAogICAgICogcmVwcmVzZW50YXRpb24gb2YgYSBtYXJjIHJlY29yZCBmaWVsZCAwMDgKICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMTdfMTggKCByZWNvcmQsIGhlYWQgKQogICAgICogQHBhcmFtIHtSZWNvcmR9IHJlY29yZCBBIG1hcmMgcmVjb3JkIG9iamVjdAogICAgICogQHBhcmFtIHtSZWNvcmR9IGhlYWQgYSBtYXJjIGhlYWQgcmVjb3JkIG9iamVjdAogICAgICogQHJldHVybiB7U3RyaW5nfSBjb2RlIGZvciB0eXBlIG9mIHB1YmxpY2F0aW9uIChzZXJpYWw9cCBvciBtb25vZ3JhcGg9bSkgYXMgYSBzdHJpbmcKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb24xN18xOAogICAgICovCgogICAgZnVuY3Rpb24gY3JlYXRlUG9zaXRpb24xN18xOCggcmVjb3JkLCBoZWFkICkgeyAgICAgLy9QZXJpb2RpY3VtIGVsbGVyIG1vbm9ncmFmaQoKICAgICAgICBMb2cuaW5mbyggIkVudGVyaW5nIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMTdfMTgiICk7CgogICAgICAgIHZhciBwb3MxN18xOCA9ICJYOyI7CiAgICAgICAgdmFyIGJpYkNhdGVnb3J5ID0gcmVjb3JkLmZpZWxkKCAnMDA4JyApLnN1YmZpZWxkKCAndCcgKS52YWx1ZTsKICAgICAgICB2YXIgcGVyaW9kaWN1bVR5cGUgPSByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICdoJyApLnZhbHVlOwoKICAgICAgICBpZiAoIGhlYWQgIT09IG51bGwgKSB7CiAgICAgICAgICAgIHBlcmlvZGljdW1UeXBlID0gaGVhZC5maWVsZCggJzAwOCcgKS5zdWJmaWVsZCggJ2gnICkudmFsdWU7CiAgICAgICAgfQoKICAgICAgICBpZiAoIGJpYkNhdGVnb3J5ID09PSAicCIgJiYgcGVyaW9kaWN1bVR5cGUgIT09ICJtIiApIHsKICAgICAgICAgICAgcG9zMTdfMTggPSAiUDsiOwogICAgICAgIH0KICAgICAgICBpZiAoIGJpYkNhdGVnb3J5ID09PSAibSIgfHwgYmliQ2F0ZWdvcnkgPT09ICJzIiB8fCBwZXJpb2RpY3VtVHlwZSA9PT0gIm0iICkgewogICAgICAgICAgICBwb3MxN18xOCA9ICJNOyI7CiAgICAgICAgfQoKICAgICAgICBMb2cuaW5mbyggIkxlYXZpbmc6IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMTdfMTggZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBwb3MxN18xODsKCiAgICB9OwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgc3RyaW5nIHdpdGggcG9zaXRpb24gMTktMjEgb2YgYSBjb21tYSBzZXBhcmF0ZWQKICAgICAqIHJlcHJlc2VudGF0aW9uIG9mIGEgbWFyYyByZWNvcmQgZmllbGQgMDA4CiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjE5XzIxICggcmVjb3JkLCBoZWFkICkKICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgQSBtYXJjIHJlY29yZCBvYmplY3QKICAgICAqIEBwYXJhbSB7UmVjb3JkfSBoZWFkIGEgbWFyYyBoZWFkIHJlY29yZCBvYmplY3QKICAgICAqIEByZXR1cm4ge1N0cmluZ30gY29kZSBmb3IgcHVibGlzaGluZyBjb3VudHJ5IChESy9VRCkgYXMgYSBzdHJpbmcKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb24xOV8yMQogICAgICovCgogICAgZnVuY3Rpb24gY3JlYXRlUG9zaXRpb24xOV8yMSggcmVjb3JkLCBoZWFkICkgeyAgICAgLy9VZGdpdmVsc2VzbGFuZAoKICAgICAgICBMb2cuaW5mbyggIkVudGVyaW5nIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMTlfMjEiICk7CgogICAgICAgIHZhciBwb3MxOV8yMSA9ICJYWDsiOwoKICAgICAgICB2YXIgY291bnRyeUNvZGUgPSByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICdiJyApLnZhbHVlOwogICAgICAgIGlmICggaGVhZCAhPT0gbnVsbCApIHsKICAgICAgICAgICAgaWYgKCBjb3VudHJ5Q29kZSA9PT0gIiIgKSB7CiAgICAgICAgICAgICAgICBjb3VudHJ5Q29kZSA9IGhlYWQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICdiJyApLnZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICggY291bnRyeUNvZGUgPT09ICJkayIgKSB7CiAgICAgICAgICAgIHBvczE5XzIxID0gIkRLOyI7CiAgICAgICAgfSBlbHNlIGlmICggY291bnRyeUNvZGUgIT09ICIiICkgewogICAgICAgICAgICBwb3MxOV8yMSA9ICJVRDsiOwogICAgICAgIH0KCiAgICAgICAgTG9nLmluZm8oICJMZWF2aW5nOiBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjE5XzIxIGZ1bmN0aW9uIiApOwoKICAgICAgICByZXR1cm4gcG9zMTlfMjE7CgogICAgfTsKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhIHN0cmluZyB3aXRoIHBvc2l0aW9uIDIyLTIzIG9mIGEgY29tbWEgc2VwYXJhdGVkCiAgICAgKiByZXByZXNlbnRhdGlvbiBvZiBhIG1hcmMgcmVjb3JkIGZpZWxkcyAwMDggYW5kIDAwOQogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb24yMl8yMyAoIHJlY29yZCwgaGVhZCApCiAgICAgKiBAcGFyYW0ge1JlY29yZH0gcmVjb3JkIEEgbWFyYyByZWNvcmQgb2JqZWN0CiAgICAgKiBAcGFyYW0ge1JlY29yZH0gaGVhZCBhIG1hcmMgaGVhZCByZWNvcmQgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGNvZGUgZm9yIHR5cGUgb2YgZWRpdGlvbiAoUCxGLFgpIGFzIGEgc3RyaW5nCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMjJfMjMKICAgICAqLwoKICAgIGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uMjJfMjMoIHJlY29yZCwgaGVhZCApIHsgICAgIC8vVWRnYXZla29kZQoKICAgICAgICBMb2cuaW5mbyggIkVudGVyaW5nIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMjJfMjMiICk7CgogICAgICAgIHZhciBwb3MyMl8yMyA9ICJYOyI7CiAgICAgICAgdmFyIG1hdENvZGUgPSAiIjsKICAgICAgICB2YXIgZWRpdGlvbkNvZGUgPSAiIjsKCiAgICAgICAgdmFyIGZvY3VzUmVjb3JkOwogICAgICAgIGlmICggaGVhZCAhPT0gbnVsbCApIHsKICAgICAgICAgICAgZm9jdXNSZWNvcmQgPSBoZWFkOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvY3VzUmVjb3JkID0gcmVjb3JkOwogICAgICAgIH0KCiAgICAgICAgZm9jdXNSZWNvcmQuZWFjaEZpZWxkKCAiMDA5IiwKICAgICAgICAgICAgZnVuY3Rpb24oIGZpZWxkICkgewogICAgICAgICAgICAgICAgZmllbGQuZWFjaFN1YkZpZWxkKCAvW2FnXS8sCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oIGZpZWxkLCBzdWJGaWVsZCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWF0Q29kZSArPSBzdWJGaWVsZC52YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgKTsKCiAgICAgICAgZm9jdXNSZWNvcmQuZWFjaEZpZWxkKCAiMDA4IiwKICAgICAgICAgICAgZnVuY3Rpb24oIGZpZWxkICkgewogICAgICAgICAgICAgICAgaWYgKCBmb2N1c1JlY29yZC5maWVsZCggJzAwOCcgKS5zdWJmaWVsZCggJyYnICkudmFsdWUgIT09ICIiICkgewogICAgICAgICAgICAgICAgICAgIGZpZWxkLmVhY2hTdWJGaWVsZCggIiYiLAogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiggZmllbGQsIHN1YkZpZWxkICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdGlvbkNvZGUgKz0gc3ViRmllbGQudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBmaWVsZC5lYWNoU3ViRmllbGQoICJ1IiwKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oIGZpZWxkLCBzdWJGaWVsZCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRpb25Db2RlICs9IHN1YkZpZWxkLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICk7CgoKLy8gICAgICAgIGlmIChTdHJpbmcoZm9jdXNSZWNvcmQuZmllbGQoJzAwOCcpLnN1YmZpZWxkKCdoJykudmFsdWUpID09PSAibSIpIHsgICAgLy8gS29sbGVrdGl2ZSBzZXJpZXIgc2FldHRlcyB0aWwgImZvZXJzdGUgdWRnYXZlIgovLwkJCQllZGl0aW9uQ29kZSA9ICJmIiA7Ci8vCQl9OwogICAgICAgIGlmICggZWRpdGlvbkNvZGUgPT09ICJmIiApIHsKICAgICAgICAgICAgcG9zMjJfMjMgPSAiRjsiOwogICAgICAgIH0KICAgICAgICBpZiAoIGVkaXRpb25Db2RlID09PSAibyIgKSB7CiAgICAgICAgICAgIGlmICggbWF0Q29kZSA9PT0gImF4eCIgKSB7CiAgICAgICAgICAgICAgICBwb3MyMl8yMyA9ICJGOyI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIG1hdENvZGUgPT09ICJheGUiICkgewogICAgICAgICAgICAgICAgcG9zMjJfMjMgPSAiTzsiOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcG9zMjJfMjMgPSAiWDsiOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICggZWRpdGlvbkNvZGUgPT09ICJ1IiApIHsKICAgICAgICAgICAgcG9zMjJfMjMgPSAiVTsiOwogICAgICAgIH0gZWxzZSBpZiAoIGVkaXRpb25Db2RlID09PSAiYyIgfHwgZWRpdGlvbkNvZGUgPT09ICJkIiApIHsKICAgICAgICAgICAgcG9zMjJfMjMgPSAiUDsiOwogICAgICAgIH0KCiAgICAgICAgTG9nLmluZm8oICJMZWF2aW5nOiBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjIyXzIzIGZ1bmN0aW9uIiApOwoKICAgICAgICByZXR1cm4gcG9zMjJfMjM7CgogICAgfTsKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhIHN0cmluZyB3aXRoIHBvc2l0aW9uIDI0LTI4IG9mIGEgY29tbWEgc2VwYXJhdGVkCiAgICAgKiByZXByZXNlbnRhdGlvbiBvZiBhIG1hcmMgcmVjb3JkIGZpZWxkIDAwOAogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb24yNF8yOCAoIHJlY29yZCwgaGVhZCApCiAgICAgKiBAcGFyYW0ge1JlY29yZH0gcmVjb3JkIEEgbWFyYyByZWNvcmQgb2JqZWN0CiAgICAgKiBAcGFyYW0ge1JlY29yZH0gaGVhZCBhIG1hcmMgaGVhZCByZWNvcmQgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IHB1Ymxpc2hpbmcgeWVhciAoZmlyc3QgaW1wcmVzc2lvbiBmb3IgbW9ub2dyYXBocyBvciBzdGFydCB5ZWFyIGZvciBzZXJpYWxzKSBhcyBhIHN0cmluZwogICAgICogQGZ1bmN0aW9uCiAgICAgKiBAbmFtZSBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjI0XzI4CiAgICAgKi8KCiAgICBmdW5jdGlvbiBjcmVhdGVQb3NpdGlvbjI0XzI4KCByZWNvcmQsIGhlYWQgKSB7ICAgICAvL1VkZ2l2ZWxzZXNhYXIgZm9lcnN0IG9wbGFnL0JlZ3luZGVsc2VzYWFyIGZvciBwZXJpb2RpY3VtCgogICAgICAgIExvZy5pbmZvKCAiRW50ZXJpbmcgRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb24yNF8yOCIgKTsKCiAgICAgICAgdmFyIHBvczI0XzI4ID0gIlhYWFg7IjsKCiAgICAgICAgaWYgKCByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICdhJyApLnZhbHVlICE9PSAiIiApIHsKICAgICAgICAgICAgcG9zMjRfMjggPSByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICdhJyApLnZhbHVlICsgIjsiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICggaGVhZCAhPT0gbnVsbCApIHsKICAgICAgICAgICAgICAgIGlmICggaGVhZC5maWVsZCggJzAwOCcgKS5zdWJmaWVsZCggJ2EnICkudmFsdWUgIT09ICIiICkgewogICAgICAgICAgICAgICAgICAgIHBvczI0XzI4ID0gaGVhZC5maWVsZCggJzAwOCcgKS5zdWJmaWVsZCggJ2EnICkudmFsdWUgKyAiOyI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcG9zMjRfMjggPSBwb3MyNF8yOC5yZXBsYWNlKCAvXD8vZywgIloiICk7ICAgICAgIC8vIEVmdGVyIG9lbnNrZSBmcmEgRFMgZXJzdGF0dGVzIGFsbGUgJz8nIG1lZCAnWicKCiAgICAgICAgTG9nLmluZm8oICJMZWF2aW5nOiBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjI0XzI4IGZ1bmN0aW9uIiApOwoKICAgICAgICByZXR1cm4gcG9zMjRfMjg7CgogICAgfTsKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhIHN0cmluZyB3aXRoIHBvc2l0aW9uIDI5LTMwIG9mIGEgY29tbWEgc2VwYXJhdGVkCiAgICAgKiByZXByZXNlbnRhdGlvbiBvZiBhIG1hcmMgcmVjb3JkIGZpZWxkIDAwOAogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb24yOV8zMCAoIHJlY29yZCwgaGVhZCApCiAgICAgKiBAcGFyYW0ge1JlY29yZH0gcmVjb3JkIEEgbWFyYyByZWNvcmQgb2JqZWN0CiAgICAgKiBAcGFyYW0ge1JlY29yZH0gaGVhZCBhIG1hcmMgaGVhZCByZWNvcmQgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGltcHJlc3Npb24gYXMgYSBzdHJpbmcKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb24yOV8zMAogICAgICovCgogICAgZnVuY3Rpb24gY3JlYXRlUG9zaXRpb24yOV8zMCggcmVjb3JkLCBoZWFkICkgeyAgICAgLy9PcGxhZwoKICAgICAgICBMb2cuaW5mbyggIkVudGVyaW5nIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMjlfMzAiICk7CgogICAgICAgIHZhciBwb3MyOV8zMCA9ICJYOyI7CiAgICAgICAgaWYgKCByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICd1JyApLnZhbHVlID09PSAiciIgKSB7CiAgICAgICAgICAgIHBvczI5XzMwID0gIlI7IjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoIGhlYWQgIT09IG51bGwgKSB7CiAgICAgICAgICAgICAgICBpZiAoIGhlYWQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICd1JyApLnZhbHVlID09PSAiciIgKSB7CiAgICAgICAgICAgICAgICAgICAgcG9zMjlfMzAgPSAiUjsiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBMb2cuaW5mbyggIkxlYXZpbmc6IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMjlfMzAgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBwb3MyOV8zMDsKCiAgICB9OwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgc3RyaW5nIHdpdGggcG9zaXRpb24gMzEtMzUgb2YgYSBjb21tYSBzZXBhcmF0ZWQKICAgICAqIHJlcHJlc2VudGF0aW9uIG9mIGEgbWFyYyByZWNvcmQgZmllbGQgMDA4CiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjMxXzM1ICggcmVjb3JkLCBoZWFkICkKICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgQSBtYXJjIHJlY29yZCBvYmplY3QKICAgICAqIEBwYXJhbSB7UmVjb3JkfSBoZWFkIGEgbWFyYyBoZWFkIHJlY29yZCBvYmplY3QKICAgICAqIEByZXR1cm4ge1N0cmluZ30gbGF0ZXN0IHB1Ymxpc2hpbmcgeWVhciBmb3IgaW1wcmVzc2lvbiBhcyBhIHN0cmluZwogICAgICogQGZ1bmN0aW9uCiAgICAgKiBAbmFtZSBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjMxXzM1CiAgICAgKi8KCiAgICBmdW5jdGlvbiBjcmVhdGVQb3NpdGlvbjMxXzM1KCByZWNvcmQsIGhlYWQgKSB7ICAgICAvL1NlbmVzdGUgdWRnaXZlbHNlc2FhciBmb3Igb3BsYWcKCiAgICAgICAgTG9nLmluZm8oICJFbnRlcmluZyBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjMxXzM1IiApOwoKICAgICAgICB2YXIgcG9zMzFfMzUgPSAiWFhYWDsiOwoKICAgICAgICBpZiAoIHJlY29yZC5maWVsZCggJzAwOCcgKS5zdWJmaWVsZCggJ3UnICkudmFsdWUgPT09ICJyIiAmJiByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICd6JyApLnZhbHVlICE9PSAiIiApIHsKICAgICAgICAgICAgcG9zMzFfMzUgPSByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICd6JyApLnZhbHVlICsgIjsiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICggaGVhZCAhPT0gbnVsbCApIHsKICAgICAgICAgICAgICAgIGlmICggaGVhZC5maWVsZCggJzAwOCcgKS5zdWJmaWVsZCggJ3UnICkudmFsdWUgPT09ICJyIiAmJiBoZWFkLmZpZWxkKCAnMDA4JyApLnN1YmZpZWxkKCAneicgKS52YWx1ZSAhPT0gIiIgKSB7CiAgICAgICAgICAgICAgICAgICAgcG9zMzFfMzUgPSBoZWFkLmZpZWxkKCAnMDA4JyApLnN1YmZpZWxkKCAneicgKS52YWx1ZSArICI7IjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBwb3MzMV8zNSA9IHBvczMxXzM1LnJlcGxhY2UoIC9cPy9nLCAiWiIgKTsgICAgICAgLy8gRWZ0ZXIgb2Vuc2tlIGZyYSBEUyBlcnN0YXR0ZXMgYWxsZSAnPycgbWVkICdaJwoKICAgICAgICBMb2cuaW5mbyggIkxlYXZpbmc6IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMzFfMzUgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBwb3MzMV8zNTsKCiAgICB9OwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgc3RyaW5nIHdpdGggcG9zaXRpb24gMzYtMzcgb2YgYSBjb21tYSBzZXBhcmF0ZWQKICAgICAqIHJlcHJlc2VudGF0aW9uIG9mIGEgbWFyYyByZWNvcmQgZmllbGRzIDAwOCBhbmQgMDA5CiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjM2XzM3ICggcmVjb3JkLCBoZWFkICkKICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgQSBtYXJjIHJlY29yZCBvYmplY3QKICAgICAqIEBwYXJhbSB7UmVjb3JkfSBoZWFkIGEgbWFyYyBoZWFkIHJlY29yZCBvYmplY3QKICAgICAqIEByZXR1cm4ge1N0cmluZ30gY29kZSBmb3IgZXh0ZW50IChzbWFhdHJ5aykgYXMgYSBzdHJpbmcKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb24zNl8zNwogICAgICovCgogICAgZnVuY3Rpb24gY3JlYXRlUG9zaXRpb24zNl8zNyggcmVjb3JkLCBoZWFkICkgeyAgICAgLy9TbWFhdHJ5az8KCiAgICAgICAgTG9nLmluZm8oICJFbnRlcmluZyBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjM2XzM3IiApOwoKICAgICAgICB2YXIgcG9zMzZfMzcgPSAiWDsiOwogICAgICAgIHZhciB0eXBlY29kZSA9ICIiOwogICAgICAgIHZhciBmb2N1c1JlY29yZDsKICAgICAgICBpZiAoIGhlYWQgIT09IG51bGwgKSB7CiAgICAgICAgICAgIGZvY3VzUmVjb3JkID0gaGVhZDsgICAgICAgICAgICAgICAgICAgICAgICAgLy9JZiB0aGVyZSBpcyBhIG1haW4gcmVjb3JkLCBmaW5kIG1hdGVyaWFsIHR5cGUgaGVyZQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvY3VzUmVjb3JkID0gcmVjb3JkOyAgICAgICAgICAgICAgICAgICAgICAgLy9lbHNlIHVzZSB0aGUgcmVjb3JkIGl0c2VsZiB0byBsb29rIGZvciBtYXRlcmlhbCB0eXBlCiAgICAgICAgfQoKICAgICAgICByZWNvcmQuZWFjaEZpZWxkKCAiMDA4IiwKICAgICAgICAgICAgZnVuY3Rpb24oIGZpZWxkICkgewogICAgICAgICAgICAgICAgZmllbGQuZWFjaFN1YkZpZWxkKCAiZCIsCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oIGZpZWxkLCBzdWJGaWVsZCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZWNvZGUgKz0gc3ViRmllbGQudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICk7CgogICAgICAgIGlmICggZm9jdXNSZWNvcmQuZmllbGQoICcwMDknICkuc3ViZmllbGQoICdnJyApLnZhbHVlID09PSAieHgiICkgewogICAgICAgICAgICBpZiAoIHR5cGVjb2RlLm1hdGNoKCAvXHUwMEU1LyApICkgewogICAgICAgICAgICAgICAgcG9zMzZfMzcgPSAiVTsiOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcG9zMzZfMzcgPSAiTzsiOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBMb2cuaW5mbyggIkxlYXZpbmc6IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMzZfMzcgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBwb3MzNl8zNzsKCiAgICB9OwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgc3RyaW5nIHdpdGggcG9zaXRpb24gMzgtMzkgb2YgYSBjb21tYSBzZXBhcmF0ZWQKICAgICAqIHJlcHJlc2VudGF0aW9uIG9mIGEgbWFyYyByZWNvcmQgZmllbGQgMDA4CiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjM4XzM5ICggcmVjb3JkLCBoZWFkICkKICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgQSBtYXJjIHJlY29yZCBvYmplY3QKICAgICAqIEBwYXJhbSB7UmVjb3JkfSBoZWFkIGEgbWFyYyBoZWFkIHJlY29yZCBvYmplY3QKICAgICAqIEByZXR1cm4ge1N0cmluZ30gY29kZSBmb3IgY2hpbGQgb3Igc2Nob29sIG1hdGVyaWFsIGFzIGEgc3RyaW5nCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMzhfMzkKICAgICAqLwoKICAgIGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uMzhfMzkoIHJlY29yZCwgaGVhZCApIHsgICAgIC8vQm9lcm5lL3Nrb2xla29kZQoKICAgICAgICBMb2cuaW5mbyggIkVudGVyaW5nIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uMzhfMzkiICk7CgogICAgICAgIHZhciBwb3MzOF8zOSA9ICJYOyI7CiAgICAgICAgaWYgKCByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICdvJyApLnZhbHVlID09PSAiYiIgKSB7CiAgICAgICAgICAgIHBvczM4XzM5ID0gIkI7IjsKICAgICAgICB9CiAgICAgICAgaWYgKCByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICdvJyApLnZhbHVlID09PSAicyIgKSB7CiAgICAgICAgICAgIHBvczM4XzM5ID0gIlM7IjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoIGhlYWQgIT09IG51bGwgKSB7CiAgICAgICAgICAgICAgICBpZiAoIGhlYWQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICdvJyApLnZhbHVlID09PSAiYiIgKSB7CiAgICAgICAgICAgICAgICAgICAgcG9zMzhfMzkgPSAiQjsiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCBoZWFkLmZpZWxkKCAnMDA4JyApLnN1YmZpZWxkKCAnbycgKS52YWx1ZSA9PT0gInMiICkgewogICAgICAgICAgICAgICAgICAgIHBvczM4XzM5ID0gIlM7IjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgTG9nLmluZm8oICJMZWF2aW5nOiBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjM4XzM5IGZ1bmN0aW9uIiApOwoKICAgICAgICByZXR1cm4gcG9zMzhfMzk7CgogICAgfTsKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhIHN0cmluZyB3aXRoIHBvc2l0aW9uIDQwLTQzIG9mIGEgY29tbWEgc2VwYXJhdGVkCiAgICAgKiByZXByZXNlbnRhdGlvbiBvZiBhIG1hcmMgcmVjb3JkIGZpZWxkIDAwOAogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb240MF80MyAoIHJlY29yZCwgaGVhZCApCiAgICAgKiBAcGFyYW0ge1JlY29yZH0gcmVjb3JkIEEgbWFyYyByZWNvcmQgb2JqZWN0CiAgICAgKiBAcGFyYW0ge1JlY29yZH0gaGVhZCBhIG1hcmMgaGVhZCByZWNvcmQgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGNvZGUgZm9yIHByaW1hcnkgbGFuZ3VhZ2UgYXMgYSBzdHJpbmcKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb240MF80MwogICAgICovCgogICAgZnVuY3Rpb24gY3JlYXRlUG9zaXRpb240MF80MyggcmVjb3JkLCBoZWFkICkgeyAgICAgLy9QcmltYWVydCBzcHJvZwoKICAgICAgICBMb2cuaW5mbyggIkVudGVyaW5nIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNDBfNDMiICk7CgogICAgICAgIHZhciBwb3M0MF80MyA9ICJYWFg7IjsKCiAgICAgICAgaWYgKCByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICdsJyApLnZhbHVlICE9PSAiIiApIHsKICAgICAgICAgICAgcG9zNDBfNDMgPSByZWNvcmQuZmllbGQoICcwMDgnICkuc3ViZmllbGQoICdsJyApLnZhbHVlLnRvVXBwZXJDYXNlKCkgKyAiOyI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKCBoZWFkICE9PSBudWxsICkgewogICAgICAgICAgICAgICAgaWYgKCBoZWFkLmZpZWxkKCAnMDA4JyApLnN1YmZpZWxkKCAnbCcgKS52YWx1ZSAhPT0gIiIgKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCBoZWFkLmZpZWxkKCAnMDA4JyApLnN1YmZpZWxkKCAnbCcgKS52YWx1ZSA9PT0gIm11bCIgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggcmVjb3JkLmZpZWxkKCAnMDQxJyApLnN1YmZpZWxkKCAnYScgKS52YWx1ZSAhPT0gIiIgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3M0MF80MyA9IHJlY29yZC5maWVsZCggJzA0MScgKS5zdWJmaWVsZCggJ2EnICkudmFsdWUudG9VcHBlckNhc2UoKSArICI7IjsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHBvczQwXzQzID0gaGVhZC5maWVsZCggJzAwOCcgKS5zdWJmaWVsZCggJ2wnICkudmFsdWUudG9VcHBlckNhc2UoKSArICI7IjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgcG9zNDBfNDMgPSBoZWFkLmZpZWxkKCAnMDA4JyApLnN1YmZpZWxkKCAnbCcgKS52YWx1ZS50b1VwcGVyQ2FzZSgpICsgIjsiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBMb2cuaW5mbyggIkxlYXZpbmc6IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNDBfNDMgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBwb3M0MF80MzsKCiAgICB9OwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgc3RyaW5nIHdpdGggcG9zaXRpb24gNDQtNDcgb2YgYSBjb21tYSBzZXBhcmF0ZWQKICAgICAqIHJlcHJlc2VudGF0aW9uIG9mIGEgbWFyYyByZWNvcmQgZmllbGQgMDQxCiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjQ0XzQ3ICggcmVjb3JkLCBoZWFkICkKICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgQSBtYXJjIHJlY29yZCBvYmplY3QKICAgICAqIEBwYXJhbSB7UmVjb3JkfSBoZWFkIGEgbWFyYyBoZWFkIHJlY29yZCBvYmplY3QKICAgICAqIEByZXR1cm4ge1N0cmluZ30gY29kZSBmb3Igb3JpZ2luYWwgbGFuZ3VhZ2UgYXMgYSBzdHJpbmcKICAgICAqIEBmdW5jdGlvbgogICAgICogQG5hbWUgRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb240NF80NwogICAgICovCgogICAgZnVuY3Rpb24gY3JlYXRlUG9zaXRpb240NF80NyggcmVjb3JkLCBoZWFkICkgeyAgICAgLy9FdnQuIG9yaWdpbmFsc3Byb2cKCiAgICAgICAgTG9nLmluZm8oICJFbnRlcmluZyBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjQ0XzQ3IiApOwoKICAgICAgICB2YXIgcG9zNDRfNDcgPSAiWFhYOyI7CgogICAgICAgIGlmICggcmVjb3JkLmZpZWxkKCAnMDQxJyApLnN1YmZpZWxkKCAnYycgKS52YWx1ZSAhPT0gIiIgKSB7CiAgICAgICAgICAgIHBvczQ0XzQ3ID0gcmVjb3JkLmZpZWxkKCAnMDQxJyApLnN1YmZpZWxkKCAnYycgKS52YWx1ZS50b1VwcGVyQ2FzZSgpICsgIjsiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICggaGVhZCAhPT0gbnVsbCApIHsKICAgICAgICAgICAgICAgIGlmICggaGVhZC5maWVsZCggJzA0MScgKS5zdWJmaWVsZCggJ2MnICkudmFsdWUgIT09ICIiICkgewogICAgICAgICAgICAgICAgICAgIHBvczQ0XzQ3ID0gaGVhZC5maWVsZCggJzA0MScgKS5zdWJmaWVsZCggJ2MnICkudmFsdWUudG9VcHBlckNhc2UoKSArICI7IjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgTG9nLmluZm8oICJMZWF2aW5nOiBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjQ0XzQ3IGZ1bmN0aW9uIiApOwoKICAgICAgICByZXR1cm4gcG9zNDRfNDc7CgogICAgfTsKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhIHN0cmluZyB3aXRoIHBvc2l0aW9uIDQ4LTQ5IG9mIGEgY29tbWEgc2VwYXJhdGVkCiAgICAgKiByZXByZXNlbnRhdGlvbiBvZiBhIG1hcmMgcmVjb3JkIGZpZWxkcyAwMDksIDI2MCwgODU2CiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjQ4XzQ5ICggcmVjb3JkLCBoZWFkICkKICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgQSBtYXJjIHJlY29yZCBvYmplY3QKICAgICAqIEBwYXJhbSB7UmVjb3JkfSBoZWFkIGEgbWFyYyBoZWFkIHJlY29yZCBvYmplY3QKICAgICAqIEByZXR1cm4ge1N0cmluZ30gdHJhZGluZyBjb2RlIGFzIGEgc3RyaW5nCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNDhfNDkKICAgICAqLwoKICAgIGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uNDhfNDkoIHJlY29yZCwgaGVhZCApIHsgICAgIC8vSGFuZGVsc2tvZGUKCiAgICAgICAgTG9nLmluZm8oICJFbnRlcmluZyBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjQ4XzQ5IiApOwoKICAgICAgICB2YXIgcG9zNDhfNDkgPSAiWDsiOwogICAgICAgIHZhciBzdWJmaWVsZHZhbHVlMjYwZyA9ICIiOwogICAgICAgIHZhciBzdWJmaWVsZHZhbHVlODU2eSA9ICIiOwoKICAgICAgICByZWNvcmQuZWFjaEZpZWxkKCAiMjYwIiwKICAgICAgICAgICAgZnVuY3Rpb24oIGZpZWxkICkgewogICAgICAgICAgICAgICAgZmllbGQuZWFjaFN1YkZpZWxkKCAiZyIsCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oIGZpZWxkLCBzdWJGaWVsZCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3ViZmllbGR2YWx1ZTI2MGcgKz0gc3ViRmllbGQudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICk7CgogICAgICAgIHJlY29yZC5lYWNoRmllbGQoICI4NTYiLAogICAgICAgICAgICBmdW5jdGlvbiggZmllbGQgKSB7CiAgICAgICAgICAgICAgICBmaWVsZC5lYWNoU3ViRmllbGQoICJ5IiwKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiggZmllbGQsIHN1YkZpZWxkICkgewogICAgICAgICAgICAgICAgICAgICAgICBzdWJmaWVsZHZhbHVlODU2eSArPSBzdWJGaWVsZC52YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgKTsKCiAgICAgICAgaWYgKCByZWNvcmQuZmllbGQoICcwMDknICkuc3ViZmllbGQoICdnJyApLnZhbHVlID09PSAieGUiICkgewovLwkJCWlmICggc3ViZmllbGR2YWx1ZTI2MGcubWF0Y2goIC9bc2FlbGdlcyBwXHUwMEU1IGludGVybmV0dGV0XS8gKSApIHsKICAgICAgICAgICAgaWYgKCBzdWJmaWVsZHZhbHVlMjYwZy5tYXRjaCggL3NcdTAwRTZsZ2VzIHBcdTAwRTUgaW50ZXJuZXQvICkgKSB7CiAgICAgICAgICAgICAgICBwb3M0OF80OSA9ICJOOyI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIHN1YmZpZWxkdmFsdWU4NTZ5Lm1hdGNoKCAvZGdhbmcgdGlsIGtcdTAwZjhiLyApICkgewogICAgICAgICAgICAgICAgcG9zNDhfNDkgPSAiTjsiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8qCQkJZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3M0OF80OSA9ICJYOyI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0qLwogICAgICAgIH0KCiAgICAgICAgaWYgKCByZWNvcmQuZmllbGQoICcwMDknICkuc3ViZmllbGQoICdnJyApLnZhbHVlID09PSAieHgiICkgewogICAgICAgICAgICBpZiAoIHJlY29yZC5maWVsZCggJzI2MCcgKS5zdWJmaWVsZCggJyYnICkudmFsdWUgPT09ICIxIiApIHsKICAgICAgICAgICAgICAgIHBvczQ4XzQ5ID0gIks7IjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHBvczQ4XzQ5ID0gIlU7IjsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICggaGVhZCAhPT0gbnVsbCApIHsKICAgICAgICAgICAgICAgIGlmICggc3ViZmllbGR2YWx1ZTI2MGcubWF0Y2goIC9zXHUwMEU2bGdlcy8gKSApIHsKICAgICAgICAgICAgICAgICAgICBwb3M0OF80OSA9ICJOOyI7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBzdWJmaWVsZHZhbHVlODU2eS5tYXRjaCggL2tcdTAwZjhiLyApICkgewogICAgICAgICAgICAgICAgICAgIHBvczQ4XzQ5ID0gIk47IjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcG9zNDhfNDkgPSAiWDsiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCBoZWFkLmZpZWxkKCAnMDA5JyApLnN1YmZpZWxkKCAnZycgKS52YWx1ZSA9PT0gInh4IiApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIGhlYWQuZmllbGQoICcyNjAnICkuc3ViZmllbGQoICcmJyApLnZhbHVlID09PSAiMSIgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvczQ4XzQ5ID0gIks7IjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBwb3M0OF80OSA9ICJVOyI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBMb2cuaW5mbyggIkxlYXZpbmc6IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNDhfNDkgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBwb3M0OF80OTsKCiAgICB9OwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgc3RyaW5nIHdpdGggcG9zaXRpb24gNTAtNTEgb2YgYSBjb21tYSBzZXBhcmF0ZWQKICAgICAqIHJlcHJlc2VudGF0aW9uIG9mIGEgbWFyYyByZWNvcmQgZmllbGQgNjUyCiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjUwXzUxICggcmVjb3JkLCBoZWFkICkKICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgQSBtYXJjIHJlY29yZCBvYmplY3QKICAgICAqIEBwYXJhbSB7UmVjb3JkfSBoZWFkIGEgbWFyYyBoZWFkIHJlY29yZCBvYmplY3QKICAgICAqIEByZXR1cm4ge1N0cmluZ30gY29kZSBmb3IgZmljdGlvbiBvciBub24tZmljdGlvbiBhcyBhIHN0cmluZwogICAgICogQGZ1bmN0aW9uCiAgICAgKiBAbmFtZSBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjUwXzUxCiAgICAgKi8KCiAgICBmdW5jdGlvbiBjcmVhdGVQb3NpdGlvbjUwXzUxKCByZWNvcmQsIGhlYWQgKSB7ICAgICAvL0ZhZy0gZWxsZXIgc2tvZW5saXR0ZXJhdHVyCgogICAgICAgIExvZy5pbmZvKCAiRW50ZXJpbmcgRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb241MF81MSIgKTsKCiAgICAgICAgdmFyIHBvczUwXzUxID0gIkY7IjsKICAgICAgICB2YXIgZm9jdXNSZWNvcmQ7CiAgICAgICAgaWYgKCBoZWFkICE9PSBudWxsICkgewogICAgICAgICAgICBmb2N1c1JlY29yZCA9IGhlYWQ7ICAgICAgICAgICAgICAgICAgICAgICAgIC8vSWYgdGhlcmUgaXMgYSBtYWluIHJlY29yZCwgZmluZCBmaWN0aW9uIG9yIG5vbi1maWN0aW9uCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9jdXNSZWNvcmQgPSByZWNvcmQ7ICAgICAgICAgICAgICAgICAgICAgICAvL2Vsc2UgdXNlIHRoZSByZWNvcmQgaXQgc2VsZiB0byBsb29rIGZvciBmaWN0aW9uIG9yIG5vbi1maWN0aW9uCiAgICAgICAgfQoKICAgICAgICBmb2N1c1JlY29yZC5lYWNoRmllbGQoICI2NTIiLAogICAgICAgICAgICBmdW5jdGlvbiggZmllbGQgKSB7CiAgICAgICAgICAgICAgICBmaWVsZC5lYWNoU3ViRmllbGQoIC8uLywKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiggZmllbGQsIHN1YkZpZWxkICkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHN1YkZpZWxkLm5hbWUgPT09ICJvIiApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggc3ViRmllbGQudmFsdWUgPT09ICJzayIgfHwgc3ViRmllbGQudmFsdWUubWF0Y2goIC9eOFsyLThdLyApICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvczUwXzUxID0gIlM7IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gKTsKICAgICAgICAgICAgfSApOwoKICAgICAgICBMb2cuaW5mbyggIkxlYXZpbmc6IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNTBfNTEgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBwb3M1MF81MTsKCiAgICB9OwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgc3RyaW5nIHdpdGggcG9zaXRpb24gNTItNTQgb2YgYSBjb21tYSBzZXBhcmF0ZWQKICAgICAqIHJlcHJlc2VudGF0aW9uIG9mIGEgbWFyYyByZWNvcmQgZmllbGQgNjUyCiAgICAgKgogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjUyXzU0ICggcmVjb3JkLCBoZWFkICkKICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgQSBtYXJjIHJlY29yZCBvYmplY3QKICAgICAqIEBwYXJhbSB7UmVjb3JkfSBoZWFkIGEgbWFyYyBoZWFkIHJlY29yZCBvYmplY3QKICAgICAqIEByZXR1cm4ge1N0cmluZ30gREs1LWNsYXNzaWZpY2F0aW9uIGFzIGEgc3RyaW5nCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNTJfNTQKICAgICAqLwoKICAgIGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uNTJfNTQoIHJlY29yZCwgaGVhZCApIHsgICAgIC8vRW1uZSBmb3IgZmFnbGl0dGVyYXR1ci90eXBlIGFmIHNrb2VubGl0dHRlcmF0dXIKCiAgICAgICAgTG9nLmluZm8oICJFbnRlcmluZyBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjUyXzU0IiApOwoKICAgICAgICB2YXIgcG9zNTJfNTQgPSAiWFg7IjsKICAgICAgICB2YXIgZm9jdXNSZWNvcmQ7CiAgICAgICAgaWYgKCBoZWFkICE9PSBudWxsICkgewogICAgICAgICAgICBmb2N1c1JlY29yZCA9IGhlYWQ7ICAgICAgICAgICAgICAgICAgICAgICAgIC8vSWYgdGhlcmUgaXMgYSBtYWluIHJlY29yZCwgZmluZCBESzUtY2xhc3NpZmljYXRpb24gaGVyZQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvY3VzUmVjb3JkID0gcmVjb3JkOyAgICAgICAgICAgICAgICAgICAgICAgLy9lbHNlIHVzZSB0aGUgcmVjb3JkIGl0c2VsZiB0byBsb29rIGZvciBESzUtY2xhc3NpZmljYXRpb24KICAgICAgICB9CgogICAgICAgIGZvY3VzUmVjb3JkLmVhY2hGaWVsZCggIjY1MiIsCiAgICAgICAgICAgIGZ1bmN0aW9uKCBmaWVsZCApIHsKICAgICAgICAgICAgICAgIGZpZWxkLmVhY2hTdWJGaWVsZCggLy4vLAogICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCBmaWVsZCwgc3ViRmllbGQgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggc3ViRmllbGQubmFtZSA9PT0gIm0iICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRrNUNvZGUgPSBzdWJGaWVsZC52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvczUyXzU0ID0gZGs1Q29kZS5zdWJzdHJpbmcoIDAsIDIgKSArICI7IjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHN1YkZpZWxkLm5hbWUgPT09ICJ6IiApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkazVTdXBwbGVtZW50ID0gc3ViRmllbGQudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGRrNVN1cHBsZW1lbnQgPT09ICIwNDYiIHx8IGRrNVN1cHBsZW1lbnQgPT09ICIyNDYiICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRrNVN1cHBsZW1lbnQgPSAiWDQiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZGs1U3VwcGxlbWVudC5sZW5ndGggPiAyICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvczUyXzU0ID0gZGs1U3VwcGxlbWVudC5zdWJzdHJpbmcoIDEsIDMgKSArICI7IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZGs1U3VwcGxlbWVudC5sZW5ndGggPT09IDIgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zNTJfNTQgPSAiWCIgKyBkazVTdXBwbGVtZW50LnN1YnN0cmluZyggMSwgMiApICsgIjsiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICk7CgogICAgICAgIExvZy5pbmZvKCAiTGVhdmluZzogRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb241Ml81NCBmdW5jdGlvbiIgKTsKCiAgICAgICAgcmV0dXJuIHBvczUyXzU0OwoKICAgIH07CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IGNyZWF0ZXMgYSBzdHJpbmcgd2l0aCBwb3NpdGlvbiA1NS01NiBvZiBhIGNvbW1hIHNlcGFyYXRlZAogICAgICogcmVwcmVzZW50YXRpb24gb2YgYSBtYXJjIHJlY29yZCBmaWVsZCAwMDQKICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNTVfNTYgKCByZWNvcmQsIGhlYWQgKQogICAgICogQHBhcmFtIHtSZWNvcmR9IHJlY29yZCBBIG1hcmMgcmVjb3JkIG9iamVjdAogICAgICogQHJldHVybiB7U3RyaW5nfSBjb2RlIGZvciByZWNvcmQgdHlwZSBhcyBhIHN0cmluZwogICAgICogQGZ1bmN0aW9uCiAgICAgKiBAbmFtZSBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjU1XzU2CiAgICAgKi8KCiAgICBmdW5jdGlvbiBjcmVhdGVQb3NpdGlvbjU1XzU2KCByZWNvcmQgKSB7ICAgICAvL1Bvc3R0eXBlCgogICAgICAgIExvZy5pbmZvKCAiRW50ZXJpbmcgRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb241NV81NiIgKTsKCiAgICAgICAgdmFyIHBvczU1XzU2ID0gIlg7IjsKCiAgICAgICAgaWYgKCByZWNvcmQuZmllbGQoICcwMDQnICkuc3ViZmllbGQoICdhJyApLnZhbHVlID09PSAiZSIgKSB7CiAgICAgICAgICAgIHBvczU1XzU2ID0gIkU7IjsKICAgICAgICB9CiAgICAgICAgaWYgKCByZWNvcmQuZmllbGQoICcwMDQnICkuc3ViZmllbGQoICdhJyApLnZhbHVlID09PSAiYiIgKSB7CiAgICAgICAgICAgIHBvczU1XzU2ID0gIkI7IjsKICAgICAgICB9CgogICAgICAgIExvZy5pbmZvKCAiTGVhdmluZzogRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb241NV81NiBmdW5jdGlvbiIgKTsKCiAgICAgICAgcmV0dXJuIHBvczU1XzU2OwoKICAgIH07CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IGNyZWF0ZXMgYSBzdHJpbmcgd2l0aCBwb3NpdGlvbiA1Ny02OCBvZiBhIGNvbW1hIHNlcGFyYXRlZAogICAgICogcmVwcmVzZW50YXRpb24gb2YgYSBtYXJjIHJlY29yZCBmaWVsZCAwMDEgb2YgcGFyZW50IHJlY29yZAogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb241N182OCAoIHJlY29yZCwgaGVhZCApCiAgICAgKiBAcGFyYW0ge1JlY29yZH0gcmVjb3JkIEEgbWFyYyByZWNvcmQgb2JqZWN0CiAgICAgKiBAcGFyYW0ge1JlY29yZH0gaGVhZCBhIG1hcmMgaGVhZCByZWNvcmQgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGEgZmF1c3QgbnVtYmVyIGFzIGEgc3RyaW5nCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNTdfNjgKICAgICAqLwoKICAgIGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uNTdfNjgoIHJlY29yZCwgaGVhZCApIHsgICAgIC8vRXZ0LiBGYXVzdG51bW1lciBwYWEgaG92ZWRwb3N0CgogICAgICAgIExvZy5pbmZvKCAiRW50ZXJpbmcgRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb241N182OCIgKTsKCiAgICAgICAgdmFyIHBvczU3XzY4ID0gIlhYWFhYWFhYWFhYOyI7CgogICAgICAgIGlmICggaGVhZCAhPT0gbnVsbCApIHsKICAgICAgICAgICAgcG9zNTdfNjggPSBoZWFkLmZpZWxkKCAnMDAxJyApLnN1YmZpZWxkKCAnYScgKS52YWx1ZSArICI7IjsgICAgICAgICAgICAgICAgICAgICAgICAgLy9JZG5vIGZyb20gaGVhZCByZWNvcmQgKGluIERhbmlzaDogSG92ZWRwb3N0KQogICAgICAgIH0KCiAgICAgICAgTG9nLmluZm8oICJMZWF2aW5nOiBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjU3XzY4IGZ1bmN0aW9uIiApOwoKICAgICAgICByZXR1cm4gcG9zNTdfNjg7CgogICAgfTsKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhIHN0cmluZyB3aXRoIHBvc2l0aW9uIDY5LTc1IG9mIGEgY29tbWEgc2VwYXJhdGVkCiAgICAgKiByZXByZXNlbnRhdGlvbiBvZiBhIG1hcmMgcmVjb3JkIGZpZWxkIDAzMgogICAgICoKICAgICAqIEB0eXBlIHtmdW5jdGlvbn0KICAgICAqIEBzeW50YXggRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb242OV83NSAoIHJlY29yZCwgaGVhZCApCiAgICAgKiBAcGFyYW0ge1JlY29yZH0gcmVjb3JkIEEgbWFyYyByZWNvcmQgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGEgY2F0YWxvZyBjb2RlIGFzIGEgc3RyaW5nCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNjlfNzUKICAgICAqLwoKICAgIGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uNjlfNzUoIHJlY29yZCApIHsgICAgIC8vS2F0YWxvZ3VnZWtvZGUKCiAgICAgICAgTG9nLmluZm8oICJFbnRlcmluZyBEbTJUb0RzdC5jcmVhdGVQb3NpdGlvbjY5Xzc1IiApOwoKICAgICAgICB2YXIgcG9zNjlfNzUgPSAiWFhYWFhYOyIKCiAgICAgICAgcmVjb3JkLmVhY2hGaWVsZCggIjAzMiIsCiAgICAgICAgICAgIGZ1bmN0aW9uKCBmaWVsZCApIHsKICAgICAgICAgICAgICAgIGZpZWxkLmVhY2hTdWJGaWVsZCggImEiLAogICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCBmaWVsZCwgc3ViRmllbGQgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB3ZWVrY29kZSA9IHN1YkZpZWxkLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHdlZWtjb2RlLm1hdGNoKCAvREJGLyApICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zNjlfNzUgPSB3ZWVrY29kZS5yZXBsYWNlKCAvREJGLywgIiIgKSArICI7IjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICApOwoKICAgICAgICBMb2cuaW5mbyggIkxlYXZpbmc6IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNjlfNzUgZnVuY3Rpb24iICk7CgogICAgICAgIHJldHVybiBwb3M2OV83NTsKCiAgICB9OwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgc3RyaW5nIHdpdGggcG9zaXRpb24gNzYtODkgb2YgYSBjb21tYSBzZXBhcmF0ZWQKICAgICAqIHJlcHJlc2VudGF0aW9uIG9mIGEgbWFyYyByZWNvcmQKICAgICAqCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAc3ludGF4IERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNzZfODkgKCBkYXRlICkKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBkYXRlIGZvciBkZWxpdmVyeQogICAgICogQHJldHVybiB7U3RyaW5nfSBhIGRhdGUgZm9yIGRlbGl2ZXJ5IGFzIGEgc3RyaW5nCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBuYW1lIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNzZfODkKICAgICAqLwoKICAgIGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uNzZfODkoIGRhdGUgKSB7ICAgICAvL0xldmVyYW5jZXRpZHNwdW5rdAoKICAgICAgICBMb2cuaW5mbyggIkVudGVyaW5nIERtMlRvRHN0LmNyZWF0ZVBvc2l0aW9uNzZfODkiICk7CgogICAgICAgIGlmICggZGF0ZSA9PT0gdW5kZWZpbmVkICkgewogICAgICAgICAgICBkYXRlID0gRGF0ZVV0aWwuanNUb1lZWVltbWRkSEhNTVNTKCBEYXRlVXRpbC5ub3coKSApOwogICAgICAgIH0KICAgICAgICBwb3M3Nl84OSA9IGRhdGU7CgogICAgICAgIExvZy5pbmZvKCAiTGVhdmluZzogRG0yVG9Ec3QuY3JlYXRlUG9zaXRpb243Nl84OSBmdW5jdGlvbiIgKTsKCiAgICAgICAgcmV0dXJuIHBvczc2Xzg5OwoKICAgIH07CgoKICAgIExvZy5pbmZvKCAiTGVhdmluZzogRG0yVG9Ec3QgbW9kdWxlIiApOwoKICAgIHJldHVybiB7CiAgICAgICAgY3JlYXRlQ3N2Rm9yRHN0OiBjcmVhdGVDc3ZGb3JEc3QsCiAgICAgICAgY3JlYXRlQWxsUG9zaXRpb25zOiBjcmVhdGVBbGxQb3NpdGlvbnMsCiAgICAgICAgY3JlYXRlUG9zaXRpb24xXzEyOiBjcmVhdGVQb3NpdGlvbjFfMTIsCiAgICAgICAgY3JlYXRlUG9zaXRpb24xM18xNjogY3JlYXRlUG9zaXRpb24xM18xNiwKICAgICAgICBjcmVhdGVQb3NpdGlvbjE3XzE4OiBjcmVhdGVQb3NpdGlvbjE3XzE4LAogICAgICAgIGNyZWF0ZVBvc2l0aW9uMTlfMjE6IGNyZWF0ZVBvc2l0aW9uMTlfMjEsCiAgICAgICAgY3JlYXRlUG9zaXRpb24yMl8yMzogY3JlYXRlUG9zaXRpb24yMl8yMywKICAgICAgICBjcmVhdGVQb3NpdGlvbjI0XzI4OiBjcmVhdGVQb3NpdGlvbjI0XzI4LAogICAgICAgIGNyZWF0ZVBvc2l0aW9uMjlfMzA6IGNyZWF0ZVBvc2l0aW9uMjlfMzAsCiAgICAgICAgY3JlYXRlUG9zaXRpb24zMV8zNTogY3JlYXRlUG9zaXRpb24zMV8zNSwKICAgICAgICBjcmVhdGVQb3NpdGlvbjM2XzM3OiBjcmVhdGVQb3NpdGlvbjM2XzM3LAogICAgICAgIGNyZWF0ZVBvc2l0aW9uMzhfMzk6IGNyZWF0ZVBvc2l0aW9uMzhfMzksCiAgICAgICAgY3JlYXRlUG9zaXRpb240MF80MzogY3JlYXRlUG9zaXRpb240MF80MywKICAgICAgICBjcmVhdGVQb3NpdGlvbjQ0XzQ3OiBjcmVhdGVQb3NpdGlvbjQ0XzQ3LAogICAgICAgIGNyZWF0ZVBvc2l0aW9uNDhfNDk6IGNyZWF0ZVBvc2l0aW9uNDhfNDksCiAgICAgICAgY3JlYXRlUG9zaXRpb241MF81MTogY3JlYXRlUG9zaXRpb241MF81MSwKICAgICAgICBjcmVhdGVQb3NpdGlvbjUyXzU0OiBjcmVhdGVQb3NpdGlvbjUyXzU0LAogICAgICAgIGNyZWF0ZVBvc2l0aW9uNTVfNTY6IGNyZWF0ZVBvc2l0aW9uNTVfNTYsCiAgICAgICAgY3JlYXRlUG9zaXRpb241N182ODogY3JlYXRlUG9zaXRpb241N182OCwKICAgICAgICBjcmVhdGVQb3NpdGlvbjY5Xzc1OiBjcmVhdGVQb3NpdGlvbjY5Xzc1LAogICAgICAgIGNyZWF0ZVBvc2l0aW9uNzZfODk6IGNyZWF0ZVBvc2l0aW9uNzZfODkKCiAgICB9OwoKfSgpOwoK", "moduleName": "Dm2ToDst"}, {"javascript": "LyoqCiAqIEBmaWxlIEZpbGUgdGhhdCBjb250YWlucyBhIG1vZHVsZSB0byBoYW5kbGUgdmFyaW91cyBkYXRlCiAqIG9wZXJhdGlvbnMsIGNvbnZlcnNpb24gdG8gYW5kIGZyb20gZGlmZmVyZW50CiAqIGZvcm1hdHMvcmVwcmVzZW50YXRpb25zLCBhbmQgaGFuZGxlIGNvbW1vbiBvcGVyYXRpb25zIGluIHJlbGF0aW9uCiAqIHRvIHRpbWV6b25lcywgZXRjLiAqLwoKRVhQT1JURURfU1lNQk9MUyA9IFsgJ0RhdGVVdGlsJyBdOwoKdXNlKCAiRGF0ZVV0aWxDb3JlIiApOwp1c2UoICJMb2ciICk7CnVzZSggIlZhbHVlQ2hlY2siICk7CnVzZSggIlN0cmluZ1V0aWwiICk7CgovKioKICogSGFuZGxlIG9wZXJhdGlvbnMgcmVsYXRlZCB0byBkYXRlIGFuZCB0aW1lLgogKiAKICogTW9kdWxlIHRvIGhhbmRsZSB2YXJpb3VzIGRhdGUgb3BlcmF0aW9ucywgY29udmVyc2lvbiB0byBhbmQgZnJvbQogKiBkaWZmZXJlbnQgZm9ybWF0cy9yZXByZXNlbnRhdGlvbnMsIGFuZCBoYW5kbGUgY29tbW9uIG9wZXJhdGlvbnMgaW4KICogcmVsYXRpb24gdG8gdGltZXpvbmVzLCBldGMuIAogKgogKiBUaGVzZSBtZXRob2RzIGFyZSB2ZXJ5IHVzZWZ1bCB3aGVuIHdhbnRpbmcgZS5nLiB0byBjb252ZXJ0IGJldHdlZW4KICogdmFyaW91cyBub3RhdGlvbnMgZm9yIGRhdGVzLCBhbmQgb3RoZXIgcmVsYXRlZCBvcGVyYXRpb25zLgogKgogKiAqKk5vdGU6KiogSWYgeW91IHdyaXRlIGNvZGUgdGhhdCBzaG91bGQgc3VwcG9ydCBtb2NraW5nLCB5b3Ugc2hvdWxkCiAqIHVzZSB0aGUgbWV0aG9kcyBpbiB0aGlzIG1vZHVsZSB0byBnZXQgdGhlIGN1cnJlbnQgdGltZSwgbm90IHRoZQogKiBidWlsdGluIEphdmFTY3JpcHQgRGF0ZSBjbGFzcy4gQnkgZG9pbmcgdGhhdCwgeW91IGVuc3VyZSB0aGUKICogbW9ja2luZyBzeXN0ZW0gd2lsbCB3b3JrLgogKgogKiAqKk5vdGU6KiogV29ya2luZyB3aXRoIHRpbWUgaW4gY29tcHV0ZXJzeXN0ZW1zIGlzIG1vcmUgdHJpY2t5IHRoYW4KICogb25lIHNob3VsZCB0aGluay4gSWYgeW91IHdpc2ggdG8gdW5kZXJzdGFuZCB0aGUgbmVlZCBmb3Igc29tZSBvZgogKiB0aGUgbWV0aG9kcyBpbiBoZXJlLCBvciBxdWVzdGlvbiB0aGUgbmVlZCBmb3IgdGhlbSwgeW91IHNob3VsZAogKiBwZXJoYXBzIHJlYWQgdGhlIGZvbGxvd2luZyBwYWdlOgogKiA8aHR0cDovL2luZmluaXRldW5kby5jb20vcG9zdC8yNTUwOTM1NDAyMi9tb3JlLWZhbHNlaG9vZHMtcHJvZ3JhbW1lcnMtYmVsaWV2ZS1hYm91dC10aW1lLXdpc2RvbT4uCiAqCiAqICoqTm90ZToqKiBGb3IgaGlzdG9yaWNhbCByZWFzb25zLCB0d28gZGlmZmVyZW50IHN5c3RlbXMgZm9yIG5hbWluZwogKiB0aW1lcGFydHMgYXJlIHVzZWQgaW4gdGhpcyBmaWxlLiBJdCBzaG91bGQgYmUgY2xlYXIgZnJvbSB0aGUKICogZGVzY3JpcHRpb25zIGZvciBlYWNoIGZ1bmN0aW9uIHdoYXQgdGhlIGZ1bmN0aW9uIGRvZXMuIFNvbWUgdGltZQogKiBpbiB0aGUgZnV0dXJlIHdlIG1heSBnZXQgYXJvdW5kIHRvIGNsZWFuaW5nIHVwIHRoZSBuYW1pbmcgYW5kCiAqIHRpbWVzcGVjIGluZm9ybWF0aW9uLgogKgogKiBAbmFtZXNwYWNlIAogKiBAbmFtZSBEYXRlVXRpbCAgKi8KdmFyIERhdGVVdGlsID0gZnVuY3Rpb24oICkgewoKICAgIHZhciB0aGF0ID0ge307CgoKICAgIHRoYXQubW9jayA9IFsgJ25vdycgXTsKCiAgICB2YXIgcGFyc2VJU084NjAxX2Z1bmMgPSBfX0RhdGVVdGlsQ29yZV9wYXJzZUlTTzg2MDE7CiAgICB2YXIgZm9ybWF0SVNPODYwMV9mdW5jID0gX19EYXRlVXRpbENvcmVfZm9ybWF0SVNPODYwMTsKICAgIGRlbGV0ZSB0aGlzLl9fRGF0ZVV0aWxDb3JlX3BhcnNlSVNPODYwMTsKICAgIGRlbGV0ZSB0aGlzLl9fRGF0ZVV0aWxDb3JlX2Zvcm1hdElTTzg2MDE7CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBEYXRlLW9iamVjdCB3aXRoIGFuIGFyYml0cmFyeSB2YWx1ZS4KICAgICAqIAogICAgICogVGhpcyBpcyBzaW1wbHkgYSB3cmFwcGVyIGZvciBgbmV3IERhdGUoMClgLCB1c2VmdWwgd2hlcmUgYSBkYXRlCiAgICAgKiBpcyBuZWVkZWQsIGFuZCB5b3Ugd2FudCB0byBpbml0aWFsaXplIGl0IHRvIHRoZQogICAgICogZXBvY2guIEFmdGVyd2FyZHMsIHlvdSBjYW4gc2V0IHRoZSBpbmRpdmlkdWFsIGZpZWxkcyBvZiB0aGUKICAgICAqIGRhdGUuCiAgICAgKiBAZXhhbXBsZQovLyBUaGlzIGNyZWF0ZXMgYSBuZXcgZGF0ZSBjb3JyZXNwb25kaW5nIHRvIHRoZSBlcG9jaAp2YXIgbXlEYXRlID0gRGF0ZVV0aWwuY3JhZXRlKCk7CiAgICAgKiAKICAgICAqIEBzeW50YXggRGF0ZVV0aWwuY3JlYXRlKCkKICAgICAqIEByZXR1cm4ge0RhdGV9IEEgRGF0ZSBvYmplY3QgaW5pdGlsYWxpemVkIHdpdGggMCAoY29ycmVzcG9uZGluZyB0byBtaWRuaWdodCBKYW51YXJ5IDEsIDE5NzAsIGxvY2FsdGltZSkKICAgICAqIEBuYW1lIERhdGVVdGlsLmNyZWF0ZQogICAgICogQG1ldGhvZCAqLwogICAgdGhhdC5jcmVhdGUgPSBmdW5jdGlvbiggKSB7CiAgICAgICAgaWYgKCBhcmd1bWVudHMubGVuZ3RoID4gMCApIHsKICAgICAgICAgICAgdmFyIG1lc3NzYWdlID0gJ0RhdGVVdGlsLmNyZWF0ZSgpIGRvZXMgbm90IHRha2UgYXJndW1lbnRzJzsKICAgICAgICAgICAgdGhyb3cgewogICAgICAgICAgICAgICAgbmFtZTogJ1BhcmFtZXRlckVycm9yJywKICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2Vfc3RyCiAgICAgICAgICAgIH07CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gbmV3IERhdGUoIDAgKTsKICAgIH07CgoKICAgIC8vIGNyZWF0ZSBhIERhdGUgb2JqZWN0IGZyb20gdGltZSAobXMgc2luY2UgMTk3MCkKICAgIC8vIC4uLiBvciB1c2UgIm5vdyIgd2l0aCBubyBhcmd1bWVudHMKICAgIC8qKgogICAgICogQ3JlYXRlIGEgRGF0ZS1vYmplY3QgYmFzZWQgb24gbWlsbGlzZWNvbmQgb2Zmc2V0IHNpbmNlIGVwb2NoLgogICAgICogCiAgICAgKiBUaGlzIGlzIGEgd3JhcHBlciBmb3IgdGhlICJuZXcgRGF0ZSgpIi1jb25zdHJ1Y3Rpb24gdG8gc3VwcG9ydCBtb2NraW5nCiAgICAgKiBvZiBkYXRlcy4gVGhpcyBmdW5jdGlvbiBzaG91bGQgbm90IG5vcm1hbGx5IGJlIHVzZWQuIFVzZQogICAgICogRGF0ZVV0aWwuY3JlYXRlKCkgYW5kIHNldCB0aW1lIHdpdGggb25lIG9mIHRoZSBtZXRob2RzIGluIERhdGUuIAogICAgICogCiAgICAgKiBAc2VlIERhdGVVdGlsLmNyZWF0ZQogICAgICogQHR5cGUge2Z1bmN0aW9ufQogICAgICogQHN5bnRheCBEYXRlVXRpbC5yZUNyZWF0ZSggdGltZSApCiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3RpbWU9MF0gbXMgc2luY2UgZXBvY2ggKG1pZG5pZ2h0IEphbnVhcnkgMSwgMTk3MCwgbG9jYWx0aW1lKQogICAgICogQHJldHVybiB7RGF0ZX0gQSBEYXRlIG9iamVjdAogICAgICogQG5hbWUgRGF0ZVV0aWwucmVDcmVhdGUKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgdGhhdC5yZUNyZWF0ZSA9IGZ1bmN0aW9uKCBtcyApIHsKICAgICAgICBMb2cudHJhY2UoICItPkRhdGVVdGlsLnJlQ3JlYXRlKCkiICk7IC8vIEFVVE86OkJVRyM4OTc2CiAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSggKTsKICAgICAgICAvLyBmb3IgdXNlIHdpdGggbW9ja2luZwogICAgICAgIGlmICggdHlwZW9mKCBtcyApICE9ICd1bmRlZmluZWQnICkgewogICAgICAgICAgICBkYXRlLnNldFRpbWUoIG1zICk7CiAgICAgICAgfQogICAgICAgIGRhdGUudGhpc2lzYWRiY2RhdGUgPSB0cnVlOwogICAgICAgIHJldHVybiBkYXRlOwogICAgfTsKCiAgICAvLyBxdWljayBoYWNrOiB3cmFwIGEgIm5ldyBEYXRlKCkiIHRvIGNyZWF0ZSBhIGRhdGUgY29ycmVzcG9uZG5nIHRvICJub3ciCiAgICAvLyBpbXBsZW1lbnRlZCBpbiBjcmVhdGVJbnRlcm5hbCB0byBhdm9pZCBwcm9ibGVtcyB3aXRoIG1vY2tpbmcKICAgIC8qKgogICAgICogQ3JlYXRlIGEgRGF0ZS1vYmplY3QgdGhhdCByZXByZXNlbnRzICJub3ciLgogICAgICogCiAgICAgKiBUaGlzIGlzIGEgd3JhcHBlciBmb3IgdGhlICJuZXcgRGF0ZSgpIi1jb25zdHJ1Y3Rpb24gdG8gc3VwcG9ydCBtb2NraW5nCiAgICAgKiBvZiBkYXRlcy4gSW5zdGVhZCBvZiBgdmFyIG5vdyA9IG5ldyBEYXRlKCk7YCB1c2UgYHZhciBub3cgPQogICAgICogRGF0ZVV0aWwubm93KCk7YC4gCiAgICAgKiAKICAgICAqIEBleGFtcGxlCi8vIFRoZSAnY29ycmVjdCcgd2F5IHRvIGdldCBhIGRhdGUsIGlmIHlvdSB3YW50IHRvIHN1cHBvcnQgbW9ja2luZwp2YXIgbXlEYXRlID0gRGF0ZVV0aWwubm93KCk7CiAgICAgKgogICAgICogQHN5bnRheCBEYXRlVXRpbC5ub3coKQogICAgICogQHJldHVybiB7RGF0ZX0gQSBEYXRlIG9iamVjdAogICAgICogQG5hbWUgRGF0ZVV0aWwubm93CiAgICAgKiBAbWV0aG9kCiAgICAgKi8KICAgIHRoYXQubm93ID0gZnVuY3Rpb24oICkgewogICAgICAgIExvZy50cmFjZSggIi0+RGF0ZVV0aWwubm93KCkiICk7IC8vIEFVVE86OkJVRyM4OTc2CiAgICAgICAgaWYgKCBhcmd1bWVudHMubGVuZ3RoID4gMCApIHsKICAgICAgICAgICAgdmFyIG1lc3NzYWdlID0gJ0RhdGVVdGlsLm5vdygpIGRvZXMgbm90IHRha2UgYXJndW1lbnRzJzsKICAgICAgICAgICAgdGhyb3cgewogICAgICAgICAgICAgICAgbmFtZTogJ1BhcmFtZXRlckVycm9yJywKICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2Vfc3RyCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGF0LnJlQ3JlYXRlKCApOwogICAgfTsKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgcmV0dXJucyBhIG5ldyBkYXRlIHRoYXQgaXMgYSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIGxhdGVyIHRoYW4gdGhlIGRhdGUgZ2l2ZW4uCiAgICAgKgogICAgICogVGhpcyBmdW5jdGlvbiBpcyBtYWRlIGFzIGEgcHJlY2F1dGlvbiB3aGVuIGZpeGluZyB0aGUgc3BlbGxpbmcgbWlzdGFrZSBpbiB0aGUgb3JpZ2luYWwgZnVuY3Rpb24KICAgICAqICh3cm9uZzogbWlsaXNlY29uZHMsIHJpZ2h0OiBtaWxsaXNlY29uZHMpLiBUaGUgb3JpZ2luYWwgZnVuY3Rpb24gYWRkTWlsbGlzZWNvbmRzIHNob3VsZCBiZSB1c2VkLgogICAgICogTFNLIDIwMTYtMDMtMDcKICAgICAqCiAgICAgKi8KICAgIHRoYXQuYWRkTWlsaXNlY29uZHMgPSBmdW5jdGlvbiggZGF0ZSwgbnVtYmVyT2ZNaWxsaXNlY29uZHMgKSB7CiAgICAgICAgcmV0dXJuIERhdGVVdGlsLmFkZE1pbGxpc2Vjb25kcyggZGF0ZSwgbnVtYmVyT2ZNaWxsaXNlY29uZHMgKTsKICAgIH0KCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgcmV0dXJucyBhIG5ldyBkYXRlIHRoYXQgaXMgYSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIGxhdGVyIHRoYW4gdGhlIGRhdGUgZ2l2ZW4uCiAgICAgKiAKICAgICAqIFRoaXMgZnVuY3Rpb24gdGFrZXMgYSBkYXRlIGFuZCBhIG51bWJlciBvZiBtaWxsaXNlY29uZHMsIGFkZHMKICAgICAqIHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHRoZSBkYXRlLCBhbmQgcmV0dXJucyB0aGUgbmV3IGRhdGUuCiAgICAgKiAKICAgICAqICoqTm90ZToqKiBEYXRlIGFyaXRobWV0aWNzIGlzIGhhcmQuIEFsdGhvdWdoIGl0IGlzIHRlbXB0aW5nIHRvCiAgICAgKiBiZWxpZXZlIHRoYXQgaXQgY2FuIGJlIHJlZHVjZWQgdG8gc2ltcGxlIG9mZnNldCBtYW5pcHVsYXRpb24sCiAgICAgKiBhZGRpbmcgYSBmaXhlZCBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHdpbGwgb25seSBkbyB0aGF0LCBhbmQKICAgICAqIHdpbGwgbm90IHRha2UgaXNzdWVzIHN1Y2ggYXMgbGVhcC15ZWFycywgbGVhcC1zZWNvbmRzLAogICAgICogdGltZXpvbmVzIG9yIGNoYW5nZXMgZnJvbSBzdW1tZXIgdG8gbm9ybWFsIHRpbWUgaW50bwogICAgICogYWNjb3VudC4gWW91IGhhdmUgYmVlbiB3YXJuZWQuCiAgICAgKgogICAgICogQGV4YW1wbGUKLy8gQ3JlYXRlIGEgZGF0ZSAxMDAgbWlsbGlzZWNvbmRzIGluIHRoZSBmdXR1cmUKdmFyIG15RnV0dXJlRGF0ZSA9IERhdGVVdGlsLmFkZE1pbGxpc2Vjb25kcyggRGF0ZVV0aWwubm93KCksIDEwMCApOwogICAgICogCiAgICAgKiBAc3ludGF4IERhdGVVdGlsLmFkZE1pbGxpc2Vjb25kcyggZGF0ZSwgbnVtYmVyT2ZNaWxsaXNlY29uZHMgKQogICAgICogQHBhcmFtIHtEYXRlfSBkYXRlIFRoZSBkYXRlIHRvIGFkZCB0aGUgb2Zmc2V0IHRvLgogICAgICogQHBhcmFtIHtudW1iZXJ9IG51bWJlck9mTWlsbGlzZWNvbmRzIE51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gYWRkLgogICAgICogQHJldHVybiB7RGF0ZX0gVGhlIG5ldyBkYXRlLCBvZmZzZXQgZnJvbSB0aGUgaW5wdXQgZGF0ZSB3aXRoIHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHBhc3NlZC4KICAgICAqIEBuYW1lIERhdGVVdGlsLmFkZE1pbGxpc2Vjb25kcwogICAgICogQG1ldGhvZAogICAgICovCiAgICB0aGF0LmFkZE1pbGxpc2Vjb25kcyA9IGZ1bmN0aW9uKCBkYXRlLCBudW1iZXJPZk1pbGxpc2Vjb25kcyApIHsKICAgICAgICBMb2cudHJhY2UoICItPkRhdGVVdGlsLmFkZE1pbGxpc2Vjb25kcyIgKTsgLy8gQVVUTzo6QlVHIzg5NzYKICAgICAgICAvL1ZhbHVlQ2hlY2suY2hlY2soICJudW1iZXJPZk1pbGxpc2Vjb25kcyIsIG51bWJlck9mTWlsbGlzZWNvbmRzICkudHlwZSggIm51bWJlciIgKS5pc0dyZWF0ZXJFcXVhbFRoYW4oIDAgKTsKICAgICAgICB2YXIgZGF0ZV9tcyA9IGRhdGUuZ2V0VGltZSggKTsKICAgICAgICB2YXIgbmV3X2RhdGVfbXMgPSBkYXRlX21zICsgbnVtYmVyT2ZNaWxsaXNlY29uZHM7CiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCBuZXdfZGF0ZV9tcyApOwogICAgfTsKCgogICAgdmFyIG1zX21pbnV0ZSA9IDEwMDAgKiA2MDsKICAgIHZhciBtc19ob3VyID0gbXNfbWludXRlICogNjA7CiAgICB2YXIgbXNfZGF5ID0gbXNfaG91ciAqIDI0OwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCByZXR1cm5zIGEgbmV3IGRhdGUgdGhhdCBpcyBhIG51bWJlciBvZiBtaW51dGVzIGxhdGVyIHRoYW4gdGhlIGRhdGUgZ2l2ZW4uCiAgICAgKiAKICAgICAqIFRoaXMgZnVuY3Rpb24gdGFrZXMgYSBkYXRlIGFzIGEgcGFyYW1ldGVyLCBhZGRzIHRoZSBudW1iZXIgb2YgbWludXRlcwogICAgICogdG8gaXQsIGFuZCByZXR1cm5zIHRoZSBuZXcgZGF0ZS4gCiAgICAgKiAKICAgICAqIFRoaXMgZnVuY3Rpb24gaXMgaW1wbGVtZW50ZWQgYXMgYSBjYWxsIHRvIGFkZE1pbGxpc2Vjb25kcy4KICAgICAqIAogICAgICogKipOb3RlOioqIERhdGUgYXJpdGhtZXRpY3MgaXMgaGFyZC4gQWx0aG91Z2ggaXQgaXMgdGVtcHRpbmcgdG8KICAgICAqIGJlbGlldmUgdGhhdCBpdCBjYW4gYmUgcmVkdWNlZCB0byBzaW1wbGUgb2Zmc2V0IG1hbmlwdWxhdGlvbiwKICAgICAqIGFkZGluZyBhIGZpeGVkIG51bWJlciBvZiBtaW51dGVzIHdpbGwgb25seSBkbyB0aGF0LCBhbmQKICAgICAqIHdpbGwgbm90IHRha2UgaXNzdWVzIHN1Y2ggYXMgbGVhcC15ZWFycywgbGVhcC1zZWNvbmRzLAogICAgICogdGltZXpvbmVzIG9yIGNoYW5nZXMgZnJvbSBzdW1tZXIgdG8gbm9ybWFsIHRpbWUgaW50bwogICAgICogYWNjb3VudC4gWW91IGhhdmUgYmVlbiB3YXJuZWQuCiAgICAgKgogICAgICogQGV4YW1wbGUKLy8gQ3JlYXRlIGEgZGF0ZSAzMCBtaW51dGVzIGluIHRoZSBmdXR1cmUKdmFyIG15RnV0dXJlRGF0ZSA9IERhdGVVdGlsLmFkZE1pbnV0ZXMoIERhdGVVdGlsLm5vdygpLCAzMCApOwogICAgICogCiAgICAgKiBAc3ludGF4IERhdGVVdGlsLmFkZE1pbnV0ZXMoIGRhdGUsIG51bWJlck9mTWludXRlcyApCiAgICAgKiBAcGFyYW0ge0RhdGV9IGRhdGUgVGhlIGRhdGUgdG8gYWRkIHRoZSBvZmZzZXQgdG8uCiAgICAgKiBAcGFyYW0ge251bWJlcn0gbnVtYmVyT2ZNaW51dGVzIE51bWJlciBvZiBtaW51dGVzIHRvIGFkZC4KICAgICAqIEByZXR1cm4ge0RhdGV9IFRoZSBuZXcgZGF0ZSwgb2Zmc2V0IGZyb20gdGhlIGlucHV0IGRhdGUgd2l0aCB0aGUgbnVtYmVyIG9mIG1pbnV0ZXMgcGFzc2VkLgogICAgICogQG5hbWUgRGF0ZVV0aWwuYWRkTWludXRlcwogICAgICogQG1ldGhvZAogICAgICovCiAgICB0aGF0LmFkZE1pbnV0ZXMgPSBmdW5jdGlvbiggZGF0ZSwgbnVtYmVyT2ZNaW51dGVzICkgewogICAgICAgIExvZy50cmFjZSggIi0+RGF0ZVV0aWwuYWRkTWludXRlcyIgKTsgLy8gQVVUTzo6QlVHIzg5NzYKICAgICAgICByZXR1cm4gRGF0ZVV0aWwuYWRkTWlsbGlzZWNvbmRzKCBkYXRlLCBudW1iZXJPZk1pbnV0ZXMgKiBtc19taW51dGUgKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IHJldXJucyBhIG5ldyBkYXRlIHRoYXQgaXMgYSBudW1iZXIgb2Ygc2Vjb25kcyBsYXRlciB0aGFuIHRoZSBkYXRlIGdpdmVuLgogICAgICogCiAgICAgKiBUaGlzIGZ1bmN0aW9uIHRha2VzIGEgZGF0ZSBvYmplY3QsIGFuZCBhIG51bWJlciBvZiBzZWNvbmRzLiBUaGUgbnVtYmVyCiAgICAgKiBvZiBzZWNvbmRzIGlzIGFkZGVkIHRvIHRoZSBkYXRlIG9iamVjdCBhbmQgdGhlIGNvbnN0cnVjdGVkIGRhdGVvYmplY3QKICAgICAqIGlzIHJldHVybmVkLiAKICAgICAqIAogICAgICogVGhpcyBmdW5jdGlvbiBpcyBpbXBsZW1lbnRlZCBhcyBhIGNhbGwgdG8gYWRkTWlsbGlzZWNvbmRzLgogICAgICogCiAgICAgKiAqKk5vdGU6KiogRGF0ZSBhcml0aG1ldGljcyBpcyBoYXJkLiBBbHRob3VnaCBpdCBpcyB0ZW1wdGluZyB0bwogICAgICogYmVsaWV2ZSB0aGF0IGl0IGNhbiBiZSByZWR1Y2VkIHRvIHNpbXBsZSBvZmZzZXQgbWFuaXB1bGF0aW9uLAogICAgICogYWRkaW5nIGEgZml4ZWQgbnVtYmVyIG9mIHNlY29uZHMgd2lsbCBvbmx5IGRvIHRoYXQsIGFuZAogICAgICogd2lsbCBub3QgdGFrZSBpc3N1ZXMgc3VjaCBhcyBsZWFwLXllYXJzLCBsZWFwLXNlY29uZHMsCiAgICAgKiB0aW1lem9uZXMgb3IgY2hhbmdlcyBmcm9tIHN1bW1lciB0byBub3JtYWwgdGltZSBpbnRvCiAgICAgKiBhY2NvdW50LiBZb3UgaGF2ZSBiZWVuIHdhcm5lZC4KICAgICAqCiAgICAgKiBAZXhhbXBsZQovLyBDcmVhdGUgYSBkYXRlIDMwIHNlY29uZHMgaW4gdGhlIGZ1dHVyZQp2YXIgbXlGdXR1cmVEYXRlID0gRGF0ZVV0aWwuYWRkU2Vjb25kKCBEYXRlVXRpbC5ub3coKSwgMzAgKTsKICAgICAqCiAgICAgKiBAc3ludGF4IERhdGVVdGlsLmFkZFNlY29uZHMoIGRhdGUsIG51bWJlck9mU2Vjb25kcyApCiAgICAgKiBAcGFyYW0ge0RhdGV9IGRhdGUgVGhlIGRhdGUgdG8gYWRkIHRoZSBvZmZzZXQgdG8uCiAgICAgKiBAcGFyYW0ge251bWJlcn0gbnVtYmVyT2ZTZWNvbmRzIE51bWJlciBvZiBzZWNvbmRzIHRvIGFkZC4KICAgICAqIEByZXR1cm4ge0RhdGV9IFRoZSBuZXcgZGF0ZSwgb2Zmc2V0IGZyb20gdGhlIGlucHV0IGRhdGUgd2l0aCB0aGUgbnVtYmVyIG9mIHNlY29uZHMgcGFzc2VkLgogICAgICogQG5hbWUgRGF0ZVV0aWwuYWRkU2Vjb25kcwogICAgICogQG1ldGhvZAogICAgICovCiAgICB0aGF0LmFkZFNlY29uZHMgPSBmdW5jdGlvbiggZGF0ZSwgbnVtYmVyT2ZTZWNvbmRzICkgewogICAgICAgIExvZy50cmFjZSggIi0+RGF0ZVV0aWwuYWRkU2Vjb25kcyIgKTsgLy8gQVVUTzo6QlVHIzg5NzYKICAgICAgICByZXR1cm4gRGF0ZVV0aWwuYWRkTWlsbGlzZWNvbmRzKCBkYXRlLCBudW1iZXJPZlNlY29uZHMgKiAxMDAwICk7CiAgICB9OwoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCByZXR1cm5zIGEgbmV3IGRhdGUgdGhhdCBpcyBhIG51bWJlciBvZiBkYXlzIGxhdGVyIHRoYW4gdGhlIGRhdGUgZ2l2ZW4uCiAgICAgKiAKICAgICAqIEZ1bmN0aW9uIHRoYXQgdGFrZXMgYSBkYXRlIGFuZCBhIG51bWJlciBvZiBkYXlzLCBhZGRzIHRoZSBkYXlzIHRvIHRoZQogICAgICogZGF0ZSwgYW5kIHJldHVybnMgdGhlIG5ldyBjb25zdHJ1Y3RlZCBkYXRlLiAKICAgICAqCiAgICAgKiBUaGlzIGZ1bmN0aW9uIGlzIGltcGxlbWVudGVkIGFzIGEgY2FsbCB0byBhZGRNaWxsaXNlY29uZHMuCiAgICAgKiAKICAgICAqICoqTm90ZToqKiBEYXRlIGFyaXRobWV0aWNzIGlzIGhhcmQuIEFsdGhvdWdoIGl0IGlzIHRlbXB0aW5nIHRvCiAgICAgKiBiZWxpZXZlIHRoYXQgaXQgY2FuIGJlIHJlZHVjZWQgdG8gc2ltcGxlIG9mZnNldCBtYW5pcHVsYXRpb24sCiAgICAgKiBhZGRpbmcgYSBmaXhlZCBudW1iZXIgb2YgZGF5cyB3aWxsIG9ubHkgZG8gdGhhdCwgYW5kCiAgICAgKiB3aWxsIG5vdCB0YWtlIGlzc3VlcyBzdWNoIGFzIGxlYXAteWVhcnMsIGxlYXAtc2Vjb25kcywKICAgICAqIHRpbWV6b25lcyBvciBjaGFuZ2VzIGZyb20gc3VtbWVyIHRvIG5vcm1hbCB0aW1lIGludG8KICAgICAqIGFjY291bnQuIFlvdSBoYXZlIGJlZW4gd2FybmVkLgogICAgICoKICAgICAqIEBleGFtcGxlCiAgICAvLyBDcmVhdGUgYSBkYXRlIDMgZGF5cyBpbiB0aGUgZnV0dXJlCiAgICB2YXIgbXlGdXR1cmVEYXRlID0gRGF0ZVV0aWwuYWRkRGF5cyggRGF0ZVV0aWwubm93KCksIDMgKTsKICAgICAvLyBDcmVhdGUgYSBkYXRlIDQgZGF5cyBpbiB0aGUgcGFzdAogICAgIHZhciBteVBhc3REYXRlID0gRGF0ZVV0aWwuYWRkRGF5cyggRGF0ZVV0aWwubm93KCksIC00ICk7CiAgICAgKgogICAgICogQHN5bnRheCBEYXRlVXRpbC5hZGREYXlzKCBkYXRlLCBudW1iZXJPZk1pbnV0ZXMgKQogICAgICogQHBhcmFtIHtEYXRlfSBkYXRlIFRoZSBkYXRlIHRvIGFkZCB0aGUgb2Zmc2V0IHRvLgogICAgICogQHBhcmFtIHtudW1iZXJ9IG51bWJlck9mRGF5cyBOdW1iZXIgb2YgZGF5cyB0byBhZGQuCiAgICAgKiBAcmV0dXJuIHtEYXRlfSBUaGUgbmV3IGRhdGUsIG9mZnNldCBmcm9tIHRoZSBpbnB1dCBkYXRlIHdpdGggdGhlIG51bWJlciBvZiBzZWNvbmRzIHBhc3NlZC4KICAgICAqIEBuYW1lIERhdGVVdGlsLmFkZERheXMKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgdGhhdC5hZGREYXlzID0gZnVuY3Rpb24oIGRhdGUsIG51bWJlck9mRGF5cyApIHsKICAgICAgICBMb2cudHJhY2UoICItPkRhdGVVdGlsLmFkZERheXMiICk7IC8vIEFVVE86OkJVRyM4OTc2CiAgICAgICAgcmV0dXJuIERhdGVVdGlsLmFkZE1pbGxpc2Vjb25kcyggZGF0ZSwgbnVtYmVyT2ZEYXlzICogbXNfZGF5ICk7CiAgICB9OwoKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgYWRkcyBhIGdpdmVuIG51bWJlciBvZiBtaW51dGVzIHRvICJub3ciIChhY3R1YWwpLgogICAgICogCiAgICAgKiBUaGlzIGZ1bmN0aW9uIGNyZWF0ZXMgYSBuZXcgZGF0ZSBvYmplY3QsIHVzaW5nIHRoZSBEYXRlVXRpbC5ub3coKQogICAgICogZnVuY3Rpb24sIHRoZW4gYWRkcyB0aGUgZ2l2ZW4gbnVtYmVyIG9mIG1pbnV0ZXMgdG8gaXQsIGFuZCByZXR1cm4gdGhlCiAgICAgKiBjb25zdHJ1Y3RlZCBkYXRlIG9iamVjdC4gCiAgICAgKgogICAgICogVGhpcyBmdW5jdGlvbiBpcyBpbXBsZW1lbnRlZCBhcyBhIGNhbGwgdG8gdGhlIGJ1aWx0aW4KICAgICAqIERhdGUuc2V0TWludXRlcyBmdW5jdGlvbi4KICAgICAqIAogICAgICogKipOb3RlOioqIERhdGUgYXJpdGhtZXRpY3MgaXMgaGFyZC4gQWx0aG91Z2ggaXQgaXMgdGVtcHRpbmcgdG8KICAgICAqIGJlbGlldmUgdGhhdCBpdCBjYW4gYmUgcmVkdWNlZCB0byBzaW1wbGUgb2Zmc2V0IG1hbmlwdWxhdGlvbiwKICAgICAqIGFkZGluZyBhIGZpeGVkIG51bWJlciBvZiBtaW51dGVzIHdpbGwgb25seSBkbyB0aGF0LCBhbmQKICAgICAqIHdpbGwgbm90IHRha2UgaXNzdWVzIHN1Y2ggYXMgbGVhcC15ZWFycywgbGVhcC1zZWNvbmRzLAogICAgICogdGltZXpvbmVzIG9yIGNoYW5nZXMgZnJvbSBzdW1tZXIgdG8gbm9ybWFsIHRpbWUgaW50bwogICAgICogYWNjb3VudC4gWW91IGhhdmUgYmVlbiB3YXJuZWQuCiAgICAgKgovLyBDcmVhdGUgYSBkYXRlIDE1IG1pbnV0ZXMgaW4gdGhlIGZ1dHVyZQp2YXIgbXlGdXR1cmVEYXRlID0gRGF0ZVV0aWwuYWRkTWludXRlc1RvTm93KCAxNSApOwogICAgICoKICAgICAqIEBzeW50YXggRGF0ZVV0aWwuYWRkTWludXRlc1RvTm93KCBudW1iZXJPZk1pbnV0ZXMgKQogICAgICogQHBhcmFtIHtudW1iZXJ9IG51bWJlck9mTWludXRlcyBOdW1iZXIgb2YgbWludXRlcyB0byBhZGQgdG8gbm93LgogICAgICogQHJldHVybiB7RGF0ZX0gVGhlIG5ldyBkYXRlLCBvZmZzZXQgZnJvbSBub3cgd2l0aCB0aGUgbnVtYmVyIG9mIG1pbnV0ZXMgcGFzc2VkLgogICAgICogQG5hbWUgRGF0ZVV0aWwuYWRkTWludXRlc1RvTm93CiAgICAgKiBAbWV0aG9kCiAgICAgKi8KICAgIHRoYXQuYWRkTWludXRlc1RvTm93ID0gZnVuY3Rpb24oIG51bWJlck9mTWludXRlcyApIHsKICAgICAgICBMb2cudHJhY2UoICItPkRhdGVVdGlsLmFkZE1pbnV0ZXNUb05vdygpIiApOyAvLyBBVVRPOjpCVUcjODk3NgogICAgICAgIFZhbHVlQ2hlY2suY2hlY2soICJudW1iZXJPZk1pbnV0ZXMiLCBudW1iZXJPZk1pbnV0ZXMgKS50eXBlKCAibnVtYmVyIiApLmlzR3JlYXRlckVxdWFsVGhhbiggMCApOwogICAgICAgIHZhciBub3cgPSBEYXRlVXRpbC5ub3coICk7CiAgICAgICAgdmFyIG1pbiA9IG5vdy5nZXRNaW51dGVzKCApOwogICAgICAgIG1pbiArPSBudW1iZXJPZk1pbnV0ZXM7CiAgICAgICAgbm93LnNldE1pbnV0ZXMoIG1pbiApOwogICAgICAgIHJldHVybiBub3c7CiAgICB9OwoKCiAgICAvKioKICAgKiBGdW5jdGlvbiB0aGF0IGNvbnZlcnRzIGFuIHhtbCBkYXRlIHN0cmluZyBpbnRvIGEgSmF2YVNjcmlwdCBEYXRlIG9iamVjdC4KICAgKiAKICAgKiBUaGlzIGZ1bmN0aW9uIHRha2VzIGFuIFhNTCBkYXRldGltZSB2YWx1ZSBhbmQgY29udmVydHMgaW50byBhCiAgICogSmF2YVNjcmlwdCBEYXRlIG9iamVjdC4gVGhlIGlucHV0IG11c3QgYmUgYSByZXByZXNlbnRhdGlvbiBmcm9tCiAgICogdGhlIHZhbGlkIHN1YnNldCBvZiBJU084NjAxIHRoYXQgaXMgc3VwcG9ydGVkIGluIHRoZSBYTUwvWFNECiAgICogc3RhbmRhcmQgZm9yIGRhdGV0aW1lIG9iamVjdHMsIGRlc2NyaWJlZCBhdAogICAqIDxodHRwOi8vd3d3LnczLm9yZy9UUi94bWxzY2hlbWEtMi8jaXNvZm9ybWF0cz4KICAgKgogICAqIEludmFsaWQgZGF0ZXMsIHN1Y2ggYXMgMzAuIGZlYnJ1YXJ5IDIwMTMgd2lsbCByZXN1bHQgaW4gYW4KICAgKiBleGNlcHRpb24uCiAgICoKICAgKiAqKk5vdGU6KiogSWYgdGhlIGlucHV0IGRvZXMgbm90IGhhdmUgYSB0aW1lcGFydCwgYSB0aW1lcGFydCBvZgogICAqIDAwOjAwOjAwIGlzIHVzZWQuIEZyYWN0aW9uYWwgc2Vjb25kcyBhcmUgbm90IHN1cHBvcnRlZCwgYW5kIHdpbGwKICAgKiBiZSBtaXNzaW5nIGluIHRoZSByZXN1bHQuIFRoaXMgZnVuY3Rpb24gaGFuZGxlcyB0aW1lem9uZXMgYXMgcGVyCiAgICogdGhlIHNwZWNpZmljYXRpb24uCiAgICoKICAgKiBAZXhhbXBsZQovLyBUaGlzIHdpbGwgY3JlYXRlIGEgZGF0ZSBpbiB0aGUgbG9jYWwgdGltZXpvbmUgb24gMjYvMTAgMjAxMCwgYXQgMDA6MDA6MDAKRGF0ZVV0aWwueG1sVG9KcyggIjIwMTAtMTAtMjZUMDA6MDA6MDAiICk7Ci8vIFRoaXMgd2lsbCBjcmVhdGUgYSBkYXRlIGluIHRoZSB0aW1lem9uZSArMDQ6MTUsIGZvciAxNi80IDIwMTIsIGF0IDEzOjE3OjQ0LgovLyBUaGUgZnJhY3Rpb25hbCBzZWNvbmQgcGFydCB3aWxsIGJlIGRyb3BwZWQuCkRhdGVVdGlsLnhtbFRvSnMoICIyMDEyLTA0LTE2VDEzOjE3OjQ0LjQxOSswNDoxNSIgKQogICAqIAogICAqIEBzZWUgRGF0ZVV0aWwuanNUb1htbAogICAqIEBzeW50YXggRGF0ZVV0aWwueG1sVG9KcyggeG1sRGF0ZSApCiAgICogQHBhcmFtIHtzdHJpbmd9IHhtbERhdGUgU3RyaW5nIGZyb20geG1sIHJlcHJlc2VudGluZyBhIHNwZWNpZmljIGRhdGUvZGF0ZVRpbWUuCiAgICogQHJldHVybiB7RGF0ZX0gSmF2YVNjcmlwdCBEYXRlIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHRpbWVwb2ludAogICAqIEBuYW1lIERhdGVVdGlsLnhtbFRvSnMKICAgKiBAbWV0aG9kCiAgICovCiAgICB0aGF0LnhtbFRvSnMgPSBmdW5jdGlvbiggeG1sRGF0ZSApIHsKICAgICAgICBMb2cudHJhY2UoICItPkRhdGVVdGlsLnhtbFRvSnMoKSIgKTsgLy8gQVVUTzo6QlVHIzg5NzYKICAgICAgICBMb2cuZGVidWcoICJEYXRlVXRpbC54bWxUb0pzKCAnIiArIHhtbERhdGUgKyAiJyApOyIgKTsKICAgICAgICBpZiAoICF4bWxEYXRlIHx8ICIiID09PSB4bWxEYXRlICkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoICJEYXRlVXRpbC54bWxUb0pzOiBVbmFibGUgdG8gcGFyc2UgZW1wdHkgZGF0ZSIgKTsKICAgICAgICB9CiAgICAgICAgLy8gVGVzdCBmb3IgZGF0ZSB3aXRoIG5vIHRpbWVwYXJ0LCBhZGQgdGltZXBhcnQgaWYgbWlzc2luZy4KICAgICAgICBpZiAoIG51bGwgIT0geG1sRGF0ZS5tYXRjaCggL15cZHs0fS1cZHsyfS1cZHsyfSQvICkgKSB7Ly9CdWcgMTAzMTE6IENvbnZlcnRpbmcgZGF0ZSBzdHJpbmcgdG8gZGF0ZVRpbWUgc3RyaW5nCiAgICAgICAgICAgIHhtbERhdGUgPSB4bWxEYXRlICsgIlQwMDowMDowMCI7CiAgICAgICAgfQogICAgICAgIC8vIFJlbW92ZSBmcmFjdGlvbmFsIHNlY29uZHMsIGlmIHByZXNlbnQuCiAgICAgICAgaWYgKCBudWxsICE9IHhtbERhdGUubWF0Y2goIC9eXGR7NH0tXGR7Mn0tXGR7Mn1UXGR7Mn06XGR7Mn06XGR7Mn1cLi8gKSApIHsvL0J1ZyAxNDA1NTogUmVtb3ZpbmcgZnJhY3Rpb25hbCBzZWNvbmRzIGZyb20geG1sRGF0ZQogICAgICAgICAgICAvLyBOZWVkIHRoZSBuZXcgU3RyaW5nIHN0dWZmIHRvIHdvcmsgb24gbGFraWZpcmU/Pz8KICAgICAgICAgICAgeG1sRGF0ZSA9IG5ldyBTdHJpbmcoIHhtbERhdGUgKS5yZXBsYWNlKCAvXC5cZCovLCAiIiApOwogICAgICAgIH0KICAgICAgICBMb2cuZGVidWcoICJ4bWxEYXRlIG5vdzogJyIgKyB4bWxEYXRlICsgIiciICk7CiAgICAgICAgcmV0dXJuIHBhcnNlSVNPODYwMV9mdW5jKCB4bWxEYXRlICk7CiAgICB9OwoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IGNvbnZlcnRzIGEgSmF2YVNjcmlwdCBkYXRlIG9iamVjdCBpbnRvIGFuIFhNTCBkYXRldGltZSBzdHJpbmcuCiAgICAgKiAKICAgICAqIFRoaXMgZnVuY3Rpb24gdGFrZXMgYSBKYXZhU2NyaXB0IERhdGUgb2JqZWN0LCBhbmQgY29udmVydHMgaXQgaW50byBhbgogICAgICogWE1MIGRhdGV0aW1lIHN0cmluZywgd2hpY2ggaXMgYSBzdWJzZXQgb2YgSVNPODYwMSwgZGVmaW5lZCBhdCA8aHR0cDovL3d3dy53My5vcmcvVFIveG1sc2NoZW1hLTIvI2lzb2Zvcm1hdHM+CiAgICAgKgogICAgICogKipOb3RlOioqIFRoZSByZXN1bHRpbmcgc3RyaW5nIGlzIGluIFVUQywgdGhhdCBpcywgaGFzIGEgdGltZXpvbmUgcGFydCBlcXVhbCB0byAiWiIuIE9idmlvdXNseSBpdHMgdGhlIHNhbWUgdGltZXBvaW50LiBGcmFjdGlvbmVsIHNlY29uZHMgYXJlIG5vdCBzdXBwb3J0ZWQuCiAgICAgKiAKICAgICAqIEBleGFtcGxlCi8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGN1cnJlbnQgZGF0ZSBhbmQgdGltZSBpbiBYTUwgZm9ybWF0CnZhciB4bWxEYXRlVGltZSA9IERhdGVVdGlsLmpzVG9YbWwoIERhdGVVdGlsLm5vdygpICk7CiAgICAgKgogICAgICogQHNlZSBEYXRlVXRpbC54bWxUb0pzCiAgICAgKiBAc3ludGF4IERhdGVVdGlsLmpzVG9YbWwoIGpzRGF0ZSApCiAgICAgKiBAcGFyYW0ge0RhdGV9IGpzRGF0ZSBKYXZhU2NyaXB0IERhdGUgb2JqZWN0LgogICAgICogQHJldHVybiB7c3RyaW5nfSBYTUwgZGF0ZSB0aW1lIHN0cmluZyBpbiBVVEMsIHJlcHJlc2VudGluZyB0aGUgdGltZXBvaW50IHBhc3NlZCBpbiBqc0RhdGUuCiAgICAgKiBAbmFtZSBEYXRlVXRpbC5qc1RvWG1sCiAgICAgKiBAbWV0aG9kCiAgICAgKi8KICAgIHRoYXQuanNUb1htbCA9IGZ1bmN0aW9uKCBqc0RhdGUgKSB7CiAgICAgICAgTG9nLnRyYWNlKCAiLT5EYXRlVXRpbC5qc1RvWG1sKCkiICk7IC8vIEFVVE86OkJVRyM4OTc2CiAgICAgICAgVmFsdWVDaGVjay5jaGVjayggImpzRGF0ZSIsIGpzRGF0ZSApLmlzLmluc3RhbmNlT2YoIERhdGUgKTsKICAgICAgICByZXR1cm4gZm9ybWF0SVNPODYwMV9mdW5jKCBqc0RhdGUgKTsKICAgIH07CgogICAgLyoqCiAgICogRnVuY3Rpb24gdGhhdCBjb252ZXJ0cyBhbiBkYW5NQVJDMiBkYXRlIHN0cmluZyBpbnRvIGEgSmF2YVNjcmlwdCBEYXRlIG9iamVjdCAodmlhIElTMDg2MDEpLgogICAqIAogICAqIFRoaXMgZnVuY3Rpb24gdGFrZXMgYSBkYW5NQVJDMiBkYXRhL2RhdGV0aW1lIHZhbHVlIGFuZCBjb252ZXJ0cwogICAqIGludG8gYSBKYXZhU2NyaXB0IERhdGUgb2JqZWN0LiBUaGUgZm9ybWF0IG9mIHRoZSBpbnB1dCBtdXN0IGJlCiAgICogb25lIG9mIFlZWVlNTURELCBZWVlZTU1EREhITU0sIG9yIFlZWVlNTURESEhNTVNTLgogICAqCiAgICogQmVjYXVzZSBhIGNvbnZlcnNpb24gdG8gSVNPODYwMSBpcyBwZXJmb3JtZWQsIGFueSBpbnZhbGlkIGRhdGVzIHdpbGwgYmUgcmVqZWN0ZWQuCiAgICoKICAgKiAqKk5vdGU6KiogSWYgdGhlIGlucHV0IGRvZXMgbm90IGhhdmUgYSB0aW1lcGFydCwgYSB0aW1lcGFydCBvZiAwMDowMDowMCBpcyB1c2VkLgogICAqIAogICAqIEBleGFtcGxlCi8vIFRoaXMgd2lsbCBjcmVhdGUgYSBkYXRlIGluIHRoZSBsb2NhbCB0aW1lem9uZSBvbiAyNi8xMCAyMDEwLCBhdCAwMDowMDowMApEYXRlVXRpbC5kYW5NYXJjVG9KcyggIjIwMTAxMDI2IiApOwogICAqIEBzZWUgRGF0ZVV0aWwueG1sVG9KcwogICAqIEBzeW50YXggRGF0ZVV0aWwuZGFuTWFyY1RvSnMoIG1hcmNEYXRlICkKICAgKiBAcGFyYW0ge1N0cmluZ30gbWFyY0RhdGUgU3RyaW5nIGZyb20gZGFuTUFSQzIgcmVjb3JkIHJlcHJlc2VudGluZyBhIHNwZWNpZmljIGRhdGUvZGF0ZVRpbWUKICAgKiBAcmV0dXJuIHtEYXRlfSBKYXZhU2NyaXB0IERhdGUgb2JqZWN0IHdpdGggYSB2YWxpZCBkYXRlCiAgICogQG5hbWUgRGF0ZVV0aWwuZGFuTWFyY1RvSnMKICAgKiBAbWV0aG9kCiAgICovCiAgICB0aGF0LmRhbk1hcmNUb0pzID0gZnVuY3Rpb24oIG1hcmNEYXRlICkgewogICAgICAgIExvZy50cmFjZSggIi0+RGF0ZVV0aWwuZGFuTWFyY1RvSnMoKSIgKTsgLy8gQVVUTzo6QlVHIzg5NzYKICAgICAgICBMb2cuZGVidWcoICJEYXRlVXRpbC5kYW5NYXJjVG9KcyggJyIgKyBtYXJjRGF0ZSArICInICk7IiApOwogICAgICAgIGlmICggbWFyY0RhdGUgPT09ICIiICkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoICJEYXRlVXRpbC5kYW5NYXJjVG9KczogVW5hYmxlIHRvIHBhcnNlIGVtcHR5IGRhdGUiICk7CiAgICAgICAgfQoKICAgICAgICB2YXIganNEYXRlID0gIiI7CgogICAgICAgIGlmICggbWFyY0RhdGUubGVuZ3RoID09PSA4ICkgewogICAgICAgICAgICBqc0RhdGUgPSBtYXJjRGF0ZS5yZXBsYWNlKCAvKFxkezR9KShcZHsyfSkoXGR7Mn0pLywgIiQxLSQyLSQzIiApICsgIlQwMDowMDowMCI7CiAgICAgICAgfSBlbHNlIGlmICggbWFyY0RhdGUubGVuZ3RoID09PSAxMiApIHsKICAgICAgICAgICAganNEYXRlID0gbWFyY0RhdGUucmVwbGFjZSggLyhcZHs0fSkoXGR7Mn0pKFxkezJ9KShcZHsyfSkoXGR7Mn0pLywgIiQxLSQyLSQzVCQ0OiQ1OjAwIiApOwogICAgICAgIH0gZWxzZSBpZiAoIG1hcmNEYXRlLmxlbmd0aCA9PT0gMTQgKSB7CiAgICAgICAgICAgIGpzRGF0ZSA9IG1hcmNEYXRlLnJlcGxhY2UoIC8oXGR7NH0pKFxkezJ9KShcZHsyfSkoXGR7Mn0pKFxkezJ9KShcZHsyfSkvLCAiJDEtJDItJDNUJDQ6JDU6JDYiICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCAiRGF0ZVV0aWwuZGFuTWFyY1RvSnM6IFVuYWJsZSB0byBwYXJzZSBkYXRlOiAiICsgbWFyY0RhdGUgKTsKICAgICAgICB9CiAgICAgICAgTG9nLmRlYnVnKCAiSmF2YXNjcmlwdCBkYXRlZGF0ZSBub3c6ICciICsganNEYXRlICsgIiciICk7CiAgICAgICAgcmV0dXJuIHBhcnNlSVNPODYwMV9mdW5jKCBqc0RhdGUgKTsKCiAgICB9OwoKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgY29udmVydHMgZGF0ZSBzdHJpbmcgaW4gdGhlIGZvcm1hdCBZWVlZTU1ERCBpbnRvIGEgSmF2YVNjcmlwdCBEYXRlIG9iamVjdC4KICAgICAqIAogICAgICogVGhpcyBmdW5jdGlvbiB0YWtlcyBhbiBpbnB1dCBvbiB0aGUgZm9ybWF0IFlZWVlNTUREIGFuZCBjb252ZXJ0CiAgICAgKiBpdCBpbnRvIGEgSmF2YVNjcmlwdCBEYXRlIG9iamVjdC4gSXQgaXMgaW1wbGVtZW50ZWQgYXMgYSBjYWxsCiAgICAgKiB0byBEYXRlVXRpbC5kYW5NYXJjVG9KcywgYnV0IHRoZSBmb3JtYXQgbGVuZ2h0IGlzIGNoZWNrZWQgcHJpb3IKICAgICAqIHRvIGNhbGxpbmcgdGhpcyBmdW5jdGlvbiwgc28gaXQgaXMgc2xpZ2h0bHkgc3RyaWN0ZXIuCiAgICAgKgogICAgICogKipOb3RlOioqIEEgdGltZXBhcnQgb2YgMDA6MDA6MDAgaXMgYWx3YXlzIHVzZWQuCiAgICAgKiAKICAgKiBAZXhhbXBsZQovLyBUaGlzIHdpbGwgY3JlYXRlIGEgZGF0ZSBpbiB0aGUgbG9jYWwgdGltZXpvbmUgb24gMjYvMTAgMjAxMCwgYXQgMDA6MDA6MDAKRGF0ZVV0aWwuZGFuTWFyY1RvSnMoICIyMDEwMTAyNiIgKTsKICAgICAqIEBzZWUgRGF0ZVV0aWwuZGFuTWFyY1RvSnMKICAgICAqIEBzeW50YXggRGF0ZVV0aWwuWVlZWW1tZGRUb0pzKCB5eXl5bW1tbWRkU3RyaW5nICkKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBZWVlZbW1kZFN0cmluZyBEYXRlIG9uIHRoZSBmb3JtIFlZWVlNTURECiAgICAgKiBAcmV0dXJuIHtEYXRlfSBKYXZhU2NyaXB0IERhdGUgb2JqZWN0IHdpdGggYSB2YWxpZCBkYXRlCiAgICAgKiBAbmFtZSBEYXRlVXRpbC5ZWVlZbW1kZFRvSnMKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgdGhhdC5ZWVlZbW1kZFRvSnMgPSBmdW5jdGlvbiggWVlZWW1tZGRTdHJpbmcgKSB7CiAgICAgICAgTG9nLnRyYWNlKCAiLT5EYXRlVXRpbC5ZWVlZbW1kZFRvSnMoIiArIFlZWVltbWRkU3RyaW5nICsgIikiICk7IC8vIEFVVE86OkJVRyM4OTc2CiAgICAgICAgdmFyIGV4cGVjdGVkTGVuZ3RoID0gODsKICAgICAgICB2YXIgYWN0dWFsTGVuZ3RoID0gWVlZWW1tZGRTdHJpbmcubGVuZ3RoOwogICAgICAgIC8vIHdlIGFyZSBjaGVja2luZyB0aGUgbGVuZ3RoIGJlY2F1c2Ugb3VyIGltcGxlbWVudGF0aW9uIHVzZXMgYSBwYXJzZXIgc3VwcG9ydGluZyBvdGhlciBzdHJpbmcgZm9ybWF0cyB0aGF0IGRpZmZlcnMgaW4gbGVuZ3RoCiAgICAgICAgaWYgKCBhY3R1YWxMZW5ndGggIT09IGV4cGVjdGVkTGVuZ3RoICkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoICJEYXRlVXRpbC5ZWVlZbW1kZFRvSnM6IFVuYWJsZSB0byBwYXJzZTogZXhwZWN0ZWQgc3RyaW5nIHdpdGggbGVuZ3RoICIgKyBleHBlY3RlZExlbmd0aCArICIgYnV0IGhhcyBsZW5ndGggIiArIGFjdHVhbExlbmd0aCApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhhdC5kYW5NYXJjVG9KcyggWVlZWW1tZGRTdHJpbmcgKTsKICAgIH07CgoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0aGF0IGNvbnZlcnRzIGFuIGpzb24gZGF0ZSBzdHJpbmcgaW50byBhIEphdmFTY3JpcHQgRGF0ZSBvYmplY3QuCiAgICAgKiAKICAgICAqIFBsZWFzZSBub3RlIHRoYXQgdGhlIGpzb24gZm9ybWF0IGZvciBkYXRlcyBpcyBzb21ld2hhdAogICAgICogdW5zcGVjaWZpZWQuICBUaGlzIGZ1bmN0aW9uIHVuZGVyc3RhbmRzIHRoZSBmb3JtYXQgYmVsaWV2ZWQgdG8KICAgICAqIGJlIHVzZWQgaW4gU3BpZGVyTW9ua2V5L0ZpcmVmb3ggSlNPTiBpbXBsZW1lbnRhdGlvbnMsIGJ1dAogICAgICogdGhyb3dzIGF3YXkgYW55IG1pbGxpc2Vjb25kcy9mcmFjdGlvbmFsIHNlY29uZCBpbmZvcm1hdGlvbi4gVGhlCiAgICAgKiBmb3JtYXQgaXMgYXNzdW1lZCB0byBiZSBzb21ldGhpbmcgc2ltaWxhciB0byB0aGUgWE1MIHN1YnNldCBvZgogICAgICogSVNPODYwMSwgYnV0IGFsd2F5cyB1c2luZyBVVEMsIHRoYXQgaXMsIFogZm9yIHRoZSB0aW1lem9uZQogICAgICogaW5mb3JtYXRpb24uCiAgICAgKgogICAgICogSW52YWxpZCBkYXRlcyB3aWxsIGNhdXNlIGFuIGV4Y2VwdGlvbiB0byBiZSB0aHJvd24uCiAgICAgKiAKICAgICAqIEBleGFtcGxlCi8vIFRoaXMgd2lsbCBjcmVhdGUgYSBEYXRlIG9iamVjdCBmb3IgMjYvMTAgMjAxMCwgYXQgMDA6MDA6MDAsIHRpbWV6b25lIFVUQwpEYXRlVXRpbC5qc29uVG9KcyggIjIwMTAtMTAtMjZUMDA6MDA6MDAuMDAwWiIgKTsKICAgICAqIEBzeW50YXggRGF0ZVV0aWwuanNvblRvSnMoIGpzb25EYXRlICkKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBqc29uRGF0ZSBTdHJpbmcgZnJvbSBqc29uIHJlcHJlc2VudGluZyBhIHNwZWNpZmljIGRhdGUvZGF0ZVRpbWUKICAgICAqIEByZXR1cm4ge0RhdGV9IEphdmFTY3JpcHQgRGF0ZSBvYmplY3QKICAgICAqIEBuYW1lIERhdGVVdGlsLmpzb25Ub0pzCiAgICAgKiBAbWV0aG9kCiAgICAgKi8KICAgIHRoYXQuanNvblRvSnMgPSBmdW5jdGlvbigganNvbkRhdGUgKSB7CiAgICAgICAgTG9nLnRyYWNlKCAiLT5EYXRlVXRpbC5qc29uVG9KcygpIiApOyAvLyBBVVRPOjpCVUcjODk3NgogICAgICAgIExvZy5kZWJ1ZyggIkRhdGVVdGlsLmpzb25Ub0pzKCAnIiArIGpzb25EYXRlICsgIicgKTsiICk7CiAgICAgICAgaWYgKCAhanNvbkRhdGUgfHwgIiIgPT09IGpzb25EYXRlICkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoICJEYXRlVXRpbC5qc29uVG9KczogVW5hYmxlIHRvIHBhcnNlIGVtcHR5IGRhdGUiICk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwYXJzZUlTTzg2MDFfZnVuYygganNvbkRhdGUucmVwbGFjZSggL1wuXGR7M31aJC8sICJaIiApICk7CiAgICB9OwoKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8qKgogICAgICogRm9ybWF0cyBhIGRhdGUgdG8gYSBUZXh0RGF0ZSBzdHJpbmcgaW4gbG9jYWwgdGltZSAoIEREL01NLVlZWVkgKS4uCiAgICAgKiAKICAgICAqIFJldHVybnMgYSBzdHJpbmcgZm9ybWF0dGVkIGZvciB1c2UgYXMgYSBUZXh0RGF0ZS4gVGhlIHJlc3VsdGluZyBzdHJpbmcKICAgICAqIGlzIGluIHRoZSBsb2NhbCB0aW1lIG9mIHRoZSBqc0RhdGUgcGFzc2VkLgogICAgICoKICAgICAqIEBleGFtcGxlCi8vIFRoaXMgd2lsbCByZXR1cm4gYSBERC9NTS1ZWVlZIGZvcm1hdHRlZCBzdHJpbmcgb2YgdGhlIGN1cnJlbnQgZGF0ZSBhbmQgdGltZQp2YXIgbXlUZXh0RGF0ZUxvY2FsID0gRGF0ZVV0aWwuanNUb1RleHREYXRlTG9jYWwoIERhdGVVdGlsLm5vdygpICk7CiAgICAgKiAKICAgICAqIEBwYXJhbSB7RGF0ZX0ganNEYXRlIFRoZSBkYXRlIHRvIGZvcm1hdAogICAgICogQHJldHVybiB7c3RyaW5nfSBTdHJpbmcgZm9ybWF0dGVkIGFzIEREL01NLVlZWVkKICAgICAqIEBuYW1lIERhdGVVdGlsLmpzVG9UZXh0RGF0ZUxvY2FsCiAgICAgKiBAbWV0aG9kCiAgICAgKi8KICAgIHRoYXQuanNUb1RleHREYXRlTG9jYWwgPSBmdW5jdGlvbigganNEYXRlICkgewogICAgICAgIHJldHVybiBTdHJpbmdVdGlsLnNwcmludGYoICIlMDJkLyUwMmQtJTA0ZCIsIGpzRGF0ZS5nZXREYXRlKCApLCBqc0RhdGUuZ2V0TW9udGgoICkgKyAxLCBqc0RhdGUuZ2V0RnVsbFllYXIoICkgKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBGb3JtYXRzIGEgZGF0ZSB0byBhbiBJbGwwIGRhdGUgc3RyaW5nIGluIGxvY2FsIHRpbWUgKCBZWVlZTU1ERCApLi4KICAgICAqIAogICAgICogUmV0dXJucyBhIHN0cmluZyBmb3JtYXR0ZWQgZm9yIHVzZSBhcyBhbiBJbGwwIGRhdGUuIFRoZSByZXN1bHRpbmcKICAgICAqIHN0cmluZyBpcyBpbiB0aGUgbG9jYWwgdGltZSBvZiB0aGUganNEYXRlIHBhc3NlZC4KICAgICAqIAogICAgICogQGV4YW1wbGUKLy8gVGhpcyB3aWxsIHJldHVybiBhIElsbDAgZGF0ZSBmb3JtYXR0ZWQgc3RyaW5nIG9mIHRoZSBjdXJyZW50IGRhdGUKdmFyIG15SWxsMERhdGUgPSBEYXRlVXRpbC5qc1RvSWxsMERhdGVMb2NhbCggRGF0ZVV0aWwubm93KCkgKTsKICAgICAqCiAgICAgKiBAc2VlIERhdGVVdGlsLmpzVG9JbGwwVGltZUxvY2FsCiAgICAgKiBAc2VlIERhdGVVdGlsLmpzVG9ZWVlZbW1kZEhITU1TUwogICAgICogQHBhcmFtIHtEYXRlfSBqc0RhdGUgVGhlIGRhdGUgdG8gZm9ybWF0CiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IFN0cmluZyBmb3JtYXR0ZWQgYXMgWVlZWU1NREQKICAgICAqIEBuYW1lIERhdGVVdGlsLmpzVG9JbGwwRGF0ZUxvY2FsCiAgICAgKiBAbWV0aG9kCiAgICAgKi8KICAgIHRoYXQuanNUb0lsbDBEYXRlTG9jYWwgPSBmdW5jdGlvbigganNEYXRlICkgewogICAgICAgIHJldHVybiBTdHJpbmdVdGlsLnNwcmludGYoICIlMDRkJTAyZCUwMmQiLCBqc0RhdGUuZ2V0RnVsbFllYXIoICksIGpzRGF0ZS5nZXRNb250aCggKSArIDEsIGpzRGF0ZS5nZXREYXRlKCApICk7CiAgICB9OwoKICAgIC8qKgogICAgICogRm9ybWF0cyBhIGRhdGUgdG8gYW4gWG1sIGRhdGUgc3RyaW5nIGluIGxvY2FsIHRpbWUgKCBZWVlZLU1NLUREICkuLgogICAgICogCiAgICAgKiBSZXR1cm5zIGEgc3RyaW5nIGZvcm1hdHRlZCBmb3IgdXNlIGFzIGFuIFhtbCBkYXRlLiBUaGUgcmVzdWx0aW5nIHN0cmluZwogICAgICogaXMgaW4gdGhlIGxvY2FsIHRpbWUgb2YgdGhlIGpzRGF0ZSBwYXNzZWQuCiAgICAgKgogICAgICogKipOb3RlOioqIFRoaXMgZnVuY3Rpb24gb25seSBmb3JtYXRzIHRoZSBkYXRlIHBhcnQgb2YgYSBzdGFuZGFyZAogICAgICogWE1MIGRhdGV0aW1lIHN0cmluZywgYW5kIGFzIHN1Y2ggaWdub3JlcyBhbnkgdGltZSBwYXJ0LgogICAgICogCiAgICAgKiBAZXhhbXBsZQovLyBUaGlzIHdpbGwgcmV0dXJuIHRoZSBjdXJyZW50IGRhdGUgb25seSBpbiBYTUwgZm9ybWF0CnZhciB4bWxEYXRlVGltZSA9IERhdGVVdGlsLmpzVG9YbWxEYXRlTG9jYWwoIERhdGVVdGlsLm5vdygpICk7CiAgICAgKgogICAgICogQHNlZSBEYXRlVXRpbC5qc1RvWG1sCiAgICAgKiBAc2VlIERhdGVVdGlsLmpzVG9YbWxUaW1lTG9jYWwKICAgICAqIEBwYXJhbSB7RGF0ZX0ganNEYXRlIFRoZSBkYXRlIHRvIGZvcm1hdC4KICAgICAqIEByZXR1cm4ge3N0cmluZ30gU3RyaW5nIGZvcm1hdHRlZCBhcyBZWVlZLU1NLURELgogICAgICogQG5hbWUgRGF0ZVV0aWwuanNUb1htbERhdGVMb2NhbAogICAgICogQG1ldGhvZAogICAgICovCiAgICB0aGF0LmpzVG9YbWxEYXRlTG9jYWwgPSBmdW5jdGlvbigganNEYXRlICkgewogICAgICAgIHJldHVybiBTdHJpbmdVdGlsLnNwcmludGYoICIlMDRkLSUwMmQtJTAyZCIsIGpzRGF0ZS5nZXRGdWxsWWVhciggKSwganNEYXRlLmdldE1vbnRoKCApICsgMSwganNEYXRlLmdldERhdGUoICkgKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBGb3JtYXRzIGEgZGF0ZSB0byB1c2UgYW4gSWxsMCB0aW1lIHN0cmluZyBpbiBsb2NhbCB0aW1lICggSEhNTVNTICkuLgogICAgICogCiAgICAgKiBSZXR1cm5zIGEgc3RyaW5nIGZvcm1hdHRlZCBmb3IgdXNlIGFzIGFuIElsbDAgdGltZS4gT25seSB0aGUgdGltZQogICAgICogcG9ydGlvbiBvZiB0aGUgcGFzc2VkIGRhdGUgaXMgdXNlZC4gVGhlIHJlc3VsdGluZyBzdHJpbmcgaXMgaW4gdGhlCiAgICAgKiBsb2NhbCB0aW1lIG9mIHRoZSBqc0RhdGUgcGFzc2VkIAogICAgICogCiAgICAgKiBAZXhhbXBsZQovLyBUaGlzIHdpbGwgcmV0dXJuIGEgSWxsMCBkYXRlIGZvcm1hdHRlZCBzdHJpbmcgb2YgdGhlIGN1cnJlbnQgdGltZQp2YXIgbXlJbGwwRGF0ZSA9IERhdGVVdGlsLmpzVG9JbGwwVGltZUxvY2FsKCBEYXRlVXRpbC5ub3coKSApOwogICAgICoKICAgICAqIEBzZWUgRGF0ZVV0aWwuanNUb0lsbDBEYXRlTG9jYWwKICAgICAqIEBzZWUgRGF0ZVV0aWwuanNUb1lZWVltbWRkSEhNTVNTCiAgICAgKiBAcGFyYW0ge0RhdGV9IGpzRGF0ZSBUaGUgZGF0ZSB0byBmb3JtYXQuCiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IFN0cmluZyBmb3JtYXR0ZWQgYXMgSEhNTVNTLgogICAgICogQG5hbWUgRGF0ZVV0aWwuanNUb0lsbDBUaW1lTG9jYWwKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgdGhhdC5qc1RvSWxsMFRpbWVMb2NhbCA9IGZ1bmN0aW9uKCBqc0RhdGUgKSB7CiAgICAgICAgcmV0dXJuIFN0cmluZ1V0aWwuc3ByaW50ZiggIiUwMmQlMDJkJTAyZCIsIGpzRGF0ZS5nZXRIb3VycyggKSwganNEYXRlLmdldE1pbnV0ZXMoICksIGpzRGF0ZS5nZXRTZWNvbmRzKCApICk7CiAgICB9OwoKICAgIC8qKgogICAgICogRm9ybWF0cyBhIGRhdGUgdG8gdXNlIGFuIFhtbCB0aW1lIHN0cmluZyBpbiBsb2NhbCB0aW1lICggSEg6TU06U1MgKS4uCiAgICAgKiAKICAgICAqIFJldHVybnMgYSBzdHJpbmcgZm9ybWF0dGVkIGZvciB1c2UgYXMgYW4gWG1sIHRpbWUuIE9ubHkgdGhlIHRpbWUKICAgICAqIHBvcnRpb24gb2YgdGhlIHBhc3NlZCBkYXRlIGlzIHVzZWQuIFRoZSByZXN1bHRpbmcgc3RyaW5nIGlzIGluIHRoZQogICAgICogbG9jYWwgdGltZSBvZiB0aGUganNEYXRlIHBhc3NlZCAKICAgICAqCiAgICAgKiAqKk5vdGU6KiogVGhpcyBmdW5jdGlvbiBvbmx5IGZvcm1hdHMgdGhlIHRpbWUgcGFydCBvZiBhIHN0YW5kYXJkCiAgICAgKiBYTUwgZGF0ZXRpbWUgc3RyaW5nLCBhbmQgYXMgc3VjaCBpZ25vcmVzIGFueSBkYXRlIHBhcnQuCiAgICAgKiAKICAgICAqIEBleGFtcGxlCi8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGN1cnJlbnQgdGltZSBvbmx5IGluIFhNTCBmb3JtYXQKdmFyIHhtbERhdGVUaW1lID0gRGF0ZVV0aWwuanNUb1htbFRpbWVMb2NhbCggRGF0ZVV0aWwubm93KCkgKTsKICAgICAqCiAgICAgKiBAc2VlIERhdGVVdGlsLmpzVG9YbWwKICAgICAqIEBzZWUgRGF0ZVV0aWwuanNUb1htbERhdGVMb2NhbAogICAgICogQHBhcmFtIHtEYXRlfSBqc0RhdGUgVGhlIGRhdGUgdG8gZm9ybWF0CiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IFN0cmluZyBmb3JtYXR0ZWQgYXMgSEg6TU06U1MKICAgICAqIEBuYW1lIERhdGVVdGlsLmpzVG9YbWxUaW1lTG9jYWwKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgdGhhdC5qc1RvWG1sVGltZUxvY2FsID0gZnVuY3Rpb24oIGpzRGF0ZSApIHsKICAgICAgICByZXR1cm4gU3RyaW5nVXRpbC5zcHJpbnRmKCAiJTAyZDolMDJkOiUwMmQiLCBqc0RhdGUuZ2V0SG91cnMoICksIGpzRGF0ZS5nZXRNaW51dGVzKCApLCBqc0RhdGUuZ2V0U2Vjb25kcyggKSApOwogICAgfTsKCiAgICAvLyBOb3RlIHRvIGZ1dHVyZSBpbXBsZW1lbnRlcnM6CiAgICAvLyBmb3JtYXQgZm9yIHRoZSBmdW5jdGlvbiBuYW1lIGlzIGJhc2VkIG9uIHRoZSBzaGVsbCBkYXRlIGZvcm1hdCAtIHR5cGUgJ21hbiBkYXRlJyBpbiBzaGVsbCBmb3IgZG9jdW1lbnRhdGlvbiAgICAgICAgICAgCiAgICAvKioKICAgICAqIEZvcm1hdHMgYSBkYXRlIHRvIHVzZSBhbiBJbGwwIGRhdGUgYW5kIHRpbWUgc3RyaW5nIGluIGxvY2FsIHRpbWUuCiAgICAgKiAKICAgICAqIFJldHVybnMgYSBzdHJpbmcgZm9ybWF0dGVkIGZvciB1c2UgYXMgYW4gSWxsMCBkYXRlIGFuZCB0aW1lCiAgICAgKiAoWVlZWW1tZGRISE1NU1MpLiBCb3RoIHRoZSBkYXRlIGFuZCB0aW1lIHBvcnRpb24gb2YgdGhlIHBhc3NlZAogICAgICogZGF0ZSBpcyB1c2VkLiBUaGUgcmVzdWx0aW5nIHN0cmluZyBpcyBpbiB0aGUgbG9jYWwgZGF0ZSBhbmQKICAgICAqIHRpbWUgb2YgdGhlIGpzRGF0ZSBwYXNzZWQuCiAgICAgKiAKICAgICAqIEBleGFtcGxlCi8vIFRoaXMgd2lsbCByZXR1cm4gYSBJbGwwIGRhdGUgZm9ybWF0dGVkIHN0cmluZyBvZiB0aGUgY3VycmVudCBkYXRlIGFuZCB0aW1lCnZhciBteUlsbDBEYXRlID0gRGF0ZVV0aWwuanNUb1lZWVltbWRkSEhNTVNTKCBEYXRlVXRpbC5ub3coKSApOwogICAgICoKICAgICAqIEBzZWUgRGF0ZVV0aWwuanNUb0lsbDBEYXRlTG9jYWwKICAgICAqIEBzZWUgRGF0ZVV0aWwuanNUb0lsbDBUaW1lTG9jYWwKICAgICAqIEBwYXJhbSB7RGF0ZX0ganNEYXRlIFRoZSBkYXRlIHRvIGZvcm1hdAogICAgICogQHJldHVybiB7c3RyaW5nfSBTdHJpbmcgZm9ybWF0dGVkIGFzIFlZWVltbWRkSEhNTVNTCiAgICAgKiBAbmFtZSBEYXRlVXRpbC5qc1RvWVlZWW1tZGRISE1NU1MKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgdGhhdC5qc1RvWVlZWW1tZGRISE1NU1MgPSBmdW5jdGlvbigganNEYXRlICkgewogICAgICAgIHJldHVybiBTdHJpbmdVdGlsLnNwcmludGYoICIlMDRkJTAyZCUwMmQlMDJkJTAyZCUwMmQiLCBqc0RhdGUuZ2V0RnVsbFllYXIoICksIGpzRGF0ZS5nZXRNb250aCggKSArIDEsIGpzRGF0ZS5nZXREYXRlKCApLCBqc0RhdGUuZ2V0SG91cnMoICksIGpzRGF0ZS5nZXRNaW51dGVzKCApLCBqc0RhdGUuZ2V0U2Vjb25kcyggKSApOwogICAgfTsKCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRoYXQgY2xlYW5zIGEgMTQgZGlnaXQgZGF0ZSBzdHJpbmcgKFlZWVltbWRkSEhNTVNTKSB3aXRoIGludmFsaWQgdGltZSBpbiBISE1NU1MuIEludmFsaWQgaG91cnMsIG1pbnV0ZXMsIG9yIHNlY29uZHMgd2lsbCBiZSByZXNldCB0byAwMC4KICAgICAqCiAgICAgKiBAZXhhbXBsZQogICAgIC8vIFRoZSBzdHJpbmcgIjE5NDcxMjI0NjY3Nzg4IiB3aWxsIGJlIHJldHVybmVkIGFzICIxOTQ3MTIyNDAwMDAwMCIuCiAgICAgKiBAc3ludGF4IERhdGVVdGlsLmNsZWFuVGltZUluU3RyaW5nRGF0ZSggWVlZWW1tZGRISE1NU1MgKQogICAgICogQHBhcmFtIHtTdHJpbmd9IFlZWVltbWRkSEhNTVNTIFN0cmluZyByZXByZXNlbnRpbmcgYSBzcGVjaWZpYyBkYXRlVGltZQogICAgICogQHJldHVybiB7U3RyaW5nfSBBIHBvc3NpYmx5IGNsZWFuZXIgZGF0ZSBvciB0aGUgdW5tb2RpZmllZCBkYXRlCiAgICAgKiBAbmFtZSBEYXRlVXRpbC5jbGVhblRpbWVJblN0cmluZ0RhdGUKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgdGhhdC5jbGVhblRpbWVJblN0cmluZ0RhdGUgPSBmdW5jdGlvbiggWVlZWW1tZGRISE1NU1MgKSB7CgogICAgICAgIExvZy5kZWJ1ZyggIkRhdGVVdGlsLmNsZWFuVGltZUluU3RyaW5nRGF0ZSggJyIgKyBZWVlZbW1kZEhITU1TUyArICInICk7IiApOwoKICAgICAgICB2YXIgY2hhbmdlZCA9IGZhbHNlOwogICAgICAgIHZhciBsb2dNZXNzYWdlID0gInJldHVybmluZyB1bmNoYW5nZWQgZGF0ZTogIjsKICAgICAgICBpZiAoIFlZWVltbWRkSEhNTVNTLmxlbmd0aCA9PT0gMTQgKXsKICAgICAgICAgICAgaWYgKCBZWVlZbW1kZEhITU1TUy5zbGljZSggOCwgMTAgKSA+IDIzICl7CiAgICAgICAgICAgICAgICBZWVlZbW1kZEhITU1TUyA9IFlZWVltbWRkSEhNTVNTLnJlcGxhY2UoIC8oXGR7OH0pXGR7Mn0oXGR7NH0pLywgIiQxMDAkMiIgKTsKICAgICAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggWVlZWW1tZGRISE1NU1Muc2xpY2UoIDEwLCAxMiApID4gNTkgKXsKICAgICAgICAgICAgICAgIFlZWVltbWRkSEhNTVNTID0gWVlZWW1tZGRISE1NU1MucmVwbGFjZSggLyhcZHsxMH0pXGR7Mn0oXGR7Mn0pLywgIiQxMDAkMiIgKTsKICAgICAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggWVlZWW1tZGRISE1NU1Muc2xpY2UoIDEyLCAxNCApID4gNTkgKXsKICAgICAgICAgICAgICAgIFlZWVltbWRkSEhNTVNTID0gWVlZWW1tZGRISE1NU1MucmVwbGFjZSggLyhcZHsxMn0pXGR7Mn0vLCAiJDEwMCIgKTsKICAgICAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggY2hhbmdlZCA9PT0gdHJ1ZSApewogICAgICAgICAgICAgICAgbG9nTWVzc2FnZSA9ICJyZXR1cm5pbmcgY2xlYW5lZCBkYXRlOiAiOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIExvZy5kZWJ1ZyggbG9nTWVzc2FnZSwgWVlZWW1tZGRISE1NU1MgKTsKICAgICAgICByZXR1cm4gWVlZWW1tZGRISE1NU1M7CiAgICB9OwoKCiAgICAvKioKICAgICAqIE1ldGhvZCB0aGF0IGNoZWNrcyBpZiBhIHllYXIgaXMgYSBsZWFwIHllYXIuCiAgICAgKgogICAgICogQHR5cGUge21ldGhvZH0KICAgICAqIEBzeW50YXggRGF0ZVV0aWwuY2hlY2tMZWFwWWVhciggeWVhciApCiAgICAgKiBAcGFyYW0ge1N0cmluZ30geWVhciBUaGUgeWVhciB0byBjaGVjawogICAgICogQHJldHVybiB7Qm9vbGVhbn0gVHJ1ZSBpZiB0aGUgeWVhciBpcyBhIGxlYXAgeWVhciwgb3RoZXJ3aXNlIGZhbHNlCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBEYXRlVXRpbC5pc0xlYXBZZWFyCiAgICAgKiBAZXhhbXBsZSBEYXRlVXRpbC5pc0xlYXBZZWFyKCAxOTc2ICk7CiAgICAgKi8KICAgIHRoYXQuaXNMZWFwWWVhciA9IGZ1bmN0aW9uICggeWVhciApIHsKCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmc6IERhbk1hcmMyUHJlcGFyYXRpb24uY2hlY2tMZWFwWWVhciBmdW5jdGlvbiIgKTsKCiAgICAgICAgdmFyIGlzTGVhcFllYXIgPSAoICggeWVhciAlIDQgPT0gMCApICYmICggeWVhciAlIDEwMCAhPSAwICkgKSB8fCAoIHllYXIgJSA0MDAgPT0gMCApOwoKICAgICAgICBMb2cuZGVidWcoICJZZWFyICIsIHllYXIsICIgaXMgbGVhcCB5ZWFyOiAiLCBpc0xlYXBZZWFyICk7CgogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmc6IERhbk1hcmMyUHJlcGFyYXRpb24uY2hlY2tMZWFwWWVhciBmdW5jdGlvbiIgKTsKCiAgICAgICAgcmV0dXJuIGlzTGVhcFllYXI7CgogICAgfTsKCgogICAgLyoqCiAgICAgKiBNZXRob2QgdGhhdCBjb3JyZWN0cyBhIGdpdmVuIGRhdGUgaWYgbmVjZXNzYXJ5LCBlbHNlIHRoZSBtZXRob2QgcmV0dXJucyB0aGUgaW5wdXQgZGF0ZS4KICAgICAqIElmIHRoZSBnaXZlbiBkYXRlIGNhbm5vdCBiZSBjb3JyZWN0ZWQgdGhlIGVtcHR5IHN0cmluZyBpcyByZXR1cm5lZAogICAgICoKICAgICAqQHR5cGUgbWV0aG9kCiAgICAgKkBzeW50YXggRGF0ZVV0aWwuY29ycmVjdERhdGUKICAgICAqQHBhcmFte1N0cmluZ30gZGF0ZSBjb250YWluaW5nIDggZGlnaXRzCiAgICAgKkByZXR1cm57U3RyaW5nfSBkYXRlLCBlbXB0eSBzdHJpbmcgaWYgaXQgd2Fzbid0IHBvc3NpYmxlIHRvIGNvcnJlY3QKICAgICAqQG1ldGhvZAogICAgICpAbmFtZSBEYXRlVXRpbC5jb3JyZWN0RGF0ZQogICAgICpAZXhhbXBsZSBEYXRlVXRpbC5jb3JyZWN0RGF0ZSggJzE5MDcwMjI5JyApCiAgICAgKicxOTA3MDMwMScKICAgICAqCiAgICAgKi8KICAgIHRoYXQuY29ycmVjdERhdGUgPSBmdW5jdGlvbiggZGF0ZSApIHsKICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZyBEYXRlVXRpbC5jb3JyZWN0RGF0ZSBmdW5jdGlvbiIgKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoICEvXlxkezh9JC8udGVzdCggZGF0ZSApICkgewogICAgICAgICAgICAgICAgTG9nLmRlYnVnKCJObyB2YWxpZCBkYXRlIGNvdWxkIGJlIGNyZWF0ZWQgZnJvbTogIisgZGF0ZSApOwogICAgICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciB5ZWFyID0gZGF0ZS5zbGljZSggMCwgNCApOwogICAgICAgICAgICB2YXIgbW9udGggPSBkYXRlLnNsaWNlKCA0LCA2ICk7CiAgICAgICAgICAgIHZhciBkYXkgPSBkYXRlLnNsaWNlKCA2LCA4ICk7CgoKICAgICAgICAgICAgaWYgKCBwYXJzZUludCggbW9udGggKSA+IDEyIHx8IG1vbnRoID09PSAiMDAiKSB7CiAgICAgICAgICAgICAgICBtb250aCA9ICIwMSIKICAgICAgICAgICAgfQogICAgICAgICAgICAvL2NoZWNraW5nIGRheXMgb2YgbW9udGhzIHdpdGggMzEgZGF5cwogICAgICAgICAgICBpZiAoIG1vbnRoID09PSAiMDEiIHx8IG1vbnRoID09PSAiMDMiIHx8IG1vbnRoID09PSAiMDUiIHx8IG1vbnRoID09PSAiMDciIHx8IG1vbnRoID09PSAiMDgiIHx8IG1vbnRoID09PSAiMTAiIHx8IG1vbnRoID09PSAiMTIiICkgewogICAgICAgICAgICAgICAgaWYgKCBwYXJzZUludCggZGF5ICkgPiAzMSB8fCBkYXkgPT09ICIwMCIgKSB7CiAgICAgICAgICAgICAgICAgICAgZGF5ID0gIjAxIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9jaGVja2luZyBmZWJydWFyeQogICAgICAgICAgICB9IGVsc2UgaWYgKCBtb250aCA9PT0gIjAyIiApIHsKICAgICAgICAgICAgICAgIGlmICggcGFyc2VJbnQoIGRheSApID4gMjggKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCAiMjkiID09PSBkYXkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggRGF0ZVV0aWwuaXNMZWFwWWVhciggeWVhciApICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cuZGVidWcoICJDb3JyZWN0aW5nICIrIGRhdGUgKyIgdG8iICsgeWVhciArICIwMzAxIGFzIGdpdmVuIHllYXIgaXMgbm8gbGVhcCB5ZWFyIiApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHllYXIgKyAiMDMwMSI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBkYXkgPSAiMDEiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vY2hlY2tpbmcgbW9udGhzIHdpdGggMzAgZGF5cwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKCBwYXJzZUludCggZGF5ICkgPiAzMCB8fCBkYXkgPT09ICIwMCIgKSB7CiAgICAgICAgICAgICAgICAgICAgZGF5ID0gIjAxIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGNvcnJlY3RlZERhdGUgPSB5ZWFyICsgbW9udGggKyBkYXk7CiAgICAgICAgICAgIGlmICggZGF0ZSAhPT0gY29ycmVjdGVkRGF0ZSApewogICAgICAgICAgICAgICAgTG9nLmRlYnVnKCAiQ29ycmVjdGVkICIrIGRhdGUgKyAiIHRvICIrIGNvcnJlY3RlZERhdGUgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gY29ycmVjdGVkRGF0ZQoKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nIERhdGVVdGlsLmNvcnJlY3REYXRlIGZ1bmN0aW9uIiApOwogICAgICAgIH0KCiAgICB9OwoKICAgIC8qKgogICAgICogTWV0aG9kIHRoYXQgYWRkcyB0aGUgY2VudHVyeSAoMTkgb3IgMjApIHRvIGEgZGF0ZSBzdHJpbmcgaWYgbWlzc2luZy4KICAgICAqCiAgICAgKiBAdHlwZSB7bWV0aG9kfQogICAgICogQHN5bnRheCBNYXJjUmVjb3JkLmFkZE1pc3NpbmdDZW50dXJ5VG82RGlnaXREYXRlKCBkYXRlU3RyaW5nICkKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBkYXRlU3RyaW5nIGEgc3RyaW5nIHdpdGggNiBkaWdpdHMgcmVwcmVzZW50aW5nIGEgZGF0ZQogICAgICogQHJldHVybiB7T2JqZWN0fSBUaGUgdXBkYXRlZCBkYXRlIG9yIGFuIGVtcHR5IHN0cmluZyBpZiB0aGUgZGF0ZSBjb3VsZCBub3QgYmUgdmFsaWRhdGVkCiAgICAgKiBAbWV0aG9kCiAgICAgKiBAbmFtZSBEYXRlVXRpbC5hZGRNaXNzaW5nQ2VudHVyeVRvNkRpZ2l0RGF0ZQogICAgICovCiAgICB0aGF0LmFkZE1pc3NpbmdDZW50dXJ5VG82RGlnaXREYXRlID0gZnVuY3Rpb24gKCBkYXRlU3RyaW5nICkgewoKICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZzogRGF0ZVV0aWwuYWRkTWlzc2luZ0NlbnR1cnlUbzZEaWdpdERhdGUgZnVuY3Rpb24iICk7CgogICAgICAgIHZhciBuZXdEYXRlID0gIiI7CiAgICAgICAgaWYgKCBkYXRlU3RyaW5nLm1hdGNoKCAvXlxkezZ9JC8gKSApIHsKICAgICAgICAgICAgaWYgKCBkYXRlU3RyaW5nLm1hdGNoKCAvXlswLTFdWzAtOV17NX0vICkgKSB7CiAgICAgICAgICAgICAgICBuZXdEYXRlID0gZGF0ZVN0cmluZy5yZXBsYWNlKCAvXihbMC0xXVswLTldezV9KS8sICIyMCQxIiApOwogICAgICAgICAgICB9IGVsc2UgaWYgKCBkYXRlU3RyaW5nLm1hdGNoKCAvXlsyLTldWzAtOV17NX0vICkgKSB7CiAgICAgICAgICAgICAgICBuZXdEYXRlID0gZGF0ZVN0cmluZy5yZXBsYWNlKCAvXihbMi05XVswLTldezV9KS8sICIxOSQxIiApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIExvZy5kZWJ1ZyggIk5ldyBkYXRlIGlzOiAiLCBuZXdEYXRlLCAiLiIgKTsKICAgICAgICAgICAgbmV3RGF0ZSA9IERhdGVVdGlsLmNvcnJlY3REYXRlKCBuZXdEYXRlICk7CiAgICAgICAgICAgIGlmICggIiIgPT09IG5ld0RhdGUgKXsKICAgICAgICAgICAgICAgIExvZy53YXJuKCAiVGhlIGNvcnJlY3RlZCBkYXRlIGNvdWxkIG5vdCBiZSB2YWxpZGF0ZWQuIiApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIExvZy5kZWJ1ZyggIkNvcnJlY3RlZCBkYXRlIGlzOiAiLCBuZXdEYXRlLCAiLiIgKTsKCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgTG9nLndhcm4oICJUaGUgZGF0ZSB3YXMgbm90IDYgZGlnaXRzLiIgKTsKICAgICAgICB9CgogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmc6IERhdGVVdGlsLmFkZE1pc3NpbmdDZW50dXJ5VG82RGlnaXREYXRlIGZ1bmN0aW9uIiApOwoKICAgICAgICByZXR1cm4gbmV3RGF0ZTsKCiAgICB9OwoKICAgIC8qKgogICAgICogTWV0aG9kIHRoYXQgcmV0dXJucyB0aGUgSVNPIDg2MDEgd2VlayBudW1iZXIgb2YgdGhlIGRhdGUKICAgICAqIENvZGUgZnJvbSBjb21tZW50IHJlcGx5IGluIAogICAgICogaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNjExNzgxNC9nZXQtd2Vlay1vZi15ZWFyLWluLWphdmFzY3JpcHQtbGlrZS1pbi1waHAKICAgICAqIEB0eXBlIHttZXRob2R9CiAgICAgKiBAc3ludGF4IERhdGVVdGlsLmdldFdlZWsoIHllYXIsIG1vbnRoLCBkYXkgKQogICAgICogQHBhcmFtIHtOdW1iZXJ8RGF0ZX0geWVhciBhIHllYXIgYXMgZm91ciBkaWdpdHMKICAgICAqIEBwYXJhbSB7TnVtYmVyfERhdGV9IG1vbnRoIGEgbW9udGggYXMgZGlnaXRzIGZyb20gMS0xMgogICAgICogQHBhcmFtIHtOdW1iZXJ8RGF0ZX0gZGF5IHRoZSBkYXkgb2YgdGhlIG1vbnRoIGFzIGRpZ2l0cyBmcm9tIDEtMzEKICAgICAqIEByZXR1cm4ge051bWJlcn0gdGhlIG51bWJlciBvZiB0aGUgd2VlayBmb3IgdGhlIGdpdmVuIGRhdGUKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIERhdGVVdGlsLmdldFdlZWsKICAgICAqIEBleGFtcGxlCiAgICAgKiAgICAgICBEYXRlVXRpbC5nZXRXZWVrKDIwMTYsIDA2LCAxMSkgLy8yMwogICAgICAgICAgICAgRGF0ZVV0aWwuZ2V0V2VlaygyMDE1LCA5LCAyNikgLy8zOQogICAgICAgICAgICAgRGF0ZVV0aWwuZ2V0V2VlaygyMDE2LCAxLCAxKSAvLzUzCiAgICAgICAgICAgICBEYXRlVXRpbC5nZXRXZWVrKDIwMTYsIDEsIDQpIC8vMQogICAgICAgICAgICAgRGF0ZVV0aWwuZ2V0V2VlayhuZXcgRGF0ZSgyMDE2LCAwLCA0KSkgLy8xCiAgICAgICAgICAgICBEYXRlVXRpbC5nZXRXZWVrKCIxMSBqYW51YXJ5IDIwMTYiKSAvLzIKICAgICAqLwogICAgdGhhdC5nZXRXZWVrID0gZnVuY3Rpb24oIHllYXIsIG1vbnRoLCBkYXkgKSB7CgogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nOiBEYXRlVXRpbC5nZXRXZWVrIGZ1bmN0aW9uIiApOwoKICAgICAgICBmdW5jdGlvbiBzZXJpYWwoIGRheXMgKSB7CiAgICAgICAgICAgIHJldHVybiA4NjQwMDAwMCAqIGRheXM7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkYXRlc2VyaWFsKCB5ZWFyLCBtb250aCwgZGF5ICkgewogICAgICAgICAgICByZXR1cm4gKG5ldyBEYXRlKCB5ZWFyLCBtb250aCAtIDEsIGRheSApLnZhbHVlT2YoKSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB3ZWVrZGF5KCBkYXRlICkgewogICAgICAgICAgICByZXR1cm4gKG5ldyBEYXRlKCBkYXRlICkpLmdldERheSgpICsgMTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHllYXJzZXJpYWwoIGRhdGUgKSB7CiAgICAgICAgICAgIHJldHVybiAobmV3IERhdGUoIGRhdGUgKSkuZ2V0RnVsbFllYXIoKTsKICAgICAgICB9CgogICAgICAgIHZhciBkYXRlID0geWVhciBpbnN0YW5jZW9mIERhdGUgPyB5ZWFyLnZhbHVlT2YoKSA6IHR5cGVvZiB5ZWFyID09PSAic3RyaW5nIiA/IG5ldyBEYXRlKCB5ZWFyICkudmFsdWVPZigpIDogZGF0ZXNlcmlhbCggeWVhciwgbW9udGgsIGRheSApLAogICAgICAgICAgICBkYXRlMiA9IGRhdGVzZXJpYWwoIHllYXJzZXJpYWwoIGRhdGUgLSBzZXJpYWwoIHdlZWtkYXkoIGRhdGUgLSBzZXJpYWwoIDEgKSApICkgKyBzZXJpYWwoIDQgKSApLCAxLCAzICk7CgogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmc6IERhdGVVdGlsLmdldFdlZWsgZnVuY3Rpb24iICk7CiAgICAgICAgcmV0dXJuIH5+KChkYXRlIC0gZGF0ZTIgKyBzZXJpYWwoIHdlZWtkYXkoIGRhdGUyICkgKyA1ICkpIC8gc2VyaWFsKCA3ICkpOwoKICAgIH07CgoKICAgIHJldHVybiB0aGF0Owp9KCApOyAvLyBOb3RlIHRoZSAoKQoK", "moduleName": "DateUtil"}, {"javascript": "RVhQT1JURURfU1lNQk9MUyA9IFsgJ19fRGF0ZVV0aWxDb3JlX3BhcnNlSVNPODYwMScsICdfX0RhdGVVdGlsQ29yZV9mb3JtYXRJU084NjAxJyBdOwoKdXNlKCAiU3RyaW5nVXRpbCIgKTsKdXNlKCAiTG9nIiApOwoKLyogQGJyaWVmIENyZWF0ZSBhIEphdmFTY3JpcHQgRGF0ZSBvYmplY3QgZnJvbSBhbiBJU084NjAxIHN0cmluZwogKiBAcGFyYW0gcyBUaGUgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBkYXRldGltZQogKiBAcmV0dXJucyBBIEphdmFTY3JpcHQgRGF0ZSBvYmplY3QKICoKICogVGhlIHN0cmluZyBmb3JtYXQgbXVzdCBiZSBZWVlZLU1NLUREVGhoOm1tOnNzKFopIG9yIGVtcHR5LgogKiBOb3Qgb24gYWJvdmUgZm9ybWF0LCB3aWxsIHRocm93LgogKgogKiBSZWdhcmRsZXNzIG9mIHRoZSBuYW1lLCBvbmx5IGEgbGltaXRlZCBzdWJzZXQgb2YgSVMwODYwMSBpcwogKiBhY3R1YWxseSBwYXJzZWQhICovCnZhciBfX0RhdGVVdGlsQ29yZV9wYXJzZUlTTzg2MDEgPSBmdW5jdGlvbiggaXNvODYwMSApIHsKICAgIExvZy5kZWJ1ZyggIkVudGVyaW5nIF9fRGF0ZVV0aWxDb3JlX3BhcnNlSVNPODYwMSAiICsgaXNvODYwMSApOwogICAgdmFyIG1hdGNoZWQgPSBfX0RhdGVVdGlsQ29yZV9wYXJzZUlTTzg2MDEucmVnVVRDLmV4ZWMoIGlzbzg2MDEgKTsKCiAgICBpZiAoIG1hdGNoZWQgKSB7CiAgICAgICAgdmFyIHJlcyA9IG5ldyBEYXRlKCAxOTcwLCAxLCAxLCAxMiwgMCwgMCwgMCApOwogICAgICAgIGlmICggbWF0Y2hlZC5sZW5ndGggPiA3ICYmIG1hdGNoZWRbIDcgXSA9PSAiWiIgKSB7CiAgICAgICAgICAgIExvZy5kZWJ1ZyggIk1hdGNoZWQgYXMgc3RyaW5nIHdpdGggWlVMVSB0aW1lem9uZSBpbmZvcm1hdGlvbiIgKTsKICAgICAgICAgICAgcmVzLnNldFVUQ0Z1bGxZZWFyKCBwYXJzZUludCggbWF0Y2hlZFsgMSBdLCAxMCApLCBwYXJzZUludCggbWF0Y2hlZFsgMiBdLCAxMCApIC0gMSwgcGFyc2VJbnQoIG1hdGNoZWRbIDMgXSwgMTAgKSApOwogICAgICAgICAgICByZXMuc2V0VVRDSG91cnMoIHBhcnNlSW50KCBtYXRjaGVkWyA0IF0sIDEwICksIHBhcnNlSW50KCBtYXRjaGVkWyA1IF0sIDEwICksIHBhcnNlSW50KCBtYXRjaGVkWyA2IF0sIDEwICksIDAgKTsKICAgICAgICAgICAgLy8gQ2hlY2sgbm8gImlsbGVnYWwiIHZhbHVlcwogICAgICAgICAgICBpZiAoIHJlcy5nZXRVVENGdWxsWWVhciggKSAhPSBwYXJzZUludCggbWF0Y2hlZFsgMSBdLCAxMCApIHx8CiAgICAgICAgICAgICAgICByZXMuZ2V0VVRDTW9udGgoICkgIT0gcGFyc2VJbnQoIG1hdGNoZWRbIDIgXSwgMTAgKSAtIDEgfHwKICAgICAgICAgICAgICAgIHJlcy5nZXRVVENEYXRlKCApICE9IHBhcnNlSW50KCBtYXRjaGVkWyAzIF0sIDEwICkgfHwKICAgICAgICAgICAgICAgIHJlcy5nZXRVVENIb3VycyggKSAhPSBwYXJzZUludCggbWF0Y2hlZFsgNCBdLCAxMCApIHx8CiAgICAgICAgICAgICAgICByZXMuZ2V0VVRDTWludXRlcyggKSAhPSBwYXJzZUludCggbWF0Y2hlZFsgNSBdLCAxMCApIHx8CiAgICAgICAgICAgICAgICByZXMuZ2V0VVRDU2Vjb25kcyggKSAhPSBwYXJzZUludCggbWF0Y2hlZFsgNiBdLCAxMCApICkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCBTdHJpbmdVdGlsLnNwcmludGYoICJVbmFibGUgdG8gdW5kZXJzdGFuZCBkYXRlIHNwZWNpZmllZCBhczogJyVzJyAoSW52YWxpZCBkYXRlIGFmdGVyIFpVTFUgLSByZWdleHAgbWF0Y2g/KS4iLAogICAgICAgICAgICAgICAgICAgICAgICBpc284NjAxICkgKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIExvZy5kZWJ1ZyggIk1hdGNoZWQgYXMgc3RyaW5nIHdpdGggbm8gdGltZXpvbmUgaW5mb3JtYXRpb24iICk7CiAgICAgICAgICAgIHJlcy5zZXRGdWxsWWVhciggcGFyc2VJbnQoIG1hdGNoZWRbIDEgXSwgMTAgKSwgcGFyc2VJbnQoIG1hdGNoZWRbIDIgXSwgMTAgKSAtIDEsIHBhcnNlSW50KCBtYXRjaGVkWyAzIF0sIDEwICkgKTsKICAgICAgICAgICAgcmVzLnNldEhvdXJzKCBwYXJzZUludCggbWF0Y2hlZFsgNCBdLCAxMCApLCBwYXJzZUludCggbWF0Y2hlZFsgNSBdLCAxMCApLCBwYXJzZUludCggbWF0Y2hlZFsgNiBdLCAxMCApLCAwICk7CiAgICAgICAgICAgIC8vIENoZWNrIG5vICJpbGxlZ2FsIiB2YWx1ZXMKICAgICAgICAgICAgaWYgKCByZXMuZ2V0RnVsbFllYXIoICkgIT0gcGFyc2VJbnQoIG1hdGNoZWRbIDEgXSwgMTAgKSB8fAogICAgICAgICAgICAgICAgcmVzLmdldE1vbnRoKCApICE9IHBhcnNlSW50KCBtYXRjaGVkWyAyIF0sIDEwICkgLSAxIHx8CiAgICAgICAgICAgICAgICByZXMuZ2V0RGF0ZSggKSAhPSBwYXJzZUludCggbWF0Y2hlZFsgMyBdLCAxMCApIHx8CiAgICAgICAgICAgICAgICByZXMuZ2V0SG91cnMoICkgIT0gcGFyc2VJbnQoIG1hdGNoZWRbIDQgXSwgMTAgKSB8fAogICAgICAgICAgICAgICAgcmVzLmdldE1pbnV0ZXMoICkgIT0gcGFyc2VJbnQoIG1hdGNoZWRbIDUgXSwgMTAgKSB8fAogICAgICAgICAgICAgICAgcmVzLmdldFNlY29uZHMoICkgIT0gcGFyc2VJbnQoIG1hdGNoZWRbIDYgXSwgMTAgKSApIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvciggU3RyaW5nVXRpbC5zcHJpbnRmKCAiVW5hYmxlIHRvIHVuZGVyc3RhbmQgZGF0ZSBzcGVjaWZpZWQgYXM6ICclcycgKEludmFsaWQgZGF0ZSBhZnRlciBubyBUWiAtIHJlZ2V4cCBtYXRjaD8pLiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGlzbzg2MDEgKSApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIExvZy5kZWJ1ZyggIlJldHVybmluZzogIiArIHJlcy50b1VUQ1N0cmluZyggKSApOwogICAgICAgIHJldHVybiByZXM7CiAgICB9IGVsc2UgewogICAgICAgIG1hdGNoZWQgPSBfX0RhdGVVdGlsQ29yZV9wYXJzZUlTTzg2MDEucmVnVFouZXhlYyggaXNvODYwMSApOwogICAgICAgIGlmICggbWF0Y2hlZCApIHsKICAgICAgICAgICAgTG9nLmRlYnVnKCAiTWF0Y2hlZCBhcyBzdHJpbmcgd2l0aCBub3JtYWwgdGltZXpvbmUgaW5mb3JtYXRpb24iICk7CiAgICAgICAgICAgIHZhciByZXMgPSBfX0RhdGVVdGlsQ29yZV9wYXJzZUlTTzg2MDEoIG1hdGNoZWRbIDEgXSArICJaIiApOwogICAgICAgICAgICBMb2cuZGVidWcoIFN0cmluZ1V0aWwuc3ByaW50ZiggIlBhcnRzOiAnJXMnLCAnJXMnLCAnJXMnIiwKICAgICAgICAgICAgICAgICAgICBtYXRjaGVkWyAyIF0sIG1hdGNoZWRbIDMgXSwgbWF0Y2hlZFsgNCBdICkgKTsKICAgICAgICAgICAgLy8gQWRqdXN0OiBJZiArLCBzdWJzdHJhY3QgdG8gZ2V0ICJyZWFsIiBVVEMuIElmIC0KICAgICAgICAgICAgaWYgKCBtYXRjaGVkWyAyIF0gPT0gIi0iICkgewogICAgICAgICAgICAgICAgcmVzLnNldFVUQ0hvdXJzKCByZXMuZ2V0VVRDSG91cnMoICkgKyBwYXJzZUludCggbWF0Y2hlZFsgMyBdLCAxMCApICk7CiAgICAgICAgICAgICAgICByZXMuc2V0VVRDTWludXRlcyggcmVzLmdldFVUQ01pbnV0ZXMoICkgKyBwYXJzZUludCggbWF0Y2hlZFsgNCBdLCAxMCApICk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXMuc2V0VVRDSG91cnMoIHJlcy5nZXRVVENIb3VycyggKSAtIHBhcnNlSW50KCBtYXRjaGVkWyAzIF0sIDEwICkgKTsKICAgICAgICAgICAgICAgIHJlcy5zZXRVVENNaW51dGVzKCByZXMuZ2V0VVRDTWludXRlcyggKSAtIHBhcnNlSW50KCBtYXRjaGVkWyA0IF0sIDEwICkgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBMb2cuZGVidWcoICJSZXR1cm5pbmc6ICIgKyByZXMudG9VVENTdHJpbmcoICkgKTsKICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICB9CgogICAgfQogICAgTG9nLmRlYnVnKCAiTm8gbWF0Y2ggZm9yIElTTzg2MDEgdmFyaWFudHMgLSB0aHJvd2luZyIgKTsKICAgIHRocm93IEVycm9yKCBTdHJpbmdVdGlsLnNwcmludGYoICJVbmFibGUgdG8gdW5kZXJzdGFuZCBkYXRlIHNwZWNpZmllZCBhczogJyVzJyAoTm8gcmVnZXhwIG1hdGNoKS4iLAogICAgICAgICAgICBpc284NjAxICkgKTsKfTsKX19EYXRlVXRpbENvcmVfcGFyc2VJU084NjAxLnJlZ1VUQyA9IC9eKFxkezR9KS0oXGR7Mn0pLShcZHsyfSlUKFxkezJ9KTooXGR7Mn0pOihcZHsyfSkoWnswLDF9KSQvOwpfX0RhdGVVdGlsQ29yZV9wYXJzZUlTTzg2MDEucmVnVFogPSAvXihcZHs0fS1cZHsyfS1cZHsyfVRcZHsyfTpcZHsyfTpcZHsyfSlccyooWystXSlccyooXGR7MSwyfSk6KFxkezEsMn0pJC87CgovKiogXGJyaWVmIFJldHVybiBhbiBJU084NjAxIFogdGltZSBzdHJpbmcgcmVwIG9mIHRoZSBKYXZhU2NyaXB0IGRhdGUgb2JqZWN0IHBhc3NlZCB0byB0aGUgZnVuY3Rpb24uCiAqCiAqIFRoZSBmb3JtYXQgaXMgWVlZWS1NTS1ERFRoaDptbTpzc1oKICogQHBhcmFtIGR0IFRoZSBKYXZhU2NyaXB0IGluc3RhbmNlIHRvIGNvbnZlcnQuCiAqIEByZXR1cm4gQSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGRhdGV0aW1lIGluIElTTzg2MDEgbGlrZSBub3RhdGlvbiBpbiBVVEMKICoKICogTm90ZSwgaWYgdGhlIGRhdGUgaXMgaW52YWxpZCwgeW91IGdldCBhIGxvdCBvZiBOYU4ncy4uLiBzb3JyeSBhYm91dCB0aGF0LCBzbyBzdWUgbWUhIDotKSAqLwp2YXIgX19EYXRlVXRpbENvcmVfZm9ybWF0SVNPODYwMSA9IGZ1bmN0aW9uKCBkYXRlICkgewogICAgLy8gV2UgZG8gbm90IGhhdmUgcGFydGlhbCBzZWNvbmRzLi4uIHNvLCBubyB0b0lTT1N0cmluZygpLi4uCiAgICByZXR1cm4gU3RyaW5nVXRpbC5zcHJpbnRmKCAiJTA0ZC0lMDJkLSUwMmRUJTAyZDolMDJkOiUwMmRaIiwKICAgICAgICBkYXRlLmdldFVUQ0Z1bGxZZWFyKCApLAogICAgICAgIGRhdGUuZ2V0VVRDTW9udGgoICkgKyAxLAogICAgICAgIGRhdGUuZ2V0VVRDRGF0ZSggKSwKICAgICAgICBkYXRlLmdldFVUQ0hvdXJzKCApLAogICAgICAgIGRhdGUuZ2V0VVRDTWludXRlcyggKSwKICAgICAgICBkYXRlLmdldFVUQ1NlY29uZHMoICkgKTsKfTsK", "moduleName": "DateUtilCore"}, {"javascript": "LyoqIEBmaWxlIFN0cmluZyB1dGlsaXRpZXMgKi8KRVhQT1JURURfU1lNQk9MUyA9IFsgJ1N0cmluZ1V0aWwnIF07CgovKiBTcHJpbnRmIGltcGxlbWVudGF0aW9uIGxpZnRlZCBmcm9tIGh0dHA6Ly93d3cud2VidG9vbGtpdC5pbmZvL2phdmFzY3JpcHQtc3ByaW50Zi5odG1sCiAqIE5vIGxpY2Vuc2UgaW5kaWNhdGVkIC0gYXNzdW1pbmcgcHVibGljIGRvbWFpbgoKICogTW9kaWZlZCB0byBiZSBhIG1vZHVsZSwgdGhlbiBsaW50ZWQsIFVuaXRUZXN0cyBhZGRlZC4KCkphdmFzY3JpcHQgc3ByaW50ZgpTZXZlcmFsIHByb2dyYW1taW5nIGxhbmd1YWdlcyBpbXBsZW1lbnQgYSBzcHJpbnRmIGZ1bmN0aW9uLCB0byBvdXRwdXQgYSBmb3JtYXR0ZWQgc3RyaW5nLiBJdCBvcmlnaW5hdGVkIGZyb20gdGhlIEMgcHJvZ3JhbW1pbmcgbGFuZ3VhZ2UsIHByaW50ZiBmdW5jdGlvbi4gSXRzIGEgc3RyaW5nIG1hbmlwdWxhdGlvbiBmdW5jdGlvbi4KVGhpcyBpcyBsaW1pdGVkIHNwcmludGYgSmF2YXNjcmlwdCBpbXBsZW1lbnRhdGlvbi4gRnVuY3Rpb24gcmV0dXJucyBhIHN0cmluZyBmb3JtYXR0ZWQgYnkgdGhlIHVzdWFsIHByaW50ZiBjb252ZW50aW9ucy4gU2VlIGJlbG93IGZvciBtb3JlIGRldGFpbHMuIFlvdSBtdXN0IHNwZWNpZnkgdGhlIHN0cmluZyBhbmQgaG93IHRvIGZvcm1hdCB0aGUgdmFyaWFibGVzIGluIGl0LiBQb3NzaWJsZSBmb3JtYXQgdmFsdWVzOgogJSUgLSBSZXR1cm5zIGEgcGVyY2VudCBzaWduCiAlYiAtIEJpbmFyeSBudW1iZXIKICVjIC0gVGhlIGNoYXJhY3RlciBhY2NvcmRpbmcgdG8gdGhlIEFTQ0lJIHZhbHVlCiAlZCAtIFNpZ25lZCBkZWNpbWFsIG51bWJlcgogJWYgLSBGbG9hdGluZy1wb2ludCBudW1iZXIKICVvIC0gT2N0YWwgbnVtYmVyCiAlcyAtIFN0cmluZwogJXggLSBIZXhhZGVjaW1hbCBudW1iZXIgKGxvd2VyY2FzZSBsZXR0ZXJzKQogJVggLSBIZXhhZGVjaW1hbCBudW1iZXIgKHVwcGVyY2FzZSBsZXR0ZXJzKQpBZGRpdGlvbmFsIGZvcm1hdCB2YWx1ZXMuIFRoZXNlIGFyZSBwbGFjZWQgYmV0d2VlbiB0aGUgJSBhbmQgdGhlIGxldHRlciAoZXhhbXBsZSAlLjJmKToKCiAKICsgKEZvcmNlcyBib3RoICsgYW5kIC0gaW4gZnJvbnQgb2YgbnVtYmVycy4gQnkgZGVmYXVsdCwgb25seSBuZWdhdGl2ZSBudW1iZXJzIGFyZSBtYXJrZWQpCiAtIChMZWZ0LWp1c3RpZmllcyB0aGUgdmFyaWFibGUgdmFsdWUpCiAwIHplcm8gd2lsbCBiZSB1c2VkIGZvciBwYWRkaW5nIHRoZSByZXN1bHRzIHRvIHRoZSByaWdodCBzdHJpbmcgc2l6ZQogWzAtOV0gKFNwZWNpZmllcyB0aGUgbWluaW11bSB3aWR0aCBoZWxkIG9mIHRvIHRoZSB2YXJpYWJsZSB2YWx1ZSkKIC5bMC05XSAoU3BlY2lmaWVzIHRoZSBudW1iZXIgb2YgZGVjaW1hbCBkaWdpdHMgb3IgbWF4aW11bSBzdHJpbmcgbGVuZ3RoKQoKCiovCgovKioKICogVmFyaW91cyBtZXRob2RzIHRvIG1hbmlwdWxhdGUgc3RyaW5ncy4KICogCiAqIFRoaXMgbmFtZXNwYWNlIGNvbnRhaW4ocykgbWV0aG9kcyB0aGF0IHByb3ZpZGUgc29tZSBzdHJpbmcgbWFuaXB1bGF0aW9uCiAqIG1ldGhvZHMsIHRoYXQgYXJlIG5vdCBwcm92aWRlZCBieSB0aGUgSmF2YVNjcmlwdCBTdHJpbmcgY2xhc3MsIHN1Y2ggYXMKICogc3ByaW50Zi4gCiAqCiAqIEB0eXBlIHtuYW1lc3BhY2V9CiAqIEBuYW1lIFN0cmluZ1V0aWwKICogQG5hbWVzcGFjZSAqLwp2YXIgU3RyaW5nVXRpbCA9IGZ1bmN0aW9uKCApIHsKICAgIHZhciB0aGF0ID0ge307CgogICAgdmFyIGNvbnZlcnQgPSBmdW5jdGlvbiggbWF0Y2gsIG5vc2lnbiApIHsKICAgICAgICBpZiAoIG5vc2lnbiApIHsKICAgICAgICAgICAgbWF0Y2guc2lnbiA9ICcnOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1hdGNoLnNpZ24gPSBtYXRjaC5uZWdhdGl2ZSA/ICctJyA6IG1hdGNoLnNpZ247CiAgICAgICAgfQogICAgICAgIHZhciBsID0gbWF0Y2gubWluIC0gbWF0Y2guYXJndW1lbnQubGVuZ3RoICsgMSAtIG1hdGNoLnNpZ24ubGVuZ3RoOwogICAgICAgIHZhciBwYWQ7CiAgICAgICAgaWYgKCBsIDwgMCApIHsKICAgICAgICAgICAgcGFkID0gWyBdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHBhZCA9IG5ldyBBcnJheSggbCApOwogICAgICAgIH0KICAgICAgICBwYWQgPSBwYWQuam9pbiggbWF0Y2gucGFkICk7CiAgICAgICAgaWYgKCAhbWF0Y2gubGVmdCApIHsKICAgICAgICAgICAgaWYgKCBtYXRjaC5wYWQgPT0gIjAiIHx8IG5vc2lnbiApIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaC5zaWduICsgcGFkICsgbWF0Y2guYXJndW1lbnQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFkICsgbWF0Y2guc2lnbiArIG1hdGNoLmFyZ3VtZW50OwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKCBtYXRjaC5wYWQgPT0gIjAiIHx8IG5vc2lnbiApIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaC5zaWduICsgbWF0Y2guYXJndW1lbnQgKyBwYWQucmVwbGFjZSggLzAvZywgJyAnICk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2guc2lnbiArIG1hdGNoLmFyZ3VtZW50ICsgcGFkOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCiAgICAvKioKICAgICAqIE1ldGhvZCB0aGF0IGNvbnZlcnRzIGRhbmlzaCBjaGFyYWN0ZXJzIHRvIFVSTCBlbmNvZGVkIHZhbHVlcyBmb3IgVVRGLTguCiAgICAgKiAKICAgICAqIEB0eXBlIHttZXRob2R9CiAgICAgKiBAc3ludGF4IFN0cmluZ1V0aWwuY29udmVydERhbmlzaENoYXJzVG9VdGY4VXJsRW5jb2RlZFZhbHVlcyggc3RyICkKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdHIgQSBzdHJpbmcgd2l0aCBhIGRhbmlzaCBjaGFyYWN0ZXIKICAgICAqIEByZXR1cm4ge1N0cmluZ30gQSBzdHJpbmcgd2l0aCBVVEYtOCBVUkwgZW5jb2RlZCB2YWx1ZQogICAgICogQGV4YW1wbGUgU3RyaW5nVXRpbC5jb252ZXJ0RGFuaXNoQ2hhcnNUb1V0ZjhVcmxFbmNvZGVkVmFsdWVzKCAiXHUwMEU2IiApCiAgICAgKiBAbmFtZSBTdHJpbmdVdGlsLmNvbnZlcnREYW5pc2hDaGFyc1RvVXRmOFVybEVuY29kZWRWYWx1ZXMKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgdGhhdC5jb252ZXJ0RGFuaXNoQ2hhcnNUb1V0ZjhVcmxFbmNvZGVkVmFsdWVzID0gZnVuY3Rpb24oIHN0ciApIHsKCiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoIC9cdTAwRTYvZywgIiVDMyVBNiIgKTsgLy9yZXBsYWNpbmcgZGFuaXNoIGFlIHRvIHRvIFVSTC1lbmNvZGVkIHZhbHVlIAogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKCAvXHUwMEY4L2csICIlQzMlQjgiICk7IC8vcmVwbGFjaW5nIGRhbmlzaCBvZSB0byB0byBVUkwtZW5jb2RlZCB2YWx1ZQogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKCAvXHUwMEU1L2csICIlQzMlQTUiICk7IC8vcmVwbGFjaW5nIGRhbmlzaCBhYSB0byB0byBVUkwtZW5jb2RlZCB2YWx1ZQogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKCAvXHUwMEM2L2csICIlQzMlODYiICk7IC8vcmVwbGFjaW5nIGRhbmlzaCBBZSB0byB0byBVUkwtZW5jb2RlZCB2YWx1ZQogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKCAvXHUwMEQ4L2csICIlQzMlOTgiICk7IC8vcmVwbGFjaW5nIGRhbmlzaCBPZSB0byB0byBVUkwtZW5jb2RlZCB2YWx1ZQogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKCAvXHUwMEM1L2csICIlQzMlODUiICk7IC8vcmVwbGFjaW5nIGRhbmlzaCBBYSB0byB0byBVUkwtZW5jb2RlZCB2YWx1ZQoKICAgICAgICByZXR1cm4gc3RyOwoKICAgIH07CgogICAgLyoqCiAgICAgKiBGb3JtYXQgc3RyaW5nIHdpdGggYXJndW1lbnRzLgogICAgICogCiAgICAgKiBJbXBsZW1lbnRhdGlvbiBvZiBzcHJpbnRmIGZvciBKYXZhU2NyaXB0LiBBbGxvd3MgdG8gZm9ybWF0IGEgc3RyaW5nLAogICAgICogYmFzZWQgb24gYSAndGVtcGxhdGUnLCBhbmQgYSBudW1iZXIgb2YgYXJndW1lbnRzLiAKICAgICAqCiAgICAgKiBQb3NzaWJsZSBmb3JtYXQgdmFsdWVzOgogICAgICoKICAgICAqICogJSUgOiBSZXR1cm5zIGEgcGVyY2VudCBzaWduCiAgICAgKiAqICViIDogQmluYXJ5IG51bWJlcgogICAgICogKiAlYyA6IFRoZSBjaGFyYWN0ZXIgYWNjb3JkaW5nIHRvIHRoZSBBU0NJSSB2YWx1ZQogICAgICogKiAlZCA6IFNpZ25lZCBkZWNpbWFsIG51bWJlcgogICAgICogKiAlZiA6IEZsb2F0aW5nLXBvaW50IG51bWJlcgogICAgICogKiAlbyA6IE9jdGFsIG51bWJlcgogICAgICogKiAlcyA6IFN0cmluZwogICAgICogKiAleCA6IEhleGFkZWNpbWFsIG51bWJlciAobG93ZXJjYXNlIGxldHRlcnMpCiAgICAgKiAqICVYIDogSGV4YWRlY2ltYWwgbnVtYmVyICh1cHBlcmNhc2UgbGV0dGVycykKICAgICAqCiAgICAgKiBBZGRpdGlvbmFsIGZvcm1hdCB2YWx1ZXMuIFRoZXNlIGFyZSBwbGFjZWQgYmV0d2VlbiB0aGUgJSBhbmQgdGhlIGxldHRlciAoZXhhbXBsZSAlLjJmKToKICAgICAqCiAgICAgKiAqICsgOiBGb3JjZXMgYm90aCArIGFuZCAtIGluIGZyb250IG9mIG51bWJlcnMuIEJ5IGRlZmF1bHQsIG9ubHkgbmVnYXRpdmUgbnVtYmVycyBhcmUgbWFya2VkCiAgICAgKiAqIC0gOiBMZWZ0LWp1c3RpZmllcyB0aGUgdmFyaWFibGUgdmFsdWUKICAgICAqICogMCA6IHplcm8gd2lsbCBiZSB1c2VkIGZvciBwYWRkaW5nIHRoZSByZXN1bHRzIHRvIHRoZSByaWdodCBzdHJpbmcgc2l6ZQogICAgICogKiBbMC05XSA6IFNwZWNpZmllcyB0aGUgbWluaW11bSB3aWR0aCBoZWxkIG9mIHRvIHRoZSB2YXJpYWJsZSB2YWx1ZQogICAgICogKiAuWzAtOV0gOiBTcGVjaWZpZXMgdGhlIG51bWJlciBvZiBkZWNpbWFsIGRpZ2l0cyBvciBtYXhpbXVtIHN0cmluZyBsZW5ndGgKICAgICAqCiAgICAgKiBGb3JtYXQgdmFsdWVzIGNhbiBiZSByZXBlYXRlZCBhbmQgbWl4ZWQgd2l0aCBub3JtYWwgdGV4dC4gRWFjaCBmb3JtYXQgdmFsdWUgd2lsbCBjb25zdW1lIG9uZSBhZGRpdGlvbmFsIGFyZ3VtZW50LgogICAgICoKICAgICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBpcyBzbG93LiBVc2UgaXQgd2l0aCBjYXV0aW9uLgogICAgICogCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259CiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZm9ybWF0IEZvcm1hdHRpbmcgc3RyaW5nLCBzdWNoIGFzICJpbmRleCAlaSBpcyAlcyIKICAgICAqIEBwYXJhbSB7Li4ub2JqZWN0fSB2YWx1ZSBPbmUgb3IgbW9yZSB2YWx1ZXMgdG8gdXNlIGluIHRoZSBzdHJpbmcgZm9ybWF0IHRlbXBsYXRlLiBUaGlzIHdpbGwgYmUgY29udmVydGVkIHRvIGEgc3RyaW5nIGFjY29yZGluZyB0byB0aGUgc3BlY2lmaWNzIG9mIHRoZSB0ZW1wbGF0ZS4KICAgICAqIEByZXR1cm4ge1N0cmluZ30gQSBzdHJpbmcgZm9ybWF0dGVkIGFjY29yZGluZyB0byB0aGUgZm9ybWF0IHNwZWNpZmljYXRpb24uCiAgICAgKiBAZXhhbXBsZSAKLy8gVXNpbmcgdGhlIHNwcmludGYgZnVuY3Rpb24gaW4gYSBKYXZhU2NyaXB0IHNoZWxsLgpqcz4gcHJpbnQoIFN0cmluZ1V0aWwuc3ByaW50ZiggIkRhdGFiYXNlICclLTEwcyc6IE51bWJlciBvZiByZWNvcmRzIGluIGZpbGU6ICUwOGQuIEF2ZXJhZ2Ugc2l6ZTogJS4yZiBsaXRlcnMiLCAiQUJDRCIsIDEwNDMsIDM0LjQ1NiApICk7CkRhdGFiYXNlICdBQkNEICAgICAgJzogTnVtYmVyIG9mIHJlY29yZHMgaW4gZmlsZTogMDAwMDEwNDMuIEF2ZXJhZ2Ugc2l6ZTogMzQuNDYgbGl0ZXJzCiAgICAgKiBAbmFtZSBTdHJpbmdVdGlsLnNwcmludGYKICAgICAqIEBtZXRob2QKICAgICAqLwogICAgdGhhdC5zcHJpbnRmID0gZnVuY3Rpb24oICkgewoKICAgICAgICBpZiAoIHR5cGVvZiBhcmd1bWVudHMgPT0gInVuZGVmaW5lZCIgKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAoIGFyZ3VtZW50cy5sZW5ndGggPCAxICkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKCB0eXBlb2YgYXJndW1lbnRzWyAwIF0gIT0gInN0cmluZyIgKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAoIHR5cGVvZiBSZWdFeHAgPT0gInVuZGVmaW5lZCIgKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgdmFyIHN0cmluZyA9IGFyZ3VtZW50c1sgMCBdOwogICAgICAgIHZhciBleHAgPSBuZXcgUmVnRXhwKCAvKCUoWyVdfChcLSk/KFwrfFx4MjApPygwKT8oXGQrKT8oXC4oXGQpPyk/KFtiY2Rmb3N4WF0pKSkvZyApOwogICAgICAgIHZhciBtYXRjaGVzID0gWyBdOwogICAgICAgIHZhciBzdHJpbmdzID0gWyBdOwogICAgICAgIHZhciBjb252Q291bnQgPSAwOwogICAgICAgIHZhciBzdHJpbmdQb3NTdGFydCA9IDA7CiAgICAgICAgdmFyIHN0cmluZ1Bvc0VuZCA9IDA7CiAgICAgICAgdmFyIG1hdGNoUG9zRW5kID0gMDsKICAgICAgICB2YXIgbmV3U3RyaW5nID0gJyc7CiAgICAgICAgdmFyIG1hdGNoID0gZXhwLmV4ZWMoIHN0cmluZyApOwogICAgICAgIHZhciBzdWJzdGl0dXRpb24gPSB1bmRlZmluZWQ7CiAgICAgICAgd2hpbGUgKCBtYXRjaCApIHsKICAgICAgICAgICAgaWYgKCBtYXRjaFsgOSBdICkgewogICAgICAgICAgICAgICAgY29udkNvdW50ICs9IDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN0cmluZ1Bvc1N0YXJ0ID0gbWF0Y2hQb3NFbmQ7CiAgICAgICAgICAgIHN0cmluZ1Bvc0VuZCA9IGV4cC5sYXN0SW5kZXggLSBtYXRjaFsgMCBdLmxlbmd0aDsKICAgICAgICAgICAgc3RyaW5nc1sgc3RyaW5ncy5sZW5ndGggXSA9IHN0cmluZy5zdWJzdHJpbmcoIHN0cmluZ1Bvc1N0YXJ0LCBzdHJpbmdQb3NFbmQgKTsKCiAgICAgICAgICAgIG1hdGNoUG9zRW5kID0gZXhwLmxhc3RJbmRleDsKICAgICAgICAgICAgbWF0Y2hlc1sgbWF0Y2hlcy5sZW5ndGggXSA9IHsKICAgICAgICAgICAgICAgIG1hdGNoOiBtYXRjaFsgMCBdLAogICAgICAgICAgICAgICAgbGVmdDogbWF0Y2hbIDMgXSA/IHRydWUgOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNpZ246IG1hdGNoWyA0IF0gfHwgJycsCiAgICAgICAgICAgICAgICBwYWQ6IG1hdGNoWyA1IF0gfHwgJyAnLAogICAgICAgICAgICAgICAgbWluOiBtYXRjaFsgNiBdIHx8IDAsCiAgICAgICAgICAgICAgICBwcmVjaXNpb246IG1hdGNoWyA4IF0sCiAgICAgICAgICAgICAgICBjb2RlOiBtYXRjaFsgOSBdIHx8ICclJywKICAgICAgICAgICAgICAgIG5lZ2F0aXZlOiBwYXJzZUludCggYXJndW1lbnRzWyBjb252Q291bnQgXSwgMTAgKSA8IDAgPyB0cnVlIDogZmFsc2UsCiAgICAgICAgICAgICAgICBhcmd1bWVudDogU3RyaW5nKCBhcmd1bWVudHNbIGNvbnZDb3VudCBdICkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgbWF0Y2ggPSBleHAuZXhlYyggc3RyaW5nICk7CiAgICAgICAgfQogICAgICAgIHN0cmluZ3NbIHN0cmluZ3MubGVuZ3RoIF0gPSBzdHJpbmcuc3Vic3RyaW5nKCBtYXRjaFBvc0VuZCApOwoKICAgICAgICBpZiAoIG1hdGNoZXMubGVuZ3RoID09PSAwICkgewogICAgICAgICAgICByZXR1cm4gc3RyaW5nOwogICAgICAgIH0KICAgICAgICBpZiAoICggYXJndW1lbnRzLmxlbmd0aCAtIDEgKSA8IGNvbnZDb3VudCApIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICB2YXIgY29kZSA9IG51bGw7CiAgICAgICAgbWF0Y2ggPSBudWxsOwogICAgICAgIHZhciBpID0gbnVsbDsKCiAgICAgICAgZm9yICggaSA9IDA7IGkgPCBtYXRjaGVzLmxlbmd0aDsgaSsrICkgewoKICAgICAgICAgICAgaWYgKCBtYXRjaGVzWyBpIF0uY29kZSA9PSAnJScgKSB7CiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSAnJSc7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIG1hdGNoZXNbIGkgXS5jb2RlID09ICdiJyApIHsKICAgICAgICAgICAgICAgIG1hdGNoZXNbIGkgXS5hcmd1bWVudCA9IFN0cmluZyggTWF0aC5hYnMoIHBhcnNlSW50KCBtYXRjaGVzWyBpIF0uYXJndW1lbnQsIDEwICkgKS50b1N0cmluZyggMiApICk7CiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSBjb252ZXJ0KCBtYXRjaGVzWyBpIF0sIHRydWUgKTsKICAgICAgICAgICAgfSBlbHNlIGlmICggbWF0Y2hlc1sgaSBdLmNvZGUgPT0gJ2MnICkgewogICAgICAgICAgICAgICAgbWF0Y2hlc1sgaSBdLmFyZ3VtZW50ID0gU3RyaW5nKCBTdHJpbmcuZnJvbUNoYXJDb2RlKCBwYXJzZUludCggTWF0aC5hYnMoIHBhcnNlSW50KCBtYXRjaGVzWyBpIF0uYXJndW1lbnQsIDEwICkgKSwgMTAgKSApICk7CiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSBjb252ZXJ0KCBtYXRjaGVzWyBpIF0sIHRydWUgKTsKICAgICAgICAgICAgfSBlbHNlIGlmICggbWF0Y2hlc1sgaSBdLmNvZGUgPT0gJ2QnICkgewogICAgICAgICAgICAgICAgbWF0Y2hlc1sgaSBdLmFyZ3VtZW50ID0gU3RyaW5nKCBNYXRoLmFicyggcGFyc2VJbnQoIG1hdGNoZXNbIGkgXS5hcmd1bWVudCwgMTAgKSApICk7CiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSBjb252ZXJ0KCBtYXRjaGVzWyBpIF0gKTsKICAgICAgICAgICAgfSBlbHNlIGlmICggbWF0Y2hlc1sgaSBdLmNvZGUgPT0gJ2YnICkgewogICAgICAgICAgICAgICAgbWF0Y2hlc1sgaSBdLmFyZ3VtZW50ID0gU3RyaW5nKCBNYXRoLmFicyggcGFyc2VGbG9hdCggbWF0Y2hlc1sgaSBdLmFyZ3VtZW50ICkgKS50b0ZpeGVkKCBtYXRjaGVzWyBpIF0ucHJlY2lzaW9uID8gbWF0Y2hlc1sgaSBdLnByZWNpc2lvbiA6IDYgKSApOwogICAgICAgICAgICAgICAgc3Vic3RpdHV0aW9uID0gY29udmVydCggbWF0Y2hlc1sgaSBdICk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIG1hdGNoZXNbIGkgXS5jb2RlID09ICdvJyApIHsKICAgICAgICAgICAgICAgIG1hdGNoZXNbIGkgXS5hcmd1bWVudCA9IFN0cmluZyggTWF0aC5hYnMoIHBhcnNlSW50KCBtYXRjaGVzWyBpIF0uYXJndW1lbnQsIDEwICkgKS50b1N0cmluZyggOCApICk7CiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSBjb252ZXJ0KCBtYXRjaGVzWyBpIF0gKTsKICAgICAgICAgICAgfSBlbHNlIGlmICggbWF0Y2hlc1sgaSBdLmNvZGUgPT0gJ3MnICkgewogICAgICAgICAgICAgICAgbWF0Y2hlc1sgaSBdLmFyZ3VtZW50ID0gbWF0Y2hlc1sgaSBdLmFyZ3VtZW50LnN1YnN0cmluZyggMCwgbWF0Y2hlc1sgaSBdLnByZWNpc2lvbiA/IG1hdGNoZXNbIGkgXS5wcmVjaXNpb24gOiBtYXRjaGVzWyBpIF0uYXJndW1lbnQubGVuZ3RoICk7CiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSBjb252ZXJ0KCBtYXRjaGVzWyBpIF0sIHRydWUgKTsKICAgICAgICAgICAgfSBlbHNlIGlmICggbWF0Y2hlc1sgaSBdLmNvZGUgPT0gJ3gnICkgewogICAgICAgICAgICAgICAgbWF0Y2hlc1sgaSBdLmFyZ3VtZW50ID0gU3RyaW5nKCBNYXRoLmFicyggcGFyc2VJbnQoIG1hdGNoZXNbIGkgXS5hcmd1bWVudCwgMTAgKSApLnRvU3RyaW5nKCAxNiApICk7CiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSBjb252ZXJ0KCBtYXRjaGVzWyBpIF0gKTsKICAgICAgICAgICAgfSBlbHNlIGlmICggbWF0Y2hlc1sgaSBdLmNvZGUgPT0gJ1gnICkgewogICAgICAgICAgICAgICAgbWF0Y2hlc1sgaSBdLmFyZ3VtZW50ID0gU3RyaW5nKCBNYXRoLmFicyggcGFyc2VJbnQoIG1hdGNoZXNbIGkgXS5hcmd1bWVudCwgMTAgKSApLnRvU3RyaW5nKCAxNiApICk7CiAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24gPSBjb252ZXJ0KCBtYXRjaGVzWyBpIF0gKS50b1VwcGVyQ2FzZSggKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHN1YnN0aXR1dGlvbiA9IG1hdGNoZXNbIGkgXS5tYXRjaDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbmV3U3RyaW5nICs9IHN0cmluZ3NbIGkgXTsKICAgICAgICAgICAgbmV3U3RyaW5nICs9IHN1YnN0aXR1dGlvbjsKCiAgICAgICAgfQogICAgICAgIG5ld1N0cmluZyArPSBzdHJpbmdzWyBpIF07CgogICAgICAgIHJldHVybiBuZXdTdHJpbmc7CgogICAgfTsKCiAgIC8qKgogICAgICogUmV0dXJuIHRoZSBudW1iZXIgb2Ygb2N0ZXRzIG9mIGEgdW5pY29kZSBjaGFyCiAgICAgKiAKICAgICAqIEBzeW50YXggdXRmOExlbmd0aE9mQ2hhciggVW5pY29kZUNoYXIgKQogICAgICogQHBhcmFtIHtOdW1iZXJ9IFVuaWNvZGVDaGFyIENvZGVwb2ludCBmb3IgY2hhcgogICAgICogQHJldHVybiB7TnVtYmVyfSBvY3RldCBsZW5ndGggb2YgVW5pY29kZSBDaGFyIGluIFVURi04CiAgICAgKgogICAgICogSW50ZXJuYWwgSGVscGVyIEZ1bmN0aW9uCiAgICAgKgogICAgICoKICAgICAqIGNvZGUgQmFzZWQgb24gJ21hbiBVVEYtOCcKICAgICAqICAgICAgICAweDAwMDAwMDAwIC0gMHgwMDAwMDA3RjoKICAgICAweHh4eHh4eAogICAgIDB4MDAwMDAwODAgLSAweDAwMDAwN0ZGOgogICAgIDExMHh4eHh4IDEweHh4eHh4CiAgICAgMHgwMDAwMDgwMCAtIDB4MDAwMEZGRkY6CiAgICAgMTExMHh4eHggMTB4eHh4eHggMTB4eHh4eHgKICAgICAweDAwMDEwMDAwIC0gMHgwMDFGRkZGRjoKICAgICAxMTExMHh4eCAxMHh4eHh4eCAxMHh4eHh4eCAxMHh4eHh4eAogICAgIDB4MDAyMDAwMDAgLSAweDAzRkZGRkZGOgogICAgIDExMTExMHh4IDEweHh4eHh4IDEweHh4eHh4IDEweHh4eHh4IDEweHh4eHh4CiAgICAgMHgwNDAwMDAwMCAtIDB4N0ZGRkZGRkY6CiAgICAgMTExMTExMHggMTB4eHh4eHggMTB4eHh4eHggMTB4eHh4eHggMTB4eHh4eHggMTB4eHh4eHgKCiAgICAgKi8KICAgIHZhciB1dGY4TGVuZ3RoT2ZDaGFyID0gZnVuY3Rpb24oIFVuaWNvZGVDaGFyICkgewogICAgICAgIGlmICggVW5pY29kZUNoYXIgPD0gMHg3RiApIHJldHVybiAxOwogICAgICAgIGlmICggVW5pY29kZUNoYXIgPD0gMHg3RkYgKSByZXR1cm4gMjsKICAgICAgICBpZiAoIFVuaWNvZGVDaGFyIDw9IDB4RkZGRiApIHJldHVybiAzOwogICAgICAgIGlmICggVW5pY29kZUNoYXIgPD0gMHgwMDFGRkZGRiApIHJldHVybiA0OwogICAgICAgIGlmICggVW5pY29kZUNoYXIgPD0gMHgwM0ZGRkZGRiApIHJldHVybiA1OwogICAgICAgIC8vaWYoIFVuaWNvZGVDaGFyIDw9IDB4N0ZGRkZGRkYgKQogICAgICAgIHJldHVybiA2OwoKICAgIH07CgogICAgLy90aGlzIGlzIHRvIGJlIGFibGUgdG8gdGVzdCB0aGUgaW50ZXJuYWwgZnVuY3Rpb24gdXRmOExlbmd0aE9mQ2hhcgogICAgdGhhdC5fX3V0ZjhMZW5ndGhPZkNoYXIgPSB1dGY4TGVuZ3RoT2ZDaGFyOwoKCiAgICAvKiBHZXQgQ29ycmVjdCBNdWx0aSBDaGFyIGVuY29kZWVkIFVuaWNvZGVWYWx1ZSBjb2RlIHRha2VuIGZyb20gICAgICAgIAogICAgICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvU3RyaW5nL2NoYXJDb2RlQXQgCiAgICAgKiAKICAgICAqIE5vdGUgcmV0dXJucyBVbmljb2RlIFZhbHVlIGZvciBmaXJzdCBFbnRyeSwgYW5kIGZhbHNlIGZvciBzZWNvbmQgCiAgICAgKi8KCiAgICB2YXIgZml4ZWRDaGFyQ29kZUF0ID0gZnVuY3Rpb24oc3RyLCBpZHgpIHsKICAgICAgICAvLyBleC4gZml4ZWRDaGFyQ29kZUF0KCdcdUQ4MDBcdURDMDAnLCAwKTsgLy8gNjU1MzYKICAgICAgICAvLyBleC4gZml4ZWRDaGFyQ29kZUF0KCdcdUQ4MDBcdURDMDAnLCAxKTsgLy8gZmFsc2UKICAgICAgICBpZHggPSBpZHggfHwgMDsKICAgICAgICB2YXIgY29kZSA9IHN0ci5jaGFyQ29kZUF0KGlkeCk7CiAgICAgICAgdmFyIGhpLCBsb3c7CiAgICAgICAgCiAgICAgICAgLy8gSGlnaCBzdXJyb2dhdGUgKGNvdWxkIGNoYW5nZSBsYXN0IGhleCB0byAweERCN0YgdG8gdHJlYXQgaGlnaAogICAgICAgIC8vIHByaXZhdGUgc3Vycm9nYXRlcyBhcyBzaW5nbGUgY2hhcmFjdGVycykKICAgICAgICBpZiAoMHhEODAwIDw9IGNvZGUgJiYgY29kZSA8PSAweERCRkYpIHsKICAgICAgICAgICAgaGkgPSBjb2RlOwogICAgICAgICAgICBsb3cgPSBzdHIuY2hhckNvZGVBdChpZHggKyAxKTsKICAgICAgICAgICAgaWYgKGlzTmFOKGxvdykpIHsKICAgICAgICAgICAgICAgIHRocm93ICdIaWdoIHN1cnJvZ2F0ZSBub3QgZm9sbG93ZWQgYnkgbG93IHN1cnJvZ2F0ZSBpbiBmaXhlZENoYXJDb2RlQXQoKSc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICgoaGkgLSAweEQ4MDApICogMHg0MDApICsgKGxvdyAtIDB4REMwMCkgKyAweDEwMDAwOwogICAgICAgIH0KICAgICAgICBpZiAoMHhEQzAwIDw9IGNvZGUgJiYgY29kZSA8PSAweERGRkYpIHsgLy8gTG93IHN1cnJvZ2F0ZQogICAgICAgICAgICAvLyBXZSByZXR1cm4gZmFsc2UgdG8gYWxsb3cgbG9vcHMgdG8gc2tpcCB0aGlzIGl0ZXJhdGlvbiBzaW5jZSBzaG91bGQgaGF2ZQogICAgICAgICAgICAvLyBhbHJlYWR5IGhhbmRsZWQgaGlnaCBzdXJyb2dhdGUgYWJvdmUgaW4gdGhlIHByZXZpb3VzIGl0ZXJhdGlvbgogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIC8qaGkgPSBzdHIuY2hhckNvZGVBdChpZHggLSAxKTsKICAgICAgICAgICAgICBsb3cgPSBjb2RlOwogICAgICAgICAgICAgIHJldHVybiAoKGhpIC0gMHhEODAwKSAqIDB4NDAwKSArIChsb3cgLSAweERDMDApICsgMHgxMDAwMDsqLwogICAgICAgIH0KICAgICAgICByZXR1cm4gY29kZTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG51bWJlciBvZiBvY3RldHMgb2YgYSBzdHJpbmcsIHdoZW4gZW5jb2RlZCBhcyBVVEY4LgogICAgICogCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB1c2VkLCBpZiB5b3Ugd2lzaCB0byBrbm93IHRoZSBsZW5naHQgb2YgYSBzdHJpbmcKICAgICAqIGluIG9jdGV0cy9ieXRlcywgaWYgdGhlIHN0cmluZyBpcyBlbmNvZGVkIGluIFVURjguIFRoaXMgaXMKICAgICAqIG1vc3RseSByZWxldmFudCBpZiB5b3UgbmVlZCB0byBwcm9kdWNlIGVuY29kZWQgZmlsZXMgZnJvbQogICAgICogd2l0aGluIEphdmFTY3JpcHQsIHdoaWNoIGlzIHRoZSBjYXNlIGZvciBlLmcuICJhZGRpIiBmaWxlcy4KICAgICAqCiAgICAgKiBAc3ludGF4IHV0ZjhMZW5ndGhPZlN0cmluZyggVW5pY29kZVN0cmluZyApCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gVW5pY29kZVN0cmluZyBBIHN0YW5kYXJkIGphdmFzdHJpbmcKICAgICAqIEByZXR1cm4ge051bWJlcn0gT2N0ZXQgbGVuZ3RoIG9mIFVURjggZW5jb2Rpbmcgb2YgU3RyaW5nCiAgICAgKiBAZXhhbXBsZQovLyBUaGlzIGNhbGwgd2lsbCByZXR1cm4gMjoKU3RyaW5nVXRpbC51dGY4TGVuZ3RoT2ZDaGFyKCAiXHUwMEU2IiApOyAvLyBEYW5pc2ggbGV0dGVyIGFlCi8vIFRoZXJlIGlzIGEgZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZSBudW1iZXIgb2YgY2hhcmFjdGVycywgYW5kIHRoZSB1dGY4IGxlbmd0aDoKdmFyIHRlc3QgPSAiRGVsZmVsdCBcdTAwRTYgZXIgaGVyIjsgLy8gU3RpbGwgRGFuaXNoIGxldHRlciBhZQp0ZXN0Lmxlbmd0aDsgLy8gUmV0dXJucyAxNgpTdHJpbmdVdGlsLnV0ZjhMZW5ndGhPZlN0cmluZyggdGVzdCApOyAvLyBSZXR1cm5zIDE3CiAgICAgKiBAbmFtZSBTdHJpbmdVdGlsLnV0ZjhMZW5ndGhPZlN0cmluZwogICAgICogQG1ldGhvZAogICAgICovCiAgICB0aGF0LnV0ZjhMZW5ndGhPZlN0cmluZyA9IGZ1bmN0aW9uKCBVbmljb2RlU3RyaW5nICkgewogICAgICAgIHZhciBsZW5ndGggPSAwOwogICAgICAgIHZhciBpID0gMDsKICAgICAgICB2YXIgbiA9IFVuaWNvZGVTdHJpbmcubGVuZ3RoOwoKICAgICAgICBmb3IgKCA7IGkgPCBuOyArK2kgKSB7CiAgICAgICAgICAgIHZhciBjaGFyQ29kZSA9IGZpeGVkQ2hhckNvZGVBdCggVW5pY29kZVN0cmluZywgaSApOwogICAgICAgICAgICBpZiggY2hhckNvZGUgKSB7ICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGVuZ3RoICs9IHV0ZjhMZW5ndGhPZkNoYXIoIGNoYXJDb2RlICk7CiAgICAgICAgICAgIH0gLy8gZWxzZSBmaXhlZENoYXJDb2RlIHJldHVybiBmYWxzZSBmb3IgY29kZVBvaW50IGFscmVhZHkgcHJvY2Vzc2VkCiAgICAgICAgfQogICAgICAgIHJldHVybiBsZW5ndGg7CiAgICB9OwoKCiAgICAvKioKICAgICAqIE1ldGhvZCB0aGF0IG5vcm1hbGl6ZXMgZGlhY3JpdGljcy4KICAgICAqIAogICAgICogQHR5cGUge21ldGhvZH0KICAgICAqIEBzeW50YXggU3RyaW5nVXRpbC5ub3JtYWxpemVEaWFjcml0aWNzKCBzdHJpbmcgKQogICAgICogQHBhcmFtIHtTdHJpbmd9IHN0cmluZyBUaGUgc3RyaW5nIHRoYXQgcG9zc2libHkgY29udGFpbnMgZGlhY3JpdGljcwogICAgICogQHJldHVybiB7U3RyaW5nfSB0aGUgbm9ybWFsaXplZCBzdHJpbmcKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFN0cmluZ1V0aWwubm9ybWFsaXplRGlhY3JpdGljcwogICAgICogQGV4YW1wbGUgU3RyaW5nVXRpbC5ub3JtYWxpemVEaWFjcml0aWNzKCAiUmVuXHUwMEU5IiApCiAgICAgKi8KICAgIHRoYXQubm9ybWFsaXplRGlhY3JpdGljcyA9IGZ1bmN0aW9uKCBzdHJpbmcgKSB7CgogICAgICAgIHZhciBkaWFjcml0aWNzTWFwID0gewogICAgICAgICAgICAiXHUwMDQxIjogIkEiLAogICAgICAgICAgICAiXHUyNEI2IjogIkEiLAogICAgICAgICAgICAiXHVGRjIxIjogIkEiLAogICAgICAgICAgICAiXHUwMEMwIjogIkEiLAogICAgICAgICAgICAiXHUwMEMxIjogIkEiLAogICAgICAgICAgICAiXHUwMEMyIjogIkEiLAogICAgICAgICAgICAiXHUxRUE2IjogIkEiLAogICAgICAgICAgICAiXHUxRUE0IjogIkEiLAogICAgICAgICAgICAiXHUxRUFBIjogIkEiLAogICAgICAgICAgICAiXHUxRUE4IjogIkEiLAogICAgICAgICAgICAiXHUwMEMzIjogIkEiLAogICAgICAgICAgICAiXHUwMTAwIjogIkEiLAogICAgICAgICAgICAiXHUwMTAyIjogIkEiLAogICAgICAgICAgICAiXHUxRUIwIjogIkEiLAogICAgICAgICAgICAiXHUxRUFFIjogIkEiLAogICAgICAgICAgICAiXHUxRUI0IjogIkEiLAogICAgICAgICAgICAiXHUxRUIyIjogIkEiLAogICAgICAgICAgICAiXHUwMjI2IjogIkEiLAogICAgICAgICAgICAiXHUwMUUwIjogIkEiLAogICAgICAgICAgICAiXHUwMEM0IjogIkEiLAogICAgICAgICAgICAiXHUwMURFIjogIkEiLAogICAgICAgICAgICAiXHUxRUEyIjogIkEiLAogICAgICAgICAgICAiXHUwMEM1IjogIkEiLAogICAgICAgICAgICAiXHUwMUZBIjogIkEiLAogICAgICAgICAgICAiXHUwMUNEIjogIkEiLAogICAgICAgICAgICAiXHUwMjAwIjogIkEiLAogICAgICAgICAgICAiXHUwMjAyIjogIkEiLAogICAgICAgICAgICAiXHUxRUEwIjogIkEiLAogICAgICAgICAgICAiXHUxRUFDIjogIkEiLAogICAgICAgICAgICAiXHUxRUI2IjogIkEiLAogICAgICAgICAgICAiXHUxRTAwIjogIkEiLAogICAgICAgICAgICAiXHUwMTA0IjogIkEiLAogICAgICAgICAgICAiXHUwMjNBIjogIkEiLAogICAgICAgICAgICAiXHUyQzZGIjogIkEiLAogICAgICAgICAgICAiXHVBNzMyIjogIkFBIiwKICAgICAgICAgICAgIlx1MDBDNiI6ICJBRSIsCiAgICAgICAgICAgICJcdTAxRkMiOiAiQUUiLAogICAgICAgICAgICAiXHUwMUUyIjogIkFFIiwKICAgICAgICAgICAgIlx1QTczNCI6ICJBTyIsCiAgICAgICAgICAgICJcdUE3MzYiOiAiQVUiLAogICAgICAgICAgICAiXHVBNzM4IjogIkFWIiwKICAgICAgICAgICAgIlx1QTczQSI6ICJBViIsCiAgICAgICAgICAgICJcdUE3M0MiOiAiQVkiLAogICAgICAgICAgICAiXHUwMDQyIjogIkIiLAogICAgICAgICAgICAiXHUyNEI3IjogIkIiLAogICAgICAgICAgICAiXHVGRjIyIjogIkIiLAogICAgICAgICAgICAiXHUxRTAyIjogIkIiLAogICAgICAgICAgICAiXHUxRTA0IjogIkIiLAogICAgICAgICAgICAiXHUxRTA2IjogIkIiLAogICAgICAgICAgICAiXHUwMjQzIjogIkIiLAogICAgICAgICAgICAiXHUwMTgyIjogIkIiLAogICAgICAgICAgICAiXHUwMTgxIjogIkIiLAogICAgICAgICAgICAiXHUwMDQzIjogIkMiLAogICAgICAgICAgICAiXHUyNEI4IjogIkMiLAogICAgICAgICAgICAiXHVGRjIzIjogIkMiLAogICAgICAgICAgICAiXHUwMTA2IjogIkMiLAogICAgICAgICAgICAiXHUwMTA4IjogIkMiLAogICAgICAgICAgICAiXHUwMTBBIjogIkMiLAogICAgICAgICAgICAiXHUwMTBDIjogIkMiLAogICAgICAgICAgICAiXHUwMEM3IjogIkMiLAogICAgICAgICAgICAiXHUxRTA4IjogIkMiLAogICAgICAgICAgICAiXHUwMTg3IjogIkMiLAogICAgICAgICAgICAiXHUwMjNCIjogIkMiLAogICAgICAgICAgICAiXHVBNzNFIjogIkMiLAogICAgICAgICAgICAiXHUwMDQ0IjogIkQiLAogICAgICAgICAgICAiXHUyNEI5IjogIkQiLAogICAgICAgICAgICAiXHVGRjI0IjogIkQiLAogICAgICAgICAgICAiXHUxRTBBIjogIkQiLAogICAgICAgICAgICAiXHUwMTBFIjogIkQiLAogICAgICAgICAgICAiXHUxRTBDIjogIkQiLAogICAgICAgICAgICAiXHUxRTEwIjogIkQiLAogICAgICAgICAgICAiXHUxRTEyIjogIkQiLAogICAgICAgICAgICAiXHUxRTBFIjogIkQiLAogICAgICAgICAgICAiXHUwMTEwIjogIkQiLAogICAgICAgICAgICAiXHUwMThCIjogIkQiLAogICAgICAgICAgICAiXHUwMThBIjogIkQiLAogICAgICAgICAgICAiXHUwMTg5IjogIkQiLAogICAgICAgICAgICAiXHVBNzc5IjogIkQiLAogICAgICAgICAgICAiXHUwMUYxIjogIkRaIiwKICAgICAgICAgICAgIlx1MDFDNCI6ICJEWiIsCiAgICAgICAgICAgICJcdTAxRjIiOiAiRHoiLAogICAgICAgICAgICAiXHUwMUM1IjogIkR6IiwKICAgICAgICAgICAgIlx1MDA0NSI6ICJFIiwKICAgICAgICAgICAgIlx1MjRCQSI6ICJFIiwKICAgICAgICAgICAgIlx1RkYyNSI6ICJFIiwKICAgICAgICAgICAgIlx1MDBDOCI6ICJFIiwKICAgICAgICAgICAgIlx1MDBDOSI6ICJFIiwKICAgICAgICAgICAgIlx1MDBDQSI6ICJFIiwKICAgICAgICAgICAgIlx1MUVDMCI6ICJFIiwKICAgICAgICAgICAgIlx1MUVCRSI6ICJFIiwKICAgICAgICAgICAgIlx1MUVDNCI6ICJFIiwKICAgICAgICAgICAgIlx1MUVDMiI6ICJFIiwKICAgICAgICAgICAgIlx1MUVCQyI6ICJFIiwKICAgICAgICAgICAgIlx1MDExMiI6ICJFIiwKICAgICAgICAgICAgIlx1MUUxNCI6ICJFIiwKICAgICAgICAgICAgIlx1MUUxNiI6ICJFIiwKICAgICAgICAgICAgIlx1MDExNCI6ICJFIiwKICAgICAgICAgICAgIlx1MDExNiI6ICJFIiwKICAgICAgICAgICAgIlx1MDBDQiI6ICJFIiwKICAgICAgICAgICAgIlx1MUVCQSI6ICJFIiwKICAgICAgICAgICAgIlx1MDExQSI6ICJFIiwKICAgICAgICAgICAgIlx1MDIwNCI6ICJFIiwKICAgICAgICAgICAgIlx1MDIwNiI6ICJFIiwKICAgICAgICAgICAgIlx1MUVCOCI6ICJFIiwKICAgICAgICAgICAgIlx1MUVDNiI6ICJFIiwKICAgICAgICAgICAgIlx1MDIyOCI6ICJFIiwKICAgICAgICAgICAgIlx1MUUxQyI6ICJFIiwKICAgICAgICAgICAgIlx1MDExOCI6ICJFIiwKICAgICAgICAgICAgIlx1MUUxOCI6ICJFIiwKICAgICAgICAgICAgIlx1MUUxQSI6ICJFIiwKICAgICAgICAgICAgIlx1MDE5MCI6ICJFIiwKICAgICAgICAgICAgIlx1MDE4RSI6ICJFIiwKICAgICAgICAgICAgIlx1MDA0NiI6ICJGIiwKICAgICAgICAgICAgIlx1MjRCQiI6ICJGIiwKICAgICAgICAgICAgIlx1RkYyNiI6ICJGIiwKICAgICAgICAgICAgIlx1MUUxRSI6ICJGIiwKICAgICAgICAgICAgIlx1MDE5MSI6ICJGIiwKICAgICAgICAgICAgIlx1QTc3QiI6ICJGIiwKICAgICAgICAgICAgIlx1MDA0NyI6ICJHIiwKICAgICAgICAgICAgIlx1MjRCQyI6ICJHIiwKICAgICAgICAgICAgIlx1RkYyNyI6ICJHIiwKICAgICAgICAgICAgIlx1MDFGNCI6ICJHIiwKICAgICAgICAgICAgIlx1MDExQyI6ICJHIiwKICAgICAgICAgICAgIlx1MUUyMCI6ICJHIiwKICAgICAgICAgICAgIlx1MDExRSI6ICJHIiwKICAgICAgICAgICAgIlx1MDEyMCI6ICJHIiwKICAgICAgICAgICAgIlx1MDFFNiI6ICJHIiwKICAgICAgICAgICAgIlx1MDEyMiI6ICJHIiwKICAgICAgICAgICAgIlx1MDFFNCI6ICJHIiwKICAgICAgICAgICAgIlx1MDE5MyI6ICJHIiwKICAgICAgICAgICAgIlx1QTdBMCI6ICJHIiwKICAgICAgICAgICAgIlx1QTc3RCI6ICJHIiwKICAgICAgICAgICAgIlx1QTc3RSI6ICJHIiwKICAgICAgICAgICAgIlx1MDA0OCI6ICJIIiwKICAgICAgICAgICAgIlx1MjRCRCI6ICJIIiwKICAgICAgICAgICAgIlx1RkYyOCI6ICJIIiwKICAgICAgICAgICAgIlx1MDEyNCI6ICJIIiwKICAgICAgICAgICAgIlx1MUUyMiI6ICJIIiwKICAgICAgICAgICAgIlx1MUUyNiI6ICJIIiwKICAgICAgICAgICAgIlx1MDIxRSI6ICJIIiwKICAgICAgICAgICAgIlx1MUUyNCI6ICJIIiwKICAgICAgICAgICAgIlx1MUUyOCI6ICJIIiwKICAgICAgICAgICAgIlx1MUUyQSI6ICJIIiwKICAgICAgICAgICAgIlx1MDEyNiI6ICJIIiwKICAgICAgICAgICAgIlx1MkM2NyI6ICJIIiwKICAgICAgICAgICAgIlx1MkM3NSI6ICJIIiwKICAgICAgICAgICAgIlx1QTc4RCI6ICJIIiwKICAgICAgICAgICAgIlx1MDA0OSI6ICJJIiwKICAgICAgICAgICAgIlx1MjRCRSI6ICJJIiwKICAgICAgICAgICAgIlx1RkYyOSI6ICJJIiwKICAgICAgICAgICAgIlx1MDBDQyI6ICJJIiwKICAgICAgICAgICAgIlx1MDBDRCI6ICJJIiwKICAgICAgICAgICAgIlx1MDBDRSI6ICJJIiwKICAgICAgICAgICAgIlx1MDEyOCI6ICJJIiwKICAgICAgICAgICAgIlx1MDEyQSI6ICJJIiwKICAgICAgICAgICAgIlx1MDEyQyI6ICJJIiwKICAgICAgICAgICAgIlx1MDEzMCI6ICJJIiwKICAgICAgICAgICAgIlx1MDBDRiI6ICJJIiwKICAgICAgICAgICAgIlx1MUUyRSI6ICJJIiwKICAgICAgICAgICAgIlx1MUVDOCI6ICJJIiwKICAgICAgICAgICAgIlx1MDFDRiI6ICJJIiwKICAgICAgICAgICAgIlx1MDIwOCI6ICJJIiwKICAgICAgICAgICAgIlx1MDIwQSI6ICJJIiwKICAgICAgICAgICAgIlx1MUVDQSI6ICJJIiwKICAgICAgICAgICAgIlx1MDEyRSI6ICJJIiwKICAgICAgICAgICAgIlx1MUUyQyI6ICJJIiwKICAgICAgICAgICAgIlx1MDE5NyI6ICJJIiwKICAgICAgICAgICAgIlx1MDA0QSI6ICJKIiwKICAgICAgICAgICAgIlx1MjRCRiI6ICJKIiwKICAgICAgICAgICAgIlx1RkYyQSI6ICJKIiwKICAgICAgICAgICAgIlx1MDEzNCI6ICJKIiwKICAgICAgICAgICAgIlx1MDI0OCI6ICJKIiwKICAgICAgICAgICAgIlx1MDA0QiI6ICJLIiwKICAgICAgICAgICAgIlx1MjRDMCI6ICJLIiwKICAgICAgICAgICAgIlx1RkYyQiI6ICJLIiwKICAgICAgICAgICAgIlx1MUUzMCI6ICJLIiwKICAgICAgICAgICAgIlx1MDFFOCI6ICJLIiwKICAgICAgICAgICAgIlx1MUUzMiI6ICJLIiwKICAgICAgICAgICAgIlx1MDEzNiI6ICJLIiwKICAgICAgICAgICAgIlx1MUUzNCI6ICJLIiwKICAgICAgICAgICAgIlx1MDE5OCI6ICJLIiwKICAgICAgICAgICAgIlx1MkM2OSI6ICJLIiwKICAgICAgICAgICAgIlx1QTc0MCI6ICJLIiwKICAgICAgICAgICAgIlx1QTc0MiI6ICJLIiwKICAgICAgICAgICAgIlx1QTc0NCI6ICJLIiwKICAgICAgICAgICAgIlx1QTdBMiI6ICJLIiwKICAgICAgICAgICAgIlx1MDA0QyI6ICJMIiwKICAgICAgICAgICAgIlx1MjRDMSI6ICJMIiwKICAgICAgICAgICAgIlx1RkYyQyI6ICJMIiwKICAgICAgICAgICAgIlx1MDEzRiI6ICJMIiwKICAgICAgICAgICAgIlx1MDEzOSI6ICJMIiwKICAgICAgICAgICAgIlx1MDEzRCI6ICJMIiwKICAgICAgICAgICAgIlx1MUUzNiI6ICJMIiwKICAgICAgICAgICAgIlx1MUUzOCI6ICJMIiwKICAgICAgICAgICAgIlx1MDEzQiI6ICJMIiwKICAgICAgICAgICAgIlx1MUUzQyI6ICJMIiwKICAgICAgICAgICAgIlx1MUUzQSI6ICJMIiwKICAgICAgICAgICAgIlx1MDE0MSI6ICJMIiwKICAgICAgICAgICAgIlx1MDIzRCI6ICJMIiwKICAgICAgICAgICAgIlx1MkM2MiI6ICJMIiwKICAgICAgICAgICAgIlx1MkM2MCI6ICJMIiwKICAgICAgICAgICAgIlx1QTc0OCI6ICJMIiwKICAgICAgICAgICAgIlx1QTc0NiI6ICJMIiwKICAgICAgICAgICAgIlx1QTc4MCI6ICJMIiwKICAgICAgICAgICAgIlx1MDFDNyI6ICJMSiIsCiAgICAgICAgICAgICJcdTAxQzgiOiAiTGoiLAogICAgICAgICAgICAiXHUwMDREIjogIk0iLAogICAgICAgICAgICAiXHUyNEMyIjogIk0iLAogICAgICAgICAgICAiXHVGRjJEIjogIk0iLAogICAgICAgICAgICAiXHUxRTNFIjogIk0iLAogICAgICAgICAgICAiXHUxRTQwIjogIk0iLAogICAgICAgICAgICAiXHUxRTQyIjogIk0iLAogICAgICAgICAgICAiXHUyQzZFIjogIk0iLAogICAgICAgICAgICAiXHUwMTlDIjogIk0iLAogICAgICAgICAgICAiXHUwMDRFIjogIk4iLAogICAgICAgICAgICAiXHUyNEMzIjogIk4iLAogICAgICAgICAgICAiXHVGRjJFIjogIk4iLAogICAgICAgICAgICAiXHUwMUY4IjogIk4iLAogICAgICAgICAgICAiXHUwMTQzIjogIk4iLAogICAgICAgICAgICAiXHUwMEQxIjogIk4iLAogICAgICAgICAgICAiXHUxRTQ0IjogIk4iLAogICAgICAgICAgICAiXHUwMTQ3IjogIk4iLAogICAgICAgICAgICAiXHUxRTQ2IjogIk4iLAogICAgICAgICAgICAiXHUwMTQ1IjogIk4iLAogICAgICAgICAgICAiXHUxRTRBIjogIk4iLAogICAgICAgICAgICAiXHUxRTQ4IjogIk4iLAogICAgICAgICAgICAiXHUwMjIwIjogIk4iLAogICAgICAgICAgICAiXHUwMTlEIjogIk4iLAogICAgICAgICAgICAiXHVBNzkwIjogIk4iLAogICAgICAgICAgICAiXHVBN0E0IjogIk4iLAogICAgICAgICAgICAiXHUwMUNBIjogIk5KIiwKICAgICAgICAgICAgIlx1MDFDQiI6ICJOaiIsCiAgICAgICAgICAgICJcdTAwNEYiOiAiTyIsCiAgICAgICAgICAgICJcdTI0QzQiOiAiTyIsCiAgICAgICAgICAgICJcdUZGMkYiOiAiTyIsCiAgICAgICAgICAgICJcdTAwRDIiOiAiTyIsCiAgICAgICAgICAgICJcdTAwRDMiOiAiTyIsCiAgICAgICAgICAgICJcdTAwRDQiOiAiTyIsCiAgICAgICAgICAgICJcdTFFRDIiOiAiTyIsCiAgICAgICAgICAgICJcdTFFRDAiOiAiTyIsCiAgICAgICAgICAgICJcdTFFRDYiOiAiTyIsCiAgICAgICAgICAgICJcdTFFRDQiOiAiTyIsCiAgICAgICAgICAgICJcdTAwRDUiOiAiTyIsCiAgICAgICAgICAgICJcdTFFNEMiOiAiTyIsCiAgICAgICAgICAgICJcdTAyMkMiOiAiTyIsCiAgICAgICAgICAgICJcdTFFNEUiOiAiTyIsCiAgICAgICAgICAgICJcdTAxNEMiOiAiTyIsCiAgICAgICAgICAgICJcdTFFNTAiOiAiTyIsCiAgICAgICAgICAgICJcdTFFNTIiOiAiTyIsCiAgICAgICAgICAgICJcdTAxNEUiOiAiTyIsCiAgICAgICAgICAgICJcdTAyMkUiOiAiTyIsCiAgICAgICAgICAgICJcdTAyMzAiOiAiTyIsCiAgICAgICAgICAgICJcdTAwRDYiOiAiTyIsCiAgICAgICAgICAgICJcdTAyMkEiOiAiTyIsCiAgICAgICAgICAgICJcdTFFQ0UiOiAiTyIsCiAgICAgICAgICAgICJcdTAxNTAiOiAiTyIsCiAgICAgICAgICAgICJcdTAxRDEiOiAiTyIsCiAgICAgICAgICAgICJcdTAyMEMiOiAiTyIsCiAgICAgICAgICAgICJcdTAyMEUiOiAiTyIsCiAgICAgICAgICAgICJcdTAxQTAiOiAiTyIsCiAgICAgICAgICAgICJcdTFFREMiOiAiTyIsCiAgICAgICAgICAgICJcdTFFREEiOiAiTyIsCiAgICAgICAgICAgICJcdTFFRTAiOiAiTyIsCiAgICAgICAgICAgICJcdTFFREUiOiAiTyIsCiAgICAgICAgICAgICJcdTFFRTIiOiAiTyIsCiAgICAgICAgICAgICJcdTFFQ0MiOiAiTyIsCiAgICAgICAgICAgICJcdTFFRDgiOiAiTyIsCiAgICAgICAgICAgICJcdTAxRUEiOiAiTyIsCiAgICAgICAgICAgICJcdTAxRUMiOiAiTyIsCiAgICAgICAgICAgICJcdTAwRDgiOiAiTyIsCiAgICAgICAgICAgICJcdTAxRkUiOiAiTyIsCiAgICAgICAgICAgICJcdTAxODYiOiAiTyIsCiAgICAgICAgICAgICJcdTAxOUYiOiAiTyIsCiAgICAgICAgICAgICJcdUE3NEEiOiAiTyIsCiAgICAgICAgICAgICJcdUE3NEMiOiAiTyIsCiAgICAgICAgICAgICJcdTAxQTIiOiAiT0kiLAogICAgICAgICAgICAiXHVBNzRFIjogIk9PIiwKICAgICAgICAgICAgIlx1MDIyMiI6ICJPVSIsCiAgICAgICAgICAgICJcdTAwNTAiOiAiUCIsCiAgICAgICAgICAgICJcdTI0QzUiOiAiUCIsCiAgICAgICAgICAgICJcdUZGMzAiOiAiUCIsCiAgICAgICAgICAgICJcdTFFNTQiOiAiUCIsCiAgICAgICAgICAgICJcdTFFNTYiOiAiUCIsCiAgICAgICAgICAgICJcdTAxQTQiOiAiUCIsCiAgICAgICAgICAgICJcdTJDNjMiOiAiUCIsCiAgICAgICAgICAgICJcdUE3NTAiOiAiUCIsCiAgICAgICAgICAgICJcdUE3NTIiOiAiUCIsCiAgICAgICAgICAgICJcdUE3NTQiOiAiUCIsCiAgICAgICAgICAgICJcdTAwNTEiOiAiUSIsCiAgICAgICAgICAgICJcdTI0QzYiOiAiUSIsCiAgICAgICAgICAgICJcdUZGMzEiOiAiUSIsCiAgICAgICAgICAgICJcdUE3NTYiOiAiUSIsCiAgICAgICAgICAgICJcdUE3NTgiOiAiUSIsCiAgICAgICAgICAgICJcdTAyNEEiOiAiUSIsCiAgICAgICAgICAgICJcdTAwNTIiOiAiUiIsCiAgICAgICAgICAgICJcdTI0QzciOiAiUiIsCiAgICAgICAgICAgICJcdUZGMzIiOiAiUiIsCiAgICAgICAgICAgICJcdTAxNTQiOiAiUiIsCiAgICAgICAgICAgICJcdTFFNTgiOiAiUiIsCiAgICAgICAgICAgICJcdTAxNTgiOiAiUiIsCiAgICAgICAgICAgICJcdTAyMTAiOiAiUiIsCiAgICAgICAgICAgICJcdTAyMTIiOiAiUiIsCiAgICAgICAgICAgICJcdTFFNUEiOiAiUiIsCiAgICAgICAgICAgICJcdTFFNUMiOiAiUiIsCiAgICAgICAgICAgICJcdTAxNTYiOiAiUiIsCiAgICAgICAgICAgICJcdTFFNUUiOiAiUiIsCiAgICAgICAgICAgICJcdTAyNEMiOiAiUiIsCiAgICAgICAgICAgICJcdTJDNjQiOiAiUiIsCiAgICAgICAgICAgICJcdUE3NUEiOiAiUiIsCiAgICAgICAgICAgICJcdUE3QTYiOiAiUiIsCiAgICAgICAgICAgICJcdUE3ODIiOiAiUiIsCiAgICAgICAgICAgICJcdTAwNTMiOiAiUyIsCiAgICAgICAgICAgICJcdTI0QzgiOiAiUyIsCiAgICAgICAgICAgICJcdUZGMzMiOiAiUyIsCiAgICAgICAgICAgICJcdTFFOUUiOiAiUyIsCiAgICAgICAgICAgICJcdTAxNUEiOiAiUyIsCiAgICAgICAgICAgICJcdTFFNjQiOiAiUyIsCiAgICAgICAgICAgICJcdTAxNUMiOiAiUyIsCiAgICAgICAgICAgICJcdTFFNjAiOiAiUyIsCiAgICAgICAgICAgICJcdTAxNjAiOiAiUyIsCiAgICAgICAgICAgICJcdTFFNjYiOiAiUyIsCiAgICAgICAgICAgICJcdTFFNjIiOiAiUyIsCiAgICAgICAgICAgICJcdTFFNjgiOiAiUyIsCiAgICAgICAgICAgICJcdTAyMTgiOiAiUyIsCiAgICAgICAgICAgICJcdTAxNUUiOiAiUyIsCiAgICAgICAgICAgICJcdTJDN0UiOiAiUyIsCiAgICAgICAgICAgICJcdUE3QTgiOiAiUyIsCiAgICAgICAgICAgICJcdUE3ODQiOiAiUyIsCiAgICAgICAgICAgICJcdTAwNTQiOiAiVCIsCiAgICAgICAgICAgICJcdTI0QzkiOiAiVCIsCiAgICAgICAgICAgICJcdUZGMzQiOiAiVCIsCiAgICAgICAgICAgICJcdTFFNkEiOiAiVCIsCiAgICAgICAgICAgICJcdTAxNjQiOiAiVCIsCiAgICAgICAgICAgICJcdTFFNkMiOiAiVCIsCiAgICAgICAgICAgICJcdTAyMUEiOiAiVCIsCiAgICAgICAgICAgICJcdTAxNjIiOiAiVCIsCiAgICAgICAgICAgICJcdTFFNzAiOiAiVCIsCiAgICAgICAgICAgICJcdTFFNkUiOiAiVCIsCiAgICAgICAgICAgICJcdTAxNjYiOiAiVCIsCiAgICAgICAgICAgICJcdTAxQUMiOiAiVCIsCiAgICAgICAgICAgICJcdTAxQUUiOiAiVCIsCiAgICAgICAgICAgICJcdTAyM0UiOiAiVCIsCiAgICAgICAgICAgICJcdUE3ODYiOiAiVCIsCiAgICAgICAgICAgICJcdUE3MjgiOiAiVFoiLAogICAgICAgICAgICAiXHUwMDU1IjogIlUiLAogICAgICAgICAgICAiXHUyNENBIjogIlUiLAogICAgICAgICAgICAiXHVGRjM1IjogIlUiLAogICAgICAgICAgICAiXHUwMEQ5IjogIlUiLAogICAgICAgICAgICAiXHUwMERBIjogIlUiLAogICAgICAgICAgICAiXHUwMERCIjogIlUiLAogICAgICAgICAgICAiXHUwMTY4IjogIlUiLAogICAgICAgICAgICAiXHUxRTc4IjogIlUiLAogICAgICAgICAgICAiXHUwMTZBIjogIlUiLAogICAgICAgICAgICAiXHUxRTdBIjogIlUiLAogICAgICAgICAgICAiXHUwMTZDIjogIlUiLAogICAgICAgICAgICAiXHUwMERDIjogIlUiLAogICAgICAgICAgICAiXHUwMURCIjogIlUiLAogICAgICAgICAgICAiXHUwMUQ3IjogIlUiLAogICAgICAgICAgICAiXHUwMUQ1IjogIlUiLAogICAgICAgICAgICAiXHUwMUQ5IjogIlUiLAogICAgICAgICAgICAiXHUxRUU2IjogIlUiLAogICAgICAgICAgICAiXHUwMTZFIjogIlUiLAogICAgICAgICAgICAiXHUwMTcwIjogIlUiLAogICAgICAgICAgICAiXHUwMUQzIjogIlUiLAogICAgICAgICAgICAiXHUwMjE0IjogIlUiLAogICAgICAgICAgICAiXHUwMjE2IjogIlUiLAogICAgICAgICAgICAiXHUwMUFGIjogIlUiLAogICAgICAgICAgICAiXHUxRUVBIjogIlUiLAogICAgICAgICAgICAiXHUxRUU4IjogIlUiLAogICAgICAgICAgICAiXHUxRUVFIjogIlUiLAogICAgICAgICAgICAiXHUxRUVDIjogIlUiLAogICAgICAgICAgICAiXHUxRUYwIjogIlUiLAogICAgICAgICAgICAiXHUxRUU0IjogIlUiLAogICAgICAgICAgICAiXHUxRTcyIjogIlUiLAogICAgICAgICAgICAiXHUwMTcyIjogIlUiLAogICAgICAgICAgICAiXHUxRTc2IjogIlUiLAogICAgICAgICAgICAiXHUxRTc0IjogIlUiLAogICAgICAgICAgICAiXHUwMjQ0IjogIlUiLAogICAgICAgICAgICAiXHUwMDU2IjogIlYiLAogICAgICAgICAgICAiXHUyNENCIjogIlYiLAogICAgICAgICAgICAiXHVGRjM2IjogIlYiLAogICAgICAgICAgICAiXHUxRTdDIjogIlYiLAogICAgICAgICAgICAiXHUxRTdFIjogIlYiLAogICAgICAgICAgICAiXHUwMUIyIjogIlYiLAogICAgICAgICAgICAiXHVBNzVFIjogIlYiLAogICAgICAgICAgICAiXHUwMjQ1IjogIlYiLAogICAgICAgICAgICAiXHVBNzYwIjogIlZZIiwKICAgICAgICAgICAgIlx1MDA1NyI6ICJXIiwKICAgICAgICAgICAgIlx1MjRDQyI6ICJXIiwKICAgICAgICAgICAgIlx1RkYzNyI6ICJXIiwKICAgICAgICAgICAgIlx1MUU4MCI6ICJXIiwKICAgICAgICAgICAgIlx1MUU4MiI6ICJXIiwKICAgICAgICAgICAgIlx1MDE3NCI6ICJXIiwKICAgICAgICAgICAgIlx1MUU4NiI6ICJXIiwKICAgICAgICAgICAgIlx1MUU4NCI6ICJXIiwKICAgICAgICAgICAgIlx1MUU4OCI6ICJXIiwKICAgICAgICAgICAgIlx1MkM3MiI6ICJXIiwKICAgICAgICAgICAgIlx1MDA1OCI6ICJYIiwKICAgICAgICAgICAgIlx1MjRDRCI6ICJYIiwKICAgICAgICAgICAgIlx1RkYzOCI6ICJYIiwKICAgICAgICAgICAgIlx1MUU4QSI6ICJYIiwKICAgICAgICAgICAgIlx1MUU4QyI6ICJYIiwKICAgICAgICAgICAgIlx1MDA1OSI6ICJZIiwKICAgICAgICAgICAgIlx1MjRDRSI6ICJZIiwKICAgICAgICAgICAgIlx1RkYzOSI6ICJZIiwKICAgICAgICAgICAgIlx1MUVGMiI6ICJZIiwKICAgICAgICAgICAgIlx1MDBERCI6ICJZIiwKICAgICAgICAgICAgIlx1MDE3NiI6ICJZIiwKICAgICAgICAgICAgIlx1MUVGOCI6ICJZIiwKICAgICAgICAgICAgIlx1MDIzMiI6ICJZIiwKICAgICAgICAgICAgIlx1MUU4RSI6ICJZIiwKICAgICAgICAgICAgIlx1MDE3OCI6ICJZIiwKICAgICAgICAgICAgIlx1MUVGNiI6ICJZIiwKICAgICAgICAgICAgIlx1MUVGNCI6ICJZIiwKICAgICAgICAgICAgIlx1MDFCMyI6ICJZIiwKICAgICAgICAgICAgIlx1MDI0RSI6ICJZIiwKICAgICAgICAgICAgIlx1MUVGRSI6ICJZIiwKICAgICAgICAgICAgIlx1MDA1QSI6ICJaIiwKICAgICAgICAgICAgIlx1MjRDRiI6ICJaIiwKICAgICAgICAgICAgIlx1RkYzQSI6ICJaIiwKICAgICAgICAgICAgIlx1MDE3OSI6ICJaIiwKICAgICAgICAgICAgIlx1MUU5MCI6ICJaIiwKICAgICAgICAgICAgIlx1MDE3QiI6ICJaIiwKICAgICAgICAgICAgIlx1MDE3RCI6ICJaIiwKICAgICAgICAgICAgIlx1MUU5MiI6ICJaIiwKICAgICAgICAgICAgIlx1MUU5NCI6ICJaIiwKICAgICAgICAgICAgIlx1MDFCNSI6ICJaIiwKICAgICAgICAgICAgIlx1MDIyNCI6ICJaIiwKICAgICAgICAgICAgIlx1MkM3RiI6ICJaIiwKICAgICAgICAgICAgIlx1MkM2QiI6ICJaIiwKICAgICAgICAgICAgIlx1QTc2MiI6ICJaIiwKICAgICAgICAgICAgIlx1MDA2MSI6ICJhIiwKICAgICAgICAgICAgIlx1MjREMCI6ICJhIiwKICAgICAgICAgICAgIlx1RkY0MSI6ICJhIiwKICAgICAgICAgICAgIlx1MUU5QSI6ICJhIiwKICAgICAgICAgICAgIlx1MDBFMCI6ICJhIiwKICAgICAgICAgICAgIlx1MDBFMSI6ICJhIiwKICAgICAgICAgICAgIlx1MDBFMiI6ICJhIiwKICAgICAgICAgICAgIlx1MUVBNyI6ICJhIiwKICAgICAgICAgICAgIlx1MUVBNSI6ICJhIiwKICAgICAgICAgICAgIlx1MUVBQiI6ICJhIiwKICAgICAgICAgICAgIlx1MUVBOSI6ICJhIiwKICAgICAgICAgICAgIlx1MDBFMyI6ICJhIiwKICAgICAgICAgICAgIlx1MDEwMSI6ICJhIiwKICAgICAgICAgICAgIlx1MDEwMyI6ICJhIiwKICAgICAgICAgICAgIlx1MUVCMSI6ICJhIiwKICAgICAgICAgICAgIlx1MUVBRiI6ICJhIiwKICAgICAgICAgICAgIlx1MUVCNSI6ICJhIiwKICAgICAgICAgICAgIlx1MUVCMyI6ICJhIiwKICAgICAgICAgICAgIlx1MDIyNyI6ICJhIiwKICAgICAgICAgICAgIlx1MDFFMSI6ICJhIiwKICAgICAgICAgICAgIlx1MDBFNCI6ICJhIiwKICAgICAgICAgICAgIlx1MDFERiI6ICJhIiwKICAgICAgICAgICAgIlx1MUVBMyI6ICJhIiwKICAgICAgICAgICAgIlx1MDBFNSI6ICJhIiwKICAgICAgICAgICAgIlx1MDFGQiI6ICJhIiwKICAgICAgICAgICAgIlx1MDFDRSI6ICJhIiwKICAgICAgICAgICAgIlx1MDIwMSI6ICJhIiwKICAgICAgICAgICAgIlx1MDIwMyI6ICJhIiwKICAgICAgICAgICAgIlx1MUVBMSI6ICJhIiwKICAgICAgICAgICAgIlx1MUVBRCI6ICJhIiwKICAgICAgICAgICAgIlx1MUVCNyI6ICJhIiwKICAgICAgICAgICAgIlx1MUUwMSI6ICJhIiwKICAgICAgICAgICAgIlx1MDEwNSI6ICJhIiwKICAgICAgICAgICAgIlx1MkM2NSI6ICJhIiwKICAgICAgICAgICAgIlx1MDI1MCI6ICJhIiwKICAgICAgICAgICAgIlx1QTczMyI6ICJhYSIsCiAgICAgICAgICAgICJcdTAwRTYiOiAiYWUiLAogICAgICAgICAgICAiXHUwMUZEIjogImFlIiwKICAgICAgICAgICAgIlx1MDFFMyI6ICJhZSIsCiAgICAgICAgICAgICJcdUE3MzUiOiAiYW8iLAogICAgICAgICAgICAiXHVBNzM3IjogImF1IiwKICAgICAgICAgICAgIlx1QTczOSI6ICJhdiIsCiAgICAgICAgICAgICJcdUE3M0IiOiAiYXYiLAogICAgICAgICAgICAiXHVBNzNEIjogImF5IiwKICAgICAgICAgICAgIlx1MDA2MiI6ICJiIiwKICAgICAgICAgICAgIlx1MjREMSI6ICJiIiwKICAgICAgICAgICAgIlx1RkY0MiI6ICJiIiwKICAgICAgICAgICAgIlx1MUUwMyI6ICJiIiwKICAgICAgICAgICAgIlx1MUUwNSI6ICJiIiwKICAgICAgICAgICAgIlx1MUUwNyI6ICJiIiwKICAgICAgICAgICAgIlx1MDE4MCI6ICJiIiwKICAgICAgICAgICAgIlx1MDE4MyI6ICJiIiwKICAgICAgICAgICAgIlx1MDI1MyI6ICJiIiwKICAgICAgICAgICAgIlx1MDA2MyI6ICJjIiwKICAgICAgICAgICAgIlx1MjREMiI6ICJjIiwKICAgICAgICAgICAgIlx1RkY0MyI6ICJjIiwKICAgICAgICAgICAgIlx1MDEwNyI6ICJjIiwKICAgICAgICAgICAgIlx1MDEwOSI6ICJjIiwKICAgICAgICAgICAgIlx1MDEwQiI6ICJjIiwKICAgICAgICAgICAgIlx1MDEwRCI6ICJjIiwKICAgICAgICAgICAgIlx1MDBFNyI6ICJjIiwKICAgICAgICAgICAgIlx1MUUwOSI6ICJjIiwKICAgICAgICAgICAgIlx1MDE4OCI6ICJjIiwKICAgICAgICAgICAgIlx1MDIzQyI6ICJjIiwKICAgICAgICAgICAgIlx1QTczRiI6ICJjIiwKICAgICAgICAgICAgIlx1MjE4NCI6ICJjIiwKICAgICAgICAgICAgIlx1MDA2NCI6ICJkIiwKICAgICAgICAgICAgIlx1MjREMyI6ICJkIiwKICAgICAgICAgICAgIlx1RkY0NCI6ICJkIiwKICAgICAgICAgICAgIlx1MUUwQiI6ICJkIiwKICAgICAgICAgICAgIlx1MDEwRiI6ICJkIiwKICAgICAgICAgICAgIlx1MUUwRCI6ICJkIiwKICAgICAgICAgICAgIlx1MUUxMSI6ICJkIiwKICAgICAgICAgICAgIlx1MUUxMyI6ICJkIiwKICAgICAgICAgICAgIlx1MUUwRiI6ICJkIiwKICAgICAgICAgICAgIlx1MDExMSI6ICJkIiwKICAgICAgICAgICAgIlx1MDE4QyI6ICJkIiwKICAgICAgICAgICAgIlx1MDI1NiI6ICJkIiwKICAgICAgICAgICAgIlx1MDI1NyI6ICJkIiwKICAgICAgICAgICAgIlx1QTc3QSI6ICJkIiwKICAgICAgICAgICAgIlx1MDFGMyI6ICJkeiIsCiAgICAgICAgICAgICJcdTAxQzYiOiAiZHoiLAogICAgICAgICAgICAiXHUwMDY1IjogImUiLAogICAgICAgICAgICAiXHUyNEQ0IjogImUiLAogICAgICAgICAgICAiXHVGRjQ1IjogImUiLAogICAgICAgICAgICAiXHUwMEU4IjogImUiLAogICAgICAgICAgICAiXHUwMEU5IjogImUiLAogICAgICAgICAgICAiXHUwMEVBIjogImUiLAogICAgICAgICAgICAiXHUxRUMxIjogImUiLAogICAgICAgICAgICAiXHUxRUJGIjogImUiLAogICAgICAgICAgICAiXHUxRUM1IjogImUiLAogICAgICAgICAgICAiXHUxRUMzIjogImUiLAogICAgICAgICAgICAiXHUxRUJEIjogImUiLAogICAgICAgICAgICAiXHUwMTEzIjogImUiLAogICAgICAgICAgICAiXHUxRTE1IjogImUiLAogICAgICAgICAgICAiXHUxRTE3IjogImUiLAogICAgICAgICAgICAiXHUwMTE1IjogImUiLAogICAgICAgICAgICAiXHUwMTE3IjogImUiLAogICAgICAgICAgICAiXHUwMEVCIjogImUiLAogICAgICAgICAgICAiXHUxRUJCIjogImUiLAogICAgICAgICAgICAiXHUwMTFCIjogImUiLAogICAgICAgICAgICAiXHUwMjA1IjogImUiLAogICAgICAgICAgICAiXHUwMjA3IjogImUiLAogICAgICAgICAgICAiXHUxRUI5IjogImUiLAogICAgICAgICAgICAiXHUxRUM3IjogImUiLAogICAgICAgICAgICAiXHUwMjI5IjogImUiLAogICAgICAgICAgICAiXHUxRTFEIjogImUiLAogICAgICAgICAgICAiXHUwMTE5IjogImUiLAogICAgICAgICAgICAiXHUxRTE5IjogImUiLAogICAgICAgICAgICAiXHUxRTFCIjogImUiLAogICAgICAgICAgICAiXHUwMjQ3IjogImUiLAogICAgICAgICAgICAiXHUwMjVCIjogImUiLAogICAgICAgICAgICAiXHUwMUREIjogImUiLAogICAgICAgICAgICAiXHUwMDY2IjogImYiLAogICAgICAgICAgICAiXHUyNEQ1IjogImYiLAogICAgICAgICAgICAiXHVGRjQ2IjogImYiLAogICAgICAgICAgICAiXHUxRTFGIjogImYiLAogICAgICAgICAgICAiXHUwMTkyIjogImYiLAogICAgICAgICAgICAiXHVBNzdDIjogImYiLAogICAgICAgICAgICAiXHUwMDY3IjogImciLAogICAgICAgICAgICAiXHUyNEQ2IjogImciLAogICAgICAgICAgICAiXHVGRjQ3IjogImciLAogICAgICAgICAgICAiXHUwMUY1IjogImciLAogICAgICAgICAgICAiXHUwMTFEIjogImciLAogICAgICAgICAgICAiXHUxRTIxIjogImciLAogICAgICAgICAgICAiXHUwMTFGIjogImciLAogICAgICAgICAgICAiXHUwMTIxIjogImciLAogICAgICAgICAgICAiXHUwMUU3IjogImciLAogICAgICAgICAgICAiXHUwMTIzIjogImciLAogICAgICAgICAgICAiXHUwMUU1IjogImciLAogICAgICAgICAgICAiXHUwMjYwIjogImciLAogICAgICAgICAgICAiXHVBN0ExIjogImciLAogICAgICAgICAgICAiXHUxRDc5IjogImciLAogICAgICAgICAgICAiXHVBNzdGIjogImciLAogICAgICAgICAgICAiXHUwMDY4IjogImgiLAogICAgICAgICAgICAiXHUyNEQ3IjogImgiLAogICAgICAgICAgICAiXHVGRjQ4IjogImgiLAogICAgICAgICAgICAiXHUwMTI1IjogImgiLAogICAgICAgICAgICAiXHUxRTIzIjogImgiLAogICAgICAgICAgICAiXHUxRTI3IjogImgiLAogICAgICAgICAgICAiXHUwMjFGIjogImgiLAogICAgICAgICAgICAiXHUxRTI1IjogImgiLAogICAgICAgICAgICAiXHUxRTI5IjogImgiLAogICAgICAgICAgICAiXHUxRTJCIjogImgiLAogICAgICAgICAgICAiXHUxRTk2IjogImgiLAogICAgICAgICAgICAiXHUwMTI3IjogImgiLAogICAgICAgICAgICAiXHUyQzY4IjogImgiLAogICAgICAgICAgICAiXHUyQzc2IjogImgiLAogICAgICAgICAgICAiXHUwMjY1IjogImgiLAogICAgICAgICAgICAiXHUwMTk1IjogImh2IiwKICAgICAgICAgICAgIlx1MDA2OSI6ICJpIiwKICAgICAgICAgICAgIlx1MjREOCI6ICJpIiwKICAgICAgICAgICAgIlx1RkY0OSI6ICJpIiwKICAgICAgICAgICAgIlx1MDBFQyI6ICJpIiwKICAgICAgICAgICAgIlx1MDBFRCI6ICJpIiwKICAgICAgICAgICAgIlx1MDBFRSI6ICJpIiwKICAgICAgICAgICAgIlx1MDEyOSI6ICJpIiwKICAgICAgICAgICAgIlx1MDEyQiI6ICJpIiwKICAgICAgICAgICAgIlx1MDEyRCI6ICJpIiwKICAgICAgICAgICAgIlx1MDBFRiI6ICJpIiwKICAgICAgICAgICAgIlx1MUUyRiI6ICJpIiwKICAgICAgICAgICAgIlx1MUVDOSI6ICJpIiwKICAgICAgICAgICAgIlx1MDFEMCI6ICJpIiwKICAgICAgICAgICAgIlx1MDIwOSI6ICJpIiwKICAgICAgICAgICAgIlx1MDIwQiI6ICJpIiwKICAgICAgICAgICAgIlx1MUVDQiI6ICJpIiwKICAgICAgICAgICAgIlx1MDEyRiI6ICJpIiwKICAgICAgICAgICAgIlx1MUUyRCI6ICJpIiwKICAgICAgICAgICAgIlx1MDI2OCI6ICJpIiwKICAgICAgICAgICAgIlx1MDEzMSI6ICJpIiwKICAgICAgICAgICAgIlx1MDA2QSI6ICJqIiwKICAgICAgICAgICAgIlx1MjREOSI6ICJqIiwKICAgICAgICAgICAgIlx1RkY0QSI6ICJqIiwKICAgICAgICAgICAgIlx1MDEzNSI6ICJqIiwKICAgICAgICAgICAgIlx1MDFGMCI6ICJqIiwKICAgICAgICAgICAgIlx1MDI0OSI6ICJqIiwKICAgICAgICAgICAgIlx1MDA2QiI6ICJrIiwKICAgICAgICAgICAgIlx1MjREQSI6ICJrIiwKICAgICAgICAgICAgIlx1RkY0QiI6ICJrIiwKICAgICAgICAgICAgIlx1MUUzMSI6ICJrIiwKICAgICAgICAgICAgIlx1MDFFOSI6ICJrIiwKICAgICAgICAgICAgIlx1MUUzMyI6ICJrIiwKICAgICAgICAgICAgIlx1MDEzNyI6ICJrIiwKICAgICAgICAgICAgIlx1MUUzNSI6ICJrIiwKICAgICAgICAgICAgIlx1MDE5OSI6ICJrIiwKICAgICAgICAgICAgIlx1MkM2QSI6ICJrIiwKICAgICAgICAgICAgIlx1QTc0MSI6ICJrIiwKICAgICAgICAgICAgIlx1QTc0MyI6ICJrIiwKICAgICAgICAgICAgIlx1QTc0NSI6ICJrIiwKICAgICAgICAgICAgIlx1QTdBMyI6ICJrIiwKICAgICAgICAgICAgIlx1MDA2QyI6ICJsIiwKICAgICAgICAgICAgIlx1MjREQiI6ICJsIiwKICAgICAgICAgICAgIlx1RkY0QyI6ICJsIiwKICAgICAgICAgICAgIlx1MDE0MCI6ICJsIiwKICAgICAgICAgICAgIlx1MDEzQSI6ICJsIiwKICAgICAgICAgICAgIlx1MDEzRSI6ICJsIiwKICAgICAgICAgICAgIlx1MUUzNyI6ICJsIiwKICAgICAgICAgICAgIlx1MUUzOSI6ICJsIiwKICAgICAgICAgICAgIlx1MDEzQyI6ICJsIiwKICAgICAgICAgICAgIlx1MUUzRCI6ICJsIiwKICAgICAgICAgICAgIlx1MUUzQiI6ICJsIiwKICAgICAgICAgICAgIlx1MDE3RiI6ICJsIiwKICAgICAgICAgICAgIlx1MDE0MiI6ICJsIiwKICAgICAgICAgICAgIlx1MDE5QSI6ICJsIiwKICAgICAgICAgICAgIlx1MDI2QiI6ICJsIiwKICAgICAgICAgICAgIlx1MkM2MSI6ICJsIiwKICAgICAgICAgICAgIlx1QTc0OSI6ICJsIiwKICAgICAgICAgICAgIlx1QTc4MSI6ICJsIiwKICAgICAgICAgICAgIlx1QTc0NyI6ICJsIiwKICAgICAgICAgICAgIlx1MDFDOSI6ICJsaiIsCiAgICAgICAgICAgICJcdTAwNkQiOiAibSIsCiAgICAgICAgICAgICJcdTI0REMiOiAibSIsCiAgICAgICAgICAgICJcdUZGNEQiOiAibSIsCiAgICAgICAgICAgICJcdTFFM0YiOiAibSIsCiAgICAgICAgICAgICJcdTFFNDEiOiAibSIsCiAgICAgICAgICAgICJcdTFFNDMiOiAibSIsCiAgICAgICAgICAgICJcdTAyNzEiOiAibSIsCiAgICAgICAgICAgICJcdTAyNkYiOiAibSIsCiAgICAgICAgICAgICJcdTAwNkUiOiAibiIsCiAgICAgICAgICAgICJcdTI0REQiOiAibiIsCiAgICAgICAgICAgICJcdUZGNEUiOiAibiIsCiAgICAgICAgICAgICJcdTAxRjkiOiAibiIsCiAgICAgICAgICAgICJcdTAxNDQiOiAibiIsCiAgICAgICAgICAgICJcdTAwRjEiOiAibiIsCiAgICAgICAgICAgICJcdTFFNDUiOiAibiIsCiAgICAgICAgICAgICJcdTAxNDgiOiAibiIsCiAgICAgICAgICAgICJcdTFFNDciOiAibiIsCiAgICAgICAgICAgICJcdTAxNDYiOiAibiIsCiAgICAgICAgICAgICJcdTFFNEIiOiAibiIsCiAgICAgICAgICAgICJcdTFFNDkiOiAibiIsCiAgICAgICAgICAgICJcdTAxOUUiOiAibiIsCiAgICAgICAgICAgICJcdTAyNzIiOiAibiIsCiAgICAgICAgICAgICJcdTAxNDkiOiAibiIsCiAgICAgICAgICAgICJcdUE3OTEiOiAibiIsCiAgICAgICAgICAgICJcdUE3QTUiOiAibiIsCiAgICAgICAgICAgICJcdTAxQ0MiOiAibmoiLAogICAgICAgICAgICAiXHUwMDZGIjogIm8iLAogICAgICAgICAgICAiXHUyNERFIjogIm8iLAogICAgICAgICAgICAiXHVGRjRGIjogIm8iLAogICAgICAgICAgICAiXHUwMEYyIjogIm8iLAogICAgICAgICAgICAiXHUwMEYzIjogIm8iLAogICAgICAgICAgICAiXHUwMEY0IjogIm8iLAogICAgICAgICAgICAiXHUxRUQzIjogIm8iLAogICAgICAgICAgICAiXHUxRUQxIjogIm8iLAogICAgICAgICAgICAiXHUxRUQ3IjogIm8iLAogICAgICAgICAgICAiXHUxRUQ1IjogIm8iLAogICAgICAgICAgICAiXHUwMEY1IjogIm8iLAogICAgICAgICAgICAiXHUxRTREIjogIm8iLAogICAgICAgICAgICAiXHUwMjJEIjogIm8iLAogICAgICAgICAgICAiXHUxRTRGIjogIm8iLAogICAgICAgICAgICAiXHUwMTREIjogIm8iLAogICAgICAgICAgICAiXHUxRTUxIjogIm8iLAogICAgICAgICAgICAiXHUxRTUzIjogIm8iLAogICAgICAgICAgICAiXHUwMTRGIjogIm8iLAogICAgICAgICAgICAiXHUwMjJGIjogIm8iLAogICAgICAgICAgICAiXHUwMjMxIjogIm8iLAogICAgICAgICAgICAiXHUwMEY2IjogIm8iLAogICAgICAgICAgICAiXHUwMjJCIjogIm8iLAogICAgICAgICAgICAiXHUxRUNGIjogIm8iLAogICAgICAgICAgICAiXHUwMTUxIjogIm8iLAogICAgICAgICAgICAiXHUwMUQyIjogIm8iLAogICAgICAgICAgICAiXHUwMjBEIjogIm8iLAogICAgICAgICAgICAiXHUwMjBGIjogIm8iLAogICAgICAgICAgICAiXHUwMUExIjogIm8iLAogICAgICAgICAgICAiXHUxRUREIjogIm8iLAogICAgICAgICAgICAiXHUxRURCIjogIm8iLAogICAgICAgICAgICAiXHUxRUUxIjogIm8iLAogICAgICAgICAgICAiXHUxRURGIjogIm8iLAogICAgICAgICAgICAiXHUxRUUzIjogIm8iLAogICAgICAgICAgICAiXHUxRUNEIjogIm8iLAogICAgICAgICAgICAiXHUxRUQ5IjogIm8iLAogICAgICAgICAgICAiXHUwMUVCIjogIm8iLAogICAgICAgICAgICAiXHUwMUVEIjogIm8iLAogICAgICAgICAgICAiXHUwMEY4IjogIm8iLAogICAgICAgICAgICAiXHUwMUZGIjogIm8iLAogICAgICAgICAgICAiXHUwMjU0IjogIm8iLAogICAgICAgICAgICAiXHVBNzRCIjogIm8iLAogICAgICAgICAgICAiXHVBNzREIjogIm8iLAogICAgICAgICAgICAiXHUwMjc1IjogIm8iLAogICAgICAgICAgICAiXHUwMUEzIjogIm9pIiwKICAgICAgICAgICAgIlx1MDIyMyI6ICJvdSIsCiAgICAgICAgICAgICJcdUE3NEYiOiAib28iLAogICAgICAgICAgICAiXHUwMDcwIjogInAiLAogICAgICAgICAgICAiXHUyNERGIjogInAiLAogICAgICAgICAgICAiXHVGRjUwIjogInAiLAogICAgICAgICAgICAiXHUxRTU1IjogInAiLAogICAgICAgICAgICAiXHUxRTU3IjogInAiLAogICAgICAgICAgICAiXHUwMUE1IjogInAiLAogICAgICAgICAgICAiXHUxRDdEIjogInAiLAogICAgICAgICAgICAiXHVBNzUxIjogInAiLAogICAgICAgICAgICAiXHVBNzUzIjogInAiLAogICAgICAgICAgICAiXHVBNzU1IjogInAiLAogICAgICAgICAgICAiXHUwMDcxIjogInEiLAogICAgICAgICAgICAiXHUyNEUwIjogInEiLAogICAgICAgICAgICAiXHVGRjUxIjogInEiLAogICAgICAgICAgICAiXHUwMjRCIjogInEiLAogICAgICAgICAgICAiXHVBNzU3IjogInEiLAogICAgICAgICAgICAiXHVBNzU5IjogInEiLAogICAgICAgICAgICAiXHUwMDcyIjogInIiLAogICAgICAgICAgICAiXHUyNEUxIjogInIiLAogICAgICAgICAgICAiXHVGRjUyIjogInIiLAogICAgICAgICAgICAiXHUwMTU1IjogInIiLAogICAgICAgICAgICAiXHUxRTU5IjogInIiLAogICAgICAgICAgICAiXHUwMTU5IjogInIiLAogICAgICAgICAgICAiXHUwMjExIjogInIiLAogICAgICAgICAgICAiXHUwMjEzIjogInIiLAogICAgICAgICAgICAiXHUxRTVCIjogInIiLAogICAgICAgICAgICAiXHUxRTVEIjogInIiLAogICAgICAgICAgICAiXHUwMTU3IjogInIiLAogICAgICAgICAgICAiXHUxRTVGIjogInIiLAogICAgICAgICAgICAiXHUwMjREIjogInIiLAogICAgICAgICAgICAiXHUwMjdEIjogInIiLAogICAgICAgICAgICAiXHVBNzVCIjogInIiLAogICAgICAgICAgICAiXHVBN0E3IjogInIiLAogICAgICAgICAgICAiXHVBNzgzIjogInIiLAogICAgICAgICAgICAiXHUwMDczIjogInMiLAogICAgICAgICAgICAiXHUyNEUyIjogInMiLAogICAgICAgICAgICAiXHVGRjUzIjogInMiLAogICAgICAgICAgICAiXHUwMERGIjogInMiLAogICAgICAgICAgICAiXHUwMTVCIjogInMiLAogICAgICAgICAgICAiXHUxRTY1IjogInMiLAogICAgICAgICAgICAiXHUwMTVEIjogInMiLAogICAgICAgICAgICAiXHUxRTYxIjogInMiLAogICAgICAgICAgICAiXHUwMTYxIjogInMiLAogICAgICAgICAgICAiXHUxRTY3IjogInMiLAogICAgICAgICAgICAiXHUxRTYzIjogInMiLAogICAgICAgICAgICAiXHUxRTY5IjogInMiLAogICAgICAgICAgICAiXHUwMjE5IjogInMiLAogICAgICAgICAgICAiXHUwMTVGIjogInMiLAogICAgICAgICAgICAiXHUwMjNGIjogInMiLAogICAgICAgICAgICAiXHVBN0E5IjogInMiLAogICAgICAgICAgICAiXHVBNzg1IjogInMiLAogICAgICAgICAgICAiXHUxRTlCIjogInMiLAogICAgICAgICAgICAiXHUwMDc0IjogInQiLAogICAgICAgICAgICAiXHUyNEUzIjogInQiLAogICAgICAgICAgICAiXHVGRjU0IjogInQiLAogICAgICAgICAgICAiXHUxRTZCIjogInQiLAogICAgICAgICAgICAiXHUxRTk3IjogInQiLAogICAgICAgICAgICAiXHUwMTY1IjogInQiLAogICAgICAgICAgICAiXHUxRTZEIjogInQiLAogICAgICAgICAgICAiXHUwMjFCIjogInQiLAogICAgICAgICAgICAiXHUwMTYzIjogInQiLAogICAgICAgICAgICAiXHUxRTcxIjogInQiLAogICAgICAgICAgICAiXHUxRTZGIjogInQiLAogICAgICAgICAgICAiXHUwMTY3IjogInQiLAogICAgICAgICAgICAiXHUwMUFEIjogInQiLAogICAgICAgICAgICAiXHUwMjg4IjogInQiLAogICAgICAgICAgICAiXHUyQzY2IjogInQiLAogICAgICAgICAgICAiXHVBNzg3IjogInQiLAogICAgICAgICAgICAiXHVBNzI5IjogInR6IiwKICAgICAgICAgICAgIlx1MDA3NSI6ICJ1IiwKICAgICAgICAgICAgIlx1MjRFNCI6ICJ1IiwKICAgICAgICAgICAgIlx1RkY1NSI6ICJ1IiwKICAgICAgICAgICAgIlx1MDBGOSI6ICJ1IiwKICAgICAgICAgICAgIlx1MDBGQSI6ICJ1IiwKICAgICAgICAgICAgIlx1MDBGQiI6ICJ1IiwKICAgICAgICAgICAgIlx1MDE2OSI6ICJ1IiwKICAgICAgICAgICAgIlx1MUU3OSI6ICJ1IiwKICAgICAgICAgICAgIlx1MDE2QiI6ICJ1IiwKICAgICAgICAgICAgIlx1MUU3QiI6ICJ1IiwKICAgICAgICAgICAgIlx1MDE2RCI6ICJ1IiwKICAgICAgICAgICAgIlx1MDBGQyI6ICJ1IiwKICAgICAgICAgICAgIlx1MDFEQyI6ICJ1IiwKICAgICAgICAgICAgIlx1MDFEOCI6ICJ1IiwKICAgICAgICAgICAgIlx1MDFENiI6ICJ1IiwKICAgICAgICAgICAgIlx1MDFEQSI6ICJ1IiwKICAgICAgICAgICAgIlx1MUVFNyI6ICJ1IiwKICAgICAgICAgICAgIlx1MDE2RiI6ICJ1IiwKICAgICAgICAgICAgIlx1MDE3MSI6ICJ1IiwKICAgICAgICAgICAgIlx1MDFENCI6ICJ1IiwKICAgICAgICAgICAgIlx1MDIxNSI6ICJ1IiwKICAgICAgICAgICAgIlx1MDIxNyI6ICJ1IiwKICAgICAgICAgICAgIlx1MDFCMCI6ICJ1IiwKICAgICAgICAgICAgIlx1MUVFQiI6ICJ1IiwKICAgICAgICAgICAgIlx1MUVFOSI6ICJ1IiwKICAgICAgICAgICAgIlx1MUVFRiI6ICJ1IiwKICAgICAgICAgICAgIlx1MUVFRCI6ICJ1IiwKICAgICAgICAgICAgIlx1MUVGMSI6ICJ1IiwKICAgICAgICAgICAgIlx1MUVFNSI6ICJ1IiwKICAgICAgICAgICAgIlx1MUU3MyI6ICJ1IiwKICAgICAgICAgICAgIlx1MDE3MyI6ICJ1IiwKICAgICAgICAgICAgIlx1MUU3NyI6ICJ1IiwKICAgICAgICAgICAgIlx1MUU3NSI6ICJ1IiwKICAgICAgICAgICAgIlx1MDI4OSI6ICJ1IiwKICAgICAgICAgICAgIlx1MDA3NiI6ICJ2IiwKICAgICAgICAgICAgIlx1MjRFNSI6ICJ2IiwKICAgICAgICAgICAgIlx1RkY1NiI6ICJ2IiwKICAgICAgICAgICAgIlx1MUU3RCI6ICJ2IiwKICAgICAgICAgICAgIlx1MUU3RiI6ICJ2IiwKICAgICAgICAgICAgIlx1MDI4QiI6ICJ2IiwKICAgICAgICAgICAgIlx1QTc1RiI6ICJ2IiwKICAgICAgICAgICAgIlx1MDI4QyI6ICJ2IiwKICAgICAgICAgICAgIlx1QTc2MSI6ICJ2eSIsCiAgICAgICAgICAgICJcdTAwNzciOiAidyIsCiAgICAgICAgICAgICJcdTI0RTYiOiAidyIsCiAgICAgICAgICAgICJcdUZGNTciOiAidyIsCiAgICAgICAgICAgICJcdTFFODEiOiAidyIsCiAgICAgICAgICAgICJcdTFFODMiOiAidyIsCiAgICAgICAgICAgICJcdTAxNzUiOiAidyIsCiAgICAgICAgICAgICJcdTFFODciOiAidyIsCiAgICAgICAgICAgICJcdTFFODUiOiAidyIsCiAgICAgICAgICAgICJcdTFFOTgiOiAidyIsCiAgICAgICAgICAgICJcdTFFODkiOiAidyIsCiAgICAgICAgICAgICJcdTJDNzMiOiAidyIsCiAgICAgICAgICAgICJcdTAwNzgiOiAieCIsCiAgICAgICAgICAgICJcdTI0RTciOiAieCIsCiAgICAgICAgICAgICJcdUZGNTgiOiAieCIsCiAgICAgICAgICAgICJcdTFFOEIiOiAieCIsCiAgICAgICAgICAgICJcdTFFOEQiOiAieCIsCiAgICAgICAgICAgICJcdTAwNzkiOiAieSIsCiAgICAgICAgICAgICJcdTI0RTgiOiAieSIsCiAgICAgICAgICAgICJcdUZGNTkiOiAieSIsCiAgICAgICAgICAgICJcdTFFRjMiOiAieSIsCiAgICAgICAgICAgICJcdTAwRkQiOiAieSIsCiAgICAgICAgICAgICJcdTAxNzciOiAieSIsCiAgICAgICAgICAgICJcdTFFRjkiOiAieSIsCiAgICAgICAgICAgICJcdTAyMzMiOiAieSIsCiAgICAgICAgICAgICJcdTFFOEYiOiAieSIsCiAgICAgICAgICAgICJcdTAwRkYiOiAieSIsCiAgICAgICAgICAgICJcdTFFRjciOiAieSIsCiAgICAgICAgICAgICJcdTFFOTkiOiAieSIsCiAgICAgICAgICAgICJcdTFFRjUiOiAieSIsCiAgICAgICAgICAgICJcdTAxQjQiOiAieSIsCiAgICAgICAgICAgICJcdTAyNEYiOiAieSIsCiAgICAgICAgICAgICJcdTFFRkYiOiAieSIsCiAgICAgICAgICAgICJcdTAwN0EiOiAieiIsCiAgICAgICAgICAgICJcdTI0RTkiOiAieiIsCiAgICAgICAgICAgICJcdUZGNUEiOiAieiIsCiAgICAgICAgICAgICJcdTAxN0EiOiAieiIsCiAgICAgICAgICAgICJcdTFFOTEiOiAieiIsCiAgICAgICAgICAgICJcdTAxN0MiOiAieiIsCiAgICAgICAgICAgICJcdTAxN0UiOiAieiIsCiAgICAgICAgICAgICJcdTFFOTMiOiAieiIsCiAgICAgICAgICAgICJcdTFFOTUiOiAieiIsCiAgICAgICAgICAgICJcdTAxQjYiOiAieiIsCiAgICAgICAgICAgICJcdTAyMjUiOiAieiIsCiAgICAgICAgICAgICJcdTAyNDAiOiAieiIsCiAgICAgICAgICAgICJcdTJDNkMiOiAieiIsCiAgICAgICAgICAgICJcdUE3NjMiOiAieiIgICAKICAgICAgICB9OwoKICAgICAgICB2YXIgY2hhcmFjdGVycyA9IHN0cmluZy5zcGxpdCggIiIgKTsKICAgIAogICAgICAgIGZvciAoIHZhciBpPTA7IGkgPCBjaGFyYWN0ZXJzLmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICB2YXIgbm9ybWFsaXplZENoYXJhY3RlciA9IGRpYWNyaXRpY3NNYXBbIGNoYXJhY3RlcnNbIGkgXSBdOwogICAgICAgICAgICBpZiAoIHVuZGVmaW5lZCAhPT0gbm9ybWFsaXplZENoYXJhY3RlciApIHsKICAgICAgICAgICAgICAgIGNoYXJhY3RlcnNbIGkgXSA9IG5vcm1hbGl6ZWRDaGFyYWN0ZXI7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBjaGFyYWN0ZXJzLmpvaW4oICIiICk7CgogICAgfTsKCiAgICAvKioKICAgICAqIENvbXByZXNzZXMgYSBzdHJpbmcuCiAgICAgKgogICAgICogUmVwbGFjZXMgYWxsIHdoaXRlc3BhY2Ugc2VxdWVuY2VzIHdpdGggc2luZ2xlIHNwYWNlcy4KICAgICAqIEN1dHMgb2ZmIHN0cmluZyBpZiBsb25nZXIgdGhhbiBhIHNwZWNpZmllZCBsZW5ndGggYW5kIHNldHMgYW4KICAgICAqIGVsbGlwc2lzIHRvIGluZGljYXRlIHRoZSByZW1vdmFsLgogICAgICoKICAgICAqIEBzeW50YXggU3RyaW5nVXRpbC5jb21wcmVzc1RleHQoIHRleHQsIGxlbmd0aCApCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCBhIHN0cmluZyB0byBjb21wcmVzcwogICAgICogQHBhcmFtIHtOdW1iZXJ9IFtsZW5ndGg9MjUwXSBsZW5ndGggdG8gY3V0IHN0cmluZyBvZmYgYXQKICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IHRoZSBjb21wcmVzc2VkIHN0cmluZwogICAgICogQG1ldGhvZAogICAgICogQG5hbWUgU3RyaW5nVXRpbC5jb21wcmVzc1RleHQKICAgICAqLwogICAgdGhhdC5jb21wcmVzc1RleHQgPSBmdW5jdGlvbiggdGV4dCwgbGVuZ3RoICkgewogICAgICAgIGlmICggdW5kZWZpbmVkID09PSBsZW5ndGggKSB7CiAgICAgICAgICAgIGxlbmd0aCA9IDI1MDsKICAgICAgICB9CiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSggL1xzKy9nLCAiICIgKTsKICAgICAgICB2YXIgcHVuY3R1YXRpb24gPSBbICIuIiwgIiwiLCAiPyIsICIhIiwgIi0iLCAiOyIgXTsKICAgICAgICBpZiAoIHRleHQubGVuZ3RoID4gbGVuZ3RoICkgewogICAgICAgICAgICAvLyBzdHJpbmdzIGNhbid0IGVuZCB1cCBzaG9ydGVyIHRoYW4gMjAgY2hhcmFjdGVycwogICAgICAgICAgICBmb3IgKCB2YXIgaSA9IGxlbmd0aDsgaSA+IDIwOyBpLS0gKSB7CiAgICAgICAgICAgICAgICBpZiAoIC0xICE9PSBwdW5jdHVhdGlvbi5pbmRleE9mKCB0ZXh0WyBpIF0gKSApIHsKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5zdWJzdHJpbmcoIDAsIGkgKSArICIgLi4uIjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBpZiBubyBwdW5jdHVhdGlvbiBpcyBmb3VuZCBqdXN0IGN1dCBvZmYKICAgICAgICAvLyBhZGQgNCB0byBhY2NvdW50IGZvciBhIHBvc3NpYmxlIGVsbGlwc2lzIHNldCBlYXJsaWVyCiAgICAgICAgaWYgKCB0ZXh0Lmxlbmd0aCA+IChsZW5ndGggKyA0KSApIHsKICAgICAgICAgICAgdGV4dCA9IHRleHQuc3Vic3RyaW5nKCAwLCBsZW5ndGggKSArICIgLi4uIjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRleHQ7CiAgICB9OwoKCiAgICAvKioKICAgICAqIE1ldGhvZCB0aGF0IHRyYW5zZm9ybXMgb3JkaW5hbHMgdG8gbnVtYmVycy4KICAgICAqCiAgICAgKiBAdHlwZSB7bWV0aG9kfQogICAgICogQHN5bnRheCBTdHJpbmdVdGlsLm9yZGluYWxUb051bWJlciggc3RyaW5nICkKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdHJpbmcgVGhlIHN0cmluZyB0byB0cmFuc2Zvcm0KICAgICAqIEByZXR1cm4ge1N0cmluZ30gdGhlIHN0cmluZyB3aXRoIHRoZSBvcmRpbmFsIHJlcGxhY2VkIGJ5IGEgbnVtYmVyIG9yIHRoZSBvcmlnaW5hbCBzdHJpbmcKICAgICAqIEBtZXRob2QKICAgICAqIEBuYW1lIFN0cmluZ1V0aWwub3JkaW5hbFRvTnVtYmVyCiAgICAgKiBAZXhhbXBsZSBTdHJpbmdVdGlsLm9yZGluYWxUb051bWJlciggIlRoaXJkIHNlYXNvbiIgKQogICAgICovCiAgICB0aGF0Lm9yZGluYWxUb051bWJlciA9IGZ1bmN0aW9uKCBzdHJpbmcgKSB7CgogICAgICAgIHZhciB3b3JkTWFwID0gewogICAgICAgICAgICAiZlx1MDBmOHJzdGUiOiAiMS4iLAogICAgICAgICAgICAiZmlyc3QiOiAiMS4iLAogICAgICAgICAgICAiYW5kZW4iOiAiMi4iLAogICAgICAgICAgICAic2Vjb25kIjogIjIuIiwKICAgICAgICAgICAgInRyZWRqZSI6ICIzLiIsCiAgICAgICAgICAgICJ0aGlyZCI6ICIzLiIsCiAgICAgICAgICAgICJmamVyZGUiOiAiNC4iLAogICAgICAgICAgICAiZm91cnRoIjogIjQuIiwKICAgICAgICAgICAgImZlbXRlIjogIjUuIiwKICAgICAgICAgICAgImZpZnRoIjogIjUuIiwKICAgICAgICAgICAgInNqZXR0ZSI6ICI2LiIsCiAgICAgICAgICAgICJzaXh0aCI6ICI2LiIsCiAgICAgICAgICAgICJzeXZlbmRlIjogIjcuIiwKICAgICAgICAgICAgInNldmVudGgiOiAiNy4iLAogICAgICAgICAgICAib3R0ZW5kZSI6ICI4LiIsCiAgICAgICAgICAgICJlaWdodGgiOiAiOC4iLAogICAgICAgICAgICAibmllbmRlIjogIjkuIiwKICAgICAgICAgICAgIm5pbnRoIjogIjkuIiwKICAgICAgICAgICAgInRpZW5kZSI6ICIxMC4iLAogICAgICAgICAgICAidGVudGgiOiAiMTAuIgogICAgICAgIH07CgogICAgICAgIHZhciBpbnB1dFN0cmluZyA9IHN0cmluZy5zcGxpdCggIiAiICk7CiAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgaW5wdXRTdHJpbmcubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgICAgIHZhciBvdXRwdXROdW1iZXJTdHJpbmcgPSB3b3JkTWFwWyBpbnB1dFN0cmluZ1sgaSBdLnRvTG93ZXJDYXNlKCkgXTsKICAgICAgICAgICAgaWYgKCB1bmRlZmluZWQgIT09IG91dHB1dE51bWJlclN0cmluZyApIHsKICAgICAgICAgICAgICAgIHN0cmluZyA9IHN0cmluZy5yZXBsYWNlKCBpbnB1dFN0cmluZ1tpXSwgb3V0cHV0TnVtYmVyU3RyaW5nICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cmluZzsKICAgIH07CgogICAgcmV0dXJuIHRoYXQ7Cgp9KCApOw==", "moduleName": "StringUtil"}, {"javascript": "LyoqIEBmaWxlIE1vZHVsZSB0byBoYW5kbGUgYXJndW1lbnQgY2hlY2tpbmcgaW4gYSBuZWF0ZXIgd2F5LiAqLwoKCkVYUE9SVEVEX1NZTUJPTFMgPSBbICdWYWx1ZUNoZWNrJyBdOwoKLyoqCiAqIEZ1bmN0aW9ucyB0byBjaGVjayBhcmd1bWVudHMgcHJlc2VuY2UgYW5kIHZhbHVlLgogKiAKICogVGhpcyBtb2R1bGUvbmFtZXNwYWNlIHByb3ZpZGVzIGEgbnVtYmVyIG9mIGZ1bmN0aW9ucyB0aGF0IGNhbiBiZSB1c2VkCiAqIHRvIHN5c3RlbWF0aWNhbGx5IGNoZWNrIHRoYXQgcGFyYW1ldGVycy92YXJpYWJsZXMgYXJlIHNldCBhbmQgY2hlY2sKICogdGhhdCB0aGUgdmFsdWVzIGZ1bGxmaWxsIGNlcnRhaW4gY3JpdGVyaWEuIFRoZSBmdW5jdGlvbnMgcHJvdmlkZWQgYXJlCiAqIGNoYWluYWJsZSwgd2hpY2ggbGVhZHMgdG8gZWFzeS10by1yZWFkIGV4cHJlc3Npb25zLiBGb3IgbW9yZQogKiBpbmZvcm1hdGlvbiBhYm91dCB0aGUgYWN0dWFsIGNvbnN0cmFpbnRzLCBzZWUge0BsaW5rIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3R9LgogKiAKICogSWYgYSBjYWxsZXIgcGFzc2VzIHBhcmFtZXRlcnMgdG8gdGhlIGZ1bmN0aW9uIHRoYXQgZG9lcyBub3QgbWF0Y2gKICogdGhlIGNvbnN0cmFpbnRzLCBhIHN1aXRhYmxlIGV4Y2VwdGlvbiB3aWxsIGJlIHRocm93bi4gVGhpcyBlbnN1cmVzCiAqIHRoYXQgeW91IGNhbiB3cml0ZSB0aGUgcmVzdCBvZiB0aGUgZnVuY3Rpb24gd2l0aCB0aGUga25vd2xlZGdlIHRoYXQKICogdGhlIHBhcmFtZXRlcnMgYXJlIHdpdGhpbiB0aGUgdmFsdWVzIHRoZSBmdW5jdGlvbiBjYW4gaGFuZGxlLgogKgogKiBAdHlwZSB7bmFtZXNwYWNlfQogKiBAYm9ycm93cyBWYWx1ZUNoZWNrLmNoZWNrIGFzIGNoZWNrVGhhdCAKICogQGJvcnJvd3MgVmFsdWVDaGVjay5jaGVjayBhcyByZXF1aXJlVGhhdCAKICogQGV4YW1wbGUgCi8vIFNheSB0aGF0IHlvdSB3YW50IHRvIGNoZWNrIHRoZSBhcmd1bWVudHMgZm9vLCBiYXIgYW5kIGJheiB0byBhIGZ1bmN0aW9uLiBZb3Ugd2FudCB0byBjaGVjayB0aGF0Ci8vIAovLyAgIGEpIGZvbyBpcyBhIG5vbi1lbXB0eSBzdHJpbmcsCi8vICAgYikgYmFyIG11c3QgYmUgYSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxMDAgKGluY2x1c2l2ZSksIGFuZAovLyAgIGMpIGJheiBzaG91bGQgYmUgZWl0aGVyIHRoZSBzdHJpbmcgInN1Y2Nlc3MiLCAic3VzcGVuZCIgb3IgdGhlIHN0cmluZyAiZmFpbHVyZSIgCi8vIAovLyAgIFlvdSBjb3VsZCB0aGVuIHdyaXRlIHRoZSBmdW5jdGlvbiBzb21ld2hhdCBsaWtlIHRoaXM6CmZ1bmN0aW9uIG15VGVzdEZ1bmN0aW9uKCBmb28sIGJhciwgYmF6ICkgewogICAgVmFsdWVDaGVjay5jaGVja1RoYXQoICJmb28iLCBmb28gKS5pcy5kZWZpbmVkLmFuZC5oYXMudHlwZSggInN0cmluZyIgKS5hbmQudmFsdWUudGhhdC5pcy5ub3QuZXF1YWxUbyggIiIgKTsKICAgIFZhbHVlQ2hlY2suY2hlY2tUaGF0KCAiYmFyIiwgYmFyICkuaXMuZGVmaW5lZC53aXRoLnR5cGUoICJudW1iZXIiICkuYW5kLmluc2lkZSggMCwgMTAwICk7CiAgICBWYWx1ZUNoZWNrLmNoZWNrVGhhdCggImJheiIsIGJheiApLmlzLmRlZmluZWQuYW5kLmhhcy50eXBlKCAic3RyaW5nIiApLmFuZC5pcy5pbiggWyAic3VjY2VzcyIsICJzdXNwZW5kIiwgImZhaWx1cmUiIF0gKTsKCiAgICAvLyBSZXN0IG9mIGZ1bmN0aW9uCn0KLy8gVGhlIHRlc3RzIGNvdWxkIGFsc28gYmUgd3JpdHRlbiBhIGxvdCBtb3JlIGNvbXBhY3QsIGlmIHlvdSB3aXNoOgpWYWx1ZUNoZWNrLmNoZWNrVGhhdCggImZvbyIsIGZvbyApLmRlZmluZWQudHlwZSggInN0cmluZyIgKS5ub3QuZXF1YWxUbyggIiIgKTsKVmFsdWVDaGVjay5jaGVja1RoYXQoICJiYXIiLCBiYXIgKS5kZWZpbmVkLnR5cGUoICJudW1iZXIiICkuaW5zaWRlKCAwLCAxMDAgKTsKVmFsdWVDaGVjay5jaGVja1RoYXQoICJiYXoiLCBiYXogKS5kZWZpbmVkLnR5cGUoICJzdHJpbmciICkuaW4oIFsgInN1Y2Nlc3MiLCAic3VzcGVuZCIsICJmYWlsdXJlIiBdICk7CiAqIAogKiBAbmFtZXNwYWNlIAogKiBAbmFtZSBWYWx1ZUNoZWNrCiAqLwp2YXIgVmFsdWVDaGVjayA9IGZ1bmN0aW9uKCApIHsKCiAgICB2YXIgdGhhdCA9IHt9OwoKICAgIC8vIFRocm93IGhlbHBlciBmdW5jdGlvbgogICAgdmFyIHRocm93RXJyb3IgPSBmdW5jdGlvbiggbWVzc2FnZSApIHsKICAgICAgICB0aHJvdyBFcnJvciggIlZhbHVlQ2hlY2tFcnJvcjogVGhlIGZvbGxvd2luZyBjaGVjayBmYWlsZWQ6ICIgKyBtZXNzYWdlICk7CiAgICB9OwoKICAgIHZhciBjaGVja3Rocm93TmVlZDFBcmdFcnJvciA9IGZ1bmN0aW9uKCBmdW5jdGlvbk5hbWUsIGxlbmd0aCApIHsKICAgICAgICBpZiAoIGxlbmd0aCAhPSAxICkgewogICAgICAgICAgICB0aHJvd0Vycm9yKCAiRXJyb3IgaW4gY2FsbGluZyBjaGVja09iamVjdC4iICsgZnVuY3Rpb25OYW1lICsgIi4gUmVxdWlyZXMgZXhhY3RseSAxIGFyZ3VtZW50LCBnb3QgIiArIGxlbmd0aCApOwogICAgICAgIH0KICAgIH07CgogICAgdmFyIGNoZWNrdGhyb3dOZWVkMkFyZ3NFcnJvciA9IGZ1bmN0aW9uKCBmdW5jdGlvbk5hbWUsIGxlbmd0aCApIHsKICAgICAgICBpZiAoIGxlbmd0aCAhPSAyICkgewogICAgICAgICAgICB0aHJvd0Vycm9yKCAiRXJyb3IgaW4gY2FsbGluZyBjaGVja09iamVjdC4iICsgZnVuY3Rpb25OYW1lICsgIi4gUmVxdWlyZXMgZXhhY3RseSAyIGFyZ3VtZW50cywgZ290ICIgKyBsZW5ndGggKTsKICAgICAgICB9CiAgICB9OwoKCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gT2JqZWN0LCB0aGF0IGV4cG9zZXMgYWxsIHRoZSBjb25zdHJhaW50cywgZXRjLgogICAgLy8gTk9URTogaWYgbmFtZSBpcyBzZXQgdG8gdW5kZWZpbmVkLCB0aGUgZ2V0dGVycyBkb2VzIG5vdCByZXR1cm4gdGhpcyAtIHRoaXMgaXMgdG8gZmFjaWxpdGF0ZSB0aGUgaW50ZXJhY3RpdmUgaGVscCBzeXN0ZW0uCiAgICAvLyBPbmx5IENoZWNrT2JqZWN0IGNhbiB3b3JrIHdpdGggaGVscCwgbm9ybWFsIG9iamVjdHMgY2FuIG5vdCB3b3JrIHdpdGggaGVscCwgZHVlIHRvIHRoZSB3YXkgZ2V0dGVycyB3b3JrLgogICAgdmFyIGNoZWNrT2JqZWN0ID0gZnVuY3Rpb24oIG5hbWVfLCB2YWx1ZV8gKSB7CiAgICAgICAgdmFyIHRoYXQgPSB7fTsKCiAgICAgICAgLy8gUHJpdmF0ZSBzdHVmZgoKICAgICAgICAvLyBWYXJpYWJsZQogICAgICAgIHZhciB2YWx1ZSA9IHZhbHVlXzsKICAgICAgICB2YXIgbmFtZSA9IG5hbWVfOwogICAgICAgIHZhciBub3RmbGFnID0gZmFsc2U7CgogICAgICAgIC8vIEhlbHBlciBtZXRob2QKICAgICAgICAvLyBEZWZpbmUgb3BlcmF0b3JzCiAgICAgICAgdmFyIG9wZXJhdG9yID0gewogICAgICAgICAgICAvLyB0b2RvOiBVc2UgPT09IG9yIG5vdC4uLiA/Pz8KICAgICAgICAgICAgZXF1YWxpdHk6IGZ1bmN0aW9uKCBhLCBiICkgewogICAgICAgICAgICAgICAgcmV0dXJuIGEgPT0gYjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLy8gaW5lcXVhbGl0eSA6IGZ1bmN0aW9uKCBhLCBiICkgeyByZXR1cm4gISBlcXVhbGl0eSggYSwgYiApOyB9LAogICAgICAgICAgICBncmVhdGVydGhhbjogZnVuY3Rpb24oIGEsIGIgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYSA+IGI7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGxlc3N0aGFuOiBmdW5jdGlvbiggYSwgYiApIHsKICAgICAgICAgICAgICAgIHJldHVybiBhIDwgYjsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgLy8gQW5kIHRoaXMgaXMgZm9yIHRoZSBkZXNjcmlwdGlvbnMuCiAgICAgICAgb3BlcmF0b3IuZXF1YWxpdHkuZGVzYyA9ICI9PSI7CiAgICAgICAgb3BlcmF0b3IuZ3JlYXRlcnRoYW4uZGVzYyA9ICI+IjsKICAgICAgICBvcGVyYXRvci5sZXNzdGhhbi5kZXNjID0gIjwiOwoKICAgICAgICAvLyBDb21wYXIgb3RoZXIgc3R1ZmYgdG8gdmFsdWUsIHVzaW5nIGFuIG9wZXJhdG9yCiAgICAgICAgdmFyIGNvbXBhcmUgPSBmdW5jdGlvbiggb3BlcmF0b3IsIGIgKSB7CiAgICAgICAgICAgIHZhciBjb21wcmVzID0gb3BlcmF0b3IoIHZhbHVlLCBiICk7CiAgICAgICAgICAgIHZhciBub3RzdHJpbmcgPSAibm90ICI7CiAgICAgICAgICAgIGlmICggbm90ZmxhZyApIHsKICAgICAgICAgICAgICAgIGNvbXByZXMgPSAhY29tcHJlczsKICAgICAgICAgICAgICAgIG5vdGZsYWcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIG5vdHN0cmluZyA9ICIiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggY29tcHJlcyApIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGF0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3dFcnJvciggIlZhbHVlIG9mICciICsgbmFtZSArICInIDogJyIgKyB2YWx1ZSArICInIGlzICIgKyBub3RzdHJpbmcgKyBvcGVyYXRvci5kZXNjICsgIiAnIiArIGIgKyAiJyIgKTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIC8vIEhlbHBlciBmdW5jdGlvbiB0byBjcmVhdGUgbGluayB3b3Jrcy4KICAgICAgICAvLyBXb3JkcywgdGhhdCB3ZSB3YW50CiAgICAgICAgLy8gaXMsIGFuZCwgaGFzLCBoYXZlLCB3aXRoLCBvZiwgdmFsdWUsIG11c3QsIGJlCgogICAgICAgIC8qKgogICAgICAgICAqIFNlbGVjdCB0aGUgZmlyc3Qgbm9kZSB0aGF0IG1hdGNoZXMgdGhlIHNwZWNpZmllZCB4cGF0aC4KICAgICAgICAgKgogICAgICAgICAqIEBtZXRob2QKICAgICAgICAgKiBAbmFtZSBYUGF0aC5zZWxlY3ROb2RlCiAgICAgICAgICogQHN5bnRheCBYUGF0aC5zZWxlY3ROb2RlKHhwYXRoLCB4bWxOb2RlKQogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB4cGF0aCBleHByZXNzaW9uIHRvIG1hdGNoCiAgICAgICAgICogQHBhcmFtIHtOb2RlfSB4bWxOb2RlIERvY3VtZW50IHRvIG1hdGNoIHhwYXRoIGluCiAgICAgICAgICogQHJldHVybiB7Tm9kZXx1bmRlZmluZWR9IFRoZSBmaXJzdCBub2RlIHRoYXQgbWF0Y2hlcyB0aGUgcGF0aCBvciB1bmRlZmluZWQgaWYgbm8gbm9kZSBtYXRjaGVzCiAgICAgICAgICogQGV4YW1wbGUKICAgICAgICAgKiBYUGF0aC5zZWxlY3QoIi9yb290L2NoaWxkIiwgZG9jKQogICAgICAgICAqLwoKICAgICAgICAvKioKICAgICAgICAgKiBMaW5rIG9uZSBvciBtb3JlIGNoZWNrL2NvbnN0cmFpbnRzIHRvZ2V0aGVyLgogICAgICAgICAqCiAgICAgICAgICogQG1ldGhvZAogICAgICAgICAqIEBuYW1lIENoZWNrT2JqZWN0SW5zdGFuY2Uue2xpbmtuYW1lfQogICAgICAgICAqIEBzeW50YXggQ2hlY2tPYmplY3RJbnN0YW5jZS57bGlua25hbWV9LnNvbWVDaGVjazsKICAgICAgICAgKiBAcGFyYW0ge3R5cGV9IG9uT2JqZWN0CiAgICAgICAgICogQHBhcmFtIHt0eXBlfSBsaW5rbmFtZQogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2hlY2tPYmplY3QgaW5zdGFuY2Ugc3VpdGFibGUgZm9yIGNoYWluaW5nIGNvbnN0cmFpbnRzCiAgICAgICAgICogQGV4YW1wbGUKICAgICAgICAgKiBWYWx1ZUNoZWNrLmNoZWNrVGhhdCggImZvbyIsIGZvbyApLmlzLm9mLnR5cGUoICJzdHJpbmciICkuYW5kLndpdGgudmFsdWUubm90LmVxdWFsVG8oICJzb21ldGhpbmciICk7CiAgICAgICAgICogVmFsdWVDaGVjay5yZXF1aXJlVGhhdCggImZvbyIsIGZvbyApLm11c3QuYmUub2YudHlwZSggIm51bWJlciIgKS5hbmQuaGF2ZS52YWx1ZS5pbnNpZGUoIDQyLCA3OCApOwogICAgICAgICAqIFZhbHVlQ2hlY2suY2hlY2tUaGF0KCAiZm9vIiwgZm9vICkuaXMuZGVmaW5lZC5hbmQuaGFzLnR5cGUoICJzdHJpbmciICkuYW5kLnRoYXQuaXQuaGFzLnZhbHVlLmluKCBbICJiaWJsb3Rlay5kayIsICJwYWxsZXNnYXZlYm9kIiBdICk7CiAgICAgICAgICogVmFsdWVDaGVjay5yZXF1aXJlVGhhdCggImFkZHJlc3MiLCBmb28gKS5oYXMudHlwZSggInN0cmluZyIgKS5hbmQudGhhdC5pdC5pcy5hbi5lbWFpbC5hZGRyZXNzOwogICAgICAgICAqLwogICAgICAgIHZhciBkZWZpbmVMaW5rID0gZnVuY3Rpb24oIG9uT2JqZWN0LCBsaW5rbmFtZSApIHsKICAgICAgICAgICAgb25PYmplY3QuX19kZWZpbmVHZXR0ZXJfXyggbGlua25hbWUsIGZ1bmN0aW9uKCApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIG5hbWUgPT09IHVuZGVmaW5lZCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9uT2JqZWN0Ll9fbG9va3VwR2V0dGVyX18oIGxpbmtuYW1lICk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9uT2JqZWN0OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gKTsKICAgICAgICB9OwoKICAgICAgICAvLyBQdWJsaWMgc3R1ZmYKICAgICAgICAvLyBEZWZpbmUgYWxsIHRoZSBsaW5rcy4KICAgICAgICAoIGZ1bmN0aW9uKCApIHsKICAgICAgICAgICAgICAgIFsgImlzIiwgImFuZCIsICJoYXMiLCAiaGF2ZSIsICJ3aXRoIiwgIm9mIiwgInZhbHVlIiwgIm11c3QiLCAiYmUiLCAidGhhdCIsICJpdCIsICJkb2VzIiwgImFkZHJlc3MiLCAiYW4iIF0KICAgICAgICAgICAgICAgICAgICAuZm9yRWFjaCggZnVuY3Rpb24oIHYgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmluZUxpbmsoIHRoYXQsIHYgKTsKICAgICAgICAgICAgICAgICAgICB9ICk7CiAgICAgICAgICAgIH0oICkgKTsKCgogICAgICAgIC8vIEhlcmUgY29tZXMgc3R1ZmYgdGhhdCBhY3R1YWxseSBkb2VzIHNvbWV0aGluZy4KICAgICAgICAvKioKICAgICAgICAgKiBUb29nbGUgdGhlIHNlbWFudGljcyBvZiB0aGUgbmV4dCBjaGVjay4KICAgICAgICAgKgogICAgICAgICAqIFRoaXMgZmxhZyB0b29nbGVzIHRoZSBzZW1hbnRpY3Mgb2YgdGhlIG5leHQgY2hlY2svY29uc3RyYWludCwgYW5kIGlzIHByb3ZpZGVkIHRvIGFsbG93IGFuIGV4cHJlc3NpdmUsIGVhc3ktdG8tcmVhZCBzeW50YXguCiAgICAgICAgICogU28sIHdyaXRpbmcgQ2hlY2tPYmplY3RJbnN0YW5jZS5ub3QuZXF1YWxUbyggNDIgKSBpcyBlcXVpdmFsZW50IHRvIHdyaXRpbmcgQ2hlY2tPYmplY3RJbnN0YW5jZS51bmVxdWFsVG8oIDQyICkuCiAgICAgICAgICogTm90ZSwgdGhhdCBmb3IgaW5zaWRlIGFuZCBvdXRzaWRlLCB0aGVyZSBhcmUgc3BlY2lhbCBjb3JuZXJjYXNlIG1lYW5pbmdzIGZvciB3cml0aW5nIG5vdAogICAgICAgICAqIChzZWUgdGhlIGhlbHAgZm9yIHRoZXNlIGNoZWNrcywgZm9yIG1vcmUgaW5mb3JtYXRpb24pLgogICAgICAgICAqCiAgICAgICAgICogQG1ldGhvZAogICAgICAgICAqIEBuYW1lIENoZWNrT2JqZWN0SW5zdGFuY2Uubm90CiAgICAgICAgICogQHN5bnRheCBDaGVja09iamVjdEluc3RhbmNlLm5vdDsKICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IENoZWNrT2JqZWN0IGluc3RhbmNlIHN1aXRhYmxlIGZvciBjaGFpbmluZyBjb25zdHJhaW50cwogICAgICAgICAqIEBleGFtcGxlCiAgICAgICAgICogVmFsdWVDaGVjay5jaGVjayggImZvbyIsIGZvbyApLmlzLm5vdC50eXBlKCAic3RyaW5nIiApLmFuZC52YWx1ZS5pcy5ub3QuaW4oIFsgMjMsIDM0LCA0NSBdICk7CiAgICAgICAgICovCiAgICAgICAgdGhhdC5fX2RlZmluZUdldHRlcl9fKCAibm90IiwgZnVuY3Rpb24oICkgewogICAgICAgICAgICAgICAgLy8gSGFjayB0byBmaXggdGhlIGhlbHAgc3lzdGVtCiAgICAgICAgICAgICAgICBpZiAoIG5hbWUgPT09IHVuZGVmaW5lZCApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fX2xvb2t1cEdldHRlcl9fKCAibm90IiApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBub3RmbGFnID0gIW5vdGZsYWc7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gKTsKCiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyBkZWZpbmVkIGFuZCB1bmRlZmluZWQKCiAgICAgICAgLyoqCiAgICAgICAgICogQ2hlY2sgaWYgdGhlIHZhbHVlIGlzIHVuZGVmaW5lZC4KICAgICAgICAgKgogICAgICAgICAqIFRoaXMgY29uc3RyYWludCByZXF1aXJlcyB0aGF0IHRoZSB2YWx1ZSBpcyB1bmRlZmluZWQuIElmIHRoZSBjb25zdHJhaW50IGlzIG5vdCBmdWxsZmlsbGVkLCBpdCB3aWxsIHRocm93IGFuIGVycm9yLgogICAgICAgICAqCiAgICAgICAgICogQG1ldGhvZAogICAgICAgICAqIEBuYW1lIENoZWNrT2JqZWN0SW5zdGFuY2UudW5kZWZpbmVkCiAgICAgICAgICogQHN5bnRheCBDaGVja09iamVjdEluc3RhbmNlLnVuZGVmaW5lZDsKICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IENoZWNrT2JqZWN0IGluc3RhbmNlIHN1aXRhYmxlIGZvciBjaGFpbmluZyBjb25zdHJhaW50cwogICAgICAgICAqIEBleGFtcGxlCiAgICAgICAgICogVmFsdWVDaGVjay5jaGVjayggImZvbyIsIGZvbyApLmlzLnVuZGVmaW5lZDsKICAgICAgICAgKi8KICAgICAgICB0aGF0Ll9fZGVmaW5lR2V0dGVyX18oICJ1bmRlZmluZWQiLCBmdW5jdGlvbiggKSB7CiAgICAgICAgICAgICAgICAvLyBIYWNrIHRvIGZpeCB0aGUgaGVscCBzeXN0ZW0KICAgICAgICAgICAgICAgIGlmICggbmFtZSA9PT0gdW5kZWZpbmVkICkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9fbG9va3VwR2V0dGVyX18oICJ1bmRlZmluZWQiICk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVxdWFsVG8oIHVuZGVmaW5lZCApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9ICk7CgogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrIGlmIHRoZSB2YWx1ZSBpcyBkZWZpbmVkLgogICAgICAgICAqCiAgICAgICAgICogVGhpcyBjb25zdHJhaW50IHJlcXVpcmVzIHRoYXQgdGhlIHZhbHVlIGlzIGRlZmluZWQuIElmIHRoZSBjb25zdHJhaW50IGlzIG5vdCBmdWxsZmlsbGVkLCBpdCB3aWxsIHRocm93IGFuIGVycm9yLgogICAgICAgICAqCiAgICAgICAgICogQG1ldGhvZAogICAgICAgICAqIEBuYW1lIENoZWNrT2JqZWN0SW5zdGFuY2UuZGVmaW5lZAogICAgICAgICAqIEBzeW50YXggQ2hlY2tPYmplY3RJbnN0YW5jZS5kZWZpbmVkOwogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2hlY2tPYmplY3QgaW5zdGFuY2Ugc3VpdGFibGUgZm9yIGNoYWluaW5nIGNvbnN0cmFpbnRzCiAgICAgICAgICogQGV4YW1wbGUKICAgICAgICAgKiBWYWx1ZUNoZWNrLmNoZWNrKCAiZm9vIiwgZm9vICkuaXMuZGVmaW5lZDsKICAgICAgICAgKiBWYWx1ZUNoZWNrLnJlcXVpcmVUaGF0KCAiZm9vIiwgZm9vICkuaXMuZGVmaW5lZC53aXRoLnR5cGUoICJzdHJpbmciICkuYW5kLnRoYXQuaXQuaXMubm90LmVxdWFsVG8oICIiICk7CiAgICAgICAgICovCiAgICAgICAgdGhhdC5fX2RlZmluZUdldHRlcl9fKCAiZGVmaW5lZCIsIGZ1bmN0aW9uKCApIHsKICAgICAgICAgICAgICAgIC8vIEhhY2sgdG8gZml4IHRoZSBoZWxwIHN5c3RlbQogICAgICAgICAgICAgICAgaWYgKCBuYW1lID09PSB1bmRlZmluZWQgKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19sb29rdXBHZXR0ZXJfXyggImRlZmluZWQiICk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm5vdC51bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gKTsKCiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyB0eXBlCgogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrIGlmIHRoZSB0eXBlIG9mIGEgdGhlIHZhbHVlIG1hdGNoZXMgdHlwZS4KICAgICAgICAgKiAKICAgICAgICAgKiBUaGlzIGNvbnN0cmFpbnQgcmVxdWlyZXMgdGhhdCB0aGUgdHlwZW9mIHRoZSB2YWx1ZSBpcyBlcXVhbCB0byB0aGUgdHlwZQogICAgICAgICAqIHN0cmluZyBwYXNzZWQgYXMgcGFyYW1ldGVyIHRvIHRoZSBjb25zdHJhaW50LiBJZiB0aGUgY29uc3RyYWludCBpcyBub3QKICAgICAgICAgKiBmdWxsZmlsbGVkLCBpdCB3aWxsIHRocm93IGFuIGVycm9yLiAKICAgICAgICAgKiAKICAgICAgICAgKiBAdHlwZSB7Y2hlY2t9CiAgICAgICAgICogQHN5bnRheCBDaGVja09iamVjdEluc3RhbmNlLnR5cGUoIHR5cGUgKTsKICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUaGUgdHlwZSBhcyBhIHN0cmluZyB0byBjaGVjayB0aGUgZW5jYXBzdWxhdGVkIHZhbHVlIGFnYWluc3QKICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IENoZWNrT2JqZWN0IGluc3RhbmNlIHN1aXRhYmxlIGZvciBjaGFpbmluZyBjb25zdHJhaW50cwogICAgICAgICAqIEBleGFtcGxlIFZhbHVlQ2hlY2suY2hlY2soICJmb28iLCBmb28gKS5oYXMudHlwZSggIm51bWJlciIgKTsKICAgICAgICAgKiAgICAgVmFsdWVDaGVjay5jaGVjayggImZvbyIsIGZvbyApLnR5cGUoICJzdHJpbmciICk7CiAgICAgICAgICogQG5hbWUgVmFsdWVDaGVjay5DaGVja09iamVjdC50eXBlCiAgICAgICAgICogQG1ldGhvZAogICAgICAgICAqLwogICAgICAgIHRoYXQudHlwZSA9IGZ1bmN0aW9uKCB0eXBlICkgewogICAgICAgICAgICBjaGVja3Rocm93TmVlZDFBcmdFcnJvciggInR5cGUiLCBhcmd1bWVudHMubGVuZ3RoICk7CiAgICAgICAgICAgIHZhciByZXNjb21wID0gdHlwZW9mIHZhbHVlID09IHR5cGU7CiAgICAgICAgICAgIHZhciBub3RzdHJpbmcxID0gIm5vdCAiOwogICAgICAgICAgICB2YXIgbm90c3RyaW5nMiA9ICIiOwogICAgICAgICAgICBpZiAoIG5vdGZsYWcgKSB7CiAgICAgICAgICAgICAgICBub3RmbGFnID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXNjb21wID0gIXJlc2NvbXA7CiAgICAgICAgICAgICAgICBub3RzdHJpbmcxID0gIiI7CiAgICAgICAgICAgICAgICBub3RzdHJpbmcyID0gIm5vdCAiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggcmVzY29tcCApIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3dFcnJvciggIlZhbHVlICciICsgbmFtZSArICInIGlzICIgKyBub3RzdHJpbmcxICsgIm9mIHR5cGUgJyIgKyB0eXBlICsgIicsIGJ1dCAiICsgbm90c3RyaW5nMiArICJvZiB0eXBlICciICsgdHlwZW9mIHZhbHVlICsgIiciICk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgIC8vIGluc3RhbmNlT2YKICAgICAgICAvKioKICAgICAgICAgKiBDaGVjayBpZiB0aGUgdmFsdWUgaXMgYW4gaW5zdGFuY2Ugb2YgYSB0eXBlLgogICAgICAgICAqIAogICAgICAgICAqIFRoaXMgY29uc3RyYWludCByZXF1aXJlcyB0aGF0IHRoZSB2YWx1ZSBpcyBhbiBpbnN0YW5jZSBvZiB0aGUKICAgICAgICAgKiB0eXBlL2NvbnN0cnVjdG9yIHBhc3NlZCBhcyBwYXJhbWV0ZXIgdG8gdGhlIGNvbnN0cmFpbnQuIElmIHRoZQogICAgICAgICAqIGNvbnN0cmFpbnQgaXMgbm90IGZ1bGxmaWxsZWQsIGl0IHdpbGwgdGhyb3cgYW4gZXJyb3IuIAogICAgICAgICAqIAogICAgICAgICAqIEB0eXBlIHtjaGVja30KICAgICAgICAgKiBAc3ludGF4IENoZWNrT2JqZWN0SW5zdGFuY2UuaW5zdGFuY2VPZiggdHlwZSApOwogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSB0eXBlL2NvbnN0cnVjdG9yIHRvIGNoZWNrIHRoZSBlbmNhcHN1bGF0ZWQgdmFsdWUgYWdhaW5zdAogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2hlY2tPYmplY3QgaW5zdGFuY2Ugc3VpdGFibGUgZm9yIGNoYWluaW5nIGNvbnN0cmFpbnRzCiAgICAgICAgICogQGV4YW1wbGUgVmFsdWVDaGVjay5jaGVjayggInNvbWVkYXRlIiwgc29tZWRhdGUgKS5pcy5hbi5pbnN0YW5jZU9mKCBEYXRlICk7CiAgICAgICAgICogICAgIFZhbHVlQ2hlY2suY2hlY2soICJmb28iLCBmb28gKS5pbnN0YW5jZU9mKCBTdHJpbmcgKTsKICAgICAgICAgKiBAbmFtZSBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0Lmluc3RhbmNlT2YKICAgICAgICAgKiBAbWV0aG9kCiAgICAgICAgICovCiAgICAgICAgdGhhdC5pbnN0YW5jZU9mID0gZnVuY3Rpb24oIHR5cGUgKSB7CiAgICAgICAgICAgIGNoZWNrdGhyb3dOZWVkMUFyZ0Vycm9yKCAidHlwZSIsIGFyZ3VtZW50cy5sZW5ndGggKTsKICAgICAgICAgICAgdmFyIHJlc2NvbXAgPSB2YWx1ZSBpbnN0YW5jZW9mIHR5cGU7CiAgICAgICAgICAgIHZhciBub3RzdHJpbmcxID0gIm5vdCAiOwogICAgICAgICAgICB2YXIgbm90c3RyaW5nMiA9ICIiOwogICAgICAgICAgICBpZiAoIG5vdGZsYWcgKSB7CiAgICAgICAgICAgICAgICBub3RmbGFnID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXNjb21wID0gIXJlc2NvbXA7CiAgICAgICAgICAgICAgICBub3RzdHJpbmcxID0gIiI7CiAgICAgICAgICAgICAgICBub3RzdHJpbmcyID0gIm5vdCAiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggcmVzY29tcCApIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3dFcnJvciggIlZhbHVlICciICsgbmFtZSArICInIGlzICIgKyBub3RzdHJpbmcxICsgIiBpbnN0YW5jZW9mICciICsgdHlwZSArICInIiApOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyBSZWdFeHAgc3VwcG9ydAogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrIGlmIHRoZSB2YWx1ZSBjb250YWlucyBhIHJlZ3VsYXIgZXhwcmVzc2lvbi4KICAgICAgICAgKiAKICAgICAgICAgKiBUaGlzIGNvbnN0cmFpbnQgcmVxdWlyZXMgdGhhdCB0aGUgdmFsdWUsIGNvbnZlcnRlZCB0byBhIHN0cmluZywKICAgICAgICAgKiBjb250YWlucyB0aGUgcmVndWxhciBleHByZXNzaW9uIHBhc3NlZCBhcyBwYXJhbWV0ZXIgdG8gdGhlIGNvbnN0cmFpbnQuCiAgICAgICAgICogSXQgZGlmZmVycyBmcm9tIG1hdGNoIGluIHRoYXQgdGhlIHJlZ3VsYXIgZXhwcmVzc2lvbiBvbmx5IG5lZWRzIHRvCiAgICAgICAgICogbWF0Y2ggc29tZSBwYXJ0IG9mIHRoZSB2YWx1ZSAoYWZ0ZXIgc3RyaW5nIGNvbnZlcnNpb24pLiBJZiB0aGUKICAgICAgICAgKiBjb25zdHJhaW50IGlzIG5vdCBmdWxsZmlsbGVkLCBpdCB3aWxsIHRocm93IGFuIGVycm9yLiAKICAgICAgICAgKiAKICAgICAgICAgKiBAdHlwZSB7Y2hlY2t9CiAgICAgICAgICogQHN5bnRheCBDaGVja09iamVjdEluc3RhbmNlLmNvbnRhaW4oIHJlZ2V4cCApOwogICAgICAgICAqIEBwYXJhbSB7UmVnRXhwfSByZWdleHAgVGhlIHJlZ3VsYXIgZXhwcmVzc2lvbiB0byBjaGVjayB0aGUgZW5jYXBzdWxhdGVkIHZhbHVlIGFnYWluc3QKICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IENoZWNrT2JqZWN0IGluc3RhbmNlIHN1aXRhYmxlIGZvciBjaGFpbmluZyBjb25zdHJhaW50cwogICAgICAgICAqIEBleGFtcGxlIFRoZSBmb2xsb3dpbmcgZXhhbXBsZSB3aWxsIGJlIE9LIGZvciBuYW1lcyBzdWNoIGFzIEJldGgsIGJldGggYW5kIEVsaXphYmV0aAogICAgICAgICAqICAgVmFsdWVDaGVjay5jaGVja1RoYXQoICJuYW1lIiwgbmFtZSApLmlzLm9mLnR5cGUoICJzdHJpbmciICkuYW5kLmNvbnRhaW4oIC9iZXRoL2kgKTsKICAgICAgICAgKiBAbmFtZSBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0LmNvbnRhaW4KICAgICAgICAgKiBAbWV0aG9kCiAgICAgICAgICovCiAgICAgICAgdGhhdC5jb250YWluID0gZnVuY3Rpb24oIHJlZ2V4cCApIHsKICAgICAgICAgICAgY2hlY2t0aHJvd05lZWQxQXJnRXJyb3IoICJlcXVhbFRvIiwgYXJndW1lbnRzLmxlbmd0aCApOwogICAgICAgICAgICB2YXIgdnMgPSB2YWx1ZS50b1N0cmluZyggKTsKICAgICAgICAgICAgdmFyIHJlc2NvbXAgPSAoIC0xICE9IHZzLnNlYXJjaCggcmVnZXhwICkgKTsKICAgICAgICAgICAgdmFyIG5vdHN0cmluZyA9ICJub3QgIjsKICAgICAgICAgICAgaWYgKCBub3RmbGFnICkgewogICAgICAgICAgICAgICAgbm90ZmxhZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmVzY29tcCA9ICFyZXNjb21wOwogICAgICAgICAgICAgICAgbm90c3RyaW5nID0gIiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCByZXNjb21wICkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvd0Vycm9yKCAiVmFsdWUgJyIgKyBuYW1lICsgIicgZG9lcyAiICsgbm90c3RyaW5nICsgIiBjb250YWluICciICsgcmVnZXhwLnRvU3RyaW5nKCApICsgIiciICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrIGlmIHRoZSB2YWx1ZSBtYXRjaGVzIGEgcmVndWxhciBleHByZXNzaW9uLgogICAgICAgICAqIAogICAgICAgICAqIFRoaXMgY29uc3RyYWludCByZXF1aXJlcyB0aGF0IHRoZSB2YWx1ZSwgY29udmVydGVkIHRvIGEgc3RyaW5nLCBtYXRjaGVzCiAgICAgICAgICogdGhlIHJlZ3VsYXIgZXhwcmVzc2lvbiBwYXNzZWQgYXMgcGFyYW1ldGVyIHRvIHRoZSBjb25zdHJhaW50LiBJdAogICAgICAgICAqIGRpZmZlcnMgZnJvbSBjb250YWlucyBpbiB0aGF0IHRoZSByZWd1bGFyIGV4cHJlc3Npb24gbXVzdCBtYXRjaCB0aGUKICAgICAgICAgKiBlbnRpcmUgdmFsdWUgKGFmdGVyIHN0cmluZyBjb252ZXJzaW9uKS4gSWYgdGhlIGNvbnN0cmFpbnQgaXMgbm90CiAgICAgICAgICogZnVsbGZpbGxlZCwgaXQgd2lsbCB0aHJvdyBhbiBlcnJvci4gCiAgICAgICAgICogCiAgICAgICAgICogQHR5cGUge2NoZWNrfQogICAgICAgICAqIEBzeW50YXggQ2hlY2tPYmplY3RJbnN0YW5jZS5tYXRjaCggcmVnZXhwICk7CiAgICAgICAgICogQHBhcmFtIHtSZWdFeHB9IHJlZ2V4cCBUaGUgcmVndWxhciBleHByZXNzaW9uIHRvIGNoZWNrIHRoZSBlbmNhcHN1bGF0ZWQgdmFsdWUgYWdhaW5zdAogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2hlY2tPYmplY3QgaW5zdGFuY2Ugc3VpdGFibGUgZm9yIGNoYWluaW5nIGNvbnN0cmFpbnRzCiAgICAgICAgICogQGV4YW1wbGUgVGhlIGZvbGxvd2luZyBleGFtcGxlIG1hdGNoZXMgb25seSBCZXRoIGFuZCBiZXRoLCBub3QgRWxpemFiZXRoCiAgICAgICAgICogICBWYWx1ZUNoZWNrLmNoZWNrVGhhdCggIm5hbWUiLCBmb28gKS5tYXRjaGVzKCAvYmV0aC9pICk7CiAgICAgICAgICogQG5hbWUgVmFsdWVDaGVjay5DaGVja09iamVjdC5tYXRjaAogICAgICAgICAqIEBtZXRob2QKICAgICAgICAgKi8KICAgICAgICB0aGF0Lm1hdGNoID0gZnVuY3Rpb24oIHJlZ2V4cCApIHsKICAgICAgICAgICAgY2hlY2t0aHJvd05lZWQxQXJnRXJyb3IoICJlcXVhbFRvIiwgYXJndW1lbnRzLmxlbmd0aCApOwogICAgICAgICAgICB2YXIgdnMgPSB2YWx1ZS50b1N0cmluZyggKTsKICAgICAgICAgICAgdmFyIHJlc2NvbXAgPSAoIHZzID09IHZzLm1hdGNoKCByZWdleHAgKVsgMCBdICk7CiAgICAgICAgICAgIHZhciBub3RzdHJpbmcgPSAibm90ICI7CiAgICAgICAgICAgIGlmICggbm90ZmxhZyApIHsKICAgICAgICAgICAgICAgIG5vdGZsYWcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJlc2NvbXAgPSAhcmVzY29tcDsKICAgICAgICAgICAgICAgIG5vdHN0cmluZyA9ICIiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggcmVzY29tcCApIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3dFcnJvciggIlZhbHVlICciICsgbmFtZSArICInIGRvZXMgIiArIG5vdHN0cmluZyArICIgbWF0Y2ggJyIgKyByZWdleHAudG9TdHJpbmcoICkgKyAiJyIgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyBDaGVjayBpZiBpdCBsb29rcyBsaWtlIGFuIGVtYWlsLiBDaGVja2luZyBlbWFpbCBhZGRyZXNzZXMgd2l0aCAKICAgICAgICAvLyByZWd1bGFyIGV4cHJlc3Npb25zIGlzIGNvbXBsaWNhdGVkLCBjaGVjawogICAgICAgIC8vIGh0dHA6Ly93d3cucmVndWxhci1leHByZXNzaW9ucy5pbmZvL2VtYWlsLmh0bWwKICAgICAgICAvKioKICAgICAgICAgKiBDaGVjayBpZiB0aGUgdmFsdWUgbWF5IGlzIGFuIGVtYWlsIGFkZHJlc3MuCiAgICAgICAgICoKICAgICAgICAgKiBUaGlzIGNvbnN0cmFpbnQgcmVxdWlyZXMgdGhhdCB0aGUgdmFsdWUgaXMgb24gYSBmb3JtIHRoYXQgbWF0Y2hlcyBtb3N0IGNvbW1vbiBmb3JtcyBvZiBlbWFpbCBhZGRyZXNzLgogICAgICAgICAqIEl0IGlzIHF1aXRlIHJlbGF4ZWQsIGFuZCBtYXkgYWNjZXB0IHZhbHVlcyB0aGF0IHRydWx5IGFyZSBub3QgZW1haWwgYWRkcmVzcy4KICAgICAgICAgKiBIb3dldmVyLCBpdCBzaG91bGQgZmFpbCBvbiBtb3N0IGludmFsaWQgYWRkcmVzc2VzLgogICAgICAgICAqIElmIHRoZSBjb25zdHJhaW50IGlzIG5vdCBmdWxsZmlsbGVkLCBpdCB3aWxsIHRocm93IGFuIGVycm9yLgogICAgICAgICAqCiAgICAgICAgICogQG1ldGhvZAogICAgICAgICAqIEBuYW1lIENoZWNrT2JqZWN0SW5zdGFuY2UuZW1haWwKICAgICAgICAgKiBAc3ludGF4IENoZWNrT2JqZWN0SW5zdGFuY2UuZW1haWw7CiAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBDaGVja09iamVjdCBpbnN0YW5jZSBzdWl0YWJsZSBmb3IgY2hhaW5pbmcgY29uc3RyYWludHMKICAgICAgICAgKiBAZXhhbXBsZQogICAgICAgICAqIFZhbHVlQ2hlY2sucmVxdWlyZVRoYXQoICJmb28iLCBmb28gKS53aXRoLnR5cGUoICJzdHJpbmciICkuaXMuYW4uZW1haWwuYWRkcmVzcwogICAgICAgICAqLwogICAgICAgIHRoYXQuX19kZWZpbmVHZXR0ZXJfXyggImVtYWlsIiwgZnVuY3Rpb24oICkgewogICAgICAgICAgICAgICAgLy8gSGFjayB0byBmaXggdGhlIGhlbHAgc3lzdGVtCiAgICAgICAgICAgICAgICBpZiAoIG5hbWUgPT09IHVuZGVmaW5lZCApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fX2xvb2t1cEdldHRlcl9fKCAiZW1haWwiICk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnRhaW4oIC9eW15AXStAW15AXStcLlx3ezIsfSQvICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gKTsKCgogICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgLy8gQ2hlY2sgaWYgaXQgbG9va3MgbGlrZSBhbiB1cmwuCiAgICAgICAgLyoqCiAgICAgICAgICogQ2hlY2sgaWYgdGhlIHZhbHVlIG1heSBpcyBhbiB1cmwgYWRkcmVzcwogICAgICAgICAqCiAgICAgICAgICogVGhpcyBjb25zdHJhaW50IHJlcXVpcmVzIHRoYXQgdGhlIHZhbHVlIGlzIG9uIGEgZm9ybSB0aGF0IG1hdGNoZXMgbW9zdCBjb21tb24gZm9ybXMgb2YgdXJsIGFkZHJlc3MuCiAgICAgICAgICogSXQgaXMgcXVpdGUgcmVsYXhlZCwgYW5kIG1heSBhY2NlcHQgdmFsdWVzIHRoYXQgdHJ1bHkgYXJlIG5vdCB1cmwgYWRkcmVzcy4KICAgICAgICAgKiBIb3dldmVyLCBpdCBzaG91bGQgZmFpbCBvbiBtb3N0IGludmFsaWQgYWRkcmVzc2VzLgogICAgICAgICAqIElmIHRoZSBjb25zdHJhaW50IGlzIG5vdCBmdWxsZmlsbGVkLCBpdCB3aWxsIHRocm93IGFuIGVycm9yLgogICAgICAgICAqCiAgICAgICAgICogQG1ldGhvZAogICAgICAgICAqIEBuYW1lIENoZWNrT2JqZWN0SW5zdGFuY2UudXJsCiAgICAgICAgICogQHN5bnRheCBDaGVja09iamVjdEluc3RhbmNlLnVybDsKICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IENoZWNrT2JqZWN0IGluc3RhbmNlIHN1aXRhYmxlIGZvciBjaGFpbmluZyBjb25zdHJhaW50cwogICAgICAgICAqIEBleGFtcGxlCiAgICAgICAgICogVmFsdWVDaGVjay5yZXF1aXJlVGhhdCggImZvbyIsIGZvbyApLndpdGgudHlwZSggInN0cmluZyIgKS5pcy5hbi51cmwKICAgICAgICAgKi8KICAgICAgICB0aGF0Ll9fZGVmaW5lR2V0dGVyX18oICJ1cmwiLCBmdW5jdGlvbiggKSB7CiAgICAgICAgICAgICAgICAvLyBIYWNrIHRvIGZpeCB0aGUgaGVscCBzeXN0ZW0JCQkgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoIG5hbWUgPT09IHVuZGVmaW5lZCApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fX2xvb2t1cEdldHRlcl9fKCAidXJsIiApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb250YWluKCAvXihbXjpcL10rOlwvXC8pPyhbXjpcL10rKSg6XGQrKT8oXC8uKik/JC8gKTsKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIHByb3RvY29sICAgICAgIGhvc3QgICAgICBwb3J0ICAgcGF0aCAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSApOwoKCgogICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgLy8gVmFyaW91cyBjb21wYXJpc29uIG9wZXJhdG9ycwoKICAgICAgICAvKioKICAgICAgICAgKiBDaGVjayBpZiB0aGUgdmFsdWUgaXMgPSBhIHNwZWNpZmljIHZhbHVlLgogICAgICAgICAqIAogICAgICAgICAqIFRoaXMgY29uc3RyYWludCByZXF1aXJlcyB0aGF0IHRoZSB2YWx1ZSBpcyBlcXVhbCB0byB0aGUgdmFsdWUgcGFzc2VkIGFzCiAgICAgICAgICogcGFyYW1ldGVyIHRvIHRoZSBjb25zdHJhaW50LiBJZiB0aGUgY29uc3RyYWludCBpcyBub3QgZnVsbGZpbGxlZCwgaXQKICAgICAgICAgKiB3aWxsIHRocm93IGFuIGVycm9yLiAKICAgICAgICAgKiAKICAgICAgICAgKiBAdHlwZSB7Y2hlY2t9CiAgICAgICAgICogQHN5bnRheCBDaGVja09iamVjdEluc3RhbmNlLmVxdWFsVG8oIHZhbHVlICk7CiAgICAgICAgICogQHBhcmFtIHtBbnl9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjayB0aGUgZW5jYXBzdWxhdGVkIHZhbHVlIGFnYWluc3QKICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IENoZWNrT2JqZWN0IGluc3RhbmNlIHN1aXRhYmxlIGZvciBjaGFpbmluZyBjb25zdHJhaW50cwogICAgICAgICAqIEBleGFtcGxlIFZhbHVlQ2hlY2suY2hlY2tUaGF0KCAiZm9vIiwgZm9vICkuaXMuZGVmaW5lZC53aXRoLnR5cGUoICJudW1iZXIiICkuYW5kLnZhbHVlLnRoYXQuaXMuZXF1YWxUbyggNDIgKTsKICAgICAgICAgKiAgIFZhbHVlQ2hlY2suY2hlY2soICJmb28iLCBmb28gKS50eXBlKCAic3RyaW5nIiApLmVxdWFsVG8oICJrYW5vbmtvbmdlIiApOwogICAgICAgICAqIEBuYW1lIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QuZXF1YWxUbwogICAgICAgICAqIEBtZXRob2QKICAgICAgICAgKi8KICAgICAgICB0aGF0LmVxdWFsVG8gPSBmdW5jdGlvbiggdmFsdWUgKSB7CiAgICAgICAgICAgIGNoZWNrdGhyb3dOZWVkMUFyZ0Vycm9yKCAiZXF1YWxUbyIsIGFyZ3VtZW50cy5sZW5ndGggKTsKICAgICAgICAgICAgcmV0dXJuIGNvbXBhcmUoIG9wZXJhdG9yLmVxdWFsaXR5LCB2YWx1ZSApOwogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrIGlmIHRoZSB2YWx1ZSBpcyAhPSBhIHNwZWNpZmljIHZhbHVlLgogICAgICAgICAqIAogICAgICAgICAqIFRoaXMgY29uc3RyYWludCByZXF1aXJlcyB0aGF0IHRoZSB2YWx1ZSBpcyBub3QgZXF1YWwgdG8gdGhlIHZhbHVlCiAgICAgICAgICogcGFzc2VkIGFzIHBhcmFtZXRlciB0byB0aGUgY29uc3RyYWludC4gSWYgdGhlIGNvbnN0cmFpbnQgaXMgbm90CiAgICAgICAgICogZnVsbGZpbGxlZCwgaXQgd2lsbCB0aHJvdyBhbiBlcnJvci4gCiAgICAgICAgICogCiAgICAgICAgICogQHR5cGUge2NoZWNrfQogICAgICAgICAqIEBzeW50YXggQ2hlY2tPYmplY3RJbnN0YW5jZS51bmVxdWFsVG8oIHZhbHVlICk7CiAgICAgICAgICogQHBhcmFtIHtBbnl9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjayB0aGUgZW5jYXBzdWxhdGVkIHZhbHVlIGFnYWluc3QKICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IENoZWNrT2JqZWN0IGluc3RhbmNlIHN1aXRhYmxlIGZvciBjaGFpbmluZyBjb25zdHJhaW50cwogICAgICAgICAqIEBleGFtcGxlIFZhbHVlQ2hlY2suY2hlY2tUaGF0KCAiZm9vIiwgZm9vICkuaXMuZGVmaW5lZC53aXRoLnR5cGUoICJudW1iZXIiICkuYW5kLnZhbHVlLnRoYXQuaXMudW5lcXVhbFRvKCA0MiApOwogICAgICAgICAqICAgVmFsdWVDaGVjay5jaGVjayggImZvbyIsIGZvbyApLnR5cGUoICJzdHJpbmciICkudW5lcXVhbFRvKCAia2Fub25rb25nZSIgKTsKICAgICAgICAgKiBAbmFtZSBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0LnVuZXF1YWxUbwogICAgICAgICAqIEBtZXRob2QKICAgICAgICAgKi8KICAgICAgICB0aGF0LnVuZXF1YWxUbyA9IGZ1bmN0aW9uKCB2YWx1ZSApIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubm90LmVxdWFsVG8oIHZhbHVlICk7CiAgICAgICAgfTsKCiAgICAgICAgLyoqCiAgICAgICAgICogQ2hlY2sgaWYgdGhlIHZhbHVlIGlzID4gdGhhbiBhIHNwZWNpZmljIHZhbHVlLgogICAgICAgICAqIAogICAgICAgICAqIFRoaXMgY29uc3RyYWludCByZXF1aXJlcyB0aGF0IHRoZSB2YWx1ZSBpcyBncmVhdGVyIHRoYW4gdGhlIHZhbHVlCiAgICAgICAgICogcGFzc2VkIGFzIHBhcmFtZXRlciB0byB0aGUgY29uc3RyYWludC4gSWYgdGhlIGNvbnN0cmFpbnQgaXMgbm90CiAgICAgICAgICogZnVsbGZpbGxlZCwgaXQgd2lsbCB0aHJvdyBhbiBlcnJvci4gCiAgICAgICAgICogCiAgICAgICAgICogQHR5cGUge2NoZWNrfQogICAgICAgICAqIEBzeW50YXggQ2hlY2tPYmplY3RJbnN0YW5jZS5ncmVhdGVyVGhhbiggbWluVmFsdWUgKTsKICAgICAgICAgKiBAcGFyYW0ge0FueX0gbWluVmFsdWUgVGhlIG1pbmltdW0gdmFsdWUgb2YgdGhlIGVuY2Fwc3VsYXRlZCB2YWx1ZQogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2hlY2tPYmplY3QgaW5zdGFuY2Ugc3VpdGFibGUgZm9yIGNoYWluaW5nIGNvbnN0cmFpbnRzCiAgICAgICAgICogQGV4YW1wbGUgVmFsdWVDaGVjay5jaGVja1RoYXQoICJmb28iLCBmb28gKS5pcy5kZWZpbmVkLndpdGgudHlwZSggIm51bWJlciIgKS5hbmQudmFsdWUuZ3JlYXRlclRoYW4oIDEwICk7CiAgICAgICAgICogICBWYWx1ZUNoZWNrLmNoZWNrKCAiZm9vIiwgZm9vICkuZ3JlYXRlclRoYW4oICJrYW5vbmtvbmdlIiApOwogICAgICAgICAqIEBuYW1lIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QuZ3JlYXRlclRoYW4KICAgICAgICAgKiBAbWV0aG9kCiAgICAgICAgICovCiAgICAgICAgdGhhdC5ncmVhdGVyVGhhbiA9IGZ1bmN0aW9uKCBtaW5WYWx1ZSApIHsKICAgICAgICAgICAgY2hlY2t0aHJvd05lZWQxQXJnRXJyb3IoICJncmVhdGVyVGhhbiIsIGFyZ3VtZW50cy5sZW5ndGggKTsKICAgICAgICAgICAgcmV0dXJuIGNvbXBhcmUoIG9wZXJhdG9yLmdyZWF0ZXJ0aGFuLCBtaW5WYWx1ZSApOwogICAgICAgIH07CgoKICAgICAgICAvKioKICAgICAgICAgKiBDaGVjayBpZiB0aGUgdmFsdWUgaXMgPD0gYSBzcGVjaWZpYyB2YWx1ZS4KICAgICAgICAgKiAKICAgICAgICAgKiBUaGlzIGNvbnN0cmFpbnQgcmVxdWlyZXMgdGhhdCB0aGUgdmFsdWUgaXMgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIHRoZQogICAgICAgICAqIHZhbHVlIHBhc3NlZCBhcyBwYXJhbWV0ZXIgdG8gdGhlIGNvbnN0cmFpbnQuIElmIHRoZSBjb25zdHJhaW50IGlzIG5vdAogICAgICAgICAqIGZ1bGxmaWxsZWQsIGl0IHdpbGwgdGhyb3cgYW4gZXJyb3IuIAogICAgICAgICAqIAogICAgICAgICAqIEB0eXBlIHtjaGVja30KICAgICAgICAgKiBAc3ludGF4IENoZWNrT2JqZWN0SW5zdGFuY2UubGVzc0VxdWFsVGhhbiggbWF4VmFsdWUgKTsKICAgICAgICAgKiBAcGFyYW0ge0FueX0gbWF4VmFsdWUgVGhlIG1heGltdW0gdmFsdWUgb2YgdGhlIGVuY2Fwc3VsYXRlZCB2YWx1ZQogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2hlY2tPYmplY3QgaW5zdGFuY2Ugc3VpdGFibGUgZm9yIGNoYWluaW5nIGNvbnN0cmFpbnRzCiAgICAgICAgICogQGV4YW1wbGUgVmFsdWVDaGVjay5jaGVja1RoYXQoICJmb28iLCBmb28gKS5pcy5kZWZpbmVkLndpdGgudHlwZSggIm51bWJlciIgKS5hbmQudmFsdWUubGVzc0VxdWFsVGhhbiggLTEwICk7CiAgICAgICAgICogICBWYWx1ZUNoZWNrLmNoZWNrKCAiZm9vIiwgZm9vICkuaXMuZGVmaW5lZC5sZXNzRXF1YWxUaGFuKCAia2Fub25rb25nZSIgKTsKICAgICAgICAgKiBAbmFtZSBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0Lmxlc3NFcXVhbFRoYW4KICAgICAgICAgKiBAbWV0aG9kCiAgICAgICAgICovCiAgICAgICAgdGhhdC5sZXNzRXF1YWxUaGFuID0gZnVuY3Rpb24oIG1heFZhbHVlICkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ub3QuZ3JlYXRlclRoYW4oIG1heFZhbHVlICk7CiAgICAgICAgfTsKCiAgICAgICAgLyoqCiAgICAgICAgICogQ2hlY2sgaWYgdGhlIHZhbHVlIGlzIDwgdGhhbiBhIHNwZWNpZmljIHZhbHVlLgogICAgICAgICAqIAogICAgICAgICAqIFRoaXMgY29uc3RyYWludCByZXF1aXJlcyB0aGF0IHRoZSB2YWx1ZSBpcyBsZXNzIHRoYW4gdGhlIHZhbHVlIHBhc3NlZAogICAgICAgICAqIGFzIHBhcmFtZXRlciB0byB0aGUgY29uc3RyYWludC4gSWYgdGhlIGNvbnN0cmFpbnQgaXMgbm90IGZ1bGxmaWxsZWQsIGl0CiAgICAgICAgICogd2lsbCB0aHJvdyBhbiBlcnJvci4gCiAgICAgICAgICogCiAgICAgICAgICogQHR5cGUge2NoZWNrfQogICAgICAgICAqIEBzeW50YXggQ2hlY2tPYmplY3RJbnN0YW5jZS5sZXNzVGhhbiggbWF4VmFsdWUgKTsKICAgICAgICAgKiBAcGFyYW0ge0FueX0gbWF4VmFsdWUgVGhlIG1heGltdW0gdmFsdWUgb2YgdGhlIGVuY2Fwc3VsYXRlZCB2YWx1ZQogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2hlY2tPYmplY3QgaW5zdGFuY2Ugc3VpdGFibGUgZm9yIGNoYWluaW5nIGNvbnN0cmFpbnRzCiAgICAgICAgICogQGV4YW1wbGUgVmFsdWVDaGVjay5jaGVja1RoYXQoICJmb28iLCBmb28gKS5pcy5kZWZpbmVkLndpdGgudHlwZSggIm51bWJlciIgKS5hbmQudmFsdWUubGVzc1RoYW4oIC0xMCApOwogICAgICAgICAqICAgVmFsdWVDaGVjay5jaGVjayggImZvbyIsIGZvbyApLnR5cGUoICJzdHJpbmciICkubGVzc1RoYW4oICJrYW5vbmtvbmdlIiApOwogICAgICAgICAqIEBuYW1lIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QubGVzc1RoYW4KICAgICAgICAgKiBAbWV0aG9kCiAgICAgICAgICovCiAgICAgICAgdGhhdC5sZXNzVGhhbiA9IGZ1bmN0aW9uKCBtYXhWYWx1ZSApIHsKICAgICAgICAgICAgY2hlY2t0aHJvd05lZWQxQXJnRXJyb3IoICJsZXNzVGhhbiIsIGFyZ3VtZW50cy5sZW5ndGggKTsKICAgICAgICAgICAgcmV0dXJuIGNvbXBhcmUoIG9wZXJhdG9yLmxlc3N0aGFuLCBtYXhWYWx1ZSApOwogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrIGlmIHRoZSB2YWx1ZSBpcyA+PSBhIHNwZWNpZmljIHZhbHVlLgogICAgICAgICAqIAogICAgICAgICAqIFRoaXMgY29uc3RyYWludCByZXF1aXJlcyB0aGF0IHRoZSB2YWx1ZSBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gdGhlCiAgICAgICAgICogdmFsdWUgcGFzc2VkIGFzIHBhcmFtZXRlciB0byB0aGUgY29uc3RyYWludC4gSWYgdGhlIGNvbnN0cmFpbnQgaXMgbm90CiAgICAgICAgICogZnVsbGZpbGxlZCwgaXQgd2lsbCB0aHJvdyBhbiBlcnJvci4gCiAgICAgICAgICogCiAgICAgICAgICogQHR5cGUge2NoZWNrfQogICAgICAgICAqIEBzeW50YXggQ2hlY2tPYmplY3RJbnN0YW5jZS5ncmVhdGVyRXF1YWxUaGFuKCBtaW5WYWx1ZSApOwogICAgICAgICAqIEBwYXJhbSB7QW55fSBtaW5WYWx1ZSBUaGUgbWluaW11bSB2YWx1ZSBvZiB0aGUgZW5jYXBzdWxhdGVkIHZhbHVlCiAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBDaGVja09iamVjdCBpbnN0YW5jZSBzdWl0YWJsZSBmb3IgY2hhaW5pbmcgY29uc3RyYWludHMKICAgICAgICAgKiBAZXhhbXBsZSBWYWx1ZUNoZWNrLmNoZWNrVGhhdCggImZvbyIsIGZvbyApLmlzLmRlZmluZWQud2l0aC50eXBlKCAibnVtYmVyIiApLmFuZC52YWx1ZS5ncmVhdGVyRXF1YWxUaGFuKCAxMCApOwogICAgICAgICAqICAgVmFsdWVDaGVjay5jaGVjayggImZvbyIsIGZvbyApLmdyZWF0ZXJFcXVhbFRoYW4oICJrYW5vbmtvbmdlIiApOwogICAgICAgICAqIEBuYW1lIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QuZ3JlYXRlckVxdWFsVGhhbgogICAgICAgICAqIEBtZXRob2QKICAgICAgICAgKi8KICAgICAgICB0aGF0LmdyZWF0ZXJFcXVhbFRoYW4gPSBmdW5jdGlvbiggbWluVmFsdWUgKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm5vdC5sZXNzVGhhbiggbWluVmFsdWUgKTsKICAgICAgICB9OwoKICAgICAgICAvKioKICAgICAgICAgKiBDaGVjayBpZiB0aGUgdmFsdWUgaXMgaW5zaWRlIGEgc3BlY2lmaWMgaW50ZXJ2YWwuCiAgICAgICAgICogCiAgICAgICAgICogVGhpcyBjb25zdHJhaW50IHJlcXVpcmVzIHRoYXQgdGhlIHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB0aGUKICAgICAgICAgKiBtaW5WYWx1ZSBwYXNzZWQgYW5kIGxlc3MgdGhhbiBvciBlcXVhbCB0byB0aGUgbWF4VmFsdWUgcGFzc2VkIGFzCiAgICAgICAgICogcGFyYW1ldGVyIHRvIHRoZSBjb25zdHJhaW50LiBJZiB0aGUgY29uc3RyYWludCBpcyBub3QgZnVsbGZpbGxlZCwgaXQKICAgICAgICAgKiB3aWxsIHRocm93IGFuIGVycm9yLiBOb3RlLCB0aGF0IHRoaXMgY29uc3RyYWludCBpcyBpbmNsdXNpdmUsIGV2ZW4gZm9yCiAgICAgICAgICogbm90LiBUaGF0IGlzLCBub3QuaW5zaWRlIHdpbGwgcmV0dXJuIHRoZSBzYW1lIHJlc3VsdCBhcyBvdXRzaWRlLiAKICAgICAgICAgKiAKICAgICAgICAgKiBAdHlwZSB7Y2hlY2t9CiAgICAgICAgICogQHN5bnRheCBDaGVja09iamVjdEluc3RhbmNlLmluc2lkZSggbWluVmFsdWUsIG1heFZhbHVlICk7CiAgICAgICAgICogQHBhcmFtIHtBbnl9IG1pblZhbHVlIFRoZSBtaW5pbXVtIHZhbHVlIG9mIHRoZSBlbmNhcHN1bGF0ZWQgdmFsdWUgKGluY2x1c2l2ZSkKICAgICAgICAgKiBAcGFyYW0ge0FueX0gbWF4VmFsdWUgVGhlIG1heGltdW0gdmFsdWUgb2YgdGhlIGVuY2Fwc3VsYXRlZCB2YWx1ZSAoaW5jbHVzaXZlKQogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2hlY2tPYmplY3QgaW5zdGFuY2Ugc3VpdGFibGUgZm9yIGNoYWluaW5nIGNvbnN0cmFpbnRzCiAgICAgICAgICogQGV4YW1wbGUgVmFsdWVDaGVjay5jaGVja1RoYXQoICJmb28iLCBmb28gKS5pcy5kZWZpbmVkLndpdGgudHlwZSggIm51bWJlciIgKS5hbmQudmFsdWUuaW5zaWRlKCAxMCwgMjAgKTsKICAgICAgICAgKiAgICAgVmFsdWVDaGVjay5jaGVjayggImZvbyIsIGZvbyApLmluc2lkZSggImthbm9ua29uZ2UiLCAibGVvcGFyZCIgKTsKICAgICAgICAgKiBAbmFtZSBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0Lmluc2lkZQogICAgICAgICAqIEBtZXRob2QKICAgICAgICAgKi8KICAgICAgICB0aGF0Lmluc2lkZSA9IGZ1bmN0aW9uKCBtaW5WYWx1ZSwgbWF4VmFsdWUgKSB7CiAgICAgICAgICAgIGNoZWNrdGhyb3dOZWVkMkFyZ3NFcnJvciggImluUmFuZ2UiLCBhcmd1bWVudHMubGVuZ3RoICk7CiAgICAgICAgICAgIGlmICggIW5vdGZsYWcgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ncmVhdGVyRXF1YWxUaGFuKCBtaW5WYWx1ZSApLmxlc3NFcXVhbFRoYW4oIG1heFZhbHVlICk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBOb3QgY2hhbmdlcyB0aGlzIHRvIGFuIG9yLiBDaGVjayBpZiB3ZSBhcmUgb3V0c2lkZS4KICAgICAgICAgICAgICAgIG5vdGZsYWcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhpcyBzdWNjZWRzLCBpdCB3YXMgb3V0c2lkZSB0b3AuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3JlYXRlclRoYW4oIG1heFZhbHVlICk7CiAgICAgICAgICAgICAgICB9IGNhdGNoICggZXJyb3IxICkgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRyeSBpZiBvdXRzaWRlIGJvdHRvbS4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGVzc1RoYW4oIG1pblZhbHVlICk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoIGVycm9yMiApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJvdmlkZSByZWFzb25hYmx5IGVycm9yIG1lc3NhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dFcnJvciggIlZhbHVlICciICsgbmFtZSArICInIDogJyIgKyB2YWx1ZSArICInIGlzIG5vdCBvdXRzaWRlIHJhbmdlICciICsgbWluVmFsdWUgKyAiJywgJyIgKyBtYXhWYWx1ZSArICInIiApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrIGlmIHRoZSB2YWx1ZSBpcyBub3QgaW5zaWRlIGEgc3BlY2lmaWMgaW50ZXJ2YWwuCiAgICAgICAgICogCiAgICAgICAgICogVGhpcyBjb25zdHJhaW50IHJlcXVpcmVzIHRoYXQgdGhlIHZhbHVlIGlzIGVpdGhlciBsZXNzIHRoYW4gdGhlCiAgICAgICAgICogbWluVmFsdWUgcGFzc2VkIG9yIGdyZWF0ZXIgdGhhbiB0aGUgdGhlIG1heFZhbHVlIHBhc3NlZCBhcyBwYXJhbWV0ZXIgdG8KICAgICAgICAgKiB0aGUgY29uc3RyYWludC4gSWYgdGhlIGNvbnN0cmFpbnQgaXMgbm90IGZ1bGxmaWxsZWQsIGl0IHdpbGwgdGhyb3cgYW4KICAgICAgICAgKiBlcnJvci4gTm90ZSwgdGhhdCBjYWxsaW5nIG91dHNpZGUoIGEsIGIgKSBpcyBzZW1hbnRpY2FsbHkgZXF1aXZhbGVudCB0bwogICAgICAgICAqIGNhbGxpbmcgbm90Lmluc2lkZSggYSwgYiApLiAKICAgICAgICAgKiAKICAgICAgICAgKiBAdHlwZSB7Y2hlY2t9CiAgICAgICAgICogQHN5bnRheCBDaGVja09iamVjdEluc3RhbmNlLm91dHNpZGUoIG1pblZhbHVlLCBtYXhWYWx1ZSApOwogICAgICAgICAqIEBwYXJhbSB7QW55fSBtaW5WYWx1ZSBUaGUgbWluaW11bSB2YWx1ZSBvZiB0aGUgaW50ZXJ2YWwgdGhhdCB0aGUgZW5jYXBzdWxhdGVkIHZhbHVlIG11c3Qgbm8gYmUgcGFydCBvZiAoaW5jbHVzaXZlKQogICAgICAgICAqIEBwYXJhbSB7QW55fSBtYXhWYWx1ZSBUaGUgbWF4aW11bSB2YWx1ZSBvZiB0aGUgaW50ZXJ2YWwgdGhhdCB0aGUgZW5jYXBzdWxhdGVkIHZhbHVlIG11c3Qgbm90IGJlIHBhcnQgb2YoaW5jbHVzaXZlKQogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2hlY2tPYmplY3QgaW5zdGFuY2Ugc3VpdGFibGUgZm9yIGNoYWluaW5nIGNvbnN0cmFpbnRzCiAgICAgICAgICogQGV4YW1wbGUgVmFsdWVDaGVjay5jaGVja1RoYXQoICJmb28iLCBmb28gKS5pcy5kZWZpbmVkLndpdGgudHlwZSggIm51bWJlciIgKS5hbmQudmFsdWUub3V0c2lkZSggMTAsIDIwICk7CiAgICAgICAgICogICAgIFZhbHVlQ2hlY2suY2hlY2soICJmb28iLCBmb28gKS5vdXRzaWRlKCAia2Fub25rb25nZSIsICJsZW9wYXJkIiApOwogICAgICAgICAqIEBuYW1lIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3Qub3V0c2lkZQogICAgICAgICAqIEBtZXRob2QKICAgICAgICAgKi8KICAgICAgICB0aGF0Lm91dHNpZGUgPSBmdW5jdGlvbiggbWluVmFsdWUsIG1heFZhbHVlICkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ub3QuaW5zaWRlKCBtaW5WYWx1ZSwgbWF4VmFsdWUgKTsKICAgICAgICB9OwoKCiAgICAgICAgLyoqCiAgICAgICAgICogQ2hlY2sgaWYgdGhlIHZhbHVlIGlzIGlzIG9uZSBvZiBzZXZlcmFsIHNwZWNpZmljIHZhbHVlcy4KICAgICAgICAgKiAKICAgICAgICAgKiBUaGlzIGNvbnN0cmFpbnQgcmVxdWlyZXMgdGhhdCB0aGUgdmFsdWUgaXMgZm91bmQgaW4gdGhlIGFycmF5IHBhc3NlZCBhcwogICAgICAgICAqIHBhcmFtZXRlciB0byB0aGUgY29uc3RyYWludC4gSWYgdGhlIGNvbnN0cmFpbnQgaXMgbm90IGZ1bGxmaWxsZWQsIGl0CiAgICAgICAgICogd2lsbCB0aHJvdyBhbiBlcnJvci4gCiAgICAgICAgICogCiAgICAgICAgICogQHR5cGUge2NoZWNrfQogICAgICAgICAqIEBzeW50YXggQ2hlY2tPYmplY3RJbnN0YW5jZS5vdXRzaWRlKCBsZWdhbFZhbHVlcyApOwogICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IGxlZ2FsVmFsdWVzIEFuIGFycmF5IG9mIGxlZ2FsIHZhbHVlcyBmb3IgdGhlIGVuY2Fwc3VsYXRlZCB2YWx1ZQogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2hlY2tPYmplY3QgaW5zdGFuY2Ugc3VpdGFibGUgZm9yIGNoYWluaW5nIGNvbnN0cmFpbnRzCiAgICAgICAgICogQGV4YW1wbGUgVmFsdWVDaGVjay5jaGVja1RoYXQoICJmb28iLCBmb28gKS5pcy5kZWZpbmVkLndpdGgudHlwZSggIm51bWJlciIgKS5hbmQudmFsdWUuaW4oIFsgMTAsIDE3LCAyMCwgNDIsIDQ1MCBdICk7CiAgICAgICAgICogICAgIFZhbHVlQ2hlY2suY2hlY2soICJmb28iLCBmb28gKS5pbihbICAia2Fub25rb25nZSIsICJzdXBlcmhlbHQiLCAic29mdHdhcmV1ZHZpa2xlciIgXSApOwogICAgICAgICAqIEBuYW1lIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QuaW4KICAgICAgICAgKiBAbWV0aG9kCiAgICAgICAgICovCiAgICAgICAgdGhhdC4gaW4gPSBmdW5jdGlvbiggbGVnYWxWYWx1ZXMgKSB7CiAgICAgICAgICAgIGNoZWNrdGhyb3dOZWVkMUFyZ0Vycm9yKCAiaW4iLCBhcmd1bWVudHMubGVuZ3RoICk7CiAgICAgICAgICAgIHZhciByZXMgPSAoIC0xICE9PSBsZWdhbFZhbHVlcy5pbmRleE9mKCB2YWx1ZSApICk7CiAgICAgICAgICAgIHZhciBub3RzdHJpbmcgPSAibm90ICI7CiAgICAgICAgICAgIGlmICggbm90ZmxhZyApIHsKICAgICAgICAgICAgICAgIHJlcyA9ICFyZXM7CiAgICAgICAgICAgICAgICBub3RzdHJpbmcgPSAiIjsKICAgICAgICAgICAgICAgIG5vdGZsYWcgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoICFyZXMgKSB7CiAgICAgICAgICAgICAgICB0aHJvd0Vycm9yKCAiVmFsdWUgb2YgJyIgKyBuYW1lICsgIicgOiAnIiArIHZhbHVlICsgIicgaXMgIiArIG5vdHN0cmluZyArICJpbiAiICsgbGVnYWxWYWx1ZXMgKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgLy8gRG9jdW1lbnQgaW5zdGFuY2UKCiAgICAgICAgLy8gUmV0dXJuIGl0CiAgICAgICAgcmV0dXJuIHRoYXQ7CiAgICB9OwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vIFRvIG1ha2UgYXZhaWxhYmxlIGZvciBkb2N1bWVudGF0aW9uLCBhIGR1bW15IG9iamVjdAogICAgLy8gVGhpcyBrZWVwcyBuYW1lID09PSB1bmRlZmluZWQsIHdoaWNoIGlzIE5PVCBhbGxvd2VkLCBidXQgaGVyZSB3ZSB1c2UgaXQgdG8gY2hhbmdlIHRoZSBiZWhhdmlvdXIgdG8gYWxsb3cgb25saW5lIGhlbHAuCiAgICAvLyBUcmlja3ksIHRyaWNreSBiZWhhdmlvdXIuLi4gaW5kZWVkIDotKSAoV2lsbCBwcm9iYWJseSBiaXRlIG1lIHNvbWV0aW1lIGluIHRoZSBmdXR1cmUpLgogICAgLyoqCiAgICAgKiBPYmplY3QgdGhhdCBlbmNhcHN1bGF0ZXMgYSB2YWx1ZSwgYW5kIGFsbG93IHRvIHNwZWNpZnkgY29uc3RyYWludHMuCiAgICAgKiAKICAgICAqIEluc3RhbmNlcyBvZiB0aGlzIGtpbmQgb2Ygb2JqZWN0IGhvbGRzIGEgdmFsdWUsIHBhc3NlZCB0byBpdCBkdXJpbmcKICAgICAqIGNvbnN0cnVjdGlvbiwgYW5kIHByb3ZpZGVzIG1ldGhvZHMgdG8gY2hlY2sgY29uc3RyYWludHMgb24gaXQuIEl0IGlzCiAgICAgKiBkZXNpZ25lZCB0byBwcm92aWRlIGFuIGVhc3kgbWVjaGFuaXNtIHRvIGNoZWNrIGUuZy4gdmFsdWVzIHBhc3NlZCB0byBhCiAgICAgKiBmdW5jdGlvbiBvciBzaW1pbGFyLiBZb3Ugc3BlZmljeSBjb25zdHJhaW50cyBieSBjYWxsaW5nIG1ldGhvZHMgb24gdGhlCiAgICAgKiBvYmplY3QgdGhhdCBlbmNhcHN1bGF0ZXMgdGhlIHZhbHVlLiBBbGwgbWV0aG9kcyB0aHJvdyBpZiB0aGUgY29uc3RyYWludAogICAgICogaXMgbm90IGZ1bGxmaWxsZWQsIGFuZCByZXR1cm4gYW4gaW5zdGFuc2Ugb2YgdGhpcyBvYmplY3Qgb3RoZXJ3aXNlLAogICAgICogZW5hYmxpbmcgY2hhaW5pbmcgdGhlIGNvbnN0cmFpbnRzIGFyYml0cmFyZWx5LiBDb25zdHJ1Y3QgaW5zdGFuY2VzIG9mCiAgICAgKiB0aGlzIG9iamVjdCwgYnkgY2FsbGluZyBWYWx1ZUNoZWNrLmNoZWNrKiBtZXRob2RzLiAKICAgICAqCiAgICAgKiAqKlRPRE86KiogTUJEIFNob3VsZCBmaXggdGhlIGNvbnN0cmFpbnRzIGRvY3VtZW50YXRpb24gZm9yIHRoaXMgbW9kdWxlLgogICAgICogCiAgICAgKiBAdHlwZSB7T2JqZWN0fQogICAgICogQGV4YW1wbGUgVmFsdWVDaGVjay5jaGVja1RoYXQoICJmb28iLCBmb28gKS5pcy5kZWZpbmVkLmFuZC5oYXMudHlwZSggInN0cmluZyIgKS5hbmQuaXMubm90LmVxdWFsVG8oICIiICk7CiAgICAgKiBAbmFtZSBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0CiAgICAgKiBAbmFtZXNwYWNlICovCiAgICB0aGF0LkNoZWNrT2JqZWN0ID0gY2hlY2tPYmplY3QoIHVuZGVmaW5lZCwgdW5kZWZpbmVkICk7CgoKICAgIC8qKiBDaGVjayBhIHNwZWNpZmljIHBhcmFtZXRlci92YXJpYWJsZSwgZXZlbiBmb3IgdW5kZWZpbmVkLiAKICAgKgogICAqIFRoaXMgbWV0aG9kIGNvbnN0cnVjdHMgYW4gaW5zdGFuY2Ugb2YgYW4gQ2hlY2tPYmplY3Qgb2JqZWN0LCB3aGljaAogICAqIGNhbiBiZSB1c2VkIHRvIGNoZWNrIGNvbnN0cmFpbnRzIG9uIHRoZSBwYXJhbWV0ZXIvdmFyaWFibGUgcGFzc2VkLiBUaGUKICAgKiBjb25zdHJ1Y3RvciBkaWZmZXJzIGZyb20gdGhlIG90aGVyIGNoZWNrXCogbWV0aG9kcyBpbiB0aGF0IG5vCiAgICogZGVmaW5lZC91bmRlZmluZWQgY2hlY2sgaXMgcGVyZm9ybWVkLiBUaGlzIGFsbG93IGNoZWNraW5nIGUuZy4gdGhhdCB0aGUKICAgKiB2YWx1ZSBpcyB1bmRlZmluZWQgb3Igc29tZSBzcGVjaWZpYyB2YWx1ZS4gVGhlIGludGVudGlvbiBpcyB0aGF0IHlvdQogICAqIGNoYWluIGFkZGl0aW9uYWwgY29uc3RyYWludHMuIFRoZSBzeW50YXggaXMgcXVpdGUgZmxleGlibGUgYW5kIGNhbiBiZQogICAqIHdyaXR0ZW4gdmVyeSByZWFkYWJsZS4gCiAgICogIAogICAqIEBtZXRob2QKICAgKiBAZXhhbXBsZSAKLy8gVGhlIGV4YW1wbGVzIGJlbG93IGlsbHVzdHJhdGVzIHNvbWUgb2YgdGhlIGNoZWNrcyB0aGF0IGlzIHBvc3NpYmx5IHdpdGggdGhpcyBtZXRob2QKVmFsdWVDaGVjay5jaGVja1ZhbHVlKCAiZm9vIiwgZm9vICkuaXMuZGVmaW5lZC5hbmQuaGFzLnR5cGUoICJzdHJpbmciICkuYW5kLnZhbHVlLnRoYXQuaXMubm90LmVxdWFsVG8oICIiICk7ClZhbHVlQ2hlY2suY2hlY2tWYWx1ZSggImZvbyIsIGZvbyApLmlzLmluLiggWyB1bmRlZmluZWQsICJiaWJsaW90ZWtkayIsICJwYWxsZXNnYXZlYm9kIiBdICk7CiAgICogQHN5bnRheCBWYWx1ZUNoZWNrLmNoZWNrVmFsdWUoIHBhcmFtbmFtZSwgcGFyYW12YWx1ZSApOwogICAqIEBwYXJhbSB7c3RyaW5nfSBwYXJhbW5hbWUgVGhlIG5hbWUgb2YgdGhlIHBhcmFtZXRlci92YXJpYWJsZSB0byBjaGVjay4gVXNlZCB0byBjb25zdHJ1Y3QgbWVhbmluZ2Z1bCBlcnJvciByZXBvcnRzCiAgICogQHBhcmFtIHtvYmplY3R9IHBhcmFtdmFsdWUgVGhlIHZhbHVlIG9mIHRoZSBwYXJhbWV0ZXIvdmFyaWFibGUgdG8gY2hlY2suCiAgICogQHJldHVybiB7VmFsdWVDaGVjay5DaGVja09iamVjdH0gQSBDaGVja09iamVjdCBpbnN0YW5jZSwgdGhhdCBjYW4gYmUgdXNlZCB0byBjaGVjayB0aGUgdmFsdWUgZm9yIG1vcmUgY29uc3RyYWludHMKICAgKiBAbmFtZSBWYWx1ZUNoZWNrLmNoZWNrVmFsdWUKICAgKi8KICAgIHRoYXQuY2hlY2tWYWx1ZSA9IGZ1bmN0aW9uKCBwYXJhbW5hbWUsIHBhcmFtdmFsdWUgKSB7CiAgICAgICAgaWYgKCBhcmd1bWVudHMubGVuZ3RoICE9IDIgKSB7CiAgICAgICAgICAgIHRocm93RXJyb3IoICJDaGVja1ZhbHVlIG5lZWRzIGV4YWN0bHkgMiBhcmd1bWVudHMiICk7CiAgICAgICAgfQogICAgICAgIC8vIEFidXNlIGEgdGVtcG9yYXJ5IG9iamVjdCwgdG8gY2hlY2sgcGFyYW1uYW1lCiAgICAgICAgKCBmdW5jdGlvbiggKSB7CiAgICAgICAgICAgICAgICB2YXIgdG1wID0gY2hlY2tPYmplY3QoICJwYXJhbW5hbWUiLCBwYXJhbW5hbWUgKTsKICAgICAgICAgICAgICAgIHRtcC5kZWZpbmVkLnR5cGUoICJzdHJpbmciICkudW5lcXVhbFRvKCAiIiApOwogICAgICAgICAgICB9KCApICk7CiAgICAgICAgLy8gTm93IGNvbnN0cnVjdCB0aGUgcmVhbCBvYmplY3QgYW5kIHJldHVybiBpdC4KICAgICAgICByZXR1cm4gY2hlY2tPYmplY3QoIHBhcmFtbmFtZSwgcGFyYW12YWx1ZSApOwogICAgfTsKCgogICAgLyoqCiAgICAgKiBDaGVjayBhIHNwZWNpZmljIHBhcmFtZXRlci92YXJpYWJsZSwgd2l0aCBpbXBsaWNpdCBjaGVjayBmb3IgdW5kZWZpbmVkLgogICAgICogCiAgICAgKiBUaGlzIGNvbnN0cnVjdG9yIGNvbnN0cnVjdHMgYW4gaW5zdGFuY2Ugb2YgYW4gQ2hlY2tPYmplY3Qgb2JqZWN0LCB3aGljaAogICAgICogY2FuIGJlIHVzZWQgdG8gY2hlY2sgY29uc3RyYWludHMgb24gdGhlIHBhcmFtZXRlci92YXJpYWJsZSBwYXNzZWQuIFRoZQogICAgICogZmlyc3QgY2hlY2sgaXMgaW1wbGljaXQ6IHRoZSB2YWx1ZSBtdXN0IG5vdCBiZSB1bmRlZmluZWQuIFRoZSBpbnRlbnRpb24KICAgICAqIGlzIHRoYXQgeW91IGNoYWluIGFkZGl0aW9uYWwgY29uc3RyYWludHMuIFRoZSBzeW50YXggaXMgcXVpdGUgZmxleGlibGUKICAgICAqIGFuZCBjYW4gYmUgd3JpdHRlbiB2ZXJ5IHJlYWRhYmxlLiBUaGUgdmFyaW91cyBmb3JtcyBkb2VzIHRoZSBzYW1lLCBhbmQKICAgICAqIHlvdSBhcmUgZnJlZSB0byBjaG9vc2Ugd2hpY2hldmVyIGJlc3Qgc3VpdHMgeW91ciBzdHlsZS4gCiAgICAgKgogICAgICogKipOb3RlOioqIFRoZSBmdW5jdGlvbnMgY2hlY2ssIGNoZWNrVGhhdCwgYW5kIHJlcXVpcmVUaGF0IGFyZSBhbGlhc2VzIGZvciB0aGUgc2FtZSBmdW5jdGlvbi4KICAgICAqIAogICAgICogQHN5bnRheCBWYWx1ZUNoZWNrLmNoZWNrKCBwYXJhbW5hbWUsIHBhcmFtdmFsdWUgKTsKICAgICAqICAgVmFsdWVDaGVjay5jaGVja1RoYXQoIHBhcmFtbmFtZSwgcGFyYW12YWx1ZSApOwogICAgICogICBWYWx1ZUNoZWNrLnJlcXVpcmVUaGF0KCBwYXJhbW5hbWUsIHBhcmFtdmFsdWUgKTsKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwYXJhbW5hbWUgVGhlIG5hbWUgb2YgdGhlIHBhcmFtZXRlci92YXJpYWJsZSB0byBjaGVjay4gVXNlZCB0byBjb25zdHJ1Y3QgbWVhbmluZ2Z1bCBlcnJvciByZXBvcnRzCiAgICAgKiBAcGFyYW0ge0FueX0gcGFyYW12YWx1ZSBUaGUgdmFsdWUgb2YgdGhlIHBhcmFtZXRlci92YXJpYWJsZSB0byBjaGVjay4KICAgICAqIEByZXR1cm4ge1ZhbHVlQ2hlY2suQ2hlY2tPYmplY3R9IEEgQ2hlY2tPYmplY3QgaW5zdGFuY2UsIHRoYXQgY2FuIGJlIHVzZWQgdG8gY2hlY2sgdGhlIHZhbHVlIGZvciBtb3JlIGNvbnN0cmFpbnRzCiAgICAgKiBAZXhhbXBsZSBUaGUgZXhhbXBsZXMgYmVsb3cgYXJlIHNlbWFudGljYWxseSBlcXVhbCwgYnV0IHRoZSBmaXJzdCBvbmUgaXMgbW9yZSBleHBsaWNpdCB0aGFuIHRoZSBzZWNvbmQuIFdoaWNoIG9uZSB0byBwcmVmZXIgaXMgYSBtYXR0ZXIgb2YgdGFzdGU6CiAgICAgKiAgIFZhbHVlQ2hlY2suY2hlY2tUaGF0KCAiZm9vIiwgZm9vICkuaGFzLnR5cGUoICJzdHJpbmciICkuYW5kLnRoYXQudmFsdWUuaXMubm90LmVxdWFsVG8oICIiICk7CiAgICAgKiAgIFZhbHVlQ2hlY2suY2hlY2soICJmb28iLCBmb28gKS50eXBlKCAic3RyaW5nIiApLnVuZXF1YWxUbyggIiIgKTsKICAgICAqICAgVmFsdWVDaGVjay5yZXF1aXJlVGhhdCggImZvbyIsIGZvbykudmFsdWUuaGFzLnR5cGUoICJzdHJpbmciICkuYW5kLmlzLm5vdC5lcXVhbFRvKCAiIiApOwogICAgICogQG5hbWUgVmFsdWVDaGVjay5jaGVjawogICAgICogQG1ldGhvZAogICAgICovCiAgICB0aGF0LmNoZWNrID0gZnVuY3Rpb24oIHBhcmFtbmFtZSwgcGFyYW12YWx1ZSApIHsKICAgICAgICBpZiAoIGFyZ3VtZW50cy5sZW5ndGggIT0gMiApIHsKICAgICAgICAgICAgdGhyb3dFcnJvciggIkNoZWNrIG5lZWRzIGV4YWN0bHkgMiBhcmd1bWVudHMiICk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmNoZWNrVmFsdWUoIHBhcmFtbmFtZSwgcGFyYW12YWx1ZSApLmRlZmluZWQ7CiAgICB9CiAgICAvLyBTZXQgdXAgc29tZSBzaG9ydEhhbmRzCiAgICB0aGF0LmNoZWNrVGhhdCA9IHRoYXQuY2hlY2s7CiAgICB0aGF0LnJlcXVpcmVUaGF0ID0gdGhhdC5jaGVjazsKCgogICAgLyoqCiAgICAgKiBDaGVjayBhIHNwZWNpZmljIHBhcmFtZXRlci92YXJpYWJsZSBmb3IgYmVpbmcgdW5kZWZpbmVkLgogICAgICogCiAgICAgKiBUaGlzIGNvbnN0cnVjdG9yIGNvbnN0cnVjdHMgYW4gaW5zdGFuY2Ugb2YgYW4gQ2hlY2tPYmplY3Qgb2JqZWN0LCB0aGF0CiAgICAgKiBkb2VzIGEgc2luZ2xlIHRlc3Qgb24gdGhlIHZhbHVlLCB0aGF0IGl0IGlzIHVuZGVmaW5lZC4gTm90aGluZyBpcwogICAgICogcmV0dXJuZWQuIAogICAgICoKICAgICAqIEBzeW50YXggVmFsdWVDaGVjay5jaGVja1VuZGVmaW5lZCggcGFyYW1uYW1lLCBwYXJhbXZhbHVlICk7CiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcGFyYW1uYW1lIFRoZSBuYW1lIG9mIHRoZSBwYXJhbWV0ZXIvdmFyaWFibGUgdG8gY2hlY2suIFVzZWQgdG8gY29uc3RydWN0IG1lYW5pbmdmdWwgZXJyb3IgcmVwb3J0cwogICAgICogQHBhcmFtIHtBbnl9IHBhcmFtdmFsdWUgVGhlIHZhbHVlIG9mIHRoZSBwYXJhbWV0ZXIvdmFyaWFibGUgdG8gY2hlY2suCiAgICAgKiBAZXhhbXBsZSBWYWx1ZUNoZWNrLmNoZWNrVW5kZWZpbmVkKCAiZm9vIiwgZm9vICk7CiAgICAgKiBAbmFtZSBWYWx1ZUNoZWNrLmNoZWNrVW5kZWZpbmVkCiAgICAgKiBAbWV0aG9kCiAgICAgKi8KICAgIHRoYXQuY2hlY2tVbmRlZmluZWQgPSBmdW5jdGlvbiggcGFyYW1uYW1lLCBwYXJhbXZhbHVlICkgewogICAgICAgIGlmICggYXJndW1lbnRzLmxlbmd0aCAhPSAyICkgewogICAgICAgICAgICB0aHJvd0Vycm9yKCAiQ2hlY2tVbmRlZmluZWQgbmVlZHMgZXhhY3RseSAyIGFyZ3VtZW50cyIgKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5jaGVja1ZhbHVlKCBwYXJhbW5hbWUsIHBhcmFtdmFsdWUgKS51bmRlZmluZWQ7CiAgICB9CgoKICAgIC8vIFJldHVybiB0aGF0CiAgICByZXR1cm4gdGhhdDsKfSggKTsKCgovLyBUT0RPOiBTY3JpcHREb2MgcG9zc2libHkgbWlzc2luZyBAbmFtZSBpbiBvdGhlciBmaWxlIGZvciBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0LmlzCi8vIFRPRE86IFNjcmlwdERvYyBwb3NzaWJseSBtaXNzaW5nIEBuYW1lIGluIG90aGVyIGZpbGUgZm9yIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QuYW5kCi8vIFRPRE86IFNjcmlwdERvYyBwb3NzaWJseSBtaXNzaW5nIEBuYW1lIGluIG90aGVyIGZpbGUgZm9yIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QuaGFzCi8vIFRPRE86IFNjcmlwdERvYyBwb3NzaWJseSBtaXNzaW5nIEBuYW1lIGluIG90aGVyIGZpbGUgZm9yIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QuaGF2ZQovLyBUT0RPOiBTY3JpcHREb2MgcG9zc2libHkgbWlzc2luZyBAbmFtZSBpbiBvdGhlciBmaWxlIGZvciBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0LndpdGgKLy8gVE9ETzogU2NyaXB0RG9jIHBvc3NpYmx5IG1pc3NpbmcgQG5hbWUgaW4gb3RoZXIgZmlsZSBmb3IgVmFsdWVDaGVjay5DaGVja09iamVjdC5vZgovLyBUT0RPOiBTY3JpcHREb2MgcG9zc2libHkgbWlzc2luZyBAbmFtZSBpbiBvdGhlciBmaWxlIGZvciBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0LnZhbHVlCi8vIFRPRE86IFNjcmlwdERvYyBwb3NzaWJseSBtaXNzaW5nIEBuYW1lIGluIG90aGVyIGZpbGUgZm9yIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QubXVzdAovLyBUT0RPOiBTY3JpcHREb2MgcG9zc2libHkgbWlzc2luZyBAbmFtZSBpbiBvdGhlciBmaWxlIGZvciBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0LmJlCi8vIFRPRE86IFNjcmlwdERvYyBwb3NzaWJseSBtaXNzaW5nIEBuYW1lIGluIG90aGVyIGZpbGUgZm9yIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QudGhhdAovLyBUT0RPOiBTY3JpcHREb2MgcG9zc2libHkgbWlzc2luZyBAbmFtZSBpbiBvdGhlciBmaWxlIGZvciBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0Lml0Ci8vIFRPRE86IFNjcmlwdERvYyBwb3NzaWJseSBtaXNzaW5nIEBuYW1lIGluIG90aGVyIGZpbGUgZm9yIFZhbHVlQ2hlY2suQ2hlY2tPYmplY3QuZG9lcwovLyBUT0RPOiBTY3JpcHREb2MgcG9zc2libHkgbWlzc2luZyBAbmFtZSBpbiBvdGhlciBmaWxlIGZvciBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0LmFkZHJlc3MKLy8gVE9ETzogU2NyaXB0RG9jIHBvc3NpYmx5IG1pc3NpbmcgQG5hbWUgaW4gb3RoZXIgZmlsZSBmb3IgVmFsdWVDaGVjay5DaGVja09iamVjdC5hbgovLyBUT0RPOiBTY3JpcHREb2MgcG9zc2libHkgbWlzc2luZyBAbmFtZSBpbiBvdGhlciBmaWxlIGZvciBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0Lm5vdAovLyBUT0RPOiBTY3JpcHREb2MgcG9zc2libHkgbWlzc2luZyBAbmFtZSBpbiBvdGhlciBmaWxlIGZvciBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0LnVuZGVmaW5lZAovLyBUT0RPOiBTY3JpcHREb2MgcG9zc2libHkgbWlzc2luZyBAbmFtZSBpbiBvdGhlciBmaWxlIGZvciBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0LmRlZmluZWQKLy8gVE9ETzogU2NyaXB0RG9jIHBvc3NpYmx5IG1pc3NpbmcgQG5hbWUgaW4gb3RoZXIgZmlsZSBmb3IgVmFsdWVDaGVjay5DaGVja09iamVjdC5lbWFpbAovLyBUT0RPOiBTY3JpcHREb2MgcG9zc2libHkgbWlzc2luZyBAbmFtZSBpbiBvdGhlciBmaWxlIGZvciBWYWx1ZUNoZWNrLkNoZWNrT2JqZWN0LnVybAo=", "moduleName": "ValueCheck"}, {"javascript": "LyoqIEBmaWxlIFJlY29yZFByb2Nlc3NpbmcgbW9kdWxlICAqLw0KDQoNCkVYUE9SVEVEX1NZTUJPTFMgPSBbICdSZWNvcmRQcm9jZXNzaW5nJyBdOw0KDQp1c2UoICJMb2ciICk7DQoNCg0KLyoqDQogKiBNb2R1bGUgdGhhdCBoYW5kbGVzIHByb2Nlc3NpbmcsIHNraXBwaW5nIGFuZCBmYWlsaW5nIG9mIHJlY29yZHMNCiAqDQogKiBAdHlwZSB7bmFtZXNwYWNlfQ0KICogQG5hbWVzcGFjZQ0KICovDQoNCnZhciBSZWNvcmRQcm9jZXNzaW5nID0gZnVuY3Rpb24oICkgew0KDQogICAgLyoqDQogICAgICogRnVuY3Rpb24gdGhhdCB0ZXJtaW5hdGVzIHRoZSBwcm9jZXNzaW5nIG9mIHRoZSBjdXJyZW50IHJlY29yZCBhbmQgdGhyb3dzIGFuDQogICAgICogZXhjZXB0aW9uIHdpdGggaW5mb3JtYXRpb24gdGhhdCB0aGUgcmVjb3JkIHNob3VsZCBiZSBmYWlsZWQNCiAgICAgKg0KICAgICAqIEB0eXBlIHtmdW5jdGlvbn0NCiAgICAgKiBAc3ludGF4IFJlY29yZFByb2Nlc3NpbmcudGVybWluYXRlUHJvY2Vzc2luZ0FuZEZhaWxSZWNvcmQoIGVycm9yTWVzc2FnZSApDQogICAgICogQHBhcmFtIHtTdHJpbmd9IGVycm9yTWVzc2FnZSB0aGUgZXJyb3IgbWVzc2FnZSB0byB0aHJvdyBpbiBleGNlcHRpb24NCiAgICAgKiBAZnVuY3Rpb24NCiAgICAgKiBAbmFtZSBSZWNvcmRQcm9jZXNzaW5nLnRlcm1pbmF0ZVByb2Nlc3NpbmdBbmRGYWlsUmVjb3JkDQogICAgICovDQogICAgZnVuY3Rpb24gdGVybWluYXRlUHJvY2Vzc2luZ0FuZEZhaWxSZWNvcmQgKCBlcnJvck1lc3NhZ2UgKSB7DQoNCiAgICAgICAgTG9nLmluZm8oICJFbnRlcmluZzogUmVjb3JkUHJvY2Vzc2luZy50ZXJtaW5hdGVQcm9jZXNzaW5nQW5kRmFpbFJlY29yZCBtZXRob2QiICk7DQoNCiAgICAgICAgLy8gU3BlY2lhbCBoYWNrcyBoZXJlLi4gRG9uJ3QgZG8gdGhpcyBhdCBob21lLiBVc2VkIGluIGRhdGFpby1zeXN0ZW0gLSBjaGVjayB3aXRoIGphNw0KICAgICAgICBpZiAoIHR5cGVvZihQYWNrYWdlcykgPT09ICdvYmplY3QnICkgew0KICAgICAgICAgICAgUGFja2FnZXMuZGsuZGJjLmphdmFzY3JpcHQucmVjb3JkcHJvY2Vzc2luZy5GYWlsUmVjb3JkLmRvVGhyb3coIGVycm9yTWVzc2FnZSApOw0KICAgICAgICB9DQogICAgICAgIC8vIEVuZCBvZiBEb24ndCBkbyB0aGlzIGF0IGhvbWUuDQoNCiAgICAgICAgdGhyb3cgew0KICAgICAgICAgICAgbmFtZTogIkZBSUxFRCIsDQogICAgICAgICAgICBtZXNzYWdlOiBlcnJvck1lc3NhZ2UNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEZ1bmN0aW9uIHRoYXQgdGVybWluYXRlcyB0aGUgcHJvY2Vzc2luZyBvZiB0aGUgY3VycmVudCByZWNvcmQgYW5kIHRocm93cyBhbg0KICAgICAqIGV4Y2VwdGlvbiB3aXRoIGluZm9ybWF0aW9uIHRoYXQgdGhlIHJlY29yZCBzaG91bGQgYmUgc2tpcHBlZCAoaWdub3JlZCkNCiAgICAgKg0KICAgICAqIEB0eXBlIHtmdW5jdGlvbn0NCiAgICAgKiBAc3ludGF4IFJlY29yZFByb2Nlc3NpbmcudGVybWluYXRlUHJvY2Vzc2luZ0FuZElnbm9yZSggZXJyb3JNZXNzYWdlICkNCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZXJyb3JNZXNzYWdlIHRoZSBlcnJvciBtZXNzYWdlIHRvIHRocm93IGluIGV4Y2VwdGlvbg0KICAgICAqIEBmdW5jdGlvbg0KICAgICAqIEBuYW1lIFJlY29yZFByb2Nlc3NpbmcudGVybWluYXRlUHJvY2Vzc2luZ0FuZElnbm9yZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHRlcm1pbmF0ZVByb2Nlc3NpbmdBbmRJZ25vcmUgKCBlcnJvck1lc3NhZ2UgKSB7DQoNCiAgICAgICAgTG9nLmluZm8oICJFbnRlcmluZzogUmVjb3JkUHJvY2Vzc2luZy50ZXJtaW5hdGVQcm9jZXNzaW5nQW5kSWdub3JlIG1ldGhvZCIgKTsNCg0KICAgICAgICAvLyBTcGVjaWFsIGhhY2tzIGhlcmUuLiBEb24ndCBkbyB0aGlzIGF0IGhvbWUuIFVzZWQgaW4gZGF0YWlvLXN5c3RlbSAtICBjaGVjayB3aXRoIGphNw0KICAgICAgICBpZiAoIHR5cGVvZihQYWNrYWdlcykgPT09ICdvYmplY3QnICkgew0KICAgICAgICAgICAgUGFja2FnZXMuZGsuZGJjLmphdmFzY3JpcHQucmVjb3JkcHJvY2Vzc2luZy5JZ25vcmVSZWNvcmQuZG9UaHJvdyggZXJyb3JNZXNzYWdlICk7DQogICAgICAgIH0NCiAgICAgICAgLy8gRW5kIG9mIERvbid0IGRvIHRoaXMgYXQgaG9tZS4NCiAgICAgICAgdGhyb3cgew0KICAgICAgICAgICAgbmFtZTogIklHTk9SRSIsDQogICAgICAgICAgICBtZXNzYWdlOiBlcnJvck1lc3NhZ2UNCiAgICAgICAgfQ0KDQoNCiAgICB9DQoNCiAgICByZXR1cm4gew0KICAgICAgICB0ZXJtaW5hdGVQcm9jZXNzaW5nQW5kRmFpbFJlY29yZDogdGVybWluYXRlUHJvY2Vzc2luZ0FuZEZhaWxSZWNvcmQsDQogICAgICAgIHRlcm1pbmF0ZVByb2Nlc3NpbmdBbmRJZ25vcmU6IHRlcm1pbmF0ZVByb2Nlc3NpbmdBbmRJZ25vcmUNCiAgICB9Ow0KDQp9KCApOw0K", "moduleName": "RecordProcessing"}, {"javascript": "LyoqIEBmaWxlIERhbk1hcmMyVXRpbCBtb2R1bGUgICovDQoNCg0KRVhQT1JURURfU1lNQk9MUyA9IFsgJ0Rhbk1hcmMyVXRpbCcgXTsNCg0KdXNlKCAiTG9nIiApOw0KdXNlKCAiTWFyYyIgKTsNCg0KLyoqDQogKiBNb2R1bGUgdGhhdCBpbmNsdWRlcyBkaWZmZXJlbnQgZ2VuZXJpYyBmdW5jdGlvbnMgZm9yIG1vZGlmeWluZyBEYW5NYXJjMiByZWNvcmRzDQogKg0KICogQHR5cGUge25hbWVzcGFjZX0NCiAqIEBuYW1lc3BhY2UNCiAqLw0KDQp2YXIgRGFuTWFyYzJVdGlsID0gZnVuY3Rpb24oKSB7DQoNCiAgICAvKioNCiAgICAgKiBNZXRob2QgdGhhdCByZW1vdmVzIGJsYW5rcyBmcm9tIGZhdXN0IGluIHRoZSBmb2xsb3dpbmcgZmllbGRzDQogICAgICogMDAxYSwgMDAyYWNkLCAwMTFhLCAwMTNhLCAwMTRhLCAwMTZhLCAwMTdhLCAwMThhLCA1MjBuDQogICAgICogT25seSBmaWVsZCA1MjAgaGFzIHN1YmZpZWxkIG4NCiAgICAgKg0KICAgICAqIEB0eXBlIHttZXRob2R9DQogICAgICogQHN5bnRheCBEYW5NYXJjMlV0aWwucmVtb3ZlQmxhbmtzRnJvbUZhdXN0KCByZWNvcmQgKQ0KICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgbWFyYyByZWNvcmQgYXMgUmVjb3JkIG9iamVjdA0KICAgICAqIEByZXR1cm4ge1JlY29yZH0gVGhlIHVwZGF0ZWQgcmVjb3JkDQogICAgICogQG1ldGhvZA0KICAgICAqIEBuYW1lIERhbk1hcmMyVXRpbC5yZW1vdmVCbGFua3NGcm9tRmF1c3QNCiAgICAgKi8NCg0KICAgIGZ1bmN0aW9uIHJlbW92ZUJsYW5rc0Zyb21GYXVzdCggcmVjb3JkICkgew0KDQogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nIERhbk1hcmMyVXRpbC5yZW1vdmVCbGFua3NGcm9tRmF1c3QiICk7DQoNCiAgICAgICAgdmFyIG1hcCA9IG5ldyBNYXRjaE1hcCgpOw0KICAgICAgICBtYXAucHV0KCAiMDAxIiwgIjAxMSIsICIwMTMiLCAiMDE0IiwgIjAxNSIsICIwMTYiLCAiMDE3IiwgIjAxOCIsICJmMDciLCBmdW5jdGlvbiggZmllbGQgKSB7DQogICAgICAgICAgICBmaWVsZC5lYWNoU3ViRmllbGQoICJhIiwgZnVuY3Rpb24oIGZpZWxkLCBzdWJmaWVsZCApIHsNCiAgICAgICAgICAgICAgICBzdWJmaWVsZC52YWx1ZSA9IHN1YmZpZWxkLnZhbHVlLnJlcGxhY2UoIC8gL2csICIiICk7DQogICAgICAgICAgICB9ICk7IC8vZW5kIGVhY2hTdWJGaWVsZA0KICAgICAgICB9ICk7DQogICAgICAgIG1hcC5wdXQoICIwMDIiLCBmdW5jdGlvbiggZmllbGQgKSB7DQogICAgICAgICAgICBmaWVsZC5lYWNoU3ViRmllbGQoIC9bYWNkXS8sIGZ1bmN0aW9uKCBmaWVsZCwgc3ViZmllbGQgKSB7DQogICAgICAgICAgICAgICAgc3ViZmllbGQudmFsdWUgPSBzdWJmaWVsZC52YWx1ZS5yZXBsYWNlKCAvIC9nLCAiIiApOw0KICAgICAgICAgICAgfSApOyAvL2VuZCBlYWNoU3ViRmllbGQNCiAgICAgICAgfSApOw0KICAgICAgICBtYXAucHV0KCAiNTIwIiwgZnVuY3Rpb24oIGZpZWxkICkgew0KICAgICAgICAgICAgZmllbGQuZWFjaFN1YkZpZWxkKCAibiIsIGZ1bmN0aW9uKCBmaWVsZCwgc3ViZmllbGQgKSB7DQogICAgICAgICAgICAgICAgc3ViZmllbGQudmFsdWUgPSBzdWJmaWVsZC52YWx1ZS5yZXBsYWNlKCAvIC9nLCAiIiApOw0KICAgICAgICAgICAgfSApOw0KICAgICAgICB9ICk7DQoNCiAgICAgICAgcmVjb3JkLmVhY2hGaWVsZE1hcCggbWFwICk7DQoNCiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBEYW5NYXJjMlV0aWwucmVtb3ZlQmxhbmtzRnJvbUZhdXN0IiApOw0KDQogICAgICAgIHJldHVybiByZWNvcmQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogTWV0aG9kIHRoYXQgcmVuYW1lcyBmaWVsZCBzMTAgdG8gOTk2DQogICAgICoNCiAgICAgKiBAdHlwZSB7bWV0aG9kfQ0KICAgICAqIEBzeW50YXggRGFuTWFyYzJVdGlsLmNvbnZlcnRTMTB0bzk5NiggcmVjb3JkICkNCiAgICAgKiBAcGFyYW0ge1JlY29yZH0gcmVjb3JkIG1hcmMgcmVjb3JkIGFzIFJlY29yZCBvYmplY3QNCiAgICAgKiBAcmV0dXJuIHtSZWNvcmR9IFRoZSB1cGRhdGVkIHJlY29yZA0KICAgICAqIEBtZXRob2QNCiAgICAgKiBAbmFtZSBEYW5NYXJjMlV0aWwuY29udmVydFMxMHRvOTk2DQogICAgICovDQogICAgZnVuY3Rpb24gY29udmVydFMxMHRvOTk2KCByZWNvcmQgKSB7DQoNCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmcgRGFuTWFyYzJVdGlsLmNvbnZlcnRTMTB0bzk5NiIgKTsNCg0KICAgICAgICByZWNvcmQuZWFjaEZpZWxkKCAiczEwIiwgZnVuY3Rpb24oIGZpZWxkICkgew0KICAgICAgICAgICAgZmllbGQubmFtZSA9ICI5OTYiOw0KICAgICAgICB9ICk7DQoNCiAgICAgICAgTG9nLnRyYWNlKCAiTGVhdmluZyBEYW5NYXJjMlV0aWwuY29udmVydFMxMHRvOTk2IiApOw0KDQogICAgICAgIHJldHVybiByZWNvcmQ7DQogICAgfQ0KDQoNCiAgICAvKioNCiAgICAgKiBNZXRob2QgdGhhdCBzb3J0cyB0aGUgZmllbGRzIG9mIGEgbWFyYyByZWNvcmQgaW4gYXNjZW5kaW5nIG9yZGVyLg0KICAgICAqDQogICAgICogQHR5cGUge21ldGhvZH0NCiAgICAgKiBAc3ludGF4IERhbk1hcmMyVXRpbC5zb3J0RmllbGRzKCByZWNvcmQgKQ0KICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgVGhlIG1hcmMgcmVjb3JkIHRoYXQgbmVlZHMgdG8gYmUgc29ydGVkDQogICAgICogQHJldHVybiB7UmVjb3JkfSBBIG5ldyBtYXJjIHJlY29yZCB3aXRoIHNvcnRlZCBmaWVsZHMNCiAgICAgKiBAbWV0aG9kDQogICAgICogQG5hbWUgRGFuTWFyYzJVdGlsLnNvcnRGaWVsZHMNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBzb3J0RmllbGRzKCByZWNvcmQgKSB7DQoNCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmc6IERhbk1hcmMyVXRpbC5zb3J0RmllbGRzIG1ldGhvZCIgKTsNCg0KICAgICAgICB2YXIgc29ydGVkUmVjb3JkID0gbmV3IFJlY29yZCgpOw0KICAgICAgICBzb3J0ZWRSZWNvcmQucmVjb3JkU3RhdHVzID0gcmVjb3JkLnJlY29yZFN0YXR1czsNCiAgICAgICAgc29ydGVkUmVjb3JkLmZvclVzZXJTeXN0ZW1zID0gcmVjb3JkLmZvclVzZXJTeXN0ZW1zOw0KICAgICAgICBzb3J0ZWRSZWNvcmQuaW1wbGVtZW50YXRpb25Db2RlcyA9IHJlY29yZC5pbXBsZW1lbnRhdGlvbkNvZGVzOw0KDQogICAgICAgIHZhciBmaWVsZHMgPSBbXTsNCg0KICAgICAgICByZWNvcmQuZWFjaEZpZWxkKCAvLi8sIGZ1bmN0aW9uKCBmaWVsZCApIHsNCiAgICAgICAgICAgIGlmICggLTEgPT09IGZpZWxkcy5pbmRleE9mKCBmaWVsZC5uYW1lICkgKSB7DQogICAgICAgICAgICAgICAgZmllbGRzLnB1c2goIGZpZWxkLm5hbWUgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSApOw0KDQogICAgICAgIHZhciBzb3J0ZWRBcnJheSA9IGZpZWxkcy5zb3J0KCk7DQoNCiAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgc29ydGVkQXJyYXkubGVuZ3RoOyBpKysgKSB7DQogICAgICAgICAgICB2YXIgZmllbGROYW1lID0gc29ydGVkQXJyYXlbIGkgXTsNCiAgICAgICAgICAgIHJlY29yZC5lYWNoRmllbGQoIGZpZWxkTmFtZSwgZnVuY3Rpb24oIGZpZWxkICkgew0KICAgICAgICAgICAgICAgIHNvcnRlZFJlY29yZC5hcHBlbmQoIGZpZWxkICk7DQogICAgICAgICAgICB9ICk7DQogICAgICAgIH0NCg0KICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nOiBEYW5NYXJjMlV0aWwuc29ydEZpZWxkcyBtZXRob2QiICk7DQoNCiAgICAgICAgcmV0dXJuIHNvcnRlZFJlY29yZDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBNZXRob2QgdGhhdCBzb3J0cyB0aGUgc3ViZmllbGRzIG9mIHRoZSBpbnB1dEZpZWxkIGluIHRoZSBnaXZlbiBzb3J0T3JkZXIuDQogICAgICogU3ViZmllbGRzIG5vdCBzcGVjaWZpZWQgaW4gc29ydE9yZGVyIGFyZSBhcHBlbmRlZCBpbiB0aGUgZW5kDQogICAgICogLy9UT0RPOiB3ZSBjb3VsZCBjcmVhdGUgYSB0YWJsZSB3aXRoIHNvcnQgb3JkZXIgZm9yIGFsbCBmaWVsZHMsDQogICAgICogIHNvIHdlIGp1c3QgbmVlZCB0byBtYWludGFpbiBzdWJmaWVsZCBvcmRlcnMgaW4gb25lIHBsYWNlLg0KICAgICAqDQogICAgICogQGZ1bmN0aW9uDQogICAgICogQHN5bnRheCBEYW5NYXJjMlV0aWwuc29ydFN1YmZpZWxkcyAoIGlucHV0RmllbGQsIHNvcnRPcmRlciApDQogICAgICogQHBhcmFtIHtGaWVsZH0gaW5wdXRGaWVsZCBUaGUgaW5wdXQgZmllbGQNCiAgICAgKiBAcGFyYW0ge1N0cmluZ1tdfSBzb3J0T3JkZXIgQW4gQXJyYXkgb2Ygc3ViZmllbGQgbmFtZXMgc3BlY2lmeWluZyB0aGUgb3JkZXJpbmcgb2Ygc3ViZmllbGRzDQogICAgICogQHJldHVybiB7RmllbGR9IGEgbmV3IEZpZWxkIHdpdGggdGhlIChzcGVjaWZpZWQpIHN1YmZpZWxkcyBmcm9tIHRoZSBpbnB1dCBmaWVsZCBvcmRlcmVkIGJ5IHRoZSBzcGVjaWZpZWQgc29ydCBvcmRlcg0KICAgICAqIEBuYW1lIERhbk1hcmMyVXRpbC5zb3J0U3ViZmllbGRzDQogICAgICovDQogICAgZnVuY3Rpb24gc29ydFN1YmZpZWxkcyggaW5wdXRGaWVsZCwgc29ydE9yZGVyICkgew0KDQogICAgICAgIExvZy50cmFjZSggJ0VudGVyaW5nIERhbk1hcmMyVXRpbC5zb3J0U3ViZmllbGRzJyApOw0KDQogICAgICAgIHZhciBvdXRwdXRGaWVsZCA9IG5ldyBGaWVsZCggaW5wdXRGaWVsZC5uYW1lLCBpbnB1dEZpZWxkLmluZGljYXRvciApOw0KICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBzb3J0T3JkZXIubGVuZ3RoOyBpKysgKSB7DQogICAgICAgICAgICBpbnB1dEZpZWxkLmVhY2hTdWJGaWVsZCggc29ydE9yZGVyWyBpIF0sIGZ1bmN0aW9uKCBmaWVsZCwgc3ViZmllbGQgKSB7DQogICAgICAgICAgICAgICAgb3V0cHV0RmllbGQuYXBwZW5kKCBzdWJmaWVsZC5uYW1lLCBzdWJmaWVsZC52YWx1ZSApOw0KICAgICAgICAgICAgfSApDQogICAgICAgIH0NCiAgICAgICAgaW5wdXRGaWVsZC5lYWNoU3ViRmllbGQoIC8uLywgZnVuY3Rpb24oIGZpZWxkLCBzdWJmaWVsZCApIHsNCiAgICAgICAgICAgIGlmICggLTEgPT09IHNvcnRPcmRlci5pbmRleE9mKCBzdWJmaWVsZC5uYW1lICkgKSB7DQogICAgICAgICAgICAgICAgb3V0cHV0RmllbGQuYXBwZW5kKCBzdWJmaWVsZC5uYW1lLCBzdWJmaWVsZC52YWx1ZSApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9ICk7DQoNCiAgICAgICAgTG9nLnRyYWNlKCAnTGVhdmluZyBEYW5NYXJjMlV0aWwuc29ydFN1YmZpZWxkcycgKTsNCg0KICAgICAgICByZXR1cm4gb3V0cHV0RmllbGQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogTWV0aG9kIHRoYXQgY3JlYXRlcyBhIHN0cmluZyBjb250YWluaW5nIHRoZSBmdWxsIG5hbWUgb2YgYSBwZXJzb24sDQogICAgICogY29uc2lzdGluZyBvZiBmaXJzdCBuYW1lIGFuZCBsYXN0IG5hbWUuDQogICAgICoNCiAgICAgKiBAdHlwZSB7bWV0aG9kfQ0KICAgICAqIEBzeW50YXggRGFuTWFyYzJVdGlsLmNyZWF0ZVBlcnNvbk5hbWVGcm9tTWFyY0ZpZWxkKCBmaWVsZCApDQogICAgICogQHBhcmFtIHtTdHJpbmd9IGZpZWxkIEEgc3BlY2lmaWMgZmllbGQgaW4gdGhlIG1hcmMgcmVjb3JkDQogICAgICogQHJldHVybiB7U3RyaW5nfSB0aGUgcGVyc29uIG5hbWUgZnJvbSBzdWJmaWVsZCBhIGNvbmNhdGluYXRlZCB3aXRoIHN1YmZpZWxkIGgNCiAgICAgKiBAbWV0aG9kDQogICAgICogQG5hbWUgRGFuTWFyYzJVdGlsLmNyZWF0ZVBlcnNvbk5hbWVGcm9tTWFyY0ZpZWxkDQogICAgICovDQogICAgZnVuY3Rpb24gY3JlYXRlUGVyc29uTmFtZUZyb21NYXJjRmllbGQoIGZpZWxkICkgew0KDQogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nOiBNYXJjUmVjb3JkLmNyZWF0ZVBlcnNvbk5hbWVGcm9tTWFyY0ZpZWxkIG1ldGhvZCIgKTsNCg0KICAgICAgICB2YXIgZmlyc3ROYW1lID0gZmllbGQuZ2V0VmFsdWUoICJoIiApOw0KICAgICAgICB2YXIgbGFzdE5hbWUgPSBmaWVsZC5nZXRWYWx1ZSggImEiICk7DQogICAgICAgIHZhciBmdWxsTmFtZSA9ICIiOw0KDQogICAgICAgIGlmICggIiIgIT09IGZpcnN0TmFtZSApIHsNCiAgICAgICAgICAgIGZ1bGxOYW1lID0gZmlyc3ROYW1lICsgIiAiICsgbGFzdE5hbWU7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBmdWxsTmFtZSA9IGxhc3ROYW1lOw0KICAgICAgICB9DQogICAgICAgIExvZy5kZWJ1ZyggIkNyZWF0ZWQgZnVsbCBuYW1lOiAiLCBmdWxsTmFtZSApOw0KDQogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmc6IE1hcmNSZWNvcmQuY3JlYXRlUGVyc29uTmFtZUZyb21NYXJjRmllbGQgbWV0aG9kIiApOw0KDQogICAgICAgIHJldHVybiBmdWxsTmFtZTsNCg0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhIHN0cmluZyBjb250YWluaW5nIGFsbCB0aGUgc3ViZmllbGQgbmFtZXMgaW4gYSBmaWVsZC4NCiAgICAgKg0KICAgICAqIEB0eXBlIHttZXRob2R9DQogICAgICogQHN5bnRheCBEYW5NYXJjMlV0aWwuZ2V0QWxsU3ViZmllbGROYW1lcyggZmllbGQgKQ0KICAgICAqIEBwYXJhbSB7RmllbGR9IGZpZWxkIEEgc3BlY2lmaWMgZmllbGQgaW4gdGhlIG1hcmMgcmVjb3JkDQogICAgICogQHJldHVybiB7U3RyaW5nfSBhIHN0cmluZyB3aXRoIGFsbCB0aGUgc3ViZmllbGQgbmFtZXMgY29uY2F0aW5hdGVkDQogICAgICogQG1ldGhvZA0KICAgICAqIEBuYW1lIERhbk1hcmMyVXRpbC5nZXRBbGxTdWJmaWVsZE5hbWVzDQogICAgICovDQogICAgZnVuY3Rpb24gZ2V0QWxsU3ViZmllbGROYW1lcyggZmllbGQgKSB7DQoNCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmc6IE1hcmNSZWNvcmQuZ2V0QWxsU3ViZmllbGROYW1lcyBtZXRob2QiICk7DQoNCiAgICAgICAgdmFyIHN1YmZpZWxkTmFtZVN0cmluZyA9ICIiOw0KICAgICAgICBmaWVsZC5lYWNoU3ViRmllbGQoIC8uLywgZnVuY3Rpb24oIGZpZWxkLCBzdWJmaWVsZCApIHsNCiAgICAgICAgICAgIHN1YmZpZWxkTmFtZVN0cmluZyArPSBzdWJmaWVsZC5uYW1lOw0KICAgICAgICB9ICk7DQogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmc6IE1hcmNSZWNvcmQuZ2V0QWxsU3ViZmllbGROYW1lcyBtZXRob2QiICk7DQoNCiAgICAgICAgcmV0dXJuIHN1YmZpZWxkTmFtZVN0cmluZzsNCg0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEZ1bmN0aW9uIHRoYXQgcmVtb3ZlcyBlbXB0eSBzdWJmaWVsZHMgZnJvbSB0aGUgcmVjb3JkLg0KICAgICAqDQogICAgICogQHR5cGUge2Z1bmN0aW9ufQ0KICAgICAqIEBzeW50YXggRGFuTWFyYzJVdGlsLnJlbW92ZUVtcHR5U3ViZmllbGRzKCByZWNvcmQgKQ0KICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgQSBtYXJjIHJlY29yZA0KICAgICAqIEByZXR1cm4ge1JlY29yZH0gVGhlIHVwZGF0ZWQgcmVjb3JkDQogICAgICogQG1ldGhvZA0KICAgICAqIEBuYW1lIERhbk1hcmMyVXRpbC5yZW1vdmVFbXB0eVN1YmZpZWxkcw0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJlbW92ZUVtcHR5U3ViZmllbGRzKCByZWNvcmQgKSB7DQoNCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmc6IERhbk1hcmMyVXRpbC5yZW1vdmVFbXB0eVN1YmZpZWxkcyBmdW5jdGlvbiIgKTsNCg0KICAgICAgICByZWNvcmQuZWFjaEZpZWxkKCAvLi8sIGZ1bmN0aW9uKCBmaWVsZCApIHsNCiAgICAgICAgICAgIGZpZWxkLnJlbW92ZVdpdGhNYXRjaGVyKCB7DQogICAgICAgICAgICAgICAgbWF0Y2hTdWJGaWVsZDogZnVuY3Rpb24oIGZpZWxkLCBzdWJmaWVsZCApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBzdWJmaWVsZC52YWx1ZSA9PT0gIiIgJiYgIXN1YmZpZWxkLm5hbWUubWF0Y2goIC9bMC0xXS8gKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9ICkNCiAgICAgICAgfSApOw0KDQogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmc6IERhbk1hcmMyVXRpbC5yZW1vdmVFbXB0eVN1YmZpZWxkcyBmdW5jdGlvbiIgKTsNCg0KICAgICAgICByZXR1cm4gcmVjb3JkOw0KDQogICAgfQ0KDQogICAgLyoqDQogICAgICogRnVuY3Rpb24gdGhhdCByZW1vdmVzIGVtcHR5IGZpZWxkcyBmcm9tIHRoZSByZWNvcmQuDQogICAgICoNCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259DQogICAgICogQHN5bnRheCBEYW5NYXJjMlV0aWwucmVtb3ZlRW1wdHlGaWVsZHMoIHJlY29yZCApDQogICAgICogQHBhcmFtIHtSZWNvcmR9IHJlY29yZCBBIG1hcmMgcmVjb3JkDQogICAgICogQHJldHVybiB7UmVjb3JkfSBUaGUgdXBkYXRlZCByZWNvcmQNCiAgICAgKiBAbWV0aG9kDQogICAgICogQG5hbWUgRGFuTWFyYzJVdGlsLnJlbW92ZUVtcHR5RmllbGRzDQogICAgICovDQogICAgZnVuY3Rpb24gcmVtb3ZlRW1wdHlGaWVsZHMoIHJlY29yZCApIHsNCg0KICAgICAgICBMb2cudHJhY2UoICJFbnRlcmluZzogRGFuTWFyYzJVdGlsLnJlbW92ZUVtcHR5RmllbGRzIGZ1bmN0aW9uIiApOw0KDQogICAgICAgIHZhciBpID0gMDsNCiAgICAgICAgdmFyIHJlbW92ZUFycmF5ID0gW107DQogICAgICAgIHJlY29yZC5lYWNoRmllbGQoIC8uLywgZnVuY3Rpb24oIGZpZWxkICkgew0KICAgICAgICAgICAgaWYgKCBmaWVsZC5zaXplKCkgPCAxICkgew0KICAgICAgICAgICAgICAgIHJlbW92ZUFycmF5LnB1c2goIGkgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGkrKzsNCiAgICAgICAgfSApOw0KICAgICAgICByZW1vdmVBcnJheS5yZXZlcnNlKCk7DQogICAgICAgIGZvciAoIHZhciBqID0gMDsgaiA8IHJlbW92ZUFycmF5Lmxlbmd0aDsgaisrICkgew0KICAgICAgICAgICAgcmVjb3JkLnJlbW92ZSggcmVtb3ZlQXJyYXlbIGogXSApDQogICAgICAgIH0NCg0KICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nOiBEYW5NYXJjMlV0aWwucmVtb3ZlRW1wdHlGaWVsZHMgZnVuY3Rpb24iICk7DQoNCiAgICAgICAgcmV0dXJuIHJlY29yZDsNCg0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEZ1bmN0aW9uIHRoYXQgdW4tZW1iZWRzIHRyYWNrIGZpZWxkcyAoNzk1KS4NCiAgICAgKg0KICAgICAqIEB0eXBlIHtmdW5jdGlvbn0NCiAgICAgKiBAc3ludGF4IERhbk1hcmMyVXRpbC51bkVtYmVkRmllbGRzKCByZWNvcmQgKQ0KICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgYSBtYXJjIHJlY29yZA0KICAgICAqIEByZXR1cm4ge1JlY29yZH0gVGhlIHVwZGF0ZWQgcmVjb3JkDQogICAgICogQG1ldGhvZA0KICAgICAqIEBuYW1lIERhbk1hcmMyVXRpbC51bkVtYmVkRmllbGRzDQogICAgICovDQogICAgZnVuY3Rpb24gdW5FbWJlZEZpZWxkcyggcmVjb3JkICkgew0KDQogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nOiBEYW5NYXJjMlV0aWwudW5FbWJlZEZpZWxkcyBmdW5jdGlvbiIgKTsNCg0KICAgICAgICB2YXIgb2xkRmllbGRzID0gW107DQogICAgICAgIHZhciB0cmFja1JlY29yZCA9IG5ldyBSZWNvcmQoKTsNCiAgICAgICAgdmFyIG5ld0ZpZWxkID0gdW5kZWZpbmVkOw0KICAgICAgICB2YXIgcmVmU3ViZmllbGQgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgcmVjb3JkLmVhY2hGaWVsZCggL2FbMC05XVswLTldLywgZnVuY3Rpb24oIGZpZWxkICkgew0KICAgICAgICAgICAgaWYgKCBmaWVsZC5leGlzdHMoIC9cdTAwZTUvICkgKSB7DQogICAgICAgICAgICAgICAgcmVmU3ViZmllbGQgPSBmaWVsZC5zdWJmaWVsZCggIlx1MDBlNSIgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZpZWxkLmVhY2hTdWJGaWVsZCggLy4vLCBmdW5jdGlvbiggZmllbGQsIHN1YmZpZWxkICkgew0KICAgICAgICAgICAgICAgIGlmICggc3ViZmllbGQubmFtZSA9PSAxICYmIHN1YmZpZWxkLnZhbHVlLm1hdGNoKCAvWzAtOV17NX0vICkgKSB7ICAvL2lzIHRoaXMgYSByaWdodCBtYXRjaD8/DQogICAgICAgICAgICAgICAgICAgIGlmICggbmV3RmllbGQgIT09IHVuZGVmaW5lZCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYWNrUmVjb3JkLmFwcGVuZCggbmV3RmllbGQgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBuZXdGaWVsZCA9IG5ldyBGaWVsZCggc3ViZmllbGQudmFsdWUuc3Vic3RyKCAwLCAzICksICIwMCIgKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCByZWZTdWJmaWVsZCAhPT0gdW5kZWZpbmVkICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3RmllbGQuYXBwZW5kKCByZWZTdWJmaWVsZCApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICggc3ViZmllbGQubmFtZSAhPT0gIlx1MDBlNSIgKSB7DQogICAgICAgICAgICAgICAgICAgIG5ld0ZpZWxkLmFwcGVuZCggc3ViZmllbGQgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9ICk7DQogICAgICAgICAgICBvbGRGaWVsZHMucHVzaCggU3RyaW5nKCBmaWVsZC5uYW1lICkgKTsNCiAgICAgICAgICAgIHRyYWNrUmVjb3JkLmFwcGVuZCggbmV3RmllbGQgKTsNCiAgICAgICAgICAgIG5ld0ZpZWxkID0gdW5kZWZpbmVkOw0KICAgICAgICAgICAgcmVmU3ViZmllbGQgPSB1bmRlZmluZWQ7DQogICAgICAgIH0gKTsNCiAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgb2xkRmllbGRzLmxlbmd0aDsgaSsrICkgew0KICAgICAgICAgICAgcmVjb3JkLnJlbW92ZSggb2xkRmllbGRzWyBpIF0gKTsNCiAgICAgICAgfQ0KICAgICAgICB0cmFja1JlY29yZC5lYWNoRmllbGQoIC8uLywgZnVuY3Rpb24oIGZpZWxkICkgew0KICAgICAgICAgICAgcmVjb3JkLmFwcGVuZCggZmllbGQgKTsNCiAgICAgICAgfSApOw0KDQogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmc6IERhbk1hcmMyVXRpbC51bkVtYmVkRmllbGRzIGZ1bmN0aW9uIiApOw0KDQogICAgICAgIHJldHVybiByZWNvcmQ7DQoNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBGdW5jdGlvbiB0aGF0IHJlc2V0cyBpbmRpY2F0b3JzLCByZW1vdmVzIGJsYW5rcyBmcm9tIGZhdXN0IGFuZCBzb3J0cyB0aGUgZmllbGRzIGluIGEgcmVjb3JkLg0KICAgICAqDQogICAgICogQHR5cGUge2Z1bmN0aW9ufQ0KICAgICAqIEBzeW50YXggRGFuTWFyYzJVdGlsLnRyaW1SZWNvcmQoIHJlY29yZCApDQogICAgICogQHBhcmFtIHtSZWNvcmR9IHJlY29yZCBhIG1hcmMgcmVjb3JkDQogICAgICogQHJldHVybiB7UmVjb3JkfSBUaGUgdXBkYXRlZCByZWNvcmQNCiAgICAgKiBAZnVuY3Rpb24NCiAgICAgKiBAbmFtZSBEYW5NYXJjMlV0aWwudHJpbVJlY29yZA0KICAgICAqLw0KDQogICAgZnVuY3Rpb24gdHJpbVJlY29yZCggcmVjb3JkICkgew0KDQogICAgICAgIExvZy50cmFjZSggIkVudGVyaW5nOiBEYW5NYXJjMlV0aWwudHJpbVJlY29yZCBmdW5jdGlvbiIgKTsNCg0KICAgICAgICByZWNvcmQgPSBEYW5NYXJjMlV0aWwuc29ydEZpZWxkcyggcmVjb3JkICk7DQogICAgICAgIHJlY29yZCA9IERhbk1hcmMyVXRpbC5yZW1vdmVCbGFua3NGcm9tRmF1c3QoIHJlY29yZCApOw0KICAgICAgICByZWNvcmQuZWFjaEZpZWxkKCAvLi8sIGZ1bmN0aW9uKCBmaWVsZCApIHsNCiAgICAgICAgICAgIGZpZWxkLmluZGljYXRvciA9ICIwMCI7DQogICAgICAgIH0gKTsNCg0KICAgICAgICBMb2cudHJhY2UoICJMZWF2aW5nOiBEYW5NYXJjMlV0aWwudHJpbVJlY29yZCBmdW5jdGlvbiIgKTsNCg0KICAgICAgICByZXR1cm4gcmVjb3JkOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEZ1bmN0aW9uIHRoYXQgcmVwbGFjZXMgb25lIGZvcm0gb2YgYWxwaGFiZXRpemluZyBub3RhdGlvbiB3aXRoIGFub3RoZXIuDQogICAgICoNCiAgICAgKiBAdHlwZSB7ZnVuY3Rpb259DQogICAgICogQHN5bnRheCBEYW5NYXJjMlV0aWwucmVwbGFjZU5vbmZpbGluZ05vdGF0aW9uKCByZWNvcmQgKQ0KICAgICAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmQgYSBtYXJjIHJlY29yZA0KICAgICAqIEByZXR1cm4ge1JlY29yZH0gVGhlIHVwZGF0ZWQgcmVjb3JkDQogICAgICogQGZ1bmN0aW9uDQogICAgICogQG5hbWUgRGFuTWFyYzJVdGlsLnJlcGxhY2VOb25maWxpbmdOb3RhdGlvbg0KICAgICAqLw0KDQogICAgZnVuY3Rpb24gcmVwbGFjZU5vbmZpbGluZ05vdGF0aW9uKCByZWNvcmQgKSB7DQoNCiAgICAgICAgTG9nLnRyYWNlKCAiRW50ZXJpbmc6IERhbk1hcmMyVXRpbC5yZXBsYWNlTm9uZmlsaW5nTm90YXRpb24gZnVuY3Rpb24iICk7DQoNCiAgICAgICAgLy9oZWxwZXIgZnVuY3Rpb24NCiAgICAgICAgZnVuY3Rpb24gX19yZXBsYWNlTm9uZmlsaW5nQ2hhcnMoIGZpZWxkICkgew0KICAgICAgICAgICAgZmllbGQuZWFjaFN1YkZpZWxkKCAvLi8sIGZ1bmN0aW9uKCBmaWVsZCwgc3ViZmllbGQgKSB7DQogICAgICAgICAgICAgICAgaWYgKCBzdWJmaWVsZC52YWx1ZS5tYXRjaCggL1x1MDA5OC4qXHUwMDlDL2kgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgc3ViZmllbGQudmFsdWUgPSBzdWJmaWVsZC52YWx1ZS5yZXBsYWNlKCAvXHUwMDk4KC4qKVx1MDA5Qy9pLCAiJDHCpCIgKTsgIC8vIFx1MDBBNA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBtYXAgPSBuZXcgTWF0Y2hNYXAoKTsNCiAgICAgICAgcmVjb3JkLmVhY2hGaWVsZE1hcFdpdGhEZWZhdWx0KCBtYXAsIF9fcmVwbGFjZU5vbmZpbGluZ0NoYXJzLCB7fSApOw0KDQogICAgICAgIExvZy50cmFjZSggIkxlYXZpbmc6IERhbk1hcmMyVXRpbC5yZXBsYWNlTm9uZmlsaW5nTm90YXRpb24gZnVuY3Rpb24iICk7DQoNCiAgICAgICAgcmV0dXJuIHJlY29yZDsNCiAgICB9DQoNCg0KICAgIHJldHVybiB7DQogICAgICAgIHJlbW92ZUJsYW5rc0Zyb21GYXVzdDogcmVtb3ZlQmxhbmtzRnJvbUZhdXN0LA0KICAgICAgICBjb252ZXJ0UzEwdG85OTY6IGNvbnZlcnRTMTB0bzk5NiwNCiAgICAgICAgc29ydEZpZWxkczogc29ydEZpZWxkcywNCiAgICAgICAgc29ydFN1YmZpZWxkczogc29ydFN1YmZpZWxkcywNCiAgICAgICAgZ2V0QWxsU3ViZmllbGROYW1lczogZ2V0QWxsU3ViZmllbGROYW1lcywNCiAgICAgICAgY3JlYXRlUGVyc29uTmFtZUZyb21NYXJjRmllbGQ6IGNyZWF0ZVBlcnNvbk5hbWVGcm9tTWFyY0ZpZWxkLA0KICAgICAgICByZW1vdmVFbXB0eUZpZWxkczogcmVtb3ZlRW1wdHlGaWVsZHMsDQogICAgICAgIHJlbW92ZUVtcHR5U3ViZmllbGRzOiByZW1vdmVFbXB0eVN1YmZpZWxkcywNCiAgICAgICAgdW5FbWJlZEZpZWxkczogdW5FbWJlZEZpZWxkcywNCiAgICAgICAgdHJpbVJlY29yZDogdHJpbVJlY29yZCwNCiAgICAgICAgcmVwbGFjZU5vbmZpbGluZ05vdGF0aW9uOiByZXBsYWNlTm9uZmlsaW5nTm90YXRpb24NCiAgICB9Ow0KDQoNCn0oKTs=", "moduleName": "DanMarc2Util"}], "svnRevision": 126314, "requireCache": null, "invocationMethod": "convertRawRecordToDst", "invocationJavascriptName": "dm2_to_dst.js", "svnProjectForInvocationJavascript": "conversion-flows/bogstat-dm2-to-dst/js"}, "version": 2}], "description": "Flow for poster fra RR til Danmarks Statistik (dst) "},"view":"{\"id\": 16702, \"name\": \"RR2Dst\", \"version\": 1, \"components\": [{\"id\": 16701, \"name\": \"RR2Dst\", \"version\": 2, \"revision\": \"126314\", \"nextRevision\": \"126314\"}], \"description\": \"Flow for poster fra RR til Danmarks Statistik (dst) \", \"timeOfComponentUpdate\": null}"}